<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
   <title>CTM</title>
</head>
<body bgcolor="#ffffff" text="#000000" link="#23238e">

<center>
<img alt="CTM para OpenBSD" src="../images/bsdctm.gif" width=401 height=126>
</center>

<h3>¿Qué es CTM?</h3>

<p>
CTM es un sistema para realizar cambios a diario a un árbol de fuentes 
accesible por correo electrónico;  CTM ha sido diseñado por Poul-Henning Kamp.
Este sistema es un buen modo para estar actualizado con los fuentes en
&quot;current&quot; o con el árbol del CVS, sobre todo si la conexión a
internet de que disponemos no es buena, como por ejemplo con modem.

<p>
CTM usa muy poco ancho de banda para distribuir los cambios al árbol, y los
comprime usando gzip -9.

<h3>¿Cómo funciona?</h3>

<p>
El principio básico es que Vd. se subscriba a una lista de correo específica
para un árbol de fuentes particular.
Cada día recibirá un mensaje por correo electrónico que contendrá todos los
cambios acontecidos en ese árbol durante ese periodo.
Un grupo de diferencias se conoce como un &laquo;delta&raquo;.

<p>
Vd. empieza con un grupo inicial o &laquo;base&raquot; que se irá parcheando 
con las sucesivas &laquo;deltas&raquo;.
Para empezar a usar ctm debe bajarse la última &laquo;base&raquo; existente y 
todas las deltas que hayan aparecido hasta ese momento.
Una vez que haya parcheado su base con esas deltas, ya puede empezar un 
proceso normal con las sucesivas deltas que irá recibiendo por medio de la
lista de correo.
Las bases están divididas en partes de 1.400KB cada una, para que sean más 
fáciles de transferir por líneas de baja calidad y para que las pueda copiar 
en disquetes tal cual están.

<p>
Las bases se generan aproximadamente una vez cada 100 deltas, de este modo
nunca tendrá que bajarse más de 100 deltas a la vez para poder ponerse al
día.

<h3>¿Cuánto ancho de banda usa CTM?</h3>

<p>
Como ya se ha mencionado anteriormente, la base contiene un árbol completo de
fuentes en formato TAR, y por lo tanto es bastante grande.
Debe obtener la base y todas las deltas subsecuentes hasta el momento por
ftp, desde el sitio que se indica más abajo.
Los tamaños son:

<ul>
<li>aproximadamente de 115MB para OpenBSD-cvs
<li>aproximadamente de 37MB para OpenBSD-cvs-x11
<li>aproximadamente de 65MB para OpenBSD-src
<li>aproximadamente de 35MB para OpenBSD-src-x11
<li>aproximadamente de 2MB para OpenBSD-ports
<li>recuerde que estos ficheros están comprimidos... multiplíquelos por
    cinco para obtener el tamaño aproximado una vez descomprimidos
<li>las deltas relativas a una base están entre 10KB y 100KB, y algunas veces
    hasta un par de MB
<li>ctm siempre divide las deltas en mensajes de 100KB, que son reensamblados
    de modo automático
</ul>

<p>
Las actualizaciones por ctm más grandes son raras, aunque pueden ocurrir si
ha habido una actualización importante como binutils, perl, etc...

<h3>¿Cómo uso CTM?</h3>

<ul>
<li>Subscríbase en la lista de correo de ctm para los fuentes que quiera.

   <p>Hay varias listas de correo relacionadas con ctm.
      Existe una lista para actualizarse con las actualizaciones del árbol de
      cvs, una lista para el árbol de fuentes, una lista para las
      actualizaciones de X11 de los anteriores, una lista para el árbol de
      portes, y una lista para ver los mensajes de &quot;log&quot; del
      generador ctm de deltas.

   <p>Las siguientes órdenes le darán de alta en las listas apropiadas:

<br><br><tt>
Para el árbol de cvs (sin la parte de X11):<br>
   <b>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</b><br>
Para la parte de X11 del árbol de cvs:<br>
   <b>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</b><br>
Para el árbol de fuentes (sin la parte de X11):<br>
   <b>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</b><br>
Para la parte de X11 del árbol de fuentes:<br>
   <b>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</b><br>
Para el árbol de portes:<br>
   <b>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</b><br>
Para los &quot;log&quot; de ctm:<br>
   <b>echo subscribe ctm-log | mail majordomo@OpenBSD.org</b><br>
</tt><br>

<li>Espere hasta que reciba su primera delta.

<li>Desarchívela y ensamble la delta de ctm usando ctm_rmail.
<br>
<br>
<tt>
    <b>ctm_rmail -p. -d. -b. folder</b>
</tt>
<br>
<br>
en donde <b>folder</b> se debe substituir por el buzón de correo que contenga 
el mensaje con la delta.
<br>
De esta forma habrá descodificado la delta de ctm y la habrá copiado en el
directorio en que se encuentre.
La delta será un fichero con la forma OpenBSD-XXX.YYYY.gz, en donde XXX será
&quot;src&quot; o &quot;cvs&quot;, y YYYY será el número correspondiente a la
delta.

<p>

<li>Para bajarse la base, hágalo del servidor de ftp que se indica más abajo,
del subdirectorio <b>base/OpenBSD-cvs</b> (para OpenBSD-cvs) o
<b>base/OpenBSD-src</b> (para OpenBSD-src).
Bájese todos los ficheros en ese directorio, y una vez que los tenga puede
crear el árbol de fuentes base con la siguiente orden:

<br><br>
<tt>
    <b>cd target <br>
    cat /split/OpenBSD-* | tar zxf - <br>
</b></tt><br>

en donde <b>split</b> debe ser substituido por el nombre del directorio en el
que copió los ficheros que se bajó.

<p>
Ya no es necesario que conserve esos ficheros si está seguro de que tiene un
árbol completo.
Sin embargo, asegúrese de anotar el número de la base antes de seguir.

<p>
Ahora necesitará bajarse las deltas que hayan sido generadas desde que se
generó la base.
Vaya el servidor de ftp que se indica a continuación, en el subdirectorio
<b>OpenBSD-cvs</b> u <b>OpenBSD-src</b>, y bájese todos los ficheros cuyos
números sean <i>mayores</i> que el número de la base que haya usado.

<p>
Las direcciones de ftp para la base y las deltas son:

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/</a>
</ul>

<ul>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/</a>
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/</a>
</ul>

<p>

<ul>
<li><b>NOTA:</b> Estoy muy interesado en encontrar otros servidores alrededor
del mundo que quisieran replicar estas deltas.
</ul>

<p>

<li>Ejecute ctm.
<br>
  <br>
  <tt>
     <b>cd target<br>
     ctm -v -v /deltas/OpenBSD-cvs.*</b><br></tt>

<br>
en donde <b>target</b> debe substituirlo por el nombre del directorio en
el que quiera ubicar su árbol de cvs, y <b>deltas</b> por el nombre del
directorio en el que haya copiado las deltas.

<p>
Tardará un tiempo en procesar todas las deltas, pero las invocaciones diarias
de <b>ctm_rmail</b> y <b>ctm</b> no tardarán tanto.
</ul>

<h3>¿Debo escoger el árbol de fuentes o el de cvs?</h3>

<p>
Esto depende del espacio en disco del que disponga, entre otros factores.
Como ctm todavía no puede manejar ficheros que hayan sido modificados fuera
del proceso de ctm, tal vez la mejor elección sea cvs-tree.
De este modo puede comprobar su árbol de fuentes actual desde su árbol de
cvs, y mantener su modo local en su árbol de fuentes, dejando que sólo ctm
toque su árbol de fuentes.

<p>
Sin embargo, la parte negativa es que necesitará mucho espacio en disco.
Un árbol de fuentes requiere unos 300MB, pero si tiene su propio árbol de cvs
necesitará unos 400MB para éste, <b>más</b> otros 300MB para el árbol que se
haya bajado.

<p>
Esto sin tener en cuenta los 100MB o más que necesitará para un compilación
(dependiendo de la arquitectura).

<p>
Si sólo tiene el árbol de fuentes, tan sólo será necesario tratar
modificaciones a nivel local.
Un modo de hacerlo es usando el sistema de archivos <b>union</b>, aunque han
habido informes en los que se decía que el sistema de archivos <b>union</b>
puede ser inestable si tanto el las capas superiores como las inferiores
residen en el mismo sistema de archivos físico.
Si ubica sus capas superiores e inferiores en sistemas de archivos separados,
no debe surgir ningún problema.
Un ejemplo de esto es el que sigue a continuación:

<p>
Supongamos que su árbol actualizado por ctm se encuentra en
<b>/usr/src-ctm</b>, y que su árbol de fuentes real, el que modificó y del
que llevó a cabo la compilación, se encuentra en <b>/usr/src</b>.
<b>/usr/src</b> debería ser al principio un directorio vacío.
La siguiente orden configurará el montaje de &quot;union&quot;:
<br>
<br>
<tt>
    <b>mount -t union -o -b /usr/src-ctm /usr/src</b>
</tt>
<br>
<br>
Las modificaciones que se hayan hecho a los ficheros en /usr/src se
convertirán en un fichero dentro de /usr/src, y esconderá el que haya en
src-ctm.
Si los cambios se hacen mediante ctm al árbol src-ctm, esos cambios <b>no</b>
se verán si hay un fichero en la capa superior que lo esconda.

<p>
El sistema de archivos &quot;union&quot; se debe desmontar periódicamente, y
buscar si hay ficheros locales de &quot;union&quot;.
<br>
<br>
<tt>
    <b>umount /usr/src <br>
    find /usr/src -type f</b> <br>
</tt>
<br>
<br>
Las órdenes <b>ls -W</b> y <b>rm -W</b> también son muy útiles, ya que
objetos llamados &quot;whiteouts&quot; en /usr/src también esconderán
ficheros en src-ctm.

<p>
Si tiene el árbol de cvs puede usar la orden <b>cvs checkout</b> para bajar
un árbol de fuentes desde cvs-tree, y cada vez que lo actualice con ctm puede
usar la orden <b>cvs update</b> para actualizar su árbol de fuentes.

<br>
<br>
Para bajarse un árbol de fuentes inicial:<br>
<tt>
    <b>cd /usr <br>
    cvs -qd YOUR_CVS_TREE checkout src</b> <br><br>
</tt>
y después de cada actualización por ctm:<br>
<tt>
    <b>cd /usr/src <br>
    cvs -q update -PAd</b> <br>
</tt>

<h3>¿Es CTM estable en OpenBSD?</h3>

CTM se ha usado durante algo más de un año para OpenBSD, y durante varios
años para FreeBSD.
CTM ofrece bastante fiabilidad y estabilidad.

<h3>Más información</h3>

Si tiene problemas con ctm, un buen sitio por donde empezar es por la guía
de FreeBSD:

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">http://www.FreeBSD.org/handbook/ctm.html</a>
</ul>

También existen páginas de manual para todas las utilidades de ctm, que
vienen incluidas en el paquete de fuentes.
Si tiene OpenBSD instalado, debería tener ya las páginas de manual, los 
fuentes, y los binarios.
En caso contrario las puede obtener del mismo servidor de ftp que se indica 
más abajo para las deltas.

<p>
También puede contactar con las listas de correo de OpenBSD o conmigo si
tiene dificultades con ctm, aunque mi tiempo libre suele ser bastante
limitado.

<p>
Sumario:

<p>

<ul>
<li>Listas de correo:

   <ul>
   <li> <b>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe ctm-log | mail majordomo@OpenBSD.org</b>
   </ul>

<li>FTP (para la base y sus deltas correspondientes;  OpenBSD tiene ctm en el
    árbol de fuentes, pero si no dispone de los fuentes o binarios, aquí
    también puede encontrar los fuentes):

   <ul>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm">ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm</a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm">ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm</a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm">ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm</a>
   </ul>
</ul>

<p>
Cualquier anuncio o notificación importante lo haré en:
<ul>
<li>misc@OpenBSD.org
<li>announce@OpenBSD.org
</ul>

<p>
<b>NOTA:</b> Si usa CTM para OpenBSD, por favor envíeme un mensaje para que
pueda saber cuántas personas lo están usando.

<h3>Reconocimientos</h3>

<li>A Poul-Henning Kamp (phk@FreeBSD.org) por hacer posible CTM y por
    ayudarme a poner en funcionamiento la generación de deltas.

<li>A Theo de Raadt (deraadt@theos.com) por hacer posible OpenBSD y darme 
    desde el principio los recursos que necesitaba para generar las deltas de 
    ctm en cvs.OpenBSD.org (ahora se generan en otra parte), y por el nombre 
    mágico del servidor.

<li>A Todd C. Miller (millert@OpenBSD.org) por montar y mantener las listas
    de correo de ctm.

<li>A Bob Beck (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org), Magnus
    Holmberg (mho@OpenBSD.org) y Wolfram Schneider (wosch@FreeBSD.org) por
    montar el espacio para las bases y deltas en ctm.*OpenBSD.org.

<li> ... y a todos los demás que también contribuyeron de un modo indirecto.
</ul>

<p>
¡Buena suerte!

<p>
t

<hr>

<address><a href="mailto:graichen@OpenBSD.org">Thomas Graichen</a></address>
<br>
Logotipo de OpenBSD/CTM diseñado para el proyecto de OpenBSD por 
<a href="mailto:flipk@openbsd.org">Phillip F Knaack</a>.

<p>
<!-- Created: Mon Oct 28 22:20:54 MET 1996 -->
<!-- hhmts start -->
<small>
Originally [OpenBSD: ctm.html,v 1.11 2000/03/25 02:29:49 wvdputte Exp ]<br>
$Translation: ctm.html,v 1.4 2000/04/04 23:13:28 horacio Exp $<br>
$OpenBSD: ctm.html,v 1.2 2000/04/05 21:00:49 wvdputte Exp $
</small>
<!-- hhmts end -->

</body>
</html>
