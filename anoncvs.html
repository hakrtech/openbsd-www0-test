<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict//EN">
<html>
<head>
<title>OpenBSD AnonCVS</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="How to get OpenBSD updates via Internet using Anonymous CVS">
<meta name="keywords" content="openbsd,anoncvs,updates">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-1998 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<img alt="[OpenBSD]" height=30 width=141 SRC="images/smalltitle.gif">
<p>
<h2><font color=#e00000>Anonymous CVS</font><hr></h2>

<p>
<ul><h3>Table Of Contents</h3>
<li><a href="#anoncvs">What is Anonymous CVS?</a>
<li><a href="#CVS">What is CVS?</a>
<li><a href="#starting">Getting Started Using Anonymous CVS.</a>
<li><a href="#using">Using CVS to Get and Update your Source Tree.</a>
<li><a href="#CVSROOT">Available Anonymous CVS Servers.</a>
<li><a href="#CRYPTO">Getting crypto sources through CVS(1).</a>
<li><a href="#EXAMPLE">Example usages for CVS(1).</a>
<li><a href="#WHICH">Use rsh(1) or ssh(1)?</a>
<li><a href="#SUP">Mirroring the CVS repository via sup(1).</a>
<li><a href="#MIRROR">Setting up an anoncvs mirror.</a>
</ul>
</p>
<hr>


<a name="anoncvs"></a>
<h3><font color=#0000e0>What is Anonymous CVS?</font></h3>

<p>
Anonymous CVS is a method of keeping your local copy of the OpenBSD source
tree up to date with respect to changes made to current OpenBSD sources.
In addition to following the bleeding edge of development, it is
also possible to track the patches for errata of a release.
</p>

<p>
The major advantage of Anonymous CVS over other source code update
techniques is that it works directly against a central source code
repository or mirror.  This means that you have the full set of CVS
commands available to control merging and updating your changes with
other source changes and for performing diff's, change histories
and other queries against the central repository.
</p> 

<p>
The OpenBSD Project currently has three main source repositories:
</p>

<ul>
        <li><b>src</b> - Houses all source code for the OpenBSD Operating System.
        <li><b>ports</b> - Houses the <a href="./ports.html">OpenBSD Ports</a>.
        <li><b>www</b> - Houses all OpenBSD web pages. (Including this one).
</ul>

<p>
To summarize, the real strength of using Anonymous CVS is that it is
a "tolerant" source code control system - it <strong>respects</strong>
changes that you have made to your local sources and makes <strong>
"best efforts"</strong> to update your entire source tree, rather than
leaving you a list of arcane problems that have to be resolved before
continuing.
</p>

<a name="CVS"></a>
<h3><font color=#0000e0>What is CVS?</font></h3>

<p>
<a href=why-cvs.html>
CVS is the source code control system used to manage the OpenBSD source tree.</a>
It implements a central repository for all officially released source code
and changes, while permitting developers to maintain local copies of the
source code with their working changes.  Developers with "<b>write access</b>"
can commit changes directly to the OpenBSD source tree, while "Anonymous
CVS" users have "<b>read access</b>" and can keep their local copies of the source
up to date and issue queries against the central depository.
</p>

<p>
The major strength of CVS is that it has the ability to perform intelligent
merges of changes to the central repository with changes that you make to
your local copy.  This means that if you make a change to a module and
perform an update, your changes are not "blown away", rather CVS makes
best efforts to merge the changes made to the central sources with changes
you've made to your local copy.
</p>

<p>
In the event that the changes can't be completely merged, CVS provides a
"soft fallback", in terms of providing you with annotated changes to your
local copy, preserving an unmodified copy of your version and continuing
to update any other source modules you requested.
</p>

<a name="starting"></a>
<h3><font color=#0000e0>Getting Started Using Anonymous CVS.</font></h3>

<p>
The latest version of CVS is available at
<a href=http://download.cyclic.com/pub/>Cyclic</a>.
Versions earlier than 1.6 are not recommended, and may not work.
If you already have OpenBSD installed, CVS is included.
</p>

<p>
People who own an OpenBSD CD may have seen the <i>CVS/</i> dirs on it.
Actually there is a reason, the CD has a checkout of the OpenBSD <b>src</b> module
usable to continue updating from.  Using this tree will result in a much
faster initial CVS update than a fresh checkout of the full OpenBSD
source tree.  There are two ways of using the CD:
</p>

<ul>
<li>To copy the CVS tree from the CD to <i>/usr/src</i> (assuming the CD is mounted on /mnt):
<pre>
	# <b>cd /mnt; pax -rw CVS Makefile [a-z]* /usr/src</b>
</pre>
<li>Use a union mount (see <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html">mount_union(8)</a>) with the CD below a writable directory. (This can be used when only compiling from the tree.)
<pre>
	# <b>mount -t union -o -b /mnt /usr/src</b>
</pre>
</ul>

<p>
For people who don't have a CD on hand, you can use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1&format=html">cvs(1)</a> to "<b>checkout</b>" the source repository for you. This is discussed in the <a href="#using">next section</a>.
</p>

<p>
After this, <i>/usr/src</i> will be a nice checkout area where all <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1&format=html">cvs(1)</a> commands will work OK.
</p>

<a name="using"></a>
<h3><font color=#0000e0>Using CVS(1) to get and update your source tree.</font></h3>

<p>
CVS was designed to be a simple way to retrieve and update your sources,
therefore there isn't much involved at all in doing so.  You must first
decide whether you want to track <i>current</i> or a patch branch.
source tree.  The current tree has all of the up to the minute changes,
whereas a patch branch contains a formal release plus the patches
from the <a href="errata.html">errata</a> already applied.

<p>Once you have decided which tree to follow, you much choose which Anonymous
CVS server you are going to use.  A list of these servers is
<a href="#CVSROOT">below</a>.  Do, however, notice that there are 3 ways
to access these servers.
</p>

<ul>
<li><b>ssh</b> - Secure Shell can be used to access the anonymous CVS servers. This is the <b>recommended</b> way of doing so, as it is encrypted. As of 2.6 OpenBSD has included OpenSSH in its standard distribution.
<li><b>rsh</b> - Remote Shell can be used on some of the servers for users who don't have access to <a href="http://www.openssh.com">ssh</a>
<li><b>pserver</b> - pserver is primarily useful for users who are behind firewalls that block the other two connections.
</ul>

<p>
<b>NOTE:</b> - For users wishing to use ssh, you must first set the <i>CVS_RSH</i> variable to ssh.

<ul>
<li> For Korn/Bourne shells.
<pre>
	$ <b>export CVS_RSH="/usr/bin/ssh"</b>
</pre>
<li> For CSH based shells.
<pre>
	$ <b>setenv CVS_RSH /usr/bin/ssh</b>
</pre>
</ul>

<p>
Once you have chosen which <a href="#CVSROOT">Anonymous CVS Server</a> you will use, and which method you will use, you can start using cvs. For those of you who have CD's you can start with the CVS checkout that is on the CD by using the method <a href="#starting">above</a> to get the sources onto your system. If you don't have a CD handy, use the method below to checkout the sources. This method puts the OpenBSD source tree into <i>/usr/src</i>. 
</p>

<p>
<ul><pre>
# <b>cd /usr; cvs checkout src</b>
</ul></pre>
</p>

<p>
The above will checkout the <i>current</i> source tree.  Many of you will
only want a patch branch sources.  To checkout a patch branch, you must
specify a tag along with your command. Example:
</p>

<p>
<ul><pre>
# <b>cd /usr; cvs checkout -P -rOPENBSD_2_7 src</b>
</ul></pre>
Or OPENBSD_2_6 for 2.6, etc.
</p>

<p> Currently only the OPENBSD_2_7 tag contains the release sources and
errata already applied.

<a name="CVSROOT"></a>
<h3><font color=#0000e0>Available Anonymous CVS Servers.</font></h3>

<p>
There are two levels of source tree access:

<dl>
<dt><strong>Read-write access for developers:</strong>
<dd>Developers who need to commit changes to the source tree must have
an account on the OpenBSD machines.  Getting this access will be a
natural result of working on the sources with other OpenBSD developers.
If someone does some good work and shows they can work with the team,
they will get an account.
</dl>

<dl>
<dt><strong>Read-only access for everyone:</strong>
<dd>Anyone can access the read-only CVS repositories. These copies
of the read-write CVS repository are mirrored often. To use one,
set your <strong>CVSROOT</strong> environment variable to one of
the following values:
<p>
<strong>Please see the note about using ssh vs. rsh below!</strong>
<p>
<ul>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs1.usa.openbsd.org:/cvs</strong><br>
Host also known as <strong>anoncvs@anoncvs4.usa.openbsd.org</strong>.<br>
located in California, western USA.<br>
maintained by <a href=mailto:millert@openbsd.org>Todd Miller</a>.<br>
protocols: pserver only.<br>
updated every 4 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.usa.openbsd.org:/cvs</strong><br>
Host also known as <strong>anoncvs3.usa.openbsd.org</strong>.<br>
located at the University of Colorado, Boulder, western USA.<br>
maintained by <a href=mailto:Todd.Miller@cs.colorado.edu>Todd Miller</a>.<br>
protocols: rsh, ssh, ssh port 2022, pserver.<br>
updated every 6 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs5.usa.openbsd.org:/cvs</strong><br>
Host also known as <strong>squid.nas.nasa.gov</strong>.<br>
located at Ames Research Center, Moffett Field, California, USA.<br>
maintained by <a href=mailto:allison@mail.arc.nasa.gov>Tyler Allison</a>.<br>
protocols: ssh only.<br>
updated every 3 hours.<br>
<li><strong>CVSROOT=anoncvs@mirror.arc.nasa.gov:/cvs</strong><br>
located at Ames Research Center, Moffett Field, California, USA.<br>
maintained by <a href=mailto:allison@mail.arc.nasa.gov>Tyler Allison</a>.<br>
protocols: ssh only.<br>
updated every 3 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs6.usa.openbsd.org:/cvs</strong><br>
Host also known as <strong>openbsd.citi.umich.edu</strong>.<br>
located at the University of Michigan, central USA.<br>
maintained by <a href=mailto:rees@umich.edu>Jim Rees</a>.<br>
protocols: ssh, ssh port 2022.<br>
updated every 12 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs1.ca.openbsd.org:/cvs</strong><br>
Host also known as <strong>anoncvs.ca.openbsd.org</strong>, 
<strong>openbsd.sunsite.ualberta.ca</strong><br>
located in Edmonton, Alberta, Canada.<br>
maintained by <A HREF="mailto:beck@ualberta.ca">Bob Beck</A><br>
protocols: ssh, rsh, ssh port 2022, pserver<br>
updated every 2 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@valkyrie.secureops.com:/cvs</strong><br>
located in Montreal, Quebec, Canada.<br>
maintained by <A HREF="mailto:drbones@darkelves.com">Patrick Ethier</A><br>
protocols: ssh<br>
updated every 24 hours at 3 AM EST<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.uk.openbsd.org:/cvs</strong><br>
Host also known as <strong>dumpty.wonderland.org</strong>.<br>
located in London, UK.<br>
maintained by <a href=mailto:peter@wonderland.org>Peter Galbavy</a>.<br>
protocols: rsh.<br>
updated every 12 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.tw.openbsd.org:/cvs</strong><br>
Host also known as <strong>OpenBSD.csie.NCTU.edu.tw</strong>.<br>
located in Taipei, Taiwan.<br>
maintained by <a href=mailto:lkchu@OpenBSD.csie.NCTU.edu.tw>Liang-Kai Chu</a>.<br>
protocols: rsh, ssh, ssh port 2022.<br>
updated every 12 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.no.openbsd.org:/cvs</strong><br>
Host also known as <strong>cvs.inet.no</strong>.<br>
located in Norway.<br>
maintained by <a href=mailto:cvsadmin@inet.no>Michael Shuldman</a>.<br>
protocols: rsh, ssh, ssh port 2022.<br>
updated every 4 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.se.openbsd.org:/cvs</strong><br>
Host also known as <strong>anoncvs.stacken.kth.se</strong>.<br>
located in Sweden.<br>
maintained by <a href=mailto:anoncvs@stacken.kth.se>Magnus Holmberg</a>.<br>
protocols: rsh, ssh, ssh port 2022.<br>
updated every 3 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.be.openbsd.org:/cvs</strong><br>
Host also known as <strong>badlands.rug.ac.be</strong>.<br>
located in Belgium.<br>
maintained by <a href=mailto:wvdputte@reptile.rug.ac.be>Wim Vandeputte</a>.<br>
protocols: ssh, ssh port 2022.<br>
updated every 3 hours.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.jp.openbsd.org:/cvs</strong><br>
Host also known as <strong>kankoromochi.econ.nagasaki-u.ac.jp</strong>.<br>
located at Nagasaki Univ. Faculty of Economics, JAPAN.<br>
maintained by <a href=mailto:sigh@net.nagasaki-u.ac.jp>SUZUKI Hitoshi</a>.<br>
protocols: ssh, pserver.<br>
updated every 3 hours.<br>
<li><strong>CVSROOT=anoncvs@anoncvs.cz.openbsd.org:/cvs</strong><br>
Host also known as <strong>com-os2.ms.mff.cuni.cz</strong>.<br>
located at Faculty Math &amp; Physics, Charles University, Prague, Czech republic.<br>
maintained by <a href=mailto:galambos@com-os2.ms.mff.cuni.cz>Leo Galambos</a>.<br>
protocols: ssh, ssh port 2022.<br>
updated every 3 hours.<br>
<li><strong>CVSROOT=anoncvs@anoncvs1.au.openbsd.org:/cvs</strong><br>
Host also known as <strong>anoncvs.au.openbsd.org</strong>, 
<strong>anoncvs.openbsd.aba.net.au</strong><br>
located in Carlton, Victoria, Australia.<br>
maintained by <A HREF="mailto:mwp@aba.net.au">Micheal Paddon</A><br>
protocols: ssh<br>
updated every 4 hours.<br>
<li><strong>CVSROOT=anoncvs@dolphin.mtmc.ru:/cvs</strong><br>
located in Moscow, Russia<br>
maintained by <A HREF="mailto:jc@mtmc.ru">John Chertihin</A><br>
protocols: rsh, ssh<br>
updated every 24 hours (at 1 AM Moscow time)<br>
<li><strong>CVSROOT :pserver:anoncvs@gloup.linuxfr.org:/cvs</strong><br>
Host also known as <strong>gloup.linuxfr.org</strong><br>
located at Paris (Claranet), FRANCE<br>
maintained by: <A HREF=mailto:seisen@linuxfr.org>Fabien Seisen</A><br>
protocols: pserver, ssh<br>
updated every 24h ( at 2h GMT )<br>
<li><strong>CVSROOT :pserver:anoncvs@cvs.bsdfr.org:/cvs</strong><br>
located at in France<br>
maintained by: <A HREF=mailto:jch@oleane.net>Jean-Claude Christophe</A><br>
protocols: pserver<br>
updated every 24h <br>
<li><strong>CVSROOT=anoncvs@exokernel.lcs.mit.edu:/cvs</strong><br>
located at M.I.T, Eastern USA.<br>
maintained by ????<br>
protocols: ssh, ???<br>
updated every ? hours.<br>
<li><strong>CVSROOT=anoncvs@xyzzy.gsnig.org:/cvs</strong><br>
Located in G&ouml;teborg, Sweden<br>
maintained by martin@openbsd.org<br>
protocols: ssh port 2022<br>
updated every 4 hours.<br>
<li><strong>CVSROOT=anoncvs@stl-isaas.ey.com:/cvs</strong><br>
Located in St. Louis, MO, Eastern USA<br>
maintained by <A HREF="mailto:aaron11@sprynet.com">Aaron Miller</A><br>
protocols: ssh, ssh port 2022, pserver<br>
updated every 3 hours.<br>
<li><strong>CVSROOT=anoncvs@openbsd.groupbsd.org:/cvs</strong><br>
Located in Hillsborough NC, Eastern USA<br>
maintained by <A HREF="mailto:jason@openbsd.org">Jason Wright</A><br>
protocols: ssh<br>
updated every 4 hours.<br>
<li><strong>CVSROOT=anoncvs@headend-vlan1-cm19.fibertel.com.ar:/cvs</strong><br>
Located in Buenos Aires, Argentina<br>
maintained by ????<br>
protocols: ssh?, ???<br>
updated every ? hours.<br>
</ul>


<p>
<EM>Note:</EM>, If your server is listed on here with inaccurate or
unknown information, please contact
<A HREF="mailto:beck@openbsd.org"><tt>beck@openbsd.org</tt></A>
</p>

<p>
You may want to use 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=traceroute&sektion=8&format=html">traceroute(8)</a>
to find out which server is nearest you.
Problems with a server should be reported to the <b>maintainer</b> of the
server in question.
</dl></p>

<a name="CRYPTO"></a>
<h3><font color=#0000e0>Getting crypto sources through CVS(1)</font></h3>

<p>
<strong>IMPORTANT NOTE:</strong>
There are a few issues relating to cryptographic software that everyone
should be aware of:
<ul>
<li>The OpenBSD sources are from Canada.
As
	<a href=http://insight.mcmaster.ca/org/efc/pages/doc/crypto-export.html>
	researched by a Canadian individual</a>
and as
	<a href=http://axion.physics.ubc.ca/ECL.html>
	described in the Export Control list of Canada</a>
is legal to export crypto software from Canada to the world.
<p>
<li>However, if you are outside the USA or Canada, you should not
fetch the cryptographic sections of the OpenBSD sources from an
anoncvs server located in the USA. The files in question are...
<ul>
<li>src/kerberosIV/*
<li>src/lib/libdes/*
<li>src/lib/libc/crypt/crypt.c
<li>src/lib/libc/crypt/morecrypt.c
<li>src/sys/netinet
<li>src/usr.sbin/afs/src/rxkad/*
<li>X11/xc/lib/Xdmcp/Wraphelp.c
</ul>
Because of the USA ITAR munitions list,
crypto software may only be exported to Canada from the USA.
<p>
<li>The OpenBSD project is looking for more anoncvs servers -- read
on to find out how you can help.
</ul>

<a name="EXAMPLE"></a>
<h3><font color=#0000e0>Example usages for CVS(1).</font></h3>

<p>
A sample use of an anoncvs CVS server would be:
<ul><pre>
% <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
% <strong>cd /tmp</strong>
% <strong>cvs get src/sys/arch/sparc</strong>
    [copies the files from the repository to your machine]
% <strong>cvs log src/sys/arch/sparc/sparc/locore.s</strong>
    [shows the commit log for the chosen file ]
% <strong>cvs diff -bc -r1.1 -r1.5 src/sys/arch/sparc/sparc/locore.s</strong>
    [shows the changes between revisions 1.1 and rev 1.5]
</pre></ul>

<p>
<a name=pserver>In order to use a cvs ``pserver'' (a direct tcp connection instead of using ssh or rsh) you must login once:</a>

<ul><pre>
    [ *NOTE* You must be using cvs version 1.8 or higher to do this          ]
% <strong>setenv CVSROOT :pserver:anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
% <strong>cvs login</strong>
(Logging in to anoncvs@anoncvs1.ca.openbsd.org)
CVS password: <strong>anoncvs</strong>
    [this writes a line to ~/.cvspass (filename over-ridden by CVS_PASSFILE).]
    [An example line from my ~/.cvspass after typing 'blah' for the above    ]
    [password is:                                                            ]
    [:pserver:anoncvs@anoncvs5.usa.openbsd.org:/cvs Au'yc                    ]
    [...after logging in ONCE every other use of the above CVSROOT will work ]
% <strong>cvs get ksrc-i386 ksrc-common</strong>
    [allows you to retrieve ONLY that necessary to rebuild an i386 kernel    ]
</pre></ul>

<p>
Here is how someone using anoncvs regularly would update his
source tree:
<ul><li>First, start out by `get'-ing an initial tree:

<p> (If you are following <i>current</i>):
<ul><pre>
# <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
# <strong>cd /usr</strong>
# <strong>cvs -q get -PA src</strong>
</pre></ul>

<p> (If you are following the patch branch for 2.7):
<ul><pre>
# <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
# <strong>cd /usr</strong>
# <strong>cvs -q get -rOPENBSD_2_7 -P src</strong>
</pre></ul>
</li>

<li> Anytime afterwards, to `update' this tree:
<p> (If you are following <i>current</i>):
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -q up -PAd</strong>
</pre></ul>

<p> (If you are following the patch branch for 2.7):
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -q up -rOPENBSD_2_7 -Pd</strong>
</pre></ul>

Everytime you ran this it would synchronize your /usr/src tree. It would
not destroy any of your local changes, rather it would attempt to merge
changes in. If you use obj directories (not obj symbolic links) you may
wish to append "-I obj" to the cvs command line, this will keep cvs from
spitting out a warning about all the obj directories it is going to
encounter which are not in the repository.

<p>
<li> NOTES: if you are updating a source tree that you initially fetched
from a different server, or from a CD, you <strong>must</strong>
add the <em>-d $CVSROOT</em> options to cvs.  You must also set the
<em>CVS_IGNORE_REMOTE_ROOT</em> environment variable.  If you are following
a patch branch, be sure to always <strong>omit</strong> the <code>-A</code>
flag to cvs, or you may find yourself tracking <i>current</i> instead.

<p> (If you are following <i>current</i>):
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -d $CVSROOT -q up -PAd</strong>
</pre></ul>

<p> (If you are following a patch branch):
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -d $CVSROOT -q up -Pd</strong>
</pre></ul>

</li>
</ul>

<p>
To <a name=ports>use</a> <a href=ports.html>ports</a>, it is similar to src:
<ul><li>
<pre>
# <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
# <strong>cd /usr</strong>
# <strong>cvs -q get -PA ports</strong>
</pre>
</li>
<li> Anytime afterwards, to `update' this tree:
<pre>
# <strong>cd /usr</strong>
# <strong>cvs -q up -PAd ports</strong>
</pre>
</li>
</p>
</ul>

In the above example, <i>-q</i> is optional, only intended to minimize
cvs's output.  For those who like to see screenfulls of output, it
can be omitted.

<p>
or to make a diff of a locally patched module (here <i>cd.c</i>) to include with
a bug report:
<ul><pre>
# <strong>cd /usr</strong>
# <strong>cvs diff -u src/sys/scsi/cd.c > /tmp/patch</strong>
</pre></ul>
</p>

<p>
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1&format=html">CVS(1) man page</a>
(included with the CVS sources) has much more
information about how CVS can be used.

<p>
<strong>X11 Source tree</strong>
<br>
Anoncvs mirrors also carry the OpenBSD X11 source tree. You can adapt
the recipe above to update your X11 source tree from the second CD.
Either copy or use a union mount to get the X11 sources in <i>/usr/X11</i>:

<ul>
<li>copy the tree off it (assuming the 2nd CD is mounted on /mnt):
<pre>
        # <strong>cd /mnt; cp -Rp X11 /usr</strong>
</pre>
<li>use a union mount with the CD below a writable directory.
<pre>
        # <strong>mount -t union -o -b /mnt/X11 /usr/X11</strong>
</pre></ul>

After this, <i>/usr/X11</i> will be ready to be used by cvs. You can for
example update it to -current source (assuming you've already set
the <b>CVSROOT</b> environment variable):

<ul><pre>
        # <strong>cd /usr/X11</strong>
        # <strong>cvs -q update -PAd</strong>
</pre></ul>

<p>
<strong>Warning:</strong>
When using cvs you should take care that your current directory is either
the root of the tree you are referencing or in a separate place such as /tmp.
Some commands such as "get" can create an arbitrary sub-tree in the current
directory, and a subsequent update will recursively flesh out this sub-tree.

<p>
The anoncvs service gives fledgling developers a chance to learn CVS
operation and get thoroughly involved in the development process
before getting "commit" access -- as a result of showing useful
skills and high quality results they will naturally later be given
developer access.  As well, people providing patches can create
their "diff"s relative to the CVS tree, which will ease integration.


<a name="WHICH"></a>
<h3><font color=#0000e0>Use rsh(1) or ssh(1)?</font></h3>

<p>
<strong>Anoncvs: rsh vs. ssh</strong>
<br>
By default, the CVS client uses rsh to talk to the CVS server.  Many
of the CVS sites no longer support rsh for security reasons or a local
problem like a firewall or imperfect protocol emulator such as slirp
may prevent you from using rsh.
The alternative is a to use a "secure shell" connection using either
<a href=http://www.openssh.com>OpenSSH (*FREE*)</a> or
<a href=http://www.cs.hut.fi/ssh/>ssh (non-commercial and commercial)</a>.

<p>
The OpenBSD anoncvs repositries support the SSH1 protocol, not the SSH2
protocol due to the use of a "strict non-commercial use licensing policy".

<p>
Once ssh is installed, one sets the environment variable
<strong>CVS_RSH</strong> to point to ssh (typically
<strong>/usr/local/bin/ssh</strong>).  If your local site prevents you
from connecting out to port 22 (which ssh defaults to using) use port
2022.  

<p>
Do not be tempted to turn on compression since CVS already compresses.
Use something like the following in your <strong>$HOME/.ssh/config</strong>
file.  Note that not all anoncvs servers allow ssh connections on
port 2022.  Also note that most anoncvs servers no longer accept
the <strong>none</strong> cipher as it is disabled in recent
versions of ssh for security reasons.
<pre>
	Host anoncvs.ca.openbsd.org
	    Port 2022
</pre>

<p>
CVS is a little noisy starting up; to quiet it a bit you may want to
do this:

<ul><pre>
<strong>setenv CVS_CLIENT_PORT -1</strong>
</pre></ul>

<p>
If you wish to change from one CVS server to another (say your normal one is
down, or for any other reason), the environment variable which will let you
do this is

<ul><pre>
<strong>setenv CVS_IGNORE_REMOTE_ROOT</strong>
</pre></ul>

Note that you will also need to use the <strong>-d</strong> flag
as mentioned above.

<a name="SUP"></a>
<h3><font color=#0000e0>Mirroring the CVS repository via sup(1).</font></h3>

<p>
Users wishing to mirror the OpenBSD CVS tree itself may now do so
from <em>anoncvs.usa.openbsd.org</em>.  Note that this is the cvs
tree, <b>not</b> a checked out source tree.  It is only useful if
you want to be able to do fast cvs operations (diff, annotate, etc)
or if you have multiple source trees and you only want to transfer
new data once (you can then checkout a tree from your local cvs
mirror).
<p>
A sample supfile would be:
<pre>
	cvs host=anoncvs.usa.openbsd.org hostbase=/ base=/home delete
</pre>
<p>
which would mirror the cvs tree into /home/cvs with the sup data
files ending up in /home/sup.  The full OpenBSD cvs tree is just
under a gigabyte in size.

<a name="MIRROR"></a>
<h3><font color=#0000e0>Setting up an anoncvs mirror.</font></h3>

<p>
If you wish to be a new anoncvs mirror site, please contact the anoncvs
<a href=mailto:sup@openbsd.org>maintainer</a>.
Anoncvs mirrors require about 1GB of disk, and use up to 4MB of swap
per anoncvs user (assuming the user does a large operation; while smaller
operations use fewer resources, anoncvs still makes much more of an
impact than ftp or sup).  Such anoncvs machines should have excellent
network connectivity for the area they are expected to serve.  A
<a href=anoncvs.shar>document</a>
which describes the setup of anoncvs servers is available.

<h3><font color=#0000e0>Final notes:</font></h3>
After upgrading your source tree, you should read the comments
at the top of <KBD>/usr/src/Makefile</KBD> before attemping
a build.  Also, you should build a new kernel <strong>before</strong>
doing a <KBD>make build</KBD> if possible.  In some cases it may be
necessary to rebuild and install the <KBD>config</KBD> utility before
you can build the kernel.  If <KBD>config GENERIC</KBD> fails this
is probably the case.
<p>
It is important to note that upgrading from a release to the current tree
by rebuilding the sources can be rather difficult due to dependencies
that are often not obvious.  Therefore, it is suggested that you first
install the latest snapshot before attemping a tree build from source.

<hr>
<a href=index.html><img height=24 width=24 src=back.gif border=0 alt=OpenBSD></a> 
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br><small>$OpenBSD: anoncvs.html,v 1.110 2000/06/02 12:02:08 wvdputte Exp $</small>

</body>
</html>
