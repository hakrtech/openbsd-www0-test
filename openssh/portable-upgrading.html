<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict//EN">
<html>
<head>
<title>OpenSSH Portable Release for Linux/Solaris/etc</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="the OpenSSH project portable version upgrading issues page">
<meta name="keywords" content="openbsd,portable version,upgrading">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1999 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<img alt="[OpenSSH]" height=30 width=141 SRC="images/smalltitle.gif">
<p>
<h2><font color=#e00000>Portable OpenSSH - Upgrading notes</font><hr></h2>

<P>
	OpenSSH is almost completely compatible with the commercial SSH 1.2.x.
	There are, however, a few exceptions that you will need to bear in
	mind while upgrading:
</P>

<OL>
	<LI>
		OpenSSH does not support any patented transport algorithms.
		<P>
			Only 3DES and Blowfish can be selected. This difference may manifest
			itself in the ssh command refusing to read its config files.
		</P>
		</P>
			<B><I>Solution:</B></I>
			Edit <I>/etc/ssh/ssh_config</I> and select a different 
			<B>Cipher</B> option ("3des" or "blowfish").
		</P>
	</LI>
	<LI>
		Old versions of commercial SSH encrypt host keys with IDEA
		<P>
			The old versions of SSH used a patented algorithm to encrypt their
			<I>/etc/ssh/ssh_host_key</I>
		</P>
		<P>
			This problem will manifest as sshd not being able to read its host
			key.
		</P>
		<P>
			<B><I>Solution:</B></I>
			 You will need to run the <U>commercial</U> version of 
			ssh-keygen on the host's private key:
		</P>
		<P>
			<PRE>ssh-keygen -u -f /etc/ssh/ssh_host_key</PRE>
		</P>
	</LI>

	<LI>
		Incompatible changes to <I>sshd_config</I> format.
		<P>
			OpenSSH extends the <I>sshd_config</I> file format in a number of 
			ways. There is currently one change which is incompatible with the old.
		</P>
		<P>
			Commercial SSH controlled logging using the <B>QuietMode</B> and
			<B>FascistLogging</B> directives. OpenSSH introduces a more 
			general set of logging options <B>SyslogFacility</B> and 
			<B>LogLevel</B>. See the sshd manual page for details.
		</P>
	</LI>
	<LI>
		Warning messages about key lengths
		<P>
			Commercial SSH's ssh-keygen program contained a bug which caused it 
			to occasionally generate RSA keys which had their Most Significant 
			Bit (MSB) unset. Such keys were advertised as being full-length, 
			but are actually only half as secure.
		</P>
		<P>
			OpenSSH will print warning messages when it encounters such keys. To
			rid yourself of these message, edit you known_hosts files and replace
			the incorrect key length (usually "1024") with the correct key length
			(usually "1023").
		</P>
	</LI>
	<LI>
		Spurious PAM authentication messages in logfiles
		<P>
			OpenSSH will generate spurious authentication failures at every login, 
			similar to:

			<PRE>"authentication failure; (uid=0) -> root for sshd service"</PRE>

			These are generated because OpenSSH first tries to determine whether a
			user needs authentication to login (e.g. empty password). Unfortunatly
			PAM likes to log all authentication events, this one included.
		</P>
		<P>
			If it annoys you too much, set <B>PermitEmptyPasswords</B> to "no" in 
			<I>sshd_config</I>. This will quiet the error message at the expense of
			disabling logins to accounts with no password set. This is the 
			default if you use the supplied <I>sshd_config</I> file.
		</P>
	</LI>
	<LI>
		Empty passwords not allowed with PAM authentication
		<P>
			To enable empty passwords with a version of OpenSSH built with PAM you
			must add the flag <B>nullok</B> to the end of the password checking 
			module in the <I>/etc/pam.d/sshd</I> file. For example:

			<PRE>auth required/lib/security/pam_unix.so shadow nodelay nullok</PRE>

			This must be done in addtion to setting <B>PermitEmptyPasswords</B> to 
			"yes" in the <I>sshd_config</I> file.
		</P>
		<P>
			There is one caveat when using empty passwords with PAM
			authentication: PAM will allow <U>any</U> password when authenticating
			an account with an empty password. This breaks the check that sshd
			uses to determined whether an account has no password set and grant
			users access to the account regardless of the policy specified by
			<B>PermitEmptyPasswords</B>. For this reason, it is recommended that
			you do not add the <B>nullok</B> directive to your PAM configuration 
			file unless you specifically wish to allow empty passwords.
		</P>
	</LI>
	<LI>
		X11 and/or agent forwarding does not work
		<P>
			Check your <I>ssh_config</I> and <I>sshd_config</I>. The default 
			configuration files disable authentication agent and X11 forwarding.
		</P>
	</LI>
	<LI>
		ssh takes a long time to connect with Linux/glibc 2.1
		<P>
			The glibc shipped with Redhat 6.1 appears to take a long time to 
			resolve "IPv6 or IPv4" addresses from domain names. This can be 
			kludged around with the <B>--with-ipv4-default</B> configure option. 
			This instructs OpenSSH to use IPv4-only address resolution. (IPv6
			lookups may still be made by specifying the -6 option).
		</P>
	</LI>
	<LI>
		Logins from commercial ssh generate the error:
		<PRE>Selected cipher type idea not supported by server</PRE>
		<P>
			This error is generated when a commercial ssh which has been 
			configured to use the 'idea' cipher attempts to connect to an 
			OpenSSH server. To rectify this, select a different cipher in
			<I>ssh_config</I> or <I>~/.ssh/config</I> (3des for security or
			blowfish for speed).
		</P>
	</LI>
	<LI>
		can't locate module net-pf-10" messages in log under Linux
		<P>
			The Linux kernel is looking (via modprobe) for protocol family 10
			(IPv6). Either load the appropriate kernel module, enter the correct 				alias in <I>/etc/modules.conf</I> or disable IPv6 in 
			<I>/etc/modules.conf</I>.
		</P>
		<P>
			For some silly reason <I>/etc/modules.conf</I> may also be named
			<I>/etc/conf.modules</I>
		</P>
	</LI>
	<LI>
		Password authentication doesn't work on Slackware 7.0
		<P>
			Link OpenSSH with libcrypt:

			<PRE>LIBS=-lcrypt ./configure [options]</PRE>
		</P>
	</LI>
	<LI>
		configure or sshd complain about lack of RSA support
		<P>
			Ensure that your OpenSSL libraries have been built to include RSA
			support either internally or through RSAref.
		</P>
	</LI>
	<LI>
		"scp: command not found" errors
		<P>
			scp must be in the default PATH on both the client and the server. 
			You may need to use the <B>--with-default-path</B> option to specify a 
			custom path to search on the server. This option replaces the 
			default path, so you need to specify all the current directories on
			your path as well as where you have installed scp. For example: 
			<PRE>./configure --with-default-path=/bin:/usr/bin:/usr/local/bin:/path/to/scp</PRE>
		</P>
	</LI>
</UL>
<p>
<hr>
<a href=index.html><img height=24 width=24 src=back.gif border=0 alt=OpenSSH></a>
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br>
<small>$OpenBSD: portable-upgrading.html,v 1.1 2000/05/07 07:42:40 djm Exp $</small>

</body>
</html>
