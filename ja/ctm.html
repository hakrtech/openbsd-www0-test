<!DOCTYPE HTML PUBLIC  "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>CTM</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-2022-jp">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD/CTM page">
<meta name="keywords" content="openbsd,ctm">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-2004 by OpenBSD.">
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">

<center>
<img alt="CTM for OpenBSD" src="../images/bsdctm.gif" width="401" height="126">
</center>

<h3><font color="#0000e0">CTM とは ?</font></h3>

<p>
CTM は、ソースツリーへの変更を定期的に電子メールで利用できるよう、
Poul-Henning Kamp により設計されたシステムです。
モデム接続のような遅いインターネット接続を利用している場合、これは、
現在のソースツリーや CVS リポジトリを最新のものに保つ良い方法でしょう。

<p>
OpenBSD CTM は、OpenBSD の CVS リポジトリのすべてのモジュールを配布すること
ができます。また、チェックアウトされたバージョンの配布に使用することもできます。
CTM はツリーへの変更を配布するのに、非常に狭い帯域幅しか使用せず、さらに
それを <tt><b>gzip -9</b></tt> を使用して圧縮しているのです。
<a href="cvsup.html">CVSup</a> とは対照的に、CTM はプレーンな C 言語で記述
されていますので、OpenBSD がサポートするすべてのプラットフォームで利用可能です。
他のすべての OpenBSD の CVS リポジトリにアクセスする方法がプルシステム
なのに対し、CTM はプッシュシステムと呼ばれる実装となっています。

<p>
CTM に関する<b>どんな</b>問題、示唆、報告、または質問でも、 CTM 保守担当の
<a href="mailto:hgw@d1906.inka.de">Hans G&uuml;nter Weigand</a> に連絡を
取ってください。
<small>(CTM のサポートについては、他の OpenBSD の人たちには尋ねないようにしてください。
なにしろ、彼らは他のことで手いっぱいなのですから。よろしくお願いします。)</small>

<h3><font color="#0000e0">どのように動くのでしょう ?</font></h3>

<p>
CTM についての基本的な考え方は、特殊な CVS モジュールやソースツリーのための
特別なメーリングリストを講読するということです。毎日、その間にツリーに
加えられたすべての変更が含まれた電子メールを、あなたは受け取ることになるでしょう。
そのような差分のセットは<b>デルタ</b>と呼ばれています。
実際には、CTM サーバは 12 時間ごとに新しいデルタを作成しています。

<p>
ベースセットから始めますが、これに対して、後のデルタをパッチとして当てるのです。
CTM を使い始めるためには、最新のベースセットおよびその後に生成されたすべてのデルタを
ダウンロードします。一度、それらを処理すれば、メーリングリストから受け取るその後の
デルタを処理できるようになります。ベースセットは、回線状況が良くなくてもダウンロードが
容易になるよう、1400kB ずつに分割されています。

<p>
ベースセットは 50 個の相対デルタごとに生成されますので、追いかけるために 50 個以上の
相対デルタを落とす必要はありません。

<p>
現時点では、2 種類のベースセットがあります。私たちはかなりの間、
<tt><b>tar.gz</b></tt> ファイルを手動で作成していたのですが、
本当の CTM ベースデルタに戻しました。後者は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=md5&amp;sektion=1">md5(1)</a>
チェックサムを含み、これは自動生成されていますので、こちらの方が少しだけ安全でしょう。
これら 2 種類のベースセットは、そのファイル名で区別できるはずです。
たとえば、<tt><b>tar.gz</b></tt> ファイルの場合なら、
<tt><b>OpenBSD-cvs.1450.tar.gz</b></tt> となるのに対して、CTM ベースデルタなら
<tt><b>OpenBSD-cvs.1500A.gz</b></tt> となります。
詳細な取り扱い説明は以下を参照してください。

<h3><font color="#0000e0">CTM はどのくらいの帯域幅を使用するのでしょう ?</font></h3>

<p>
以下にリストされたサイトから、FTP でベースデルタおよび最近までの
すべての相対デルタを取得します。サイズは以下のとおりです。

<ul>
<li>OpenBSD-cvs の場合、およそ 215MB。
<li>OpenBSD-cvs-x11 の場合、およそ 40MB。
<li>OpenBSD-cvs-xf4 の場合、およそ 65MB。
<li>OpenBSD-src の場合、およそ 83MB。
<li>OpenBSD-src-x11 の場合、およそ 36MB。
<li>OpenBSD-ports の場合、およそ 4MB。
<br>これらが圧縮したサイズであることに注意してください。
    伸長したファイルはおよそ 5 倍ほどの大きさになります。
<li>相対デルタは 10kB から 500kB くらいまで、さらには時に数MB くらいまで
    変化することがあります。
<li>CTM は、自動的に再構成される 100kB のメイルのメッセージに、
    常にデルタを分割します。
<li>デルタが 5MB よりも大きい場合には、それはメイルでは送られません。
    その代わりに、FTP によってデルタを取得するための通知を受け取る
    ことでしょう。大きな CTM のアップデートは稀ですが、binutils、
    Perl、gcc、X などのようなもののメジャーなインポートや
    CVS リポジトリへのタグ付けの後だけに通常は起き得るものです。
</ul>

<h3><font color="#0000e0">CTM はどのように使用するのでしょう ?</font></h3>

<ul>
<li>お望みのソースセットのための CTM メーリングリストの講読。
<p>
   CTM 関連のいくつかのメーリングリストがあります。CVS リポジトリの更新の
   ためのメーリングリスト、ソースツリーのためのメーリングリスト、X11
   部分の両方のためのメーリングリストと、そして ports ツリー、さらに
   CTM のデルタ生成の際のメッセージログのためのメーリングリストです。
   <p>
   以下のコマンドで、適切なメーリングリストを講読できます。
<p>
CVS リポジトリ用 (CVSROOT、ports、src および www モジュール、
ただし、X11 と XF4 は含みません):
<pre>
	echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org
</pre>
X11 モジュールの CVS リポジトリ用:
<pre>
	echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org
</pre>
XF4 モジュールの CVS リポジトリ用:
<pre>
	echo subscribe OpenBSD-cvs-xf4 | mail majordomo@OpenBSD.org
</pre>
ソースモジュールのチェックアウトされたコピー用:
<pre>
	echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org
</pre>
X11 モジュールのチェックアウトされたコピー用:
<pre>
	echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org
</pre>
ports モジュールのチェックアウトされたコピー用:
<pre>
	echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org
</pre>
CTM のログ用:
<pre>
	echo subscribe ctm-log | mail majordomo@OpenBSD.org
</pre>

<p>
<li>パッケージか ports コレクションから CTM プログラムをインストール
します。ports は
<tt><b>/usr/ports/devel/ctm</b></tt> にあります。

</ul>
<b>注:</b> 次の例は、OpenBSD-cvs を明確にカバーしています。
その他のソースセットも同様の方法で扱われています。

<p><ul>

<li>FTP サイトからベースセットをダウンロードします。そのサブディレクトリに
<tt><b>base/OpenBSD-cvs</b></tt> があります。そのディレクトリの中のファイルを
すべてを取得します。一度、それらすべてを取得すれば、ベースセットファイルを
生成でき、そして、取得したファイルのタイプに依存しますが、以下のコマンドで
それらをアンパックできるでしょう。

<pre>
	cat split/OpenBSD-cvs.1500A.gz.* &gt; OpenBSD-cvs.1500A.gz
	cd target
	ctm -v -v -v .../OpenBSD-cvs.1500A.gz
</pre>
<p>
あるいは、

<pre>
	cat split/OpenBSD-cvs.1450.tar.gz.* &gt; OpenBSD-cvs.1450.tar.gz
	cd target
	tar -xzvf .../OpenBSD-cvs.1450.tar.gz
</pre>

<p>
ここで、<tt><b>split</b></tt> とは、ダウンロードしたファイルを置いた
ディレクトリのことであり、そして <tt><b>target</b></tt> とは、
ソースセットをアンパックする場所として選択したディレクトリのことです。

<p> もし、完全なツリーが得られたことが確認できれば、これらのベース
セットファイルを保存しておく必要はありません。が、もちろん、ベースセット
ファイルをバックアップ目的で保存しておいても良いでしょう。いずれにしても、
作業を継続する前に、ベースセットの番号をちゃんと控えておいてください。

<p>
<li>今、ベースセットから生成されたものとのデルタを取得する必要があります。
以下にリストされた FTP サーバのひとつのサブディレクトリ
<tt><b>OpenBSD-cvs</b></tt> から、使用するベースセットの番号よりも
<em>大きな</em>番号の各ファイルをダウンロードしてください。そして、
それらのデルタを以下のようにして適用します。

<pre>
	cd target
	ctm -v -v -v deltas/OpenBSD-cvs.*
</pre>

<p>
ここで、<tt><b>target</b></tt> とは、ソースセットのツリーのディレクトリ
のことであり、そして <tt><b>deltas</b></tt> とは、デルタの置かれている
ディレクトリのことです。

<p>
<li>メーリングリストからの最初のデルタが到着するのを待ちます。
<p>
<li><tt><b>ctm_rmail</b></tt> を使用して、CTM デルタをアンパック、構成し、適用します。
<p>

<pre>
	ctm_rmail -p /tmp -d deltas -b target folder
</pre>

<p>
ここで、<tt><b>folder</b></tt> とは、デルタのメールを含む
メールフォルダのことです。このコマンドが、CTM デルタをデコードし、
それを <tt><b>deltas</b></tt> ディレクトリに保存するのです。デルタは、
<tt><b>OpenBSD-cvs.<var>XXXX</var>.gz</b></tt> という形態の
ファイルであり、ここで <var>XXXX</var> とは、デルタの番号のことです。
そして、そのデルタを、ベースセットをアンパックした
<tt><b>target</b></tt> の場所にあるディレクトリツリーに適用します。

<p>
メーリングリストからデルタを受け取るごとに、この最後のステップを
繰り返します。お好み次第で、procmail、maildrop、あるいは他の同様の
<a href="ports.html">ports コレクション</a> のプログラムを使用して、
このステップを自動化することも可能です。
</ul>

<p>
以下は、CTM デルタを取得可能な FTP サーバのリストです。

<ul>
<li>プライマリ FTP サーバ:
<p>
<a href="ftp://togetic.kd85.com:/pub/OpenBSD-ctm/">
     ftp://togetic.kd85.com:/pub/OpenBSD-ctm/
</a>
<p>
このサーバは、CTM デルタ生成プロセスによって、自動的にアップデートされています。
ベースセットは、
<tt><b>base</b></tt> ディレクトリの下のひとつの大きなファイルとして存在
しており、分割ファイルは <tt><b>base-split</b></tt> ディレクトリの下にあります。
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
このサーバは、メーリングリストからの CTM デルタによってアップデートされています。
このサーバは、<tt><b>base</b></tt> サブディレクトリの下に、
<a href="ftp://togetic.kd85.com:/pub/OpenBSD-ctm/">
     ftp://togetic.kd85.com:/pub/OpenBSD-ctm/
</a>
をミラーした、分割ベースデルタを付加的に持っています。
</ul>

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
は、
<p>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
と同じサーバであり、そして、
<a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org
</a>
のミラーとなっています。
</ul>

<p>
<b>注:</b> <a href="mailto:hgw@d1906.inka.de">私</a>は
      これらのデルタをミラーしてくれる、世界中のサイトを
      大変な関心を持って探しています。
<p>

<h3><font color="#0000e0">ソースツリーと CVS リポジトリ、どちらを選ぶべきでしょう ?</font></h3>

<p>
他の要素の中でも、これに関しては、あなたのディスクスペースに依存します。
CTM はローカルに変更されたファイルをほとんど反映することができないので、
より良い選択となるのは確実に <a href="anoncvs.html">CVS</a> リポジトリ
の方でしょう。自分の CVS リポジトリから、ソースツリーの作業用コピーを
チェックアウトもできますし、安定版のブランチを追いかけることもできますし、
自分のローカルな変更を自分のソースツリー中でキープすることもできるのです。
CVS は、あなたのローカルな変更をマージできるくらい良くできたものです。
さらに、あなたは、<tt><b>cvs commit</b></tt> や <tt><b>cvs tag</b></tt>
のようなコマンドを除いた、すべての範囲の CVS コマンドを利用可能でもあるのです。

<p>
しかしながら、欠点としては、それが必要とするディスクスペースの量があるでしょう。
チェックアウトされたソースツリーは約 370MB 程度を必要としますが、あなたは
自分自身の CVS リポジトリを持っているとして、そのために 1GB 以上も必要と
なり、<b>それに加えて</b> 370MB がチェックアウトしたツリー用に必要となります。
この中には、たとえば、ソースのコンパイルなどの、ビルド中に生成されるファイル
のために必要な (アーキテクチャに依存する) 100MB 以上の領域は含まれていないのです。

<p>
もし、ソースツリーを得られたなら、ローカルな変更を反映する必要があるでしょう。
これを行うためのひとつの方法としては、<b>union</b> ファイルシステムがあります
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&amp;sektion=8">mount_union(8)</a>
を参照)。しかし、上層および下層の両方が、同じ物理的ファイルシステム上にある
場合、<b>union</b> ファイルシステムは不安定であるとのレポートも出されています。
もし、上層と下層を別々のファイルシステムに配置できるのであれば、特に問題は
ないでしょう。これについての例は次のとおりです。

<p>
CTM で更新されたツリーが <tt><b>/usr/src-ctm</b></tt> にあり、そして、
自分自身で変更を加え、そこでビルドされる実際のソースツリーが
<tt><b>/usr/src</b></tt> にあると仮定します。
<tt><b>/usr/src</b></tt> は初期状態では空のディレクトリであるべきです。
次のコマンドで、union マウントをセットアップできるでしょう。

<pre>
	mount -t union -o -b /usr/src-ctm /usr/src
</pre>

<p>
<tt><b>/usr/src</b></tt> 中のファイルに加えられた変更は、
<tt><b>src-ctm</b></tt> 中のファイルを隠して、<tt><b>/usr/src</b></tt> 中に
含まれるファイルになるでしょう。もし、<tt><b>src-ctm</b></tt> のツリー下の
ファイルに CTM 経由でこのような変更が加えられても、上層のファイルが下層を
隠すかのように、これらの変更が見える<b>わけではありません</b>。

<p>
定期的に union をアンマウントして、
ローカルから union ファイルシステムに移ったファイルをサーチすべきでしょう。

<pre>
	umount /usr/src
	find /usr/src -type f
</pre>

<p>
コマンド <tt><b>ls -W</b></tt> および <tt><b>rm -W</b></tt> も、
<tt><b>/usr/src</b></tt> の中の "whiteouts" という名前のオブジェクトが
<tt><b>src-ctm</b></tt> のファイルを隠すでしょうから、役に立つことでしょう。

<p>
CVS リポジトリを入手したら、そこからソースツリーをチェックアウトするのに、
<tt><b>cvs checkout</b></tt> コマンドを使用することができます。
毎回、CTM での更新時に、ソースリポジトリを更新するのに、
<tt><b>cvs update</b></tt> コマンドを使用することができます。

<p>
初期状態の src リポジトリを得るには、
<pre>
	cd /usr
	cvs -qd YOUR_CVS_REPOSITORY checkout -P src
</pre>
<p>
として、それぞれの CTM の更新後、以下のコマンドを実行します。
<pre>
	cd /usr/src
	cvs -q update -Pd
</pre>

<h3><font color="#0000e0">OpenBSD の CTM はどの程度安定しているのでしょう ?</font></h3>

CTM は 5 年以上も OpenBSD で使用されてきており、また、FreeBSD では
さらに長い期間使用されてきました。CTM は非常に信頼性があり、安定しています。

<h3><font color="#0000e0">CTM を維持するために何が行われているのでしょう ?</font></h3>

数々の (小さな) 変更と最適化が可能です。
それらの中で、

<ul>
<li> CTM は 5MB 以上のデルタを決してメールでは送信しません。これについては、
     二種類の変更が可能で、デルタの最大サイズを増加させることもできますし、
     または、決まった数のメールを毎日送信するためだけのキューを
     インストールすることもできます。たとえば、デルタが 6MB の大きさの
     場合、これは 96 個のメールメッセージに分割されます。そして、それらは、
     キューに入れられます。初日は最初の 50 個のメッセージを送信し、
     二日目には残りの 46 個に加えて、次のデルタの最初の 4 メッセージ
     を送信します。
<li> CTM ソフトウェアは書き換えたり、または、少なくとも、より良い方法で
     フィックスすることもできます。その C 言語の実装は、良いプログラミング
     の見本ではありません。しかし、また、それは、PGP による CTM デルタへの署名
     のような新機能を追加するための良い目的ともなるでしょう。
</ul>

あなたの御意見・御希望は、<a href="mailto:hgw@d1906.inka.de">私</a>にメールしてください !

<h3><font color="#0000e0">さらなる情報</font></h3>

もし、CTM についてさらに知りたい場合には、それを始める良い場所として、
FreeBSD ハンドブックがあります。

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">
         http://www.FreeBSD.org/handbook/ctm.html
     </a>
</ul>

また、すべての CTM ユーティリティのためのマニュアルページもあります。

<h3><font color="#0000e0">要約:</font></h3>

<p>
<ul>
<li> メーリングリスト:

   <ul>
   <li><tt>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-cvs-xf4 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe ctm-log | mail majordomo@OpenBSD.org</tt>
   </ul>
<p>
<li> FTP (ベースセットとそれに関連するデルタ用):

   <ul>
   <li> <a href="ftp://togetic.kd85.com:/pub/OpenBSD-ctm/">
        ftp://togetic.kd85.com:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
        ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
        ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
        ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/</a>
   </ul>
</ul>

<p>
CTM に関する重要な注意事項とアナウンスは、announce@OpenBSD.org
メーリングリストに投稿されるでしょう。

<p>

<h3><font color="#0000e0">謝辞</font></h3>

<ul>
<li> Poul-Henning Kamp (phk@FreeBSD.org) は、CTM を使用可能なものにし、
     デルタの生成できるようにするのを助けてくれました。

<li> Theo de Raadt (deraadt@theos.com) は、OpenBSD を使用可能なものにし、
     (現在は別のところで生成されていますが) cvs.OpenBSD.org 上で CTM デルタ
     を生成するのに必要なリソースを最初に提供してくれ、そして、
     ネームサーバのマジックも提供してくれました。

<li> Todd C. Miller (millert@OpenBSD.org) は、CTM メーリングリストを
     セットアップし、メンテナンスしてくれています。

<li> Bob Beck (beck@OpenBSD.org)、Artur Grabowski (art@OpenBSD.org)、
     Magnus Holmberg (mho@OpenBSD.org) と
     Wolfram Schneider (wosch@FreeBSD.org) は、ctm.*OpenBSD.org 上の
     ベースセットとデルタ用に ftp 用の領域をセットアップしてくれました。

<li> Thomas Graichen (graichen@OpenBSD.org) は、OpenBSD のための CTM 
     をスタートし、それをずっとメンテナンスしてくれています。

<li> Wim Vandeputte (wvdputte@OpenBSD.org) は、現在 CTM をホスティングしてくれています。

<li> ... そして、間接的に寄与してくれた、他のすべての人々
</ul>


<p>
OpenBSD プロジェクトのための OpenBSD/CTM のロゴは、
   <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a> によってデザインされました。
<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD" /></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>

<br>
<small>
<!-- 
Originally [OpenBSD: ctm.html,v 1.28 ]
$Translation: ctm.html,v 1.10 2005/08/15 08:51:00 tueda Exp $
-->
$OpenBSD: ctm.html,v 1.11 2005/08/15 20:46:06 saad Exp $
<br>
</small>

</body>
</html>
