<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
 <head>
  <meta http-equiv="Content-Type"
        content="text/html; charset=iso-8859-2">
  <meta name="resource-type"
        content="document">
  <meta name="description"
        CONTENT="How to make an OpenBSD port">
  <meta name="keywords"
        content="openbsd,ports">
  <meta name="distribution"
        content="global">
  <meta name="copyright"
        content="This document copyright 1997-2004 by OpenBSD.">
  <title>Budowanie portów na OpenBSD</title>
  <link rev="made" HREF="mailto:www@openbsd.org">
 </head>
 <body text="#000000" bgcolor="#FFFFFF" link="#23238E">
<a href="index.html"><img alt="[OpenBSD]" height="30" width="141" src="../images/smalltitle.gif" border="0"></a>

  <h2><font color="#e00000">Budowanie portów na OpenBSD</font></h2>

   Wiêc w³a¶nie skompilowa³e¶ swój ulubiony pakiet oprogramowania na maszynie
   z OpenBSD i chcesz podzieliæ siê swoim wysi³kiem poprzez przekszta³cenie
   go w standardowy port. Co zrobiæ?
  <p>
   Najwa¿niejsz± rzecz±, któr± mo¿esz zrobiæ jest <strong>komunikacja</strong>.
   Zapytaj ludzi na <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>,
   czy kto¶ nie pracuje ju¿ nad tym portem. <em>Poinformuj o tym oryginalnego
   autora</em>, w³±czaj±c informacje, o problemach, które mog³e¶ znale¼æ.
   Je¶li informacja o licencji wydaje siê niew³a¶ciwa, powiedz mu o tym.
   Je¶li musia³e¶ pokonywaæ z³o¿one problemy, aby zbudowaæ port, powiedz
   mu, co mo¿e poprawiæ. Je¶li s± zainteresowani jedynie programowaniem na
   Linuksa i nie interesuj± siê reszt± ¶wiata Uniksa, postaraj siê zmieniæ
   ich zdanie.
  <p>
   <strong>KOMUNIKACJA</strong> odró¿nia udany port, od portu, który bêdzie
   wkrótce porzucony przez wszystkich.
  <p>
   Przede wszystkim, zapoznaj siê z informacjami na temat portowania na tej stronie.
   Nastêpnie zobacz dokumenty nawi±zuj±ce do tego tematu, zw³aszcza
   <a href="../checklist.html">Listê rzeczy do sprawdzenia podczas portowania na OpenBSD</a>.
  <p>
   Testuj, ponownie testuj, i jeszcze raz testuj!
  <p>
   Przedstaw port. Stwórz paczkê "gzipped tarball" katalogu portu.
   Mo¿esz wtedy umie¶ciæ go na publicznym serwerze FTP lub HTTP,
   wysy³aj±c adres paczki na <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>
   lub wysy³aj±c j± w za³±czniku na ten sam adres. Wybierz metode, która Ci
   najbardziej odpowiada.

<h3><font color="#0000e0">Spis dokumentacji portowania</font></h3>
<ul>
<li><a href="#Avail">Dostêpne informacje na temat portowania</a></li>
<li><a href="#Policy">Polityka portowania na OpenBSD</a></li>
<li><a href="#Security">Zalecenia zwi±zane z bezpieczeñstwem</a></li>
<li><a href="#Generic">Ogólne wskazówki portowania</a></li>
<li><a href="#Other">Inne pomocne wskazówki</a></li>
</ul>

  <h3><font color="#0000e0"><a name="Avail">Dostêpne informacje na temat portowania</a></font></h3>
  <ul>
   <li><a href="../checklist.html">Lista rzeczy do sprawdzenia podczas portowania na OpenBSD</a>.
   <li>Stronê podrêcznika man 
   <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bsd.port.mk&amp;sektion=5">bsd.port.mk(5)</a>.
       Dokumentuje ona infrastrukture makefile, która jest w³±czana na koñcu
	   ka¿dego pojedyñczego pliku makefile portów.
	   Wci±¿ istnieje kilka komentarzy na pocz±tku samego pliku, ale wiêkszo¶æ 
	   u¿ytecznych informacji jest ju¿ udokumentowana.
   <li>Nieliczne ró¿nice w stosunku do systemów portów innych BSD, s± w wiêkszo¶ci
   podsumowaniem <a href="../porting/diffs.html">ró¿nic infrastruktur</a>.
   <li><a href="../porting/libraries.html">Wykorzystanie bibliotek wspó³dzielonych
   w portach na OpenBSD</a>. Regu³y, które istniej±, s± <strong>niezwykle
   istotne</strong>, gdy u¿ywasz dzielonych bibliotek.
   <li><a href="../porting/autoconf.html">Specyfika GNU autoconf</a>,
   jak radziæ sobie z nim± w kontek¶cie portów OpenBSD.
   <li><a href="../porting/config.html">Pliki konfiguracyjne</a>,
   jedna z trudno¶ci z na jakie natrafiaj± nowi developerzy, spowodowne
   wyj±tkowymi narzêdzia jakie porty OpenBSD wykorzystuj± do ich
   poprawnej obs³ugi.
   <li><a href="../audio-port.html">Przenoszenie oprogramowania audio do systemu OpenBSD</a>.
   <li>Dokumentacja
       <a href="http://www.netbsd.org/Documentation/software/packages.html">
       Systemu pakietów NetBSD</a>. Dokument ten opisuje wersje NetBSD
	   systemu portów wprowadzonego przez FreeBSD, i jest bardzo pomocny.
   <li>
       <a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/porters-handbook/index.html">FreeBSD
       Porter's Handbook</a>. Biblia portowania w FreeBSD.
   <li>Lista mailingowa portów OpenBSD,
       <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>.
  </ul>
  <h3><font color="#0000e0"><a name="Policy">Polityka portowania na OpenBSD</a></font></h3>
  <ul>
   <li>OpenBSD NIE u¿ywa <code>/usr/local/etc/rc.d</code>.<br>
       <code>/usr/local</code> jest czêsto wspó³dzielone przez kilka maszyn 
         poprzez NFS. Z tego powodu, pliki konfiguracyjne, które s± specyficzne
		 dla danej maszyny nie mog± byæ przechowywane w <code>/usr/local</code>,
         <code>/etc</code> jest centralnym repozytorium zale¿nych od indywidualnej
		 maszyny plików konfiguracyjnych. Ponadto, zgodnie z polityk± OpenBSD,
		 pliki w <code>/etc</code> nie s± nigdy uaktualniane automatycznie.
		 Porty, które wymagaj± jakich¶ specyficznych ustawieñ do odpalenia
		 powinny uprzedziæ o tym administratora, aby wykona³ je samodzielnie,
		 zamiast ¶lepo instalowaæ pliki.
   <li>OpenBSD NIE kompresuje stron podrêcznika man.
   <li>OpenBSD NIE wymaga <code>-lcrypt</code>.<br>
       Szyfrowanie DES jest czê¶ci± standardowego <code>libc</code>.
   <li>OpenBSD posiada oddzieln± przestrzeñ nazw (ang. namespace) dla u¿ytkowników i
       grup utworzonych przez porty.
       Wiêcej szczegó³ów w <code>/usr/ports/infrastructure/db/user.list</code>.
   <li>OpenBSD jest mocno zaorientowane na bezpieczeñstwo. Powiniene¶ przeczytaæ
       i zrozumieæ <a href="#Security">sekcje bezpieczeñstwa</a> na tej stronie.
   <li>Upewnij siê o dodaniu taga CVS <code>&#36;OpenBSD&#36;</code> do
       Makefile. Je¶li importujesz port z innego systemu, upewnij siê o
       pozostawieniu tak¿e ich taga w Makefile.
   <li>Celem jest uzyskanie wspierania portowanych aplikacji dla OpenBSD. Aby
       to osi±gn±æ, <strong>musisz</strong> przes³aæ wszystkie patch'e OpenBSD 
       spowrotem do twórcy danej aplikacji.
  </ul>
  <h3><font color="#0000e0"><a name="Security">Zalecenia zwi±zane z bezpieczeñstwem</a></font></h3>
       Jest wiele problemów zwi±zanych z bezpieczeñstwem, o które nale¿y siê zatroszczyæ.
	   Je¶li nie jeste¶ absolutnie pewien co robisz, proszê zwróæ siê o pomoc
	   na li¶cie mailingowej <a href="mailto:ports@openbsd.org">ports</a>.

  <ul>
   <li><em>Nie</em> u¿ywaj kodu alpha lub beta podczas przygotowywania portu.
       U¿ywaj najnowszego, regularnego lub zpatch'owanego, wydania.

   <li>Ka¿de oprogramowanie, które ma byæ zainstalowane jako serwer powinno byæ
       przeskanowane pod k±tem przepe³nieñ buforów (buffer overflows),
	   zw³aszcza niebezpieczne jest u¿ywanie <code>strcat/strcpy/strcmp/sprintf</code>.
	   Ogólnie, <code>sprintf</code> powinno byæ zast±pione przez
	   <code>snprintf</code>.

   <li>Nigdy nie u¿ywaj nazw plików zamiast prawdziwych zabezpieczeñ. Istniej±
       liczne sytuacje wy¶cigów (race conditions), gdzie nie masz wystarczaj±cej
	   kontroli. Na przyk³ad, atakuj±cy, który ma ju¿ uprawnienia u¿ytkownika
	   na twoich maszynach mo¿e podmieniæ pliki w <code>/tmp</code> na
	   symboliczne dowi±zania dla bardziej znacz±cych plików, takich jak
       <code>/etc/master.passwd</code>.  

   <li>Dla przyk³adu, obie funkcje <code>fopen</code> i <code>freopen</code>
       <strong>tworz± nowy plik lub otwieraj± ju¿ istniej±cy</strong> do
       zapisu. Atakuj±cy mo¿e utworzyæ symboliczne dowi±zanie z
       <code>/etc/master.passwd</code> do <code>/tmp/addrpool_dump</code>. W
       momencie, gdy go otworzysz, twój plik z has³ami jest wydany. Tak, nawet
       mimo <code>unlink</code> tu¿ przed operacj±. Zmniejsza to jedynie nieco
	   szanse. U¿ywaj zamiast tego <code>open</code> z flag±
       <code>O_CREAT|O_EXCL</code> i <code>fdopen</code>.
                 
   <li>Innym, bardzo powszechnym problemem jest funkcja <code>mktemp</code>.
       Zwróæ uwagê na ostrze¿enia konsolidatora (linker) bsd, na temat jej
	   u¿ycia. <strong>Musi to byæ naprawione</strong>.
	   Nie jest to kwestia jedynie <code>s/mktemp/mkstemp/g</code>.  <br>
	   Odnie¶ siê do strony podrêcznika man <code>mktemp(3)</code> z najnowszego
	   OpenBSD po wiêcej wskazówek.
       Popraw kod u¿ywaj±c <code>mkstemp</code>, dotyczy to ¼róde³ miêdzy innymi
       <code>ed</code> czy <code>mail</code>.
       Rzadkim wypadkiem jest kod prawid³owo korzystaj±cy z <code>mktemp</code>;
       mo¿na spotkaæ siê z tym w porcie <code>rsync</code>.

   <li>Sama mo¿liwo¶æ czytania (read) nie oznacza, ¿e powiniene¶ j± wykorzystywaæ.
       Dobrze znan± dziur± tej natury jest problem z <code>startx</code>.
	   Jako program uprzywilejowany (setuid), móg³by¶ wywo³aæ startx z jakimkolwiek
	   plikiem, jako skryptem. Je¶li plik ten nie by³ poprawnym plikiem skryptu
	   pow³oki, wypisany zosta³by komunikat o b³êdzie sk³adni razem z pierwsz±
	   lini± niepoprawnego pliku i bez jakichkolwiek dalszych sprawdzeñ uprawnieñ.
	   Do¶æ porêczne, aby pobraæ pierwsz± linie zaszyfrowanego pliku hase³,
	   a który czêsto zaczyna siê od wpisu dla u¿ytkownika root. Nie otwieraj
	   swojego pliku, a nastêpnie u¿ywaj <code>fstat</code> na otwartym
	   deskryptorze, aby sprawdziæ, czy rzeczywi¶cie powiniene¶ byæ zdolnym
	   do jego otwarcia (albo atakuj±cy przy pomocy /dev/rst0 przewinie go)
	   -- otwieraj go tylko dla w³a¶ciwych uid/gid/zestawów grup.

   <li>Nie u¿ywaj niczego, co tworzy kopie pow³oki (forks a shell) w programach
	   uprzywilejowanych (setuid), przed zrzuceniem uprawnieñ. Dotyczy to
	   m.in <code>popen</code> i <code>system</code>. U¿ywaj zamiast tego
	   <code>fork</code>, <code>pipe</code> i <code>execve</code>.

   <li>Przekazuj do innych plików otwarte deskryptory, zamiast nazw plików, aby
	   unikn±æ sytuacji wy¶cigów. Nawet, je¶li jaki¶ program nie przyjmuje
	   deskryptorów, wci±¿ mo¿esz u¿yæ <code>/dev/fd/0</code>.

   <li>Prawa dostêpu s± zwi±zane z deskryptorem pliku. Gdy potrzebujesz
	   praw u¿ytkownika uprzywilejowanego (setuid) do otwarcia pliku, otwórz go,
	   a nastêpnie zrzuæ uprawnienia. Nadal bêdziesz mia³ dostêp do tego
	   otwartego deskryptora, ale bêdziesz ju¿ mia³ mniej powodów do zmartwieñ.
	   Ma to jednak i drug± stronê: nawet po zrzuceniu uprawnieñ, wci±¿
	   powiniene¶ uwa¿aæ na te deskryptory.

   <li>Unikaj programów uprzywilejowanych (root setuid) jak tylko mo¿esz.
	   W skrócie, u¿ytkownik root mo¿e wszystko, ale uprawnienia root'a s±
	   bardzo rzadko niezbêdne, mo¿e poza tworzeniem gniazd na portach o
	   numerach ni¿szych ni¿ 1024. Jest kwesti± sporn±, czy nie lepiej
	   jest uruchamiaæ takie programy sieciowe pod kontrol± <code>inetd</code>
	   i po prostu dodaæ odpowiednie wpisy w <code>inetd.conf</code>.
	   Musisz znaæ sztukê pisania demonów (daemons), aby to osi±gn±æ w inny
	   sposób. Mo¿na powiedzieæ, ¿e nie powiniene¶ pisaæ programów
	   uprzywilejowanych (setuid), je¶li nie wiesz jak to robiæ.

   <li>U¿ywaj setgid zamiast setuid. Poza specyficznymi plikami wymaganymi przez
	   programy z setgid, wiêkszo¶æ plików nie ma praw do zapisu przez grupê.
	   St±d, problemy z bezpieczeñstwem w programach z setgid nie bêd± stanowi³y
	   takiego zagro¿enia dla systemu: z uprawnieniami jedynie grupy, w
	   najgorszym przypadku intruz bêdzie móg³ zmieniæ punktacje w jakiej¶
	   grze lub tym podobne.
	   Zobacz port <code>xkobo</code> dla przyk³adu takiej zmiany.

   <li>Nie ufaj plikom z prawami zapisu przez grupê. Nawet, je¶li s± one
	   szczegó³owo analizowane (audited), programy z setgid nie s± jednak
	   postrzegane jako istotne potencjalne ¼ród³o dziur w zabezpieczeniach.
	   St±d rzeczy, które mog± naruszaæ, nie powinny byæ uznawane za wra¿liwe
	   informacje.

   <li>Nie ufaj swojemu ¶rodowisku systemowemu! Dotyczy to prostych rzeczy,
	   takich jak twoja ¶cie¿ka <code>PATH</code> (nigdy nie u¿ywaj
	   <code>system</code> z nie pe³n± ¶cie¿k±, unikaj <code>execvp</code>),
	   ale i bardziej subtelnych rzeczy jak twoje locale, timezone, termcap,
	   i tak dalej. 
	   Wystrzegaj siê po¶rednio¶ci: nawet, je¶li rozwa¿asz wszystkie za³o¿enia,
	   programy wywo³ywane bezpo¶rednio nie musz± tego koniecznie wymagaæ.
	   <strong>Nigdy</strong> nie u¿ywaj funkcji <code>system</code> w
	   uprzywilejowanych programach, zbuduj swoj± liniê poleceñ, kontrolowane
	   ¶rodowisko pracy, i wywo³aj bezpo¶rednio <code>execve</code>.
	   Strona podrêcznika man <code>perlsec</code> jest dobrym przewodnikiem
	   na temat takich problemów.

   <li>Nigdy nie u¿ywaj skryptów pow³oki z setuid. Charakteryzuj± siê one brakiem
	   odpowiedniego bezpieczeñstwa. Opakuj je w jaki¶ kod C zapewniaj±cy
	   w³a¶ciwe ¶rodowisko systemowe. Z drugiej strony, OpenBSD dostarcza
	   mo¿liwo¶ci wykorzystywania bezpiecznych skryptów perl.

   <li>Uwaga na program dynamicznego ³adowania (the dynamic loader).
       Je¶li uruchamiasz program setuid, bêdzie one u¿ywa³ jedynie zaufanych
	   bibliotek, które by³y przeskanowane przez ldconfig.
	   Setgid to za ma³o.

   <li>Dynamiczne biblioteki s± zawi³e. Kod C++ powoduje podobne problemy.
	   Przede wszystkim, biblioteki mog± podejmowaæ pewne decyzje na podstawie
	   twoich ustawieñ ¶rodowiska systemowego nawet jeszcze zanim zostanie
	   sprawdzony status setuid. Z punktu widzenia twórcy bibliotek problem
	   ten dotyczy <code>issetugid</code> w OpenBSD. Nie próbuj przenosiæ (to
	   port) bibliotek, je¶li nie rozumiesz ca³kowicie natury problemu.
  </ul>
  <h3><font color="#0000e0"><a name="Generic">Ogólne wskazówki portowania</a></font></h3>
  <ul>
   <li><code>__OpenBSD__</code> powinno byæ u¿ywane oszczêdnie, je¶li w ogóle.
       Konstrukcje, które wygl±daj± jak ta
       <pre>
            #if defined(__NetBSD__) || defined(__FreeBSD__)
       </pre>
       s± czêsto niew³a¶ciwe. Nie dodawaj na ¶lepo <code>__OpenBSD__</code>
       do nich. Zamiast tego, postaraj siê zrozumieæ co siê dzieje i jaka w³a¶ciwie
       funkcja jest wymagana. Strony podrêcznika man s± czêsto pomocne,
       poniewa¿ zawieraj± wiele historycznych komentarzy, ³±cznie z informacj±,
       kiedy konkretna funkcja zosta³a wprowadzona w BSD.
       Porównywanie numerycznej warto¶ci <code>BSD</code> ze znanymi
       wydaniami jest czêsto w³a¶ciw± drog±. Zobacz 
       <a href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/Packages.txt">przewodnik pakietów NetBSD</a>
       w celu uzyskania wiêkszej ilo¶ci informacji.
   <li>Definiowanie <code>BSD</code> jest z³ym pomys³em. Postaraj siê do³±czyæ <code>sys/param.h</code>.
       Definiuje on nie tylko <code>BSD</code>, ale i nadaje mu w³a¶ciw± warto¶æ.
       W³a¶ciwy fragment kody powinien powinien wygl±daæ jak:
       <pre>
           #if (defined(__unix__) || defined(unix)) &amp;&amp; !defined(USG)
           #include &lt;sys/param.h&gt;
           #endif
       </pre>
   <li>Testuj pod k±tem funkcji, nie specyficznych systemów operacyjnych.
       Na d³u¿sz± metê, jest du¿o lepiej sprawdzaæ, czy <code>tcgetattr</code>
       po prostu dzia³a, bez rozró¿nienia, czy jest ona wywo³ywana na BSD 4.3
       lub pó¼niejszym, czy SystemVR4. Tego typu testy wprowadzaj± tylko
       w±tpliwo¶ci. W³a¶ciw± drog± jest natomiast sprawdzanie, czy konkretny
       system definiuje <code>HAVE_TCGETATTR</code>, a nastêpnie przej¶cie do
       nastêpnego systemu. Technika ta oddziela testowanie funkcji dla
       specyficznego systemu operacyjnego. W po¶piechu, inna osoba portuj±ca
       mo¿e po prostu dodaæ ca³y zestaw definicji <code>-DHAVE_XXX</code> do
       pliku Makefile. Mo¿na tak¿e napisaæ lub dodaæ skrypt "configure", aby
       sprawdzaæ t± funkcje i dodawaæ j± automatycznie. Jako negatywny przyk³ad
       przegl±dnij ¼ród³a nethack 3.2.2: zak³ada siê tam ³adowanie rzeczy na
       podstawie typu systemu operacyjnego. Wiêkszo¶æ tych za³o¿eñ jest
       przestarza³a i nie odzwierciedla rzeczywisto¶ci: funkcje POSIX s±
       bardziej przydatne ni¿ stare BSD vs. SystemV rozró¿nienia, albowiem
       obecnie niektóre tradycyjne funkcje bsd s± wspierane jedynie poprzez
       biblioteki kompatybilno¶ci.

   <li>Unikaj do³±czania (include) plików, które do³±czaj± inne pliki, które...
       Przede wszystkim poniewa¿ jest to niewydajne. Twój projekt ostatecznie
       skoñczy za³±czaj±c plik, który za³±cza wszystko. A tak¿e, poniewa¿
       powoduje to, ¿e pewne problemy s± trudne do naprawienia. Trudniejsze
       staje siê <em>nie</em> za³±czanie pojedynczego pliku w danym punkcie.

   <li>Unikaj dziwnych trików z makrami. Oddefiniowywanie (undefining) makra,
       które by³o zdefiniowane przez plik nag³ówkowy jest z³ym pomys³em.
       Definiowanie makra, aby uzyskaæ konkretne zachowanie siê plików
       nag³ówkowych jest tak¿e z³ym pomys³em: tryby kompilacji powinny byæ
       globalne. Powiedzmy, ¿e po¿±dasz zachowania POSIX za³±czanego pliku
       nag³ówkowego, wiêc definiujesz
       <code>#define POSIX_C_SOURCE</code>
       w ca³ym projekcie, a nie kiedy ci siê podoba.

   <li>Nigdy nie pisz prototypów funkcji systemowych. Wszystkie nowoczesne systemy, 
       w³±czaj±c OpenBSD, maj± standardowe lokalizacje dla tych prototypów. Zwykle
       s± to <code>unistd.h</code>, <code>fcntl.h</code> lub 
       <code>termios.h</code>.
       Odpowiednia strona podrêcznika systemowego man okre¶la, gdzie dany
       prototyp mo¿e byæ odnaleziony.
       Mo¿esz potrzebowaæ kolejnych makr <code>HAVE_XXX</code>, aby otrzymaæ
       w³a¶ciwy plik. Nie martw siê w³±czaniem tego samego pliku dwukrotnie,
       pliki nag³ówkowe maj± blokady zapobiegaj±ce takim wypadkom.<br>
       Je¶li jaki¶ niepoprawny system wymaga od ciebie napisania prototypu,
       nie narzucaj tego na wszystkich pozosta³ych systemach. Twoje w³asne
       prototypy bêd± sprawia³y problem, poniewa¿ mog± u¿ywaæ typów, które s±
       poprawne na twoim systemie, ale nie s± poprawne na innych
       (<code>unsigned long</code> zamiast <code>size_t</code>), lub maj±
       jaki¶ z³y status <code>const</code>. Poza tym, niektóre kompilatory,
       jak w³asne gcc OpenBSD, mog± znacznie lepiej wykonywaæ swoj± prace
       na wielu czêsto spotykanych funkcjach, jak np <code>strlen</code>,
       je¶li za³±czysz odpowiednie pliki nag³ówkowe.

   <li>Nie u¿ywaj nazw standardowych funkcji systemowej do niczego innego.
       Je¶li chcesz napisaæ swoj± w³asn± funkcje, nadaj jej w³asn± nazwê
       i u¿ywaj jej wszêdzie. Je¶li bêdziesz chcia³ powróciæ do domy¶lnej
       funkcji systemowej, po prostu wstaw kod do komentarzy, i podaj
       w³asn± nazwê funkcji systemowej. Nie rób tego w inny sposób.
       Kod powinien wygl±daæ w nastêpuj±cy sposób:
<pre>
       /* czesc prototypowa */
       #ifdef USE_OWN_GCVT
       char *foo_gcvt(double number, size_t ndigit, char *buf);
       #else
       /* zalacz odpowiedni plik */
       #include &lt;stdlib.h&gt;
       /* uzyj funkcji systemowej */
       #define foo_gcvt  gcvt
       #endif

       /* czesc definiujaca */
       #ifdef USE_OWN_GCVT
       char *foo_gcvt(double number, size_t ndigit, char *buf)
          {
          /* wlasciwa definicja */
          }

       /* typowe uzycie */
       s = foo_gcvt(n, 15, b);
       </pre>
  </ul>
  <h3><font color="#0000e0"><a name="Other">Inne pomocne wskazówki</a></font></h3>
  <ul>
   <li>Najnowsze wersje <code>bsd.port.mk</code> ustalaj± ¶cie¿ki (path) instalacji.
       Zw³aszcza ustalaj±, ¿e <code>/usr/bin</code> i
       <code>/bin</code> s± przeszukiwane <em>przed</em>
       <code>/usr/local/bin</code> i <code>/usr/X11R6/bin</code>.
   <li><em>NIE</em> generuj bibliotek wspó³dzielonych, je¶li
       <code>${NO_SHARED_LIBS}</code> ma warto¶æ 'yes' (uwaga, mo¿e to byæ
       zdefiniowane jedynie po za³±czeniu <code>bsd.port.mk</code>). Je¶li
       twój port ma GNU configure, po prostu dodaj linie
       <code>CONFIGURE_ARGS += ${CONFIGURE_SHARED}</code> do pliku Makefile.
   <li>W porz±dku jest opieraæ siê na funkcjach, które pojawi³y siê najnowszych
       wersjach <code>bsd.port.mk</code>, albowiem u¿ytkownicy powinni uaktualniaæ
       ca³e swoje drzewo portów, w³±czaj±c <code>bsd.port.mk</code>.
       NEED_VERSION jest obecnie prze¿ytkiem.
   <li>Preferuj <code>update-plist</code> przy generacji i aktualizacji list
 	zawarto¶ci paczki zamiast wykonywaæ te czynno¶ci rêcznie.
 	Mo¿esz zakomentowaæ niechciane linie.
 	<code>update-plist</code> potrafi wykryæ wiêkszo¶æ typów plików oraz do³±czyæ
 	dodatkowe wpisy poprawnie.
   <li>W OpenBSD <code>curses.h/libcurses/libtermlib</code> s±
       ``nowym curses''. Zmieñ:<br>
       <code>ncurses.h ==&gt; curses.h</code><br>
       ``stare (BSD) curses'' jest dostêpne poprzez zdefiniowanie 
       <code>_USE_OLD_CURSES_</code>
       przed za³±czeniem <code>curses.h</code> (zwykle w pliku Makefile) oraz
       konsolidowaniu (linking) z <code>-locurses</code>.
   <li>W OpenBSD, dyscyplina terminali zosta³a zaktualizowana z starszej BSD
       <code>sgtty</code> do nowszej (POSIX) rodziny <code>tcgetattr</code>.
       Unikaj starego stylu w nowym kodzie. Czê¶æ kodów mo¿e definiowaæ
       <code>tcgetattr</code> jako synonim starszego <code>sgtty</code>,
       lecz jest to w najlepszym wypadku prowizorka na OpenBSD.  
       Kod ¼ród³owy <code>xterm</code> jest dobrym przyk³adem, czego nie nale¿y
       robiæ. Postaraj siê uzyskaæ funkcjonalno¶æ systemu poprawnie: chcesz
       typu, który zapamiêtuje stan twojego terminala (dopuszczalne typedef),
       chcesz funkcji, która przywraca zapamiêtany stan, oraz funkcje,
       która ustawia nowy stan.
       Funkcje, które modyfikuj± ten stan s± trudniejsze, albowiem maj±
       sk³onno¶æ do zró¿nicowania w zale¿no¶ci od systemu. Poza tym, nie
       zapominaj, ¿e bêdziesz musia³ poradziæ sobie z przypadkami, kiedy
       nie jeste¶ pod³±czony do terminala, oraz o przechwytywaniu sygna³ów
       (to handle signals): nie tylko zakoñczenia, ale tak¿e przej¶cia
       w t³o (<code>SIGTSTP</code>). Powiniene¶ zawsze przywracaæ terminal
       do pierwotnego stanu. Przeprowad¼ testy na starej pow³oce,
       jak sh, która nie resetuje w ¿aden sposób terminala po zakoñczeniu
       pracy programu.
   <li>Nowszy termcap/terminfo i curses, wykorzystywane w OpenBSD,
       zawieraj± standardowe sekwencje dla kontrolowania kolorowych terminali.
       Powiniene¶ ich u¿ywaæ, je¶li to tylko mo¿liwe, odzwierciadlaj±c
       standardowe sekwencje kolorów z innych systemów. Jednak¿e, niektóre
       opracowania nie zosta³y jeszcze zaktualizowane, lecz powiniene¶ byæ
       w stanie zdefiniowaæ te sekwencje rêcznie. W taki sposób robi to vim.
       Nie jest to bezwzglêdnie niezbêdne. Poza programami uprzywilejowanymi,
       jest ogólnie mo¿liwe nadpisanie (override) definicji termcap'a
       poprzez zmienn± <code>TERMCAP</code> i uzyskaæ po¿±dane dzia³anie.
   <li>Sematyka sygna³ów jest zdradliwa, i ró¿ni siê pomiêdzy poszczególnymi
       systemami. U¿ywaj <code>sigaction</code> aby zapewniæ specyficzn±
       sematykê, razem z pozosta³ymi wywo³aniami systemowymi (system calls)
       opisanymi w odpowiednich stronach podrêcznika man.
  </ul>
  <hr>
  <a href="index.html"><img height=24 width=24 src="../back.gif" border=0 alt=OpenBSD></a> 
  <a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br><small>Originally [OpenBSD: porting.html,v 1.51 ]<br>
$Translation: porting.html,v 1.7 2004/12/09 11:35:19 pl-team Exp $<br>
$OpenBSD: porting.html,v 1.7 2004/12/10 05:35:37 saad Exp $
</small>
 </body>
</html>
