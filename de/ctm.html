<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
   <TITLE>CTM</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<center>
<img alt="CTM for OpenBSD" src="../images/bsdctm.gif" width="401" height="126">
</center>

<H3>Was ist CTM?</H3>

<P>
CTM ist ein System, das von Poul-Henning Kamp erschaffen wurde, um die
t&auml;glichen &Auml;nderungen an einem source tree per E-Mail verf&uuml;gbar
zu machen. Das ist ein guter Weg, um beim "-current source" auf dem laufenden zu bleiben,
selbst wenn man eine langsame Internetverbindung hat, z.B. via Modem.

<P>
CTM benutzt eine sehr kleine Bandbreite, um die &Auml;nderungen am
source tree zu verschicken und komprimiert sie ausserdem per <tt><b>gzip -9</b></tt>.
Im Gegensatz zu <a
href="cvsup.html">CVSup</a>, ist CTM in normalem C geschrieben und daher f&uuml;r
jede Plattform verf&uuml;gbar, die von OpenBSD unterst&uuml;tzt wird.
<p>
Bei <b>jeglichen</b> Problemen, Vorschl&auml;gen, Berichten und Fragen bez&uuml;glich CTM
wende dich bitte an den 'CTM maintainer'
<a href="mailto:hgw@d1906.inka.de">Hans G&uuml;nter Weigand</a>.
<small>(Bitte keine anderen OpenBSD Leute um CTM Unterst&uuml;tzung,
da sie mit anderen Dingen besch&auml;ftigt sind.  Danke.)</small>

<H3>Wie funktioniert es?</H3>

<P>
Die grunds&auml;tzliche Idee von CTM ist, dass du dich auf einer bestimmten
Mailingliste einschreibst, sie also abonnierst, um einen bestimmten Teil des
source trees zu erhalten. Du erh&auml;ltst jeden Tag eine E-Mail mit den jeweiligen 
&Auml;nderungen dieses Tages. Ein solcher Satz &Auml;nderungen wird <strong>delta</strong>
genannt. Tats&auml;chlich macht der CTM-Server alle 12 Stunden neue deltas.


<P>
Du beginnst mit einem Basissatz gegen den dann sp&auml;ter die deltas gepatched
werden. Um mit CTM zu beginnen, musst du unbedingt die neueste Version des "base
set" (Basissatz) und alle danach folgenden deltas herunterladen; nachdem du diese verarbeitet 
hast, kannst du mit denen weitermachen, die du per E-Mail erh&auml;ltst.
Die Basis-S&auml;tze sind jeweils in 1440k Teile aufgeteilt, damit man sie leichter &uuml;ber
eine langsame Leitung herunterladen kann.

<P>
Basen werden nach 50 relativen deltas erstellt, so dass du nie mehr als 
50 deltas herunterladen musst, um auf den aktuellen Stand zu kommen.

<P>
Es gibt zur Zeit zwei verschiedene Arten von Basis-Dateien. Eine ganze Zeit
lang haben wir <tt><b>tar.gz</b></tt> Dateien per Hand erstellt, aber wir
gehen zur&uuml;ck zu echten CTM Basis Deltas. Die letzteren enthalten
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=md5&sektion=1">md5(1)</a>
Checksummen und werden automatisch erstellt, sind also etwas sicherer.
Du kannst diese beiden Arten anhand ihres Dateinamens unterscheiden. Ein Beispiel f&uuml;r 
eine <tt><b>tar.gz</b></tt> Datei ist
<tt><b>OpenBSD-cvs.1450.tar.gz</b></tt>, w&auml;hrend ein CTM Basis Set
den folgenden Namen h&auml;tte: <tt><b>OpenBSD-cvs.1500A.gz</b></tt>.  Siehe unten f&uuml;r
detaillierte Anweisungen.

<H3>Wieviel Bandbreite braucht CTM ?</H3>

<P>
Du musst das base set haben und alle relativen deltas bis zum 
jetzigen Datum dazu, und zwar per FTP von der unten aufgef&uuml;hrten Liste. Sie haben die folgenden
Gr&ouml;&szlig;en:

<ul>
<li> ungef&auml;hr 115Mb f&uuml;r OpenBSD-cvs
<li> ungef&auml;hr 37Mb f&uuml;r OpenBSD-cvs-x11
<li> ungef&auml;hr 56MB f&uuml;r OpenBSD-cvs-xf4.
<li> ungef&auml;hr 65Mb f&uuml;r OpenBSD-src
<li> ungef&auml;hr 35Mb f&uuml;r OpenBSD-src-x11
<li> ungef&auml;hr 2Mb f&uuml;r OpenBSD-ports
<br> Denke dran, dass das komprimierte Dateien sind -- ausgepackt sind sie etwa f&uuml;nfmal so gross.
<li> relative deltas sind zwischen 10k und 500k, und manchmal auch einige MB
<li> CTM teilt die deltas immer in 100kB Mail-Messages , die dann automatisch wieder zusammengef&uuml;gt werden
<li>Wenn ein Delta gr&ouml;sser als 5MB ist, wird es nicht via mail versendet. Anstattdessen bekommst du eine
 Benachrichtigung, dass du das Delta per FTP holen musst.
Gr&ouml;&szlig;ere CTM Updates sind selten, passieren aber meist nach dem Importieren von grossen Dingen
wie etwa den binutils, perl, gcc, oder dem Einf&uuml;gen eines CVS-Tags in den source tree.
</ul>

<H3>Wie man benutzt man CTM?</H3>

<UL>
<LI>Abboniere die CTM Mailingliste f&uuml;r das Source-set deiner Wahl.
<p>
   Es gibt verschiedene Mailinglisten f&uuml;r das Thema CTM.  Es gibt eine Liste f&uuml; die
   Updates am CVS repository,  eine Liste f&uuml;r den source tree, eine Liste
   f&uuml;r den X11 Teil und eine f&uuml;r den ports tree, sowie eine 
   f&uuml;r die Log Messages des CTM delta Generators.
   <p>
<p>
F&uuml;r das CVS repository (ohne X11 und XF4 Module):
<pre>
       echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org
</pre>
F&uuml;r das X11 Modul des CVS tree:
<pre>
       echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org
</pre>
F&uuml; den source tree (ohne das X11 und XF4 Modul):
<pre>
       echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org
</pre>
F&uuml;r das X11 Modul des source tree:
<pre>
       echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org
</pre>
F&uuml;r den ports tree:
<pre>
       echo subscribe OpenBSD-ports-CTM | mail majordomo@OpenBSD.org
</pre>
F&uuml;r die CTM log Liste:
<pre>
       echo subscribe CTM-log | mail majordomo@OpenBSD.org
</pre>
Es gibt noch keine Mailingliste f&uuml;r das XF4 Modul. Bisher ist es nur 
via FTP erh&auml;ltlich.


<p>
<li>Installiere das CTM Programm aus einem Package oder aus der ports
collection.  Den port gibt's unter
<tt><b>/usr/ports/devel/CTM</b></tt>.


</ul>
	<b>Hinweis:</b> Die Beispiele unten decken nur OpenBSD-cvs ab, einfach zur
	Kl&auml;rung. Die anderen source sets m&uuml;ssen auf die gleiche Art behandelt werden.

<p><ul>

<li>Lade das Basis-Set von einer FTP Site herunter. Du findest es im 
Unterverzeichnis <tt><b>base/OpenBSD-cvs</b></tt>. Hole alle Dateien in diesem 
Verzeichnis. Wenn du sie alle hast, kannst du die Basis-Datei erstellen und sie mit 
folgenden Kommandos auspacken, abh&auml;ngig vom Datei-Typ, den du hast:

<pre>
       cat split/OpenBSD-cvs.1500A.gz.* &gt; OpenBSD-cvs.1500A.gz
       cd target
       CTM -v -v -v .../OpenBSD-cvs.1500A.gz
</pre>
<p>
oder

<pre>
       cat split/OpenBSD-cvs.1500.tar.gz.* &gt; OpenBSD-cvs.1500.tar.gz
       cd target
       tar -xzvf .../OpenBSD-cvs.1500.tar.gz
</pre>

wobei <tt><b>split</b></tt> das Verzeichnis st, in dem du die heruntergeladenen Dateien
abgelegt hast und <tt><b>target</b></tt> der Platz ist, den du f&uuml;r das Auspacken des 
source set gew&auml;hlt hast.

<p>
Es ist nicht notwendig, die Dateien weiter zu behalten, sobald du einmal einen kompletten
tree hast. Aber du kannst die Basis-Set Dateien aus Backup-Gr&uuml;nden behalten. Auf jeden
Fall musst du aber die Nummer des Basis-Sets notieren, bevor du weitermachen kannst.

<p>
<li>Jetzt musst du die Deltas holen, die generiert wurden, seit das Basis-Set erstellt wurde.
Gehe auf dem FTP-Server ins Unterverzeichnis
<tt><b>OpenBSD-cvs</b></tt> und lade jede Datei herunter, die 
<em>gr&ouml;sser</em> ist als die Nummer des benutzten Basis-Sets. Dann verarbeite die Deltas:

<pre>
       cd target
       CTM -v -v -v deltas/OpenBSD-cvs.*
</pre>

<p>
wobei <tt><b>target</b></tt> das Verzeichnis ist, wo dein source set tree ist,
und <tt><b>deltas</b></tt> der Platz ist, wo deine Deltas gespeichert sind.
<p>

<LI>Warte bis du dein erstes Delta von der Mailingliste bekommst:
<p>
<LI>Entpacke und verarbeite das CTM delta mit Hilfe von <tt><b>CTM_rmail</b></tt>.
<p>

<pre>
       CTM_rmail -p /tmp -d deltas -b target folder
</pre>

<p>
wobei <tt><b>folder</b></tt> Der Mailordner ist, der die Delta-Mail enth&auml;lt.
Das wird das CTM Delta dekodieren und im 
<tt><b>deltas</b></tt> Verzeichnis speichern. Das Delta wird eine Datei der Form
form <tt><b>OpenBSD-cvs.<var>XXXX</var>.gz</b></tt> sein, wobei <var>XXXX</var>
die Nummer des Deltas ist.  Dann wird das Delta in den directory tree 
unter <tt><b>target</b></tt>, eingearbeitet, der Platz an dem du das
Basis Set ausgepackt hast.

<p>
Wiederhole diesen letzten Schritt jedesmal, wenn du ein Delta von der
Mailingliste erh&auml;ltst. Wenn du willst, kannst du diesen Schritt mit
Hilfe von procmail oder einem &auml;hnlichem Programm automatisieren.
</ul>
<p>
Die Adressen der FTP-Server,die CTM deltas bereithalten, sind:

<li>Der Haupt-FTP Server ist hier zu finden:
<p>
<a href="ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/">
     ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/
</a>.
<p>
Dieser Server wird normalerweise automatisch vom CTM delta Erzeugungsprozess upgedatet.
Basis-Sets sind als eine grosse Datei im <tt><b>base</b></tt> Verzeichnis zu finden.
Die split Dateien sind in <tt><b>base-split</b></tt>.
<ul>
<li><a href="ftp://CTM.se.OpenBSD.org:/pub/OpenBSD-CTM/">
     ftp://CTM.se.OpenBSD.org:/pub/OpenBSD-CTM/
</a>
<p>
Dieser Server wird durch CTM deltas upgedatet, die von der Mailingliste eintreffen. Er hat 
zus&auml;tzlich die "split base deltas" im <tt><b>base</b></tt> Unterverzeichnis.
</ul>
 
<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
ist identisch zu 
<p>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
<p>
und ist ein Mirror von
<a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org
</a>
.
</ul>
<p>
<li><b>HINWEIS:</b> </b> <a href="mailto:hgw@d1906.inka.de">Ich</a> bin sehr 
an weiteren Sites interssiert, die die 
deltas spiegeln m&ouml;chten.

<p>

<h3>Sollte ich den source tree oder das CVS repository nehmen?</h3>

<P>
Das h&auml;ngt unter anderem von deinem verf&uuml;gbaren Platz auf der Festplatte ab.
Da CTM nicht besonders gut mit Dateien umgehen kann, die ausserhalb des CTM Prozesses 
modifziert wurden, ist die "bessere" Wahl wahrscheinlich das <a href="anoncvs.html">CVS</a>
repository. Dann kannst du 
deinen funktionierenden source tree aus dem CVS-repository heraus updaten. 
CVS ist smart genug, um deine lokalen &Auml;nderungen einzuf&uuml;gen.
Du kannst die volle Bandbreite an CVS-Kommandos mit Ausnahme von <tt><b>commit</b></tt> benutzen.

<p>
Der Nachteil ist der daf&uuml;r notwendige Plattenplatz.  Ein 'checked-out'
source tree ben&ouml;tigt etwa 350MB, aber wenn du dein eigenes cvs repository hast,
brauchst du etwa 1GB daf&uuml;r, <b>plus</b> zus&auml;tzliche 350MB f&uuml;r den 
"checked out" tree.
Das beinhaltet noch nicht die 100MB oder mehr, die du f&uuml;r einen "build" brauchst 
(abh&auml;ngig von der Archiktektur), sprich das Kompilieren der Sourcen.

<p>
Wenn du nur den source tree holst, musst du dich mit lokalen Ver&auml;nderungen 
anfreunden. Ein Weg, um das zu tun, ist die Nutzung des <b>union</b> Dateisystems,
(see <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&sektion=8">mount_union(8)</a>),
obwohl es auch schon Berichte gegeben hat, das <b>union</b> Dateisystem k&ouml;nne
unstabil sein, wenn die unteren und oberen "layers" auf dem selben physischen 
Dateisystem residieren. Wenn du aber obere und untere Layer auf verschiedene
Dateisysteme plazierst, solltest du dieses Problem nicht haben.
Ein Beispiel:

<p>
Nehmen wir an, dein "CTM-updated" tree sei in <tt><b>/usr/src-CTM</b></tt>, und dein realer
source tree, der, an dem du deine &Auml;nderungen durchf&uuml;hrst und deine "builds" machst,
sei in <tt><b>/usr/src</b></tt>.  <tt><b>/usr/src</b></tt> sollte zu Anfang ein leeres Verzeichnis sein. 
Das folgende Kommando wird den union-mount setzen:
<br><br>
<pre>
    <b>mount -t union -o -b /usr/src-CTM /usr/src</b>
</pre>
<p>

<br><br>
&Auml;nderungen an Dateien in <tt><b>/usr/src</b></tt> werden zu einer Datei, die in
<tt><b>/usr/src</b></tt> enthalten ist, und die in <tt><b>src-ctm</b></tt> versteckt.  
Wenn &Auml;nderungen via CTM 
am darunterliegen <tt><b>src-ctm</b></tt> tree gemacht werden, werden diese &Auml;nderungen <b>nicht</b>
sichtbar sein, wenn es eine Datei in der dar&uuml;berliegenden Schicht gibt, die sie versteckt.

<p>
Das solltest regelm&auml;ssig das union-Dateisystem  "unmounten" 
und nach Dateien suchen, die es nur im union Dateisystem gibt.

<pre>
       umount /usr/src
       find /usr/src -type f
</pre>

<p>
Die Befehle <tt><b>ls -W</b></tt> und <tt><b>rm -W</b></tt> werden auch n&uuml;tzlich sein
da Objekte in <tt><b>/usr/src</b></tt>, die "whiteouts" im Namen beinhalten, auch Dateien in <tt><b>src-ctm</b></tt>.
verstecken.

<p>
Wenn du das CVS repository hast, kannst du das <tt><b>cvs checkout</b></tt>
Kommando benutzen, um daraus einen source tree zu machen, und jedesmal, wenn du mit CTM
ein Update durchgef&uuml;hrt hast, kannst du ein <tt><b>cvs update</b></tt> benutzen, um deinen
source tree 'upzudaten'.

<p>
Um ein erstes src repository zu bekommen:: 
<pre>
       cd /usr
       cvs -qd YOUR_CVS_REPOSITORY checkout -A src
</pre>
<p>
und nach jedem CTM Update:
<pre>
       cd /usr/src
       cvs -q update -PAd
</pre>

<H3>Wie stabil ist CTM f&uuml;r OpenBSD?</H3>

	CTM wird seit &uuml;ber vier Jahren in OpenBSD benutzt, und in FreeBSD noch
	l&auml;nger.  CTM ist ziemlich zuverl&auml;ssig und stabil.

<h3>Was h&auml;lt die Zukunft f&uuml;r CTM bereit?</h3>

Es gibt zahlreiche m&ouml;gliche Verbesserungen und  (kleine) &Auml;nderungen.
Darunter sind:

<ul>
<li> CTM verschickt niemals ein Delta, das gr&ouml;sser als 5 MB ist, per Mail. Das konnte man 
     auf zwei Weisen &auml;ndern: Die maximale Delta-Gr&ouml;sse k&ouml;nnte erh&ouml;ht werden,
     oder eine 'queue', die nur eine bestimmte Menge an Mails pro Tag abschickt, 
     k&ouml;nnte installiert werden. Wenn ein Delta z.B. 6MB gro&szlig; ist, wird es in 96
     Mail-Nachrichten aufgeteilt. Diese werden dann in eine 'queue' gepackt. Am ersten Tag werden
     davon 50 Nachrichten versendet, am zweiten Tag 46, plus 4 der folgenden Deltas.

<li> Die CTM Software k&ouml;nnte neu geschrieben werden, oder zumindest besser repariert werden.
     Die C Implementierung ist kein Beispiel guten Programmierens.
     Das w&auml;re auch eine gute Gelegenheit zum Hinzuf&uuml;gen neuer Features, wie z.B.
     das Unterzeichnen von CTM deltas mit PGP.

</ul>

<H3>Mehr Informationen</H3>

Wenn du mehr &uuml;ber CTM lernen willst, ist das FreeBSD Handbuch ein guter Platz f&uuml;r Hilfe:

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/CTM.html">
         http://www.FreeBSD.org/handbook/CTM.html
     </a>
</ul>

Es gibt auch man pages f&uuml;r alle CTM Utilities.

<p>
Du kannst auch die OpenBSD Mailinglisten oder mich selbst kontaktieren, wenn du 
Schwierigkeiten mit CTM hast, obwohl meine Freizeit doch recht eingeschr&auml;nkt ist.

<p>
<h3>Zusammenfassung:</h3>

<p>

<ul>
<li> Mailinglisten:

   <ul>
   <li><tt>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe OpenBSD-ports-CTM | mail majordomo@OpenBSD.org</tt>
   <li><tt>echo subscribe CTM-log | mail majordomo@OpenBSD.org</tt>
   </ul>

<p>
<li> FTP (f&uuml;r base sets und relative deltas):

   <ul>
   <li> <a href="ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/">
        ftp://openbsd.rug.ac.be:/ftp/pub/OpenBSD-ctm/</a>
   <li> <a href="ftp://CTM.OpenBSD.org:/pub/OpenBSD-CTM">
         ftp://CTM.OpenBSD.org:/pub/OpenBSD-CTM</a>
   <li> <a href="ftp://CTM.ca.OpenBSD.org:/pub/OpenBSD-CTM">
         ftp://CTM.ca.OpenBSD.org:/pub/OpenBSD-CTM</a>
   <li> <a href="ftp://CTM.se.OpenBSD.org:/pub/OpenBSD-CTM">
         ftp://CTM.se.OpenBSD.org:/pub/OpenBSD-CTM</a>
   </ul>
</ul>

<p>
Wichtigen &Auml;nderungen und Hinweise &uuml;ber CTM werden hier bekannt gemacht:
<ul>
<li> announce@OpenBSD.org
<li> misc@openbsd.org
</ul>

<p>

<H3>Danksagungen</H3>
<ul>

<li> Poul-Henning Kamp (phk@FreeBSD.org) f&uuml;r CTM und die Hilfe 
     f&uuml;r die delta Generierung.

<li> Theo de Raadt (deraadt@theos.com) f&uuml;r OpenBSD und daf&uuml;r, dass
     er mir die Ressourcen gegeben hat, die CTM deltas auf cvs.OpenBSD.org zu erstellen
     (inzwischen werden sie an einem anderen Ort generiert) und
     f&uuml;r die Nameserver-Magie

<li> Todd C. Miller (millert@OpenBSD.org) f&uuml;r das Einrichten und Pflegen der
     CTM Mailinglisten

<li> Bob Beck (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org),
     Magnus Holmberg (mho@OpenBSD.org) und
     Wolfram Schneider (wosch@FreeBSD.org) f&uuml;r das Einrichten des ftp space
     f&uuml;r die base sets und deltas auf ctm.*OpenBSD.org

<li> Thomas Graichen (graichen@OpenBSD.org) f&uuml;r den Beginn mit CTM f&uuml;r
     OpenBSD und das Verwalten &uuml;ber all diese Jahre

<li> Wim Vandeputte (wvdeputte@OpenBSD.org) f&uuml;r das aktuelle Hosten von CTM 

<li> ... und all die anderen, die indirekt geholfen haben
</ul>

<P>
Viel Gl&uuml;ck!

<P>


<HR>

<p>
Das OpenBSD/CTM Logo wurde f&uuml;r das OpenBSD Projekt von 
   <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a> entworfen.

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD" /></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
</br>
<small>
Originally [OpenBSD: ctm.html,v 1.16 ]
<br>
$Translation: ctm.html,v 1.8 2001/04/09 19:33:54 jufi Exp $
<br></small>
<small>$OpenBSD: ctm.html,v 1.6 2001/04/09 20:10:48 jufi Exp $</small>
</body>
</html>
