<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>13 - Multimedia</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>

<!--
Copyright (c) 2005, Steven Mestdagh <steven.mestdagh@esat.kuleuven.ac.be>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor= "#ffffff" text= "#000000">

<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">    
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
<a href= "faq12.html">[To Section 12 - Platform-Specific Questions]</a>
<a href= "faq14.html">[To Section 14 - Disk Setup]</a>
</font>

<h1><font color="#e00000">13 - Multimedia</font></h1><hr>

<h3>Table of Contents</h3>
<ul>
<li><a href="#confaudio"  >13.1 - How do I configure my audio device?</a>
<li><a href="#playaudio"  >13.2 - Playing different kinds of audio</a>
<li><a href="#playCD"     >13.3 - How can I play audio CDs in OpenBSD?</a>
<li><a href="#recordaudio">13.4 - Can I use OpenBSD to record audio samples?</a>
<li><a href="#lossyaudio" >13.5 - Tell me about Ogg Vorbis and MP3 encoding?</a>
<li><a href="#playDVD"    >13.6 - How can I playback video DVDs in OpenBSD?</a>
<li><a href="#burnCD"     >13.7 - How do I burn CDs and DVDs?</a>
<ul>
  <li><a href="#burnIntro">13.7.1 - Introduction and basic setup</a>
  <li><a href="#writeCD"  >13.7.2 - Writing CDs</a>
  <li><a href="#writeDVD" >13.7.3 - Writing DVDs</a>
</ul>
<!--
<li><a href="#camera"     >13.8 - Can I use my digital camera under OpenBSD?</a>
<li><a href="#scanner"    >13.9 - How do I set up and use my scanner?</a>
-->
</ul>
<hr>

<a name="confaudio"></a>
<h2>13.1 - How do I configure my audio device?</h2>

The devices in OpenBSD that are related to audio are: <tt>/dev/audio</tt>,
<tt>/dev/sound</tt>, <tt>/dev/audioctl</tt> and <tt>/dev/mixer</tt>.
For a good overview of the audio driver layer, please read the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audio&amp;sektion=4">audio(4)</a>
manual page.

<p>
All supported audio drivers are already included in the GENERIC kernel so
there is no need for extra configuration or installation of drivers.
To find out about options for your specific sound chip, you must find out
which sound chip you have. Supported chips may be found on the hardware
compatibility page for your <a href="../plat.html">platform</a>.
When you already have OpenBSD running, look for a sound driver in the output
of the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=1">dmesg(1)</a>
command, and read its manual page to find more specific information like
options and other details about the driver.
An example of an audio chip in a dmesg output is:

<blockquote><pre>
auich0 at pci0 dev 31 function 5 "Intel 82801BA AC97" rev 0x04: irq 10, ICH2 AC97
ac97: codec id 0x41445360 (Analog Devices AD1885)
ac97: codec features headphone, Analog Devices Phat Stereo
audio0 at auich0
</pre></blockquote>

<p>
You can test whether or not your audio device is working properly by sending
an audio file (usually with .au extension) to it.
If you don't have an audio file, you can also send any text or binary file
to the device:

<blockquote><pre>
$ <strong>cat filename > /dev/audio</strong>
</pre></blockquote>

If you hear something (if it's not an audio file it will not sound good and
may sound loud, too), it means that the chip is supported by OpenBSD and was
recognized and configured by the kernel at boot time.
Otherwise there are a number of possibilities:
<ul>
<li>The file you sent to the device is so small you can hardly hear it.
Try again with a file of at least 10 kB.
<li>The chip was recognized and configured correctly, but the sound is muted
and must be unmuted to hear it, see below.
<li>The chip was recognized but not configured correctly.
Maybe you have an old ISA card which needs to be configured with a different
I/O address and IRQ value to avoid conflicts with other hardware.
You can easily try different combinations using the
<a href="faq5.html#BootConfig">User Kernel Configuration (UKC)</a>.
<li>Your card/chipset is not fully supported.
</ul>

<p>
<b>Note:</b>
Not every variation or utilization of every chip has been tested or debugged.

<p>
To tune the parameters for the audio device, such as playing sample rate,
you can use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>.
To tune the sound volume and other mixer settings, you can use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>.
Both utilities are provided as part of the base system.

<p>
For instance, to set the sound volume of the left and right channels to 200,
you would issue

<blockquote><pre>
$ <strong>mixerctl outputs.master=200,200</strong>
outputs.master: 255,255 -&gt; 207,207
</pre></blockquote>

Notice how the value becomes 207.
The reason for this is that my audio device has an AC97 codec, which uses
only 5 bits for volume control, leading to only 32 possible values.
Obviously, other hardware could use a different number of bytes.

<p>
To unmute the master channel, you would do

<blockquote><pre>
$ <strong>mixerctl outputs.master.mute=off</strong>
outputs.master.mute: on -&gt; off
</pre></blockquote>

<p>
To make your changes permanent you need to edit <i>/etc/mixerctl.conf</i>,
for example:

<blockquote><pre>
$ <strong>cat /etc/mixerctl.conf</strong>
outputs.master=200,200
outputs.master.mute=off
outputs.headphones=160,160
outputs.headphones.mute=off
</pre></blockquote>

<b>Note:</b>
You may see more outputs than there are on your sound card or motherboard.
This is because audio chips are generally cheaper to install on boards than
the jacks used to connect the outputs, so not every option of every audio
chip necessarily reaches the outside world.


<a name="playaudio"></a>
<h2>13.2 - Playing different kinds of audio</h2>

<h3>Digitized audio</h3>

<h4>Lossless audio formats (AU, PCM, WAV, FLAC, TTA)</h4>

Some of the lossless audio formats may be played without the need for third
party software, provided they contain the uncompressed digital samples in
chunks of bytes.
These formats include Sun audio (AU), raw PCM files (without
headers), and RIFF WAV.
<p>
In order to play such a file, you should know its main parameters: encoding
type, number of channels, sample rate, bits per sample.
If you don't know this, you might find out with the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=file&amp;sektion=1">file(1)</a>
utility:

<blockquote><pre>
$ <strong>file music.au</strong>
music.au:  Sun/NeXT audio data: 16-bit linear PCM, stereo, 44100 Hz
</pre></blockquote>

<blockquote><pre>
$ <strong>file music.wav</strong>
music.wav: Microsoft RIFF, WAVE audio data, 16 bit, stereo 44100 Hz
</pre></blockquote>

The only remaining things to know about these example files is that they
use little-endian byte ordering and signed linear quantization.
You could figure this out by reading the header with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hexdump&amp;sektion=1">hexdump(1)</a>.
If you are using a headerless (raw) file, there is no way to know the
parameters beforehand.
Set the following parameters accordingly using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>.

<blockquote><pre>
play.encoding=slinear_le
play.rate=44100
play.channels=2
play.precision=16
</pre></blockquote>

Next, pass the audio file to the sound device:

<blockquote><pre>
$ <strong>cat music.au > /dev/sound</strong>
</pre></blockquote>

If you applied the correct settings, you should be hearing what you expected.

<p>
Note: Always use <tt>/dev/sound</tt>, not <tt>/dev/audio</tt>, if you want
the settings you applied with audioctl to stay in place. 

<p>
There are other utilities you can use, such as
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aucat&amp;sektion=1">aucat(1)</a>,
and <tt>audio/waveplay</tt> in packages and ports.
Of course, popular software like XMMS is also able to play these files,
among other audio formats.

<p>
Apart from the above, there are audio formats which use lossless data
compression.
Examples are the Free Lossless Audio Codec (FLAC) and TTA.
The FLAC implementation has been ported to OpenBSD and may be found under
<tt>audio/flac</tt> in packages and ports.

<h4>Audio formats using lossy compression (Ogg Vorbis, MP3, WMA, AAC)</h4>

Lossy compression methods are often used for audio or other media files.
The idea is that an amount of data is thrown away during compression, but
in such a way that the compressed result is still very usable and has a
good enough quality to be played.
The advantage is that these techniques enable much higher compression ratios,
resulting in reduced disk space and bandwidth requirements.

<p>
A good example is the free, open and unpatented
<a href="http://www.vorbis.com/">Ogg Vorbis</a> format.
To play Ogg Vorbis files, you can use the ogg123 utility, which is bundled
in the <tt>audio/vorbis-tools</tt> package. For example:

<blockquote><pre>
$ <strong>ogg123 music.ogg</strong>

Audio Device:   Sun audio driver output

Playing: music.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Time: 00:02.95 [02:21.45] of 02:24.40  (133.1 kbps)  Output Buffer  87.5%
</pre></blockquote>

Of course, Ogg Vorbis plugins exist for many other audio software.

<p>
Another example is the very popular MPEG-1 Audio Layer 3 (MP3) encoding,
which has, however, its share of licensing and patent issues.
Many tools can play MP3 files, just have a look through the <tt>audio</tt>
section of the packages and ports system and pick one you like.

<p>
How about the proprietary Windows Media Audio (WMA) format? Files of this
type can be played using <tt>x11/mplayer</tt> which uses the
<a href="http://ffmpeg.sourceforge.net">FFmpeg</a> framework.

<p>
A good starting point to learn more about different audio file formats is
this Wikipedia article:
<a href="http://en.wikipedia.org/wiki/Audio_file_format">Audio file formats</a>.

<h3>Synthesized sound</h3>

<h4>MIDI</h4>

The Musical Instrument Digital Interface (MIDI) protocol provides a
standardized and efficient means to represent musical performance
information as electronic data. A MIDI file can be extremely small as
compared to a sampled audio file, because it contains only instructions
needed by a synthesizer to play the sounds.

<p>
Two widely used technologies in music synthesizers are:
<ul>
<li>Frequency Modulation (FM) Synthesis: an older method which approximates
the waveform of each instrument using a set of parameters; generally poor
quality, inexpensive to implement and therefore used on many sound cards.
<li>Wavetable Synthesis: a newer method which uses small digitized recordings
of real instruments; better quality sound, requires on-board memory, found
only on more expensive sound cards.
</ul>

<p>
Most of the necessary information about MIDI on OpenBSD can be found in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midi&amp;sektion=4">midi(4)</a>
manual page.

<p>
The main utility to handle standard MIDI files is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=midiplay&amp;sektion=1">midiplay(1)</a>.
To get a list of MIDI devices available on your system, try the following:

<blockquote><pre>
$ <strong>midiplay -l</strong>
0: SB MIDI UART
1: SB Yamaha OPL3
2: PC speaker
</pre></blockquote>

In this example, we see the UART output to which an external MIDI device
can be connected, the Yamaha OPL3 FM on-board synthesizer, and the plain
old speaker.

<p>
<b>Note:</b>
Not all sound cards have an on-board MIDI synthesizer, so you may see only
an UART ouput and the PC speaker listed.

<p>
Playing a standard MIDI file, in this example through the OPL3 synthesizer,
is as easy as:

<blockquote><pre>
$ <strong>midiplay -d 1 file.mid</strong>
</pre></blockquote>

Notice that we specified MIDI device number 1 as a parameter because
device number 0 is used by default.

<p>
More information: <a href="http://www.harmony-central.com/MIDI/Doc/tutorial.html">Tutorial
on MIDI and Music Synthesis</a>

<h4>MOD</h4>

A Soundtracker module is a binary format that mixes audio samples
with sequencing orders, making it possible to play rather long pieces
of digital music with reasonably good quality.

<p>
To play your favorite MOD files on OpenBSD, you will find a number of
so-called "trackers" in the <tt>audio</tt> section of the packages and
ports collection, e.g. tracker, soundtracker. Note, however, that not
every tracker format is supported by the tools in the ports tree.
You are always welcome to <a href="../porting.html">submit a port</a>
of your favorite tracker software.


<a name="playCD"></a>
<h2>13.3 - How can I play audio CDs in OpenBSD?</h2>

To play an audio CD using the analog output of your CD-ROM drive, you can
<ul>
<li>Use the headphones output, usually at the front side of the drive.
<li>Connect the audio output at the back side to your audio card. Yes, this
is a supplementary cable next to the data (SCSI/IDE) and power cables.
</ul>

<p>
A nice command line utility called
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cdio&amp;sektion=1">cdio(1)</a>,
has been included in the base system. Called without parameters, it will
enter interactive mode. If you want to play the CD right away, just enter

<blockquote><pre>
$ <strong>cdio play</strong>
</pre></blockquote>

<p>
This will read from the first CD-ROM drive, <tt>cd0</tt>, by default.
Note that the user running cdio should have permissions to read the CD-ROM
device.
As this device is in the operator group by default, its permissions can
be adjusted as follows:

<blockquote><pre>
# <strong>chmod o+r /dev/rcd0c</strong>
</pre></blockquote>

<p>
If you like a beautiful GUI, there are plenty of X11-based CD players in
the packages and ports collection.
Just have a look in the <tt>audio</tt> section.


<a name="recordaudio"></a>
<h2>13.4 - Can I use OpenBSD to record audio samples?</h2>

Yes, to do this you can use /dev/sound or /dev/audio as an input device.
<p>
First, set the relevant recording parameters with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=audioctl&amp;sektion=1">audioctl(1)</a>,
e.g.

<blockquote><pre>
record.encoding=mulaw
record.rate=8000
record.channels=1
record.precision=8
</pre></blockquote>

Here I'm using nonuniform quantizing with the mu-law algorithm, with one
channel, a sampling rate of 8000 Hz and using 8 bits per sample.
The mu-law and A-law algorithms are especially useful when digitizing speech
signals, because they achieve a greater coding efficiency.
This means that the quality of the sampled speech will be better for a given
number of bits per sample, or less bits will be required for a given quality.

<p>
If you decide to adopt the above values (only those!), you can use the
/dev/audio device which uses them by default, so you do not need to set them
explicitly in that case.

<p>
Next, make sure that you select the right device to record from and that the
source is unmuted.
You can set the necessary parameters using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mixerctl&amp;sektion=1">mixerctl(1)</a>.
For example:

<blockquote><pre>
inputs.mic.mute=on
inputs.mic.preamp=on
inputs.mic.source=mic0
record.source=mic
record.volume=255,255
record.volume.mute=off
record.mic=0
record.mic.mute=off
</pre></blockquote>

In this example, I'll be recording from a microphone.
Pre-amplifying has been enabled, otherwise the recorded sound can be pretty
silent.

<p>
To do the actual recording, just use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cat&amp;sektion=1">cat(1)</a>
or
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dd&amp;sektion=1">dd(1)</a>:

<blockquote><pre>
$ <strong>dd if=/dev/audio of=myvoice.raw</strong>
</pre></blockquote>

Press [CTRL]-C to finish the recording.
The output is a raw sequence of bytes.
This sound can be played, as explained in
<a href="#playaudio">Playing different kinds of audio</a>.
For a quick test, assuming the audio parameters are set correctly:

<blockquote><pre>
$ <strong>dd if=myvoice.raw of=/dev/audio</strong>
</pre></blockquote>

<p>
Again, if you set other encoding parameters, you should be using the
/dev/sound device.

Another example of encoding parameters:
<blockquote><pre>
record.encoding=slinear_le
record.rate=22050
record.channels=2
record.precision=8
</pre></blockquote>

This will result in PCM with signed linear (uniform) quantization, stored in
little-endian byte ordering, at a sampling rate of 22050 Hz, in stereo,
and using 8 bits to represent one sample
(2^8 = 256 quantization levels).

<h3>Converting your sample to other audio formats</h3>

Let's say we want to process the sound recording in the raw format.
Then it will be useful to convert it, because this raw format has no headers
and the recording parameters will need to be specified at every usage of
the file.

<p>
A good sound conversion tool is <tt>audio/sox</tt>, available through ports
(not packages, however, due to redistribution issues).
Below is an example for converting the recording to RIFF WAV format.

<blockquote><pre>
$ <strong>sox -U -c 1 -r 8000 -b myvoice.raw myvoice.wav</strong>
</pre></blockquote>

Note that the specified parameters correspond to the recording parameters
specified before the recording.

<a name="lossyaudio"></a>
<h2>13.5 - Tell me about Ogg Vorbis and MP3 encoding?</h2>

These formats were already mentioned in
<a href="#playaudio">Playing different kinds of audio</a>.
In this section we will give a brief introduction about encoding such files.
If you are interested in learning how these audio compression codecs work,
further reading may be found through these Wikipedia articles about
<a href="http://en.wikipedia.org/wiki/Vorbis">Vorbis</a> and
<a href="http://en.wikipedia.org/wiki/MP3">MP3</a>.

<h3>Ogg Vorbis</h3>

Encoding raw, WAV or AIFF format audio to
<a href="http://www.vorbis.com/">Ogg Vorbis</a> may be done with the
<b>oggenc</b> utility, contained in the <tt>audio/vorbis-tools</tt> package,
which is available through OpenBSD's packages and ports system.

<p>
Say you have a number of WAV files ready to encode, for example your
favorite album you just extracted from its CD.
To encode all these files using an approximate bit rate of 192 kbps, you
could issue a command like
<blockquote><pre>
$ <strong>oggenc *.wav -b 192</strong>
</pre></blockquote>

When finished, this will give you a set of .ogg files in the current directory.
More extensive examples, as well as encoding options, can be found in the
oggenc manual page.

<h3>MPEG-1 Audio Layer 3 (MP3)</h3>

If for some reason you want to use the MP3 format, you can use
<a href="http://mp3dev.org/">"Lame ain't an MP3 encoder" (LAME)</a>,
an educational tool to be used for learning about MP3 encoding.
Lame is included in the OpenBSD ports tree.
Note that due to MP3 patents, you will not find this package on the
<a href="../orders.html">official CD sets</a>.

<p>
Below is a simple example of encoding a WAV file with a bit rate of 192 kbps:
<blockquote><pre>
$ <strong>lame -b 192 track01.wav track01.mp3</strong>
</pre></blockquote>

For all options and details, please consult the manual page that comes with
lame.


<a name="playDVD"></a>
<h2>13.6 - How can I playback video DVDs in OpenBSD?</h2>

Currently, OpenBSD supports DVD media through the ISO 9660 filesystem which
is also used on CD-ROMs.
The newer <a href="http://www.osta.org/specs/">Universal Disk Format (UDF)</a>
filesystem on some DVDs is not supported.
However, almost all DVD-Video and DVD-ROM discs use the UDF bridge format,
which is a combination of the DVD MicroUDF (subset of UDF 1.02) and ISO 9660
file systems.
This bridge format provides backwards compatibility for operating systems
which do not yet support UDF.

<p>
As most computers with DVD-ROM drives use software decoding, it is
recommended to have at least a 350-MHz Pentium II or equivalent CPU to have
good quality playback.

<p>
Some popular DVD playback utilities have been ported to OpenBSD.
Examples are <a href="http://www.dtek.chalmers.se/groups/dvd/">ogle</a>
and <a href="http://www.mplayerhq.hu/">mplayer</a>.
Please read the installation instructions that come with the package,
because these tools may need further setup.
With these utilities, it is possible to playback the DVD by directly
accessing the raw device.
Of course, it is also possible to mount a DVD first using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_cd9660&amp;sektion=8">mount_cd9660(8)</a>,
and play the files on this or any other mounted filesystem.

<p>
<b>Notes:</b>
<ul>
<li>Nearly all DVDs you buy are encrypted using the Content Scrambling
System (CSS).
To be able to playback these encrypted DVDs, you can use the
<a href="http://www.videolan.org/libdvdcss/">libdvdcss</a>
library, also available through packages and ports.
<li>Be aware that a region code may be present on your DVD disk(s).
This should not be much of a problem when playing DVDs on a computer.
</ul>


<a name="burnCD"></a>
<h2>13.7 - How do I burn CDs and DVDs?</h2>

<a name="burnIntro"></a>
<h3>13.7.1 - Introduction and basic setup</h3>

You should first make sure your CD/DVD writer has been recognized and
configured by the kernel.
Most SCSI devices are supported. IDE/ATAPI and USB devices are supported
through SCSI emulation. You will quickly find your device in a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=1">dmesg(1)</a>
output.
Just look for lines beginning with "cd", for example

<blockquote><pre>
cd0 at scsibus0 targ 0 lun 0: &lt;TOSHIBA, CD-ROM XM-5702B, 2826&gt; SCSI0 5/cdrom removable
cd1 at scsibus1 targ 4 lun 0: &lt;PLEXTOR, CD-R PX-R412C, 1.04&gt; SCSI2 5/cdrom removable
</pre></blockquote>

<h4>But <tt>cdrecord -scanbus</tt> does not work!</h4>

Yes. OpenBSD uses a different device namespace than the OS for which the
cdrecord utility was written.
All configured devices should be in the dmesg output, as mentioned above.
The information you need is right there.

<h4>Error: <tt>mount_cd9660: /dev/cd2c on /mnt/cdrom: No such file or directory</tt></h4>

By default, the OpenBSD installer creates only two cd device nodes,
<tt>cd0</tt> and <tt>cd1</tt>.
To start using your <tt>cd2</tt> device, you must create the necessary
device nodes for it.
The recommended way to do that is using the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8">MAKEDEV(8)</a>
(select your specific platform) script:

<blockquote><pre>
# <strong>cd /dev</strong>
# <strong>./MAKEDEV cd2</strong>
</pre></blockquote>

In what follows, we will mostly be accessing the CD/DVD writer through the
<i>raw</i> character device, <b>not</b> the <i>block</i> device.

<h4>Checking CD/DVD writer operation</h4>

It is recommended to check whether your CD/DVD writer is working correctly.
In this example, I'll be using this USB 2.0 DVD writer:

<blockquote><pre>
cd2 at scsibus2 targ 1 lun 0: &lt;LITE-ON, DVDRW LDW-851S, GS0C&gt; SCSI0 5/cdrom removable
</pre></blockquote>

Try to use it by mounting an existing CD/DVD in it.
If desired, you could also check the transfer rate you are getting when
copying files to your hard disk.
The
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=time&amp;sektion=1">time(1)</a>
command will be your willing assistant.

<p>
If something goes wrong here and you are getting errors during this phase,
it is wise to fix the problem and not to start writing a CD/DVD yet.

<h3>I want to write a CD here! Can we get on with it?</h3>

Before proceeding, it is a good idea to keep a few words of advice in mind:

<ul>
<li>Do not run any disk-intensive jobs while writing a CD/DVD. Doing this
will reduce the throughput to your CD/DVD writer. If the throughput drops
below what the writer is expecting for too long, its buffer will run empty.
This phenomenon is also known as a "buffer underrun".
<li>Prevent shocks during writing as this may cause the laser beam to drift
from its track, which may lead to errors on the disc.
<li>Not every DVD writer supports every DVD format, see below.
</ul>

<a name="writeCD"></a>
<h3>13.7.2 - Writing CDs</h3>

<h4>Creating data CD-ROMs</h4>

First, you will want to create an ISO 9660 filesystem to put on a CD-ROM.
To do this you can use the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkhybrid&amp;sektion=1">mkhybrid(1)</a>
utility, which comes with the base system.

<p>
As an example usage, let's say I wanted to store the OpenBSD kernel sources
in an ISO 9660 image:

<blockquote><pre>
$ <strong>mkhybrid -R -o sys.iso /usr/src/sys</strong>

Using ALTQ_RMC.000;1 for  /usr/src/sys/altq/altq_rmclass_debug.h (altq_rmclass.h)
...
Using XFS_DEV-.000;1 for  /usr/src/sys/xfs/xfs_dev-common.c (xfs_dev-bsd.c)
 12.06% done, estimate finish Sun Mar 27 21:18:47 2005
 24.09% done, estimate finish Sun Mar 27 21:18:43 2005
...
 84.32% done, estimate finish Sun Mar 27 21:18:38 2005
 96.37% done, estimate finish Sun Mar 27 21:18:38 2005
Total translation table size: 0
Total rockridge attributes bytes: 0
Total directory bytes: 1822720
Path table size(bytes): 10674
Max brk space used 469000
41508 extents written (81 Mb)
</pre></blockquote>

<p>
The <tt>-R</tt> option tells <tt>mkhybrid</tt> to create Rock Ridge
extensions in the ISO 9660 image.
The Rock Ridge Interchange Protocol was created to support POSIX file system
semantics in ISO 9660 file systems, such as longer file names, ownerships,
permissions, file links, soft links, device nodes, deep file hierarchies
(more than 8 levels of subdirectories), etc.

<p>
If you want the long file names on your CD-ROM to be readable on Windows
or DOS systems, you should add the <tt>-J</tt> flag to include Joliet
extensions in the ISO 9660 image as well.

<p>
After creating the filesystem, you can verify it by
<a href="faq14.html#MountImage">mounting the ISO 9660 image</a>.
If all is well, you are now ready to burn the CD-R(W).
A commonly used package to do this is the <b>cdrecord</b> program,
contained in the cdrtools package, which is available through OpenBSD's
packages and ports system.

<p>
If you are using once-writable media like CD-R, it is always a good idea
to do a dry run before actually burning the CD-ROM, in order not to waste
any discs.

<blockquote><pre>
# <strong>cdrecord -v -dummy dev=/dev/rcd1c sys.iso</strong>
</pre></blockquote>

If this goes well, you are ready to burn the image created in the above
example to a blank CD-R(W). You could use a command similar to:

<blockquote><pre>
# <strong>cdrecord -v dev=/dev/rcd1c sys.iso</strong>
</pre></blockquote>

With the options specified above, we're asking cdrecord to provide
verbose output and to use the second CD-ROM device as the CD writer.
Note that we are passing the <i>raw</i> device to cdrecord.

<p>
To verify whether the CD-ROM has been written correctly, you can mount it
and check whether everything is there.
To mount the filesystem, you should use the <i>block</i> device for the
CD-ROM drive, which in this case is still the CD writer:

<blockquote><pre>
# <strong>mount /dev/cd1c /mnt/cdrom</strong>
</pre></blockquote>


<h4>Creating audio CDs</h4>

To burn audio CDs, you can use <b>cdrecord</b> with the <tt>-audio</tt>
flag, or the <a href="http://cdrdao.sourceforge.net/">cdrdao</a> utility
to write in Disk-At-Once mode and avoid gaps between the audio tracks.
Both utilities are available via OpenBSD's packages and ports system.

<p>
As an example, I'll be making a backup copy of one of my music CDs.
This involves two steps:

<ol>
<li>Fetch the audio tracks from the original CD: you can do this with
software like <b>cdparanoia</b>, <b>cdda2wav</b> (bundled with the
<tt>sysutils/cdrtools</tt> package), and <b>cdrdao</b>.
For example:
<blockquote><pre>
# <strong>cdrdao read-cd --device /dev/rcd0c cdtracks.toc</strong>
</pre></blockquote>
This command will extract a series of WAV files from your first CD-ROM drive
to your disk, and compile a Table Of Contents (TOC) file.
<li>Write the audio tracks to a blank CD: as mentioned above, use
<b>cdrecord</b> or <b>cdrdao</b>, e.g.
<blockquote><pre>
# <strong>cdrdao write --device /dev/rcd1c cdtracks.toc</strong>
</pre></blockquote>
If desired, try the <tt>cdrdao simulate</tt> command first.
</ol>


<a name="writeDVD"></a>
<h3>13.7.3 - Writing DVDs</h3>

There are a few important things about DVD you should know about before
proceeding to write your own DVDs.

<p>
<b>Important notes:</b>
<ul>
<li>If you really want to know all about DVD, I suggest you read the very
extensive <a href="http://www.dvddemystified.com/dvdfaq.html">DVD FAQ</a>
document to start with.
<li>This section has seen only very limited testing, and we certainly have
not tried every possible media and writer combination.
For instance, DVD-RAM remains untested.
You are welcome to <a href="mailto:faq@openbsd.org">let us know</a> about
your successes or failures.
</ul>

<h4>Different DVD formats</h4>

There are a number of different DVD formats. Commonly used are the DVD-R,
DVD-RW, DVD+R, and DVD+RW formats (R means writable once, RW means it can
be rewritten a few thousand times).
They are pretty much competing standards.

<p>
A pretty different format is DVD-RAM, which was mainly developed as a
data drive and has advanced packet writing functions, allowing it to be
used like a kind of optical hard disk. DVD-RAM is not recommended for
video usage as video gets written to the discs in a format not compatible
with normal DVD players.

<p>
The important thing is you use media which suit your DVD writer.
If you expect compatibility with other DVD players, watch your step and
be sure to read
<a href="http://www.dvddemystified.com/dvdfaq.html#4.3.1">this section</a>
of the DVD FAQ.

<h4>DVD writing speed</h4>

It may be useful to point out that DVD speed indications differ from CD-ROM
speed indications. The following table gives an overview:

<p>
<table border="1">
<tr align="center">
<td>DVD read/write speed</td>
<td>Transfer rate (MB/s)</td>
<td>Equivalent CD-R(W) read/write speed</td>
</tr>
<tr align="center">
<td>1x</td>
<td>1.32</td>
<td>9x</td>
</tr>
<tr align="center">
<td>2x</td>
<td>2.64</td>
<td>18x</td>
</tr>
<tr align="center">
<td>4x</td>
<td>5.28</td>
<td>36x</td>
</tr>
<tr align="center">
<td>8x</td>
<td>10.57</td>
<td>72x</td>
</tr>
</table>

<p>
As can been seen from the table, the transfer rates are relatively high,
and you should check whether your bus (SCSI, (E)IDE/ATAPI, USB) is performant
enough to handle this throughput.
Especially the older USB 1.0 and 1.1 interfaces work at slower transfer
rates, with maximal rates of 1.5 Mbit/s and 12 Mbit/s, respectively.
That means USB 1.0 has a maximal throughput of 178.8 kByte/s and
USB 1.1 has a maximal throughput of 1.43 MB/s.
USB 2.0 is much faster: 480 Mbit/s or 57.2 MB/s.
In general, the speed of SCSI and (E)IDE/ATAPI buses should be just fine.

<h4>Writing the DVD</h4>

Basically, the process is very similar to writing CD-R(W)s. The software
used, however, is different.
At the moment, the best option is <b>growisofs</b> from the
<tt>sysutils/dvd+rw-tools</tt> package.
This utility writes an ISO 9660 image to the DVD medium.
All recordable DVD formats are supported by the dvd+rw-tools.

<p>
In case you want to find out more info about the media in your DVD writer
(for example if you lost the info label in the jewel case or are just
disorganized like me), you can use the <b>dvd+rw-mediainfo</b> utility.

<!--blockquote><pre>
$ <strong>dvd+rw-mediainfo /dev/rcd2c</strong>
INQUIRY:                [LITE-ON ][DVDRW LDW-851S  ][GS0C]
GET [CURRENT] CONFIGURATION:
 Mounted Media:         1Ah, DVD+RW
 Current Write Speed:   4.0x1385=5540KB/s
 Write Speed #0:        4.0x1385=5540KB/s
 Write Speed #1:        2.4x1385=3324KB/s
GET [CURRENT] PERFORMANCE:
 Write Performance:     4.0x1385=5540KB/s@[0 -> 0]
 Speed Descriptor#0:    00/0 R@2.4x1385=3324KB/s W@4.0x1385=5540KB/s
 Speed Descriptor#1:    00/0 R@2.4x1385=3324KB/s W@2.4x1385=3324KB/s
READ DVD STRUCTURE[#0h]:
 Media Book Type:       92h, DVD+RW book [revision 2]
 Media ID:              SONY/S11
 Legacy lead-out at:    2295104*2KB=4700372992
READ DISC INFORMATION:
 Disc status:           blank
 Number of Sessions:    1
 State of Last Session: empty
 Number of Tracks:      1
READ TRACK INFORMATION[#1]:
 Track State:           blank
 Track Start Address:   0*2KB
 Free Blocks:           2295104*2KB
 Track Size:            2295104*2KB
READ CAPACITY:          1*2048=2048
</pre></blockquote-->

There are two options to write the DVD:
<ul>
<li>Pre-master an ISO 9660 from your data, storing the image on your hard
disk; then write this image to the DVD.
<li>Write an ISO 9660 from your data immediately to the DVD.
</ul>

<p>
I created a pre-mastered ISO 9660 image from the OpenBSD CVS modules
(src, XF4, ports and www) contained in the /cvs directory on my disk.
I used the following command, which looks very similar to the one I used
to create the CD-ROM image above.

<blockquote><pre>
$ <strong>mkhybrid -R -o cvs.iso /cvs</strong>
</pre></blockquote>

If desired, check the ISO 9660 filesystem by
<a href="faq14.html#MountImage">mounting the image</a>.
To write this image (about 2 GB) to an empty DVD disc, one could use:

<blockquote><pre>
# <strong>growisofs -dvd-compat -Z /dev/rcd2c=cvs.iso</strong>
Executing 'builtin_dd if=cvs.iso of=/dev/rcd2c obs=32k seek=0'
/dev/rcd2c: pre-formatting blank DVD+RW...
/dev/rcd2c: "Current Write Speed" is 4.1x1385KBps.
  23822336/1545832448 ( 1.5%) @3.9x, remaining 5:19
  42172416/1545832448 ( 2.7%) @3.9x, remaining 5:20
  60522496/1545832448 ( 3.9%) @3.9x, remaining 4:54
...
1504706560/1545832448 (97.3%) @3.9x, remaining 0:07
1523318784/1545832448 (98.5%) @3.9x, remaining 0:04
1541898240/1545832448 (99.7%) @3.9x, remaining 0:00
/dev/rcd2c: flushing cache
/dev/rcd2c: writing lead-out
/dev/rcd2c: reloading tray
</pre></blockquote>

The <tt>-Z</tt> option tells growisofs to burn an initial session to the
device, which in this case is my DVD writer, attached to cd2.
The <tt>-dvd-compat</tt> option closes the disk, which means no more sessions
can be appended to it.
This should provide better compatibility with video DVD players and some
older DVD-ROM units.

<p>Notice how growisofs indicates the writing speed, in this case 3.9x
DVD speed, which is what could be expected from the media and writer
combination, as indicated by dvd+rw-mediainfo.

<p>
If you are short on disk space and cannot store an ISO 9660 image for a
DVD, you can write your data directly to the DVD. Let's first do a dry
run, which simulates the creation of the filesystem.

<blockquote><pre>
# <strong>growisofs -dry-run -Z /dev/rcd2c -R /cvs</strong>
</pre></blockquote>

If this succeeds, just leave out the -dry-run option and start burning the
DVD.

<blockquote><pre>
# <strong>growisofs -Z /dev/rcd2c -R /cvs</strong>
</pre></blockquote>

Note that, in the case of writing directly to DVD, growisofs will call
mkisofs, from the cdrtools package on which dvd+rw-tools depends, and not
mkhybrid from the base system.

<p>
It is also possible to append data to an existing DVD, by using the -M
option, which merges a new session to an existing one:

<blockquote><pre>
# <strong>growisofs -M /dev/rcd2c -R /mydata</strong>
</pre></blockquote>

For more information about growisofs, refer to the manual page.

<p>
When you have finished writing the DVD, mount it and see whether everything
you expected to be there, is indeed there.

<h4>Why am I not getting the writing speed I expected?</h4>

Instead of the above writing output, you may see something like:

<blockquote><pre>
   4784128/1545832448 ( 0.3%) @0.7x, remaining 26:50
   7929856/1545832448 ( 0.5%) @0.7x, remaining 29:05
  14123008/1545832448 ( 0.9%) @0.7x, remaining 27:06
...
</pre></blockquote>

which is much slower.
It means you are somehow not getting enough throughput on whatever bus
your DVD writer is using.
In the above example, the USB DVD writer was attached to a machine on which
the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ehci&amp;sektion=4">ehci(4)</a>
driver, used by USB 2.0 controllers, failed to initialize properly.
As always, you are welcome to provide patches and test results.
The DVD writer fell back to the slower USB 1.1 interface, which causes
reduced throughput.
Indeed, USB 1.1 is limited to 12 Mbit/s, which amounts to 1.43 MB/s or
1.08x in DVD speed terms.
The DVD writer falls back to a lower pace than the maximum, to reduce the
risk of buffer underruns.


<!--
this would be interesting, but lack of hardware at the moment

<a name="camera"></a>
<h2>13.8 - Can I use my digital camera under OpenBSD?</h2>

<a name="scanner"></a>
<h2>13.9 - How do I set up and use my scanner?</h2>
-->

<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
<a href= "faq12.html">[To Section 12 - Platform-Specific Questions]</a>
<a href= "faq14.html">[To Section 14 - Disk Setup]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq13.html,v 1.85 2005/05/01 14:01:06 nick Exp $</small>

</body>
</html>

