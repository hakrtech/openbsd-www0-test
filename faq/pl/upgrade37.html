<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD Upgrade Guide</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2005 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    

</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="index.html">[FAQ Index]</a>
<a href="upgrade38.html">[3.7 -> 3.8]</a>
</font>

<h1><font color="#e00000">Upgrade Guide: z 3.6 do 3.7</font></h1>
<hr>

<i>Uwaga: upgrade jest dostêpny tylko z release do release, zalecane jest aby nie
opuszczaæ wydañ po¶rednich.</i>
Nie opuszczaj wersji release.</i>

<p>
Upgrade to wygodny sposób na utrzymywanie twojego systemu OpenBSD aktualnym
z ostani± aktualn± wersj±.
Jednak¿e, rezultat w zamierzeniu nie odpowiada dok³adnie wynikowi
instalacji wyczy¶æ-i-za³aduj.
W szczególno¶ci stare pliki bibliotek, nie s± usuwane w procesie aktualizacji,
poniewa¿ mog± byæ wymagane przez starsze aplikacjie które mog±, lecz nie musz±
byæ zaktualizowane w danym momencie.
Je¿eli NAPRAWDÊ chcesz pozbyæ siê tych wszystkich plików, prawdopodobnie lepiej
bêdzie jak zainstalujesz wszystko od pocz±tku.

<h2>Zanim rozpoczniesz...</h2>

Przed przyst±pieniem do uaktualnienia, niektórzy u¿ytkownicy
zaczynaj± od usuniêcia wszystkich <a href="faq15.html#PkgMgmt">pakietów</a>, 
i instalowania nowych wersji po aktualizacji.
<b>Je¿eli twoja platforma jest jedn± z tych przeniesionych na gcc3 (macppc,
i386), POWINIENE¦ prawdopodobnie tak zrobiæ.</b>

<p>
Aby szybko usun±æ wszystkie pakiety z systemu:
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Po zakoñczeniu aktualizacji, zainstaluj nowe wersje tych pakietów.

<p>

Zauwa¿ ¿e w OpenBSD 3.7, narzêdzia pakietów wspieraj± uaktualnienia "w miejscu"
korzystaj±æ z <code>pkg_add -r</code>. Zosta³o to sprawdzone w dzia³aniu z
wiêkszo¶ci± pakietów, w szczególno¶ci z pakietami z DC dostêpnymi w 3.5 i 3.6.

Niektóre wa¿ne sprawy:
<ul>
<li><code>pkg_add -r</code>  nie wykonuje globalnych uaktualnieñ, wymaga podania
jaki pakiet bêdzie aktualizowany pakiet. Zaznaczanie w dó³ nazwy zainstalowanego
pakietu z pkg_info, dopasowywanie nazwy ka¿dego pakietu no jego nowego odpowiednika,
oraz uruchamianie <code>pkg_add -r -q lista_nowych_pakietów</code> powinno dzia³aæ
w wiêkszo¶ci przypadków.
 
<li>Ka¿da instancja mozilli jest wyj±tkiem. Ka¿da mozilla, bloatzilla, pakiety firefox-a
MUSZ¡ byæ aktualizowane star± procedur±: uruchamiamy najpierw pkg_delete, pó¼niej
uruchamiamy pkg_add z nowym pakietem.
</ul>

<p>
<b>U¿ytkownicy i386 oraz macppc:</b>
W wyniku przej¶cia na gcc3, musisz usun±æ katalog <tt>/usr/include/g++</tt>
zanim rozpoczniesz aktualizacjê, bez wzglêdu na to czy planowa³e¶ wykorzystaæ
media instalacyjne czy nie: 

<blockquote><pre>
rm -rf /usr/include/g++
</pre></blockquote>

<h2>Upgrade z medium instalacyjnego</h2>
Naj³atwiejsz± i najbezpieczniejsz± drog± do aktualizacji z plików binarnych
jest boot z medium instalacyjnego oraz pod±¿anie za krokami aktualizacji, które
s± bardzo podobne do <a href="faq4.html">procesu instalacji</a>.
Pó¼niej wykonaj poni¿sze <a href="#etcUpdates">aktualizacje w <tt>/etc</tt></a>.

<p>
<h2>Upgrade bez medium instalacyjnego</h2>
<i>Nie jest to zalecany proces. Korzystaj z medium instalacyjnego gdy to 
tylko jest to mo¿liwe.!</i>

<p>
Czasem kto¶ mo¿e potrzebowaæ aktualizacji na maszynie na której nie mo¿e
w ³atwy sposób przeprowadziæ normalnego procesu aktualizacji.
Mo¿e wówczas wykonaæ aktualizacjê ostro¿nie postêpuj±c w procesie podobnym
do aktualizacji opartej na ¼ród³ach:

<ul>
<li><b>Umie¶æ pliki instalacyjne w "dobrej" lokalizacji</b>.
Upewnij siê ¿e posiadasz wystarczaj±c± ilo¶æ miejsca!

<li><b>Instalacja nowego kernela(-li)</b>
<blockquote><pre>
cd /<i>path</i>
rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd bsd.mp /
</pre></blockquote>

Zauwa¿ dodatkowe polecenia kopiuj±ce pierwotne j±dro: wykonywane s±
aby mieæ pewno¶æ ¿e zawsze istnieje w³a¶ciwa kopia j±dra na dysku
tak ¿e mo¿liwy bêdzie boot systemu w sytuacji gdy przytrafi siê przerwa
w zasilaniu w niew³a¶ciwym momencie lub awaria systemu.

<li><b>Instalacja nowych plików <tt>/etc/firmware</tt>:</b>
Z uwagi na fakt, ¿e niektóre za³adowane fragmenty "firmware" zosta³y
przeniesione z j±dra do katalogu <tt>/etc/firmware</tt>, jest kilka 
sterowników, które przestan± dzia³aæ je¶li nie bêdzie dostêpnego pliku
mikrokodu podczas startu nowego j±dra.
Dotyczy to wprawdzie tylko u¿ytkowników kilku urz±dzeñ, jednak nie 
zaszkodzi jak wszyscy wszyscy wykonaj± ten krok.
Aby rozpakowaæ pliki mikrokodu z <tt>base37.tgz</tt>, jako root u¿yj
polecenia:

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base37.tgz "*etc/firmware/*"

</pre></blockquote>

przed wykonaniem nastêpnego kroku.

<li><b>Reboot na nowym j±drze</b><br>
Mo¿e kusiæ chêæ opuszczenia tego kroku, ale powinien on byæ wykonany teraz,
jak zwykle, nowe j±dro uruchomi stare aplikacje przestrzeni u¿ytkownija
(takie jak bêd±cy wkrótce wa¿ny <tt>reboot</tt>), jednak czêsto nowe
aplikacje NIE bêd± dzia³a³y ze starym j±drem.

<li><b>Zatrzymaj wszystkie aplikacje które mog± stwarzaæ problemy w 
nastêpnych krokach.</b>

<li><b>Instalacja nowych aplikacji przestrzeni u¿ytkownika</b>
cd /
tar xzpf /<i>path</i>/base37.tgz
tar xzpf /<i>path</i>/comp37.tgz
tar xzpf /<i>path</i>/game37.tgz
tar xzpf /<i>path</i>/man37.tgz
tar xzpf /<i>path</i>/misc37.tgz
tar xzpf /<i>path</i>/xbase37.tgz
tar xzpf /<i>path</i>/xfont37.tgz
tar xzpf /<i>path</i>/xserv37.tgz
tar xzpf /<i>path</i>/xshare37.tgz

</pre></blockquote>
Uwaga: nie wszystkie elementy musz± byæ zainstalowane dla wszystkich aplikacji,
jednak¿e, je¿eli zainstalowa³e¶ dany zbiór orginalnie, powiniene¶ z pewno¶ci±
uaktualniæ go teraz nowym zbiorem.
Ponadto <tt>etc36.tgz</tt> oraz <tt>xetc36.tgz</tt> NIE s± rozpakowywane tutaj, 
jako ¿e s± zarz±dzane oddzielnie.

<li><b>Aktualizacja <tt>/dev</tt>.</b>
Nowy plik 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
zostanie skopiowany do /dev/ podczas instalacji <tt>base37.tgz</tt>, zatem powiniene¶
zwyczajnie wykonaæ poni¿sze: 

<blockquote><pre>
cd /dev
./MAKEDEV all
</pre></blockquote>

<li><b>Uaktalnij <tt>/etc</tt> jak poni¿ej</b>.

<li><b>Reboot</b>
</ul>

Podczas tego procesu,

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
mo¿e zwróciæ pewien b³±d podobny do poni¿szego:
<pre>
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or dire
    ctory, fs=., avail=-1, blocksize=380204
</pre>
Wiadomo¶æ ta mo¿e byæ bezpiecznie zignorowana, mo¿esz te¿ chcieæ zatrzymaæ
sendmail(8)-a na czas aktualizacji.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Uaktualnienia w  <tt>/etc</tt></h2>

Jakkolwiek wykonujesz aktualizacjê, czy to przez media instalacyjne
i wykonanie "formalnego" procesu aktualizacji, czy te¿ aktualizacjê binarn± "w-miejsce",
musisz wykonaæ kilka szególnych kroków.

<a name="users"></a>

<h4>Nowi u¿ytkownicy i grupy</h4>
Daemon FTP zosta³ przebudowany do pracy z ograniczonymi uprawnieniami, 
dodano daemona OSPF, zatem wymagane s± nowi u¿ytkownicy i grupy.

Jako <i>root</i>, dodaj poni¿szych u¿ytkowników oraz grupy korzystaj±c z 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
useradd -u84 -g=uid -c"FTP Daemon" -d/var/empty -s/sbin/nologin _ftp
useradd -u85 -g=uid -c"OSPF Daemon" -d/var/empty -s/sbin/nologin _ospfd
</pre></blockquote>


Polecenia te spowoduj± dodanie nowych u¿ytkowników oraz odpowiadaj±ce im grupy.
Twoje ¶rodowisko powinno pozwoliæ ci skopiowaæ/wkleiæ te polecenia.

<a name="apps"></a>
<h4>Aplikacje przestrzeni u¿ytkownika</h4>

<p>

<b>X.org zast±pi³ XFree86:</b>
Poniewa¿ projekt XFree86 zmieni³ licencjê, OpenBSD przenios³o siê na 

<a href="http://www.x.org">projekt X.org</a>  X Window System.
Pliki konfiguracyjne X11 musz± zostaæ zaktualizowane.
Wielu u¿ytkowników bez obaw mo¿e rozpakowaæ <tt>xetc37.tgz</tt>:

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/xetc37.tgz
</pre></blockquote>

Je¿eli wykona³e¶ istotne zmiany w plikach w <tt>/etc/X11</tt> z jakiegokolwiek
powodu, NIE powiniene¶ rozpakowywaæ <tt>xetc37.tgz</tt> jak powy¿ej, raczej
wykonuj±c rêczne wcielenie zmian w nowe pliki.

<p>
Je¿eli posiadasz plik <tt>/etc/X11/XF86Config</tt> który dzia³a³ w OpenBSD
3.6, zmieniaj±c mu nazwê na <tt>/etc/X11/xorg.conf</tt> prawdopodobnie otrzymasz
w pe³ni funkcjonalny X Window System w OpenBSD 3.7.
Mo¿e siê tak¿e okazaæ, ¿e dla ciebie nowsza wersja X jest znacznie bardziej
"samo-konfiguruj±ca" ni¿ poprzednie wersje, i nie bêdziesz potrzebowa³
pliku <tt>/etc/X11/xorg.conf</tt>, w zale¿no¶ci od twojego sprzêtu.

<p>
<b>Zmiana zachowania bgpd(8):</b>

Nowe <i>rde route-age [evaluate|iognore]</i> zmienia zachowanie bgpd.
Dotychczas <i>evaluate</i> by³o uwzglêdniane domy¶lnie, lecz obecnie
domy¶ln± warto¶ci± jest <i>ignore</i>.
Ocena wieku trasy nie jest okre¶lona w RFC 1771 i powoduje nieokre¶lone
decyzje w preferencjach wyboru bardziej stabilnego po³±czenia.

<p>
<b>pfsync wymaga syncdev zamiast syncif:</b>
Podczas konfiguracji urz±dzenia
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4">pfsync</a>,
u¿ywaj 'syncdev' zamiast przestarza³ego s³owa kluczowego 'syncif'.

<p>

<b>Teraz OpenNTPD ustawia czas bezzw³ocznie podczas startu:</b>
Od OpenBSD 3.7, OpenNTPD mo¿e wykonywaæ du¿e korekty czasu, tak wiêc nie
jest konieczne uruchamianie rdate(8) do ustawiania czasu przed startem
ntpd(8).
Mo¿esz wiêc wy³±czyæ rdate(8) w twoim pliku rc.conf.local (lub rc.local),
je¿eli chcia³e¶ to zrobiæ.

<a name="etcfiles"></a>
<h4>Zmiany w plikach w <tt>/etc</tt></h4>
Bêdziesz potrzebowa³ rozpakowaæ pliki <tt>etc37.tgz</tt> do tymczasowej
lokalizacji:
<blockquote><pre>
cd /tmp
tar xzpf /<i>path</i>/etc37.tgz
</pre></blockquote>

Pliki które prawdopodobnie mog± byæ skopiowane z <tt>etc36.tgz</tt> "jakimi s±":

<blockquote><pre>
changelist
daily
fbtab
moduli
netstart
ospfd.conf
rc
security
services
mtree/*
</pre></blockquote>

Zauwa¿, ¿e JEST mo¿liwe by lokalnie zmodyfikowaæ te pliki, je¿eli to 
by³o zrobione, bêdzie konieczne rêczne scalenie.
Tutaj s± linie kopiuj/wklei do kopiowania tych plików, zak³adaj±c ¿e
rozpakowa³e¶ <tt>etc37.tgz</tt> w miejscu sugerowanym powy¿ej:

<blockquote><pre>
cd /tmp/etc
cp changelist daily fbtab moduli netstart ospfd.conf rc security services /etc
cp mtree/* /etc/mtree/
</pre></blockquote>

<p>
Pliki które musz± byæ rêcznie w³±czone, uwzglêdniaj±c lokalne
zmiany w nich wykonane, je¿eli by³y modyfikowane z domy¶lnych,
w przeciwnym wypadku, po prostu równie¿ je skopiuj:

<blockquote><pre>
ftpusers
rc.conf
spamd.conf
sysctl.conf
mail/aliases
skel/.cshrc
skel/.profile
</pre></blockquote>

Ostatecznie skorzystaj z 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
by utworzyæ jakiekolwiek nowe katalogi:
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

<p>
<font color="#0000e0">

<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="index.html">[FAQ Index]</a>
<a href="upgrade38.html">[3.7 -> 3.8]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade37.html,v 1.14 ]<br>
$Translation: upgrade37.html,v 1.4 2005/12/05 15:24:21 tkniaz Exp $<br>
-->
$OpenBSD: upgrade37.html,v 1.4 2005/12/07 15:31:46 saad Exp $
</small>

</body>
</html>
