<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD Upgrade Guide</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2004 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    

</a>
<p>
<font color="#0000e0">
<a href="index.html">[FAQ Index]</a>
<a href="upgrade36.html">[3.5 -> 3.6]</a>
</font>

<h1><font color="#e00000">Upgrade Guide: 3.4 do 3.5</font></h1>
<hr>

<i>Uwaga: upgrade jest dostêpny tylko z release do release, zalecane
jest aby NIE opuszczaæ wydañ po¶rednich.</i>

<h2>Zanim rozpoczniesz upgrade...</h2>

Przed przyst±pieniem do aktualizacji, niektórzy u¿ytkownicy
zaczynaj± od usuniêcia wszystkich <a href="faq8.html#Packages">pakietów</a>, 
i instalowania nowych wersji po aktualizacji.

<p>
Aby szybko usun±æ wszystkie pakiety z systemu:
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Po zakoñczeniu aktualizacji, zainstaluj nowe wersje tych pakietów.

<p>
Proces uaktualnienia mo¿e nadpisaæ pewne pliki konfiguracyjne X, mo¿esz
chcieæ stworzyæ kopiê zapasow± twojego katalogu <tt>/etc/X11</tt> zanim
zaczniesz.

<h2>Upgrade z medium instalacyjnego</h2>
Naj³atwiejsz± i najbezpieczniejsz± drog± do aktualizacji z plików binarnych
jest boot z medium instalacyjnego oraz pod±¿anie za krokami aktualizacji, które
s± bardzo podobne do <a href="faq4.html">procesu instalacji</a>.
Pó¼niej wykonaj poni¿sze <a href="#etcUpdates">aktualizacje w <tt>/etc</tt></a>.


<p>
<h2>Upgrade bez medium instalacyjnego</h2>
<i>Nie jest to zalecany proces. Korzystaj z medium instalacyjnego gdy to 
tylko jest to mo¿liwe.!</i>

<p>
Czasem kto¶ mo¿e potrzebowaæ aktualizacji na maszynie na której nie mo¿e
w ³atwy sposób przeprowadziæ normalnego procesu aktualizacji.
Mo¿e wówczas wykonaæ aktualizacjê ostro¿nie postêpuj±c w procesie podobnym
do aktualizacji opartej na ¼ród³ach:

<ul>
<li><b>Umie¶æ pliki instalacyjne w "dobrej" lokalizacji</b>.
Upewnij siê ¿e posiadasz wystarczaj±c± ilo¶æ miejsca!

<li><b>Instalacja nowego kernela(-li)</b>
<blockquote><pre>
cd /<i>path</i>

rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd /    
</pre></blockquote>

Zauwa¿ dodatkowe polecenia kopiuj±ce pierwotne j±dro: wykonywane s±
aby mieæ pewno¶æ ¿e zawsze istnieje w³a¶ciwa kopia j±dra na dysku
tak ¿e mo¿liwy bêdzie boot systemu w sytuacji gdy przytrafi siê przerwa
w zasilaniu w niew³a¶ciwym momencie lub awaria systemu.

<li><b>Reboot na nowym j±drze</b><br>
Mo¿e kusiæ chêæ opuszczenia tego kroku, ale powinien on byæ wykonany teraz,
jak zwykle, nowe j±dro uruchomi stare aplikacje przestrzeni u¿ytkownija
(takie jak bêd±cy wkrótce wa¿ny <tt>reboot</tt>), jednak czêsto nowe
aplikacje NIE bêd± dzia³a³y ze starym j±drem.

<li><b>Zatrzymaj wszystkie aplikacje które mog± stwarzaæ problemy w 
nastêpnych krokach.</b>

<li><b>Instalacja nowych aplikacji przestrzeni u¿ytkownika</b>

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base35.tgz
tar xzpf /<i>path</i>/comp35.tgz
tar xzpf /<i>path</i>/game35.tgz
tar xzpf /<i>path</i>/man35.tgz
tar xzpf /<i>path</i>/misc35.tgz
tar xzpf /<i>path</i>/xbase35.tgz
tar xzpf /<i>path</i>/xfont35.tgz
tar xzpf /<i>path</i>/xserv35.tgz
tar xzpf /<i>path</i>/xshare35.tgz

</pre></blockquote>
Uwaga: nie wszystkie elementy musz± byæ zainstalowane dla wszystkich aplikacji,
jednak¿e, je¿eli zainstalowa³e¶ dany zbiór orginalnie, powiniene¶ z pewno¶ci±
uaktualniæ go teraz nowym zbiorem.
Ponadto <tt>etc35.tgz</tt> NIE jest rozpakowany tutaj, jako ¿e jest przechowywany
oddzielnie.

<li><b>Aktualizacja <tt>/dev</tt>.</b>
Nowy plik 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
zostanie skopiowany do /dev podczas instalacji <tt>base35.tgz</tt>, zatem
powiniene¶ zwyczajnie wykonaæ poni¿sze:

<blockquote><pre>
cd /dev
./MAKEDEV all

</pre></blockquote>
Zobacz tak¿e poni¿sze notki dotycz±ce wersji.

<li><b>Upgrade <tt>/etc</tt> jak poni¿ej</b>.

<li><b>Reboot</b>
</ul>

Podczas tego procesu,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
mo¿e zwróciæ pewien b³±d podobny do za³±czonego poni¿ej:
<pre>
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or dire
    ctory, fs=., avail=-1, blocksize=380204

</pre>
Wiadomo¶æ ta mo¿e byæ bezpiecznie zignorowana, lub mo¿esz chcieæ
zatrzymaæ sendmail(8)-a na czas procesu uaktualnienia.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Uaktualnienia w <tt>/etc</tt></h2>

Jakkolwiek wykonujesz upgrade, czy to przez media instalacyjne i wykonanie,
formalnego procesu "aktualizacji", lub wykonaniem aktualizacji binariów,
jest kilka pewnych kroków które nale¿y wykonaæ rêcznie.

<a name="users"></a>
<h4>Nowi u¿ytkownicy i grupy</h4>
Szereg daemon-ów zosta³o przebudowanych od nowa by dzia³aæ z ograniczonymi
uprawnieniami lub korzysta³y z oddzielnymi uprawnieniami, zatem wymagani s±
nowi u¿ytkownicy i grupy.

Jako <i>root</i>, dodaj poni¿szych u¿ytkowników i grupy, korzystaj±c z  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:


<blockquote><pre>
useradd -u74 -g=uid -c"pflogd privsep" -d/var/empty -s/sbin/nologin _pflogd
useradd -u75 -g=uid -c"BGP Daemon" -d/var/empty -s/sbin/nologin _bgpd
useradd -u76 -g=uid -c"tcpdump" -d/var/empty -s/sbin/nologin _tcpdump
</pre></blockquote>

Polecenia te spowoduj± dodanie nowych u¿ytkowników oraz odpowiadaj±ce im grupy.
Twoje ¶rodowisko powinno pozwoliæ ci skopiowaæ/wkleiæ te polecenia.

<a name="etcfiles"></a>
<h4>zmiany plików w <tt>/etc</tt></h4>
Bêdziesz potrzebowa³ rozpakowaæ pliki <tt>etc35.tgz</tt> do tymczasowej
lokalizacji:
<blockquote><pre>
cd /tmp
tar xzpf /<i>path</i>/etc35.tgz

</pre></blockquote>

Pliki które prawdopodobnie mog± byæ skopiowane z <tt>etc35.tgz</tt> "jakimi s±":

<blockquote><pre>
bgpd.conf
changelist
locate.rc
moduli
netstart
pf.os
protocols
rc
security
sensorsd.conf
services
var/named/standard/root.hint
mtree/*
</pre></blockquote>

Zauwa¿, ¿e JEST mo¿liwe by lokalnie zmodyfikowaæ te pliki, je¿eli to 
by³o zrobione, bêdzie konieczne rêczne scalenie.
Tutaj s± linie kopiuj/wklej do kopiowania tych plików, zak³adaj±c ¿e
rozpakowa³e¶ <tt>etc35.tgz</tt> w miejscu sugerowanym powy¿ej:

<blockquote><pre>
cd /tmp/etc
cp bgpd.conf changelist locate.rc moduli netstart pf.os \
 protocols rc security sensorsd.conf services /etc
cp mtree/* /etc/mtree/
cp ../var/named/standard/root.hint /var/named/standard

</pre></blockquote>

<p>
Pliki które musz± byæ rêcznie scalone, uwzglêdniaj±c ka¿d± lokaln±
zmianê w nich wykonan±:
<blockquote><pre>
ftpusers
inetd.conf
login.conf
lynx.cfg
newsyslog.conf
rc.conf
rc.local
remote
sysctl.conf
ttys
mail/*
</pre></blockquote>

Ostatecznie skorzystaj z 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
by utworzyæ jakiekolwiek nowe katalogi:
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

Po koñcowym restarcie, powiniene¶ otrzymaæ w pe³ni funkcjonalny system 3.5.
W tym punkcie mo¿esz rozpocz±æ <a href="upgrade36.html">upgrade do 3.6</a> 
je¿eli tego sobie ¿yczysz.


<p>
<font color="#0000e0">
<a href="index.html">[FAQ Index]</a>
<a href="upgrade36.html">[3.5 -> 3.6]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade35.html,v 1.1 ]<br>
$Translation: upgrade35.html,v 1.2 2006/05/05 14:48:46 tkniaz Exp $<br>
-->
$OpenBSD: upgrade35.html,v 1.2 2006/05/05 18:38:42 jufi Exp $
</small>
</body>
</html>
