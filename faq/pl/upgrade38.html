<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD Upgrade Guide</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2005, 2006 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    

</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<h1><font color="#e00000">Upgrade Guide: z 3.7 do 3.8</font></h1>
<hr>

<i>Uwaga: upgrade jest dostêpny tylko z release do release, zalecane jest aby nie
opuszczaæ wydañ po¶rednich.</i>
Nie opuszczaj wersji release.</i>

<p><i>
Jest niezwykle zalecane aby¶ przeczyta³ ca³y dokument i dok³adnie zrozumia³
proces zanim bêdziesz usi³owa³ go przeprowadziæ.
Je¶li zamierzasz dzia³aæ na krytycznej lub fizycznie odleg³ej maszynie,
jest zalecane aby¶ przetestowa³ ten proces na identycznej, lokalnej maszynie
i zweryfikowa³ szanse na powodzenie zanim przyst±pisz do krytycznej lub 
odleg³ej maszyny.
</i>

<p>
Upgrade to wygodny sposób na utrzymywanie twojego systemu OpenBSD aktualnym
z ostatni± aktualn± wersj±.
Jednak¿e, rezultat w zamierzeniu nie odpowiada dok³adnie wynikowi
instalacji wyczy¶æ-i-za³aduj.
W szczególno¶ci stare pliki bibliotek, nie s± usuwane w procesie aktualizacji,
poniewa¿ mog± byæ wymagane przez starsze aplikacje które mog±, lecz nie musz±
byæ zaktualizowane w danym momencie.
Je¿eli NAPRAWDÊ chcesz pozbyæ siê tych wszystkich plików, prawdopodobnie lepiej
bêdzie je¶li zainstalujesz wszystko od pocz±tku.

<h2>Zanim rozpoczniesz...</h2>

Przed przyst±pieniem do uaktualnienia, niektórzy u¿ytkownicy
zaczynaj± od usuniêcia wszystkich <a href="faq15.html#PkgMgmt">pakietów</a>, 
i instalowania nowych wersji po aktualizacji.

<p>
Aby szybko usun±æ wszystkie pakiety z systemu:
<blockquote><pre>
pkg_delete -q /var/db/pkg/*
</pre></blockquote>
Po zakoñczeniu aktualizacji, zainstaluj nowe wersje tych pakietów.

<p>

Zauwa¿ ¿e w OpenBSD 3.8, narzêdzia pakietów wspieraj± uaktualnienia "w miejscu"
korzystaj±æ z <code>pkg_add -r</code>. Zosta³o to sprawdzone w dzia³aniu z
wiêkszo¶ci± pakietów, w szczególno¶ci z pakietami z DC dostêpnymi w 3.6 i 3.7.

Niektóre wa¿ne sprawy:
<ul>
<li><code>pkg_add -r</code>  nie wykonuje globalnych uaktualnieñ, wymaga podania
jaki pakiet bêdzie aktualizowany. Nowa opcja <code>pkg_add -u</code>
mo¿e byæ wykorzystana do wykrycia dok³adnej listy pakietów któr± mo¿na podaæ do
<code>pkg_add -r</code>.
<li><code>pkg_add -r -F update -F updatedepends -q lista_nowych_pakietów</code>
powinna dzia³aæ w wiêkszo¶ci przypadków.
<li>pakiety mozilli w 3.7 teraz mog± byæ bezpiecznie aktualizowane do wersji 3.8.
</ul>

<p>
<b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=epic&amp;sektion=4">epic(4)</a>
zast±pi³ dotychczasowy sterownik tx(8).</b>
Je¿eli twój system zawiera kartê wykorzystuj±c± sterownik tx(8) (np. SMC EtherPower II 
10/100), karta ta bêdzie obs³ugiwana przez inny sterownik w wersji 3.8 ni¿ w wersji 3.7.
ZANIM rozpoczniesz aktualizacjê, skopiuj plik(i) <tt>/etc/hostname.tx*</tt> na odpowiedni(e)
<tt>/etc/hostname.epic*</tt>, w przeciwnym wypadku twoja konfiguracja sieci nie bêdzie
dzia³a³a w trakcie i po procesie aktualizacji.

<h2>Upgrade z medium instalacyjnego</h2>
Naj³atwiejsz± i najbezpieczniejsz± drog± do aktualizacji z plików binarnych
jest boot z medium instalacyjnego oraz pod±¿anie za krokami aktualizacji, które
s± bardzo podobne do <a href="faq4.html">procesu instalacji</a>.
Pó¼niej wykonaj poni¿sze <a href="#etcUpdates">aktualizacje w <tt>/etc</tt></a>.

<p>
<h2>Upgrade bez medium instalacyjnego</h2>
<i>Nie jest to zalecany proces. Korzystaj z medium instalacyjnego gdy to 
tylko jest to mo¿liwe!</i>

<p>
Czasem kto¶ mo¿e potrzebowaæ aktualizacji na maszynie na której nie mo¿e
w ³atwy sposób przeprowadziæ normalnego procesu aktualizacji.
Mo¿e wówczas wykonaæ aktualizacjê ostro¿nie postêpuj±c w procesie podobnym
do aktualizacji opartej na ¼ród³ach:

<ul>
<li><b>Umie¶æ pliki instalacyjne w "dobrej" lokalizacji</b>.
Upewnij siê ¿e posiadasz wystarczaj±c± ilo¶æ miejsca!
<li><b>Wy³±cz wszystkie "niebezpieczne" aplikacje ze startu podczas uruchomienia systemu:</b>
Mo¿e wyst±piæ moment gdy prawdopodobnie nie bêdzie w³±czony PF podczas upgrade systemu,
ale twoje aplikacje mog± pracowaæ poprawnie.
Ka¿da aplikacja zale¿na w sensie bezpieczeñstwa od PF powinna zostaæ wy³±czona zanim
wy³±czony zostanie PF i nie powinna byæ w³±czana a¿ do poprawnej weryfikacji dzia³ania
PF po aktualizacji.
Mog± dzia³aæ równie¿ inne aplikacje które chcesz by dzia³a³y podczas aktualizacji systemu,
je równie¿ zatrzymaj i wy³±cz.


<li><b>Instalacja nowego kernela(-li)</b>
<blockquote><pre>
cd /<i>path</i>
rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd
cp bsd.rd bsd.mp /
</pre></blockquote>

Zauwa¿ dodatkowe polecenia kopiuj±ce pierwotne j±dro: wykonywane s±
aby mieæ pewno¶æ ¿e zawsze istnieje w³a¶ciwa kopia j±dra na dysku
tak ¿e mo¿liwy bêdzie boot systemu w sytuacji gdy przytrafi siê przerwa
w zasilaniu w niew³a¶ciwym momencie lub awaria systemu.

<li><b>Instalacja nowych plików <tt>/etc/firmware</tt>:</b>
Z uwagi na fakt, ¿e niektóre za³adowane fragmenty "firmware" zosta³y
przeniesione z j±dra do katalogu <tt>/etc/firmware</tt>, jest kilka 
sterowników, które przestan± dzia³aæ je¶li nie bêdzie dostêpnego pliku
mikrokodu podczas startu nowego j±dra.
Dotyczy to wprawdzie tylko u¿ytkowników kilku urz±dzeñ, jednak nie 
zaszkodzi jak wszyscy wszyscy wykonaj± ten krok.
Aby rozpakowaæ pliki mikrokodu z <tt>base38.tgz</tt>, jako root u¿yj
polecenia:

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base38.tgz "*etc/firmware/*"

</pre></blockquote>

przed wykonaniem nastêpnego kroku.

<li><b>Reboot na nowym j±drze</b><br>
Mo¿e kusiæ chêæ opuszczenia tego kroku, ale powinien on byæ wykonany teraz,
jak zwykle, nowe j±dro uruchomi stare aplikacje przestrzeni u¿ytkownija
(takie jak bêd±cy wkrótce wa¿ny <tt>reboot</tt>), jednak czêsto nowe
aplikacje NIE bêd± dzia³a³y ze starym j±drem.

<li><b>Instalacja nowych aplikacji przestrzeni u¿ytkownika</b>
<i>NIE instaluj teraz <tt>etc38.tgz</tt> oraz <tt>xetc38.tgz</tt>!</i>

<blockquote><pre>
cd /
tar xzpf /<i>path</i>/base38.tgz
tar xzpf /<i>path</i>/comp38.tgz
tar xzpf /<i>path</i>/game38.tgz
tar xzpf /<i>path</i>/man38.tgz
tar xzpf /<i>path</i>/misc38.tgz
tar xzpf /<i>path</i>/xbase38.tgz
tar xzpf /<i>path</i>/xfont38.tgz
tar xzpf /<i>path</i>/xserv38.tgz
tar xzpf /<i>path</i>/xshare38.tgz
</pre></blockquote>

Uwaga: nie wszystkie elementy musz± byæ zainstalowane dla wszystkich aplikacji,
jednak¿e, je¿eli zainstalowa³e¶ dany zbiór orginalnie, powiniene¶ z pewno¶ci±
uaktualniæ go teraz nowym zbiorem.

Ponadto <tt>etc38.tgz</tt> oraz <tt>xetc38.tgz</tt> NIE s± rozpakowywane tutaj, 
jako ¿e s± zarz±dzane oddzielnie.

<li><b>Aktualizacja <tt>/dev</tt>.</b>
Nowy plik 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
zostanie skopiowany do /dev/ podczas instalacji <tt>base38.tgz</tt>, zatem powiniene¶
zwyczajnie wykonaæ poni¿sze: 

<blockquote><pre>
cd /dev
./MAKEDEV all
</pre></blockquote>

<li><b>Uaktualnij <tt>/etc</tt> jak poni¿ej</b>.

<li><b>Reboot</b>
</ul>

Podczas tego procesu,

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
mo¿e zwróciæ pewien b³±d podobny do poni¿szego:
<pre>
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or dire
    ctory, fs=., avail=-1, blocksize=380204
</pre>
Wiadomo¶æ ta mo¿e byæ bezpiecznie zignorowana, mo¿esz te¿ chcieæ zatrzymaæ
sendmail(8)-a na czas aktualizacji.

<hr>
<p>
<a name="etcUpdates"></a>
<h2>Uaktualnienia w  <tt>/etc</tt></h2>

Jakkolwiek wykonujesz aktualizacjê, czy to przez media instalacyjne
i wykonanie "formalnego" procesu aktualizacji, czy te¿ aktualizacjê binarn± "w-miejsce",
musisz wykonaæ kilka kroków.

<a name="users"></a>

<h4>Nowi u¿ytkownicy i grupy</h4>
Dodany zosta³ daemon HostAP, zatem wymagany jest nowy u¿ytkownik oraz grupa.

Jako <i>root</i>, dodaj poni¿szych u¿ytkowników oraz grupy korzystaj±c z 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
useradd -u86 -g=uid -c"HostAP Daemon" -d/var/empty -s/sbin/nologin _hostapd
</pre></blockquote>

Polecenie to spowoduje utworzenie nowego u¿ytkownika i powi±zanej z nim grupy.
Twoje ¶rodowisko powinno pozwoliæ ci skopiowaæ/wkleiæ te polecenia.

<a name="apps"></a>
<h4>Aplikacje przestrzeni u¿ytkownika</h4>

<a name="etcfiles"></a>
<h4>Zmiany w plikach w <tt>/etc</tt></h4>
Potrzebujesz rozpakowaæ pliki <tt>etc38.tgz</tt> do tymczasowej
lokalizacji:
<blockquote><pre>
cd /tmp
tar xzpf /<i>path</i>/etc38.tgz
</pre></blockquote>

Pliki które prawdopodobnie mog± byæ skopiowane z <tt>etc38.tgz</tt> "w takiej postaci
w jakiej s±":

<blockquote><pre>
hostapd.conf
netstart
pf.os
rc
services
mtree/*
</pre></blockquote>

Zauwa¿, ¿e JEST mo¿liwe by lokalnie zmodyfikowaæ te pliki, je¿eli to 
by³o zrobione, bêdzie konieczne rêczne scalenie.
Tutaj s± linie kopiuj/wklej do kopiowania tych plików, zak³adaj±c ¿e
rozpakowa³e¶ <tt>etc38.tgz</tt> w miejscu sugerowanym powy¿ej:

<blockquote><pre>
cd /tmp/etc
cp hostapd.conf netstart pf.os rc services /etc
cp mtree/* /etc/mtree/
</pre></blockquote>

<p>
Pliki które musz± byæ rêcznie w³±czone, uwzglêdniaj±c lokalne
zmiany w nich wykonane, je¿eli by³y modyfikowane z domy¶lnych,
w przeciwnym wypadku, po prostu równie¿ je skopiuj:

<blockquote><pre>
ftpusers
inetd.conf
login.conf
rc.conf
sysctl.conf
syslog.conf
mail/aliases
</pre></blockquote>

Zmiany w tych plikach znajduj± siê w <a href="../../upgrade38.patch">
tym patch-u</a>.
Mo¿esz spróbowaæ z niego skorzystaæ wykonuj±c jako root nastepuj±ce polecenie:
<blockquote><pre>
cd /
patch -C -p0 &lt;upgrade38.patch
</pre></blockquote>

Spowoduje to przetestowanie ³atki jak dobrze pasuje do TWOJEGO systemu,
aby j± zastosowaæ opu¶æ opcjê "<tt>-C</tt>".
Zauwa¿ ¿e jest prawdopodobne, w sytuacji w której posiadasz zmodyfikowane pliki,
nie s± odpowiednio aktualne, lub zosta³y uaktualnione z wersji snapshot 3.7,
¿e mog± nie zostaæ zaakceptowane czysto.
W takiej sytuacji, bêdziesz musia³ nêdznie uwzglêdniæ zmiany.
Prosimy wykonaj test tego procesu zanim siê na niego zdecydujesz dla maszyny
do której nie mo¿esz siê w ³atwy sposób dostaæ.

<p>
Zwróæ uwagê, ¿e w tym czasie zmianie uleg³ plik <tt>/etc/mail/aliases/</tt>,
zatem bêdziesz musia³ wykonaæ polecenie
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newaliases&amp;sektion=8">newaliases(8)</a>
by uwzglêdniæ zmiany.

<p>
W poni¿szych plikach zosta³y wprowadzone pewne zmiany na które nale¿y zwróciæ
uwagê, lecz nie mog± byæ bezpo¶rednio skopiowane lub scalone (przyk³adowo
je¿eli korzystasz z pf.conf, przyj¿yj siê sugerowanej zmianie strategii i 
zdecyduj czy jest w³a¶ciwa dla twoich potrzeb).

<blockquote><pre>
pf.conf
spamd.conf
/root/.profile
</pre></blockquote>

Ostatecznie skorzystaj z 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
by utworzyæ jakiekolwiek nowe katalogi:
<blockquote><pre>
mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre></blockquote>

<p>
<font color="#0000e0">

<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade38.html,v 1.18 ]<br>
$Translation: upgrade38.html,v 1.9 2006/05/13 00:20:46 tkniaz Exp $<br>
-->
$OpenBSD: upgrade38.html,v 1.8 2006/05/14 09:54:41 saad Exp $
</small>

</body>
</html>
