<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>5 - Tworzenie systemu ze ¼róde³</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<!-- Passes validator.w3.org.  Please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color= "#0000e0">
<a href= "index.html">[Spis tre¶ci]</a>
<a href= "faq4.html">[Sekcja 4 - Instalacja OpenBSD 3.3]</a>
<a href= "faq6.html">[Sekcja 6 - Sieæ]</a>
</font>

<h2><font color="#e00000">5 - Tworzenie systemu ze ¼róde³</font></h2>
<hr>

<p>
<h3>Spis tre¶ci</h3>
<ul>
<li><a href= "#Flavors">5.1 - W±tki OpenBSD</a>
<li><a href= "#Why">5.2 - Dlaczego potrzebujê w³asnego j±dra systemu?</a>
<li><a href= "#Options">5.3 - Pliki konfiguracyjne j±dra</a>
<li><a href= "#Building">5.4 - Kompilacja w³asnego j±dra</a>
<li><a href= "#BootConfig">5.5 - Konfiguracja j±dra podczas startu systemu</a>
<li><a href= "#VerboseBoot">5.6 - Otrzymywanie dok³adniejszych informacji podczas 
startu systemu</a>
<li><a href= "#config">5.7 - Zastosowanie config(8) do zmian w skompilowanym 
  j±drze</a>
</ul>
<hr>
<br>


<a name="Flavors"></a>
<h2>5.1 - W±tki OpenBSD</h2>
<!-- XXXversion - revise doodle -->
OpenBSD wystêpuje w trzech "w±tkach":
<ul>
<li><b>-release:</b> Wersja OpenBSD publikowana co sze¶æ miesiêcy na CD.
<li><b>-stable:</b>  Wersja 'Release', wraz z ³atkami (ang. patches) naprawiaj±cymi krytyczne dla bezpieczeñstwa i wydajno¶ci
    elementy systemu.
<li><b>-current:</b> Najaktualniejsza (chwilowa) wersja OpenBSD, która
    przekszta³ci siê w nastêpne wydanie 'Release'.
</ul>

Graficznie, rozwój tych w±tków wygl±da
tak:

<blockquote>
<pre>
       ,------o-----------o----X                    3.0 Stable
       |      .           .
       |      .    ,------o---------o----X          3.1 Stable
       |      .    |      .         .
       |      .    |      .    ,----o----------o--&gt; 3.2 Stable
       |      .    |      .    |    .          .
       |      .    |      .    |    .    ,-----o--&gt; 3.3 Stable
       |      .    |      .    |    .    |     .
       |      .    |      .    |    .    |     .
 --&gt;3.0Rel-----&gt;3.1Rel-----&gt;3.2Rel-----&gt;3.3Rel----&gt; Current 

          Czas ---&gt;
</pre>
</blockquote>

<p>
Co sze¶æ miesiêcy drzewo kodu jest rozga³êziane pomiêdzy <i>-current</i>, <i>-release</i> i
<i>-stable</i> -- <i>-release</i> staje siê pewnym wyró¿nionym etapem 
w historii drzewa kodu ¼ród³owego - nigdy siê nie
zmienia. Jest dostêpne na <a href="../../orders.html">p³ytach CD</a> i 
<a href="../../ftp.html">serwerach
FTP</a>.  <i>-Current</i> jest miejscem aktywnej pracy, i przekszta³ca siê
w nastêpne wydanie <i>-release</i> OpenBSD.

<p>
Wersja <i>-stable</i> (nazywana tak¿e "paczowan± ga³êzi±") bazuje na
<i>-release</i>, i jak mo¿na zauwa¿yæ, jest "odga³êzieniem" z
rozwojowej ¶cie¿ki OpenBSD.  Kiedy dokonywane s± wa¿ne zmiany w
<i>-current</i>, s± one tak¿e uwzglêdniane w ga³êziach <i>-stable</i>.
W powy¿szej ilustacji, pionowe wykropkowane linie oznaczaj± uaktualnienia,
które s± w³±czane do ga³êzi <i>-stable</i>. W powy¿szym
przyk³adzie mo¿na zauwa¿yæ, ¿e ga³±¼ <i>3.0-stable</i> koñczy siê wraz
z ukazaniem siê <i>3.2-release</i>, oraz <i>3.1-stable</i> koñczy siê
w momencie utworzenia <i>3.3-release</i> -- starsze wersje s± standardowo wspierane
a¿ do dwóch
wydañ wstecz.  Wspieranie starszych wersji jest czynno¶ci± wymagaj±c± wysi³ku i czasu,
i dlatego w czasie, kiedy mogliby¶my usprawniaæ starsze wydania,
wolimy skupiæ siê na rozwijaniu nowych funkcji systemu. Ga³±¼ <i>-stable</i> jest, z
za³o¿enia, bardzo prosta do utworzenia z <i>-release</i> tej samej wersji
(np., przej¶cie z <i>3.3-release</i> do <i>3.3-stable</i>).

<p>
Ga³±¼ <i>-stable</i> sk³ada siê z <i>-release</i> i ³atek (ang. patches), które s± umieszane na
<a href="../../errata.html">stronie z poprawkami</a>, oraz z kilku prostych usprawnieñ, nie wchodz±cych w zakres poprawek.
Zwykle dzia³anie <i>-stable</i> jest
identyczne jak <i>-release</i> na której bazuje. Je¶li zmianie ulegn±
<a href="http://www.openbsd.org/cgi-bin/man.cgi">podrêczniki man</a>
, to prawdopodobnie nie zostanie to uwzglêdnione w <i>-stable</i>. Innymi s³owy, wsparcie dla nowego
urz±dzenia NIE bêdzie dodane do <i>-stable</i>, podobnie nowa cecha systemu
rzadko kiedy bêdzie dodana, chyba ¿e zostanie uznana za bardzo wa¿n±.

<p>
Ostrze¿enie: <i>-current</i> jest "uciekaj±cym celem". Zmienia siê z minuty
na minutê,
i mo¿e ulec wielu zmianom zanim uka¿e siê w postaci
kodu ¼ród³owego. Jak wspomniano wcze¶niej, nie ma ¿adnej pewno¶ci, ¿e system
skompiluje siê lub bêdzie dzia³a³ (oczywi¶cie, wierzymy ¿e wszystko siê uda). Uzyskanie
<i>-current</i> ze ¼róde³ jest ca³kiem prawdopodobne, tak samo jak to, ¿e operacja ta
nie uda siê, mimo tego, ¿e jeszcze piêæ minut temu wszystko dzia³a³o
poprawnie. <b>Je¶li nie jeste¶ na to przygotowany, trzymaj siê zdala od
<i>-current</i>.</b>

<p>
Wiêkszo¶æ u¿ytkowników powinna korzystaæ z <i>-stable</i> lub <i>-release</i>.
Jak ju¿ zaznaczyli¶my, wielu ludzi korzysta z <i>-current</i> **on production
systems**. Jest to bardzo wa¿ne, ¿e jest kto¶ kto to robi, aby zidentyfikowaæ b³êdy i
przetestowaæ nowe funkcje. Jednak je¶li nie wiesz, jak prawid³owo opisaæ,
zdiagnozowaæ i poradziæ sobie z problemem, nie mów sobie (ani komukolwiek innemu),
¿e "pomagasz w projekcie" poprzez uruchamianie wersji <i>-current</i>.  "To
nie dzia³a!" nie jest <a href="../../pl/report.html#bugtypes">u¿ytecznym raportem o
b³êdach.</a>.  "Ostatnie zmiany w sterowniku pciide przerwa³y ich
kompatybilno¶æ z moim interfejsem IDE opartym na uk³adzie Slug. Przesy³am dmesg dzia³aj±cego i
uszkodzonego systemu..." mo¿e byæ u¿ytecznym raportem.

<p>
Zdarzaj± siê przypadki, w których "zwykli" u¿ytkownicy chc± byæ na
bie¿±co i korzystaj± z <i>-current</i>. Najczêstsz± przyczyn± jest przypadek, kiedy u¿ytkownik
posiada urz±dzenie,
które nie jest wspierane przez <i>-release</i> (tak wiêc równie¿ niewspierane przez <i>-stable</i>),
lub chce korzystaæ z nowych udogodnieñ wersji <i>-current</i>. W tym przypadku,
wybór mo¿e byæ pomiêdzy <i>-current</i> lub nie korzystaniem z urz±dzenia, i
<i>-current</i> bêdzie mniejszym z³em. Jednak¿e u¿ytkownik nie powinien wówczas oczekiwaæ
pomocy od twórców systemu.

<h3>Snapshot'y</h3>
Pomiêdzy kolejnymi oficjalnymi wydaniami OpenBSD, tworzone s± <i>snapshot'y</i> -- chwilowe wersje obrazuj±ce dokonuj±ce siê przemiany -- dostêpne
na <a href="../../ftp.html">FTP</a>. Jak sama nazwa wskazuje,
s± to skompilowane wersje kodu, który znajdowa³ siê w drzewie ¼róde³ danej platformy sprzêtowej, w momencie
skopiowania.
Pamiêtaj, ¿e dla niektórych platform, czas pomiêdzy kolejnymi "snapshots'ami" mo¿e wynosiæ wiele DNI.
nim zostanie udostêpniony. Niestety nikt nie obiecuje, ¿e
"snapshot'y" s± ca³owicie funkcjonalne, a nawet ¿e mo¿na je zainstalowaæ. Czêsto stworzenie
"snapshot'a" jest spowodowane zmian±, która wymaga testowania. Niektóre
platformy maj± tworzone "snapshot'y" prawie codziennie, inne
o wiele rzadziej. Je¶li pragniesz korzystaæ z <i>-current</i>, najnowszy
"snapshot" bêdzie zwykle tym, czego potrzebujesz, dlatego instalacja "snapshot'a" jest zwykle
dobrym punktem startu przed prób± samodzielnej kompilacji <i>-current</i>.

<p>
Czasem pada pytanie, czy jest jaka¶ mo¿liwo¶æ otrzymania kopii ¼róde³
kodu, który zosta³ u¿yty do stworzenia "snapshot'a". Odpowied¼ brzmi nie. Po pierwsze, nie ma z tego ¿adnej
znacz±cej korzy¶ci. Po drugie, "snapshot'y" s± tworzone kiedy jest
ochota, czas pozwala i s± dostêpne niezbêdne zasoby.  Na szybkich
platformach mo¿liwe jest tworzenie kilku "snapshot'ów" dziennie. Na
wolniejszych, mo¿e to zaj±æ tydzieñ lub d³u¿ej, aby go stworzyæ.
Wykonywanie zaznaczeñ b±d¼ zak³adek w kodzie ¼ród³owym drzewa dla ka¿dego "snapshot'a" by³oby
do¶æ niepraktyczne.

<h3>Utrzymywanie zgodno¶ci pomiêdzy elementami systemu</h3>
Wa¿ne jest zrozumienie, i¿ OpenBSD jest systemem operacyjnym, który powinien byæ
traktowany jako ca³o¶æ, a nie jako j±dro wraz z do³±czon± grup± narzêdzi.
Musisz byæ pewny, ¿e j±dro, "userland" (do³±czone
narzêdzia i pliki) i drzewo <a href="../../pl/ports.html"><tt>oprogramowania "ports"</tt></a>
s± ze sob± zgodne, bo je¶li nie mog± wyst±piæ nieoczekiwane k³opoty. Mówi±c innymi s³owy
(poniewa¿ ludzie pope³niaj± b³êdy), nie mo¿esz korzystaæ z naj¶wie¿szego drzewa
<tt>portów</tt> na systemie sprzed miesi±ca, lub przekompilowaæ j±dro ze ¼róde³ <i>-current</i>
i spodziewaæ siê, ¿e bêdzie ono funkcjonowaæ z oprogramowaniem pochodz±cym z <i>-release</i>. Tak,
to oznacza, ¿e musisz uaktualniaæ ca³y swój system, je¶li chcesz korzystaæ z nowego
programu, który zosta³ w³a¶nie dzisiaj dodany do drzewa portów. Przepraszamy,
powtórzymy to jeszcze raz, OpenBSD ma ograniczone zasoby.

<p>
Warto równie¿ pamiêtaæ, ¿e kiedy
<a href="../upgrade-minifaq.html">uaktualniasz system ze ¼róde³</a>, uaktualnienie
jest mo¿liwe <b>tylko w jednym kierunku: ze starszej do nowszej wersji</b>,
czyli ze <i>-stable</i> do <i>-current</i>. Nie mo¿esz korzystaæ z
<i>3.3-current</i> (lub snapshot'a), nastêpnie stwierdzaj±c, ¿e jeste¶ nara¿ony na zbyt du¿y
stres, chcesz wykonaæ krok w ty³ do <i>3.3-stable</i>. Jeste¶ pozostawiony sam sobie, je¶li
wybierzesz jak±kolwiek inn± ¶cie¿kê, ni¿ ta która jest wspierana, i nie spodziewaj siê, ¿e
ktokolwiek z twórców OpenBSD bêdzie Ci pomaga³ podczas przywracania uszkodzonego
systemu.

<p>
Chodzi o to, aby siê powa¿nie zastanowi³, zanim zaczniesz
korzystaæ z <i>-current</i>.


<p>
<a name= "Why"></a>
<h2>5.2 - Dlaczego potrzebujê w³asnego j±dra?</h2>

<p>
Oto kilka powodów dla których warto posiadaæ w³asne j±dro systemu, pomimo tego, ¿e jest to g³ównie przeznaczone
dla osób posiadaj±cych dobr± ogóln± wiedzê dotycz±c± dzia³ania systemu.

<ul>
  <li>Posiadasz komputer z bardzo ma³± ilo¶ci± pamiêci RAM i chcesz zaoszczêdziæ
      tak du¿o, jak to tylko mo¿liwe usuwaj±c niepotrzebne sterowniki urz±dzeñ, których nie u¿ywasz
  <li>Chcesz usun±æ standardowe ustawienia lub dodaæ opcje, które nie
      zosta³y ustawione standardowo
  <li>Chcesz uaktywniæ eksperymentalne opcje systemu
    
</ul>

<p>
W wiêkszo¶ci przypadków NIE potrzebujesz kompilowaæ w³asnego j±dra.
Standardowe j±dro (GENERIC) jest zwykle wszystkim, czego potrzebujesz. Jest
kilka powodów, dla których nie bêdziesz chcia³ tworzyæ w³asnego j±dra.
Podstawowym powodem jest to, ¿e ³atwo dokonaæ zmian w j±drze,
które wygl±daj± logicznie, ale nie dzia³aj±. Tu le¿y niebezpieczeñstwo.
Je¶li zdaje Ci siê, ¿e co¶ nie dzia³a poprawnie, spróbuj
j±dro GENERIC, zanim wy¶lesz raport o b³êdach. Twórcy systemu
zwykle ignoruj± raporty dotycz±ce specyficznych j±der systemów, chyba ¿e
problem powtarza siê równie¿ przy j±drze GENERIC. Pamiêtaj, 
ostrzegali¶my.

<p>
<a name= "Options"></a>
<h2>5.3 - Pliki konfiguracyjne j±dra</h2>
Generowanie j±dra OpenBSD jest kontrolowana przez pliki konfiguracyjne, które
domy¶lnie s± zlokalizowane w katalogu<tt>/usr/src/sys/arch/<i>&lt;arch&gt;</i>/conf/</tt>.
Wszystkie architektury posiadaj± plik <tt>GENERIC</tt>, który jest
wykorzystywany do generowania standardowego j±dra OpenBSD dla tej platformy.
Mog± tak¿e znajdowaæ siê tam inne pliki konfiguracyjne, które s± u¿ywane do
tworzenia j±der o konkretnym przeznaczeniu, na przyk³ad, dla systemów o ma³ej
ilo¶ci pamiêci RAM, bezdyskowych stacji roboczych, itp.

<p>
Pliki konfiguracyjne s± przetwarzane przez program
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>,
który tworzy i zape³nia katalog kompilacyjny - <tt>../compile</tt>
(w przypadku typowej instalacji), czyli w katalogu
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/compile/</tt>. config(8) tworzy tak¿e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">Makefile</a>,
oraz inne pliki niezbêdne do pomy¶lnego zbudowania j±dra.

<p>
Opcje konfiguracji j±dra umo¿liwiaj± umieszczenie w j±drze
pewnych funkcji rozszerzaj±cych funkcjonalno¶æ. Pozwalaj±
na wybór elementów, które bêd± wspierane (a które nie) -- np. dla
urz±dzeñ, których nie ma w systemie. Jest mnóstwo opcji, które pomog±
dostosowaæ j±dro do w³asnych potrzeb. W tym dokumencie przedstawimy tylko
niektóre z nich, te najczê¶ciej u¿ywane. Sprawd¼ stronê podrêcznika 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>,
aby uzyskaæ bardziej szczegó³ow± listê, a poniewa¿ zmenia siê ona od czasu do
czasu, powiniene¶ upewniæ siê, ¿e jest przegl±dasz podrêcznik z tej samej
wersji, której j±dro budujesz. Mo¿esz tak¿e przegl±dn±æ przyk³ad plików
konfiguracyjnych dla Twojej architektury.

<p>
Nie umieszczaj ¿adnej opcji w swoim j±drze, chyba ¿e masz aktualnie
powód ¿eby to zrobiæ! Najbardziej przetestowany jest zawsze
zestaw opcji j±dra GENERIC. Zwykle jest to kombinacja opcji w
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/conf/GENERIC</tt>
i <tt>/usr/src/sys/conf/GENERIC</tt> dostarczonych przez dru¿ynê OpenBSD
(np NIE edytowane). Zg³aszanie problemu na dostrajanym j±drze prawie zawsze
spowoduje, ¿e zostaiesz poproszony, aby spróbowaæ zreprodukowaæ problem
na j±drze GENERIC. Nie wszystkie opcje s± kompatybilne ze sob± nawzajem,
oraz wiele opcji jest wymaganych aby system dzia³a³. Nie ma gwarancji, ¿e
tylko dlatego, ¿e zdo³a³e¶ skompilowaæ dostrojone j±dro, bêdzie ono dzia³aæ.

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Pliki konfiguracyjne j±dra alphy</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Pliki konfiguracyjne j±dra i386</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/macppc/conf/">Pliki konfiguracyjne j±dra macppc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Pliki konfiguracyjne j±dra sparc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc64/conf/">Pliki konfiguracyjne j±dra sparc64</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/vax/conf/">Pliki konfiguracyjne j±dra vax</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Pozosta³e architektury</a>
</ul>

<p>
Gdy przyjrzyjmy siê bli¿ej tym plikom i wtedy zobaczymy na górze taki wpis:<br>
<pre>
   include "../../../conf/GENERIC"
</pre>
Co oznacza, ¿e odnosimy siê do konfiguracji zawartej w innym pliku konfiguracyjnym. Ten
plik zawiera opcje niezale¿ne od platformy sprzêtowej. Wiêc kiedy tworzysz w³asn± konfiguracjê j±dra
przegl±dnij tak¿e
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">sys/conf/GENERIC</a>. 

<p>
Wszystkie opcje przedstawione poni¿ej powinny byæ umieszczane w pliku
konfiguracyjnym j±dra w nastêpuj±cym formacie:<br>
<strong>option      OPTION</strong><br>
Na przyk³ad, aby wstawiæ opcje debugowania w j±dro, powiniene¶ dodaæ poni¿sz± liniê:<br>
<strong>option	    DEBUG</strong><br>
Opcje w j±drze OpenBSD s± t³umaczone na opcje preprocesora kompilatora,
dlatego opcja taka jak DEBUG mog³aby byæ wprowadzona poprzez kompilacjê
z opcj± -DDEBUG. Co jest równoznaczne z <tt>#define DEBUG</tt>
w ka¿dym fragmencie j±dra.

<p>
Czasem mo¿esz chcieæ wy³±czyæ jak±¶ opcje, która jest ju¿ zdefiniowana,
zwykle w pliku "<tt>src/sys/conf/GENERIC</tt>". Mimo, i¿ móg³by¶ zmodyfikowaæ
kopie tego pliku, lepszym rozwi±zaniem by³oby wykorzystanie wyra¿enia
<i>rmoption</i>.  Na przyk³ad, je¶li naprawdê chcia³by¶ wy³±czyæ
wewnêtrzny debugger j±dra (<i>nie polecane!</i>), doda³by¶ liniê podobn±
do tej:
<pre>
   rmoption DDB
</pre>
w swoim pliku konfiguracyjnym j±dra. <tt>option DDB</tt> jest zdefiniowana w
<tt>src/sys/conf/GENERIC</tt>, lecz powy¿sza linia <tt>rmoption</tt>
wy³±cza j±.

<p>
Ponownie, proszê zobacz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>
w celu uzyskania wiêkszej ilo¶ci informacji o tych opcjach. Zauwa¿ tak¿e, ¿e
wiele opcji posiada w³asne strony man -- zawsze przeczytaj wszystko
co jest dostêpne o danej opcji przed dodaniem lub usuniêciem jej z swojego
j±dra.

<p> 
<a name= "Building"></a>
<h2>5.4 - Kompilacja w³asnego j±dra</h2>

<p>
Pe³ny opis instrukcji prowadz±cych do stworzenia w³asnego j±dra systemu znajduj± siê w podrêczniku OpenBSD
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&amp;sektion=8">
afterboot(8)</a>.

<p>
Aby skompilowaæ j±dro systemu z cdrom'u potrzebujesz najpierw kod
¼ród³owy. Jest on dostêpny na
<a href="../../orders.html">oficjalnym CD</a> (dysk 3) i na
<a href="../../ftp.html">serwerach FTP</a>. Poni¿szy przyk³ad zak³ada,
¿e CD3 jest zamontowany w /mnt:

<blockquote>
<pre>
# <strong>cd /usr/src</strong>
# <strong>tar xvzf /mnt/src.tar.gz</strong>
</pre>
</blockquote>

<b>Uwaga:</b> Je¶li bêdziesz pobiera³ ¼ród³a z jednego z serwerów FTP, znajdziesz tam
DWA pliki, <i>src.tar.gz</i> i <i>srcsys.tar.gz</i>.  Pierwszy z nich jest
"userland'em" -- wszystko oprócz j±dra systemu, drugi jest w³a¶nie kodem ¼ród³owym
j±dra. ¦ci±gnij i rozpakuj oba z nich (tak jak pokazano powy¿ej), do wiêkszo¶ci zastosowañ
bêdziesz potrzebowaæ obu. Na CDROM'ie, pliki te s± po³±czone w jeden.

<p>
Teraz aby stworzyæ swoje w³asne j±dro, najpro¶ciej skorzystaæ z j±dra
GENERIC. Znajduje siê ono w pliku <tt>/usr/src/sys/arch/$ARCH/conf/GENERIC</tt>,
gdzie $ARCH oznacza architekturê twojego sprzêtu. W tym katalogu s± równie¿
dostêpne inne przyk³adowe konfiguracje. Teraz przedstawimy dwa przyk³ady kompilacji
twojego j±dra. Pierwszy przyk³ad pokazuje metodê kompilacji j±dra na drzewie kodu ¼ród³owego
tylko do odczytu, drugi natomiast na zapisywalnym.

<blockquote> 
<pre>
# <strong>cd /somewhere</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .</strong>
# <strong>vi SOMEFILE</strong>   <i>(w celu dokonania zmian)</i>
# <strong>config -s /usr/src/sys -b . SOMEFILE</strong>
</pre>
nastêpnie jeden z nastêpuj±cych:

<pre>
    # <strong>make depend</strong>
         <b><i>- LUB -</i></b>
    # <strong>make clean</strong>
# <strong>make</strong>
</pre>
</blockquote>

Musisz uruchomiæ '<tt>make depend</tt>' kiedy dokona³e¶ jakichkolwiek zmian
(w tym tak¿e uaktualnieñ lub ³atek) do swojego drzewa kodu ¼ród³owego (innymi s³owy,
prawie zawsze, w przeciwnym razie musisz uruchodmiæ '<tt>make clean</tt>').

<p>
Je¶li dokona³e¶ zmian w opcjach konfiguracyjnych j±dra, i/lub
dokona³e¶ znacznych zmian w drzewie kodu ¼ród³owego, powiniene¶ u¿yæ '<tt>make
clean</tt>' zamiast powy¿szego '<tt>made depend</tt>'. Pamiêtaj, ¿e
zawsze jest bezpieczniej wykonaæ 'make clean', pomimo ¿e skutkuje to d³u¿szym
czasem kompilacji, im wiêcej zosta³o zmienione.

<p>
Aby skompilowaæ j±dro wewn±trz zapisywalnego drzewa kodu ¼ród³owego wykonaj poni¿sze instrukcje:

<blockquote>
<tt>
# <strong>cd sys/arch/$ARCH/conf</strong><br>
# <strong>vi SOMEFILE</strong><i> (w celu dokonania zmian)</i><br>
# <strong>config SOMEFILE</strong><i> (przeczytaj wiêcej na ten temat tu:
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>)</i><br>
# <strong>cd ../compile/SOMEFILE</strong><br>
# <strong>make</strong> <br>
</tt>
</blockquote>

<p>
Gdzie $ARCH jest architektur± twojego systemu (np. i386). Mo¿esz tak¿e wykonaæ
<strong>make depend</strong>, aby stworzyæ zale¿no¶ci na wypadek
nastêpnej kompilacji j±dra.

<p>
Przenie¶ swoje j±dro na miejsce:

<blockquote>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd</strong>
</pre>
</blockquote>

Aby przywróciæ wystartowaæ system z poprzedniego j±dra, podczas startu systemu musisz wpisaæ:

<blockquote>
<pre>
boot&gt; <strong>bsd.old</strong>
</pre>
</blockquote>

i twoje stare j±dro zostanie za³adowane zamiast /bsd.

<p>
Zdarza siê, ¿e kiedy kompilujesz nowe j±dro musisz zainstalowaæ
nowe bloki startowe (ang. bootblocks). Aby tego dokonaæ, przeczytaj <a href="../faq14.html#InstBoot">FAQ 14,
Instalacja bloków startowych</a>, gdzie znajdziesz informacje dotycz±ce korzystania z
Startera OpenBSD.

<p>
<a name= "BootConfig"></a>
<h2>5.5 - Konfiguracja j±dra podczas startu systemu </h2>

<p>
Czasem podczas startu systemu mo¿e siê okazaæ, ¿e twoje j±dro znajduje
nowe urz±dzenia, ale byæ mo¿e na z³ym przerwaniu (IRQ). I mo¿liwe, ¿e bêdziesz musia³ u¿yæ tego
urz±dzenia w³a¶nie teraz. Aby¶ nie musia³ przekompilowywaæ j±dra mo¿esz u¿yæ
konfiguracji j±dra OpenBSD podczas startu systemu. Taka operacja rozwi±¿e twój
problem tylko ten jeden raz. Je¶li uruchomisz komputer ponownie, bêdziesz musia³ powtórzyæ t±
procedurê. Wiêc jest to tylko tymczasowa naprawa, i powiniene¶
usun±æ ten problem przez rekonfiguracjê i kompilacjê j±dra. Aby korzystaæ z konfiguracji podczas startu systemu j±dro twojego systemu musi posiadaæ wpis <strong>option BOOT_CONFIG</strong>, który jest zawarty
w j±drze GENERIC.

<p>
Wiêkszo¶æ informacji w tym temacie mo¿e byæ znalezione w podrêczniku
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&amp;sektion=8">boot_config(8)</a>.

<p>
Aby dostaæ siê do Konfiguracji J±dra przez U¿ytkownika (ang. UKC = User Kernel Config), podczas startu systemu u¿yj
opcji -c.

<blockquote><pre>
boot&gt; <strong>boot wd0a:/bsd -c</strong>
</pre></blockquote>

Lub zastosuj twoj± nazwê j±dra, które chcesz zastosowaæ. U¿ycie tego spowoduje pojawienie siê
znaku zachêty UKC. W tym miejscu mo¿esz wydawaæ komendy bezpo¶rednio do j±dra
okre¶laj±c urz±dzenia które chcesz zmieniæ, wy³±czyæ lub w³±czyæ.

<p>
Poni¿ej znajduje siê lista najczêstszych komend UKC.

<ul>
<li><tt>add <strong>device</strong></tt> - Dodaje urz±dzenie poprzez kopiowanie innego
<li><tt>change <strong>devno | device </strong></tt> - Modyfikuje jedno lub wiêcej urz±dzenie
<li><tt>disable <strong>devno | device </strong></tt> - Wy³±cza jedo lub wiêcej urz±dzenie
<li><tt>enable <strong>devno | device </strong></tt> - W³±cza jedno lub wiêcej urz±dzenie
<li><tt>find <strong>devno | device </strong></tt> - Znajduje jedno lub wiêcej urz±dzenie
<li><tt>help</tt> - Krótkie podsumowanie komend UKC
<li><tt>list</tt> - Wy¶wietlenie WSZYSTKICH znanych urz±dzeñ
<li><tt>exit/quit</tt> - Kontynuacja startu systemu
<li><tt>show <strong>[attr [val]]</strong></tt> - Pokazuje urz±dzenia z atrybutami i
  opcjonalnie z podan± warto¶ci±
</ul>

<p>
Kiedy ju¿ skonfigurujesz swoje urz±dzenie, u¿yj komendy quit lub exit, aby kontynuowaæ
start systemu. Nastêpnie powiniene¶ skorygowaæ ustawienia j±dra i
dokonaæ kompilacji nowego j±dra. Udaj siê do <a href="faq5.html#Building">Kompilacja
w³asnego j±dra</a>, aby uzyskaæ pomoc.

<p>
<a name= "VerboseBoot"></a>
<h2>5.6 - Otrzymywanie dok³adniejszych informacji podczas 
startu systemu</h2>

Otrzymywanie dok³adniejszych informacji podczas startu systemu mo¿e byæ bardzo pomocne, gdy próbujesz ustaliæ powody
problemów boot'owania. Je¶li nie mo¿esz wystartowaæ systemu z dyskietki
i potrzebujesz dok³adniejszych informacji, poprostu ponownie uruchom komputer. Kiedy otrzymasz
znak zachêty &quot;boot&gt;&quot;, wystartuj poprzez komendê boot -c. To doprowadzi Ciê
do UKC&gt;, gdzie wykonaj:

<blockquote><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enabled
UKC&gt; <strong>quit</strong>
</pre></blockquote>

<p>
Wówczas otrzymasz bardzo szczegó³owe komunikaty dotycz±ce w³±czaj±cego siê systemu.

<p>
<a name= "config"></a>
<h2>5.7 - Zastosowanie config(8) do zmian w skompilowanym 
  j±drze</h2>
<p>
Parametry <b>-e</b> i <b>-u</b> funkcji
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
mog± byæ wyj±tkowo po¿yteczne i oszczêdz± czas na kompilacjê j±dra.
Parametr <b>-e</b> pozwala na wprowadzenie ustawieñ dla UKC (ang. User Kernel Config) stosowanych
przy starcie systemu. Zmiany te bêd± dzia³a³y przy nastêpnym uruchomieniu komputera.
Natomiast opcja <b>-u</b> pokazuje jakie zmiany zosta³y dokonane podczas
startu systemu, czyli te, wprowadzone po komendzie <b>boot -c</b> w menu UKC.


<p>
Poni¿szy przyk³ad obrazuje wy³±czanie urz±dzeñ ep* w
j±drze. Przez wzgl±d na bezpieczeñstwo powiniene¶ u¿ywaæ opcji <b>-o</b>, która zapisuje
zmiany do podanego pliku. Dla przyk³adu : <strong>config -e
-o bsd.new /bsd</strong> zapisze zmiany do bsd.new. Nasz przyk³ad
nie korzysta z opcji <b>-o</b>, dlatego zmiany s± po prostu ignorowane,
i nie s± zapisywane do pliku j±dra. Aby uzyskaæ wiêcej informacji
odnosz±cych siê do b³êdów i ostrze¿eñ przeczytaj stronê podrêcznika
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
.

<blockquote><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 3.3 (GENERIC) #44: Sat Mar 29 13:22:05 MST 2003
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc&gt; ?
        help                            Command help list
        add         dev                 Add a device
        base        8|10|16             Base on large numbers
        change      devno|dev           Change device
        disable     attr val|devno|dev  Disable device
        enable      attr val|devno|dev  Enable device
        find        devno|dev           Find device
        list                            List configuration
        lines       count               # of lines per page
        show        [attr [val]]        Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
        timezone    [mins [dst]]        Show/change timezone
        nmbclust    [number]            Show/change NMBCLUSTERS
        cachepct    [number]            Show/change BUFCACHEPERCENT
        nkmempg     [number]            Show/change NKMEMPAGES
        shmseg      [number]            Show/change SHMSEG
        shmmaxpgs   [number]            Show/change SHMMAXPGS
ukc&gt; <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*|neo*|cmpci*
|clcs*|clct*|auich*|autri*|auvia*|fms*|uaudio*|maestro*|esa*|yds*|emu* flags 0x0
  1 midi* at sb0|sb*|opl*|opl*|opl*|opl*|ym*|mpu*|autri* flags 0x0
  2 nsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  3 nsphyter* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|
vr*|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep
*|ep*|ep* phy -1 flags 0x0
  4 qsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  5 inphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  6 iophy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  7 eephy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  8 exphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
[...snip...]
ukc&gt; <strong>disable ep</strong>
 67 ep0 disabled
 68 ep* disabled
 69 ep* disabled
155 ep0 disabled
156 ep0 disabled
157 ep* disabled
158 ep* disabled
210 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</pre></blockquote>

<p>
W powy¿szym przyk³adzie, wszystkie urz±dzenia ep* s± wy³±czane w j±drze i nie bêd±
badane. Czasami kiedy u¿yjesz menu UKC podczas startu,
poprzez komendê <b>boot -c</b>, chcia³by¶ aby te zmiany by³y zapisane na
sta³e. Wówczas nale¿y u¿yæ opcji <b>-u</b>.
W nastêpnym przyk³adzie, komputer startuje wykonuj±c menu UKC i
urz±dzenie wi(4) jest wy³±czane. Po zmianach dokonanych przy pomocy boot -c, które nie s±
sta³e, nale¿y je zapisaæ. Ten przyk³ad zapisuje
zmiany przeprowadzone komend± boot -c do nowego j±dra bsd.new.

<blockquote><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 3.3 (GENERIC) #44: Sat Mar 29 13:22:05 MST 2003
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
105 wi* disabled
106 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</pre></blockquote>


<p>
<font color= "#0000e0">
<a href= "index.html">[Spis tre¶ci]</a>
<a href= "faq4.html">[Sekcja 4 - Instalacja OpenBSD 3.3]</a>
<a href= "faq6.html">[Sekcja 6 - Sieæ]</a>
</font>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[powrót]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq5.html,v 1.83 ]<br>	
$Translation: faq5.html,v 1.3 2003/06/14 17:02:59 pl-team Exp $<br>
$OpenBSD: faq5.html,v 1.3 2003/06/15 12:09:54 jufi Exp $
</small>
</body>
</html>
