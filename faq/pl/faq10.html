<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>10 - Zarz±dzanie systemem</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta http-equiv="Content-Language" content="pl">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2004
by OpenBSD.">
</head>


<body bgcolor= "#ffffff" text= "#000000">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color= "#0000e0">
<a href= "index.html">[Spis tre¶ci]</a>
<a href= "faq9.html">[Sekcja 9 - Migracja z Linuksa]</a>
<a href= "faq11.html">[Sekcja 11 - Dostrajanie wydajno¶ci]</a>
</font>

<h1><font color="#e00000">10 - Zarz±dzanie systemem</font></h1>


<!--
UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC

<hr>
<p>
<b><font color="#e00000">Uwaga:</font></b>Zawarto¶æ tego pliku
jest ju¿ bardzo nieaktualna w stosunku do
<a href="../faq10.html">bie¿±cej wersji anglojêzycznej</a>.

<p>
Je¶li chcesz pomóc w aktualizacji tego pliku, zajrzyj na
<a href="../../translation.html">stronê t³umaczeñ</a>.

-->

<hr>

<p>
<h3>Spis tre¶ci</h3>
<ul>
<li><a href="#wheel"         >10.1 - Dlaczego system odpowiada, ¿e nie
	nale¿ê do odpowiedniej grupy, kiedy próbujê wydaæ polecenie su?</a>
<li><a href="#DupFS"         >10.2 - Jak zrobiæ kopiê systemu plików?</a>
<li><a href="#rc"            >10.3 - W jaki sposób automatycznie
	uruchamiaæ demony przy starcie systemu? (Prezentacja rc(8))</a>
<li><a href="#RelayingDenied">10.4 - Dlaczego u¿ytkownicy otrzymuj± 
	komunikat "relaying access denied" gdy próbuj± wys³aæ zdalnie
	pocztê przez moj± maszynê dzia³aj±c± na OpenBSD?</a>
<li><a href="#POP"           >10.5 - Uruchomi³em serwer POP, ale u¿ytkownicy
	maj± k³opoty z odbiorem maili poprzez ten protokó³. Co mam zrobiæ?</a>
<li><a href="#SendmailDNS"   >10.6 - Dlaczego Sendmail ignoruje
	plik <tt>/etc/hosts</tt>?</a>
<li><a href="#HTTPS"         >10.7 - Konfigurowanie bezpiecznego serwera HTTP
	z wykorzystaniem ssl(8)</a>
<li><a href="#vipw"          >10.8 - Dokona³em zmian w /etc/passwd, ale
	nie zosta³y one uwzglêdnione. Dlaczego?</a>
<li><a href="#AddDelUser"    >10.9 - Jaki jest najlepszy sposób na
	dodanie/usuniêcie u¿ytkownika?</a>
<li><a href="#FTPOnly"       >10.10 - Jak stworzyæ konto umo¿liwiaj±ce 
	logowanie tylko przez FTP?</a>
<li><a href="#Quotas"        >10.11 - Konfigurowanie kwot dyskowych</a>
<li><a href="#Kerberos"      >10.12 - Konfigurowanie klientów i serwerów
	KerberosV</a>
<li><a href="#AnonFTP"       >10.13 - Konfigurowanie anonimowego serwera FTP</a>
<li><a href="#ftpchroot"     >10.14 - Ograniczanie dostêpu u¿ytkowników
	wy³±cznie do ich katalogów domowych w ftpd(8)</a>
<li><a href="#Patches"       >10.15 - £atanie systemu OpenBSD</a>
<li><a href="#httpdchroot"   >10.16 - Zastosowanie ¶rodowiska chroot() 
	dla serwera Apache.</a>
<li><a href="#rootshell"     >10.17 - Nie podoba mi siê domy¶lna pow³oka 
	roota!</a>
<li><a href="#ksh"           >10.18 - Co jeszcze mo¿na zrobiæ z ksh?</a>
</ul>

<hr>

<p>
<a name= "wheel"></a>
<h2>10.1 - Dlaczego system odpowiada, ¿e nie nale¿ê do odpowiedniej grupy, 
kiedy próbujê wydaæ polecenie su?</h2>

<p>
U¿ytkownicy posiadaj±cy ju¿ konto w systemie musz± zostaæ dopisani do
grupy <kbd>&quot;wheel&quot;</kbd> rêcznie. Robi siê tak dla zwiêkszenia
bezpieczeñstwa - po to, by za ka¿dym razem mieæ chwilê na zastanowienie,
czy dany u¿ytkownik na pewno powinien otrzymaæ tak wysokie przywileje.
W systemie OpenBSD tylko u¿ytkownicy nale¿±cy do grupy <kbd>wheel</kbd>
maj± prawo u¿ywaæ polecenia <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1"
>su(1)</a> w celu uzyskania praw roota. U¿ytkownicy, którzy nie 
nale¿± do grupy <kbd>&quot;wheel&quot;</kbd>, nie mog± korzystaæ z 
polecenia su(1). Istniej±cego u¿ytkownika mo¿na dodaæ do grupy wheel 
odpowiednio redaguj±c plik <kbd>/etc/group</kbd>. 
Zamieszczony poni¿ej wpis z tego pliku uwzglêdnia u¿ytkownika
<strong>ericj</strong> (oraz roota) jako cz³onka grupy
<kbd>&quot;wheel&quot;</kbd>.

<p>
Dodaj±c nowego u¿ytkownika za pomoc± polecenia <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8"
>adduser(8)</a>, mo¿na od razu dodaæ go do grupy wheel po prostu 
wpisuj±c "wheel" w odpowiedzi na pytanie "<tt>Invite <i>user</i>
into other groups:</tt>". W ten sposób u¿ytkownik zostanie automatycznie
dodany do grupy "wheel" w pliku /etc/group:

<blockquote><pre>
wheel:*:0:root,ericj
</pre></blockquote>

<p>
Czêsto chcemy zwiêkszyæ uprawnienia danego u¿ytkownika, ale w sposób 
kontrolowany, nie nadaj±c mu wszystkich praw roota. Dok³adnie w tym
celu zosta³ stworzony program 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8"
>sudo(8)</a>.

<p>
<a name= "DupFS"></a>
<h2>10.2 - Jak zrobiæ kopiê systemu plików?</h2>

<p>
W celu skopiowania systemu plików mo¿na skorzystaæ z programów <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8"
>dump(8)</a> i <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8"
>restore(8)</a>.
Na przyk³ad, aby skopiowaæ zawarto¶æ katalogu <kbd>SRC</kbd> do katalogu
<kbd>DST</kbd> wystarczy wydaæ nastêpuj±ce polecenie:

<blockquote><pre>
# <strong>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</strong>
</pre></blockquote>

<p>
Dump zosta³ zaprojektowany tak, aby spe³niaæ ró¿norodne
wymagania dotycz±ce wykonywania kopii zapasowych i 
mo¿e byæ zbyt skomplikowanym narzêdziem, je¿eli chcemy skopiowaæ
tylko czê¶æ (albo nawet ca³o¶æ) systemu plików. Dla prostszych 
zastosowañ szybszy mo¿e okazaæ siê program 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&amp;sektion=1"
>tar(1)</a>. Sk³adnia tego polecenia jest bardzo podobna jak w 
poprzednim przyk³adzie:

<blockquote>
<pre>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</pre>
</blockquote>

<p>
<a name= "rc"></a>
<h2>10.3 - W jaki sposób automatycznie uruchamiaæ demony przy
starcie systemu? (Prezentacja rc(8))</h2>

<p>
OpenBSD uruchamia demony podczas startu sytemu poprzez <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">rc(8)</a>.
Korzysta on przy tym z kilku pomocniczych skryptów i plików
konfiguracyjnych:

<ul>
	<li>/etc/rc - Skrypt g³ówny. Nie powinien byæ modyfikowany.
	<li>/etc/rc.conf - Plik konfiguracyjny u¿ywany przez <i>/etc/rc</i> w 
celu zdefiniowania demonów uruchamianych przy starcie systemu.
       <li>/etc/rc.conf.local - Plik konfiguracyjny, który mo¿e 
byæ wykorzystany w celu zmiany ustawieñ zapisanych w /etc/rc.conf. 
Dziêki temu nie ma potrzeby redagowaæ /etc/rc.conf. Jest to 
szczególnie wygodne dla osób, które czêsto uaktualniaj± system.
	<li>/etc/netstart - Skrypt u¿ywany do inicjalizowania obs³ugi 
sieci. Nie powinien byæ modyfikowany.
	<li>/etc/rc.local - Skrypt u¿ywany do celów administracji lokalnej.
To tu nale¿y przechowywaæ informacje o nowych demonach i hostach.
	<li>/etc/rc.securelevel - Skrypt wykonuj±cy niezbêdne czynno¶ci przed 
zmian± poziomu bezpieczeñstwa systemu. Przeczytaj <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&amp;sektion=8"
>init(8)</a>
	<li>/etc/rc.shutdown - Skrypt uruchamiany przed zatrzymaniem pracy 
systemu. Wstawia siê tam to, co powinno byæ zrobione przed zamkniêciem 
systemu. Przeczytaj <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&amp;sektion=8"
>rc.shutdown(8)</a>
</ul>

<h3>Jak dzia³a rc(8)?</h3>

<p>
Najwa¿niejszymi plikami, na których powinien skupiæ siê administrator 
systemu s± <i>/etc/rc.conf</i> (albo <i>/etc/rc.conf.local</i>), 
<i>/etc/rc.local</i> oraz <i>/etc/rc.shutdown</i>. Na pocz±tku 
opiszmy jednak poszczególne czynno¶ci wykonywane przez skrypt rc(8):

<p>
Po za³adowaniu j±dra systemu, rozpoczyna pracê <i>/etc/rc</i>:
<ul>
       <li>Dokonywane jest sprawdzenie systemów plików. Krok ten jest pomijany,
je¿eli istnieje plik /etc/fastboot (zdecydowanie to jednak odradzamy).
       <li>Z pliku <i>/etc/rc.conf</i>, a potem <i>/etc/rc.conf.local</i> 
odczytywane s± zmienne konfiguracyjne. Ustawienia z pliku rc.conf.local 
nadpisuj± konfiguracjê zapisan± w pliku rc.conf.
	<li>Nastêpuje podmontowanie systemów plików.
	<li>Dokonywane jest wyczyszczenie katalogu <i>/tmp</i> oraz zachowanie 
plików tekstowych redagowanych przed ponownym uruchomieniem systemu.
	<li>Nastêpuje konfiguracja sieci za pomoc± skryptu <i>/etc/netstart</i>
		<ul>
		<li>Konfiguracja interfejsów.
		<li>Ustawienie nazwy hosta, nazwy domeny, itp.
		</ul>
	<li>Uruchomienie demonów systemowych.
       <li>Dokonanie ró¿nego rodzaju sprawdzeñ i dzia³añ (kwoty, savecore, 
itd.)
       <li>Uruchomienie lokalnych demonów z <i>/etc/rc.local</i>
</ul>

<h3>Uruchamianie demonów i us³ug systemowych</h3>

<p>
Wiêkszo¶æ dostarczonych z systemem OpenBSD demonów i us³ug
mo¿na uruchomiæ podczas startu systemu przez prost± modyfikacjê 
pliku konfiguracyjnego <i>/etc/rc.conf</i>. Na pocz±tek przyjrzyjmy siê 
domy¶lnej zawarto¶ci pliku <a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf"
>/etc/rc.conf</a>. Znajduj± siê tam linie podobne do tej:

<blockquote><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
</pre></blockquote>

<p>
Zamieszczony powy¿ej wpis oznacza, ze ftpd nie powinien byæ 
uruchamiany przy starcie systemu (a przynajmniej nie przez rc(8), 
przeczytaj dzia³ <a href="faq10.html#AnonFTP">Konfigurowanie anonimowego 
serwera FTP</a>, by dowiedzieæ siê wiêcej na ten temat). Tak czy
inaczej, ka¿dy wpis zawiera tak¿e komentarz opisuj±cy flagi (opcje) 
<b>NORMALNEJ</b> pracy demona lub us³ugi. Nie oznacza to, ¿e trzeba 
uruchamiaæ tego czy innego demona czy us³ugê z dok³adnie tymi samymi 
ustawieniami. Zawsze mo¿na skorzystaæ z podrêcznika systemowego, aby 
sprawdziæ, jakiej opcji u¿yæ w celu osi±gniêcia zamierzonego efektu.
Na przyk³ad, poni¿sza linia pokazuje domy¶lne ustawienie demona httpd(8).

<blockquote><pre>
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
</pre></blockquote>

<p>
Jak widaæ, w tym przypadku httpd mo¿e byæ uruchomiony bez 
jakichkolwiek opcji. A zatem potrzebny by³by tylko taki wpis: 
<b>httpd_flags=""</b>. W przypadku, gdy chcieliby¶my uruchomiæ 
httpd z obs³ug± ssl (patrz <a href="#HTTPS">SSL FAQ</a> lub <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8"
>ssl(8)</a>) nale¿a³o by napisaæ: httpd_flags="-DSSL".

<p>
Dobrym zwyczajem jest w ogóle nie zmieniaæ 
<i>/etc/rc.conf</i>. Zamiast tego mo¿na utworzyæ plik 
<i>/etc/rc.conf.local</i> i skopiowaæ do niego te linie, które mamy 
zamiar zmieniæ w <i>/etc/rc.conf</i>, a potem dostosowaæ je do w³asnych 
potrzeb. Mo¿e to w przysz³o¶ci znacznie u³atwiæ proces przechodzenia na 
nowsz± wersjê systemu - wszystkie zmiany s± zapisane bowiem w tym 
jednym pliku.

<h3>Uruchamianie i konfiguracja lokalnych demonów</h3>

<p>
W przypadku demonów lokalnych, czyli doinstalowanych z portów, pakietów 
czy w dowolny inny sposób, nale¿y korzystaæ z pliku <i>/etc/rc.local</i>. 
Na przyk³ad, je¿eli zainstalowali¶my demona, który znajduje siê w 
/usr/local/sbin/daemonx i chcemy, aby uruchamia³ siê on przy starcie 
systemu, to do pliku <i>/etc/rc.local</i> powinni¶my dodaæ nastêpuj±cy 
wpis:

<blockquote><pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre></blockquote>

<p>
(Je¿eli demon nie przechodzi automatycznie do pracy w tle, nale¿y dodaæ
znak "&amp;" po "/usr/local/sbin/daemonx".)

<p>
Od tej pory demon bêdzie uruchamiany zawsze podczas startu systemu. W 
trakcie tej operacji mo¿na zobaczyæ komunikaty o b³êdach (je¿eli siê
takowe pojawi±). Natomiast komunikat bezb³êdnego uruchomienia demona 
bêdzie wygl±da³ mniej wiêcej tak:

<blockquote><pre>
Starting local daemons: daemonx.
</pre></blockquote>

<h3>rc.shutdown</h3>

<p>
<i>/etc/rc.shutdown</i> to skrypt, który jest uruchamiany przed
zatrzymaniem pracy systemu. Wszystkie polecenia, które maj± byæ wykonane przed
zamkniêciem OpenBSD powinny byæ zawarte w tym pliku. Je¿eli wykorzystywane
jest zarz±dzanie energi± (apm), mo¿na tak¿e ustawiæ &quot;powerdown=YES&quot;,
co jest odpowiednikiem komendy &quot;shutdown -p&quot;.

<p>
<a name= "RelayingDenied"></a>
<h2>10.4 - Dlaczego u¿ytkownicy otrzymuj± komunikat "relaying access
denied" gdy próbuj± wys³aæ zdalnie pocztê przez moj± maszynê
dzia³aj±c± na OpenBSD?</h2>

<p>
Proszê spróbowaæ tego:

<blockquote><pre>
# <strong>cat /etc/mail/sendmail.cf | grep relay-domains</strong>
</pre></blockquote>

<p>
Wynik mo¿e wygl±daæ tak:

<blockquote><pre>
FR-o /etc/mail/relay-domains
</pre></blockquote>

<p>
Je¿eli ten plik nie istnieje, nale¿y go utworzyæ i wpisaæ do niego nazwy 
hostów, którym zezwala siê na przesy³anie poczty przez swój serwer 
stosuj±c nastêpuj±c± sk³adniê:

<blockquote><pre>
.domain.com    #Zezwalaj na przekazywanie poczty z/do ka¿dego hosta w domain.com
sub.domain.com #Zezwalaj na przekazywanie poczty z/do domeny sub.domain.com oraz z ka¿dego hosta w tej domenie 
10.2           #Zezwalaj na przekazywanie poczty ze wszystkich hostów o adresach IP 10.2.*.*
</pre></blockquote>

<p>
Na koniec nale¿y wys³aæ procesowi sendmail sygna³ 'HangUP' (jest 
to sygna³, który zmusza wiêkszo¶æ demonów do ponownego odczytania 
swoich plików konfiguracyjnych):

<blockquote><pre>
# <Strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre></blockquote>

<p>

<h3>Dalsze informacje</h3>

<p>
<ul>
<li><a
href="http://www.sendmail.org/~ca/email/relayingdenied.html"
>http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a
href="http://www.sendmail.org/tips/relaying.html"
>http://www.sendmail.org/tips/relaying.html</a>
<li><a
href="http://www.sendmail.org/antispam.html"
>http://www.sendmail.org/antispam.html</a>
</ul>

<p>
<a name= "POP"></a>
<h2>10.5 - Uruchomi³em serwer POP, ale u¿ytkownicy maj± k³opoty z
odbiorem maili poprzez ten protokó³. Co mam zrobiæ?</h2>

<p>
Wiêkszo¶æ problemów zwi±zanych z protoko³em POP ma swoje ¼ród³a w 
plikach tymczasowych oraz plikach blokady. Je¿eli serwer POP wysy³a 
komunikat o b³êdzie podobny do tego:

<blockquote><pre>
-ERR Couldn't open temporary file, do you own it?
</pre></blockquote>

<p>
to spróbujmy ustawiæ prawa do plików w nastêpuj±cy sposób:

<blockquote><pre>
prawa w  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


prawa w  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre></blockquote>

<p>
Nale¿y upewniæ siê, ¿e dany u¿ytkownik jest w³a¶cicielem 
swojego pliku poczty w katalogu /var/mail (tzn. /var/mail/joe powinien 
nale¿eæ do joe itd.). Teoretycznie nie ma powodu, dla którego mia³o by 
byæ inaczej, ale je¿eli jest, to tu mo¿e tkwiæ problem!

<p>
Oczywi¶cie, przyznanie praw do pisania do /var/mail grupie mail
mo¿e byæ przyczyn± wielu tajemniczych, nie do koñca znanych problemów 
zwi±zanych z
bezpieczeñstwem. Istnieje du¿e prawdopodobieñstwo, ¿e nigdy nie bêdzie
z tym k³opotów, je¶li jednak serwer stanowi znacz±cy punkt na mapie 
Internetu (np. nale¿y do ISP) mog± siê takowe pojawiæ! W kolekcji
portów mo¿na znale¼æ kilka ró¿nych serwerów POP, zalecane jest jednak 
u¿ywanie 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=popa3d&amp;sektion=8" 
>popa3d</a>, który jest dostêpny ju¿ w podstawowej instalacji OpenBSD.
Mo¿e siê te¿ zdarzyæ, ¿e zostan± okre¶lone nieodpowiednie opcje 
konfiguracji
serwera POP (np. blokada plików z kropk±). Byæ mo¿e wystarczy jedynie
zmieniæ katalog, który jest blokowany przez serwer (chocia¿ wtedy
blokowanie mia³oby sens tylko dla demona POP).

<p>
<b>PS:</b> Proszê zwróciæ uwagê, ¿e OpenBSD nie tworzy automatycznie
grupy &quot;mail&quot;. Je¿eli zajdzie taka potrzeba,
nale¿y utworzyæ j± w³asnorêcznie dodaj±c do pliku <i>/etc/group</i> wpis w
stylu:

<blockquote><pre>
mail:*:6:
</pre></blockquote>


<a name="SendmailDNS"></a>
<h2>10.6 - Dlaczego Sendmail ignoruje plik <tt>/etc/hosts</tt>?</h2>

<p>
Domy¶lnie Sendmail korzysta z DNS w celu uzyskania informacji o adresach, 
ignoruj±c plik <tt>/etc/hosts</tt>. Zachowanie 
to mo¿na zmieniæ korzystaj±c z pliku <tt>/etc/mail/service.switch</tt>. 

<p>
Je¿eli chcemy aby Sendmail przed wys³aniem zapytania do DNS odczytywa³
plik <tt>/etc/hosts</tt>, nale¿y utwórzyæ plik
<tt>/etc/mail/service.switch</tt>, zawieraj±cy nastêpuj±cy wpis:

<pre>
     hosts       files dns
</pre>

<p>
Je¿eli za¶ chcemy, by Sendmail odczytywa³ TYLKO plik
<tt>/etc/hosts</tt>, u¿yjmy nastêpuj±cego wpisu:

<pre>
     hosts       files
</pre>

<p>
Aby zmiany, których dokonali¶my, zosta³y uwzglêdnione, wysy³amy procesowi 
Sendmail sygna³ HUP:

<pre>
     # <b>kill -HUP `head -1 /var/run/sendmail.pid`</b>
</pre>


<p>
<a name= "HTTPS"></a>
<h2>10.7 - Konfigurowanie bezpiecznego serwera HTTP z wykorzystaniem 
ssl(8)</h2>

<p>
OpenBSD jest dostarczany z gotowym do u¿ytku serwerem httpd wyposa¿onym 
w obs³ugê SSL oraz biblioteki RSA. Aby móc korzystaæ z SSL w <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">
httpd(8)</a>, nale¿y najpierw utworzyæ certyfikat. Bêdzie on 
przechowywany w <i>/etc/ssl/</i>, a odpowiadaj±cy mu klucz w 
<i>/etc/ssl/private/</i>. Opisane poni¿ej kroki zosta³y czê¶ciowo 
zaczerpniête ze strony podrêcznika systemowego <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">
ssl(8)</a>. Tam te¿ znajduj± siê dalsze informacje. Ta sekcja FAQ 
jedynie zarysowuje sposób tworzenia certyfikatów RSA dla serwerów WWW, 
pomija za¶ certyfikaty DSA. Aby dowiedzieæ siê wiêcej na ten temat, 
przeczytaj stronê podrêcznika <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">
ssl(8)</a>.

<p>
Na pocz±tku nale¿y utworzyæ klucz oraz certyfikat serwera korzystaj±c 
z OpenSSL:

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024
</strong></pre></div>

<p>Je¿eli klucz ma zostaæ zaszyfrowany has³em, które trzeba bêdzie
wpisaæ przy uruchamianiu serwerów, zamiast poprzedniego polecenia 
u¿ywamy tego:

<div style="margin-left: 2em"><pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024
</strong></pre></div>

<p>
Kolejnym krokiem jest wygenerowanie pro¶by o podpis certyfikatu
(ang. Certificate Signing Request), która 
jest wykorzystywana przez Instytucjê Uwierzytelniaj±c± (ang. Certifying 
Authority) do podpisania certyfikatu. Robi siê to za pomoc± polecenia:

<div style="margin-left: 2em"><pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr
</strong></pre></div>

<p>Plik <i>server.csr</i> mo¿e zostaæ nastêpnie przekazany Instytucji
Uwierzytelniaj±cej, która podpisze klucz. Jedn± z takich instytucji jest 
<b>Thawte Certification</b>, której strona znajduje siê pod adresem <a 
href="http://www.thawte.com/">http://www.thawte.com/</a>.

<p>Je¿eli nie staæ Ciê na certyfikat Thawte, albo chcesz sam podpisaæ 
swój certyfikat, mo¿esz to zrobiæ w nastêpuj±cy sposób:
<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt
</strong></pre></div>

<p>
Po wygenerowaniu plików /etc/ssl/server.crt</i> oraz 
<i>/etc/ssl/private/server.key</i>, bez przeszkód bêdzie mo¿na 
uruchomiæ <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">
httpd(8)</a> z opcja <b>-DSSL</b> (patrz <a href="#rc">sekcja nt. 
rc(8)</a> w tym FAQ), co zezwala na przeprowadzanie transakcji na 
porcie 443.


<p><a name= "vipw"></a>
<h2>10.8 - Dokona³em zmian w /etc/passwd, ale nie zosta³y one 
uwzglêdnione. Dlaczego?</h2>

<p>
Bezpo¶rednie modyfikacje pliku <i>/etc/passwd</i> zostan± zignorowane.
OpenBSD generuje <i>/etc/passwd</i> dynamicznie za pomoc± <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&amp;sektion=
8">pwd_mkdb(8)</a>. G³ównym plikiem hase³ w systemie OpenBSD jest 
<i>/etc/master.passwd</i>. Cytuj±c za pwd_mkdb(8):

<blockquote><pre>
PLIKI
     /etc/master.passwd  obecnie obowi±zuj±cy plik hase³
     /etc/passwd         plik hase³ w formacie Version 7
     /etc/pwd.db         niezabezpieczony plik bazy hase³
     /etc/pwd.db.tmp     plik tymczasowy
     /etc/spwd.db        zabezpieczony plik bazy hase³
     /etc/spwd.db.tmp    plik tymczasowy
</pre></blockquote>

<p>
W tradycyjnym pliku hase³ w systemach Unix, takim jak /etc/passwd, ca³a 
jego zawarto¶æ, w³±czaj±c w to zaszyfrowane has³o u¿ytkownika, jest 
dostêpna dla ka¿dego, kto posiada konto w systemie (plik ten jest 
g³ównym celem ataków programów takich jak Crack). 4.4BSD wprowadzi³ plik 
master.passwd, który posiada rozszerzony format (z dodatkowymi opcjami 
w stosunku do /etc/passwd) i tylko root posiada 
prawo do odczytu tego pliku. W celu przyspieszenia dostêpu do danych, 
wywo³ania biblioteczne zazwyczaj odczytuj± pliki /etc/pwd.db i 
/etc/spwd.db (zamiast /etc/master.passwd).

<p>OpenBSD posiada narzêdzie, które s³u¿y do modyfikacji pliku 
hase³. Nazywa siê ono vipw(8). Do modyfikacji /etc/master.passwd 
vipw korzysta z vi (albo Twojego ulubionego edytora zdefiniowanego za 
pomoc± zmiennej ¶rodowiskowej $EDITOR). Po dokonaniu zmian vipw 
utworzy na nowo /etc/passwd, 
/etc/pwd.db oraz /etc/spwd.db tak, aby uwzglêdnia³y one wprowadzone 
zmiany. vipw zak³ada tak¿e blokady na te pliki tak, by dwie osoby nie 
modyfikowa³y ich naraz.


<p>
<a name="AddDelUser"></a>
<h2>10.9 - Jaki jest najlepszy sposób na dodanie/usuniêcie 
u¿ytkownika?</h2>

<p>OpenBSD posiada dwa polecenia pozwalaj±ce w ³atwy sposób dodaæ 
u¿ytkownika do systemu:

<ul>
<li><a href="#adduser">adduser(8)</a>
<li><a href="#user">user(8)</a>
</ul>

Mo¿na tak¿e dodawaæ u¿ytkowników rêcznie za pomoc± <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
vipw(8)</a>, ale zwykle jest to bardziej skomplikowane.

<a name="adduser"></a><p>Najprostszym sposobem na dodanie u¿ytkownika w 
OpenBSD jest u¿ycie skryptu <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8
">adduser(8)</a>. Mo¿na go skonfigurowaæ redaguj±c plik 
<i>/etc/adduser.conf</i>. adduser(8) sprawdza spójno¶æ plików
<i>/etc/passwd</i>, <i>/etc/group</i> oraz baz danych pow³oki. Tworzy
tak¿e niezbêdne wpisy oraz katalog $HOME. Potrafi nawet wys³aæ 
u¿ytkownikowi wiadomo¶æ powitaln±. Oto przyk³ad dodania 
u¿ytkownika <b>testuser</b> do systemu. Jego katalog $HOME (domowy) 
bêdzie umieszczony w <i>/home/testuser</i>. Przydzielimy go do grupy 
<b>guest</b>, oraz ustawimy domy¶ln± pow³okê na <i>/bin/ksh</i>.

<blockquote><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Reading /etc/login.conf
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.

Enter username []: <b>testuser</b>
Enter full name []: <b>Test FAQ User</b>
Enter shell csh ksh nologin sh [sh]: <b>ksh</b>
Uid [1002]: <b><i>Enter</i></b>
Login group testuser [testuser]: <b>guest</b>
Login group is `guest''. Invite testuser into other groups: guest no 
[no]: <b>no</b>
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Enter</i></b>
Enter password []: <b><i>Type password, then Enter</i></b>
Enter password again []: <b><i>Type password, then Enter</i></b>

Name:        testuser
Password:    ****
Fullname:    Test FAQ User
Uid:         1002
Gid:         31 (guest)
Groups:      guest
Login Class: default
HOME:        /home/testuser
Shell:i      /bin/ksh
OK? (y/n) [y]: <b>y</b>
Added user ``testuser''
Copy files from /etc/skel to /home/testuser
Add another user? (y/n) [y]: <b>n</b>

Goodbye!
</pre></blockquote>


<p>
Do skasowania u¿ytkownika z systemu s³u¿y polecenie <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&amp;sektion=8"
>rmuser(8)</a>. Usunie ono wszelkie ¶lady bytno¶ci u¿ytkownika w 
systemie -  wszystkie jego wpisy w <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1
">crontab(1)</a>, katalog domowy (je¶li jego w³a¶cicielem jest 
u¿ytkownik), jego pocztê. Oczywi¶cie, równie¿ wpisy w <i>/etc/passwd</i> 
oraz <i>/etc/group</i> zostan± usuniête. Oto przyk³ad usuniêcia 
u¿ytkownika dodanego przez nas przed chwil±. Proszê zauwa¿yæ, ¿e 
rmuser(8) pyta siê o login u¿ytkownika oraz czy usuwaæ jego katalog 
domowy.

<blockquote><pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry:

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002
:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></blockquote>


<a name="user"></a>
<h3>Dodawanie u¿ytkowników za pomoc± polecenia user(8)</h3>

<p>
Ni¿ej opisane narzêdzia s± mniej interaktywne ni¿ polecenie <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8
">adduser(8)</a>, co u³atwia korzystanie z nich w skryptach pow³oki. 

<p>
Na narzêdzia te sk³adaj± siê nastêpuj±ce programy:
<ul>
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=8">
group(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&amp;sektion=
8">groupadd(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&amp;sektion=
8">groupdel(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&amp;sektion
=8">groupinfo(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&amp;sektion=
8">groupmod(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&amp;sektion=8">
user(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8
">useradd(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&amp;sektion=8
">userdel(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&amp;sektion=
8">userinfo(8)</a>	<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8
">usermod(8)</a></ul>


<h4>Dodawanie u¿ytkowników w praktyce.</h4>

<p>
Poniewa¿ program user(8) nie jest interaktywny, naj³atwiejszym 
sposobem dodania u¿ytkownika jest u¿ycie komendy adduser(8). 
Polecenie <i>/usr/sbin/user</i> to tylko fronton (ang. front-end) 
poleceñ 
<i>/usr/sbin/user*</i>. Dlatego te¿ mo¿na u¿ywaæ zarówno <b>user add</b> 
jak i <b>useradd</b>. Wybór nale¿y do Ciebie - sk³adnia komend pozostaje 
w obu przypadkach identyczna. 

<p>
W kolejnym przyk³adzie dodamy tego samego u¿ytkownika z takimi samymi 
ustawieniami jak w przyk³adzie wy¿ej <a href="#adduser"> prezentuj±cym 
polecenie adduser</a>. useradd(8) bêdzie du¿o prostszy w obs³udze, je¶li 
najpierw zaznajomimy siê z domy¶lnymi ustawieniami. Znajduj± siê one w 
pliku <i>/etc/usermgmt.conf</i>, za¶ wy¶wietliæ je mo¿na pisz±c:

<blockquote><pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></blockquote>

<p>
Powy¿sze ustawienia, je¶li nie zostan± zmienione, bêd± wykorzystane 
przy dodawaniu u¿ytkownika z pomoc± poleceñ user add/useradd.
¯eby by³o ciekawiej, w naszym przyk³adzie umie¶cimy u¿ytkownika w grupie 
<b>guest</b>, nie w <b>users</b>. Ostatni± przeszkod±, o jakiej musimy
pamiêtaæ jest fakt, ¿e has³o, które przeka¿emy programowi 
user add/useradd musi byæ ju¿ zaszyfrowane. Zatem najpierw nale¿y u¿yæ
programu <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&amp;sektion=1
">encrypt(1)</a>, s³u¿±cego do szyfrowania hase³. OpenBSD u¿ywa do 
kodowania hase³ sze¶ciorundowego algorytmu Blowfish. 
Oto przyk³ad pokazuj±cy jak mo¿na otrzymaæ zaszyfrowane has³o gotowe do 
wykorzystania w programie useradd(8): 

<blockquote><pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre></blockquote>

<p>
Mamy ju¿ zakodowane has³o, mo¿emy wiêc dodaæ u¿ytkownika:

<blockquote><pre>
# <strong>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</strong>
</pre></blockquote>

<p>
<b>Uwaga:</b> Has³o nale¿y umie¶ciæ w parze apostrofów ('&nbsp;'), a nie 
cudzys³owów (&quot;&nbsp;&quot;); w przeciwnym razie zostanie ono 
zinterpretowane
przez pow³okê przed wys³aniem do user(8). Opcja <b>-m</b> jest konieczna 
by system utworzy³ katalog domowy u¿ytkownika i skopiowa³ do niego pliki 
z <i>/etc/skel</i>.

<p>By sprawdziæ, czy u¿ytkownik zosta³ poprawnie dodany do systemu, mo¿na 
pos³u¿yæ siê wieloma narzêdziami. Zamieszczone poni¿ej przyk³ady 
pokazuj± jak szybko upewniæ siê, ¿e wszystko wykonane zosta³o poprawnie.

<blockquote><pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Test FAQ User
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></blockquote>

<p>
Dodatkowo, user(8) dostarcza w³asne narzêdzie do podgl±du parametrów 
u¿ytkownika o nazwie userinfo(8).

<blockquote><pre>
$ <strong>userinfo testuser</strong>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre></blockquote>


<h4>Usuwanie u¿ytkowników</h4>
<p>
W celu usuniêcia u¿ytkownika za pomoc± polecenia z zestawu user(8), 
nale¿y skorzystaæ z komendy userdel(8). Jest to bardzo proste, a 
jednocze¶nie przydatne polecenie. By usun±æ u¿ytkownika dodanego w 
poprzednim wystarczy napisaæ:

<blockquote><pre>
# <strong>userdel -r testuser</strong>
</pre></blockquote>

<p>
Proszê zwróciæ uwagê na opcjê <b>-r</b>, która ka¿e systemowi usun±æ 
nie tylko 
samego u¿ytkownika, ale te¿ jego katalog domowy. Alternatywnie, zamiast 
<b>-r</b> mo¿na u¿yæ flagi <b>-p</b>, która tylko blokuje konto 
u¿ytkownika, bez usuwania jakichkolwiek informacji o nim.


<p>
<a name="FTPOnly"></a>
<h2>10.10 - Jak stworzyæ konto umo¿liwiaj±ce logowanie tylko przez FTP?</h2>
<p>
Jest na to kilka sposobów. Bardzo powszechne jest rozwi±zanie polegaj±ce
na dodaniu pliku <i>/usr/bin/false</i> do <i>/etc/shells</i>. Je¿eli 
nastêpnie domy¶lna pow³oka u¿ytkownika ustawiona zostanie w³a¶nie na
/usr/bin/false, to nie bêdzie on móg³ zalogowaæ siê do systemu w trybie
interaktywnym. Bêdzie móg³ natomiast zalogowaæ siê przez FTP. <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8
">adduser(8)</a> automatycznie stworzy dla ka¿dego takiego u¿ytkownika 
katalog domowy <i>/home/&lt;user&gt;</i>. Mo¿na oczywi¶cie utworzyæ ten 
katalog w innym miejscu, wedle swojego uznania. Mo¿na tak¿e sprawiæ, aby 
taki u¿ytkownik mia³ dostêp do plików tylko w jego w³asnym katalogu. W 
tym celu nale¿y dodaæ nazwê u¿ytkownika do pliku <i>/etc/ftpchroot</i>.
Warto wiedzieæ, ¿e opcja
<b>-A</b> demona <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftpd(8)</a> powoduje, ¿e zezwala on na logowanie siê tylko tym 
u¿ytkownikom, którzy s± dopisani do <i>/etc/ftpchroot</i>. 


<p>
<a name= "Quotas"></a>
<h2>10.11 - Konfigurowanie kwot dyskowych</h2>

<p>
Kwoty wykorzystywane s± do ograniczania przestrzeni dyskowej 
dostêpnej u¿ytkownikom. Jest to szczególnie pomocne, gdy zasoby 
dyskowe s± mocno ograniczone. Limity mo¿na narzuciæ zarówno 
pojedynczemu u¿ytkownikowi jak i ca³ej grupie.

<p>
Aby mo¿na by³o u¿ywaæ kwot dyskowych, j±dro systemu musi zostaæ 
skompilowane z w³±czon± opcj± <tt>QUOTA</tt>. Jest ona domy¶lnie 
ustawiona w j±drze GENERIC, wiêc nie powinno byæ z tym problemu. 
Nale¿y równie¿ wskazaæ na których systemach plików chcemy 
korzystaæ z kwot dyskowych. S³u¿± do tego s³owa kluczowe 
<tt>userquota</tt> oraz <tt>groupquota</tt> umieszczone w pliku 
<i>/etc/fstab</i>. W korzeniu wybranych 
systemów plików domy¶lnie tworzone s± pliki <tt>quota.user</tt> oraz 
<tt>quota.group</tt>, które zawieraj± niezbêdne informacje o kwotach.
Nie ma przeszkód, by pliki te znajdowa³y siê w dowolnym innym katalogu
lub nawet inaczej siê nazywa³y. Robi siê to dodaj±c w pliku /etc/fstab
znak równo¶ci oraz odpowiedni± ¶cie¿kê i nazwê pliku po s³owie kluczowym 
<tt>userquota</tt> b±d¼ <tt>groupquota</tt>. Oto przyk³adowa linia z
pliku /etc/fstab:

<blockquote><pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre></blockquote>

<p>
Teraz mo¿na ju¿ przyznawaæ u¿ytkownikom kwoty. S³u¿y do tego narzêdzie 
o nazwie <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&amp;sektion=8
">edquota(8)</a>. Wpisuj±c "<tt>edquota&nbsp;&lt;user&gt;</tt>" 
do konfigurowania kwot u¿yty zostanie edytor vi(1), chyba ¿e za pomoc± 
zmiennej ¶rodowiskowej EDITOR ustawimy jako domy¶lny inny edytor. Dla
przyk³adu:

<blockquote><pre>
# <strong>edquota ericj</strong>
</pre></blockquote>

<p>
spowoduje wy¶wietlenie mniej wiêcej takiej informacji:

<blockquote><pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
Aby wprowadziæ ograniczenia wystarczy zredagowaæ ten plik. Np.:

<blockquote><pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
W powy¿szym przyk³adzie ustawili¶my limit miêkki (ang. soft limit) na 
1000 bloków, za¶ limit twardy (ang. hard limit) na 1050 bloków. Ró¿nica 
miêdzy limitem miêkkim a twardym
polega na tym, ¿e ten pierwszy mo¿e zostaæ na jaki¶ czas przekroczony.
Czas ten ustala siê stosuj±c opcjê <strong>-t</strong> w poleceniu 
edquota(8). Gdy okres ten jednak minie, limit miêkki jest traktowany
identycznie jak limit twardy, co powoduje czêste b³êdy alokacji.

<p>
Po ustawieniu kwot nale¿y je jeszcze w³±czyæ. Robi siê to za pomoc± 
polecenia <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&amp;sektion=8
">quotaon(8)</a>. Przyk³ad:

<blockquote><pre>
# <strong>quotaon -a</strong>
</pre></blockquote>

<p>
Spowoduje to wczytanie /etc/fstab i w³±czenie kwot na wybranych 
systemach plików. Do wy¶wietlania kwot s³u¿y polecenie <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&amp;sektion=1">
quota(1)</a>. Wywo³anie <strong>quota &lt;user&gt;</strong> dostarczy 
informacji na temat kwot wybranego u¿ytkownika. Wywo³anie komendy 
quota(1) bez dodatkowych argumentów zwróci nasze w³asne statystyki. 
Oto przyk³ad:

<blockquote><pre>
# <Strong>quota ericj</strong>
</pre></blockquote>

<p>Spowoduje to wypisanie informacji podobnej do tej:

<blockquote><pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre></blockquote>

<p>
Kwoty ustawione w /etc/fstab w³±czaj± siê domy¶lnie podczas startu 
systemu. Natomiast wy³±czyæ mo¿na je pisz±c:

<blockquote><pre>
# <strong>quotaoff -a</strong>
</pre></blockquote>


<p>
<a name= "Kerberos"></a>
<h2>10.12 - Konfigurowanie klientów i serwerów KerberosV</h2>

<p>
KerberosV jest domy¶lnie preinstalowanym sk³adnikiem systemu.

<p>
Wiêcej informacji o KerberosV mo¿na uzyskaæ za pomoc± polecenia:
<pre>
     # <b>info heimdal</b>
</pre>


<p>
<a name= "AnonFTP"></a>
<h2>10.13 - Konfigurowanie anonimowego serwera FTP</h2>

<p>
Dziêki anonimowemu FTP nawet u¿ytkownicy nie posiadaj±cy konta mog± mieæ 
dostêp do naszych plików. Poni¿ej podpowiadamy jak skonfigurowaæ anonimowy
serwer FTP.


<h3>Dodawanie konta FTP</h3>

<p>
Najpierw nale¿y stworzyæ w systemie konto o nazwie "ftp". Has³o do tego 
konta nie powinno byæ warto¶ciowe, tzn. nie powinni¶my u¿ywaæ go nigdzie
indziej. W naszym przyk³adzie dla tego konta ustalimy katalog domowy
/home/ftp, ale mo¿na u¿yæ tez innego katalogu. Gdy kto¶ zaloguje siê
na nasz anonimowy serwer FTP, demon ftp zmieni ¶rodowisko za pomoc± 
polecenia chroot tak, ¿e u¿ytkownik nie bêdzie móg³ przej¶æ w górê 
drzewa katalogów (poza /home/ftp). Wiêcej na ten temat mo¿na dowiedzieæ 
siê na stronach podrêcznika systemowego <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftp(8)</a> oraz <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2"
>chroot(2)</a>. Oto przyk³ad dodania u¿ytkownika o nazwie <i>ftp</i>.
U¿ywamy tutaj polecenia. <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8
">adduser(8)</a>. Nale¿y tak¿e dodaæ liniê "/usr/bin/false" do pliku
<i>/etc/shells</i>. Czynimy to pisz±c: <i>echo /usr/bin/false >> 
/etc/shells</i>. Pó¼niej ustanawiamy plik /usr/bin/false domy¶ln± 
"pow³ok±" u¿ytkowników ftp. Dziêki temu nie bêd± siê oni mogli 
zalogowaæ. Dodatkowo, aby "pow³oka" ta zosta³a uwzglêdniona przez 
polecenie adduser(8), nale¿y odpowiednio zredagowaæ plik 
/etc/adduser.conf [Uwaga!
W moim przypadku (OpenBSD 3.3) nie by³o potrzeby redagowania tego pliku! 
- przyp. t³um.]

<blockquote><pre>
# <strong>adduser</strong>
Use option `-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Reading /etc/login.conf
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username []: <b>ftp</b>
Enter full name []: <b>anonymous ftp</b>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <b>false</b>
Uid [1002]: <b><i>Enter</i></b>
Login group ftp [ftp]: <b><i>Enter</i></b>
Login group is `ftp''. Invite ftp into other groups: guest no 
[no]: <b>no</b>
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Enter</i></b>
Enter password []: <b><i>Enter</i></b>
Set the password so that user cannot logon? (y/n) [n]: <b>y</b>

Name:        ftp
Password:    ****
Fullname:    anonymous ftp
Uid:         1002
Gid:         1002 (ftp)
Groups:      ftp
Login Class: default
HOME:        /home/ftp
Shell:       /usr/bin/false
OK? (y/n) [y]: <b>y</b>
Added user ``ftp''
Copy files from /etc/skel to /home/ftp
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>


<h3>Konfigurowanie katalogu</h3>

<p>
Mamy ju¿ dodanego u¿ytkownika ftp; stworzony zosta³ tak¿e jego katalog
domowy - <i>/home/ftp</i>. Nale¿y dokonaæ jednak jeszcze kilku zmian,
by konto by³o gotowe do obs³ugi anonimowego FTP. Ponownie odsy³amy do
podrêcznika systemowego programu <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftp(8)</a>

<p>
<b>Nie</b> ma potrzeby zak³adania katalogów /home/ftp/usr czy 
/home/ftp/bin.

<ul>
<li><i>/home/ftp</i> - G³ówny katalog. Powinien mieæ prawa 555, za¶ jego 
w³a¶cicielem powinien byæ root.

<li><i>/home/ftp/etc</i> - ca³kowicie opcjonalny, a nawet nie zalecany,
jako ¿e jego jedyn± funkcj± jest udzielanie informacji o u¿ytkownikach, 
którzy maj± konto na naszym komputerze. Je¶li chcemy aby informacje o 
plikach znajduj±cych siê w katalogu /home/ftp/pub (patrz akapit ni¿ej) 
zawiera³y nazwy 
u¿ytkowników zamiast tylko ich identyfikatory, to mo¿emy skopiowaæ pliki 
/etc/pwd.db i /etc/group do tego katalogu. Katalog ten powinien mieæ 
prawa dostêpu 511, a wspomniane dwa pliki 444. W pliku pwd.db nie s± 
przechowywane ¿adne has³a, s± one w spwd.db i dlatego nie nale¿y
go tu kopiowaæ.

<li><i>/home/ftp/pub</i> - Zwyczajowy katalog w którym umieszcza siê 
pliki, jakie maj± byæ udostêpnione u¿ytkownikom FTP. Katalogowi temu
równie¿ nadajemy prawa dostêpu 555.

</ul><p>Proszê zwróciæ uwagê na to, by w³a¶cicielem wszystkich katalogów 
by³ root. Oto listing pokazuj±cy jak powinny wygl±daæ 
stworzone katalogi:

<blockquote><pre>
# pwd
/home
# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre></blockquote>


<h3>Uruchamianie serwera i logowanie</h3>

<p>
W przypadku ftpd mo¿na wybraæ czy uruchamiaæ go z inetd, czy ze skryptów
rc. Nasze przyk³ady poka¿± jak uruchomiæ demona z pomoc± <a 
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">
inetd.conf</a>. Na pocz±tku musimy jednak zaznajomiæ siê z pewnymi 
opcjami ftpd. Standardowa linia z <i>/etc/inetd.conf</i> wygl±da tak:

<blockquote><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US</strong>
</pre></blockquote>

<p>
W naszym przypadku ftpd jest przywo³ywany z opcj± <i>-US</i>. Spowoduje 
to logowanie anonimowych po³±czeñ do <i>/var/log/ftpd</i>, za¶ sesji
równoleg³ych do <i>/var/run/utmp</i>. Sprawi to tak¿e, ¿e sesje te bêd± 
widoczne przez polecenie who(8). Mo¿na równie¿ akceptowaæ tylko i 
wy³±cznie anonimowe po³±czenia, korzystaj±c z opcji <i>-A</i>. Oto 
odpowiedni wpis (u¿ywamy tak¿e opcji <i>-ll</i> która powoduje, ¿e ka¿de 
po³±czenie jest logowane do sysloga, w³±czaj±c w to komendy ftp takie
jak get, retrieve itd):

<blockquote><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA</strong>
</pre></blockquote>


<p>
Uwaga - w przypadku, gdy przewidywane jest bardzo du¿e obci±¿enie 
serwera ftp, zaleca siê nie wywo³ywaæ ftpd z poziomu inetd.conf.
Najlepiej jest wówczas wykomentowaæ odpowiedni± liniê z pliku inetd.conf 
i uruchomiæ ftpd z poziomu rc.conf z w³±czon± opcj± <i>-D</i>. Sprawi to,
¿e demon bêdzie dzia³a³ szybciej, ni¿ gdyby zosta³ uruchomiony z 
inetd.conf. Oto przyk³ad pokazuj±cy jak uruchomiæ demona ftp z poziomu 
rc.conf:

<blockquote><pre>
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
</pre></blockquote>

<p>
Zadzia³a to oczywi¶cie tylko wtedy, je¶li wcze¶niej wykomentowano 
odpowiedni wpis z <i>/etc/inetd.conf</i> oraz nakazano demonowi 
intetd ponownie przeczytaæ swój plik konfiguracyjny.

<h3>Inne wa¿ne pliki</h3>

<ul>
<li><i>/etc/ftpwelcome</i> - Zawiera wiadomo¶æ powitaln± wy¶wietlan± 
u¿ytkownikom, którzy po³±czyli siê z serwerem ftp.
<li><i>/etc/motd</i> - Zawiera wiadomo¶æ powitaln± wy¶wietlan± 
u¿ytkownikom, którzy zalogowali siê na serwer ftp.
<li><i>.message</i> - Pliki o takiej nazwie mo¿na zamieszczaæ w 
dowolnych katalogach. Ich zawarto¶æ zostanie wy¶wietlona, gdy u¿ytkownik
wejdzie do danego katalogu.
</ul>



<p>
<a name= "ftpchroot"></a>
<h2>10.14 - Ograniczanie dostêpu u¿ytkowników wy³±cznie do ich 
katalogów domowych w ftpd(8)</h2>

<p>
W systemie OpenBSD serwer <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftpd(8)</a> zosta³ domy¶lnie tak skonfigurowany, by ³atwo mo¿na by³o 
poradziæ sobie z tytu³owym problemem. Rozwi±zuje siê go za pomoc± pliku 
<strong>/etc/ftpchroot</strong>. Poniewa¿ nie do wszystkich u¿ytkowników 
ma siê zaufanie, bardzo wskazane jest pozwolenie u¿ytkownikom na dostêp
tylko i wy³±cznie do swoich katalogów. Takie ograniczenie NIE jest 
domy¶lnie w³±czone. Oto przyk³ad domy¶lnego zachowania:

<blockquote><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 3.4 (GENERIC) #18: Wed Sep 17 03:34:47 MDT 2003
230- 
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230- 
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230- 
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre></blockquote>


<p>
Jak widaæ, u¿ytkownik ma dostêp do dowolnego pliku na serwerze. Gdyby 
¶wiat by³ doskona³y i ka¿demu mo¿na by³o ufaæ, to nie by³o by problemu - 
ale oczywi¶cie tak nie jest. Aby uniemo¿liwiæ u¿ytkownikowi opuszczenie 
jego katalogu domowego, po prostu dodajemy jego nazwê do pliku
<strong>/etc/ftpchroot</strong>. Oto odpowiedni przyk³ad dla u¿ytkownika
o loginie &quot;ericj&quot;.

<blockquote><pre>
$ <strong>cat /etc/ftpchroot</strong>
#       $ OpenBSD: ftpchroot,v 1.3 1996/07/18 12:12:47 deraadt Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj
</pre></blockquote>

<p>
To wystarczy, by uniemo¿liwiæ u¿ytkownikowi &quot;ericj&quot;
opuszczenie swojego katalogu. Jak widaæ, katalog / nagle zamieni³ siê 
w katalog domowy u¿ytkownika!

<blockquote><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre></blockquote>



<p>
<a name= "Patches"></a>
<h2>10.15 - £atanie systemu OpenBSD</h2>

<p>
Drzewo kodu ¼ród³owego OpenBSD ulega ci±g³ym zmianom i ulepszeniom. 
Wraz z tymi zmianami pojawiaj± siê poprawki do b³êdów, które s± 
publikowane jako oficjalne ³atki. Informacje o ³atkach pojawiaj± siê 
pod adresem <a 
href="../../errata.html">http://www.openbsd.org/errata.html</a> i s± 
podzielone na oddzielne kategorie. Kategorie te to po prostu nazwy 
platform, na których dzia³a OpenBSD. Dla ró¿nych platform s± ró¿ne ³atki, 
choæ istnieje te¿ kategoria, w której zabrano ³atki wspólne dla wszystkich 
architektur.

<p>
Prosze zwróciæ uwagê na to, ¿e ³atki nie s± jakimi¶ nowymi dodatkami do 
OpenBSD; s± tworzone tylko wtedy, gdy powstanie problem 
zwi±zany z niezawodno¶ci± lub bezpieczeñstwem systemu. Dlatego te¿ ³atki 
z regu³y powinny byæ jak najszybciej aplikowane (choæ ostateczna 
decyzja zawsze nale¿y tylko i wy³±cznie do administratora).

<p>W poni¿szych przyk³adach bêdziemy ³ataæ <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=talkd&amp;sektion=8">
talkd(8)</a> za pomoc± ³aty pobranej z <a 
href="../../errata.html">errata.html</a>.

<h3>Czym ró¿ni± siê ³atki od tego, co mo¿na znale¼æ w drzewie CVS?</h3>

<p>Wszystkie ³atki publikowane na <a 
href="../../errata.html">http://www.openbsd.org/errata.html</a> s± 
przeznaczone do aplikowania na kod ¼ród³owy podstawowej wersji systemu 
(ang. release system). £atki znalezione w najnowszym drzewie CVS mog± 
dodatkowo spowodowaæ zmiany, które by³yby niepo¿±dane w podstawowej 
wersji systemu.
 
<h3>Przygotowywanie systemu do ³atania</h3>

<p>
£aty dla OpenBSD s± rozpowszechniane jako diffy, które s± plikami 
tekstowymi zawieraj±cymi ró¿nice w stosunku do oryginalnego kodu. 
<b>NIE</b> s± dystrybuowane w formie binarnej! Oznacza to, ¿e aby za³ataæ 
swój system musimy mieæ kod ¼ród³owy wersji <b>RELEASE</b> OpenBSD. Nie 
oznacza to jednak, ¿e potrzebny jest CA£Y kod ¼ród³owy OpenBSD by móc 
za³ataæ system - niezbêdny jest tylko kod ¼ród³owy programu, który 
³atamy. Dla przyk³adu, aby na³o¿yæ poprawki na j±dro, nale¿y mieæ
kod ¼ród³owy j±dra.
 
<p><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">
cvs(1)</a> jest bardzo przydatnym narzêdziem, które mo¿e zostaæ u¿yte do 
pobrania z dowolnego anonimowego serwera CVS na ca³ym ¶wiecie tylko
tych ¼róde³, które s± potrzebne. Lista tych serwerów jest dostêpna na <a 
href="http://www.openbsd.org/anoncvs.html">
http://www.openbsd.org/anoncvs.html</a>.  

<p>Aby ¶ci±gn±æ kod ¼ród³owy talkd(8) z wersji 3.4 za pomoc± <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">
cvs(1)</a>, wydajemy nastêpuj±c± komendê:

<div style="margin-left: 2em">
<pre>
$ <b>export CVSROOT=anoncvs@anoncvs5.usa.openbsd.org:/cvs</b>
$ <b>cvs co -rOPENBSD_3_4_BASE src/libexec/talkd/</b>
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h
</pre>
</div>

<p>
¦cie¿kê CVS do ³atanych programów znale¼æ mo¿na przygl±daj±c
siê linii <i>Index:</i> w danej ³atce. W tym przypadku, ¶cie¿k±
CVS jest: <i>src/libexec/talkd/</i>. Nale¿y zawsze pobieraæ wersjê z 
tagiem 
OPENBSD_numer_wersji_BASE. Pominiêcie koñcówki &quot;_BASE&quot; 
spowoduje pobranie
plików ze stabilnej ga³êzi, która mo¿e zawieraæ inne zmiany,
zaburzaj±ce aplikowanie ³atek. Je¶li natomiast ¶ledzimy za³atan± ga³±¼ 
(ang. patch branch), ³atki powinny byæ ju¿ w ¼ród³ach. Niemniej
jednak powinni¶my zawsze sprawdziæ i upewniæ siê, czy rzeczywi¶cie tak
jest. Aby dowiedzieæ siê, które ³atki zosta³y zaaplikowane w ga³êzi 
³atek, mo¿na zajrzeæ na <a 
href="../../plus.html">http://www.openbsd.org/plus.html</a> 
Je¶li ³atki nie zosta³y jeszcze zaaplikowane, niezbêdne bêdzie
pobranie kodu ¼ród³owego wersji podstawowej (ang. release) sytemu przy 
pomocy wcze¶niej przedstawionych poleceñ.

<p>
Ponadto osoby, które zakupi³y oficjalny zestaw p³yt CD z OpenBSD, 
mog± pobraæ z nich kod ¼ród³owy systemu. Proszê odwo³aæ siê do 
instrukcji do³±czonych do CD, opisuj±cych ja rozpakowaæ ¼ród³a 
z CD. W tym przypadku nie jest konieczne pobieranie ¼róde³ poprzez 
anonimowy CVS. 

<blockquote><pre>
Apply by doing:
        cd /usr/src
        patch -p0 &lt; 026_talkd.patch
        cd libexec/talkd
        make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install

Index: libexec/talkd/announce.c <b>&lt;------ ¦cie¿ka do ¼róde³</b>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@ -160,6 +160,6 @@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre></blockquote>

<p>
Gdy ju¿ zdobêdziemy w³a¶ciwy kod ¼ród³owy, mo¿emy pobraæ ³atki i
umie¶ciæ je w <i>src/</i>

<h3>Aplikowanie ³atek</h3>

<div style="margin-left: 2em">
<pre>
$ <b>cd /usr/src</b>
$ <b>patch -p0&lt;/path/to/026_talkd.patch</b>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|       cd /usr/src
|       patch -p0 &lt; 026_talkd.patch
|       cd libexec/talkd
|       make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <b>&lt;------------ £atanie zakoñczone sukcesem</b>
done
$ <b>cd /usr/src/libexec/talkd/</b>
$ <b>ls</b>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <b>make obj &amp;&amp; make depend &amp;&amp; make</b>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/sr
c/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c
/home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec
/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 &gt; talk
d.cat8
$ <b>sudo make install</b>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -&gt; /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>
Kiedy ju¿ zakoñczymy ³atanie, powinni¶my uruchomiæ od nowa
dan± us³ugê.



<a name="httpdchroot"></a>
<h2>10.16 - Zastosowanie ¶rodowiska chroot() dla serwera Apache.</h2>

<p>
W systemie OpenBSD, serwer HTTP Apache
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">
httpd(8)</a>) jest uruchamiany domy¶lnie w ¶rodowisku zmodyfikowanym poleceniem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">
chroot(2)</a>. Chocia¿ jest to wspania³e z punktu widzenia bezpieczeñstwa
systemu, mog± siê z tym wi±zaæ pewne niespodzianki dla osób nieprzygotowanych
na tak± zmianê.

<h3>Co to jest chroot?</h3>
<p>Proces dzia³aj±cy w ¶rodowisku zmodyfikowanym poleceniem <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">
chroot(2)</a> (dalej bêdziemy pisali po prostu: "proces dzia³aj±cy w 
¶rodowisku chroot") jest ograniczony do okre¶lonego katalogu i nie ma 
mo¿liwo¶ci "chodzenia" po reszcie drzewa katalogów. Katalog, w którym 
proces zostaje "zamkniêty", jest postrzegany przez ten proces jako 
katalog "<tt>/</tt>" (root).  W przypadku httpd(8), proces ten startuje, 
otwiera swoje pliki dziennika, pod³±cza siê do swojego portu TCP 
(chocia¿ nie przyjmuje jeszcze danych) i odczytuje swój plik 
konfiguracyjny. Nastêpnie "zamyka siê" w <i>/var/www</i>, oddaje 
przywileje, a potem rozpoczyna przyjmowanie ¿±dañ. Oznacza to, ¿e 
wszystkie pliki wysy³ane b±d¼ odbierane przez serwer Apache musz± 
znajdowaæ siê w katalogu <i>/var/www</i>. Ogromnie pomaga to w 
podniesieniu bezpieczeñstwa systemu -- je¿eli nast±pi³o by w³amanie 
poprzez serwer Apache, to zniszczenia dokonane przez w³amywacza by³yby 
ograniczone do jednego katalogu z prawami "tylko do odczytu" -- bez 
dostêpu do zasobów, które mo¿na by wykorzystaæ do niecnych zamiarów.

<h3>Co to oznacza dla u¿ytkownika?</h3>

<p>Nie owijaj±c w bawe³nê trzeba powiedzieæ, ¿e uruchamianie serwera 
Apache w ¶rodowisku chroot(2) jest czym¶ nowym. Dlatego te¿ wiele 
starszych programów czy ustawieñ systemowych przestanie dzia³aæ. Oto 
kilka mo¿liwych przyczyn:

<ul>
<li><b>Stare rozk³ady systemu plików:</b> Na serwerach, na których 
dokonywano uaktualnieñ systemu OpenBSD, pewne pliki mog± byæ 
zlokalizowane w katalogach u¿ytkowników. Nie zadzia³a to w 
¶rodowisku chroot(2), poniewa¿ httpd(8) nie uzyska dostêpu 
do katalogu <i>/home</i>. Administratorzy mog± tak¿e nagle odkryæ, ¿e 
partycja /var/www sta³a siê zbyt ma³a by przechowaæ wszystkie pliki WWW. 
Mo¿na wtedy albo przebudowaæ system albo nie zaprzestaæ stosowania 
chroot(2). Oczywi¶cie, dozwolone jest korzystanie z ³±czy 
symbolicznych w katalogach domowych u¿ytkowników wskazuj±cych na 
podkatalogi <i>/var/www</i>. NIE mo¿na jednak u¿ywaæ linków w 
<i>/var/www</i> wskazuj±cych na inne czê¶ci systemu plików -- na to 
przecie¿ nie zezwala chroot(2). Zauwa¿my, ¿e je¿eli zezwolimy 
u¿ytkownikom na <ahref="faq10.html#ftpchroot">dostêp do FTP w ¶rodowisku 
chroot(2)</a>, to nie zadzia³a to tak, jak oczekujemy, poniewa¿ 
¶rodowisko 
chroot (ponownie) nie zezwoli na dostêp do plików wskazywanych przez 
³±cza symboliczne. Rozwi±zaniem tego problemu jest niekorzystanie z 
katalogów domowych <i>/home</i> dla tych u¿ytkowników, a zamiast tego 
utworzenie ich w katalogu <i>/var/www/home</i> lub podobnym.

<li><b>Rotacja logów:</b> Standardowo, rotacja logów odbywa siê przez 
zmianê nazwy starych plików, a nastêpnie wys³anie httpd(8) sygna³u 
SIGUSR1 w celu zmuszenia Apache do zamkniêcia swoich starych logów i 
otwarcia nowych. W chroot nie jest to mo¿liwe, poniewa¿ httpd(8) nie ma 
mo¿liwo¶ci otwarcia swojego logu po oddaniu przywilejów. httpd(8) musi 
byæ zatrzymany i zrestartowany:

<pre>
     # <b>apachectl stop && apachectl start</b>
</pre>

Istniej± jeszcze inne sposoby, np. logowanie do <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pipe&amp;sektion=2">
pipe(2)</a> przy korzystaniu z zewnêtrznego programu do rotacji logów, 
czytaj±cego z drugiego koñca pipe(2).

<li><b>Modu³y Apache:</b> Praktycznie wszystkie powinny siê za³adowaæ, 
jednak niektóre nie bêd± dzia³aæ poprawnie w ¶rodowisku chroot(2). W 
szczególno¶ci mo¿e wyst±piæ problem z generuj±cym b³±d poleceniem "<tt><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=apachectl&amp;sektion
=8">apachectl</a> restart</tt>" które sprawia, ¿e httpd(8) przerywa pracê.

<li><b>Skrypty CGI:</b> Wiêkszo¶æ NIE zadzia³a poprawnie od razu. Mog± 
one bowiem potrzebowaæ programów lub bibliotek znajduj±cych 
siê poza <i>/var/www</i>. W niektórych przypadkach mo¿na temu zaradziæ 
poprzez statyczne ³±czenie (eliminuje to potrzebê korzystania z 
zewnêtrznych bibliotek przez te programy). Kolejnym sposobem, bardzo 
skutecznym, jest umieszczenie kopii potrzebnych plików w katalogu 
<i>/var/www</i>. Jest to jednak zadanie niebanalne, wymagaj±ce sporej 
wiedzy programistycznej. Wiêkszo¶æ u¿ytkowników zdecyduje siê na 
rozwi±zanie prostsze i po prostu nie skorzysta z chroot(2), dopóki dany 
skrypt nie zostanie zaktualizowany tak, by dzia³a³ w ¶rodowisku chroot(2). 

</ul>

Jak wiêc widaæ, w niektórych przypadkach, programy lub ustawienia mog± 
byæ zmienione tak, by dzia³a³y w ¶rodowisku chroot(2). W innych 
przypadkach trzeba bêdzie po prostu wy³±czyæ chroot(2) za pomoc± opcji 
<tt>-u</tt> demona httpd(8) w pliku <i><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8
">/etc/rc.conf</a></i>




<a name="rootshell"></a><h2>10.17 - Nie podoba mi siê domy¶lna pow³oka 
roota!</h2>

Z powodów historycznych, domy¶ln± pow³ok± u¿ytkownika <i>root</i> w 
systemach OpenBSD jest <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">
csh(1)</a>. Nie ma jednak ¿adnego nakazu, aby OpenBSD u¿ywa³ csh(1) jako 
domy¶lnej pow³oki roota (zanim jednak zmienisz interpreter poleceñ, 
przeczytaj tekst poni¿ej).

<p>U¿ytkownicy innych Uniksów czêsto maj± trudno¶ci z przyzwyczajeniem 
siê do csh(1) i pytaj± w jaki sposób mog± zmieniæ t± pow³okê na inn±.  
Aby rozwi±zaæ ten problem, mo¿na:

<ul>
<li><b>Nie logowaæ siê jako <i>root!</i></b>  Polecenia <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">
su(1)</a> oraz <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">
sudo(8)</a> sprawiaj±, ¿e po pocz±tkowym skonfigurowaniu systemu nie ma 
zbyt wielu powodów, by logowaæ siê jako <i>root</i>.

<li><b>Uruchomiæ ulubiony interpreter poleceñ po zalogowaniu siê do 
systemu:</b> je¿eli lubimy ksh(1) lub dowoln± inn± pow³okê, mo¿emy po 
prostu uruchomiæ j± z pow³oki domy¶lnej [wydaj±c np. polecenie "ksh" - 
przyp. t³um.].

<li><b>Zmieniæ domy¶ln± pow³okê roota:</b> mo¿na to zrobiæ za pomoc± 
polecenia <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1">
chsh</a> albo <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
vipw</a>.
</ul>

Tradycyjnym przykazaniem administratora Uniksa jest korzystanie 
jako root tylko ze statycznie skompilowanych pow³ok, poniewa¿ kiedy 
system przechodzi w tryb pracy pojedynczego u¿ytkownika (ang. single 
user), 
partycje nie nale¿±ce do tego u¿ytkownika nie s± montowane, zatem 
dynamicznie ³±czone pow³oki nie bêd± w stanie skorzystaæ z bibliotek 
zlokalizowanych w partycji <tt>/usr</tt>. Nie jest to co¶, o czym 
administrator systemu OpenBSD musi pamiêtaæ, poniewa¿ gdy system 
przejdzie w tryb pojedynczego u¿ytkownika to sam poprosi o wybranie 
pow³oki, za¶ domy¶ln± pow³ok± jest <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">
sh</a>. W systemie OpenBSD standardowo znajduj± siê trzy pow³oki 
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">csh</a>, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">
sh</a> oraz <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">
ksh</a>). Wszystkie z nich s± zlinkowane statycznie, tak wiêc dostêpne s± 
równie¿ w trybie pojedynczego u¿ytkownika.

<p>Czasami spotkaæ siê mo¿na z opini±, ¿e pow³oki roota nie powinno siê 
zmieniaæ. W OpenBSD nie ma ¿adnego uzasadnienia dla takiego 
nakazu. Jednak to i tak nie powinno byæ przedmiotem dyskusji -- po 
prostu nie nale¿y logowaæ siê jako root.


<a name="ksh"></a><h2>10.18 - Co jeszcze mo¿na zrobiæ z <i>ksh</i>? 

</h2>W systemie OpenBSD wywo³ywana poleceniem <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">
ksh</a> pow³oka to w rzeczywisto¶ci <a 
href="http://web.cs.mun.ca/~michael/pdksh/">pdksh</a> (Public Domain 
Korn Shell). Ksh ma te same binaria co pow³oka <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">
sh</a>.

<p>U¿ytkownicy pos³uguj±cy siê swobodnie pow³ok± <i>bash</i> (czêsto 
spotykan± w systemie Linux), prawdopodobnie odnajd± w <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">
ksh</a> wiele podobieñstw. Ksh(1) posiada wiêkszo¶æ funkcji spotykanych 
w pow³oce <i>bash</i>, w³±czaj±c w to dopisywanie nazw plików po 
naci¶niêciu klawisza Tab, redagowanie i przegl±danie listy wydanych 
wcze¶niej poleceñ za pomoc± klawiszy strza³ek oraz przeskakiwanie na 
pocz±tek/koniec redagowanego polecenia za pomoc± klawiszy CTRL-A/CTRL-E. 
Je¿eli potrzebne s± inne funkcje pow³oki <i>bash</i>, to mo¿na j± 
zainstalowaæ korzystaj±c z <a href="faq8.html#Ports">portów</a> lub <a 
href="faq8.html#Packages">pakietów</a>.

<p>Znak zachêty pow³oki <i>ksh</i> mo¿na z ³atwo¶ci± zmieniæ z 
domy¶lnego "$ " na co¶, co dostarczy u¿ytkownikowi wiêcej informacji 
przez ustawienie zmiennej <tt>PS1</tt>. Na przyk³ad, wstawienie 
nastêpuj±cej linii:

<pre>
     export PS1='$PWD $ '
</pre>

do pliku <tt>/etc/profile</tt> spowoduje wygenerowanie 
nastêpuj±cego znaku zachêty:

<pre>
     /home/nick $
</pre>


Zachêcamy te¿ do przeanalizowania pliku <a 
href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/etc/ksh.kshrc
?content-type=text/plain"><tt>/etc/ksh.kshrc</tt></a>, w którym 
znajduje siê wiele przyk³adów tego, co mo¿na zamie¶ciæ w pliku 
<tt>.profile</tt>.

<p>
<font color= "#0000e0">
<a href= "index.html">[Spis tre¶ci]</a>
<a href= "faq9.html">[Sekcja 9 - Migracja z Linuksa]</a>
<a href= "faq11.html">[Sekcja 11 - Dostrajanie wydajno¶ci]</a>
</font>

<p>
<hr>
<a href=" index.html"><img height=" 24" width=" 24" src="../../images/back.gif" border=" 0" alt="[wstecz]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq10.html,v 1.96 ]<br>
$Translation: faq10.html,v 1.7 2004/02/07 23:15:34 pl-team Exp $<br>
$OpenBSD: faq10.html,v 1.6 2004/02/08 12:15:50 jufi Exp $
</small>
</body>
</html>
