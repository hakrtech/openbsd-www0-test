<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD Przewodnik aktualizacji</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,upgrade,4.2">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2007 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../../pl/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    

</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<h1><font color="#e00000">Przewodnik po aktualizacji: z 4.1 do 4.2</font></h1>
<hr>

<i>Uwaga: upgrade jest dostêpny tylko z release do release, zalecane jest aby nie 
opuszczaæ wydañ po¶rednich.
Nie opuszczaj wersji release.</i>

<p><i>
Jest niezwykle wa¿ne aby¶ przeczyta³ ca³y dokument i dok³adnie zrozumia³
proces zanim bêdziesz usi³owa³ go przeprowadziæ.
Je¶li zamierzasz dzia³aæ na krytycznej lub fizycznie odleg³ej maszynie,
jest zalecane aby¶ przetestowa³ ten proces na identycznej, lokalnej maszynie
i zweryfikowa³ szanse na powodzenie zanim przyst±pisz do aktualizacji.
</i>

<p>
Upgrade to wygodny sposób na utrzymywanie twojego systemu OpenBSD aktualnym
z ostatni± aktualn± wersj±.
Jednak¿e, rezultat w zamierzeniu nie odpowiada dok³adnie wynikowi
instalacji wyczy¶æ-i-za³aduj.
W szczególno¶ci stare pliki bibliotek, nie s± usuwane w procesie aktualizacji,
poniewa¿ mog± byæ wymagane przez starsze aplikacje które mog±, lecz nie musz±
byæ zaktualizowane w danym momencie.
Je¿eli NAPRAWDÊ chcesz pozbyæ siê tych wszystkich plików, prawdopodobnie lepiej
bêdzie je¶li zainstalujesz wszystko od pocz±tku.

<p>
Spis tre¶ci:
<ul>
<li><a href="#before">Zanim rozpoczniesz</a>
  <ul>
    <li><a href="#libexpat">Pakiety korzystaj± obecnie z libexpat
      dostarczanego z X; xbase42.tgz jest twoim przyjacielem</a>
    <li><a href="#X7.2XF3">Wkrocz w X.org v7.2, porzuæ XF3</a>
    <li><a href="#ahci">Zaktualizowany sterownik ahci mo¿e zmieniæ sposób
      obs³ugi twoich dysków</a>
    <li><a href="#bgpd">Zmiany w jêzyku filtrów bgpd</a>
    <li><a href="#ssh1">Zaniechano protoko³u SSH v1 w nowych instalacjach</a>
    <li><a href="#sudo">Zmiana sposobu przekazywania zmiennych ¶rodowiskowych przez sudo(8)</a>
    <li><a href="#dedc">[tylko alpha] Niektóre karty sieciowe de(4) bêd± obs³ugiwane przez sterownik dc(4)</a>
    <li><a href="#acpi">[tylko i386] apm(4) ma pierwszeñstwo przed acpi(4)</a>
    <li><a href="#rc.conf">rc.conf</a>
    <li><a href="#kern">Modyfikowany kernel</a>
  </ul>
<li><a href="#upgrade">Aktualizacja</a>
<li><a href="#final">Ostatnie kroki</a>
  <ul>
    <li><a href="#etcUpgrade">Aktualizacja <tt>/etc</tt></a>
    <li><a href="#Kernchk">Sprawdzenie kernel-a</a>
    <li><a href="#Xup">Pliki konfiguracyjne X-ów</a>
    <li><a href="#Pkgup">Aktualizacja pakietów</a>
  </ul>
</ul>

<hr>
<p>
<a name="before"></a>
<h2>Zanim rozpoczniesz: sprawy do przemy¶lenia i te którymi nale¿y siê martwiæ</h2>

To <i>nie</i> jest kompletna lista zmian jakie pojawi³y siê pomiêdzy
wersjami 4.1 i 4.2 lecz raczej zestawienie wa¿nych spraw na które
mo¿e natrafiæ znaczna liczba u¿ytkowników podczas procesu aktualizacji.
Szczegó³ow± listê zmian znajdziesz na stronie
<a href="../../plus42.html">plus42.html</a> oraz w logach zmian CVS.

<!-- XXX add new stuff -->

<a name="libexpat"></a>
<ul>
<li><b>Pakiety korzystaj± obecnie z libexpat dostarczanego z X;
  xbase42.tgz jest twoim przyjacielem:</b><br>
Port libexpat zosta³ usuniêty.
Pakiety korzystaj± obecnie z libexpat który jest dostarczany z X-ami.
Wiele pakietów zale¿ny od libexpat poprzez inne zale¿no¶ci.
Przyk³adowo, wiele pakietów korzysta z gettext który zale¿y od
libexpat. W ten sposób, pakiety te s± zale¿ne od libexpat.

<p>
Oznacza to, ¿e wiele systemów które nie korzysta³y wcze¶niej z X-ów, teraz
bêdzie wymaga³o zainstalowania na nich <tt>xbase42.tgz</tt>.
Je¿eli nie wykonasz tego i bêdziesz próbowaæ zainstalowaæ pakiet który
wymaga libexpat, pkg_add(1) zwróci b³±d.

<p>
Zwróæ tak¿e uwagê ¿e kompilacja portów jest wspierana tylko przy pe³nej
instalacji, w³±cznie ze <i>wszystkimi</i> zestawami plików dla X-ów.

<p>
Ostatecznie po zaktualizowaniu wszystkich pakietów do wersji 4.2, wykonaj
porz±dki poprzez usuniêcie starego pakietu expat z twojego systemu:

<blockquote><pre>
  # <b>pkg_delete expat</b>
</pre></blockquote>

<i>Sytuacja dotyczy wiêkszej liczby u¿ytkowników!</i>
By³a to niefortunna decyzja której konsekwencje nie zosta³y rozpoznane
wcze¶niej.
Dla 4.3, libexpat stanie siê czê¶ci± <tt>base43.tgz</tt>, rozwi±zuj±c 
ten problem.

<p>
<a name="X7.2XF3"></a>
<li><b>Wkrocz w X.org v7.2, porzuæ XF3:</b><br>
Nowa wersja X-ów znajduje siê w OpenBSD 4.2
Twoja poprzednia konfiguracja X-ów mo¿e wymagaæ przystosowania, jednak
wielu u¿ytkowników zauwa¿y, ¿e nie musi ju¿ konfigurowaæ X-ów.

<p>
Poniewa¿ projekt OpenBSD zaadoptowa³ najnowsze wersje X.org, wsparcie
dla XF3 na platformie i386 (tylko ta platforma z niego korzysta³a)
zosta³o zaniechane.
XF3 by³o wymagane tylko dla naprawdê starych kart graficznych, które
nie by³y obs³ugiwane w XF4 i X.org.
Wierzymy ¿e ta zmiana nie bêdzie to dotyczyæ wielu u¿ytkowników.

<p>
Nowa wersja X.org zmienia wiele z plików konfiguracyjnych, zatem
powsta³a <a href="#Xup">osobna sekcja</a> dla uzytkowników X-ów
dotycz±ca tego procesu aktualizacji.

<p>
<a name="ahci"></a>
<li><b>Zaktualizowany sterownik
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ahci&amp;sektion=4">ahci</a>
  mo¿e zmieniæ sposób obs³ugi dysków:</b><br>

Systemy korzystaj±ce ze sterownika ahci(4), które dotychczas obs³ugiwa³y dyski
SATA poprzez sterownik
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wd&amp;sektion=4">wd(4)</a>
(np. wd0) mog± staæ siê teraz urz±dzeniami
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sd&amp;sektion=4">sd(4)</a>
(np. sd0).
Sprawd¼ wynik polecenia <tt>dmesg</tt>.
Napêd rozpoznawany wcze¶niej jako:

<p>
<blockquote><tt>
    pciide1 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: DMA, channel 0 wired to native-PCI, channel 1 wired to native-PCI<br>
    pciide1: using apic 2 int 11 (irq 11) for native-PCI interrupt<br>

    wd0 at pciide1 channel 0 drive 0: &lt;FUJITSU MHV2080BH&gt;<br>
    wd0: 16-sector PIO, LBA48, 76319MB, 156301488 sectors<br>
    wd0(pciide1:0:0): using PIO mode 4, Ultra-DMA mode 5
</tt></blockquote>

teraz rozpoznawany jest jako:

<p>
<blockquote><tt>
    ahci0 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: AHCI 1.1: apic 2 int 16 (irq 11)<br>
    scsibus1 at ahci0: 32 targets<br>
    sd0 at scsibus1 targ 0 lun 0: &lt;ATA, FUJITSU MHV2080B, 0084&gt; SCSI2 0/direct fixed<br>

    sd0: 76319MB, 76319 cyl, 64 head, 32 sec, 512 bytes/sec, 156301488 sec total
</tt></blockquote>

Mo¿e to stanowiæ problem dla u¿ytkowników wykonuj±cych zdalne aktualizacje
na tych maszynach, poniewa¿ plik fstab przestanie byæ "poprawny", zatem
system nie uruchomi siê ca³kowicie.
Niestety, sposób w jaki sterownik obs³uguje dysk jest zale¿ny od wielu
czynników w³±cznie z konfiguracj± BIOS-u, zatem JE¦LI kto¶ posiada
interfejs AHCI SATA, bêdzie musia³ eksperymentowaæ z podobn± maszyn±
dostêpn± lokalnie aby zobaczyæ czy plik <tt>/etc/fstab</tt>
musi zostaæ zmieniony.

<p>
Wierzymy, ¿e bardzo niewielu u¿ytkowników natrafi na takie problemy,
poniewa¿ sterowniki ahci(4) s± stosunkowo ma³o popularne w istniej±cym
sprzêcie, chocia¿ staj± siê teraz zoraz bardziej powszechne.

<p>
<a name="bgpd"></a>
<li><b>Zmiany w jêzyku filtrów bgpd:</b><br>
Regu³y filtrów bgpf korzystaj±ce tylko z <tt>prefixlen</tt>
jako parametrów filtra wymagaj± obecnie okre¶lenia rodziny
interfejsu jak np. <tt>inet</tt> lub <tt>inet6</tt>:

<p>
<blockquote><tt>
    allow from any <b>inet</b> prefixlen 8 - 24<br>
    deny from any <b>inet6</b> prefixlen &gt; 64<br>
</tt></blockquote>

<p>
Przypomnienamy, ¿e bgplg i wspó³pracuj±ce binarki zostaj± wy³±czone
podczas procesu instalacji/aktualizacji. Je¿eli z nich korzystasz musisz
je w³±czyæ ponownie zgodnie z opisem w 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgplg&amp;sektion=8">bgplg(8)</a>.

<p>
<a name="ssh1"></a>
<li><b>Zaniechano protoko³u SSH v1 w nowych instalacjach:</b><br>
Nowe instalacje OpenBSD domy¶lnie nie akceptuj± po³±czeñ SSH v1.
Ten proces aktualizacji nie zastêpuje plików konfiguracyjnych
w <tt>/etc/ssh</tt>, jednak mo¿esz uzyskaæ nowe zachowanie rêcznie.
Poni¿szy diff pokazuje co zosta³o zmienione w nowych instalacjach:


<blockquote><pre>
--- ./etc/ssh/sshd_config       Sat Mar 10 20:31:32 2007
+++ ../42/etc/ssh/sshd_config   Tue Aug 28 11:59:52 2007
@@ -11,3 +11,2 @@
 #Port 22
-#Protocol 2,1
 #AddressFamily any
@@ -15,2 +14,7 @@  
 #ListenAddress :: 
 +
 +# Disable legacy (protocol version 1) support in the server for new
 +# installations. In future the default will change to require explicit
 +# activation of protocol 1
 +Protocol 2

</pre></blockquote>

Jeszcze raz: zmiana ta NIE jest czê¶ci± standardowego procesu aktualizacji.

<p>
<a name="sudo"></a>

<li><b>Zmiana sposobu przekazywania zmiennych ¶rodowiskowych przez sudo(8):</b><br>
Ze
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8#SECURITY+NOTES">wzglêdów bezpieczeñstwa</a>
narzêdzie
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
resetuje ustawienia ¶rodowiskowe do ma³ego zestawu domy¶lnego, z tylko kilkoma
zmiennymi zachowanymi z poprzedniego ¶rodowiska.

<p>
Aby wiêkszo¶æ rzeczy dzia³a³a tak jak oczekujesz, plik z ³atk±
<a href="#patchfile">poni¿ej</a> dopisze liniê "<tt>Defaults env_keep</tt>"
do twojego pliku <tt>/etc/sudoers</tt> i postara siê uczyniæ ten plik
mo¿liwie podobnym do tego z <tt>etc42.tgz</tt>, jednak prawdopodobnie
zawiedzie.
Musisz upewniæ siê ¿e twój plik <tt>sudoers</tt> zawiera liniê
wygl±daj±c± jak:

<blockquote><pre>
%wheel       ALL=(ALL) SETENV: ALL
  <i>-- or --</i>
%wheel       ALL=(ALL) NOPASSWD: SETENV: ALL
</pre></blockquote>

zak³adaj±c, ¿e chcesz by grupa u¿ytkowników "wheel" posiada³a pe³ne
prawa w sudo.
Prawdopodobnie m±drym pomys³em bêdzie sprawdzenie czy sudo(8) dziala
poprawnie zanim wylogujesz siê z systemu po na³o¿eniu omawianej ³atki.

<p>
<a name="dedc"></a>
<li><b>[tylko alpha] Niektóre karty sieciowe de(4) bêd± obs³ugiwane przez sterownik dc(4):</b><br>
Dla platformy <a href="../../alpha.html">alpha</a>, niektóre karty sieciowe obs³ugiwane
dotychczas przez sterownik
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=de&amp;sektion=4">de(4)</a>
bêd± teraz obs³ugiwane przez sterownik
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&amp;sektion=4">dc(4)</a>.

<p>
JE¯ELI twoja karta sieciowa jest jedn± z nich, musisz zmodyfikowaæ twój plik
<tt>/etc/hostname.deX</tt> (podpowied¼: dowi±zanie twarde) oraz odpowiednie
regu³y w pliku pf.conf.

<p>
Przypominamy, ¿e zmianata dotyczy <i>tylko</i> platformy alpha. 

<p>
<a name="acpi"></a>
<li><b>[tylko i386] apm(4) ma pierwszeñstwo przed acpi(4)</b><br>
Wykrywanie urz±dzeñ dla i386 zosta³o zmodyfikowane tak
aby
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=4&amp;arch=i386">
    apm(4)</a> mia³o pierwszeñstwo przed
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acpi&amp;sektion=4">
  acpi(4)</a>.
Oznacza to, ¿e je¿eli twój sprzêt posiada zarówno urz±dzenia apm i acpi, zostan±
pod³±czone tylko urz±dzenia apm.
W przypadku gdy z jakiego¶ powodu wolisz korzystaæ z acpi, wy³±cz <tt>apm</tt>
w twoim kernelu korzystaj±c z <tt>config(8)</tt> lub <tt>boot -c</tt>.

<p>
<a name="rc.conf"></a>
<li><b>rc.conf:</b><br>
W odró¿nieniu od poprzednich wersji tego procesu, od
<a href="upgrade41.html">4.1</a> zak³adamy, ¿e plik
<tt>/etc/rc.conf</tt> nie jest edytowany przez u¿ytkownika.

Je¿eli wykonywa³e¶ zmiany w swoim pliku <tt>/etc/rc.conf</tt> przenie¶
je do <tt>/etc/rc.conf.local</tt>.
Je¿eli NIE masz pliku <tt>/etc/rc.conf.local</tt> po prostu skopiuj
swój plik <tt>/etc/rc.conf</tt> do <tt>/etc/rc.conf.local</tt>
i <i>usuñ ostatni± liniê z tego skryptu!</i>
W przeciwnym wypadku umie¶æ zawarto¶æ obecnego pliku <tt>rc.conf</tt>
na pocz±tku istniej±cego pliku <tt>rc.conf.local</tt> a nastêpnie
<i>usuñ ostatni± liniê skryptu</i> zanim przejdziesz do dalszych
etapów procesu.


<p>
<a name="kern"></a>
<li><b>Modyfikowany kernel:</b><br>
Sprawd¼ czy wykonywa³e¶ jakichkolwiek modyfikacji twojego kernela.
Przyk³adowo, mog³e¶ zmodyfikowaæ twoj± kartê sieciow± by korzysta³a 
z innych ni¿ domy¶lne ustawieñ, korzystaj±c z config(8).
Zapisz te ustawienia, aby je odtworzyæ dla nowego j±dra w 4.2.

</ul>

<p>
<hr>
<a name="upgrade"></a>
<h2>Proces uaktualnienia</h2>

<h3>Uaktualnienie za pomoc± kernela instalacyjnego</h3>
Je¿eli posiadasz dostêp do konsoli serwera wówczas naj³atwiejsz± i
najbezpieczniejsz± metod± na uaktualnienie systemu jest uruchomienie
systemu z medium instalacyjnego lub z
<a href="faq4.html#bsd.rd">bsd.rd</a> i wykonanie procesu uaktualnienia
który bardzo przypomina <a href="faq4.html">proces instalacji systemu</a>.
Nastêpnie nale¿y wykonaæ przedstawione poni¿ej <a href="#final">ostatnie
kroki</a>.

<p>
Jedn± z naj³atwiejszych metod na uruchomienie systemu z instalacyjnego kernela
jest umieszczenie pliku <i>bsd.rd</i> dla wersji 4.2 w g³ównym drzewie 
systemu plików i poinstruowanie boot loadera by wystartowa³ z 
pliku <i>bsd.rd</i>.
Dla amd64 oraz i386 wykonasz to wpisuj±c po prostu "<tt>boot bsd.rd</tt>"
gdy pojawi siê znak zachêty <tt>boot&gt;</tt>. 


<h3>Uaktualnienie bez kernela instalacyjnego</h3>
<i>NIE jest to zalecany proces. Korzystaj z medium instalacyjnego gdy
tylko jest to mo¿liwe!</i>

<p>
Czasem kto¶ mo¿e potrzebowaæ aktualizacji na maszynie na której nie mo¿na
w ³atwy sposób przeprowadziæ normalnego procesu aktualizacji.
Mo¿na wówczas wykonaæ aktualizacjê ostro¿nie postêpuj±c w procesie podobnym
do aktualizacji opartej na ¼ród³ach:

<ul>
<li><b>Umie¶æ pliki instalacyjne w "dobrej" lokalizacji</b>.
Upewnij siê ¿e posiadasz wystarczaj±c± ilo¶æ miejsca!

<p>
<li><b>Wy³±cz wszystkie "niebezpieczne" aplikacje ze startu podczas uruchomienia systemu:</b>
Mo¿e wyst±piæ moment gdy prawdopodobnie nie bêdzie w³±czony PF podczas upgrade systemu,
ale twoje aplikacje mog± pracowaæ poprawnie.
Ka¿da aplikacja zale¿na w sensie bezpieczeñstwa od PF powinna zostaæ wy³±czona zanim
wy³±czony zostanie PF i nie powinna byæ w³±czana a¿ do poprawnej weryfikacji dzia³ania
PF po aktualizacji.
Mog± dzia³aæ równie¿ inne aplikacje które chcesz by dzia³a³y podczas aktualizacji systemu,
je równie¿ zatrzymaj i wy³±cz.

<p>
<li><b>Sprawd¼ swój kernel:</b>
Aczkolwiek <b>wiêkszo¶æ osób mo¿e pomin±æ ten krok</b>, je¿eli modyfikowa³e¶ 
swój kernel w wersji 4.1, prawdopodobnie bêdziesz musia³ to zrobiæ równie¿ 
w wersji 4.2. 
W szczególno¶ci gdy przeprowadzasz proces aktualizacji zdalnie, teraz 
jest dobry czas, aby siê upewniæ ¿e nowy kernel bêdzie dzia³a³ po 
restarcie maszyny.
Je¶li jakiekolwiek zmiany musz± byæ wprowadzone do kernela, 
najbezpieczniejsz± rzecz± jak± mo¿na zrobiæ, jest wykonanie tych zmian na 
lokalnym systemie 4.2.
Mo¿e to byæ równie proste jak modyfikacja okre¶lonego urz±dzenia korzystaj±c z config(8),
lub mo¿e poci±gaæ za sob± rekompilacjê, je¶li dana opcja nie jest w³±czona w kernelu
GENERIC.
Prosimy zobacz <a href="faq5.html">FAQ 5 - Tworzenie systemu ze ¼róde³</a>,
zanim zdecydujesz siê na rekompilacjê kernela.

<p>
<li><b>Instalacja nowego kernela(-li)</b>
<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>   <i># gdzie maj± znajdowaæ siê pliki</i>
<b>cd ${RELEASEPATH}</b>
<b>rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd</b>
<b>cp bsd.rd bsd.mp /</b>
</pre></blockquote>

Zauwa¿ dodatkowe polecenia kopiuj±ce pierwotne j±dro: wykonywane s± aby 
mieæ pewno¶æ ¿e zawsze istnieje w³a¶ciwa kopia j±dra na dysku tak, ¿e 
mo¿liwy bêdzie boot systemu w sytuacji gdy przytrafi siê przerwa w 
zasilaniu w niew³a¶ciwym momencie lub awaria systemu.

<p>
<li><b>Instalacja nowych plików <tt>/etc/firmware</tt>:</b>
Z uwagi na fakt, ¿e niektóre za³adowane fragmenty "firmware" zosta³y
przeniesione z j±dra do katalogu <tt>/etc/firmware</tt>.
Dotyczy to wprawdzie tylko u¿ytkowników kilku urz±dzeñ, jednak nie 
zaszkodzi jak wszyscy wszyscy wykonaj± ten krok.
Aby rozpakowaæ pliki mikrokodu z <tt>base42.tgz</tt>, jako root u¿yj
polecenia:

<blockquote><pre>
<b>cd /</b>
<b>tar -C / -xzphf ${RELEASEPATH}/base42.tgz ./etc/firmware</b>
</pre></blockquote>

<p>
<li><b>Reboot na nowym j±drze:</b>
Mo¿e kusiæ chêæ opuszczenia tego kroku, ale powinien on byæ wykonany teraz,
jak zwykle, nowe j±dro uruchomi stare aplikacje przestrzeni u¿ytkownija
(takie jak bêd±cy wkrótce wa¿ny <tt>reboot</tt>!), jednak czêsto nowe
aplikacje NIE bêd± dzia³a³y ze starym j±drem.

<p>
<li><b>Instalacja nowych aplikacji przestrzeni u¿ytkownika</b>
<i>NIE instaluj teraz <tt>etc42.tgz</tt> oraz <tt>xetc42.tgz</tt>, poniewa¿
proces ten nadpisze twoje aktualne pliki konfiguracyjne!</i>

<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>
<b>cd ${RELEASEPATH}</b>
<b>tar -C / -xzphf base42.tgz</b>
<b>tar -C / -xzphf comp42.tgz</b>
<b>tar -C / -xzphf game42.tgz</b>
<b>tar -C / -xzphf man42.tgz</b>
<b>tar -C / -xzphf misc42.tgz</b>
<b>tar -C / -xzphf xbase42.tgz</b>
<b>tar -C / -xzphf xfont42.tgz</b>
<b>tar -C / -xzphf xserv42.tgz</b>
<b>tar -C / -xzphf xshare42.tgz</b>
</pre></blockquote>

Uwaga: nie wszystkie elementy musz± byæ zainstalowane dla wszystkich aplikacji,
jednak¿e, je¿eli zainstalowa³e¶ dany zbiór oryginalnie, powiniene¶ z pewno¶ci±
uaktualniæ go teraz nowym zbiorem.

<p>
Ponadto pliki z <tt>/etc</tt> s± zarz±dzane oddzielnie, zatem <tt>etc42.tgz</tt> 
oraz <tt>xetc42.tgz</tt> NIE s± tutaj rozpakowywane.

<p>
<li><b>Aktualizacja <tt>/dev</tt>.</b>
Nowy plik 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
zostanie skopiowany do /dev/ podczas instalacji <tt>base42.tgz</tt>, zatem powiniene¶
zwyczajnie wykonaæ poni¿sze: 

<blockquote><pre>
<b>cd /dev</b>
<b>./MAKEDEV all</b>
</pre></blockquote>

<p>
<li><b>Zaktualizuj <tt>/etc</tt> jak poni¿ej</b>.

<p>
<li><b>Reboot</b>
</ul>

Podczas tego procesu,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
mo¿e zwróciæ pewien b³±d podobny do poni¿szego:

<pre>
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or dire
    ctory, fs=., avail=-1, blocksize=380204
</pre>
Wiadomo¶æ ta mo¿e byæ bezpiecznie zignorowana, mo¿esz te¿ chcieæ zatrzymaæ
sendmail(8)-a na czas aktualizacji.
Zwracamy uwagê, ¿e sendmail nie dzia³a w tym punkcie aktualizacji dobrze
i wymagany jest jego restart (jako czê¶æ restartu maszyny), zanim poczta
bêdzie mog³a byæ obs³ugiwana zgodnie z oczekiwaniami.

<p>

<hr>
<a name="final"></a>
<h2>Ostatnie kroki</h2>

Jakkolwiek wykonujesz aktualizacjê, czy to przez kernel instalacyjny
i wykonanie "formalnego" procesu aktualizacji, czy te¿ aktualizacjê
binarn± "w-miejsce", musisz wykonaæ kilka kroków.


<a name="etcUpgrade"></a>
<h3>1. Aktualizacja <tt>/etc</tt></h3>

<p>
Rozpakuj plik <tt>etc42.tgz</tt> do tymczasowej lokalizacji:

<blockquote><pre>
<b>tar -C /tmp -xzphf ${RELEASEPATH}/etc42.tgz</b>
</pre></blockquote>

Pliki które prawdopodobnie mog± byæ skopiowane z <tt>etc42.tgz</tt> "w takiej postaci
w jakiej s±":

<blockquote><pre>
etc/magic
etc/man.conf
etc/netstart
etc/rc
etc/rc.conf
etc/rpc
etc/services
etc/mail/helpfile
etc/mail/localhost.cf
etc/mail/sendmail.cf
etc/mail/submit.cf
etc/mtree/4.4BSD.dist
etc/mtree/BSD.local.dist
etc/mtree/special
</pre></blockquote>

Zauwa¿, ¿e JEST mo¿liwe by lokalnie zmodyfikowaæ te pliki, je¿eli to 
by³o zrobione, bêdzie konieczne rêczne scalenie.
Zwróæ szczególn± uwagê na <tt>mail/*</tt> je¿eli u¿ywasz czego¶
innego ni¿ domy¶lna konfiguracja Sendmail(8)-a. 
Tutaj s± linie kopiuj/wklej do kopiowania tych plików, zak³adaj±c ¿e
rozpakowa³e¶ <tt>etc42.tgz</tt> w miejscu sugerowanym powy¿ej:

<blockquote><pre>
<b>cd /tmp/etc
cp magic man.conf netstart rc rc.conf rpc services /etc
cp mtree/* /etc/mtree/
cp mail/helpfile mail/localhost.cf mail/submit.cf /etc/mail
cp mail/sendmail.cf /etc/mail     </b><i># Uwa¿aj na ten plik!!</i>
</pre></blockquote>

<p>
<a name="patchfile"></a>
Pliki które musz± byæ rêcznie w³±czone, uwzglêdniaj±c lokalne
zmiany w nich wykonane, je¿eli by³y modyfikowane z domy¶lnych,
w przeciwnym wypadku, po prostu równie¿ je skopiuj:

<blockquote><pre>
etc/ntpd.conf
etc/sensorsd.conf
etc/ssh/ssh_config
etc/ssl/x509v3.cnf
etc/sudoers
etc/sysctl.conf
etc/wsconsctl.conf
var/www/conf/httpd.conf
</pre></blockquote>

Zmiany w tych plikach znajduj± siê w <a href="../upgrade42.patch">tym patch-u</a>.
Mo¿esz spróbowaæ z niego skorzystaæ wykonuj±c jako root nastepuj±ce polecenie:

<blockquote><pre>
<b>cd /</b>
<b>patch -C -p0 &lt; upgrade42.patch</b>
</pre></blockquote>

Spowoduje to przetestowanie ³atki jak dobrze pasuje do TWOJEGO systemu,
aby j± zastosowaæ opu¶æ opcjê "<tt>-C</tt>".
Zauwa¿ ¿e w sytuacji w której posiadasz zmodyfikowane pliki, lub pliki które 
nie s± wystarczaj±co aktualne, a tak¿e w sytuacji w której zosta³y zaktualizowane
z wersji "snapshot" 3.9, pliki te mog± nie zostaæ "czysto" zaakceptowane.
W takiej sytuacji, bêdziesz musia³ rêcznie uwzglêdniæ zmiany.
Prosimy wykonaj test tego procesu zanim siê na niego zdecydujesz dla maszyny
do której nie mo¿esz siê w ³atwy sposób dostaæ.

<p>
W poni¿szych plikach zosta³y wprowadzone pewne zmiany na które nale¿y zwróciæ
uwagê, lecz nie mog± byæ bezpo¶rednio skopiowane lub scalone (przyk³adowo
je¿eli korzystasz z bgpd.conf, przyj¿yj siê sugerowanej zmianie strategii i 
zdecyduj czy jest w³a¶ciwa dla twoich potrzeb).

<blockquote><pre>
etc/bgpd.conf
etc/mail/spamd.conf
etc/ospfd.conf
etc/ssh/sshd_config
</pre></blockquote>

Ostatecznie skorzystaj z
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newaliases&amp;sektion=8">newaliases(8)</a>
aby zaktualizowaæ bazê aliasów oraz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
aby utorzyæ jakiekolwiek nowe katalogi:
<blockquote><pre>
<b>newaliases</b>
<b>mtree -qdef /etc/mtree/4.4BSD.dist -p / -u</b>
</pre></blockquote>

<a name="Kernchk"></a>
<h3>2. Sprawdzanie kernela</h3>
Uwaga: <b>wiêkszo¶æ osób mo¿e pomin±æ ten krok!</b>

<p>
Je¿eli pod±¿a³e¶ za instrukcjami procesu aktualizacji bez instalacji
nowego kernela, juz zakoñczy³e¶ ten krok procesu.
Jednak¿e, je¶li korzysta³e¶ z medium instalacyjnego, i posiada³e¶
zmodyfikowany kernel w 4.1, istnieje prawdopodobieñstwo, ¿e bêdziesz
musia³ zmodyfikowaæ kernel w 4.2.
Mo¿e to byæ równie proste jak modyfikacja okre¶lonego urz±dzenia korzystaj±c z config(8),
lub mo¿e poci±gaæ za sob± rekompilacjê, je¶li dana opcja nie jest w³±czona w kernelu
GENERIC.
Prosimy zobacz <a href="faq5.html">FAQ 5 - Tworzenie systemu ze ¼róde³</a>,
zanim zdecydujesz siê na rekompilacjê kernela.


<a name="Xup"></a>
<h3>3. Pliki konfiguracyjne X-ów</h3>
Ze wzglêdu na znacz±ce zmiany w systemie X dla tego wydania, najprostrzym
sposobem na aktualizacjê X-ów do wersji z 4.2 mo¿e byæ wykonanie kopii
zapasowej plików konfiguracyjnych X-ów, rozpakowanie xetc42.tgz, i rêcznie 
wprowadzenie wszystkich zmian które wykona³e¶.

<p>
Plikami które najprawdopodobniej mo¿esz chcieæ zachowaæ s±
<tt>/etc/X11/xorg.conf</tt> oraz <tt>/etc/X11/xinit/xinitrc</tt>.
Poniewa¿ X-y czêsto pracuj± BEZ pliku xorg.conf, mo¿esz spróbowaæ
uruchomiæ je bez tego pliku, zanim wprowadzisz do nowej wersji swoje
zmiany.

<p>
Rozpakuj xetc42.tgz podobnie jak inne zestawy plików:
<blockquote><pre>
<b>export RELEASEPATH=/usr/rel
cd ${RELEASEPATH}
tar -C / -xzphf xetc42.tgz
</b></pre></blockquote>

<p>


<a name="Pkgup"></a>
<h3>3. Aktualizacja pakietów</h3>
Je¶li instalowa³e¶ jakiekolwiek pakiety w twoim systemie, powiniene¶
zaktualizowaæ je po zakoñczeniu aktualizacji systemu bazowego.
Jednak¿e pamiêtaj ¿e niektóre pakiety mog± wymagaæ dalszej konfiguracji
przed i/lub po uaktualnieniu pakietu.
Sprawd¼ informacje dotycz±ce aktualizacji koniecznych pakietów.

<p>
Poni¿sze pakiety znane s± z problemów jakie mog± wyst±piæ
podczas ich aktualizacji dla znacznej grupy u¿ytkowników.
Fakt, ¿e dany pakiet nie wystêpuje na tej li¶cie nie oznacza ¿e jego
uaktualnienie bêdzie proste.
Musisz odrobiæ "pracê domow±" dla aplikacji których U¯YWASZ.

<ul>
  <li><b>xfce:</b> Zmieni³ siê ca³kowicie katalog z plikami konfiguracyjnymi 
  oraz pliki konfiguracyjne. Prawdopodobnie bêdziesz musia³ utworzyæ od
  pocz±tku twoj± konfiguracjê.
</ul>

<p>
Zanim przejdziemy dalej, jest kilka zmian w wydaniu 4.2 o których
powiniene¶ wiedzieæ:

<ul>
  <li>Usuniêty zosta³ port libexpat a pakiety korzystaj± obecnie
  z libexpat dostarczanego z X11.
  Wiele pakietów zale¿y od libexpat poprzez inne zale¿no¶ci.
  Przyk³adowo, wszystkie pakiety korzystaj±ce z gettext zale¿a tak¿e
  od libexpat.
  Oznacza to, ¿e zanim bêdziesz móg³ dodawaæ lub aktualizowaæ pakiety,
  najprawdopodobniej bêdziesz musia³ zainstalowaæ <tt>xbase42.tgz</tt>,
  nawet je¿eli twoje pakiety nie wymagaj± graficznych operacji.
  Zobacz sekcjê <a href="faq4.html#AddFileSet">FAQ</a>dotycz±c± dodawania
  <tt>xbase42.tgz</tt> do zainstalowanego systemu.
  Je¿eli tego nie wykonasz i bêdziesz probowa³ zainstalowaæ pakiet który
  wymaga libexpat, pkg_add(1) najprawdopodobniej zwróci b³±d.

  <li>Je¿eli korzystasz z pkg_add(1) poprzez sudo(8), musisz zmieniæ plik
  <tt>/etc/sudoers</tt> w sposób w jaki próbuje to zrobiæ
  <a href="#patchfile">³atka</a>.
  Wiêcej informacji znajdziesz w sekcji
  <a href="#sudo">zmiany w sudo(8)</a>.

</ul>


Narzêdzia obs³ugi pakietów pozwalaj± na aktualizacjê
"w miejsce", poprzez u¿ycie <tt>pkg_add -u</tt>.
Przyk³adowo, aby zaktualizowaæ twoje pakiety, upewnij siê ze <tt>PKG_PATH</tt>
wskazuje na katalog z pakietami dla 4.2 na twoim CD lub najbli¿szym
mirrorze FTP (przyp. t³um. lub na katalog na lokalnym dysku),
i u¿yj polecenia podobnego to poni¿szego
 
<blockquote><pre>
<b># pkg_add -ui -F update -F updatedepends</b>
</pre></blockquote>

gdzie opcja <tt>-u</tt> wskazuje tryb aktualizacji, <tt>-i</tt> okre¶la 
tryb interaktywny, wiêc pkg_add bêdzie zwraca³ siê do ciebie gdy
napotka niejasno¶æ. Przeczytaj stronê manuala dla 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+4.2">
  pkg_add(1)</a> oraz dokument FAQ dotycz±cy 
<a href="faq15.html#PkgMgmt">zarz±dzania pakietami</a>.

<p>
Najprawdopodobniej zobaczysz podobny komunikat podczas wykonywania
podanego powy¿ej polecenia:

<blockquote><pre>
Looking for updates: complete
Cannot find updates for expat-2.0.0
Proceed? [y/N] 
</pre></blockquote>

Oznacza on natrafienie na problem z libexpat i jego rozwi±zanie
wymaga zainstalowania <tt>xbase42.tgz</tt> jak to zosta³o opisane
powy¿ej.
Je¿eli nie masz zainstalowanego xbase42.tgz, zalcane jest przerwanie
aktualizacji pakietów, zainstalowanie xbase42.tgz a nastêpnie ponowne
uruchomienie aktualizacji pakietów.

<p>
Ostatecznie po zaktualizowaniu wszystkich twoich pakietów,
posprz±taj system usuwaj±c stary pakiet expat z systemu:

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>


<p>
<font color="#0000e0">

<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade42.html,v 1.28 ]<br>
$Translation: upgrade42.html,v 1.8 2008/07/30 23:22:55 tkniaz Exp $<br>
-->
$OpenBSD: upgrade42.html,v 1.7 2008/08/04 12:05:27 tobias Exp $
</small>
</body>
</html>

