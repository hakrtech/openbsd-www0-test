<html>
<head>
<title>10.0 - Gestion du syst&egrave;me</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif"> 
<p>
<h2><font color=#e00000>10.0 - Gestion du syst&egrave;me</font> 
  <hr></h2>
<p></p>

<p>
<ul>
  <h3>Table des mati&egrave;res</h3>
  <li><a href="#wheel"         >10.1 - Quand j'essaie de passer root &agrave; 
    l'aide de su, on me dit que je suis dans le mauvais groupe</a></li>
  <li><a href="#DupFS"         >10.2 - Comment dupliquer un syst&egrave;me de 
    fichiers ?</A></li>
  <li><a href="#rc"            >10.3 - Comment d&eacute;marrer des services en 
    m&ecirc;me temps que le syst&egrave;me ? (Vue d'ensemble de rc(8) )</A></li>
  <li><a href="#RelayingDenied">10.4 - Pourquoi les utilisateurs sont interdits 
    de relais quand ils envoient des mails &agrave; distance &agrave; travers 
    mon syst&egrave;me OpenBSD ?</a></li>
  <li><a href="#POP"           >10.5 - J'ai mis en place POP, mais j'ai des erreurs 
    quand j'acc&egrave;de &agrave; ma messagerie via POP. Que puis-je faire ? 
    </a></li>
  <li><a href="#HTTPS"         >10.6 - Configurer HTTP en mode s&eacute;curis&eacute; 
    &agrave; l'aide de SSL(8)</a></li>
  <li><a href="#vipw"          >10.7 - J'ai effectu&eacute; des changements dans 
    /etc/passwd avec vi(1), mais les changements ne semblent pas &ecirc;tre pris 
    en compte. Pourquoi ?</a></li>
  <li><a href="#AddDelUser"    >10.8 - Comment je cr&eacute;e un compte utilisateur 
    ? Ou je supprime un compte utilisateur ?</a></li>
  <li><a href="#FTPOnly"       >10.9 - Comment puis-je cr&eacute;er un compte 
    pour ftp uniquement ?</a></li>
  <li><a href="#Quotas"        >10.10 - Mise en place des quotas </a></li>
  <li><a href="#Kerberos"      >10.11 - Mise en place d'un Client/Serveur Kerberos</a></li>
  <li><a href="#AnonFTP"       >10.12 - Mise en place d'un serveur FTP Anonyme</a></li>
  <li><a href="#ftpchroot"     >10.13 - Confiner les utilisateurs &agrave; leur 
    r&eacute;pertoire HOME avec ftpd(8)</a> 
  <li><a href="#Patches"       >10.14 - Appliquer des correctifs sous OpenBSD</a> 
</ul>
<p></p> 
<hr>

<br>

<p>
<a name= "wheel"></a>
<a name= "10.1"></a>
<h2>10.1 - Quand j'essaie de passer root &agrave; l'aide de su, on me dit que 
  je suis dans le mauvais groupe</h2>
<p></p>
<p></p>

<p> Les utilisateurs existant sur le syst&egrave;me doivent &ecirc;tre rajout&eacute;s 
  au groupe <kbd>&quot;</kbd><kbd>wheel&quot;</kbd> &agrave; la main. Ceci est 
  fait pour des raisons de s&eacute;curit&eacute;, et vous devriez apporter une 
  attention toute particuli&egrave;re lorsque vous donnez l'acc&egrave;s &agrave; 
  ce groupe &agrave; des utilisateurs. Sous OpenBSD, les utilisateurs appartenant 
  au groupe <kbd>wheel</kbd> sont autoris&eacute;s &agrave; utiliser le programme 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html">su(1)</a> 
  pour devenir root. Les utilisateurs n'appartenant pas &agrave; ce groupe ne 
  peuvent pas utiliser su(1). Voici un exemple d'une entr&eacute;e <kbd>/etc/group</kbd> 
  pour mettre l'utilisateur <strong>ericj</strong> dans le groupe <kbd>&quot;wheel&quot;</kbd>. 
<p>Si vous ajoutez un utilisateur avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html">adduser(8)</a>, 
  vous pouvez le mettre dans le groupe wheel en r&eacute;pondant wheel &agrave; 
  la question <tt>Invite <i>user</i> into other groups:</tt> Ceci aura pour effet 
  de rajouter l'entr&eacute;e correspondante dans /etc/group qui ressemble &agrave; 
  la ligne suivante :
<ul>
<pre>
wheel:*:0:root,ericj
</pre>
</ul>

<p>Si vous cherchez un moyen pour limiter l'acc&egrave;s des utilisateurs aux 
  privil&egrave;ges du super-utilisateur, sans pour autant les mettre dans le 
  groupe <kbd>&quot;wheel&quot;</kbd>, utilisez <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html">sudo(8)</a>. 
</p>
<p><a name= "DupFS"></a> <a name= "10.2"></a> </p>

<h2>10.2 - Comment dupliquer un syst&egrave;me de fichiers ?</h2>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

<p>Pour dupliquer votre syst&egrave;me de fichiers, utilisez <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a> 
  et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>. 
  Par exemple, pour dupliquer tout ce qu'il y a sous le r&eacute;pertoire <kbd>SRC</kbd> 
  vers le r&eacute;pertoire <kbd>DST</kbd>, faites un : </p>
<ul>
<pre>
# <strong>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</strong>
</pre>
</ul>
<p>dump est con&ccedil;u pour vous fournir beaucoup de possibilit&eacute;s de 
  sauvegarde, et c'est peut-&ecirc;tre trop si vous voulez juste dupliquer une 
  partie d'un syst&egrave;me de fichiers (entier). La commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html">tar(1)</a> 
  peut &ecirc;tre plus rapide pour ce genre d'op&eacute;ration. Le format est 
  tr&egrave;s similaire &agrave; celui de dump : 
<UL>
<PRE>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</PRE>
</UL>
<p>
<a name= "rc"></a>
<a name="10.3"></a>
<h2>10.3 - Comment d&eacute;marrer des services en m&ecirc;me temps que le syst&egrave;me 
  ? (Vue d'ensemble de rc(8) )</h2>
<p></p>

<p>OpenBSD utilise un d&eacute;marrage de type <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">rc(8)</a>. 
  Il utilise seulement quelques fichiers cl&eacute;s pour le d&eacute;marrage.</p>
<ul>
  <li>/etc/rc - Script principal. Ne doit pas &ecirc;tre &eacute;dit&eacute;.
  <li>/etc/rc.conf - Fichier de configuration utilis&eacute; par <i>/etc/rc </i>pour 
    savoir quels services doivent &ecirc;tre d&eacute;marr&eacute;s en m&ecirc;me 
    temps que le syst&egrave;me
  <li>/etc/netstart - Script pour initializer le r&eacute;seau. Ne devrait pas 
    &ecirc;tre &eacute;dit&eacute;.
  <li>/etc/rc.local - Script utilis&eacute; pour l'administration locale. C'est 
    l&agrave; o&ugrave; les informations relatives &agrave; de nouveaux services 
    ou des informations sp&eacute;cifiques &agrave; l'h&ocirc;te doivent &ecirc;tre 
    stock&eacute;es.
  <li>/etc/rc.securelevel - Script utilis&eacute; pour ex&eacute;cuter des commandes 
    qui doivent &ecirc;tre ex&eacute;cut&eacute;es avant que le niveau de s&eacute;curit&eacute; 
    ne change. Voir <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a> 
  <li>/etc/rc.shutdown - Script ex&eacute;cut&eacute; lors de l'arr&ecirc;t de 
    la machine. Mettez tout ce que vous voulez ex&eacute;cuter avant l'arr&ecirc;t 
    de la machine dans ce fichier. Voir <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&sektion=8&format=html">rc.shutdown(8)</a> 
</ul>

<h3>Comment fonctionne rc(8) ?</h3>
<p><i>/etc/rc.conf</i>, <i>/etc/rc.local</i> et <i>/etc/rc.shutdown</i>. Les principaux 
  fichiers &agrave; conna&icirc;tre par l'administrateur syst&egrave;me. Pour 
  comprendre le fonctionnement de la proc&eacute;dure rc(8), en voici le d&eacute;roulement 
  : </p>
<ul>
  <i>/etc/rc </i>est appel&eacute; apr&egrave;s le d&eacute;marrage du noyau. 
  <li>Les syst&egrave;mes de fichiers sont v&eacute;rifi&eacute;s. Cette v&eacute;rification 
    n'aura pas lieu si le fichier /etc/fastboot existe. Ce n'est certainement 
    pas une bonne id&eacute;e.
  <li>Les variables de configuration sont lues &agrave; partir de <i>/etc/rc.conf</i>
  <li>Les syst&egrave;mes de fichiers sont mont&eacute;s
  <li><i>/tmp </i>est nettoy&eacute; et les fichiers d'&eacute;diteurs sont pr&eacute;serv&eacute;s
  <li>Le r&eacute;seau est configur&eacute; &agrave; l'aide de <i>/etc/netstart</i>
<ul>
      <li>Les interfaces r&eacute;seau sont mont&eacute;es.
      <li>Le nom d'h&ocirc;te et le nom de domaine (ainsi que d'autres param&egrave;tres) 
        sont positionn&eacute;s 
    </ul>
  <li>Les services syst&egrave;me sont d&eacute;marr&eacute;s
  <li>Diverses v&eacute;rifications sont effectu&eacute;es (quota, savecore, etc).
  <li>Les services locaux sont d&eacute;marr&eacute;s &agrave; partir de <i>/etc/rc.local</i>
</ul>

<h3>D&eacute;marrage des services fournis avec OpenBSD</h3>

<p>La plupart des services fournis par d&eacute;faut avec OpenBSD sont lanc&eacute;s 
  au d&eacute;marrage simplement en modifiant le fichier de configuration <i>/etc/rc.conf</i>. 
  Pour commencer, jetez un coup d'oeil au fichier <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf">/etc/rc.conf</a> 
  par d&eacute;faut. Vous verrez des lignes similaires &agrave; la ligne suivante 
  : </p>
<ul><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
</pre></ul>

<p>Une ligne telle que celle-ci montre que ftpd n'est pas lanc&eacute; au d&eacute;marrage 
  du syst&egrave;me. (Du moins pas &agrave; travers rc(8), lisez la <a href="faq10.html#AnonFTP">FAQ 
  Serveur FTP Anonyme</a> pour plus d'informations. ) Dans tous les cas, chaque 
  ligne est dot&eacute;e d'un commentaire qui vous montrent les drapeaux utilis&eacute;s 
  dans le cadre d'une utilisation <b>NORMALE </b>du service. Cela ne veut pas 
  dire que vous devez appeler ce service avec ces m&ecirc;mes drapeaux. Vous pouvez 
  toujours utiliser man(1) pour savoir comment d&eacute;marrer un service donn&eacute; 
  de la mani&egrave;re que vous souhaitez. Par exemple, voici la ligne par d&eacute;faut 
  concernant httpd(8) :</p>
<ul><pre>
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
</pre></ul>

<p>D'apr&egrave;s cet exemple, vous pouvez voir qu'aucun drapeau n'est n&eacute;cessaire 
  pour d&eacute;marrer httpd normalement. Ainsi, la ligne &quot;<b> httpd_flags=""</b> 
  suffit. Mais pour d&eacute;marrer httpd avec le support ssl (Reportez vous &agrave; 
  la <a href="#HTTPS">FAQ SSL</a> ou &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>), 
  vous devez d&eacute;marrer httpd avec une ligne comme celle-ci : &quot;httpd_flags="-DSSL"&quot;.</p>
<h3>D&eacute;marrage et configuration des services locaux</h3>

<p>Pour les services que vous installez via la collection de ports ou d'autres 
  m&eacute;thodes, vous devez utiliser le fichier <i>/etc/rc.local</i>. Par exemple, 
  j'ai install&eacute; un service fourni par l'applicatif /usr/local/sbin/daemonx. 
  Je souhaite que ce service soit lanc&eacute; au d&eacute;marrage. Pour cela, 
  je rajoute les lignes suivantes dans <i>/etc/rc.local</i> :</p>
<ul><pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre></ul>

<p>A partir de l&agrave;, ce service sera lanc&eacute; au d&eacute;marrage. Vous 
  pourrez voir toutes les erreurs au d&eacute;marrage. Un d&eacute;marrage normal 
  sans erreurs affichera le message suivant : </p>
<ul><pre>
Starting local daemons: daemonx.
</pre></ul>

<h3>rc.shutdown</h3>

<p> <i>/etc/rc.shutdown</i> est un script ex&eacute;cut&eacute; &agrave; l'arr&ecirc;t 
  de la machine. Toutes les t&acirc;ches &agrave; effectuer avant l'arr&ecirc;t 
  du syst&egrave;me devront &ecirc;tre ajout&eacute;es &agrave; ce fichier. Si 
  vous avez apm, vous pouvez aussi positionner &quot;powerdown=YES&quot;. C'est 
  l'&eacute;quivalent de &quot;shutdown -p&quot;.</p>
<p>
<a name= "RelayingDenied"></a>
<a name="10.4"></a>
<h2>10.4 - Pourquoi les utilisateurs sont interdits de relais quand ils envoient 
  des mails &agrave; distance &agrave; travers mon syst&egrave;me OpenBSD ?</h2>
<p></p>

<p> Essayez ceci : </p>
<ul>
<pre>
# <strong>cat /etc/mail/sendmail.cf | grep relay-domains</strong>
</pre>
</ul>
<p> Le r&eacute;sultat ressemblerait &agrave; la ligne suivante : </p>
<ul>
<pre>
FR-o /etc/mail/relay-domains
</pre>
</ul>
<p> Si ce fichier n'existe pas, cr&eacute;ez le. Vous devez saisir les h&ocirc;tes 
  qui envoient des messages &agrave; distance en respectant la syntaxe suivante 
  :</p>
<ul>
<pre>
.domain.com    #Allow relaying for/to any host in domain.com
sub.domain.com #Allow relaying for/to sub.domain.com and any host in that domain
10.2           #Allow relaying from all hosts in the IP net 10.2.*.*
</pre>
</ul>
<p>N'oubliez pas d'envoyer un signal 'HangUP' &agrave; sendmail (signal qui notifie 
  la plupart des processus de relire leur fichier de configuration) :</p>
<ul><pre>
# <Strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre></ul>
<p>
<h3>Pour plus d'informations </h3>

<p>
<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.html">http://www.sendmail.org/tips/relaying.html</a>
<li><a href="http://www.sendmail.org/antispam.html">http://www.sendmail.org/antispam.html</a>
</ul>
<p></p>

<p>
<a name= "POP"></a>
<a name="10.5"></a>
<h2>10.5 - J'ai mis en place POP, mais j'ai des erreurs quand j'acc&egrave;de 
  &agrave; ma messagerie via POP. Que puis-je faire ? </h2>
<p></p>

La plupart des probl&egrave;mes rencontr&eacute;s avec POP sont li&eacute;s aux 
fichiers temporaires et aux fichiers verrous. Si votre serveur POP renvoie une 
erreur du type : 
<ul>
<pre>
-ERR Couldn't open temporary file, do you own it?
</pre>
</ul>
<p> Essayez de positionner les permissions comme suit :
<ul>
<pre>
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre>
</ul>
<p>V&eacute;rifiez aussi que l'utilisateur poss&egrave;de son propre fichier /var/mail. 
  Bien &eacute;videmment, ceci devrait &ecirc;tre le cas (comme par exemple l'utilisateur 
  joe qui poss&egrave;de /var/mail/joe) mais si &ccedil;a n'a pas &eacute;t&eacute; 
  configur&eacute; proprement, le probl&egrave;me viendrait de l&agrave; !
<p>Bien entendu, si vous donner l'acc&egrave;s &agrave; /var/mail en &eacute;criture 
  au groupe mail, vous allez probablement vous exposer &agrave; des vagues et 
  obscurs probl&egrave;mes de s&eacute;curit&eacute;. Il se pourrait que &ccedil;a 
  ne pose aucun probl&egrave;me mais on ne sait jamais (et particuli&egrave;rement 
  si vous &ecirc;tes un site de haut vol, un FAI,...) ! Essayez cucipop ou un 
  autre service POP de la collection de ports OpenBSD. Ou peut-&ecirc;tre vous 
  avez s&eacute;lectionn&eacute; les mauvaises options pour votre programme POP 
  serveur (comme le dot locking). Ou vous avez peut-&ecirc;tre simplement besoin 
  de changer le r&eacute;pertoire dans lequel les verrous sont cr&eacute;es (bien 
  que les op&eacute;rations de verrouillage ne devraient &ecirc;tre b&eacute;n&eacute;fiques 
  qu'au service POP). 
<p><b>PS:</b> Il est &agrave; noter que OpenBSD n'a pas de groupe &quot;mail&quot;. 
  Vous devez en cr&eacute;er un dans le fichier <i>/etc/group</i>. La ligne suivante 
  devrait suffire :
<ul><pre>
mail:*:6:
</pre></ul>

<p></p>

<p>
<a name= "HTTPS"></a>
<a name="10.6"></a>
<h2>10.6 - Configurer HTTP en mode s&eacute;curis&eacute; &agrave; l'aide de SSL(8)</h2>
<p></p>
<p></p>
<p></p>

<p>OpenBSD est fourni avec des librairies RSA et un service httpd supportant SSL 
  &agrave; partir de la version 2.8. Cependant, si vous utilisez OpenBSD 2.6 ou 
  2.7 vous devez utiliser des packages SSL fournis pour avoir le support SSL. 
  Pour plus d'informations, <b>man 8 ssl</b>. </p>
<p>Pour utiliser SSL avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>, 
  vous devez d'abord cr&eacute;er un certificat. Ce certificat sera stock&eacute; 
  dans <i>/etc/ssl/private/</i>. Les &eacute;tapes d&eacute;crites ici sont en 
  partie prises de la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>. 
  Lisez la pour plus d'informations. Cette partie de la FAQ s'int&eacute;resse 
  seulement &agrave; la g&eacute;n&eacute;ration d'un certificat RSA pour les 
  serveurs Web. Elle ne d&eacute;crit pas les certificats serveur DSA. Pour plus 
  d'informations &agrave; ce sujet, lisez la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.</p>
<p> Pour commencer, vous aurez besoin de cr&eacute;er votre cl&eacute; serveur 
  et le certificat. Pour utiliser les fonctionnalit&eacute;s RSA, vous devez mettre 
  &agrave; jour libssl. Maintenant vous pouvez cr&eacute;er votre cl&eacute; en 
  utilisant OpenSSL :</p> 

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p> Ou si vous voulez que la cl&eacute; soit crypt&eacute;e avec un mot de passe 
  que vous devez saisir &agrave; chaque d&eacute;marrage des serveurs </p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p> La prochaine &eacute;tape consiste &agrave; g&eacute;n&eacute;rer une requ&ecirc;te 
  de signature de certificat qui est utilis&eacute;e pour permettre &agrave; une 
  autorit&eacute; de certification (CA) de signer votre certificat. Pour cela, 
  utilisez la commande suivante : </p>

<div style="margin-left: 2em">
  <pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</pre>
</div>

<p> Le fichier <i>server.csr</i> pourra alors &ecirc;tre communiqu&eacute; &agrave; 
  une autorit&eacute; de certification qui signera la cl&eacute;. Une de ces autorit&eacute;s 
  est <b>Thawte Certification</b> que vous pourrez joindre &agrave; l'adresse 
  <a href="http://www.thawte.com/">http://www.thawte.com/</a>. Thawte peut actuellement 
  signer vos cl&eacute;s RSA keys. Une proc&eacute;dure est entrain d'&ecirc;tre 
  mise en place pour permettre la signature des cl&eacute;s DSA.</p>

<p> Si vous ne pouvez pas vous permettre un tel service, ou si vous voulez auto-signer 
  le certificat, vous pouvez utiliser la commande suivante :</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</pre>
</div>

<p> Avec <i>/etc/ssl/server.crt</i> et <i>/etc/ssl/private/server.key</i>, vous 
  devez &ecirc;tre d&eacute;sormais capable de d&eacute;marrer <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a> 
  avec le drapeau <b>-DSSL</b>, activant ainsi les transactions https sur le port 
  443 de votre machine. </p> 

<p>
<a name= "vipw"></a>
<a name="10.7"></a>
<h2>10.7 - J'ai effectu&eacute; des changements dans /etc/passwd avec vi(1), mais 
  les changements ne semblent pas &ecirc;tre pris en compte. Pourquoi ?</h2>
<p></p>
<p>Si vous &eacute;ditez /etc/passwdf, vos modifications seront perdues. OpenBSD 
  g&eacute;n&egrave;re /etc/passwd dynamiquement avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0">pwd_mkdb(8)</a>. 
  Le fichier principal de mots de passe sous OpenBSD est /etc/master.passwd. D'apr&egrave;s 
  pwd_mkdb(8), </p>

<ul>
  <pre>
FILES
     /etc/master.passwd  fichier courant de mots de passe 
     /etc/passwd         fichier de mots de passe au format Version 7
     /etc/pwd.db         fichier non s&eacute;curis&eacute; de mots de passe au format base de donn&eacute;es
     /etc/pwd.db.tmp     fichier temporaire
     /etc/spwd.db        fichier s&eacute;curis&eacute; de mots de passe au format base de donn&eacute;es
     /etc/spwd.db.tmp    fichier temporaire</pre>
</ul>
<P>Dans un fichier de mots de passe Unix traditionnel, toutes les informations 
  y compris le mot de passe crypt&eacute; de l'utilisateur sont &agrave; la disposition 
  de n'importe quel utilisateur du syst&egrave;me (et c'est la cible principale 
  de programmes tels que Crack). 4.4BSD a introduit le fichier master.passwd qui 
  a un format &eacute;tendu (avec les options additionnelles par rapport &agrave; 
  /etc/passwd). Ce fichier n'est accessible que pour root. Pour un acc&egrave;s 
  plus rapide aux donn&eacute;es, les appels &agrave; la librairie qui utilisent 
  ce type d'informations acc&egrave;dent normalement &agrave; /etc/pwd.db et &agrave; 
  /etc/spwd.db.
<P>OpenBSD met &agrave; votre disposition un outil qui vous permet d'&eacute;diter 
  le fichier de mots de passe. Cet outil s'appelle vipw(8). vipw utilisera vi 
  (ou votre &eacute;diteur favori tel que d&eacute;fini par $EDITOR) pour &eacute;diter 
  /etc/master.passwd. Suite &agrave; vos modifications, vipw recr&eacute;era /etc/passwd, 
  /etc/pwd.db, et /etc/spwd.db qui tiendront compte de vos modifications. vipw 
  verouille aussi l'acc&egrave;s &agrave; ces fichiers de telle fa&ccedil;on &agrave; 
  en interdire l'acc&egrave;s &agrave; quiconque essaie d'en changer le contenu 
  en m&ecirc;me temps que vous.</p>
<p>
<a name= "AddDelUser"></a>
<a name="10.8"></a>
<h2>10.8 - Comment je cr&eacute;e un compte utilisateur ? Ou je supprime un compte 
  utilisateur ?</h2>
<p></p>
<p></p>

<p>Sous OpenBSD 2.6, la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a> 
  permet de cr&eacute;er des comptes utilisateurs. Dans la version 2.7, la commande 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a> 
  a &eacute;t&eacute; ajout&eacute;e pour permettre d'ajouter et de supprimer 
  des comptes utilisateurs et des groupes.
<ul>
	<li><a href="#adduser">adduser(8)</a>
	<li><a href="#user">user(8)</a>
</ul>

<a name="adduser"></a> 
<p>La meilleure mani&egrave;re de cr&eacute;er un compte utilisateur sous OpenBSD 
  est d'utiliser le script <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>. 
  Ce script est param&eacute;trable &agrave; travers le fichier <b>/etc/adduser.conf</b>. 
  Bien que c'est la m&eacute;thode recommand&eacute;e pour cr&eacute;er des comptes 
  utilisateurs, il est toujours possible de les cr&eacute;er &agrave; la main 
  en utilisant <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&sektion=8&format=html">vipw(8)</a>. 
  adduser(8) permet d'effectuer des v&eacute;rifications sur la coh&eacute;rence 
  de <b>/etc/passwd<i>, </i>/etc/group</b>, et les bases de donn&eacute;es shell. 
  adduser(8) cr&eacute;e pour vous les entr&eacute;es correspondantes et les r&eacute;pertoires 
  $HOME. Il peut aussi envoyer un message de bienvenue aux utilisateurs. Le comportement 
  de ce programme peut &ecirc;tre adapt&eacute; &agrave; vos besoins. Pour illustrer 
  notre propos, prenons comme exemple la cr&eacute;ation du compte <b>testuser</b>. 
  Le r&eacute;pertoire de cet utilisateur sera plac&eacute; sous <i>/home/testuser</i>. 
  L'utilisateur aura <b>guest </b>comme groupe et <i>/bin/ksh </i>comme shell.</p>
<ul><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>testuser</strong>
Enter full name []: <strong>Test FAQ User</strong>
Enter shell csh ksh nologin sh [ksh]: <strong>ksh</strong>
Uid [1002]: <strong>&lt;Enter&gt;</strong>
Login group testuser [testuser]: <strong>guest</strong>
Login group is ``guest''. Invite testuser into other groups: guest no
[no]: <strong>no</strong>
Enter password []: 
Enter password again []:

Name:     testuser
Password: ****
Fullname: Test FAQ User
Uid:      1002
Gid:      31 (guest)
Groups:   guest
HOME:     /home/testuser
Shell:    /bin/ksh
OK? (y/n) [y]: <strong>y</strong>
Added user ``testuser''
Copy files from /usr/share/skel to /home/testuser
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre></ul>

<p>Pour supprimer des comptes utilisateurs, utilisez la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html">rmuser(8)</a>. 
  Cette commande supprimera toute chose relative &agrave; l'utilisateur. Elle 
  supprimera son entr&eacute;e<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&sektion=1&format=html">crontab(1)</a>, 
  son r&eacute;pertoire $HOME (s'il lui appartient), et son courrier. Bien &eacute;videmment, 
  cette commande supprimera aussi les entr&eacute;es correspondantes dans <b>/etc/passwd 
  </b>et <b>/etc/group</b>. Comme exemple, nous allons utiliser cette commande 
  pour supprimer le compte utilisateur pr&eacute;c&eacute;demment cr&eacute;e. 
  Notez que la commande vous demande l'identifiant du compte et si oui ou non 
  elle doit supprimer le r&eacute;pertoire home de l'utilisateur. </p>
<ul><pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry:

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></ul>

<a name="user"></a>
<h3>10.8.2 - Cr&eacute;er des comptes utilisateurs via user(8)</h3>
<p>A partir de la version 2.7 de OpenBSD, plusieurs commandes ont &eacute;t&eacute; 
  ajout&eacute;es pour g&eacute;rer les utilisateurs et les groupes. Ces outils 
  sont moins interactifs que la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>, 
  ce qui en facilite l'usage dans des scripts. </p>
<ul>
  Voici une liste des commandes additionnelles : 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&sektion=8&format=html">group(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&sektion=8&format=html">groupadd(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&sektion=8&format=html">groupdel(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&sektion=8&format=html">groupinfo(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&sektion=8&format=html">groupmod(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&sektion=8&format=html">useradd(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&sektion=8&format=html">userdel(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&sektion=8&format=html">userinfo(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&sektion=8&format=html">usermod(8)</a> 
</ul>

<h4>10.8.2.1 - Cr&eacute;ation effective des comptes utilisateurs</h4>

<p>Etant donn&eacute; que la commande user(8) n'est pas interactive, la mani&egrave;re 
  la plus simple et la plus efficace pour cr&eacute;er des comptes utilisateurs 
  est d'utiliser la commande adduser(8). La commande <i>/usr/sbin/user</i> est 
  seulement une interface aux autres commandes <i>/usr/sbin/user*</i>. Ainsi, 
  dans l'exemple qui suit il est possible d'utiliser soit <b>user add </b>soit 
  <b>useradd</b>. Le choix est votre et ne change rien au r&eacute;sultat.</p>
<p>Dans cet exemple, nous allons cr&eacute;er un compte avec les m&ecirc;mes sp&eacute;cificit&eacute;s 
  que le compte cr&eacute;e <a href="#adduser">pr&eacute;c&eacute;demment</a>. 
  useradd(8) est bien plus facile &agrave; utiliser si vous connaissez les param&egrave;tres 
  par d&eacute;faut avant de cr&eacute;er un compte utilisateur. Ces param&egrave;tres 
  se trouvent dans le fichier <i>/etc/usermgmt.conf </i>et peuvent &ecirc;tre 
  visualis&eacute;s comme suit :</p>

<ul><pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></ul>

<p>Les param&egrave;tres ci-haut vont &ecirc;tre appliqu&eacute;s si vous ne les 
  positionnez pas &agrave; d'autres valeurs en utilisant des options lors de la 
  saisie de la ligne de commande. Par exemple, dans notre cas nous voulons que 
  l'utilisateur appartienne au groupe <b>guest </b> et non pas &agrave; <b>users</b>. 
  Il est &agrave; noter que lors de la cr&eacute;ation des comptes utilisateurs, 
  les mots de passe doivent &ecirc;tre sp&eacute;cifi&eacute;s sous leur forme 
  crypt&eacute;e en ligne de commande. Vous devez donc utiliser, au pr&eacute;alable, 
  l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&sektion=1&format=html">encrypt(1)</a> 
  pour cr&eacute;er le mot de passe. Par exemple : Les mots de passe par d&eacute;faut 
  sous OpenBSD utilisent l'algorithme Blowfish avec 6 r&eacute;it&eacute;rations. 
  Voici un exemple d'utilisation de la commande encrypt : </p>
<ul><pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre></ul>

<p> Maintenant que nous avons le mot de passe crypt&eacute;, nous sommes pr&ecirc;ts 
  &agrave; cr&eacute;er le compte utilisateur :</p>

<ul><pre>
# <strong>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</strong>
</pre></ul>

<p><b>Remarque :</b> Assurez vous d'utiliser &quot; pour englober le mot de passe. 
  L'utilisation de &quot;&quot; ne permet pas d'emp&ecirc;cher le shell d'interpr&eacute;ter 
  le jeu de caract&egrave;res correspondant au mot de passe avant de les communiquer 
  &agrave; user(8). De m&ecirc;me, assurez vous d'utiliser l'option <b>-m </b>si 
  vous voulez cr&eacute;er le r&eacute;pertoire $HOME de l'utilisateur et copier 
  les fichiers &agrave; partir de <i>/etc/skel</i> vers $HOME.</p>
<p>Pour voir si le compte utilisateur a &eacute;t&eacute; correctement cr&eacute;e, 
  nous pouvons recourir &agrave; plusieurs utilitaires. Voici quelques commandes 
  pour v&eacute;rifier rapidement que tout s'est bien pass&eacute; : </p>
<ul><pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Test FAQ User
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></ul>

<p>En plus de ces commandes, user(8) fournit son propre utilitaire, appel&eacute; 
  userinfo(8), qui permet d'afficher les caract&eacute;ristiques d'un compte utilisateur 
  : </p>
<ul><pre>
$ <strong>userinfo testuser</strong>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre></ul>

<h4>10.8.2.2 - Suppression des comptes utilisateurs</h4>

<p>Pour supprimer des comptes utilisateurs avec la hi&eacute;rarchie de commandes 
  user(8), vous devez utiliser userdel(8). Cette commande est simple et efficace. 
  Pour supprimer le compte pr&eacute;c&eacute;demment cr&eacute;e, utilisez : 
</p>
<p> # <strong>userdel -r testuser</strong> </p>

<p>Notez bien l'option <b>-r</b> qui doit &ecirc;tre sp&eacute;cifi&eacute;e si 
  vous voulez supprimer les r&eacute;pertoires $HOME aussi. Si vous voulez juste 
  bloquer l'acc&egrave;s au compte sans supprimer des informations li&eacute;es 
  au compte, utilisez <b>-p </b> au lieu de <b> -r</b>.</p>
<p>
<a name= "FTPOnly"></a>
<a name="10.9"></a>
<h2>10.9 - Comment puis-je cr&eacute;er un compte pour ftp uniquement ?</h2>
<p></p>

<p>Il y a plusieurs m&eacute;thodes pour effectuer cette op&eacute;ration. Une 
  des mani&egrave;res les plus communes est d'ajouter <i>/usr/bin/false </i> dans 
  le fichier <b>/etc/shells</b>. Et quand vous cr&eacute;ez le compte utilisateur, 
  attribuez lui le shell /usr/bin/false. Il sera alors capable d'utiliser les 
  fonctionnalit&eacute;s ftp sans pour autant &ecirc;tre capable de se connecter 
  de mani&egrave;re interactive. Par d&eacute;faut, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a> 
  affecte &agrave; l'utilisateur le r&eacute;pertoire <i>/home/&lt;user&gt;</i>. 
  Si c'est ce que vous souhaitez, laissez-le tel quel. Cependant, vous pouvez 
  affecter &agrave; l'utilisateur le r&eacute;pertoire que vous souhaitez. De 
  m&ecirc;me, vous pouvez confiner l'utilisateur &agrave; son r&eacute;pertoire 
  $HOME en ajoutant son nom &agrave; <i>/etc/ftpchroot</i>. En utilisant l'option 
  <b>-A</b> de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a>, 
  seuls les comptes list&eacute;s dans ce fichier seront autoris&eacute;s &agrave; 
  se connecter ! </p>
<p>
<a name= "Quotas"></a>
<a name="10.10"></a>
<h2>10.10 - Mise en place des quotas</h2>
<p></p>
<p>Les quotas sont utilis&eacute;s pour limiter l'espace disque disponible pour 
  les utilisateurs. Ce syst&egrave;me peut &ecirc;tre tr&egrave;s utile si vous 
  avez des ressources limit&eacute;es. Il y a deux mani&egrave;res de configurer 
  des quotas :</p>

<p>
<ul>
  <li>Quotas utilisateur</li>
  <li>Quotas groupe</li>
</ul>
<p></p>
<p>La premi&egrave;re &eacute;tape pour configurer les quotas est de s'assurer 
  que <tt>option QUOTA</tt> est pr&eacute;sente dans votre configuration noyau. 
  Cette option est incluse dans le noyau GENERIC. Ensuite, vous aurez besoin de 
  marquer les syst&egrave;mes de fichiers o&ugrave; les quotas sont utilis&eacute;s 
  dans le fichier <i>/etc/fstab</i>. Les mots cl&eacute;s <tt>userquota</tt> et 
  <tt>groupquota</tt> doivent &ecirc;tre utilis&eacute;s pour marquer chaque syst&egrave;me 
  de fichiers o&ugrave; les quotas sont activ&eacute;s. Par d&eacute;faut, les 
  fichiers <tt>quota.user</tt> et <tt>quota.group</tt> seront cr&eacute;es &agrave; 
  la racine des syst&egrave;mes de fichiers o&ugrave; les quotas sont utilis&eacute;s 
  pour stocker les informations relatives &agrave; ces derniers. Si vous voulez 
  les cr&eacute;er ailleurs (par exemple sous /var/quotas), utilisez userquota=/var/quotas/quota.user. 
  Voici un exemple de /etc/fstab avec un syst&egrave;me de fichiers avec quotas 
  activ&eacute;s :</p>

<ul>
<pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre>
</ul>

<p>Maintenant, il faut configurer les quotas par utilisateur. A cette fin, nous 
  utilisons la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html">edquota(8)</a>. 
  Une utilisation simple est <strong>edquota &lt;user&gt;</strong>. edquota(8) 
  va utiliser vi(1) pour &eacute;diter les quotas &agrave; moins que la variable 
  d'environnement EDITOR est positionn&eacute;e pour charger un autre &eacute;diteur. 
  Par exemple la commande :</p>
<ul>
<pre>
# <strong>edquota ericj</strong>
</pre>
</ul>

<p> Affichera un r&eacute;sultat similaire &agrave; : </p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p> Pour ajouter des limites, &eacute;diter l&agrave; pour donner un r&eacute;sultat 
  similaire &agrave; :</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>Comme on peut le voir, softlimit est fix&eacute; &agrave; 1000 blocs et hardlimit 
  &agrave; 1050 blocs. softlimit est une limite qui permet au syst&egrave;me de 
  pr&eacute;venir les utilisateurs quand ils l'ont d&eacute;pass&eacute;. Ils 
  auront alors jusqu'&agrave; la fin de leur p&eacute;riode de gr&acirc;ce pour 
  redescendre en dessous de cette limite. Les p&eacute;riodes de gr&acirc;ce peuvent 
  &ecirc;tre configur&eacute;es &agrave; l'aide de l'option <b>-t </b> de edquota(8). 
  Apr&egrave;s la fin de la p&eacute;riode de gr&acirc;ce, softlimit est g&eacute;r&eacute; 
  comme hardlimit. Ce qui cause un &eacute;chec d'allocation. </p>
<p>Une fois les quotas configur&eacute;s, il faut les activer. Pour cela, utilisez 
  la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html">quotaon(8)</a>. 
  Par exemple :</p>
<ul>
<pre>
# <strong>quotaon -a</strong>
</pre>
</ul>

<p>Cette commande analysera le contenu de /etc/fstab et activera les quotas sur 
  les syst&egrave;mes de fichiers o&ugrave; les options de quota sont positionn&eacute;es. 
  Maintenant que les quotas sont activ&eacute;s, vous pouvez les visualiser &agrave; 
  l'aide de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html">quota(1)</a>. 
  Ainsi, la commande <strong>quota &lt;user&gt;</strong> fournit les informations 
  concernant cet utilisateur. Si aucun argument n'est utilis&eacute;, quota vous 
  fournira des statistiques sur les quotas. Par exemple :</p>
<ul>
<pre>
# <Strong>quota ericj</strong>
</pre>
</ul>

<p> Afficherait :</p>

<ul>
<pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre>
</ul>

<p>Par d&eacute;faut, les quotas positionn&eacute;s dans /etc/fstab seront activ&eacute;s 
  au d&eacute;marrage. Pour les d&eacute;sactiver, utilisez :
<ul><pre># <strong>quotaoff -a</strong></pre></ul>
<p></p>

<p>
<a name= "Kerberos"></a>
<a name="10.11"></a>
<h2>10.11 - Mise en place d'un Client/Serveur Kerberos</h2>
<p></p>

<p>En tant d'utilisateur/administrateur de syst&egrave;mes OpenBSD, vous &ecirc;tes 
  chanceux car KerberosIV est pr&eacute;-install&eacute; par d&eacute;faut. Ce 
  chapitre est un guide pour l'installation et la configuration d'un serveur de 
  domaine Kerberos et d'un client.</p>
<p>Il est *TRES* important de se rappeler que les horloges des clients et des 
  serveurs Kerberos soient synchrones. S'il y a un d&eacute;calage de plus de 
  5 minutes, vous aurez des messages bizarres dont la signification ne laisse 
  rien supposer quant &agrave; un probl&egrave;me de d&eacute;calage d'horloge. 
  Par exemple :</p>

<ul>
<pre>
kinit: Can't send request (send_to_kdc) 
</pre>
</ul>

Voici un message d'erreur plus pr&eacute;cis : 
<ul>
<pre>
kauth: Time is out of bounds (krb_rd_req) 
</pre>
</ul>

<p>Une mani&egrave;re simple de synchroniser les horloges des syst&egrave;mes 
  consiste &agrave; utiliser ntpd, disponible dans la collection de ports sous 
  <b>/usr/ports/net/ntp/</b>. </p>
<p>Dans ce chapitre, nous supposerons que vous avez une connaissance pr&eacute;alable 
  des concepts Kerberos. Voici une liste d'excellentes r&eacute;f&eacute;rences 
  &agrave; ce sujet :</p>

<ul>
<li><a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html">The FreeBSD handbook</a> </li>
  <li>Utilisez la commande <strong>info kth-krb</strong></li>
<li><a href="http://web.mit.edu/kerberos/www/dialogue.html">Designing an Authentication System: a Dialogue in Four Scenes</a></li>
<li><a href="http://web.mit.edu/kerberos/www/papers.html#krb4">Papers and Documentation Describing KerberosIV</a></li>
</ul>
Sinon, faites l'acquisition de l'ouvrage suivant : 
<ul>
<li><a href="http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/">Network Security Private Communication in a Public World [Kaufman, Perlman, Speciner, 1995]</a></li> 
</ul>

<h3>Comment configurer le domaine et le serveur Kerberos</h3>

<p>Dans les exemples suivants, nous allons configurer le domaine CIARASYSTEMS.COM 
  dont le serveur principal est avalanche.ciarasystems.com.</p>
<p>Pour commencer, nous devons &eacute;diter les fichiers de configuration. Ces 
  fichiers se trouvent sous <tt>/etc/kerberosIV/</tt>. Les deux fichiers qui nous 
  int&eacute;ressent sont <i>krb.realms </i>et <i>krb.conf</i>. Commen&ccedil;ons 
  par ce dernier. </p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
</pre>
</ul>

<p>Comme vous pouvez le voir, les lignes pr&eacute;c&eacute;dentes informent kerberos 
  que le domaine est CIARASYSTEMS.COM (ou un domain logique) et qu'au sein de 
  ce domaine, avalanche est le serveur d'administration. Au tour de <i>krb.realms</i> 
  maintenant. Pour plus d'informations &agrave; ce sujet, voir <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html">krb.conf</a>.</p>
<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p> krb.realms permet de traduire un nom d'h&ocirc;te en nom de domaine Kerberos 
  pour les services fournis par l'h&ocirc;te en question. Chaque ligne du fichier 
  de traduction ressemble &agrave; l'une des lignes suivantes (domain_name doit 
  &ecirc;tre de la forme .XXX.YYY). Dans cet exemple, avalanche est le nom d'h&ocirc;te 
  d'une machine appartenant au domaine CIARASYSTEMS.COM. .ciarasystems.com est 
  le nom de domaine correspondant au domaine Kerberos CIARASYSTEMS.COM. Pout plus 
  d'informations, consultez la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html">krb.realms</a>.</p>
<p>Nous allons maintenant ex&eacute;cuter <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdb_init&sektion=8&format=html">kdb_init(8)</a> 
  pour initialiser la base de donn&eacute;es Kerberos :</p>
<ul>
<pre>
[root@avalanche kerberosIV] <strong>kdb_init</strong>
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.

Enter Kerberos master password: <strong>not shown</strong>
Verifying password -
Enter Kerberos master password:
</pre>
</ul>

<p>Ensuite nous devons utiliser <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html">kstash(8)</a> 
  pour sauvegarder la cl&eacute; du ma&icirc;tre de la base de donn&eacute;es 
  du centre de distribution de cl&eacute;s Kerberos (KDC) dans le fichier cache 
  de la cl&eacute; ma&icirc;tre.</p>
<ul>
  <pre>
[root@avalanche kerberosIV] <strong>kstash</strong>
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
</pre>
</ul>
<p>Le mot de passe crypt&eacute; du ma&icirc;tre est ainsi sauvegard&eacute; dans 
  /etc/kerberosIV/master_key. </p>
<p>L'&eacute;tape suivante consiste &agrave; ajouter deux noms principaux &agrave; 
  la base de donn&eacute;es pour chaque syst&egrave;me &agrave; s&eacute;curiser 
  avec Kerberos. Ces noms correspondent &agrave; <i>kpasswd </i>et <i>rcmd</i>. 
  Ils doivent exister pour chaque syst&egrave;me et on doit prendre comme nom 
  d'instance le nom du syst&egrave;me &agrave; s&eacute;curiser. Les services 
  <i>kpasswd </i>et <i>rcmd</i> permettent &agrave; d'autres syst&egrave;mes de 
  changer les mots de passe Kerberos et d'ex&eacute;cuter des commandes telles 
  que <i>rcp</i>, <i>rlogin </i>et <i>rsh</i>.</p>
<ul>
  <pre>
# <b>kdb_edit</b>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: <strong>passwd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <strong>&lt;----- Utilisez 'RANDOM' comme mot de passe</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: <strong>rcmd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <strong>&lt;----- </strong><strong>Utilisez 'RANDOM' comme mot de passe</strong>
Verifying password -
New Password:

Random password [y] ? <Strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <strong>&lt;----- Tapez sur &lt;Entr&eacute;e&gt; pour finir</strong>

</pre>
</ul>

<p>Les fichiers srvtab sont les fichiers des cl&eacute;s de service. Ces cl&eacute;s 
  doivent extraites de la base de donn&eacute;es du centre de distribution de 
  cl&eacute;s Kerberos pour permettre &agrave; des services de s'authentifier 
  en utilisant Kerberos. Pour chaque nom d'h&ocirc;te sp&eacute;cifi&eacute; en 
  ligne de commande, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html">ext_srvtab(8)</a> 
  cr&eacute;e le fichier des cl&eacute;s de service hostname-new-srvtab. Ce fichier 
  contient toutes les entr&eacute;es dans la base correspondant &agrave; une instance 
  hostname.</p>
<ul>
<pre>
[root@avalanche kerberosIV] <Strong>ext_srvtab avalanche</strong>

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

[root@avalanche kerberosIV] <strong>mv avalanche-new-srvtab srvtab</strong>
[root@avalanche kerberosIV] <strong>chmod 600 srvtab</strong>
</pre>
</ul>

<p>Maintenant nous pouvons ajouter des utilisateurs &agrave; notre base.</p>
<ul>
  <pre>
[root@avalanche kerberosIV] <strong>kdb_edit</strong>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.
    
Principal name: <strong>jeremie</strong>
Instance:
    
&lt;Not found&gt;, Create [y] ? <strong>y</strong>
    
Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                &lt;---- saisissez un mot de passe s&eacute;curis&eacute; ici
Verifying password
    
New Password:                &lt;---- resaisissez votre mot de passe
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ? 
Edit O.K.
Principal name:          &lt;---- une entr&eacute;e vide terminera la session 
			       sinon vous pouvez ajouter d'autres entr&eacute;es.
</pre>
</ul>

<p>Kerberos est maintenant configur&eacute; et pr&ecirc;t &agrave; l'utilisation. 
  Tout ce qu'il reste &agrave; faire est d'activer le lancement au d&eacute;marrage 
  du serveur Kerberos et d'activer le support Kerberos au niveau des services.</p>
<p> Dans /etc/rc.conf, assurez-vous d'avoir la ligne suivante : 
<ul>
<tt>kerberos_server=YES</tt>
</ul>

Dans /etc/inetd.conf, supprimer le commentaire au niveau des lignes suivantes 
: 
<UL>
<pre>
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd
</pre>
</ul>

Puis red&eacute;marrez ou effectuer les op&eacute;rations suivantes :
<ul>
<pre>
[root@avalanche /] <Strong>kill -HUP `cat /var/run/inetd.pid`</strong>
[root@avalanche /] <Strong>/usr/libexec/kerberos >> /var/log/kerberos.log &</strong>
[root@avalanche /] <strong>/usr/libexec/kadmind -n >> /var/log/kadmind.log &</strong>
</pre>
</ul>
<p></p>

<p>Remarque : l'exemple ci-dessus montre une configuration serveur simple. Habituellement, 
  des serveurs redondants sont configur&eacute;s (comme serveurs esclaves) de 
  telle fa&ccedil;on que lorsqu'un serveur est hors service, les services d&eacute;pendant 
  de Kerberos sont toujours disponibles. Nous pouvons aussi ajouter les privileges 
  'su' &agrave; un nom principal donn&eacute;. Pour plus de d&eacute;tails, voir 
  <a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html#AEN9189">le 
  manuel FreeBSD</a>.</p>
<h3>Comment activer Kerberos c&ocirc;t&eacute; client</h3>

<p>Dans les exemples ci-apr&egrave;s, nous allons configurer une station de travail 
  appel&eacute;e <i>gatekeeper </i>pour qu'elle fasse partie du domaine Kerberos 
  CIARASYSTEMS.COM ayant avalanche.ciarasystems.com comme serveur principal.</p>
<p>Pour commencer, nous devons configurer <i>krb.conf </i>et <i>krb.realms</i> 
  comme nous l'avons fait pour le serveur afin de permettre &agrave; <i>gatekeeper 
  </i>de savoir quel serveur est le KDC et dans quel domaine il se trouve. Voici 
  le contenu de ces deux fichiers :</p>

<ul>
  <pre>
[root@gatekeeper kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

[root@gatekeeper kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>Nous avons maintenant besoin d'initialiser Kerberos. Pour obtenir un ticket, 
  nous utilisons <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html">kinit(1)</a>.</p>
<ul>
<pre>
xyz:jeremie% <Strong>kinit</strong>
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: <strong>jeremie</strong>
Password:
</pre>
</ul>

<p>Une fois que nous nous sommes identifi&eacute;s, nous pouvons lister nos tickets 
  avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html">klist(1)</a>.</p>
<ul>
<pre>
xyz:jeremie$ <strong>klist</strong>
Ticket file:    /tmp/tkt1000
Principal:      jeremie@CIARASYSTEMS.COM

  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@CIARASYSTEMS.COM
</pre>
</ul>

<p>Apparemment, notre configuration est correcte. Il nous suffit de tester. Ci-apr&egrave;s, 
  nous effectuons les tests avec rlogin(1) et telnet(1).</p>
<ul>
<pre>
xyz:jeremie% <Strong>telnet avalanche</strong>
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
</pre></ul>

De m&ecirc;me : 
<ul><pre>
xyz:jeremie% <Strong>rlogin avalanche</strong>
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
</pre>
</ul>

<p>Comme vous pouvez le constater, nous utilisons effectivement Kerberos pour 
  authentifier notre session rlogin. Pour supprimer les tickets, utilisez la commande 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html">kdestroy(1)</a>. 
  Par exemple :</p>
<ul>
<pre>
xyz:jeremie% <strong>kdestroy</strong>
Tickets destroyed.
xyz:jeremie% <Strong>rlogin avalanche</strong>
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused
</pre>
</ul>

<p>Ne soyez pas alarm&eacute; quand vous obtenez l'erreur 'Warning: no Kerberos 
  tickets issued.'. Cette erreur est normale car nous utilisons seulement l'authentification 
  Kerberos et pas de passation de tickets. Si vous souhaitez utiliser cette fonctionnalit&eacute;, 
  configurez <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html">OpenSSH</a> 
  qui supporte ce mode de fonctionnement. L'impl&eacute;mentation standard de 
  KerberosIV n'a pas le support pour la passation tgt non plus - alors que l'impl&eacute;mentation 
  krb4 de AFS kaserver le permet, puisque la version standard de KerberosIV v&eacute;rifie 
  l'adresse IP du client list&eacute; dans le ticket.</p>
<p>
<a name= "AnonFTP"></a>
<a name="10.12"></a>
<h2>10.12 - Mise en place d'un serveur FTP Anonyme</h2>
<p></p>
<p></p>
<p>Le mode FTP anonyme permet &agrave; des utilisateurs sans compte d'acc&eacute;der 
  aux fichiers sur votre machine en utilisant le protocole de transfert de fichiers. 
  Ce chapitre a pour but de fournir une vue d'ensemble de la configuration d'un 
  serveur FTP anonyme, les logs g&eacute;n&eacute;r&eacute;s, ...etc.</p>
<p></p>
<p></p>

<h3>Cr&eacute;ation du compte FTP account</h3>

<p>La premi&egrave;re &eacute;tape consiste &agrave; cr&eacute;er un compte &quot;ftp&quot; 
  sur votre syst&egrave;me. Ce compte ne doit pas avoir de mot de passe utilisable. 
  Dans cet exemple, nous allons consid&eacute;rer que /home/ftp est le r&eacute;pertoire 
  correspondant au compte &quot;ftp&quot; mais vous n'&ecirc;tes pas oblig&eacute; 
  de choisir la m&ecirc;me chose. Quand le mode anonyme est utilis&eacute;, le 
  d&eacute;mon ftp va se confiner au r&eacute;pertoire HOME de l'utilisateur 'ftp' 
  (dans notre cas, ce r&eacute;pertoire est /home/ftp). Pour en savoir plus, lisez 
  les pages du manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a> 
  et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html">chroot(2)</a>. 
  Voici un exemple de cr&eacute;ation du compte <i>ftp</i> en utilisant la commande 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>. 
  Au pr&eacute;alable, nous avons besoin d'ajouter /usr/bin/false au fichier <i>/etc/shells</i>. 
  C'est le shell que nous allons attribuer &agrave; l'utilisateur ftp. Il ne permettra 
  pas de connexion en login &agrave; ce compte m&ecirc;me si nous configurons 
  un mot de passe vide. Pour effectuer cette op&eacute;ration, il suffit de faire 
  <i>echo /usr/bin/false &gt;&gt; /etc/shells</i>. Si en plus vous souhaitez que 
  ce shell apparaisse dans la liste des choix propos&eacute;s par adduser, vous 
  devez modifier le fichier <i>/etc/adduser.conf</i>. </p>
<ul>
<pre>
oshibana# <strong>adduser</strong>
Use option ``-silent'' if you don't want see all warnings & questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>ftp</strong>
Enter full name []: <strong>anonymous ftp</strong>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <strong>false</strong>
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: <strong>no</strong>
Enter password []:
Set the password so that user cannot logon? (y/n) [n]: <strong>y</strong>

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: <strong>y</strong>
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre>
</ul>

<h3>Configuration du r&eacute;pertoire</h3>

<p>L'op&eacute;ration a cr&eacute;e, en plus de l'utilisateur, le r&eacute;pertoire 
  <i>/home/ftp</i>. C'est ce que nous voulons mais nous avons besoin d'effectuer 
  quelques modifications pour pr&eacute;parer le syst&egrave;me &agrave; h&eacute;berger 
  le service FTP anonyme. Ces modifications sont expliqu&eacute;es dans la page 
  du manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a>. 
</p>
<ul>
  <b>Vous n'avez pas besoin</b> de cr&eacute;er un r&eacute;pertoire /home/ftp/usr 
  ou /home/ftp/bin. <BR>
  <li><i>/home/ftp</i> - C'est le r&eacute;pertoire principal. Il doit &ecirc;tre 
    poss&eacute;d&eacute; par root avec les permissions 555.</li>
  <li><i>/home/ftp/etc</i> - Ce r&eacute;pertoire est optionnel et non recommand&eacute;. 
    Son seul but est de fournir des informations sur les comptes utilisateurs 
    existant. Si vous voulez que les fichiers de votre r&eacute;pertoire de ftp 
    soient associ&eacute;s &agrave; de vrais utilisateurs, vous devez copier /etc/pwd.db 
    et /etc/group dans ce r&eacute;pertoire. Les permissions du r&eacute;pertoire 
    doivent &ecirc;tre 511. Les permissions sur les deux fichiers doivent &ecirc;tre 
    444. Ils sont utilis&eacute;s pour fournir une correspondance entre des nombres 
    et les noms attribu&eacute;s aux comptes utilisateurs et groupes. Il n'y a 
    pas de mots de passe dans pwd.db. Tous les mots de passe sont stock&eacute;s 
    dans spwd.db alors ne copiez pas ce fichier.</li>
  <li><i>/home/ftp/pub</i> - C'est le r&eacute;pertoire standard pour mettre les 
    fichiers que vous voulez partagez. Ce r&eacute;pertoire doit avoir les permissions 
    555. </li>
</ul>

<p>Il est &agrave; noter que tous ces r&eacute;pertoires doivent &ecirc;tre la 
  propri&eacute;t&eacute; de &quot;root&quot;. Voici &agrave; quoi doivent ressembler 
  les r&eacute;pertoires apr&egrave;s leur cr&eacute;ation :</p>
<ul>
<pre>
oshibana# pwd 
/home
oshibana# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre>
</ul>

<h3>D&eacute;marrage du serveur et logs</h3>

<p>Vous pouvez choisir d'ex&eacute;cuter ftpd soit &agrave; partir de inetd soit 
  directement de le lancer directement via les scripts rc. L'exemple ci-apr&egrave;s 
  repr&eacute;sente le cas o&ugrave; le service est d&eacute;marr&eacute; &agrave; 
  partir de <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">inetd.conf</a>. 
  Tout d'abord, nous devons nous familiariser avec quelques options de ftpd. La 
  ligne par d&eacute;faut dans <i>/etc/inetd.conf</i> est :</p>
<ul><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US</strong>
</pre></ul>

<p>Comme vous pouvez le voir, ftpd est invoqu&eacute; avec <i>-US</i>. Ces options 
  vont permettre de logguer les connexions anonymes dans <i>/var/log/ftpd </i>et 
  les sessions courantes dans <i>/var/run/utmp</i>. Ce qui permet de voir ces 
  sessions via who(1). Dans certains cas, on souhaitera fournir un acc&egrave;s 
  anonyme et d&eacute;sactiver ftp pour les utilisateurs du syst&egrave;me. Pour 
  cela, il faut utiliser l'option <i>-A </i>de ftpd. Voici une ligne d'invocation 
  de ftpd en mode anonyme exclusif. On utilise aussi <i>-ll</i> qui loggue chaque 
  connexion vers syslog en plus des commandes ftp get, retrieve, etc.</p>
<ul><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA</strong>
</pre></ul>

<p> Remarque - Les personnes g&eacute;rant des serveurs ftp &agrave; HAUT trafic 
  ne devraient pas invoquer ftpd &agrave; partir de inetd.conf. La meilleure option 
  consiste &agrave; commenter la ligne correspondant &agrave; ftpd dans /etc/inetd.conf 
  et &agrave; d&eacute;marrer ftpd &agrave; partir de rc.conf avec l'option <i>-D</i>. 
  Ce qui va d&eacute;marrer ftpd en tant que d&eacute;mon. Ce mode de fonctionnement 
  est beaucoup moins co&ucirc;teux et plus rapide que le d&eacute;marrage via 
  inetd. La ligne correspondant &agrave; ftpd dans rc.conf ressemblerait &agrave; 
  : </p>
<ul><pre>
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
</pre></ul>

<p>Bien &eacute;videmment, cette m&eacute;thode ne fonctionnera que si ftpd est 
  comment&eacute; dans <i>/etc/inetd.conf</i>.</p>
<h3>Autres fichiers importants </h3>

<p>
<ul>
  <li><i>/etc/ftpwelcome</i> - Ce fichier contient le message de bienvenue qui 
    sera affich&eacute; aux personnes qui se connectent sur votre serveur ftp.</li>
  <li><i>/etc/motd</i> - Ce fichier contient le message qui sera affich&eacute; 
    aux utilisateurs une fois authentifi&eacute;s sur votre serveur ftp.</li>
  <li><i>.message</i> - Ce fichier peut &ecirc;tre mis dans n'importe quel r&eacute;pertoire. 
    Il contient un message qui sera affich&eacute; lorsque l'utilisateur entre 
    dans le r&eacute;pertoire o&ugrave; ce fichier se trouve.</li>
</ul>


<p>
<a name= "ftpchroot"></a>
<a name="10.13"></a>
<h2>10.13 - Confiner les utilisateurs &agrave; leur r&eacute;pertoire HOME avec 
  ftpd(8) </h2>
<p></p>

<p>le d&eacute;mon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a> 
  livr&eacute; avec OpenBSD est configur&eacute; par d&eacute;faut pour g&eacute;rer 
  cela de mani&egrave;re tr&egrave;s facile. Cette action est accomplie par le 
  biais du fichier <b>/etc/ftpchroot</b>.Puisqu'on ne peut pas toujours faire 
  confiance aux utilisateurs, il sera peut-&ecirc;tre n&eacute;cessaire de les 
  confiner &agrave; leur r&eacute;pertoire HOME. Ce mode de fonctionnement n'est 
  pas activ&eacute; par d&eacute;faut. Voici &agrave; quoi ressemble le mode par 
  d&eacute;faut :</p>
<ul><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 2.6 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
230- 
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230- 
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230- 
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> <strong>cd /</strong>
250 CWD command successful.
ftp> <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp> <strong>quit</strong>
221 Goodbye.
</pre></ul>

<p>Comme vous pouvez le voir, l'acc&egrave;s est permis &agrave; tout le serveur. 
  Dans un monde parfait o&ugrave; on peut faire confiance aux utilisateurs, il 
  n'y a pas de mal &agrave; &ccedil;a mais c'est loin d'&ecirc;tre le cas dans 
  la r&eacute;alit&eacute;. Pour confiner un utilisateur &agrave; son r&eacute;pertoire 
  HOME, il suffit simplement d'ajouter son nom au fichier <b>/etc/ftpchroot</b>. 
  Voici un exemple pour montrer cette restriction appliqu&eacute;e &agrave; l'utilisateur 
  &quot;ericj&quot; :</p>
<ul><pre>
$ <strong>cat /etc/ftpchroot</strong>
#       $OpenBSD: faq10.html,v 1.2 2002/05/02 20:41:54 jufi Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj
</pre></ul>

<p>Cette op&eacute;ration est suffisante pour emp&ecirc;cher l'utilisateur &quot;ericj&quot; 
  de sortir de son propre r&eacute;pertoire comme vous pouvez le voir &agrave; 
  travers l'exemple suivant. Le r&eacute;pertoire / correspond maintenant &agrave; 
  son r&eacute;pertoire HOME !</p>
<ul><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> <strong>cd /</strong>
250 CWD command successful.
ftp> <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp> <strong>quit</strong>
221 Goodbye.
</pre></ul>

<p>
<a name= "Patches"></a>
<a name="10.14"></a>
<h2>10.14 - Appliquer des correctifs sous OpenBSD</h2>
<p></p>

<p>Le code source de OpenBSD est en constante &eacute;volution et am&eacute;lioration. 
  En m&ecirc;me temps, des correctifs aux probl&eacute;mes les plus communs sont 
  cr&eacute;es et diffus&eacute;s au public. Ces correctifs apparaissent sur une 
  page web &agrave; l'adresse <a href="../../errata.html">http://www.openbsd.org/errata.html</a>. 
  Ils sont s&eacute;par&eacute;s en cat&eacute;gories. Ces cat&eacute;gories correspondent 
  &agrave; des correctifs qui concernent diff&eacute;rentes architectures ou &agrave; 
  des correctifs ind&eacute;pendants de l'architecture.</p>
<p>Cependant, il est &agrave; noter qu'il n'y a pas de correctifs pour les nouvelles 
  fonctionnalit&eacute;s ajout&eacute;es &agrave; OpenBSD. Les correctifs corrigent 
  uniquement des probl&eacute;mes de stabilit&eacute; ou de s&eacute;curit&eacute; 
  qui doivent &ecirc;tre r&eacute;gl&eacute;s tr&egrave;s rapidement, bien que 
  le choix final revienne &agrave; l'administrateur.</p>

<p> Comme exemple, nous allons appliquer un correctif de s&eacute;curit&eacute; 
  obtenu &agrave; partir de <a href="../../errata.html">errata.html</a> &agrave; 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=talkd&sektion=8">talkd(8).</a></p>

<h3>Quelle est la diff&eacute;rence entre ces correctifs et ce qui se trouve dans 
  l'arborescence CVS ? </h3>

<p>Tous les correctifs post&eacute;s sur <a href="../../errata.html">http://www.openbsd.org/errata.html</a> 
  concernent uniquement l'arborescence des sources de la derni&egrave;re version 
  diffus&eacute;e. Les autres correctifs qui concernent l'arborescence actuelle 
  de CVS peuvent contenir certaines modifications qui ne sont peut-&ecirc;tre 
  pas d&eacute;sirables sur la version de production.</p>
<h3>Pr&eacute;parer le syst&egrave;me pour l'application des correctifs</h3>
<p>Les correctifs d'OpenBSD sont distribu&eacute;s sous la forme de fichiers diff. 
  Ces fichiers sont des fichiers texte qui contiennent les diff&eacute;rences 
  par rapport au code source d'origine. Ils ne sont <b>PAS </b> distribu&eacute;s 
  sous forme binaire. Cela veut dire que pour appliquer les correctifs, vous devez 
  avoir &agrave; disposition sur votre syst&egrave;me le code source de la version 
  <b>RELEASE </b>d'OpenBSD. Cela ne veut pas dire que vous avez besoin de tout 
  le code source du syst&egrave;me d'exploitation OpenBSD pour appliquer les correctifs 
  &agrave; votre syst&egrave;me. Mais vous devez avoir le code source correspondant 
  au composant &agrave; corriger. Par exemple, si vous corrigez le noyau vous 
  devez avoir tout le code source au noyau.</p>
<p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a> 
  est un outil tr&egrave;s pratique pour t&eacute;l&eacute;charger uniquement 
  les sources dont vous avez besoin en utilisant des serveurs cvs anonymes situ&eacute;s 
  un peu partout dans le monde. Vous pouvez avoir une liste des serveurs disponibles 
  &agrave; l'adresse suivante :<br>
  <a href="http://www.openbsd.org/anoncvs.html">http://www.openbsd.org/anoncvs.html</a>. 
</p>
<p>Pour t&eacute;l&eacute;charger le code source correspondant &agrave; la version 
  actuelle via <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a>, 
  vous utiliseriez la ligne de commande suivante : </p>
<div style="margin-left: 2em">
<pre>
$ <b>cvs -danoncvs@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_0_BASE src/libexec/talkd/</b>
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h
</pre>
</div>

<p>Pour conna&icirc;tre le chemin CVS du code dont vous avez besoin, reportez-vous 
  &agrave; la ligne <i>Index:</i>. Dans notre cas, le chemin CVS est <i>src/libexec/talkd/</i>. 
  Il faut toujours v&eacute;rifier la revision de OPENBSD_version_number_BASE. 
  Sans &quot;_BASE&quot;, vous obtiendrez le code correspondant &agrave; la branche 
  stable qui contient probablement d'autres modifications qui peuvent interf&eacute;rer 
  avec la proc&eacute;dure d'application des correctifs. Si vous synchroniser 
  vos sources par rapport &agrave; la branche stable, les correctifs sont normalement 
  d&eacute;j&agrave; inclus dans le code source. Cependant, nous vous conseillons 
  de toujours effectuer une v&eacute;rification. Vous pouvez voir sur <a href="../../plus.html">http://www.openbsd.org/plus.html</a> 
  les correctifs qui ont &eacute;t&eacute; appliqu&eacute;s &agrave; la branche 
  stable. Si les correctifs n'ont pas encore &eacute;t&eacute; appliqu&eacute;s, 
  vous devez t&eacute;l&eacute;charger les sources de la derni&egrave;re RELEASE 
  en utilisant les commandes ci-haut.</p>
<p>Pour les utilisateurs ayant achet&eacute; des CDs OpenBSD officiels, vous pouvez 
  obtenir le code source directement &agrave; partir du CD. Reportez vous &agrave; 
  l'encart livr&eacute; avec votre CD. Vous n'aurez &agrave; ce moment-l&agrave; 
  besoin d'obtenir les sources via anoncvs. </p>
<ul>
  <pre>
Apply by doing:
        cd /usr/src
        patch -p0 < 026_talkd.patch
        cd libexec/talkd
        make obj && make depend && make && make install

Index: libexec/talkd/announce.c <b>&lt;------ Chemin CVS</b>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@ -160,6 +160,6 @@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre>
</ul>

<p>Une fois que vous avez obtenu les sources, vous pouvez t&eacute;l&eacute;charger 
  le correctif que vous mettrez sous <i>src/</i></p>
<h3>Application des correctifs </h3>

<p>
<div style="margin-left: 2em">
<pre>
$ <b>cd /usr/src</b>
$ <b>patch -p0&lt;/path/to/026_talkd.patch</b>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|       cd /usr/src
|       patch -p0 < 026_talkd.patch
|       cd libexec/talkd
|       make obj && make depend && make && make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <b>&lt;------------ Patch Succeeded</b>
done
$ <b>cd /usr/src/libexec/talkd/</b>
$ <b>ls</b>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <b>make obj && make depend && make</b>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/src/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 > talkd.cat8
$ <b>sudo make install</b>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -> /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>Une fois cette op&eacute;ration effectu&eacute;e, red&eacute;marrez le service.</p>
<p> <font color= "#0000e0"> <a href= "index.html">[Retour &agrave; l'Index G&eacute;n&eacute;ral]</a> 
  <a href= "faq9.html">[Vers la Section 9.0 - Migrer depuis Linux]</a> <a href= "../faq11.html">[Vers 
  la Section 11.0 - Optimisation des Performances]</a> </font> </p>
<p>
<hr>
<p><a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[back]"></a> 
  <a href="mailto:www@openbsd.org">www@openbsd.org</a> <br>
  <small>Originally [OpenBSD: faq10.html,v 1.65 2002/04/30 13:02:47 nick Exp ]</small><br>
<small>$Translation: faq10.html,v 1.6 2002/05/02 07:14:40 saad Exp $</small><br>
<small>$OpenBSD: faq10.html,v 1.2 2002/05/02 20:41:54 jufi Exp $</small><br>
<p></p>
</body>
</html>
