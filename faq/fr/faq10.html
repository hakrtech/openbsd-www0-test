<html>
<head>
<title>10.0 - Gestion du syst&egrave;me</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif"> 
<p>
<h2><font color=#e00000>10.0 - Gestion du syst&egrave;me</font> 
  <hr></h2>
<p></p>

<p>
<ul>
  <h3>Table des mati&egrave;res</h3>
  <li><a href="#wheel"         >10.1 - Quand j'essaie de passer root &agrave; 
    l'aide de su, on me dit que je suis dans le mauvais groupe</a></li>
  <li><a href="#DupFS"         >10.2 - Comment dupliquer un syst&egrave;me de 
    fichiers ?</A></li>
  <li><a href="#rc"            >10.3 - Comment d&eacute;marrer des services en 
    m&ecirc;me temps que le syst&egrave;me ? (Vue d'ensemble de rc(8) )</A></li>
  <li><a href="#RelayingDenied">10.4 - Pourquoi les utilisateurs sont interdits 
    de relais quand ils envoient des mails &agrave; distance &agrave; travers 
    mon syst&egrave;me OpenBSD ?</a></li>
  <li><a href="#POP"           >10.5 - J'ai mis en place POP, mais j'ai des erreurs 
    quand j'acc&egrave;de &agrave; ma messagerie via POP. Que puis-je faire ? 
    </a></li>
  <li><a href="#HTTPS"         >10.6 - Configurer HTTP en mode s&eacute;curis&eacute; 
    &agrave; l'aide de SSL(8)</a></li>
  <li><a href="#vipw"          >10.7 - J'ai effectu&eacute; des changements dans 
    /etc/passwd avec vi(1), mais les changements ne semblent pas &ecirc;tre pris 
    en compte. Pourquoi ?</a></li>
  <li><a href="#AddDelUser"    >10.8 - Comment je cr&eacute;e un compte utilisateur 
    ? Ou je supprime un compte utilisateur ?</a></li>
  <li><a href="#FTPOnly"       >10.9 - Comment puis-je cr&eacute;er un compte 
    pour ftp uniquement ?</a></li>
  <li><a href="#Quotas"        >10.10 - Mise en place des quotas disque utilisateur</a></li>
  <li><a href="#Kerberos"      >10.11 - Mise en place d'un Client/Serveur Kerberos</a></li>
  <li><a href="#AnonFTP"       >10.12 - Mise en place d'un serveur FTP Anonyme</a></li>
  <li><a href="#ftpchroot"     >10.13 - Restreindre les utilisateurs &agrave; 
    leur r&eacute;pertoire HOME avec ftpd(8)</a>
  <li><a href="#Patches"       >10.14 - Appliquer des correctifs dans l'environnement 
    OpenBSD.</a> 
</ul>
<p></p> 
<hr>

<br>

<p>
<a name= "wheel"></a>
<a name= "10.1"></a>
<h2>10.1 - Quand j'essaie de passer root &agrave; l'aide de su, on me dit que 
  je suis dans le mauvais groupe</h2>
<p></p>
<p></p>

<p> Les utilisateurs existant sur le syst&egrave;me doivent &ecirc;tre rajout&eacute;s 
  au groupe <kbd>&quot;</kbd><kbd>wheel&quot;</kbd> &agrave; la main. Ceci est 
  fait pour des raisons de s&eacute;curit&eacute;, et vous devriez apporter une 
  attention toute particuli&egrave;re lorsque vous donnez l'acc&egrave;s &agrave; 
  ce groupe &agrave; des utilisateurs. Sous OpenBSD, les utilisateurs appartenant 
  au groupe <kbd>wheel</kbd> sont autoris&eacute;s &agrave; utiliser le programme 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html">su(1)</a> 
  pour devenir root. Les utilisateurs n'appartenant pas &agrave; ce groupe ne 
  peuvent pas utiliser su(1). Voici un exemple d'une entr&eacute;e <kbd>/etc/group</kbd> 
  pour mettre l'utilisateur <strong>ericj</strong> dans le groupe <kbd>&quot;wheel&quot;</kbd>. 
<p>Si vous ajoutez un utilisateur avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html">adduser(8)</a>, 
  vous pouvez le mettre dans le groupe wheel en r&eacute;pondant wheel &agrave; 
  la question <tt>Invite <i>user</i> into other groups:</tt> Ceci aura pour effet 
  de rajouter l'entr&eacute;e correspondante dans /etc/group qui ressemble &agrave; 
  la ligne suivante :
<ul>
<pre>
wheel:*:0:root,ericj
</pre>
</ul>

<p>Si vous cherchez un moyen pour limiter l'acc&egrave;s des utilisateurs aux 
  privil&egrave;ges du super-utilisateur, sans pour autant les mettre dans le 
  groupe <kbd>&quot;wheel&quot;</kbd>, utilisez <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html">sudo(8)</a>. 
</p>
<p><a name= "DupFS"></a> <a name= "10.2"></a> </p>

<h2>10.2 - Comment dupliquer un syst&egrave;me de fichiers ?</h2>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>

<p>Pour dupliquer votre syst&egrave;me de fichiers, utilisez <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a> 
  et <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>. 
  Par exemple, pour dupliquer tout ce qu'il y a sous le r&eacute;pertoire <kbd>SRC</kbd> 
  vers le r&eacute;pertoire <kbd>DST</kbd>, faites un : </p>
<ul>
<pre>
# <strong>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</strong>
</pre>
</ul>
<p>dump est con&ccedil;u pour vous fournir beaucoup de possibilit&eacute;s de 
  sauvegarde, et c'est peut-&ecirc;tre trop si vous voulez juste dupliquer une 
  partie d'un syst&egrave;me de fichiers (entier). La commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html">tar(1)</a> 
  peut &ecirc;tre plus rapide pour ce genre d'op&eacute;ration. Le format est 
  tr&egrave;s similaire &agrave; celui de dump : 
<UL>
<PRE>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</PRE>
</UL>
<p>
<a name= "rc"></a>
<a name="10.3"></a>
<h2>10.3 - Comment d&eacute;marrer des services en m&ecirc;me temps que le syst&egrave;me 
  ? (Vue d'ensemble de rc(8) )</h2>
<p></p>

<p>OpenBSD utilise un d&eacute;marrage de type <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">rc(8)</a>. 
  Il utilise seulement quelques fichiers cl&eacute;s pour le d&eacute;marrage.</p>
<ul>
  <li>/etc/rc - Script principal. Ne doit pas &ecirc;tre &eacute;dit&eacute;.
  <li>/etc/rc.conf - Fichier de configuration utilis&eacute; par <i>/etc/rc </i>pour 
    savoir quels services doivent &ecirc;tre d&eacute;marr&eacute;s en m&ecirc;me 
    temps que le syst&egrave;me
  <li>/etc/netstart - Script pour initializer le r&eacute;seau. Ne devrait pas 
    &ecirc;tre &eacute;dit&eacute;.
  <li>/etc/rc.local - Script utilis&eacute; pour l'administration locale. C'est 
    l&agrave; o&ugrave; les informations relatives &agrave; de nouveaux services 
    ou des informations sp&eacute;cifiques &agrave; l'h&ocirc;te doivent &ecirc;tre 
    stock&eacute;es.
  <li>/etc/rc.securelevel - Script utilis&eacute; pour ex&eacute;cuter des commandes 
    qui doivent &ecirc;tre ex&eacute;cut&eacute;es avant que le niveau de s&eacute;curit&eacute; 
    ne change. Voir <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a> 
  <li>/etc/rc.shutdown - Script ex&eacute;cut&eacute; lors de l'arr&ecirc;t de 
    la machine. Mettez tout ce que vous voulez ex&eacute;cuter avant l'arr&ecirc;t 
    de la machine dans ce fichier. Voir <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&sektion=8&format=html">rc.shutdown(8)</a> 
</ul>

<h3>Comment fonctionne rc(8) ?</h3>
<p><i>/etc/rc.conf</i>, <i>/etc/rc.local</i> et <i>/etc/rc.shutdown</i>. Les principaux 
  fichiers &agrave; conna&icirc;tre par l'administrateur syst&egrave;me. Pour 
  comprendre le fonctionnement de la proc&eacute;dure rc(8), en voici le d&eacute;roulement 
  : </p>
<ul>
  <i>/etc/rc </i>est appel&eacute; apr&egrave;s le d&eacute;marrage du noyau. 
  <li>Les syst&egrave;mes de fichiers sont v&eacute;rifi&eacute;s. Cette v&eacute;rification 
    n'aura pas lieu si le fichier /etc/fastboot existe. Ce n'est certainement 
    pas une bonne id&eacute;e.
  <li>Les variables de configuration sont lues &agrave; partir de <i>/etc/rc.conf</i>
  <li>Les syst&egrave;mes de fichiers sont mont&eacute;s
  <li><i>/tmp </i>est nettoy&eacute; et les fichiers d'&eacute;diteurs sont pr&eacute;serv&eacute;s
  <li>Le r&eacute;seau est configur&eacute; &agrave; l'aide de <i>/etc/netstart</i>
<ul>
      <li>Les interfaces r&eacute;seau sont mont&eacute;es.
      <li>Le nom d'h&ocirc;te et le nom de domaine (ainsi que d'autres param&egrave;tres) 
        sont positionn&eacute;s 
    </ul>
  <li>Les services syst&egrave;me sont d&eacute;marr&eacute;s
  <li>Diverses v&eacute;rifications sont effectu&eacute;es (quota, savecore, etc).
  <li>Les services locaux sont d&eacute;marr&eacute;s &agrave; partir de <i>/etc/rc.local</i>
</ul>

<h3>D&eacute;marrage des services fournis avec OpenBSD</h3>

<p>La plupart des services fournis par d&eacute;faut avec OpenBSD sont lanc&eacute;s 
  au d&eacute;marrage simplement en modifiant le fichier de configuration <i>/etc/rc.conf</i>. 
  Pour commencer, jetez un coup d'oeil au fichier <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf">/etc/rc.conf</a> 
  par d&eacute;faut. Vous verrez des lignes similaires &agrave; la ligne suivante 
  : </p>
<ul><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags="-D"
</pre></ul>

<p>Une ligne telle que celle-ci montre que ftpd n'est pas lanc&eacute; au d&eacute;marrage 
  du syst&egrave;me. (Du moins pas &agrave; travers rc(8), lisez la <a href="faq10.html#AnonFTP">FAQ 
  Serveur FTP Anonyme</a> pour plus d'informations. ) Dans tous les cas, chaque 
  ligne est dot&eacute;e d'un commentaire qui vous montrent les drapeaux utilis&eacute;s 
  dans le cadre d'une utilisation <b>NORMALE </b>du service. Cela ne veut pas 
  dire que vous devez appeler ce service avec ces m&ecirc;mes drapeaux. Vous pouvez 
  toujours utiliser man(1) pour savoir comment d&eacute;marrer un service donn&eacute; 
  de la mani&egrave;re que vous souhaitez. Par exemple, voici la ligne par d&eacute;faut 
  concernant httpd(8) :</p>
<ul><pre>
httpd_flags=NO          # for normal use: "" (or "-DSSL" after reading ssl(8))
</pre></ul>

<p>D'apr&egrave;s cet exemple, vous pouvez voir qu'aucun drapeau n'est n&eacute;cessaire 
  pour d&eacute;marrer httpd normalement. Ainsi, la ligne &quot;<b> httpd_flags=""</b> 
  suffit. Mais pour d&eacute;marrer httpd avec le support ssl (Reportez vous &agrave; 
  la <a href="#HTTPS">FAQ SSL</a> ou &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>), 
  vous devez d&eacute;marrer httpd avec une ligne comme celle-ci : &quot;httpd_flags="-DSSL"&quot;.</p>
<h3>D&eacute;marrage et configuration des services locaux</h3>

<p>Pour les services que vous installez via la collection de ports ou d'autres 
  m&eacute;thodes, vous devez utiliser le fichier <i>/etc/rc.local</i>. Par exemple, 
  j'ai install&eacute; un service fourni par l'applicatif /usr/local/sbin/daemonx. 
  Je souhaite que ce service soit lanc&eacute; au d&eacute;marrage. Pour cela, 
  je rajoute les lignes suivantes dans <i>/etc/rc.local</i> :</p>
<ul><pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre></ul>

<p>A partir de l&agrave;, ce service sera lanc&eacute; au d&eacute;marrage. Vous 
  pourrez voir toutes les erreurs au d&eacute;marrage. Un d&eacute;marrage normal 
  sans erreurs affichera le message suivant : </p>
<ul><pre>
Starting local daemons: daemonx.
</pre></ul>

<h3>rc.shutdown</h3>

<p> <i>/etc/rc.shutdown</i> est un script ex&eacute;cut&eacute; &agrave; l'arr&ecirc;t 
  de la machine. Toutes les t&acirc;ches &agrave; effectuer avant l'arr&ecirc;t 
  du syst&egrave;me devront &ecirc;tre ajout&eacute;es &agrave; ce fichier. Si 
  vous avez apm, vous pouvez aussi positionner &quot;powerdown=YES&quot;. C'est 
  l'&eacute;quivalent de &quot;shutdown -p&quot;.</p>
<p>
<a name= "RelayingDenied"></a>
<a name="10.4"></a>
<h2>10.4 - Pourquoi les utilisateurs sont interdits de relais quand ils envoient 
  des mails &agrave; distance &agrave; travers mon syst&egrave;me OpenBSD ?</h2>
<p></p>

<p> Essayez ceci : </p>
<ul>
<pre>
# <strong>cat /etc/mail/sendmail.cf | grep relay-domains</strong>
</pre>
</ul>
<p> Le r&eacute;sultat ressemblerait &agrave; la ligne suivante : </p>
<ul>
<pre>
FR-o /etc/mail/relay-domains
</pre>
</ul>
<p> Si ce fichier n'existe pas, cr&eacute;ez le. Vous devez saisir les h&ocirc;tes 
  qui envoient des messages &agrave; distance en respectant la syntaxe suivante 
  :</p>
<ul>
<pre>
.domain.com    #Allow relaying for/to any host in domain.com
sub.domain.com #Allow relaying for/to sub.domain.com and any host in that domain
10.2           #Allow relaying from all hosts in the IP net 10.2.*.*
</pre>
</ul>
<p>N'oubliez pas d'envoyer un signal 'HangUP' &agrave; sendmail (signal qui notifie 
  la plupart des processus de relire leur fichier de configuration) :</p>
<ul><pre>
# <Strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre></ul>
<p>
<h3>Pour plus d'informations </h3>

<p>
<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.html">http://www.sendmail.org/tips/relaying.html</a>
<li><a href="http://www.sendmail.org/antispam.html">http://www.sendmail.org/antispam.html</a>
</ul>
<p></p>

<p>
<a name= "POP"></a>
<a name="10.5"></a>
<h2>10.5 - J'ai mis en place POP, mais j'ai des erreurs quand j'acc&egrave;de 
  &agrave; ma messagerie via POP. Que puis-je faire ? </h2>
<p></p>

La plupart des probl&egrave;mes rencontr&eacute;s avec POP sont li&eacute;s aux 
fichiers temporaires et aux fichiers verrous. Si votre serveur POP renvoie une 
erreur du type : 
<ul>
<pre>
-ERR Couldn't open temporary file, do you own it?
</pre>
</ul>
<p> Essayez de positionner les permissions comme suit :
<ul>
<pre>
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre>
</ul>
<p>V&eacute;rifiez aussi que l'utilisateur poss&egrave;de son propre fichier /var/mail. 
  Bien &eacute;videmment, ceci devrait &ecirc;tre le cas (comme par exemple l'utilisateur 
  joe qui poss&egrave;de /var/mail/joe) mais si &ccedil;a n'a pas &eacute;t&eacute; 
  configur&eacute; proprement, le probl&egrave;me viendrait de l&agrave; !
<p>Bien entendu, si vous donner l'acc&egrave;s &agrave; /var/mail en &eacute;criture 
  au groupe mail, vous allez probablement vous exposer &agrave; des vagues et 
  obscurs probl&egrave;mes de s&eacute;curit&eacute;. Il se pourrait que &ccedil;a 
  ne pose aucun probl&egrave;me mais on ne sait jamais (et particuli&egrave;rement 
  si vous &ecirc;tes un site de haut vol, un FAI,...) ! Essayez cucipop ou un 
  autre service POP de la collection de ports OpenBSD. Ou peut-&ecirc;tre vous 
  avez s&eacute;lectionn&eacute; les mauvaises options pour votre programme POP 
  serveur (comme le dot locking). Ou vous avez peut-&ecirc;tre simplement besoin 
  de changer le r&eacute;pertoire dans lequel les verrous sont cr&eacute;es (bien 
  que les op&eacute;rations de verrouillage ne devraient &ecirc;tre b&eacute;n&eacute;fiques 
  qu'au service POP). 
<p><b>PS:</b> Il est &agrave; noter que OpenBSD n'a pas de groupe &quot;mail&quot;. 
  Vous devez en cr&eacute;er un dans le fichier <i>/etc/group</i>. La ligne suivante 
  devrait suffire :
<ul><pre>
mail:*:6:
</pre></ul>

<p></p>

<p>
<a name= "HTTPS"></a>
<a name="10.6"></a>
<h2>10.6 - Configurer HTTP en mode s&eacute;curis&eacute; &agrave; l'aide de SSL(8)</h2>
<p></p>
<p></p>
<p></p>

<p>OpenBSD est fourni avec des librairies RSA et un service httpd supportant SSL 
  &agrave; partir de la version 2.8. Cependant, si vous utilisez OpenBSD 2.6 ou 
  2.7 vous devez utiliser des packages SSL fournis pour avoir le support SSL. 
  Pour plus d'informations, <b>man 8 ssl</b>. </p>
<p>Pour utiliser SSL avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>, 
  vous devez d'abord cr&eacute;er un certificat. Ce certificat sera stock&eacute; 
  dans <i>/etc/ssl/private/</i>. Les &eacute;tapes d&eacute;crites ici sont en 
  partie prises de la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>. 
  Lisez la pour plus d'informations. Cette partie de la FAQ s'int&eacute;resse 
  seulement &agrave; la g&eacute;n&eacute;ration d'un certificat RSA pour les 
  serveurs Web. Elle ne d&eacute;crit pas les certificats serveur DSA. Pour plus 
  d'informations &agrave; ce sujet, lisez la page de manuel <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.</p>
<p> Pour commencer, vous aurez besoin de cr&eacute;er votre cl&eacute; serveur 
  et le certificat. Pour utiliser les fonctionnalit&eacute;s RSA, vous devez mettre 
  &agrave; jour libssl. Maintenant vous pouvez cr&eacute;er votre cl&eacute; en 
  utilisant OpenSSL :</p> 

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p> Ou si vous voulez que la cl&eacute; soit crypt&eacute;e avec un mot de passe 
  que vous devez saisir &agrave; chaque d&eacute;marrage des serveurs </p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p> La prochaine &eacute;tape consiste &agrave; g&eacute;n&eacute;rer une requ&ecirc;te 
  de signature de certificat qui est utilis&eacute;e pour permettre &agrave; une 
  autorit&eacute; de certification (CA) de signer votre certificat. Pour cela, 
  utilisez la commande suivante : </p>

<div style="margin-left: 2em">
  <pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</pre>
</div>

<p> Le fichier <i>server.csr</i> pourra alors &ecirc;tre communiqu&eacute; &agrave; 
  une autorit&eacute; de certification qui signera la cl&eacute;. Une de ces autorit&eacute;s 
  est <b>Thawte Certification</b> que vous pourrez joindre &agrave; l'adresse 
  <a href="http://www.thawte.com/">http://www.thawte.com/</a>. Thawte peut actuellement 
  signer vos cl&eacute;s RSA keys. Une proc&eacute;dure est entrain d'&ecirc;tre 
  mise en place pour permettre la signature des cl&eacute;s DSA.</p>

<p> Si vous ne pouvez pas vous permettre un tel service, ou si vous voulez auto-signer 
  le certificat, vous pouvez utiliser la commande suivante :</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</pre>
</div>

<p> Avec <i>/etc/ssl/server.crt</i> et <i>/etc/ssl/private/server.key</i>, vous 
  devez &ecirc;tre d&eacute;sormais capable de d&eacute;marrer <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a> 
  avec le drapeau <b>-DSSL</b>, activant ainsi les transactions https sur le port 
  443 de votre machine. </p> 

<p>
<a name= "vipw"></a>
<a name="10.7"></a>
<h2>10.7 - J'ai effectu&eacute; des changements dans /etc/passwd avec vi(1), mais 
  les changements ne semblent pas &ecirc;tre pris en compte. Pourquoi ?</h2>
<p></p>
<p>Si vous &eacute;ditez /etc/passwdf, vos modifications seront perdues. OpenBSD 
  g&eacute;n&egrave;re /etc/passwd dynamiquement avec <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0">pwd_mkdb(8)</a>. 
  Le fichier principal de mots de passe sous OpenBSD est /etc/master.passwd. D'apr&egrave;s 
  pwd_mkdb(8), </p>

<ul>
  <pre>
FILES
     /etc/master.passwd  fichier courant de mots de passe 
     /etc/passwd         fichier de mots de passe au format Version 7
     /etc/pwd.db         fichier non s&eacute;curis&eacute; de mots de passe au format base de donn&eacute;es
     /etc/pwd.db.tmp     fichier temporaire
     /etc/spwd.db        fichier s&eacute;curis&eacute; de mots de passe au format base de donn&eacute;es
     /etc/spwd.db.tmp    fichier temporaire</pre>
</ul>
<P>Dans un fichier de mots de passe Unix traditionnel, toutes les informations 
  y compris le mot de passe crypt&eacute; de l'utilisateur sont &agrave; la disposition 
  de n'importe quel utilisateur du syst&egrave;me (et c'est la cible principale 
  de programmes tels que Crack). 4.4BSD a introduit le fichier master.passwd qui 
  a un format &eacute;tendu (avec les options additionnelles par rapport &agrave; 
  /etc/passwd). Ce fichier n'est accessible que pour root. Pour un acc&egrave;s 
  plus rapide aux donn&eacute;es, les appels &agrave; la librairie qui utilisent 
  ce type d'informations acc&egrave;dent normalement &agrave; /etc/pwd.db et &agrave; 
  /etc/spwd.db.
<P>OpenBSD met &agrave; votre disposition un outil qui vous permet d'&eacute;diter 
  le fichier de mots de passe. Cet outil s'appelle vipw(8). vipw utilisera vi 
  (ou votre &eacute;diteur favori tel que d&eacute;fini par $EDITOR) pour &eacute;diter 
  /etc/master.passwd. Suite &agrave; vos modifications, vipw recr&eacute;era /etc/passwd, 
  /etc/pwd.db, et /etc/spwd.db qui tiendront compte de vos modifications. vipw 
  verouille aussi l'acc&egrave;s &agrave; ces fichiers de telle fa&ccedil;on &agrave; 
  en interdire l'acc&egrave;s &agrave; quiconque essaie d'en changer le contenu 
  en m&ecirc;me temps que vous.</p>
<p>
<a name= "AddDelUser"></a>
<a name="10.8"></a>
<h2>10.8 - Comment je cr&eacute;e un compte utilisateur ? Ou je supprime un compte 
  utilisateur ?</h2>
<p></p>
<p></p>

<p>Sous OpenBSD 2.6, la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a> 
  permet de cr&eacute;er des comptes utilisateurs. Dans la version 2.7, la commande 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a> 
  a &eacute;t&eacute; ajout&eacute;e pour permettre d'ajouter et de supprimer 
  des comptes utilisateurs et des groupes.
<ul>
	<li><a href="#adduser">adduser(8)</a>
	<li><a href="#user">user(8)</a>
</ul>

<a name="adduser"></a> 
<p>La meilleure mani&egrave;re de cr&eacute;er un compte utilisateur sous OpenBSD 
  est d'utiliser le script <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>. 
  Ce script est param&eacute;trable &agrave; travers le fichier <b>/etc/adduser.conf</b>. 
  Bien que c'est la m&eacute;thode recommand&eacute;e pour cr&eacute;er des comptes 
  utilisateurs, il est toujours possible de les cr&eacute;er &agrave; la main 
  en utilisant <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&sektion=8&format=html">vipw(8)</a>. 
  adduser(8) permet d'effectuer des v&eacute;rifications sur la coh&eacute;rence 
  de <b>/etc/passwd<i>, </i>/etc/group</b>, et les bases de donn&eacute;es shell. 
  adduser(8) cr&eacute;e pour vous les entr&eacute;es correspondantes et les r&eacute;pertoires 
  $HOME. Il peut aussi envoyer un message de bienvenue aux utilisateurs. Le comportement 
  de ce programme peut &ecirc;tre adapt&eacute; &agrave; vos besoins. Pour illustrer 
  notre propos, prenons comme exemple la cr&eacute;ation du compte <b>testuser</b>. 
  Le r&eacute;pertoire de cet utilisateur sera plac&eacute; sous <i>/home/testuser</i>. 
  L'utilisateur aura <b>guest </b>comme groupe et <i>/bin/ksh </i>comme shell.</p>
<ul><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>testuser</strong>
Enter full name []: <strong>Test FAQ User</strong>
Enter shell csh ksh nologin sh [ksh]: <strong>ksh</strong>
Uid [1002]: <strong>&lt;Enter&gt;</strong>
Login group testuser [testuser]: <strong>guest</strong>
Login group is ``guest''. Invite testuser into other groups: guest no
[no]: <strong>no</strong>
Enter password []: 
Enter password again []:

Name:     testuser
Password: ****
Fullname: Test FAQ User
Uid:      1002
Gid:      31 (guest)
Groups:   guest
HOME:     /home/testuser
Shell:    /bin/ksh
OK? (y/n) [y]: <strong>y</strong>
Added user ``testuser''
Copy files from /usr/share/skel to /home/testuser
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre></ul>

<p>Pour supprimer des comptes utilisateurs, utilisez la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html">rmuser(8)</a>. 
  Cette commande supprimera toute chose relative &agrave; l'utilisateur. Elle 
  supprimera son entr&eacute;e<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&sektion=1&format=html">crontab(1)</a>, 
  son r&eacute;pertoire $HOME (s'il lui appartient), et son courrier. Bien &eacute;videmment, 
  cette commande supprimera aussi les entr&eacute;es correspondantes dans <b>/etc/passwd 
  </b>et <b>/etc/group</b>. Comme exemple, nous allons utiliser cette commande 
  pour supprimer le compte utilisateur pr&eacute;c&eacute;demment cr&eacute;e. 
  Notez que la commande vous demande l'identifiant du compte et si oui ou non 
  elle doit supprimer le r&eacute;pertoire home de l'utilisateur. </p>
<ul><pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry:

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></ul>

<a name="user"></a>
<h3>10.8.2 - Cr&eacute;er des comptes utilisateurs via user(8)</h3>
<p>A partir de la version 2.7 de OpenBSD, plusieurs commandes ont &eacute;t&eacute; 
  ajout&eacute;es pour g&eacute;rer les utilisateurs et les groupes. Ces outils 
  sont moins interactifs que la commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>, 
  ce qui en facilite l'usage dans des scripts. </p>
<ul>
  Voici une liste des commandes additionnelles : 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&sektion=8&format=html">group(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&sektion=8&format=html">groupadd(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&sektion=8&format=html">groupdel(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&sektion=8&format=html">groupinfo(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&sektion=8&format=html">groupmod(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&sektion=8&format=html">useradd(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&sektion=8&format=html">userdel(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&sektion=8&format=html">userinfo(8)</a> 
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&sektion=8&format=html">usermod(8)</a> 
</ul>

<h4>10.8.2.1 - Cr&eacute;ation effective des comptes utilisateurs</h4>

<p>Etant donn&eacute; que la commande user(8) n'est pas interactive, la mani&egrave;re 
  la plus simple et la plus efficace pour cr&eacute;er des comptes utilisateurs 
  est d'utiliser la commande adduser(8). La commande <i>/usr/sbin/user</i> est 
  seulement une interface aux autres commandes <i>/usr/sbin/user*</i>. Ainsi, 
  dans l'exemple qui suit il est possible d'utiliser soit <b>user add </b>soit 
  <b>useradd</b>. Le choix est votre et ne change rien au r&eacute;sultat.</p>
<p>Dans cet exemple, nous allons cr&eacute;er un compte avec les m&ecirc;mes sp&eacute;cificit&eacute;s 
  que le compte cr&eacute;e <a href="#adduser">pr&eacute;c&eacute;demment</a>. 
  useradd(8) est bien plus facile &agrave; utiliser si vous connaissez les param&egrave;tres 
  par d&eacute;faut avant de cr&eacute;er un compte utilisateur. Ces param&egrave;tres 
  se trouvent dans le fichier <i>/etc/usermgmt.conf </i>et peuvent &ecirc;tre 
  visualis&eacute;s comme suit :</p>

<ul><pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></ul>

<p>Les param&egrave;tres ci-haut vont &ecirc;tre appliqu&eacute;s si vous ne les 
  positionnez pas &agrave; d'autres valeurs en utilisant des options lors de la 
  saisie de la ligne de commande. Par exemple, dans notre cas nous voulons que 
  l'utilisateur appartienne au groupe <b>guest </b> et non pas &agrave; <b>users</b>. 
  Il est &agrave; noter que lors de la cr&eacute;ation des comptes utilisateurs, 
  les mots de passe doivent &ecirc;tre sp&eacute;cifi&eacute;s sous leur forme 
  crypt&eacute;e en ligne de commande. Vous devez donc utiliser, au pr&eacute;alable, 
  l'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&sektion=1&format=html">encrypt(1)</a> 
  pour cr&eacute;er le mot de passe. Par exemple : Les mots de passe par d&eacute;faut 
  sous OpenBSD utilisent l'algorithme Blowfish avec 6 r&eacute;it&eacute;rations. 
  Voici un exemple d'utilisation de la commande encrypt : </p>
<ul><pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre></ul>

<p> Maintenant que nous avons le mot de passe crypt&eacute;, nous sommes pr&ecirc;ts 
  &agrave; cr&eacute;er le compte utilisateur :</p>

<ul><pre>
# <strong>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</strong>
</pre></ul>

<p><b>Remarque :</b> Assurez vous d'utiliser &quot; pour englober le mot de passe. 
  L'utilisation de &quot;&quot; ne permet pas d'emp&ecirc;cher le shell d'interpr&eacute;ter 
  le jeu de caract&egrave;res correspondant au mot de passe avant de les communiquer 
  &agrave; user(8). De m&ecirc;me, assurez vous d'utiliser l'option <b>-m </b>si 
  vous voulez cr&eacute;er le r&eacute;pertoire $HOME de l'utilisateur et copier 
  les fichiers &agrave; partir de <i>/etc/skel</i> vers $HOME.</p>
<p>Pour voir si le compte utilisateur a &eacute;t&eacute; correctement cr&eacute;e, 
  nous pouvons recourir &agrave; plusieurs utilitaires. Voici quelques commandes 
  pour v&eacute;rifier rapidement que tout s'est bien pass&eacute; : </p>
<ul><pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Test FAQ User
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></ul>

<p>En plus de ces commandes, user(8) fournit son propre utilitaire, appel&eacute; 
  userinfo(8), qui permet d'afficher les caract&eacute;ristiques d'un compte utilisateur 
  : </p>
<ul><pre>
$ <strong>userinfo testuser</strong>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre></ul>

<h4>10.8.2.2 - Suppression des comptes utilisateurs</h4>

<p>Pour supprimer des comptes utilisateurs avec la hi&eacute;rarchie de commandes 
  user(8), vous devez utiliser userdel(8). Cette commande est simple et efficace. 
  Pour supprimer le compte pr&eacute;c&eacute;demment cr&eacute;e, utilisez : 
</p>
<p> # <strong>userdel -r testuser</strong> </p>

<p>Notez bien l'option <b>-r</b> qui doit &ecirc;tre sp&eacute;cifi&eacute;e si 
  vous voulez supprimer les r&eacute;pertoires $HOME aussi. Si vous voulez juste 
  bloquer l'acc&egrave;s au compte sans supprimer des informations li&eacute;es 
  au compte, utilisez <b>-p </b> au lieu de <b> -r</b>.</p>
<p>
<a name= "FTPOnly"></a>
<a name="10.9"></a>
<h2>10.9 - Comment puis-je cr&eacute;er un compte pour ftp uniquement ?</h2>
<p></p>

<p>Il y a plusieurs m&eacute;thodes pour effectuer cette op&eacute;ration. Une 
  des mani&egrave;res les plus communes est d'ajouter <i>/usr/bin/false </i> dans 
  le fichier <b>/etc/shells</b>. Et quand vous cr&eacute;ez le compte utilisateur, 
  attribuez lui le shell /usr/bin/false. Il sera alors capable d'utiliser les 
  fonctionnalit&eacute;s ftp sans pour autant &ecirc;tre capable de se connecter 
  de mani&egrave;re interactive. Par d&eacute;faut, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a> 
  affecte &agrave; l'utilisateur le r&eacute;pertoire <i>/home/&lt;user&gt;</i>. 
  Si c'est ce que vous souhaitez, laissez-le tel quel. Cependant, vous pouvez 
  affecter &agrave; l'utilisateur le r&eacute;pertoire que vous souhaitez. De 
  m&ecirc;me, vous pouvez confiner l'utilisateur &agrave; son r&eacute;pertoire 
  $HOME en ajoutant son nom &agrave; <i>/etc/ftpchroot</i>. En utilisant l'option 
  <b>-A</b> de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a>, 
  seuls les comptes list&eacute;s dans ce fichier seront autoris&eacute;s &agrave; 
  se connecter ! </p>
<p>
<a name= "Quotas"></a>
<a name="10.10"></a>
<h2>10.10 - Setting up Quotas</h2>
<p></p>

<p>
Quotas are used to limit users space that they have available to them on
your drives. It can be very helpful in situations where you have limited resources.
Quotas can be set in two different ways. 
</p>

<p>
<ul>
<li>User Quotas</li>
<li>Group Quotas</li>
</ul>
<p></p>

<p>
The first step to setting up quotas is to make sure that <tt>option
QUOTA</tt> is in your Kernel Configuration. This option is in the
GENERIC kernel. After this you need to mark in <i>/etc/fstab</i>
the filesystems which will have quotas enabled. The keywords
<tt>userquota</tt> and <tt>groupquota</tt> should be used
to mark each fs that you will be using quotas on. By default the files
<tt>quota.user</tt> and <tt>quota.group</tt> will be
created at the root of that filesystem to hold the quota information. This
default can be overwritten by doing, userquota=/var/quotas/quota.user. Or
whatever file you want to use for holding quota information. Here is an
example /etc/fstab that has one filesystem with userquotas enabled.
</p>

<ul>
<pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre>
</ul>

<p>
Now it's time to set the user's quotas. To do so you use the utility
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html">edquota(8)</a>.
A simple use is just <strong>edquota &lt;user&gt;</strong>. edquota(8)
will use vi(1) to edit the quotas unless the environmental variable
EDITOR is set to a different editor. For example:
</p>

<ul>
<pre>
# <strong>edquota ericj</strong>
</pre>
</ul>

<p>
This will give you output similar to this:
</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>
To add limits, edit it to give results like this:
</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>
In this the softlimit is set to 1000 blocks and the hardlimit is set to
1050 blocks. A softlimit is a limit where the user is just warned when
they cross it and have until their grace period is up to get their disk
usage below their limit. Grace periods can be set by using the
<strong>-t</strong> option on edquota(8). After the grace period is over
the softlimit is handled as a hardlimit. This usually results in an
allocation failure.
</p>

<p>
Now that the quotas are set, you need to turn the quotas on. To do
this use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html">quotaon(8)</a>.
For example:
</p>

<ul>
<pre>
# <strong>quotaon -a</strong>
</pre>
</ul>

<p>
This will go through /etc/fstab to turn on the filesystems with quota
options. Now that quotas are up and running, you can view them by
the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html">quota(1)</a>.
Using a command of <strong>quota &lt;user&gt;</strong> will give that users
information. When called with no arguments the quota command will give your quota statistics. For
example:
</p>

<ul>
<pre>
# <Strong>quota ericj</strong>
</pre>
</ul>

<p>
Will result in output similar to this:
</p>

<ul>
<pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre>
</ul>

<p>
By default quotas set in /etc/fstab will be started on boot. To turn them
off use
<ul><pre># <strong>quotaoff -a</strong></pre></ul>
<p></p>

<p>
<a name= "Kerberos"></a>
<a name="10.11"></a>
<h2>10.11 - How to Setup Kerberos Clients and Servers under OpenBSD</h2>
<p></p>

<p>
As a user/administrator of OpenBSD systems, you are fortunate that
KerberosIV is an pre-installed component of the default system. Here is
a guide to setting up both the Kerberos realm server, as well as a
client.
</p>

<p>
An *EXTREMELY* important point to remember is that Kerberos clients
and servers must have their system clocks synchronized. If there is
more than a 5 minute time skew, you will receive weird errors that
do not immediately reveal themselves to be caused by time skew, such as:
</p>

<ul>
<pre>
kinit: Can't send request (send_to_kdc) 
</pre>
</ul>

Another more accurate error is:

<ul>
<pre>
kauth: Time is out of bounds (krb_rd_req) 
</pre>
</ul>

<p>
An easy way to synchronize system clocks is with ntpd, available in the ports tree at
<strong>/usr/ports/net/ntp/</strong>.
</p>

This FAQ entry assumes you have prior knowledge of the Kerberos concepts.
For a great, easy to understand, reference, see:

<ul>
<li><a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html">The FreeBSD handbook</a> </li>
<li>Use the command <strong>info kth-krb</strong></li>
<li><a href="http://web.mit.edu/kerberos/www/dialogue.html">Designing an Authentication System: a Dialogue in Four Scenes</a></li>
<li><a href="http://web.mit.edu/kerberos/www/papers.html#krb4">Papers and Documentation Describing KerberosIV</a></li>
</ul>Or the book<ul>
<li><a href="http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/">Network Security Private Communication in a Public World [Kaufman, Perlman, Speciner, 1995]</a></li> 
</ul>

<h3>How to setup the Kerberos IV REALM and SERVER</h3>

<p>
We will be setting up the CIARASYSTEMS.COM realm, with avalanche.ciarasystems.com as the main server.
</p>

<p>
To start off, we will need to edit our configuration files. These files are located at <tt>/etc/kerberosIV/</tt>.
The two files we are concerned about are <i>krb.realms</i> and <i>krb.conf</i>. Let's start off with <i>krb.conf</i>.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
</pre>
</ul>

<p>
As you can see, this tells kerberos that the domain is CIARASYSTEMS.COM (or logical realm) and that
within that domain, avalanche is the administration server. Next we will look at <i>krb.realms</i>. For more information
on this refer to <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html">krb.conf</a>.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>
krb.realms provides a translation from a hostname to the Kerberos realm name for the services provided by that host.
Each line of the translation file is in one of the following forms (domain_name should be  of  the  form  .XXX.YYY).
So in this example, avalanche is the hostname of a computer on the CIARASYSTEMS.COM realm. And
.ciarasystems.com is the domain name on the realm CIARASYSTEMS.COM. Again, for further information read
the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html">krb.realms</a>. man page.
</p>

<p>
Next we will run <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdb_init&sektion=8&format=html">kdb_init(8)</a> 
to create the initial Kerberos database.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>kdb_init</strong>
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.

Enter Kerberos master password: <strong>not shown</strong>
Verifying password -
Enter Kerberos master password:
</pre>
</ul>

<p>
Next we need to use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html">kstash(8)</a> 
which is used to save the Kerberos key distribution center (KDC) database master key in the master key cache file.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>kstash</strong>
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
</pre>
This saves the encrypted master password in /etc/kerberosIV/master_key.<p>

Next, we need two principals to be added to the database for each
system that will be secured with Kerberos. Their names are
<i>kpasswd</i> and <i>rcmd</i>. These two principals are made for
each system, with the instance being the name of the individual system. 

These daemons, <i>kpasswd</i> and <i>rcmd</i> allow other systems
to change Kerberospasswords and run commands like <i>rcp, rlogin</i> 
and <i>rsh</i>. 


<pre>
# <b>kdb_edit</b>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: <strong>passwd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:                <strong>&lt;----- Use 'RANDOM' as password</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: <strong>rcmd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:                 <strong>&lt;----- Use 'RANDOM' as password</strong>
Verifying password -
New Password:

Random password [y] ? <Strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:               <strong>&lt;----- Hit &lt;ENTER&gt; to end</strong>

</pre>
</ul>

<p>
A srvtab file is the service key file. These must be extracted from the  Kerberos key  distribution center database in
order for services to authenticate using Kerberos. For  each  hostname  specified  on
the command line, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html">ext_srvtab(8)</a>
creates the service key file hostname-new-srvtab, containing all the entries in the database with an instance field of
hostname.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <Strong>ext_srvtab avalanche</strong>

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

[root@avalanche kerberosIV] <strong>mv avalanche-new-srvtab srvtab</strong>
[root@avalanche kerberosIV] <strong>chmod 600 srvtab</strong>
</pre>
</ul>

<p>
Now we can add users to our database.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>kdb_edit</strong>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.
    
Principal name: <strong>jeremie</strong>
Instance:
    
&lt;Not found&gt;, Create [y] ? <strong>y</strong>
    
Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                &lt;---- enter a secure password here
Verifying password
    
New Password:                &lt;---- re-enter the password here
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          &lt;---- null entry here will cause an exit
			       or you can add more entries.
</pre>
</ul>

<p>
So now all the Kerberos particulars are setup. All that is left is to enable
boot-time loading of the Kerberos server and to enable Kerberized-daemons.
</p>

<p>
In /etc/rc.conf, set:
<ul>
<tt>kerberos_server=YES</tt>
</ul>

In /etc/inetd.conf, uncomment:
<UL>
<pre>
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd
</pre>
</ul>

Then, either reboot, or:
<ul>
<pre>
[root@avalanche /] <Strong>kill -HUP `cat /var/run/inetd.pid`</strong>
[root@avalanche /] <Strong>/usr/libexec/kerberos >> /var/log/kerberos.log &</strong>
[root@avalanche /] <strong>/usr/libexec/kadmind -n >> /var/log/kadmind.log &</strong>
</pre>
</ul>
<p></p>

<p>
Note: this is a rather simple server setup. Usually, redundant servers
are setup (as slave servers) so that if one server goes down, all the
services that depend on Kerberos don't go down. We can also add 'su'
privileges to a specific principal, see 
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html#AEN9189">the FreeBSD Handbook</a>.
</p>

<h3>How to kerberize your client workstation</h3>

<p>
We will be setting the workstation named <i>gatekeeper</i> to be in the
CIARASYSTEMS.COM realm, with avalanche.ciarasystems.com as the main server.
</p>

<p>
To start off, we need to setup our <i>krb.conf</i> and <i>krb.realms</i> like the above machine. This is so
<i>gatekeeper</i> will know what server is the KDC and what domain it is on. Again here are the file contents.
</p>

<ul>
<pre>
[root@gatekeeper kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

[root@gatekeeper kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>
Now that is set up, we need to initialize kerberos. To obtain a ticket you use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html">kinit(1)</a>.
</p>

<ul>
<pre>
xyz:jeremie% <Strong>kinit</strong>
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: <strong>jeremie</strong>
Password:
</pre>
</ul>

<p>
Now we have identified we can list our tickets with <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html">klist(1)</a>.
</p>

<ul>
<pre>
xyz:jeremie$ <strong>klist</strong>
Ticket file:    /tmp/tkt1000
Principal:      jeremie@CIARASYSTEMS.COM

  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@CIARASYSTEMS.COM
</pre>
</ul>

<p>
Looks like we are set now. All that's left to do is test it. Here we will test it with rlogin(1) and telnet(1).
</p>

<ul>
<pre>
xyz:jeremie% <Strong>telnet avalanche</strong>
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
</pre></ul>

and 
<ul><pre>
xyz:jeremie% <Strong>rlogin avalanche</strong>
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
</pre>
</ul>

<p>
We can tell that it is indeed using Kerberos to authenticate the rlogin
session. To get rid of any tickets issued, you would use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html">kdestroy(1)</a>.
For example:
</p>

<ul>
<pre>
xyz:jeremie% <strong>kdestroy</strong>
Tickets destroyed.
xyz:jeremie% <Strong>rlogin avalanche</strong>
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused
</pre>
</ul>

<p>
Do not worry about 'Warning: no Kerberos tickets issued.' This is because
we're only doing kerberos authentication, not ticket passing. If you want
ticket passing, use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html">OpenSSH</a> which has support.
Stock KerberosIV  doesn't have support for tgt passing, either - only the AFS kaserver's implementation of krb4,
since the regular KerberosIV kdc checks client IP address listed in the ticket.
</p>

<p>
<a name= "AnonFTP"></a>
<a name="10.12"></a>
<h2>10.12 - Setting up Anonymous FTP Services.</h2>
<p></p>

<p>
Anonymous FTP allows users without accounts to access files on your computer via the File Transfer Protocol. This
will give an overview of setting up the anonymous FTP server, and its logging, etc. 
</p>

<h3>Adding the FTP account</h3>

<p>
To start off, you need to have an account on your system of "ftp". This account shouldn't have a usable
password.  Here we will set the login directory to /home/ftp, but
you can put it wherever you want. When using anonymous ftp, the ftp daemon will
chroot itself to the home directory of the 'ftp' user. To read up more on that, read the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a> and 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&sektion=2&format=html">chroot(2)</a> man pages. Here
is an example of adding the <i>ftp</i> user. I will do this using <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>.
We also need to add /usr/bin/false to our <i>/etc/shells</i>, this is the &quot;shell&quot; that we will be giving to
the ftp user. This won't allow them to login, even though we will give them an empty password. To do this you
can simply <i>echo /usr/bin/false &gt;&gt; /etc/shells</i>. Also if you wish for that shell to show up during the adduser
questions, you need to modify <i>/etc/adduser.conf</i>.
</p>


<ul>
<pre>
oshibana# <strong>adduser</strong>
Use option ``-silent'' if you don't want see all warnings & questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>ftp</strong>
Enter full name []: <strong>anonymous ftp</strong>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <strong>false</strong>
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: <strong>no</strong>
Enter password []:
Set the password so that user cannot logon? (y/n) [n]: <strong>y</strong>

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: <strong>y</strong>
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre>
</ul>

<h3>Directory Setup</h3>

<p>
Along with the user, this created the directory <i>/home/ftp</i>. This is what we want, but there are some
changes that we will have to make to get it ready for anonymous ftp. Again these changes are explained in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a> man page.
</p>

<ul>
You <b>do not</b> need to make a /home/ftp/usr or /home/ftp/bin directory.
<BR>
<li><i>/home/ftp</i> - This is the main directory. It should be owned by root and have permissions of 555.</li>
<li><i>/home/ftp/etc</i> - This is entirely optional and not recommended, as it only serves to give out information on users which exist on your box.  If you want your anonymous ftp directory to appear to have real users attached to your files, you should copy /etc/pwd.db and /etc/group to this
directory. This directory should be mode 511, and the two files should be mode 444. These are used to give owner
names as opposed to numbers. There are no passwords stored in pwd.db, they are all in spwd.db, so don't copy that over.</li>
<li><i>/home/ftp/pub</i> - This is a standard directory to place files in which you wish to share. This directory should
also be mode 555.
</ul>

<p> 
Note that all these directories should be owned by ''root''. Here is a listing of what the directories should
look like after their creation.
</p>

<ul>
<pre>
oshibana# pwd 
/home
oshibana# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre>
</ul>

<h3>Starting up the server and logging</h3>

<p>
With ftpd you can choose to either run it from inetd or the rc scripts can kick it off. These examples will show
our daemon being started from <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">inetd.conf</a>.
First we must become familiar with some of the options to ftpd. The default line from <i>/etc/inetd.conf</i> is:
</p>

<ul><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US</strong>
</pre></ul>

<p>
Here ftpd is invoked with <i>-US</i>. This will log anonymous connections to <i>/var/log/ftpd</i> and concurrent
sessions to <i>/var/run/utmp</i>. That will allow for these sessions to be seen via who(1). For some, you might
want to run only an anonymous server, and disallow ftp for users. To do so you should invoke ftpd with the
<i>-A</i> option. Here is a line that starts ftpd up for anonymous connections only. It also uses <i>-ll</i>
which logs each connection to syslog, along with the get, retrieve, etc, ftp commands.
</p>

<ul><pre>
<strong>ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA</strong>
</pre></ul>

<p>
Note - For people using HIGH traffic ftp servers, you might want to not invoke ftpd from inetd.conf. The best
option is to comment the ftpd line from inetd.conf and start ftpd from rc.conf along with the <i>-D</i> option.
This will start ftpd as a daemon, and has much less overhead as starting it from inetd. Here is an example line
to start it from rc.conf.
</p>

<ul><pre>
ftpd_flags="-DllUSA"           # for non-inetd use: ftpd_flags="-D"
</pre></ul>

<p>
This of course only works if you have ftpd taken out of <i>/etc/inetd.conf</i>.
</p>

<h3>Other relevant files</h3>

<p>
<ul>
<li><i>/etc/ftpwelcome</i> - This holds the Welcome message for people once they have connected to your ftp server.</li>
<li><i>/etc/motd</i> - This holds the message for people once they have successfully logged into your ftp server.</li>  
<li><i>.message</i> - This file can be placed in any directory. It will be shown once a user enters that directory.</li>
</ul>


<p>
<a name= "ftpchroot"></a>
<a name="10.13"></a>
<h2>10.13 - Confining users to their home dir's in ftpd(8).</h2>
<p></p>

<p>
OpenBSD's <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a> 
is setup by default to be able to handle this very easily. This is
accomplished via the file <strong>/etc/ftpchroot</strong>. Since users
cannot always be trusted, it might be necessary to restrain them to their
home directories. This behavior is NOT on by default. Here is an example
of what the default behavior is like.
</p>

<ul><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 2.6 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
230- 
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230- 
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230- 
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> <strong>cd /</strong>
250 CWD command successful.
ftp> <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp> <strong>quit</strong>
221 Goodbye.
</pre></ul>

<p>
As you can see here, access is granted to the whole server. In a perfect
world this is ok, where all users can be trusted, but this isn't so. To
limit a user, simply add their name to the file
<strong>/etc/ftpchroot</strong>. Here is an example showing user
&quot;ericj&quot; being restricted.
</p>

<ul><pre>
$ <strong>cat /etc/ftpchroot</strong>
#       $OpenBSD: faq10.html,v 1.1 2002/05/01 08:07:51 jufi Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj
</pre></ul>

<p>
This is enough to keep the user &quot;ericj&quot; from escaping from his
own directory. As you can see in the next example. The / directory has
suddenly changed to his home dir!
</p>

<ul><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> <strong>cd /</strong>
250 CWD command successful.
ftp> <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp> <strong>quit</strong>
221 Goodbye.
</pre></ul>

<p>
<a name= "Patches"></a>
<a name="10.14"></a>
<h2>10.14 - Applying patches in OpenBSD</h2>
<p></p>

<p>
The OpenBSD source tree is constantly changing and improving, 
along with this fixes to common problems are often made and patches
released to the public. These patches appear on the errata web page
located at <a href="../errata.html">http://www.openbsd.org/errata.html</a>, 
and are separated into categories. These categories correspond to patches
that should be applied to different architectures or architecture independent
patches.
</p>

<p>
Note, however, that patches aren't made for new additions to OpenBSD, 
and are only done for important reliability fixes or security problems
that should be addressed right away, although the choice to do so is, as
always, up to the administrator.
</p>

<p>
For the examples I will be patching 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=talkd&sektion=8">talkd(8)</a> 
with a security fix from the patch obtained from 
<a href="../errata.html">errata.html</a>.
</p>

<h3>How are these patches different from what I would find in the CVS tree?</h3>

<p>
All patches posted at <a href="../errata.html">http://www.openbsd.org/errata.html</a> are patches
directly against the latest release's source tree. Patches against the
latest CVS tree might also include other changes that wouldn't be wanted
on a release system.
</p>

<h3>Getting your system ready to be patched.</h3>

<p>
Patches for the OpenBSD Operating System are distributed as diffs, which
are text files that hold differences to the original source code. They are
<b>NOT</b> distributed in binary form. This means that to patch your system
you must have the source code from the <b>RELEASE</b> version of OpenBSD
readily available. This does not mean that you must have ALL source code
to the OpenBSD operating system to patch your system, but must have all
code for the program which you are patching. For instance, if you are 
patching the kernel you must have all source for the kernel on hand.
</p>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a>
is a very handy tool that can be used to grab only the source that you need 
via any of the anonymous cvs servers located around the world. You can get a 
listing of these servers at <a href="http://www.openbsd.org/anoncvs.html">http://www.openbsd.org/anoncvs.html</a>.  
</p>

<p>
To retrieve the current release's source code using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a>, you would use
the following line: 
</p>

<div style="margin-left: 2em">
<pre>
$ <b>cvs -danoncvs@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_0_BASE src/libexec/talkd/</b>
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h
</pre>
</div>

<p>
To find the CVS path to the code that you need, you can find this in the patch on the <i>Index:</i> line.
In this case, the CVS path was <i>src/libexec/talkd/</i>. Always check out the revision of OPENBSD_version_number_BASE. Without &quot;_BASE&quot; you will be checking out the stable branch, which might contain other changes that will interfere. If you are already tracking the patch branch, the patches should already be in that source, however you should always check and make sure. You can always look at <a href="../plus.html">http://www.openbsd.org/plus.html</a> to see which patches have been applied to the patch branch. If the patches haven't been applied yet, you will need to grab the latest release source using the commands above.
</p>

<p>
Also, for those users that bought official OpenBSD CDs, you can get the source code directly off of the CD. Refer to the CD insert on how to extract the source from the CD. In which case you won't need to obtain the source via anoncvs.
</p>

<ul><pre>
Apply by doing:
        cd /usr/src
        patch -p0 < 026_talkd.patch
        cd libexec/talkd
        make obj && make depend && make && make install

Index: libexec/talkd/announce.c <b>&lt;------ Path to sources </b>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@ -160,6 +160,6 @@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre></ul>

<p>
Once you've obtained the proper sources, you can obtain the patch and place it in <i>src/</i>
</p>

<h3>Applying Patches</h3>

<p>
<div style="margin-left: 2em">
<pre>
$ <b>cd /usr/src</b>
$ <b>patch -p0&lt;/path/to/026_talkd.patch</b>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Apply by doing:
|       cd /usr/src
|       patch -p0 < 026_talkd.patch
|       cd libexec/talkd
|       make obj && make depend && make && make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <b>&lt;------------ Patch Succeeded</b>
done
$ <b>cd /usr/src/libexec/talkd/</b>
$ <b>ls</b>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <b>make obj && make depend && make</b>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/src/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 > talkd.cat8
$ <b>sudo make install</b>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -> /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>Une fois cette op&eacute;ration effectu&eacute;e, red&eacute;marrez le service.</p>
<p> <font color= "#0000e0"> <a href= "index.html">[Retour &agrave; l'Index G&eacute;n&eacute;ral]</a> 
  <a href= "faq9.html">[Vers la Section 9.0 - Migrer depuis Linux]</a> <a href= "faq11.html">[Vers 
  la Section 11.0 - Optimisation des Performances]</a> </font> </p>
<p>
<hr>
<p><a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[back]"></a> 
  <a href="mailto:www@openbsd.org">www@openbsd.org</a> <br>
  <small>Originally [OpenBSD: faq10.html,v 1.64 2002/02/05 23:24:13 nick Exp ]</small><br>
<small>$Translation: faq10.html,v 1.4 2002/04/30 22:00:53 saad Exp $</small><br>
<small>$OpenBSD: faq10.html,v 1.1 2002/05/01 08:07:51 jufi Exp $</small><br>
<p></p>
</body>
</html>
