<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>6 - Administration R&eacute;seau</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- passes validator.w3.org, please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[Index de la FAQ]</a>
<a href="faq5.html">[Section 5 - Construire le syst&egrave;me à partir des sources ]</a>
<a href="faq7.html">[Section 7 - Contr&ocirc;le du clavier et de l'affichage]</a>
</font>

<h1><font color="#e00000">6 - Administration R&eacute;seau</font></h1>
<hr>

<p>
<h3>Table des matières</h3>
<ul>
<li><a href= "#Intro" >6.0.1 - Avant d'aller plus loin</a>
<li><a href= "#Setup" >6.1 - Configuration R&eacute;seau de base</a>
<li><a href= "#PF"    >6.2 - Le filtrage de paquets (PF)</a>
<li><a href= "#DHCP"  >6.4 - Protocole de Configuration Dynamique d'H&ocirc;te</a>
<li><a href= "#PPP"   >6.5 - Le Protocole Point &agrave; Point</a>
<li><a href= "#Tuning">6.6 - Optimisation des param&egrave;tres R&eacute;seau</a>
<li><a href= "#NFS"   >6.7 - Utiliser NFS</a>
<li><a href= "#DNS"   >6.8 - Le service de nom de domaine - DNS, BIND et named</a>
<li><a href= "#PPTP"  >6.9 - Configurer une connexion PPTP sous OpenBSD</a>
<li><a href= "#Bridge">6.10 - Configurer une passerelle sous OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<a name="6.0.1"></a>
<h2>6.0.1- Avant d'aller plus loin</h2>
<p>
Pour pouvoir lire - et comprendre ! - la majeure partie de ce document, 
il est bon que vous ayiez lu et compris m&ecirc;me partiellement la 
section de cette FAQ consacr&eacute;e à la 
<a href="faq5.html">configuration et au param&egrave;trage du noyau</a> 
ainsi que les pages de manuel des commandes 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> et
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">
netstat(1)</a>.

<p>
Si vous &ecirc;tes un administrateur r&eacute;seau et que vous 
souhaitez mettre en oeuvre des protocoles de routage, si vous 
souhaitez mettre en place un routeur sous OpenBSD ou si vous 
souhaitez approfondir vos connaissances en mati&egrave;re de 
r&eacute;seaux IP, nous vous invitons &agrave; lire <a 
href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">Comprendre l'Adressage IP</a>
(Understanding IP Addressing). C'est un excellent document qui 
contient tout ce que vous devez savoir sur les r&eacute;seaux IP 
et dont la lecture vous sera d'une grande utilit&eacute; si vous 
&egrave;tes amen&eacute;(e) &agrave; administrer plusieurs r&eacute;seaux.

<p>
Si vous travaillez avec des applications telles que des serveurs 
web, FTP ou de messagerie &eacute;lectronique, vous tirerez le plus 
grand b&eacute;n&eacute;fice de la lecture des 
<a href="http://the.rfceditor.org/rfc.html">RFCs</a>.
Vous n'aurez vraisemblablement pas besoin de toutes les lire. 
Choisissez celles qui se rapportent &agrave; un sujet qui vous 
int&eacute;resse ou &agrave; votre environnement r&eacute;seau. 
Parcourez-les et familiarisez-vous avec la fa&ccedil;on dont elles sont 
construites. Les RFCs d&eacute;finissent plusieurs (milliers de) standards 
pour les protocoles utilis&eacute;s sur Internet et la mani&egrave;re 
dont ils sont cens&eacute;s fonctionner.

<p>
<a name="Setup"></a>
<a name="6.1"></a>
<h2>6.1 - Configuration R&eacute;seau de base</h2>

<p>
<a name="Setup.1"></a>
<a name="6.1.1"></a>
<h3>6.1.1 - Identifier et configurer les interfaces R&eacute;seau</h3>

<p>
Pour commencer, vous devez identifier votre interface r&eacute;seau. 
Sous OpenBSD, les interfaces sont nomm&eacute;es d'apr&egrave;s le type 
de la carte utilis&eacute;e et non d'apr&egrave;s le type de connexion. 
Pour savoir comment a &eacute;t&eacute; initialis&eacute;e votre carte 
r&eacute;seau durant la phase de d&eacute;marrage de votre syst&egrave;me, 
utilisez la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>. 
Vous pouvez &eacute;galement utiliser la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Voici par exemple un extrait de la commande dmesg pour une carte r&eacute;seau 
Intel Fast Ethernet utilisant le p&eacute;riph&eacute;rique fxp :

<blockquote><pre>
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre></blockquote>

<p>
Si vous ignorez le type de p&eacute;riph&eacute;rique utilis&eacute; 
par votre carte r&eacute;seau, reportez-vous à la <a 
href="../../plat.html">liste des mat&eacute;riels support&eacute;s</a> 
par votre plate-forme.
Vous y trouverez la liste des cartes r&eacute;seau les plus communes et 
le nom du p&eacute;riph&eacute;rique qui leur est associ&eacute; sous OpenBSD.
Le nom d'une interface r&eacute;seau est constitu&eacute; du nom de ce 
p&eacute;riph&eacute;rique (par exemple fxp) suivi d'un chiffre 
assign&eacute; par le noyau (par exemple fxp0).

<p>
La commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
vous permet de visualiser les interfaces r&eacute;seau qui ont 
&eacute;t&eacute; identifi&eacute;es.  
La commande suivante affiche toutes les interfaces d'un syst&egrave;me.
Cet exemple nous montre qu'il n'y a qu'une seule interface ethernet
physique, de type 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>. 

<blockquote><pre>
$ <strong>ifconfig -a</strong>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre></blockquote>

<p>
Comme vous le constatez, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
nous donne beaucoup plus d'informations sur les interfaces r&eacute;seau 
que n&eacute;cessaire &agrave; ce stade. Ici une interface est 
d&eacute;j&agrave; configur&eacute;e et une adresse IP (en 
l'occurence &quot;inet
10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;) lui a 
&eacute;t&eacute; assign&eacute;e. Les drapeaux <strong>UP</strong> 
et <strong>RUNNING</strong> sont &eacute;galement positionn&eacute;s.

<p>
Enfin, vous remarquerez que d'autres interfaces sont activ&eacute;es 
par d&eacute;faut. Ces interfaces virtuelles servent &agrave; 
diff&eacute;rentes fonctions 
d&eacute;crites dans les pages de manuels suivantes : 

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
 - Interface de bouclage (NdT : Loopback)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog</a>
 - Interface de journalisation utilis&eacute;e par le filtre de 
paquets Packet Filter
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
 - Interface SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
 - Protocole Point &agrave; Point
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
 - Interface de "tunnelisation"
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
 - Interface d'encapsulation
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
 - Interface de pont Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
 - Interface d'encapsulation IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
 - Interface d'encapsulation GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
 - Interface g&eacute;n&eacute;rique de tunnelisation IPv4/IPv6
</ul>

<p>
Si aucune interface r&eacute;seau n'est encore configur&eacute;e, 
la premi&egrave;re &eacute;tape consiste &agrave; cr&eacute;er un fichier 
<i>/etc/hostname.xxx</i>, o&ugrave; xxx sera remplac&eacute; par le nom 
de votre interface. Pour l'exemple ci-dessus, ce fichier s'appellerait 
<i>/etc/hostname.fxp0</i>. Le format de ce fichier est simple :<br>

<blockquote><pre>
address_family address netmask broadcast [autres options]
</pre></blockquote>

(Voir la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>
pour plus de d&eacute;tails.)

<p>
Un fichier de configuration type pour IPv4 ressemble &agrave; ceci :

<blockquote><pre>
$ <strong>cat /etc/hostname.fxp0</strong>
inet 10.0.0.38 255.255.255.0 NONE
</pre></blockquote>

<p>
Il vous est possible de sp&eacute;cifier les types de m&eacute;dia Ethernet, 
ce qui est utile si vous d&eacute;sirez par exemple forcer une carte en 
mode 100baseTX full-duplex :

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
(Bien entendu, vous ne devriez faire cela que si les deux 
extr&eacute;mit&eacute;s de la connexion fonctionnent en mode full-duplex ! 
Sauf besoin particulier, ne touchez pas aux param&egrave;tres propres 
au m&eacute;dia.)

<p>
Si vous souhaitez positionner des drapeaux sp&eacute;ciaux pour une 
interface donn&eacute;e, vous vous apercevrez que le format du fichier 
hostname n'est gu&egrave;re diff&eacute;rent :

<blockquote><pre>
$ <strong>cat /etc/hostname.vlan0</strong>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
L'&eacute;tape suivante consiste &agrave; choisir une passerelle par 
d&eacute;faut en inscrivant son adresse IP dans le fichier 
<i>/etc/mygate</i>. La passerelle sera alors param&egrave;tr&eacute;e 
automatiquement &agrave; chaque (re)d&eacute;marrage de la machine.
Il vous reste &agrave; configurer le(s) serveur(s) de nom de domaine
et votre fichier <i>/etc/hosts</i> (voir la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>). 
La configuration du service de nom se fait &agrave; l'aide du fichier 
<i>/etc/resolv.conf</i>. Consultez la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a> 
pour de plus amples informations sur son format.
Voici un exemple de fichier standard (les adresses des serveurs de noms 
utilis&eacute;s sont  125.2.3.4 et 125.2.3.5 et votre machine appartient 
au domaine &quot;example.com&quot;) :

<blockquote><pre>
$ <strong>cat /etc/resolv.conf</strong>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre></blockquote>

<p>
Vous pouvez maintenant red&eacute;marrer votre machine ou lancer 
(sous l'identit&eacute; du super-utilisateur root) le script 
<strong>/etc/netstart</strong> :

<blockquote><pre>
# <strong>sh /etc/netstart</strong>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre></blockquote>

<p>
Quelques erreurs peuvent se produire en lan&ccedil;ant ce script si vous 
reconfigurez des choses qui l'&eacute;taient d&eacute;j&agrave; comme par 
exemple des routes pr&eacute;sentes dans les tables de routage du noyau. 
Cependant, &agrave; partir de l&agrave;, votre syst&egrave;me devrait 
&ecirc;tre op&eacute;rationnel.
Une fois de plus, pour vous assurer que votre interface r&eacute;seau est 
correctement configur&eacute;e, utilisez la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Vous pouvez aussi v&eacute;rifier le routage &agrave; l'aide de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>
ou de la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Si vous rencontrez des probl&egrave;mes de routage, utilisez l'otpion -n 
avec la commande 
route(8), ce qui &eacute;vite la r&eacute;solution de noms et se contente 
d'afficher les adresses IP des machines destinataires.
Voici un exemple d'affichage des tables de routage &agrave; l'aide de ces 
deux commandes :

<blockquote><pre>
$ <strong>netstat -rn</strong>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <strong>route show</strong>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre></blockquote>

<p>
<a name="Setup.2"></a>
<a name="6.1.2"></a>
<h3>6.1.2 - Configurer votre OpenBSD en routeur</h3>

<p>
Ce paragraphe contient les informations de base qui vous seront utiles si 
vous d&eacute;sirez utiliser votre OpenBSD comme routeur. Nous vous 
sugg&eacute;rons de lire les instructions et documents relatifs &agrave; 
Packet Filter pour pouvoir bloquer tout trafic potentiellement dangereux 
ainsi que la documentation sur la translation d'adresses (ce qui peut vous 
&ecirc;tre utile &eacute;tant donn&eacute; le peu d'adresses <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a> 
encore disponibles aupr&egrave;s des fournisseurs d'acc&egrave;s et autres 
registres nationaux).

<p>
Le routage IP est support&eacute; par le noyau GENERIC. Vous devez 
cependant l'activer &agrave; l'aide de la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>. 
Pour p&eacute;renniser cette configuration, &eacute;ditez le fichier <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf</a> 
pour autoriser de fa&ccedil;on permanente le reroutage IP en y ajoutant la 
ligne suivante :

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Le prise en compte de ces nouveaux param&egrave;tres peut s'effectuer sans 
avoir &agrave; red&eacute;marrer la machine gr&agrave;ce &agrave; la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a> 
(n'oubliez pas que les changements effectu&eacute;s seront alors perdus au 
prochain red&eacute;marrage) :

<blockquote><pre>
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
net.inet.ip.forwarding: 0 -&gt; 1
</pre></blockquote>

<p>
Modifiez maintenant les routes sur chaque h&ocirc;te de chaque 
c&ocirc;t&egrave;. 
OpenBSD peut &ecirc;tre utilis&eacute; comme routeur de plusieurs fa&ccedil;ons
 &agrave; l'aide de logiciels comme <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, <a 
href="http://www.mrtd.net">mrtd</a>,
et <a href="http://www.zebra.org">zebra</a>. Zebra, gated et mrtd sont 
disponibles sous formes de ports pour OpenBSD. De plus, OpenBSD supporte de 
nombreux types d'interfaces : T1, HSSI, ATM, FDDI, Ethernet, s&eacute;rie 
(PPP/SLIP).

<p>
<a name="Setup.3"></a>
<a name="6.1.3"></a>
<h3>6.1.3 - Cr&eacute;er un alias d'interface</h3>

<p>
La cr&eacute;ation d'alias pour une interface sous OpenBSD est simple : il 
vous suffit d'&eacute;diter le fichier <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a> 
qui est lu durant la phase de d&eacute;marrage par le script <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a> 
qui fait partie de la hi&eacute;rarchie de scripts <a 
href="faq10.html#rc">rc startup</a>. 
Prenons l'exemple d'une interface <b>dc0</b> sur le r&eacute;seau 192.168.0.0. 
avec les param&egrave;tres suivants :

<ul>
<li>l'IP pour dc0 est 192.168.0.2
<li>le NETMASK est 255.255.255.0
</ul>

<p>
Remarques sur les alias.  
Vous n'utilisez sous OpenBSD que le nom d'une interface. OpenBSD - 
&agrave; la diff&eacute;rence d'autres syst&egrave;mes d'exploitation qui 
g&egrave;rent le premier alias sous la forme dc0:0, le second sous la forme 
dc0:1, etc... - ne fait aucune distinction entre les alias. Ainsi, si vous 
faites r&eacute;f&eacute;rence &agrave; l'alias d'une adresse IP ou si vous 
souhaitez en cr&eacute;er un, veillez bien &agrave; utiliser la syntaxe 
"<tt>ifconfig
int alias</tt>" plut&ocirc;t que "<tt>ifconfig int</tt>". Les alias peuvent 
&ecirc;tre effac&eacute;s de cette fa&ccedil;on : 
"<tt>ifconfig int delete</tt>".

<p>
En supposant que vous ayiez plusieurs adresses IP sur un m&ecirc;me 
sous-r&eacute;seau, le masque de sous-r&eacute;seau pour chaque alias sera 
255.255.255.255. Ces masques ne doivent pas n&eacute;cessairement &ecirc;tre 
identiques &agrave; celui de la premi&egrave;re adresse IP affect&eacute;e 
&agrave; l'interface. Dans l'exemple suivant (<i>/etc/hostname.dc0</i>) deux 
alias sont ajout&eacute;s &agrave; l'interface dc0 d&eacute;j&agrave; 
configur&eacute;e avec l'adresse IP 192.168.0.2 et le masque de 
sous-r&eacute;seau 255.255.255.0 :

<blockquote><pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre></blockquote>

<p>
Il vous suffit de red&eacute;marrer la machine pour que ces 
modifications soient prises en compte.
Vous pouvez aussi utiliser la commande <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
de la mani&egrave;re suivante :

<blockquote><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></blockquote>

<p>
Pour visualiser les alias :

<blockquote><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></blockquote>


<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.2 - Packet Filter (PF)</h2>
Packet Filter (que nous nommerons ci-apr&egrave;s PF) est le syst&egrave;me 
de filtrage TCP/IP et de translation d'adresses (NdT : NAT) 
int&eacute;gr&eacute; au noyau GENERIC d'OpenBSD depuis la version 3.0. PF 
permet &eacute;galement de normaliser le traffic TCP/IP, d'impl&eacute;menter 
le contr&ocirc;le de bande passante ainsi que la prioritisation de paquets. 
Tout cela est d&eacute;crit en long en large et en travers dans le tout nouveau
 <a href="../pf/index.html"><b>Guide d'Utilisation PF</b></a>.

<p>
L'ancienne FAQ PF est encore accessible <a href="../faq6pf.html">ici</a>.

<p> 
<a name= "DHCP"></a>
<a name= "6.4"></a> 
<h2>6.4 - Le protocole DHCP</h2> 

<p>
<h3>6.4.1 Configurer un client DHCP</h3>

<p>
Pour configurer OpenBSD en tant que client DHCP, utilisez le programme  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>
inclus dans OpenBSD. Editez le fichier /etc/hostname.xl0 (en supposant que 
votre interface r&eacute;seau principale est xl0. La v&ocirc;tre peut tout 
aussi bien s'appeler ep0 ou fxp0 ou autrement !) et ajoutez-y le mot-clef 
'dhcp' :

<pre>
# <strong>echo dhcp &gt;/etc/hostname.xl0</strong>
</pre>

<p>
Le client DHCP sera lanc&eacute; automatiquement au d&eacute;marrage de la 
machine qui obtiendra ainsi son adresse IP, celles de la passerelle par 
d&eacute;faut et des serveurs DNS du serveur DHCP.

<p>
Si vous devez lancer le client DHCP depuis la ligne de commande, 
assurez-vous que le fichier 
/etc/dhclient.conf existe puis essayez :

<pre>
# <strong>dhclient fxp0</strong>
</pre>

<p>
(o&ugrave; fxp0 est l'interface que vous souhaitez configurer en DHCP).

<p>
Quelque soit la fa&ccedil;on dont vous d&eacute;marrez le client DHCP 
(dhclient), vous pouvez &eacute;diter le fichier /etc/dhclient.conf 
pour en accorder le contenu &agrave; vos besoins plut&ocirc;t que d'en 
utiliser les param&egrave;tres par d&eacute;faut. Vous pouvez par exemple 
ne <b>pas</b> mettre &agrave; jour les informations DNS par DHCP en 
d&eacute;commentant les lignes 'request' :

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
puis <b>supprimer</b> la variable domain-name-servers. Vous pouvez bien 
s&ucirc;r supprimer &eacute;galement la variable hostname entre autres.

<p>
<h3>6.4.2 Configurer un serveur DHCP</h3>

<p>
Vous pouvez utiliser OpenBSD en tant que serveur DHCP (<a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>).
Pour cela, &eacute;ditez le fichier /etc/rc.conf et positionnez 
la valeur de la variable dhcpd_flags &agrave; "-q" (dhcpd_flags="-q") 
au lieu de NO (dhcpd_flags=NO).
Listez ensuite dans le fichier /etc/dhcpd.interfaces le nom des interfaces 
sur lesquelles le serveur DHCP dhcpd <b>doit &eacute;couter</b> :

<pre>
     # <b>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
Enfin, &eacute;ditez le fichier /etc/dhcpd.conf dont les options sont 
assez explicites :

<pre>
        option  domain-name "example.com";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Cela indiquera &agrave; vos clients DHCP que le domaine auquel ils 
sont rattach&eacute;s est example.com (de mani&egrave;re &agrave; ce 
que l'utilisateur qui entrera la commande 'telnet joe' sera dirig&eacute; 
vers le serveur joe.example.com). De la m&ecirc;me mani&egrave;re, vos clients 
utiliseront les serveurs DNS 192.168.1.3 et 192.168.1.5. Les machines 
clientes situ&eacute;es sur le m&ecirc;me r&eacute;seau que celui d'une 
interface Ethernet du serveur DHCP OpenBSD  (&agrave; savoir la plage 192.168.1.0/24) 
se verront affecter une adresse IP comprise entre 192.168.1.32 et 192.168.1.127. 
Leur passerelle par d&eacute;faut sera la machine avec l'adresse 192.168.1.1.

<p>
Pour lancer le serveur dhcpd(8) depuis la ligne de commande apr&egrave;s 
modification du fichier /etc/dhcpd.conf :

<pre>
     # <b>dhcpd -q fxp0</b>
</pre>

<p>
o&ugrave; <tt>fxp0</tt> est l'interface sur laquelle vous souhaitez mettre 
&agrave; disposition le service DHCP.
L'option <tt>-q</tt> lance dhcpd(8) en mode discret. Il est sinon assez verbeux.

<p>
Si votre serveur DHCP OpenBSD doit &ecirc;tre utilis&eacute; par des clients 
Windows, vous pouvez leur renvoyer l'adresse d'un serveur WINS en ajoutant 
la ligne suivante au fichier /etc/dhcpd.conf :

<pre>
     option    netbios-name-servers    192.168.92.55;
</pre>

<p>
(o&ugrave; <tt>192.168.92.55</tt> est l'adresse IP de votre serveur 
Windows ou Samba.)
Voir la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a> 
pour plus de d&eacute;tails sur les options DHCP.


<p>
<a name="PPP"></a>
<a name="6.5"></a>
<h2>6.5 - PPP </h2>

<p>
PPP (Point-to-Protocol) est g&eacute;n&eacute;ralement utilis&eacute; pour 
cr&eacute;er un connexion par modem entre vous et un FAI. Cela peut 
&ecirc;tre fait de deux mani&egrave;res sous OpenBSD.

<ul>
<li>Gr&agrave;ce &agrave; <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a>
 (d&eacute;mon PPP int&eacute;gr&eacute; au noyau).
<li>Gr&agrave;ce &agrave; <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
 (d&eacute;mon PPP en mode Utilisateur). 
</ul>

<p>
Nous commencerons par voir l'utilisation du d&eacute;mon en mode 
Utilisateur. Avant d'aller plus loin, il faut les informations suivantes :

<ul>
<li>Le num&eacute;ro d'appel de votre FAI ;
<li>Le nom de votre serveur DNS ;
<li>Votre nom d'utilisateur et votre mot de passe ;
<li>L'adresse de votre passerelle.
</ul>

<p>
Si certaines de ces informations sont optionnelles, elles n'en sont 
pas moins utiles pour bien configurer votre connexion PPP. La 
configuration du démon PPP en mode Utilisateur se fait &agrave; 
l'aide du fichier <a 
href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>. 
Vous trouverez d'ailleurs dans le r&eacute;pertoire <i>/etc/ppp</i> des 
exemples de fichiers correspondant &agrave; diff&eacute;rentes situations 
dont vous pourrez vous inspirer.

<p>
Si vous n'utilisez pas un noyau GENERIC, assurez-vous que la ligne suivante 
est pr&eacute;sente dans votre fichier de configuration :

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Configuration initiale - pour PPP(8)</h3>

<p>
La configuration initiale du démon PPP (Utilisateur) se fait dans le fichier 
<i>/etc/ppp/ppp.conf</i>. Ce fichier n'existe pas par d&eacute;faut : vous 
pouvez vous inspirer du fichier <i>/etc/ppp/ppp.conf.sample</i> pour le 
cr&eacute;er. Nous allons &eacute;tudier une configuration tr&egrave;s 
simple qui devrait convenir &agrave; la plupart des besoins. Le fichier 
<i>ppp.conf</i> suivant assurera la connexion &agrave; votre FAI et le 
param&egrave;trage des routes par d&eacute;faut ainsi que des serveurs 
de nom. Les seules informations dont vous aurez besoin sont le num&eacute;ro 
d'appel de votre FAI et vos nom d'utilisateur et mot de passe : 

<blockquote>
<pre>
default:
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</blockquote>

<p>
Les commandes de la section qui suit le mot-clef <tt>default:</tt> 
seront ex&eacute;cut&eacute;es &agrave; chaque connexion. Nous y 
avons donc mis toutes les informations importantes. Le degr&eacute; 
de journalisation est param&egrave;tr&eacute; gr&agrave;ce au mot-clef &quot;set
log&quot; (cela peut &ecirc;tre chang&eacute;. Consultez la page de manuel <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
pour plus d'informations sur les diff&eacute;rents degr&eacute;s de journalisation). 
Le p&eacute;riph&eacute;rique (auquel est rattach&eacute; le modem) est configur&eacute; 
par &quot;set device&quot;. Dans notre exemple, le modem est rattach&eacute; au 
port s&eacute;rie 2 (<i>/dev/cua01</i>. Le port s&eacute;rie 1 sera donc 
<i>/dev/cua00</i>.) La vitesse de connexion du modem est param&egrave;tr&eacute;e 
&agrave; l'aide de l'option &quot;set speed&quot; et les param&egrave;tres d'appel 
&agrave; l'aide des options &quot;set dial&quot;. Il est aussi possible de modifier 
la dur&eacute;e d'inactivit&eacute; (NdT : timeout) &agrave; l'issue de laquelle la 
connexion sera coup&eacute;e, etc... Cependant, rien ne devrait &ecirc;tre 
modifi&eacute; dans cette ligne.

<p>
Voyons maintenant comment prendre en compte les informations sp&eacute;cifiques 
&agrave; votre FAI. 
Sous la section <b>default:</b>, ajoutez une nouvelle balise que vous appellerez 
comme bon vous semble, le plus simple &eacute;tant de lui donner le nom de 
votre FAI (dans notre exemple <n>myisp:</b>). Nous mettrons dans cette section 
toutes les informations n&eacute;cessaires &agrave; l'&eacute;tablissement 
d'une connexion chez le FAI :

<blockquote>
<pre>
myisp:
set phone 0123456789   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
</pre>
</blockquote>

<p>
L'option &quot;set phone&quot; correspond au num&eacute;ro d'appel de votre 
FAI et l'option &quot;set login&quot; aux options de connexion. La dur&eacute;e 
maximale d'inactivit&eacute; avant d&eacute;connexion automatique (NdT : timeout) 
en cas d'absence de porteuse est fix&eacute;e &agrave; 5 secondes. Dans le cas 
inverse (la porteuse est d&eacute;tect&eacute;e) votre nom d'utilisateur et votre 
mot de passe seront renvoy&eacute;s &agrave; l'invite &quot;login:&quot;.
Dans notre exemple, le nom d'utilisateur est ppp et le mot de passe ppp.
La directive &quot;set timeout&quot; fixe &agrave; 120 secondes la p&eacute;riode 
d'inactivit&eacute; pour la connexion. La directive &quot;set ifaddr&quot; est plus 
d&eacute;licate &agrave; comprendre et m&eacute;rite que l'on s'y attarde un peu : 

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
Dans la ligne ci-dessus (dont le format est 
&quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]</b>&quot;)
la premi&egrave;re adresse IP sp&eacute;cifi&eacute;e est celle que nous voulons. 
C'est aussi celle que vous devez sp&eacute;cifier si votre FAI vous a 
allou&eacute; une adresse IP fixe. Le /0 indique qu'aucun des octets de cette 
adresse ne doit correspondre &agrave; ceux de l'adresse IP choisie : par cons&eacute;quent, 
toute l'adresse IP peut &ecirc;tre remplac&eacute;e. 
La seconde adresse IP est celle que nous attendons de la part du FAI (si elle est 
connue). Comme pour la premi&egrave;re, nous ne savons pas quelle IP nous 
sera attribu&eacute;e, d'o&ugrave; le /0 qui autorise son remplacement tout ou partie. 
La troisi&egrave;me option est le masque de sous-r&eacute;seau (255.255.255.0).
Si le param&egrave;tre triggeraddr est positionn&eacute;, sa valeur est utilis&eacute;e 
en lieu et place de myaddr lors de la n&eacute;gociation IPCP initiale.
Cependant, seule une adresse IP de la m&ecirc;me plage que celle de myaddr sera 
accept&eacute;e. C'est utile lors de la n&eacute;gociation avec quelques 
impl&eacute;mentations de PPP qui n'attribuent aucune adresse IP &agrave; moins que 
l'autre partie ne demande "0.0.0.0".

<p>
L'option suivante &quot;add default HISADDR&quot; positionne la route par d&eacute;faut.
Cette option est persistante dans le sens o&ugrave; si l'adresse IP de notre FAI 
change notre route sera automatiquement mise &agrave; jour. L'option &quot;enable
dns&quot; autorise l'authentification de nos serveurs de noms aupr&egrave;s du FAI. 
<b>Ne faites pas</b> cela si vous utilisez un serveur DNS local : ppp contournera 
votre configuration en ajoutant juste quelques lignes &agrave; <i>/etc/resolv.conf</i>.

<p>
<h3>Utiliser PPP(8)</h3>

<p>
Maintenant que nous avons renseign&eacute; notre fichier <i>ppp.conf</i> nous 
pouvons tenter une connexion avec notre FAI. Nous allons voir plus en 
d&eacute;tail quelques-uns des arguments les plus commun&eacute;ment 
utilis&eacute;s avec ppp.

<ul>
<li><tt>ppp -auto myisp</tt> - Cette commande va lancer ppp, configurer 
votre interface r&eacute;seau, &eacute;tablir la connexion avec votre 
FAI puis basculera en arri&egrave;re-plan.
<li><tt>ppp -ddial myisp</tt> - Similaire &agrave; -auto mais si la 
connexion tombe, ppp tentera de la r&eacute;tablir.
</ul>

<p>
Vous pouvez utiliser <i>/usr/sbin/ppp</i> sans option en mode interactif pour 
dialoguer avec le modem, ce qui peut s'av&eacute;rer utile pour d&eacute;boguer 
un fichier <i>ppp.conf</i>.

<p>
<h3>ppp(8) extras</h3>

<p>
Si vous souhaitez ex&eacute;cuter des commande au moment de l'&eacute;tablissement ou 
de la rupture de votre connexion, vous pouvez cr&eacute;er des fichiers 
<i>/etc/ppp/ppp.linkup</i> et <i>/etc/ppp/ppp.linkdown</i> dont vous trouverez 
ici des exemples :

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Pour plus d'informations vous pouvez consulter <a 
href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">la section Utilisation de PPP</a> 
du manuel FreeBSD (en anglais).

<p>
<a name="6.6"></a>
<h2>6.6 - Optimisation des param&egrave;tres
r&eacute;seau</h2>
<!-- XXXrelease -->

<p>
<h3>Comment dois-je optimiser le noyau pour augmenter le nombre de
(re)tentatives et allonger le d&eacute;lai maximal d'inactivit&eacute;
des sessions TCP ?</h3>
<p>
Cette op&eacute;ration est particuli&egrave;rement utile pour
r&egrave;gler des probl&egrave;mes de routage. Bien entendu, les
meilleurs r&eacute;sultats sont obtenus lorsque les deux
extr&egrave;mit&eacute;s de la connexion utilisent les m&ecirc;mes
param&egrave;tres.

<p>
Utilisez la commande <tt>sysctl</tt> pour augmenter la valeur des
param&egrave;tres suivants : 

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
sysctl -a vous permet de visualiser leur valeur courante (entre autres). Pour
les modifier, utilisez <tt>sysctl -w</tt> comme ceci :
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - Comment activer la multi-diffusion (NdT : broadcast)
dirig&eacute;e ?</h3>
<p>
En temps normal vous ne devriez pas avoir &agrave; le faire : cela
permettrait &agrave; quelqu'un d'envoyer du trafic sur une ou plusieurs
adresses de multi-diffusion de votre r&eacute;seau si vous utilisez votre
machine OpenBSD comme routeur.
<P>
Cependant, dans certains cas (sur des r&eacute;seaux
ferm&eacute;s) cette fonctionnalit&eacute; peut &ecirc;tre
tr&egrave;s utile, en particulier si vous utilisez des
impl&eacute;mentations anciennes du protocole NetBIOS.
Une fois de plus, vous utiliserez la commande sysctl de la mani&egrave;re
suivante pour activer cela :
<Tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>. 
Lisez ce document <a href="http://www.netscan.org">smurf attacks</a> pour
comprendre pourquoi elle est d&eacute;sactiv&eacute;e par
d&eacute;faut...

<p>
<h3>6.6.3 - Je souhaite interdire l'attribution dynamique de certains
ports par le noyau</h3>

<p>
Toujours et encore la commande sysctl(8) dont la <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">page de manuel</a> 
nous apprend :

<pre>
[sysctl] sp&eacute;cifie la liste des ports TCP que le noyau ne devrait pas
allouer dynamiquement. Cela permet d'interdire l'acc&egrave;s par und&eacute;mon 
&agrave; un port dont un autre programme a besoin. Les &eacute;l&eacute;ments de 
la liste peuvent &ecirc;tre s&eacute;par&eacute;s par une virgule ou un espace :

 #  <strong>sysctl -w 
net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>

Il est possible d'ajouter ou d'&ocirc;ter des ports de cette liste :

 #  <strong>sysctl -w net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl -w net.inet.tcp.baddynamic=-871</strong>
</pre>

<p>
<a name="NFS"></a>
<a name="6.7"></a>
<h2>6.7 - Utilisation de NFS</h2>

<p>
NFS (Network File System : Syst&egrave;me de Fichier R&eacute;seau) est
utilis&eacute; pour partager un syst&egrave;me de fichiers &agrave;
travers un r&eacute;seau.
Avant de vous lancer dans la mise en oeuvre d'un serveur NFS, vous devriez lire les 
pages de manuel suivantes :

<ul>
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(
8)</a>
<li><a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5
)</a>
</ul>

<p>
Dans ce paragraphe, nous d&eacute;taillerons la configuration de NFS &agrave; 
travers l'exemple d'un serveur et de clients situ&eacute;s sur un m&ecirc;me 
r&eacute;seau local que nous supposerons prot&eacute;g&eacute; du monde 
ext&eacute;rieur (par filtrage de paquets).
Si vous autorisez l'acc&egrave;s depuis l'ext&eacute;rieur &agrave; un serveur NFS sur 
lequel sont stock&eacute;es des donn&eacute;es confidentielles, nous vous 
recommandons chaudement l'utilisation du protocole <a href="../faq13.html">IPsec</a> 
sous peine d'exposer votre trafic NFS &agrave; d'&eacute;ventuelles &eacute;coutes. 
Bien configur&eacute;, IPSEC vous prot&egrave;ge contre de nombreux types 
d'attaques.

<p>
Autre remarque importante sur la s&eacute;curit&eacute; : n'ajoutez pas un 
syst&egrave;me de fichiers dans <i>/etc/exports</i> sans lister les h&ocirc;tes 
autoris&eacute;s &agrave; s'y connecter, sans cela toute machine pouvant s'y connecter 
pourra acc&eacute;der aux fichiers export&eacute;s via NFS.

<p>
NFS repose sur le d&eacute;mon <a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap
(8)</a>
qui doit tourner. Portmap(8) est d&eacute;sactiv&eacute; par d&eacute;faut depuis la 
version 3.2 d'OpenBSD. Vous devrez donc l'activer dans votre fichier 
<a 
href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)
</a>
en changeant la ligne <tt>portmap</tt> :

<blockquote><pre>
portmap=YES
</pre></blockquote>
sans oublier de red&eacute;marrer votre machine pour que les modifications soient 
prises en compte.

<p>
Soit un serveur dont l'adresse IP est <b>10.0.0.1</b> qui ne sera accessible en NFS que 
par des clients situ&eacute;s sur le m&ecirc;me r&eacute;seau. La premi&egrave;re 
chose que vous aurez &agrave; faire est de configurer le fichier <i>/etc/exports</i> qui 
liste les syst&egrave;mes de fichiers accessibles via NFS et en d&eacute;finit les conditions 
d'acc&egrave;s (par qui ?...).
Pour tout connaitre des nombreuses options utilisables dans ce fichier, la meilleure source 
d'informations reste la page de manuel  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
. Pour notre exemple, notre fichier <i>/etc/exports</i> ressemble &agrave; &ccedil;a :

<blockquote><pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
Le syst&egrave;me de fichiers <tt>/work</tt> sera donc accessible via NFS.
L'option <tt>-alldirs</tt> indique que les clients pourront monter n'importe 
quel point sous la rarcine 
<tt>/work</tt>. L'option <tt>-ro</tt> sp&eacute;cifie que ce syst&egrave;me 
de fichiers ne sera accessible 
qu'en lecture seule. Les deux derniers arguments limitent l'acc&egrave;s aux 
seuls clients du r&eacute;seau 10.0.0.0.
Cette derni&egrave;re option est importante pour les serveurs accessibles 
depuis plusieurs r&eacute;seaux.

<p>
Une fois le fichier <i>/etc/exports</i> renseign&eacute; vous pouvez passer &agrave; la 
configuration du serveur NFS. Assurez-vous tout d'abord que les options NFSSERVER &amp; NFSCLIENT 
figurent dans la configuration de votre noyau (elles sont pr&eacute;sentes dans le noyau GENERIC).
Positionnez ensuite &agrave; <tt>YES</tt> l'option <tt>nfs_server</tt> (soit 
<tt>nfs_server=YES</tt>) dans <i>/etc/rc.conf</i> pour lancer au d&eacute;marrage les 
d&eacute;mons nfsd(8) et mountd(8). Vous pourrez aussi d&eacute;marrer ces d&eacute;mons 
vous-m&ecirc;mes (ces d&eacute;mons doivent &ecirc;tre lanc&eacute;s en tant que root). 
Assurez-vous que portmap(8) tourne &eacute;galement. Voici un exemple de 
d&eacute;marrage du d&eacute;mon nfsd(8) utilisant les protocoles TCP et UDP et 4 
d&eacute;mons (vous devriez lancer un nombre de d&eacute;mons adapt&eacute; au nombre 
maximum de requ&ecirc;tes 
clientes simultan&eacute;es que vous d&eacute;sirez supporter) :

<blockquote><pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre></blockquote>

<p>
Vous devrez non seulement d&eacute;marrer le serveur nfsd(8) mais aussi le d&eacute;mon 
mountd(8) qui prend en charge les requ&ecirc;tes de montage NFS. Pour lancer 
mountd(8), v&eacute;rifiez qu'il existe un fichier vide nomm&eacute; mountdtab 
puis lancez le d&eacute;mon :

<blockquote><pre>
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
</pre></blockquote>

<p>
Si vous mofidiez le fichier /etc/export pendant le serveur NFS tourne, vous 
devrez "HUPer" le d&eacute;mon mountd : 

<blockquote><pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre></blockquote>

<p>
<h3>Statistiques NFS</h3>

<p>
Pour v&eacute;rifier &agrave; tout instant que ces deux d&eacute;mons tournent 
et sont bien enregistr&eacute;s aupr&egrave;s des services RPC, utilisez 
la commande rpcinfo(8) :

<blockquote><pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
D'autres commandes sont utiles pour surveiller l'ex&eacute;cution normale de NFS : 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>
 permet de visualiser 
les points de montage utilis&eacute;s et par qui,  
nfsstat(8) donne des statistiques plus d&eacute;taill&eacute;es.
Voici un exemple d'utilisation de showmount(8) :

<blockquote><pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>Monter des syst&egrave;mes de fichiers NFS</h3>

<p>
Les syst&egrave;mes de fichiers NFS sont mont&eacute;s via la commande mount(8) et plus 
particuli&egrave;rement 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>. 
Ainsi, pour rattacher au syst&egrave;me de fichiers local <i>/mnt</i> le 
syst&egrave;me de fichiers <i>/work</i> du serveur 10.0.0.1, utilisez la 
commande suivante (il n'est pas n&eacute;cessaire d'utiliser l'adresse IP : 
mount sait r&eacute;soudre les noms de domaines) : 

<blockquote><pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre></blockquote>

<p>
Pour faire cela au d&eacute;marrage; ajouter ceci dans votre fichier 
<i>/etc/fstab</i> : 

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
Il est important d'ajouter <tt>0 0</tt> &agrave; la fin de la ligne de fa&ccedil;on &agrave; 
ce que votre machine ne lance pas la commande fsck sur le syst&egrave;me de fichiers NFS 
au d&eacute;marrage ! D'autres options standard li&eacute;es &agrave; la s&eacute;curit&eacute; 
telles que noexec, nodev et nosuid peuvent &ecirc;tre utilis&eacute;es :

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
Ainsi aucun p&eacute;riph&eacute;rique ni programme setuid sur le serveur NFS ne peuvent 
circonvenir aux mesures de s&eacute;curit&eacute; mises en place sur le client.
Si vous n'envisagez pas d'utiliser des programmes situ&eacute;s sur le serveur NFS ajoutez l'option 
noexec &agrave; cette liste.

<p>
<a name="DNS"></a>
<a name="6.8"></a>
<h2>6.8 - Le service de nom de domaines : DNS, BIND et named</h2>

<p>
<i>Avertissement : ce paragraphe a &eacute;t&eacute; &eacute;crit pour les versions 3.2 et ant&eacute;rieures  
d'OpenBSD qui incluaient BIND4.
C'est maintenant BIND9 qui est distribu&eacute; avec OpenBSD 3.3. Cette version de BIND 
est beaucoup plus document&eacute;e que ne l'&eacute;tait la pr&eacute;c&eacute;dente.</i>

<p><i>Tout comme BIND4, BIND9 s'ex&eacute;cute sous OpenBSD dans un environnement cloisonn&eacute; (NdT : chroot(2)) 
et am&eacute;liore la s&eacute;curit&eacute; de BIND gr&agrave;ce aux fonctionnalit&eacute;s suivantes : 
</i>
<ul>
<li><i>Support de la fonction arc4random() (int&eacute;gr&eacute;e dans la version 9.3.0-snapshot)</i>
<li><i>Appel &agrave; la fonction tzset avant le cloisonnement (NdT : chroot)</i>
<li><i>Ouverture du pseudo-p&eacute;riph&eacute;rique /dev/null avant le cloisonnement</i>
<li><i>Retour au g&eacute;n&eacute;rateur de nombres al&eacute;atoires par d&eacute;faut du syst&egrave;me pendant le cloisonnement</i>
<li><i>Impl&eacute;mentation de LCG (G&eacute;n&eacute;rateur Lin&eacute;aire Congru) pour la librairie libisc</i>
<li><i>Utilisation de LCG en lieu et place de LFSR pour la g&eacute;n&eacute;ration d'identifiants</i>
<li><i>Possibilit&eacute; de choisir IPv{4,6} pour les requ&ecirc;tes faites par dig(1)</i>
<li><i>Version corrig&eacute;e de sha1.c contournant le bogue d'optimisation gcc (sparc64)</i>
<li><i>Cloisonnement dans <tt>/var/named</tt> par d&eacute;faut</i>
<li><i>D&eacute;mon s'ex&eacute;cutant sous l'identit&eacute; <tt>named</tt> par d&eacute;faut</i>
<li><i>Ecriture du fichier pid avant le cloisonnement</i>
</ul>
<i>Les utilisateurs d'OpenBSD 3.3 liront : </i>
<ul>
<li><i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a></i>
<li><i><a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/usr.sbin/bind/doc/arm/Bv9ARM.html"
>BIND 9 Administrator Reference Manual</a> (Disponible dans le r&eacute;pertoire 
<tt>/usr/share/doc/html/bind/</tt>)</i>
</ul>

<h3>6.8.1 Qu'est-ce que le DNS ?</h3>
Le service de nom de domaine (Domain Name Service) permet la r&eacute;solution de domaines IP, c'est-&agrave;-dire l'association d'un nom &agrave; une adresse IP (et vice versa).
Par d&eacute;faut votre machine OpenBSD est configur&eacute;e comme client DNS et non comme serveur. Ce qui signifie qu'elle peut soumettre des requ&ecirc;tes &agrave; un serveur de nom de domaine mais ne peut y r&eacute;pondre &agrave; moins d'$ecirc;tre configur&eacute;e pour le faire. 

<p>
Ma machine OpenBSD &eacute;tant actuellement connect&eacute;e &agrave; Internet gr&agrave;ce &agrave; mon FAI, je peux utiliser 
la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
pour ex&eacute;cuter des requ&ecirc;tes DNS : 

<blockquote><pre>
$ <strong>nslookup www.openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre></blockquote>

<p>
<b>165.87.201.244</b> est l'adresse IP du serveur DNS qui a r&eacute;pondu &agrave; ma requ&ecirc;te. Cette adresse m'a &eacute;t&eacute; fournie 
par mon FAI et figure dans mon fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>.
Cependant, la r&eacute;ponse renvoy&eacute;e par ce serveur n'&eacute;tait pas autoritaire. Si je d&eacute;sire obtenir une telle r&eacute;ponse, 
je dois tout d'abord trouver l'adresse IP du serveur ayant autorit&eacute; sur le domaine <i>openbsd.org</i> puis l'interroger :

<blockquote><pre>
# Gr&agrave;ce au serveur de mon FAI, 
# on identifie le serveur d'autorit&eacute; pour openbsd.org
$ <strong>nslookup -type=NS openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# On utilise les informations renvoy&eacute;es par la pr&eacute;c&eacute;dente 
# requ&ecirc;te et on interroge le serveur zeus.theos.com
$ <strong>nslookup www.openbsd.org zeus.theos.com</strong>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre></blockquote>

<p>
<i>zeus.theos.com</i> tourne - je le suppose - sous OpenBSD et est - bien - configur&eacute; 
en tant que serveur DNS pour le domaine <i>openbsd.org</i>.

<p>
<a name="DNS.1.1"></a>
<a name="6.8.1.1"></a>
<h3>6.8.1.1 O&ugrave; puis-je tout savoir sur DNS sous OpenBSD ?</h3>
<ul>
<li>Jetez un oeil &agrave; aux RFCs <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, 
<a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a> et  
<a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> pour en savoir plus sur le syst&egrave;me 
de nom de domaines sur Internet.
<li>Vous pouvez aussi lire cet ouvrage &eacute;dit&eacute; par O'Reilly Associates 
<i><a href="../../books.html#6">DNS
and BIND</a></i>.
<li>Le <a href="http://www.openbsd.org/cgi-bin/man.cgi">manuel OpenBSD</a> et plus particuli&egrave;rement les pages suivantes : 
  <ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3">gethostbyname(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=3">resolver(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=5">resolver(5)</a>
  </ul>
</ul>

<p>
La commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
est tr&egrave;s utile car elle permet d'interroger un serveur et de pr&eacute;senter ses 
r&eacute;ponses dans un format similaire &agrave; celui des fichiers de configuration de BIND. 
Vous pouvez aussi - toujours gr&agrave;ce &agrave; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a> - 
comparer la configuration de serveurs bien configur&eacute;s et op&eacute;rationnels &agrave; la v&ocirc;tre.

<p>
<h3>6.8.2 Ma machine doit-elle &ecirc;tre serveur DNS ?</h3>

<p>
Si vous n'&ecirc;tes pas s&ucirc;r d'avoir besoin de faire de votre machine un serveur DNS, 
ne la configurez pas comme tel. Par d&eacute;faut, apr&egrave;s installation, OpenBSD n'active pas 
le serveur de nom de domaine, m&ecirc;me si tous les fichiers n&eacute;cessaires 
sont pr&eacute;sents.
Pour la plupart des stations de travail, le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">/etc/hosts</a>
contenant les noms et adresses IP des machines du r&eacute;seau local et le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>
indiquant quels sont les serveurs DNS responsables de la r&eacute;solution de noms et d'adresses sur l'intranet ou Internet suffisent.

<p>
Autrement, vous pouvez avoir besoin de configurer votre machine en tant que serveur DNS dans les cas suivants :
<ul>
<li>
Vous ne voulez pas dupliquer les fichiers "hosts" sur chaque machine d'un m&ecirc;me LAN. Votre serveur OpenBSD jouera le r&ocirc;le de serveur DNS et r&eacute;pondra aux requ&ecirc;tes des autres machines du LAN.
  <ul>
  <li><b>Remarque : </b> il n'y a aucune restriction pratique du nombre de serveurs DNS 
  sur un m&ecirc;me LAN. Une ou plusieurs machines peuvent offrir ce service si elles sont 
  configur&eacute;es pour le faire. Le fait qu'un de ces serveurs fasse autorit&eacute; ou soit connu en dehors de votre LAN est un aspect de sa configuration contr&ocirc;l&eacute; au niveau imm&eacute;diatement sup&eacute;rieur dans la hi&eacute;rarchie du domaine. 
  </ul>
<li>
Si il y a sur votre LAN des machines devant &ecirc;tre connues au sens DNS du terme sur d'autres r&eacute;seaux locaux ou distants.
<li>
Si vous rencontrez des difficult&eacute;s pour r&eacute;soudre les noms et adresses IP locales malgr&eacute; la bonne configuration de vos fichiers 
<i>/etc/hosts</i> et <i>/etc/resolv.conf</i> 
(Netscape sous OpenBSD en particulier a ce genre de comportement parce qu'il utilise son propre 
m&eacute;canisme de r&eacute;solution plut&ocirc;t que <i>gethostbyname(3)</i>.)
</ul>

<p>
Un autre crit&egrave;re de d&eacute;cision est la rapidit&eacute; d'ex&eacute;cution. La r&eacute;solution est un processus it&eacute;ratif au cours duquel un serveur de nom lance des requ&ecirc;tes successives vers d'autres serveurs de noms pour les domaines qu'il ne g&egrave;re pas. Cela peut prendre plus de temps, si vous avez une connexion &agrave; Internet par modem,  d'utiliser votre propre serveur DNS pour la r&eacute;solution d'adresses externes que d'interroger celui de votre FAI (qui dispose s&ucirc;rement d'une connexion plus rapide que la v&ocirc;tre aux autres serveurs DNS).

<p>
<h3>6.8.3 De quels logiciels est compos&eacute; un serveur DNS ?</h3>
<ul>
<li>du d&eacute;mon named 
<li>des fichiers de configuration dans le r&eacute;pertoire et les sous-r&eacute;pertoires <i>/var/named/</i>
</ul>

<p>
<h4>6.8.3.1 Quelle est la version de BIND support&eacute;e ?</h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

<p>
BIND est le nom d'une sp&eacute;cification pour un serveur de nom de domaine impl&eacute;ment&eacute;e par plusieurs composants.

<p>
Il y a trois sp&eacute;cifications diff&eacute;rentes :

<ol>
<li>BIND 4
<li>BIND 8
<li>BIND 9
</ol>

<p>
Dans son installation par d&eacute;faut, le d&eacute;mon <b>named</b> d'OpenBSD appartient &agrave; la branche 4.x de BIND.

<p>
<h4>6.8.3.2 Quelles sont les alternatives &agrave; la version par d&eacute;faut BIND 4.x ?</h4>
<!-- XXXexpires - goes away when 3.2 becomes unsupported -->

<ul>
<li>BIND 9.x, qui se trouve dans le r&eacute;pertoire <i>/usr/ports/net/bind9</i>.(Voir 
la section de cette FAQ consacr&eacute;e aux <a href="../../ports.html">ports</a>)
</ul>

<p>
<h5>6.8.3.2.1 Note sur la <u>s&eacute;curit&eacute;</u></h5>

<p>
Si vous d&eacute;cidez d'utiliser une version alternative pour votre DNS, sachez que vous appuierez un service r&eacute;seau critique sur un logiciel qui peut ne pas avoir &eacute;t&eacute; soumis au m&ecirc;me 
<a href="http://www.openbsd.org/security.html">audit de s&eacute;curit&eacute;</a>
que le d&eacute;mon <b>named</b> de l'installation par d&eacute;faut. 
Ceci est &agrave; prendre avec consid&eacute;ration dans la mesure o&ugrave; si votre serveur DNS est compromis, c'est toute la r&eacute;solution de nom et d'adresses qui peut &ecirc;tre gravement compromise, les applications utilisant votre serveur pouvant se trouver rediriger vers des sites pirates.

<p>
<h3>6.8.4 Que dois-je installer ?</h3>

<p>
Si la configuration par d&eacute;faut du r&eacute;seau a &eacute;t&eacute; bien faite au moment de l'installation d'OpenBSD, tout ce dont vous avez besoin est d&eacute;j&agrave; install&eacute;. Vous devez juste configurer le d&eacute;mon <tt>named</tt>.

<p>
<h3>6.8.5 Comment configurer le serveur DNS ?</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

<p>
Pour configurer votre serveur DNS OpenBSD, vous devez &eacute;diter et/ou cr&eacute;er les fichiers qui contr&ocirc;lent le d&eacute;mon <tt>named</tt>. Ces fichiers se trouvent par d&eacute;faut dans l'arborescence <i>/var/named</i>. Vous y trouverez le fichier <i>/var/named/named.boot</i> qui permet l'initialisation de <b>named</b>. Il y a aussi un peu de configuration &agrave; faire dans 
<i>/etc</i>.

<p>
Dans ce paragraphe, nous d&eacute;crirons la configuration d'un serveur DNS sur la machine 
<i>nemo.yewtopia.com</i> qui sera le serveur de nom primaire pour le (minuscule) domaine 
 <i>yewtopia.com</i>. L'adresse de ce serveur est <i>192.168.1.9</i>. Il y a sur le m&ecirc;me sous-r&eacute;seau deux autres machines : <i>crater.yewtopia.com </i> &agrave; l'adresse 192.168.1.1 et <i>earhart.yewtopia.com</i> &agrave; l'adresse 192.168.1.2.

<p>
<h4>6.8.5.1 Configuration des fichiers dans <i>/var/named</i></h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

<p>
<h5>6.8.5.1.1 <i>/var/named/named.boot</i></h5>

<blockquote><pre>
; tell what subdir has the lookup database files
directory       /namedb

; type    domain   source host/file backup file
cache     .	   root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; example primary server config:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
</pre></blockquote>

<p>
Ces lignes indiquent l'emplacement et le nom des fichiers de configuration pour le domaine <i>yewtopia.com</i> qui seront lus lors de l'initialisation de named.

<p>
<h5>6.8.5.1.2 <i>/var/named/namedb/localhost.rev</i></h5>

<blockquote><pre>
; Reverse lookup for localhost interface
@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
</pre></blockquote>

<p>
<h5>6.8.5.1.3 <i>/var/named/namedb/yewtopia</i></h5>

<blockquote><pre>
; yewtopia.com domain database
@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Addresses
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre></blockquote>

<p>
<h5>6.8.5.1.4 <i>/var/named/namedb/yewtopia.rev</i></h5>

<blockquote><pre>
; yewtopia domain reverse lookup database
@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Addresses
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre></blockquote>

<p>
<h4>6.8.5.2 Configuration dans <i>/etc</i></h4>

<p>
<h5>6.8.5.2.1 <i>/etc/resolv.conf</i></h5>

<p>
Assurez-vous que le fichier <i>/etc/resolv.conf</i> pointe sur le domaine local (plut&ocirc;t que sur le serveur DNS de votre FAI) de fa&ccedil;on &agrave; ce que la r&eacute;solution soit faite par <u>votre</u> d&eacute;mon <b>named</b> :

<blockquote><pre>
domain yewtopia.com
lookup file bind
</pre></blockquote>

<p>
<h4>6.8.5.2.2 <i>/etc/hosts</i></h4>

<p>
Si vous aviez ajout&eacute; des adresses de machines &agrave; votre fichier 
<i>/etc/hosts</i> vous devriez remettre ce dernier dans sa configuration initiale :

<blockquote><pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre></blockquote>

<p>
Vous &eacute;viterez ainsi les interf&eacute;rences entre des adresses contenues dans un fichier - obsol&egrave;te - <i>/etc/hosts</i> et celles g&eacute;r&eacute;es par <b>named</b>.
<u>Assurez-vous qu'il existe toutefois dans ce fichier une entr&eacute;e par d&eacute;faut pour l'h&ocirc;te local (NdT : localhost)</u> faute de quoi le r&eacute;seau ne sera pas proprement configur&eacute; au d&eacute;marrage ! Notez que <i>nemo</i> doit &ecirc;tre enregistr&eacute; dans son propre fichier hosts si vous ne voulez pas voir de message d'erreur (cependant inoffensif) &agrave; l'ex&eacute;cution par le script de d&eacute;marrage <i>/etc/netstart</i> de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a> pour <i>nemo</i> (dont le nom appara&icirc;t dans le fichier <i>/etc/myname</i>).

<p>
<h4>6.8.5.3 Utiliser  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>.</h4>

<blockquote><pre>
$ <strong>dig @nemo.yewtopia.com yewtopia.com any any</strong>

; &lt;&lt;&gt;&gt; DiG 2.2 &lt;&lt;&gt;&gt; @nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia.com, type = ANY, class = ANY

;; ANSWERS:
yewtopia.com.   3600    SOA    nemo.yewtopia.com.  your_id.nemo.yewtopia.com. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.com.   3600    NS      nemo.yewtopia.com.

;; ADDITIONAL RECORDS:
nemo.yewtopia.com.  3600    A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.com  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre></blockquote>

<p>
<h3>6.8.6 Comment et quand d&eacute;marre et s'arr&egrave;te le serveur DNS ?</h3>

<p>
<h4>6.8.6.1 D&eacute;marrage du serveur DNS</h4>

<p>
Le d&eacute;mon <b>named</b> est lanc&eacute; durant la phase de d&eacute;marrage du syst&egrave;me &agrave; l'aide du script 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc</a>
si la ligne suivante dans 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a> :

<blockquote><pre>
named_flags=NO          # for normal use: ""
</pre></blockquote>

<p>
est remplac&eacute;e par celle-ci :

<blockquote><pre>
named_flags=""          # for normal use: ""
</pre></blockquote>

<p>
Dans ce m&ecirc;me fichier, v&eacute;rifiez la pr&eacute;sence des lignes suivantes :

<blockquote><pre>
named_user=named                # Named should not run as root unless necessary
named_chroot=/var/named         # Where to chroot named if not empty
</pre></blockquote>

<p>
Ces param&egrave;tres par d&eacute;faut conviennent à une grande majorit&eacute; de configurations.

<p>
Pour lancer <b>named</b> manuellement, utilisez la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>. 
Par exemple :

<blockquote><pre>
# <strong>ndc start</strong>
          or
# <strong>ndc restart</strong>
</pre></blockquote>

<p>
<h4>6.8.6.2 Arr&ecirc;t du serveur DNS</h4>

<p>
La meilleure fa&ccedil;on d'arr&ecirc;ter le d&eacute;mon named est d'utiliser la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a> comme dans l'exemple suivant : 

<blockquote><pre>
# <strong>ndc stop</strong>
</pre></blockquote>

<p>
Si cela &eacute;choue, utilisez la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a> en lui passant en param&egrave;tre le PID du processus named. Ce PID est stock&eacute; durant l'ex&eacute;cution de <b>named</b> &agrave; la premi&egrave;re ligne du fichier 
<i>/var/named/named.pid</i> :

<blockquote><pre>
# <strong>cat /var/named/named.pid</strong>
4608
named -t /var/named -u named
# <strong>kill -KILL 4608</strong>
</pre></blockquote>

<p>
<h4>6.8.6.3 Relancer le serveur DNS apr&egrave;s en avoir modifi&eacute; la configuration</h4>

<p>
La relance du d&eacute;mon named permet la relecture de ses fichiers de configuration, ce qui s'av&egrave;re particuli&egrave;rement utile si vous les avez modifi&eacute;s. Cette op&eacute;ration se fait &agrave; l'aide du signal "hangup" :

<blockquote><pre>
# <strong>kill -HUP 4608</strong> 
</pre></blockquote>

<p>
ou bien en utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a> 
comme ceci :

<blockquote><pre>
# <strong>ndc reload</strong>
</pre></blockquote>

<p>
<h3>6.8.7 Comment bloquer les requ&egrave;tes AXFR ? </h3>

<p>
Soit l'exemple suivant :

<blockquote><pre>
garden:/home/jeremy$<strong>  host -l openssh.com</strong>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre></blockquote>

<p>
Ces informations, utiles pour déboguer la configuration de votre serveur DNS, n'ont pas forc&egrave;ment besoin d'&ecirc;tre publi&eacute;es. Si vous utilisez une classe d'adresses de type "classless in-addr"(Voir RFC2317) comme reverse, la commande host -l peut dans certains cas renvoyer les informations sur tous les domaines que vous h&eacute;bergez ! Il est facile de rem&eacute;dier &agrave; cela en ajoutant une clause 'allow-transfer' dans votre fichier de zone.

<br><br>
Si vous utilisez BIND8 vous devrez indiquer pr&eacute;cis&eacute;ment la liste des h&ocirc;tes pour lesquels vous autorisez les transferts dans chaque fichier de zone :

<blockquote><pre>
zone "foo.com" in {
        type master;
        file "directory/zonefile";
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre></blockquote>

<p>
Vous pouvez aussi bloquer les transferts pour tous les domaines en ajoutant dans le fichier 
/var/named.conf une clause 'allow-transfer' dans la section 'options' :

<blockquote><pre>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre></blockquote>

<p>
Cette m&eacute;thode BIND8 est utilisable avec BIND9.<br>
Si vous utilisez la version BIND 4 (celle par d&eacute;faut sous OpenBSD) vous pouvez &eacute;diter le fichier /var/named/named.boot et utiliser l'option 'xfrnets' :

<blockquote><pre>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre></blockquote>

<p>
BIND 4 autorise les transferts de classes enti&egrave;res, ce qui pr&eacute;c&egrave;de n'est donc pas exact : typiquement, les seules machines devant effectuer des transferts de zones sont vos serveurs DNS secondaires ainsi que les machines &agrave; partir desquelles vous souhaitez  d&eacute;boguer (127.0.0.1 est la machine id&eacute;ale pour laquelle on peut autoriser les transferts !).
Bloquer les requ&ecirc;tes AXFR  renforce la s&eacute;curit&eacute; de votre r&eacute;seau mais peut aussi rendre difficile le d&eacute;bogage de votre service DNS. (Merci &agrave; 
<a href="mailto:ntang@nachtwache.org">Nicholas Tang</a> pour cette remarque.)

<p>
<h3>6.8.8 Que ne m'avez-vous pas encore dit sur la configuration du DNS ?</h3>

<p>
Beaucoup de choses ! :-) 
<br>
Par exemple, comment faire en sorte que les requ&ecirc;tes pour des domaines internes (donc non visibles depuis l'ext&eacute;rieur) soient relay&eacute;es par vos serveurs DNS. Pour plus d'informations sur le service DNS, nous vous recommandons la lecture de ces 
<a href="#DNS.1.1">documents</a>.


<p>
<a name="PPTP"></a>
<a name="6.9"></a>
<h2>6.9 - Mise en place d'une connexion PPTP sous OpenBSD</h2>

<p>
<strong>NOTE:</strong> les informations contenues dans la pr&eacute;sente section ne s'appliquent pas &agrave; <strong>TOUS</strong> les FAI ADSL m&ecirc;me si l'essentiel de ce que vous devez savoir s'y trouve. La configuration cit&eacute;e en exemple a &eacute;t&eacute; valid&eacute;e pour 
<a href="http://www.inode.at">Inode</a>, FAI ADSL en Autriche.

<p>
Pour commencer vous devez isntaller pptp. Un port se trouve dans 
<i>/usr/ports/net/pptp</i>. (Re)lisez la <a href="faq8.html#Ports">section 8 de cette FAQ
</a> pour toute information sur les ports OpenBSD.

<p>
A cause d'un conflit entre le support 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a> du noyau et 
pptp, vous devrez aussi recompiler votre noyau pour en supprimer le support gre(4).

<blockquote>Correctif (NdT : patch) pour supprimer le support GRE(4).
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@ -87,7 +87,7 @@
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre></blockquote>

<p>
Pour recomplier votre noyau, v&eacute;rifiez que vous disposez des derni&egrave;res 
sources &agrave; jour via cvs (voir la page <a href="../../anoncvs.html">AnonCVS</a> 
pour plus d'information), appliquez sur ces source le correctif ci-dessus puis recompilez votre noyau suivant les instructions de la <a href="faq5.html#Building">section 5 de cette FAQ</a>.

<p>
Apr&egrave;s l'installation de <b>pptp</b> et de votre nouveau noyau, vous devez &eacute;diter quelques fichiers pour configurer votre connexion. Vous (r&eacute;)utiliserez 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a> fa&ccedil;on OpenBSD et si ppp(8) vous est d&eacute;j&agrave; familier, vous constaterez que la configuration est quasiment la m&ecirc;me. Sinon, vous pouvez (re)lire la section 
<a href="#PPP">PPP de cette FAQ</a>.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
L'ajo&ucirc;t dans votre fichier <i>/etc/ppp/options</i> des lignes suivantes sera tr&egrave;s probablement la seule chose que vous aurez &agrave; faire :

<blockquote><pre>
# <strong>cat /etc/ppp/options</strong>
name "LOGINNAME"
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
<tt>LOGINNAME</tt> doit &ecirc;tre remplac&eacute; par le nom d'utilisateur qui vous a &eacute;t&eacute; attribu&eacute; par votre FAI.

<p>
Le fichier <i>/etc/ppp/pap-secrets</i> doit contenir une ligne comme celle-ci :

<blockquote><pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
o&ugrave; LOGINNAME est le nom de votre compte et PASSWORD... votre mot de passe. 
10.0.0.138 est l'adresse IP attribu&eacute;e &agrave; votre MODEM si vous utilisez l'ADSL. 
V&eacute;rifiez que ce fichier est en lecture seule pour le seul utilisateur root (mode 600).

<p>
<h3>6.9.1 - Attribuer une adresse IP &agrave; votre interface r&eacute;seau</h3>

<p>
Dans l'exemple ci-dessus, notre modem a une adresse pr&eacute;configur&eacute;e &agrave; 
10.0.0.138. Nous souhaitons cependant attribuer une adresse &agrave; NOTRE interface. Le mieux est de choisir une adresse IP proche de celle donn&eacute;e au modem ou d'utiliser l'adresse statique qui vous est attribu&eacute;e. Consultez la <a href="#Setup">section 6 de cette FAQ</a> pour en savoir plus sur la configuration initiale du r&eacute;seau.

<p>
Une fois votre interface configur&eacute;e, vous devriez pouvoir cr&eacute;er une connexion PPTP &agrave; l'aide de la commande suivante :

<blockquote><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre></blockquote>

<p>
Deux processus sont cr&eacute;&eacute;es (cela est d&ucirc; au fait que nous utilisons le ppp(8) fourni par OpenBSD). Vous devez stopper ces deux processus pour arr&ecirc;ter pptp :

<blockquote><pre>
# <strong>kill -9 [pid of pppd]</strong>
$ <strong>kill -9 [pid of pptp]</strong>
</pre></blockquote>

<p>
Nous vous recommandons d'ouvrir le fichier <tt>/var/log/messages</tt> dans un autre terminal afin de tracer d'&eacute;ventuels probl&egrave;mes :

<blockquote>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre></blockquote>

<p>
Nous vous sugg&eacute;rons &eacute;galement d'ajouter cette commande dans votre fichier <i>/etc/rc.local</i> pour monter la connexion automatiquement au d&eacute;marrage de la machine.


<a name="Bridge"></a>
<h2>6.10 - Configurer une passerelle sous OpenBSD</h2>

<p>
Une passerelle (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>) permet de relier deux (ou plus) r&eacute;seaux. A la diff&eacute;rence d'un routeur, les paquets traversent la passerelle de mani&egrave;re transparente : les deux segments de r&eacute;seaux semblent n'en faire qu'un de chaque c&ocirc;t&egrave; de la passerelle par laquelle ne transiteront que les paquets devant passer d'un segment &agrave; l'autre. Une passerelle permet donc - entre autres choses - de r&eacute;duire le trafic sur un r&eacute;seau complexe en autorisant l'acc&egrave;s &agrave; chaque segment au cas par cas.

<p>
Remarque : du fait de sa nature "invisible", l'interface d'une passerelle peut ou non avoir une adresse IP propre. Si elle en a une, l'interface fonctionnera suivant deux modes : tout d'abord comme faisant partie de la passerelle, ensuite comme une interface normale "stand-alone". 
Si aucune interface ne poss&egrave;de d'adresse IP, la passerelle transmettra effectivement les donn&eacute;es &agrave; travers le r&eacute;seau mais ne pourra pas &ecirc;tre administr&eacute;e par le r&eacute;seau (ce qui peut &ecirc;tre un effet recherch&eacute;).

<p>
<h3>Exemple de passerelle</h3>

<p>
Une de mes baies contient des ordinateurs tournant sur de vieux syst&egrave;mes &eacute;quip&eacute;s non pas d'interfaces 10BASE-TX mais de connecteurs AUI ou AAUI et mes transmetteurs n'ont que des prises coaxiales. Une des machines de cette baie est un serveur OpenBSD connect&eacute; en permanence au r&eacute;seau haut d&eacute;bit. En lui ajoutant une seconde carte r&eacute;seau &eacute;quip&eacute;e d'une prise coaxiale, il m'a &eacute;t&eacute; possible d'en faire une passerelle entre les deux r&eacute;seaux. 

<p>
Ce serveur a donc deux interfaces r&eacute;seau, une carte 
Intel EtherExpress/100 
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
et une carte 3COM 3c590-Combo  
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
avec prise coaxiale. <tt>fxp0</tt> fait le lien entre le reste de mon r&eacute;seau et poss&egrave;de donc une adresse IP tandis que l'interface <tt>ep0</tt> ne sert que pour la passerelle et n'en a donc pas. Les machines du r&eacute;seau coaxial peuvent &agrave; pr&eacute;sent communiquer avec le reste du r&eacute;seau comme si elles y &eacute;taient.
<p>
Comment cela est-il possible ?
<p>
Le fichier <tt>hostname.fxp0</tt> contient les param&egrave;tres pour l'interface 
<tt>fxp0</tt>. Cette machine &eacute;tant cliente DHCP, ce fichier ressemble &agrave; ceci :

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre>
</blockquote>

<p>
Jusque-l&agrave; pas de surprise.

<p>
La configuration de l'interface <tt>ep0</tt> n'est pas tout &agrave; fait la m&ecirc;me, comme vous pouvez vous en douter :

<blockquote>
<pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre>
</blockquote>

<p>
Dans ce dernier cas, nous avons juste activ&eacute; l'interface &agrave; l'aide de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
et nous en avons forc&eacute; le type &agrave; 10BASE-2 (coaxiale). Aucune adresse IP ni aucune autre information similaire ne doivent &ecirc;tre sp&eacute;cifi&eacute;es pour cette interface.  
Les options utilisables pour l'interface <tt>ep</tt> sont d&eacute;taill&eacute;es dans cette 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">page de manuel</a>.

<p>
Nous allons maintenant configurer la passerelle. Il suffit pour cela de cr&eacute;er un fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5"><tt>bridgename.bridge0</tt></a>. 
Voici un exemple pour ma situation :

<blockquote>
<pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre>
</blockquote>

<p>
Cela configure et active la passerelle &agrave; partir des deux cartes fxp0 et ep0. 
L'ordre dans lequel sont list&eacute;es les cartes est-il important ? Que nenni : n'oubliez pas qu'une passerelle est sym&eacute;trique et que les paquets la traversent dans un sens comme dans l'autre.

<p>
Et c'est tout ! Red&eacute;marrer votre serveur et vous avez une passerelle op&eacute;tionnelle.

<p>
<h3>Le filtrage sur une passerelle</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

Alors que pour certains usages une simple passerelle comme celle d&eacute;crite ci-dessus suffira, 
il est plus vraisemblable que vous voudrez faire quelquechose avec les paquets transitant par la v&ocirc;tre. Comme vous vous y attendiez (peut-&ecirc;tre), <a href="#PF">Packet
Filter</a> peut &ecirc;tre utilis&eacute; pour filtrer le trafic sur la passerelle. 

<p>
Gardez &agrave; l'esprit que par nature les flux de donn&eacute;es transitent par les deux interfaces d'une passerelle et que vous n'aurez donc &agrave; appliquer du filtrage que sur une des deux cartes. Votre directive "Pass all" par d&eacute;faut devrait ressembler &agrave; &ccedil;a :

<blockquote>
<pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre>
</blockquote>

<p>
Si je souhaite filtrer le trafic en direction des "vieilles" machines et n'y autoriser que le trafic Web et le SSH, je dois laisser le trafic entrer et sortir sur l'interface ep0 mais le filtrer sur fxp0 en utilisant l'option "keep state" afin de pouvoir traiter les retours :

<blockquote>
<pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre>
</blockquote>

<p>
Voil&agrave; qui restreindra aux seules connections HTTP et SSH entrantes le trafic en direction de la passerelle et de ce qu'il y a "derri&egrave;re". On aurait p&ucirc; obtenir d'autres r&eacute;sultats en filtrant sur l'autre intereface. 

<p>
Pour administrer et surveiller la passerelle, utilisez la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a> 
qui peut aussi servir &agrave; cr&eacute;er une passerelle apr&egrave;s le d&eacute;marrage du syst&egrave;me.


<p>
<h3>Trucs et astuces sur les passerelles</h3>

<ul>
<li>
Il est fortement recommand&eacute; de n'appliquer du filtrage que sur une interface. Vous pouvez le faire sur les deux mais vous devez alors vraiment savoir et comprendre ce que vous faites.

<li>En utilisant l'option <i>blocknonip</i> de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
ou en l'ajoutant dans le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
vous pouvez interdire le passage de tout trafic non IP (tels que IPX ou NETBEUI) 
sur la passerelle (et ce m&ecirc;me si vos filtres n'ont pas pris en compte ces types de trafic). Cela peut &ecirc;tre important dans certaines situations mais vous devez &ecirc;tre conscient que les passerelles fonctionnent pour tout type de trafic et pas seulement pour le trafic IP.

<li>
Cr&eacute;er une passerelle n&eacute;cessite que les interfaces qui la composent fonctionnent en mode "Promiscuous" - elles &eacute;coutent la totalit&eacute; du trafic et non le seul trafic leur &eacute;tant destin&eacute;. Cela augmente la charge du processeur et du bus plus 
qu'on ne pourrait le croire. Quelques cartes r&eacute;seau ne fonctionnent pas bien dans ce mode : une carte &agrave; base de puce TI ThunderLAN (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>) par exemple ne pourra pas &ecirc;tre utilis&eacute;e sur une passerelle.
</ul>


<p>
<font color="#0000e0">
<a href="index.html">[Index de la FAQ]</a>
<a href="faq5.html">[Section 5 - Construire le syst&egrave;me &agrave; partir des sources]</a>
<a href="faq7.html">[Section 7 - Contr&ocirc;le du clavier et de l'affichage]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" 
border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq6.html,v 1.173 ]<br>
$Translation: faq6.html,v 1.19 2003/06/01 11:34:18 xsa Exp $<br>
$OpenBSD: faq6.html,v 1.8 2003/06/01 12:54:16 jufi Exp $
</small>

</body>
</html>
