<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Polices anti-aliasées et "TrueType" sous OpenBSD</title>
<link rev="made" href="mailto:www@OpenBSD.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,antialiasing,truetype,fonts,XFree86,XF4">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2001-2005 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="http://www.openbsd.org/"><img alt="[OpenBSD]" border="0" 
height=30 width=141 src="../../images/smalltitle.gif"></a>

<h1>Polices anti-aliasées et "TrueType" sous OpenBSD</h1>

<h3>Table des matières</h3>
<ul>
<li><a href="truetype.html#xterm">Capture d'écran de xterm </a>
<li><a href="truetype.html#konqueror">Capture d'écran de
    Konqueror</a>
<li><a href="truetype.html#how">Comment ça marche ?</a>
<li><a href="truetype.html#work">Que faut-il faire pour les obtenir
    ?</a>
<li><a href="truetype.html#applications">Quelles applications peuvent
    les utiliser ?</a>
<li><a href="truetype.html#manualfonts">Comment puis-je en ajouter
    manuellement ?</a>
</ul>
<hr>

<a name="xterm"></a>
<h2>Capture d'écran de xterm</h2>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>
avec polices aliasées et anti-aliasées comparées :
<div align="center"><img src="../images/xterm_diff.jpg"
  alt="[xterm standard and anti-aliasé]"></div>

<a name="konqueror"></a>
<h2>Capture d'écran de Konqueror</h2>
Toujours pas convaincu ?
Jetons un coup d'oeil à ceci : 

Le <a href="http://konqueror.kde.org/">Navigateur Web Konqueror</a>
avec polices aliasées et anti-aliasées comparées :
<div align="center"><img src="../images/konqueror_diff.jpg"
  alt="[Konqueror standard and anti-aliasé]"></div>

<a name="how"></a>
<h2>Comment ça marche ?</h2>
Les calculs d'anti-aliasing sont effectués par
<a href="http://www.freetype.org/">FreeType</a>, un moteur de polices
libre inclut dans X.org. De plus, X.org contient une extension
appelée
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Xft&amp;sektion=3">Xft(3)</a>,
l'extension X FreeType, qui interagit avec FreeType pour les
opérations de rendu des polices. Xft interagit aussi avec une
extension appelée <i>Xrender</i>, l'extension X Render, qui
convertit les calculs effectués par FreeType en images
numériques.

<a name= "work"></a>
<h2>Que faut-il faire pour les obtenir ?</h2>

OpenBSD inclut X.org avec l'extension X Render activée.
Pour pouvoir l'utiliser, votre serveur X (pilote de votre carte
vidéo) doit la supporter. Certains pilotes n'ont pas encore
été convertis au code 'fb' et ne peuvent donc pas utiliser
l'extension Render, qui est nécessaire. nécessaire.
<p>
Vous pourrez vérifiez votre carte vidéo comme suit :

<blockquote><pre>
$ <strong>/usr/X11R6/bin/xdpyinfo | grep RENDER</strong>
RENDER
</pre></blockquote>

Si &quot;RENDER&quot; n'est pas spécifié dans sa liste des
extensions, vous devrez attendre que quelqu'un implémente
l'extension pour cette carte.

<p>
L'étape suivante consiste à trouver et d'installer quelques
polices "TrueType".
Une collection de polices populaires a été compilée
et mise à disposition via
<a href="faq8.html#Ports">l'arborescence des ports OpenBSD</a>, sous
<tt>/usr/ports/x11/msttcorefonts</tt>. Elles peuvent être
installées comme suit :

<blockquote><pre>
# <b>cd /usr/ports/x11/msttcorefonts</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

A partir de maintenant, les instructions pour l'enregistrement de
nouvelles polices avec X figurent dans une
<a href="#manualfonts">autre section</a>.

<a name= "applications"></a>
<h2>Quelles applications peuvent les utiliser ?</h2>
N'importe quelle application qui s'interface avec la librairie Xft peut
afficher des polices anti-aliasées. Ceci inclut les applications
QT 3.x (KDE 3.x) et GTK+2 (Gnome 2.x). Les programmes X standard
possédant une telle interface sont
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xditview&amp;sektion=1">xditview(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xfd&amp;sektion=1">xfd(1)</a>,
et quelques autres.

<h3>xterm</h3>
<tt>xterm</tt> peut être invoqué avec les arguments qui
permettent d'activer le rendu Xft des polices :

<blockquote><pre>
$ <strong>xterm -fa 'Andale Mono' -fs 14</strong>
</pre></blockquote>

Ces options sont :
<blockquote><pre>
Option   Resource         Meaning
----------------------------------------
 -fa     XTerm*faceName   Font face name
 -fs     XTerm*faceSize   Font size
</pre></blockquote>

On peut aussi utiliser les ressources X. Par défaut, elles sont
situées dans <tt>$HOME/.Xdefaults</tt> et sont
contrôlées à l'aide du programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xrdb&amp;sektion=1">xrdb(1)</a>.

<p>
Certaines polices TrueType (telles que Arial, Georgia, et Verdana par
exemple) ne fonctionnent pas correctement avec <tt>xterm</tt>. En effet,
<tt>xterm</tt> utilise la largeur maximale de tous les caractères
faisant partie d'une police donnée pour afficher chaque
caractère. Avec une police de type monospace, les largeurs de
tous les caractères sont les mêmes, et tout fonctionne
correctement. Avec une police proportionnelle, telle qu'une des polices
précitées, <tt>xterm</tt> affiche chaque caractère
dans une cellule de la taille de la largeur maximale du caractère
ce qui a pour effet de créer de larges séparations
illisibles entre les caractères.

<h3>Applications QT 3.x/KDE 3.x</h3>
Les applications utilisant QT 3.x, telle que n'importe quelle
application KDE 3.x, y compris Konqueror, peuvent utiliser le rendu Xft
une fois que la valeur suivante a été positionnée
dans <tt>$HOME/.qt/qtrc</tt> sous la section <tt>[General]</tt>.

<blockquote><pre>
useXft=true
</pre></blockquote>

Le programme GUI de configuration de Qt, <tt>qtconfig</tt> (ou <tt>qtconfig-
mt</tt> si la version multi-threads de Qt est installée), peut
positionner cette valeur à partir de la sélection
<b>Enable Anti-aliased Font Support</b> figurant dans l'onglet
<b>Fonts</b>.

<h3>Applications GTK+2</h3>
Les applications GTK+2 requièrent le positionnement de la
variable d'environnement <tt>GDK_USE_XFT</tt>. GDK est le
&quot;backend&quot; utilisé par GTK pour isoler les
détails des opérations d'affichage. GDK déchargera
les opérations de rendu de polices vers Xft lorsqu'il
détecte la variable d'environnement.

<p>
La commande suivante aura pour effet de lancer le programme de
messagerie instantanée
<a href="http://gaim.sourceforge.net/">Gaim</a> à base de GTK+2
disponible sous
<b>/usr/ports/net/gaim</b>:

<blockquote><pre>
$ env GDK_USE_XFT=1 gaim
</pre></blockquote>

<a name="manualfonts"></a>
<h2>Comment puis-je ajouter des polices manuellement ?</h2>
L'ajout d'une police &quot;à X&quot; nécessite
l'enregistrement de la police au niveau du serveur X et au niveau de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fontconfig&amp;sektion=3">fontconfig(3)</a>,
étant donné qu'ils assurent un suivi des polices de
manière séparée. En fait, certains types de polices
sont uniquement reconnus par le serveur X, et d'autres uniquement par
fontconfig. Les polices TrueType sont reconnues par les deux.

<h3>Le serveur X</h3>
Les chemins des polices (i.e. des répertoires contenant les
polices) sont gérés soit directement par
<tt>/etc/X11/XF86Config</tt> soit par un programme séparé
tel que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xfs&amp;sektion=1">xfs(1)</a>.
Pour ajouter une police, ajoutez le répertoire dans lequel elle
se trouve à <tt>/etc/X11/XF86Config</tt>:

<blockquote><pre>
Section "Files"
        FontPath        "/usr/X11R6/lib/X11/fonts/TTF/"
        FontPath        "<i>/usr/local/lib/X11/fonts/myfonts/</i>"
        ...
EndSection
</pre></blockquote>

Sinon, si vous utilisez <tt>xfs</tt>, ajoutez le répertoire à
<tt>/etc/X11/fs/config</tt>:

<blockquote><pre>
catalogue = /usr/X11R6/lib/X11/fonts/TTF/,
            <i>/usr/local/lib/X11/fonts/myfonts/</i>
</pre></blockquote>

Ensuite, le serveur X doit être capable de prendre en compte la
police à travers l'index des polices dans ce répertoire,
à savoir le fichier <tt>fonts.dir</tt>. Traditionnellement,
toutes les tailles disponibles pour une police sont listées au
niveau de l'index des polices, généré par la
commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkfontdir&amp;sektion=1">mkfontdir(1)</a>.
Mais étant donné que les polices TrueType peuvent
être calibrées à n'importe quelle échelle, la
spécification de chaque taille possible n'est pas requise. Au
lieu de cela, les polices calibrables sont listées dans le
fichier <tt>fonts.scale</tt>, reconnu par <tt>mkfontdir</tt> lors de la
génération des indexes <tt>fonts.dir</tt>.

<p>
Pour créer un fichier <tt>fonts.scale</tt>, vous pouvez utiliser
le programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkfontscale&amp;sektion=1">mkfontscale(1)</a> :

<blockquote><pre>
# <b>cd <i>/usr/local/lib/X11/fonts/myfonts</i></b>
# <b>/usr/X11R6/bin/mkfontscale</b>
# <b>/usr/X11R6/bin/mkfontdir</b>
</pre></blockquote>

Enfin, pour appliquer les modifications à la session X en cours,
au lieu de redémarrer X, la commande suivante peut être
utilisée pour examiner à nouveau les chemins de polices
enregistrés au niveau de XFree86 et prendre en compte les
modifications s'il y a lieu :

<blockquote><pre>
$ <b>xset fp rehash</b>
</pre></blockquote>

Ou, si un nouveau chemin de polices a été ajouté :

<blockquote><pre>
$ <b>xset +fp <i>/usr/local/lib/X11/fonts/myfonts</i></b>
</pre></blockquote>

Si vous utilisez <tt>xfs</tt>, utilisez plutôt la commande suivante :

<blockquote><pre>
# <b>pkill -HUP xfs</b>
</pre></blockquote>

<h3>fontconfig</h3>
L'autre composant de X auprès duquel une nouvelle police doit
être enregistrée est fontconfig, utilisé par Xft
pour trouver les polices. fontconfig utilise le fichier
<tt>/etc/fonts/fonts.conf</tt> pour sa configuration globale mais
étant donné que ce fichier est remplacé lors des
mises à jour de X, <tt>/etc/fonts/local.conf</tt> doit être
utilisé pour gérer les changements globaux.

<p>
Ajoutez le répertoire contenant la police au fichier de
configuration :

<blockquote><pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &quot;/etc/fonts/fonts.dtd&quot;&gt;
&lt;fontconfig&gt;
  &lt;dir&gt;<i>/usr/local/lib/X11/fonts/myfonts</i>&lt;/dir&gt;
&lt;/fontconfig&gt;
</pre></blockquote>

Ou, si uniquement un utilisateur veut ajouter des polices à ses
sessions, les lignes ci-dessus peuvent être placées dans le
fichier <tt>$HOME/.fonts.conf</tt>.

<p>
Notez que fontconfig examinera de manière récursive tous
les sous-répertoires disponibles dans les répertoires de
polices spécifiés alors que le serveur X ne le fera pas.

<p>
Une fois le répertoire ajouté, le cache de polices pour le
répertoire doit être regénéré. La
commande suivante demande à fontconfig de regénérer
les caches de polices pour tous les répertoires
spécifiés dans sa configuration :

<blockquote><pre>
# <b>/usr/X11R6/bin/fc-cache -v</b>
</pre></blockquote>

Ces modifications prendront effet dans la session X en cours. X ne
nécessitera donc pas de redémarrage. En revanche, les
applications en cours d'exécution doivent être
redémarrées.

<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif"
  border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: truetype.html,v 1.16 ]<br>
$Translation: truetype.html,v 1.13 2005/05/20 18:12:03 saad Exp $<br>
-->
$OpenBSD: truetype.html,v 1.13 2005/05/22 17:38:07 saad Exp $
</small>

</body>
</html>
