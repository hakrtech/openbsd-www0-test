<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Polices anti-alias&eacute;es et "TrueType" sous OpenBSD</title>
<link rev="made" href="mailto:www@OpenBSD.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,antialiasing,truetype,fonts,XFree86,XF4">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2001-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="http://www.openbsd.org/"><img alt="[OpenBSD]" border="0" 
height=30 width=141 src="../../images/smalltitle.gif"></a>

<h1>Polices anti-alias&eacute;es et "TrueType" sous OpenBSD</h1>

<h3>Table des mati&egrave;res</h3>
<ul>
<li><a href="truetype.html#xterm">Capture d'&eacute;cran de xterm </a>
<li><a href="truetype.html#konqueror">Capture d'&eacute;cran de
    Konqueror</a>
<li><a href="truetype.html#how">Comment &ccedil;a marche ?</a>
<li><a href="truetype.html#work">Que faut-il faire pour les obtenir
    ?</a>
<li><a href="truetype.html#applications">Quelles applications peuvent
    les utiliser ?</a>
<li><a href="truetype.html#manualfonts">Comment puis-je en ajouter
    manuellement ?</a>
</ul>
<hr>

<a name="xterm"></a>
<h2>Capture d'&eacute;cran de xterm</h2>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>
avec polices alias&eacute;es et anti-alias&eacute;es compar&eacute;es :
<div align="center"><img src="../images/xterm_diff.jpg"
  alt="[xterm standard and anti-alias&eacute;]"></div>

<a name="konqueror"></a>
<h2>Capture d'&eacute;cran de Konqueror</h2>
Toujours pas convaincu ?
Jetons un coup d'oeil &agrave; ceci : 

Le <a href="http://konqueror.kde.org/">Navigateur Web Konqueror</a>
avec polices alias&eacute;es et anti-alias&eacute;es compar&eacute;es :
<div align="center"><img src="../images/konqueror_diff.jpg"
  alt="[Konqueror standard and anti-alias&eacute;]"></div>

<a name="how"></a>
<h2>Comment &ccedil;a marche ?</h2>
Les calculs d'anti-aliasing sont effectu&eacute;s par
<a href="http://www.freetype.org/">FreeType</a>, un moteur de polices
libre inclut dans XFree86. De plus, XFree86 contient une extension
appel&eacute;e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Xft&amp;sektion=3">Xft(3)</a>,
l'extension X FreeType, qui interagit avec FreeType pour les
op&eacute;rations de rendu des polices. Xft interagit aussi avec une
extension appel&eacute;e <i>Xrender</i>, l'extension X Render, qui
convertit les calculs effectu&eacute;s par FreeType en images
num&eacute;riques.

<a name= "work"></a>
<h2>Que faut-il faire pour les obtenir ?</h2>

OpenBSD inclut XFree86 4 avec l'extension X Render activ&eacute;e.
Pour pouvoir l'utiliser, votre serveur X (pilote de votre carte
vid&eacute;o) doit la supporter. Certains pilotes n'ont pas encore
&eacute;t&eacute; convertis au code 'fb' et ne peuvent donc pas utiliser
l'extension Render, qui est n&eacute;cessaire. n&eacute;cessaire.
<p>
Vous pourrez v&eacute;rifiez votre carte vid&eacute;o comme suit :

<blockquote><pre>
$ <strong>/usr/X11R6/bin/xdpyinfo | grep RENDER</strong>
RENDER
</pre></blockquote>

Si &quot;RENDER&quot; n'est pas sp&eacute;cifi&eacute; dans sa liste des
extensions, vous devrez attendre que quelqu'un impl&eacute;mente
l'extension pour cette carte.

<p>
L'&eacute;tape suivante consiste &agrave; trouver et d'installer quelques
polices "TrueType".
Une collection de polices populaires a &eacute;t&eacute; compil&eacute;e
et mise &agrave; disposition via
<a href="../faq8.html#Ports">l'arborescence des ports OpenBSD</a>, sous
<tt>/usr/ports/x11/msttcorefonts</tt>. Elles peuvent &ecirc;tre
install&eacute;es comme suit :

<blockquote><pre>
# <b>cd /usr/ports/x11/msttcorefonts</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

A partir de maintenant, les instructions pour l'enregistrement de
nouvelles polices avec X figurent dans une
<a href="#manualfonts">autre section</a>.

<a name= "applications"></a>
<h2>Quelles applications peuvent les utiliser ?</h2>
N'importe quelle application qui s'interface avec la librairie Xft peut
afficher des polices anti-alias&eacute;es. Ceci inclut les applications
QT 3.x (KDE 3.x) et GTK+2 (Gnome 2.x). Les programmes X standard
poss&eacute;dant une telle interface sont
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xditview&amp;sektion=1">xditview(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xfd&amp;sektion=1">xfd(1)</a>,
et quelques autres.

<h3>xterm</h3>
<tt>xterm</tt> peut &ecirc;tre invoqu&eacute; avec les arguments qui
permettent d'activer le rendu Xft des polices :

<blockquote><pre>
$ <strong>xterm -fa 'Andale Mono' -fs 14</strong>
</pre></blockquote>

Ces options sont :
<blockquote><pre>
Option   Resource         Meaning
----------------------------------------
 -fa     XTerm*faceName   Font face name
 -fs     XTerm*faceSize   Font size
</pre></blockquote>

On peut aussi utiliser les ressources X. Par d&eacute;faut, elles sont
situ&eacute;es dans <tt>$HOME/.Xdefaults</tt> et sont
contr&ocirc;l&eacute;es &agrave; l'aide du programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xrdb&amp;sektion=1">xrdb(1)</a>.

<p>
Certaines polices TrueType (telles que Arial, Georgia, et Verdana par
exemple) ne fonctionnent pas correctement avec <tt>xterm</tt>. En effet,
<tt>xterm</tt> utilise la largeur maximale de tous les caract&egrave;res
faisant partie d'une police donn&eacute;e pour afficher chaque
caract&egrave;re. Avec une police de type monospace, les largeurs de
tous les caract&egrave;res sont les m&ecirc;mes, et tout fonctionne
correctement. Avec une police proportionnelle, telle qu'une des polices
pr&eacute;cit&eacute;es, <tt>xterm</tt> affiche chaque caract&egrave;re
dans une cellule de la taille de la largeur maximale du caract&egrave;re
ce qui a pour effet de cr&eacute;er de larges s&eacute;parations
illisibles entre les caract&egrave;res.

<h3>Applications QT 3.x/KDE 3.x</h3>
Les applications utilisant QT 3.x, telle que n'importe quelle
application KDE 3.x, y compris Konqueror, peuvent utiliser le rendu Xft
une fois que la valeur suivante a &eacute;t&eacute; positionn&eacute;e
dans <tt>$HOME/.qt/qtrc</tt> sous la section <tt>[General]</tt>.

<blockquote><pre>
useXft=true
</pre></blockquote>

Le programme GUI de configuration de Qt, <tt>qtconfig</tt> (ou <tt>qtconfig-
mt</tt> si la version multi-threads de Qt est install&eacute;e), peut
positionner cette valeur &agrave; partir de la s&eacute;lection
<b>Enable Anti-aliased Font Support</b> figurant dans l'onglet
<b>Fonts</b>.

<h3>Applications GTK+2</h3>
Les applications GTK+2 requi&egrave;rent le positionnement de la
variable d'environnement <tt>GDK_USE_XFT</tt>. GDK est le
&quot;backend&quot; utilis&eacute; par GTK pour isoler les
d&eacute;tails des op&eacute;rations d'affichage. GDK d&eacute;chargera
les op&eacute;rations de rendu de polices vers Xft lorsqu'il
d&eacute;tecte la variable d'environnement.

<p>
La commande suivante aura pour effet de lancer le programme de
messagerie instantan&eacute;e
<a href="http://gaim.sourceforge.net/">Gaim</a> &agrave; base de GTK+2
disponible sous
<b>/usr/ports/net/gaim</b>:

<blockquote><pre>
$ env GDK_USE_XFT=1 gaim
</pre></blockquote>

<a name="manualfonts"></a>
<h2>Comment puis-je ajouter des polices manuellement ?</h2>
L'ajout d'une police &quot;&agrave; X&quot; n&eacute;cessite
l'enregistrement de la police au niveau du serveur X et au niveau de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fontconfig&amp;sektion=3">fontconfig(3)</a>,
&eacute;tant donn&eacute; qu'ils assurent un suivi des polices de
mani&egrave;re s&eacute;par&eacute;e. En fait, certains types de polices
sont uniquement reconnus par le serveur X, et d'autres uniquement par
fontconfig. Les polices TrueType sont reconnues par les deux.

<h3>Le serveur X</h3>
Les chemins des polices (i.e. des r&eacute;pertoires contenant les
polices) sont g&eacute;r&eacute;s soit directement par
<tt>/etc/X11/XF86Config</tt> soit par un programme s&eacute;par&eacute;
tel que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xfs&amp;sektion=1">xfs(1)</a>.
Pour ajouter une police, ajoutez le r&eacute;pertoire dans lequel elle
se trouve &agrave; <tt>/etc/X11/XF86Config</tt>:

<blockquote><pre>
Section "Files"
        FontPath        "/usr/X11R6/lib/X11/fonts/TTF/"
        FontPath        "<i>/usr/local/lib/X11/fonts/myfonts/</i>"
        ...
EndSection
</pre></blockquote>

Sinon, si vous utilisez <tt>xfs</tt>, ajoutez le r&eacute;pertoire &agrave;
<tt>/etc/X11/fs/config</tt>:

<blockquote><pre>
catalogue = /usr/X11R6/lib/X11/fonts/TTF/,
            <i>/usr/local/lib/X11/fonts/myfonts/</i>
</pre></blockquote>

Ensuite, le serveur X doit &ecirc;tre capable de prendre en compte la
police &agrave; travers l'index des polices dans ce r&eacute;pertoire,
&agrave; savoir le fichier <tt>fonts.dir</tt>. Traditionnellement,
toutes les tailles disponibles pour une police sont list&eacute;es au
niveau de l'index des polices, g&eacute;n&eacute;r&eacute; par la
commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkfontdir&amp;sektion=1">mkfontdir(1)</a>.
Mais &eacute;tant donn&eacute; que les polices TrueType peuvent
&ecirc;tre calibr&eacute;es &agrave; n'importe quelle &eacute;chelle, la
sp&eacute;cification de chaque taille possible n'est pas requise. Au
lieu de cela, les polices calibrables sont list&eacute;es dans le
fichier <tt>fonts.scale</tt>, reconnu par <tt>mkfontdir</tt> lors de la
g&eacute;n&eacute;ration des indexes <tt>fonts.dir</tt>.

<p>
Pour cr&eacute;er un fichier <tt>fonts.scale</tt>, vous pouvez utiliser
le programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mkfontscale&amp;sektion=1">mkfontscale(1)</a> :

<blockquote><pre>
# <b>cd <i>/usr/local/lib/X11/fonts/myfonts</i></b>
# <b>/usr/X11R6/bin/mkfontscale</b>
# <b>/usr/X11R6/bin/mkfontdir</b>
</pre></blockquote>

Enfin, pour appliquer les modifications &agrave; la session X en cours,
au lieu de red&eacute;marrer X, la commande suivante peut &ecirc;tre
utilis&eacute;e pour examiner &agrave; nouveau les chemins de polices
enregistr&eacute;s au niveau de XFree86 et prendre en compte les
modifications s'il y a lieu :

<blockquote><pre>
$ <b>xset fp rehash</b>
</pre></blockquote>

Ou, si un nouveau chemin de polices a &eacute;t&eacute; ajout&eacute; :

<blockquote><pre>
$ <b>xset +fp <i>/usr/local/lib/X11/fonts/myfonts</i></b>
</pre></blockquote>

Si vous utilisez <tt>xfs</tt>, utilisez plut&ocirc;t la commande suivante :

<blockquote><pre>
# <b>pkill -HUP xfs</b>
</pre></blockquote>

<h3>fontconfig</h3>
L'autre composant de X aupr&egrave;s duquel une nouvelle police doit
&ecirc;tre enregistr&eacute;e est fontconfig, utilis&eacute; par Xft
pour trouver les polices. fontconfig utilise le fichier
<tt>/etc/fonts/fonts.conf</tt> pour sa configuration globale mais
&eacute;tant donn&eacute; que ce fichier est remplac&eacute; lors des
mises &agrave; jour de X, <tt>/etc/fonts/local.conf</tt> doit &ecirc;tre
utilis&eacute; pour g&eacute;rer les changements globaux.

<p>
Ajoutez le r&eacute;pertoire contenant la police au fichier de
configuration :

<blockquote><pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &quot;/etc/fonts/fonts.dtd&quot;&gt;
&lt;fontconfig&gt;
  &lt;dir&gt;<i>/usr/local/lib/X11/fonts/myfonts</i>&lt;/dir&gt;
&lt;/fontconfig&gt;
</pre></blockquote>

Ou, si uniquement un utilisateur veut ajouter des polices &agrave; ses
sessions, les lignes ci-dessus peuvent &ecirc;tre plac&eacute;es dans le
fichier <tt>$HOME/.fonts.conf</tt>.

<p>
Notez que fontconfig examinera de mani&egrave;re r&eacute;cursive tous
les sous-r&eacute;pertoires disponibles dans les r&eacute;pertoires de
polices sp&eacute;cifi&eacute;s alors que le serveur X ne le fera pas.

<p>
Une fois le r&eacute;pertoire ajout&eacute;, le cache de polices pour le
r&eacute;pertoire doit &ecirc;tre reg&eacute;n&eacute;r&eacute;. La
commande suivante demande &agrave; fontconfig de reg&eacute;n&eacute;rer
les caches de polices pour tous les r&eacute;pertoires
sp&eacute;cifi&eacute;s dans sa configuration :

<blockquote><pre>
# <b>/usr/X11R6/bin/fc-cache -v</b>
</pre></blockquote>

Ces modifications prendront effet dans la session X en cours. X ne
n&eacute;cessitera donc pas de red&eacute;marrage. En revanche, les
applications en cours d'ex&eacute;cution doivent &ecirc;tre
red&eacute;marr&eacute;es.

<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif"
  border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: truetype.html,v 1.15 ]<br>
$Translation: truetype.html,v 1.9 2004/10/11 22:57:41 saad Exp $<br>
$OpenBSD: truetype.html,v 1.9 2004/10/12 07:18:21 jufi Exp $
</small>

</body>
</html>
