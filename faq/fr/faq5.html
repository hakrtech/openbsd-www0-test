<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>5 - Construire le Système à partir des
Sources</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2004 by OpenBSD.">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<!-- Passes validator.w3.org.  Please keep it this way -->

<a href="../../fr/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[Index de La FAQ]</a>
<a href= "faq4.html">[Section 4 - Guide d'Installation]</a>
<a href= "faq6.html">[Section 6 - Mise en place du réseau]</a>
</font>

<h1><font color="#e00000">5 - Construire le Système à
    partir des Sources</font></h1>
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC

<hr>
<p>
<b><font color="#e00000">Remarque Importante :</font></b> Le contenu de
   ce fichier est obsolète. Consultez la version anglaise
   <a href="../faq5.html">ici</a> pour des informations à jour.

<p>
Si vous souhaitez contribuez à l'effort de traduction,
prière de consulter
<a href="../../fr/translation.html">la page de traduction</a>.

-->
<hr>

<p>
<h3>Table des matières</h3>
<ul>
<li><a href="#Flavors" >5.1 - Les Saveurs ("Flavors")
    OpenBSD</a>
<li><a href= "#Why">5.2 - Pourquoi aurais-je besoin d'un noyau sur
    mesure?</a>
<li><a href= "#Options">5.3 - Options de configuration du noyau</a>
<li><a href= "#Building">5.4 - Construire votre propre noyau</a>
<li><a href= "#BootConfig">5.5 - Configuration au démarrage</a>
<li><a href= "#VerboseBoot">5.6 - Avoir plus d'informations pendant le
    démarrage</a>
<li><a href= "#config">5.7 - Utilisation de config(8) pour changer le
    binaire du noyau</a>
<li><a href="#buildprobs">5.8 - Problèmes Usuels de Compilation
    </a>
   <ul>
   <li><a href="#sig11">5.8.1 - La compilation s'est arrêtée avec une
       erreur "Signal 11"</a>
   <li><a href="#snake">5.8.2 - "make build" échoue en générant un
       message "cannot open output file snake: is a directory"</a>
   </ul>
<li><a href="#BldRelease" >5.9 - Comment compiler une "release"
    OpenBSD</a>
</ul>
<hr>
<br>


<a name="Flavors"></a>
<h2>5.1 - Les Saveurs ("Flavors") OpenBSD</h2>
<!-- XXXversion - revise doodle -->
Il existe trois "saveurs" OpenBSD :
<ul>
<li><b>-release:</b> La version d'OpenBSD livrée tous les six mois sur
    CD.
<li><b>-stable:</b> "release", plus les correctifs considérés comme
    critiques pour la sécurité et la fiabilité.
<li><b>-current:</b> La version courante (ou de développement)
    d'OpenBSD, qui deviendra la prochaine "release".
</ul>

Graphiquement, le développement de ces versions ressemble à ceci :

<blockquote>
<pre>
       ,------o-----------o----X                    3.3 Stable
       |      .           .
       |      .    ,------o---------o----X          3.4 Stable
       |      .    |      .         .
       |      .    |      .    ,----o----------o--&gt; 3.5 Stable
       |      .    |      .    |    .          .
       |      .    |      .    |    .    ,-----o--&gt; 3.6 Stable
       |      .    |      .    |    .    |     .
       |      .    |      .    |    .    |     .
 --&gt;3.3Rel-----&gt;3.4Rel-----&gt;3.5Rel-----&gt;3.6Rel----&gt; Current 

          Temps ---&gt;
</pre>
</blockquote>

<p>
L'arborescence des sources est séparée en trois branches tous les six
mois : <i>-current</i>, <i>-release</i>, et <i>-stable</i> -- <i>-
release</i> devient un point gelé (une "Balise") dans l'historique de
l'arborescence des sources - aucune modification n'est apportée à cette
branche. Elle constitue ce qui figure sur les <a
href="../../orders.html">CDs</a> et les <a
href="../../fr/ftp.html">serveurs FTP </a>. <i>-Current</i> est la
branche qui reçoit tous les travaux en cours, et devient la prochaine
<i>-release</i> d'OpenBSD.

<p>
La branche <i>-stable</i> (aussi connue sous le nom de "branche des
correctifs") est basée sur <i>-release</i>, et comme on peut le
constater, c'est une "branche" à partir de la trajectoire de
développement d'OpenBSD. Lorsque des correctifs importants sont crées
pour <i>-current</i>, ils sont portés "en arrière" vers les branches
<i>-stable</i>. Dans l'illustration ci-dessus, les lignes verticales en
pointillé sont des correctifs de bogues incorporés aux branches
<i>-stable</i>. Vous remarquerez aussi dans l'exemple ci-dessus que la
branche <i>3.3-stable</i> a été supprimée à la sortie de
<i>3.5-release</i>, et que la branche <i>3.4-stable</i> a été supprimée
à la sortie de <i>3.6-release</i> -- les anciennes versions sont
typiquement supportées durant deux "releases" au maximum. Le support
d'anciennes versions nécessite des ressources et du temps, et alors que
nous pourrions vouloir plutôt fournir un support continu pour les
anciennes versions, nous préférerions nous concentrer sur les nouvelles
fonctionnalités. La branche <i>-stable</i> est, par conception, très
facile à construire à partir de <i>-release</i> de la même version
(i.e., en allant de <i>3.6-release</i> vers <i>3.6-stable</i>).

<p>
La branche <i>-stable</i> est <i>-release</i> plus les correctifs listés
dans la <a href="../../fr/errata.html">page des errata</a>, ainsi que
quelques correctifs ne nécessitant pas d'erratum. Habituellement, le
fonctionnement de <i>-stable</i> est le même que celui de
<i>-release</i> sur laquelle elle est basée. Si les
<a href="http://www.openbsd.org/cgi-bin/man.cgi">pages du manuel</a>
doivent être modifiés, il est très probable que ces modifications ne
feront pas partie de <i>-stable</i>. En d'autres termes, le support de
nouveaux périphériques NE sera pas ajouté à <i>-stable</i>, et le
support de nouvelles fonctionnalités sera très rarement ajouté sauf si
c'est considéré comme très important.

<p>
Attention : <i>-current</i> change tout le temps. Elle change
pratiquement toutes les minutes, et pourrait bien changer plusieurs fois
le temps de télécharger le code source. Comme précédemment indiqué,
aucune garantie n'est donnée quant à la compilation du système ou à son
fonctionnement (bien entendu, nous espérons qu'il fonctionne). Il est
complètement possible et pas si rare d'obtenir les sources
<i>-current</i> et de voir leur compilation échouer et cinq minutes plus
tard, il se pourrait que ça fonctionne correctement. <b>Si vous n'êtes
pas prêt à gérer ce type de situation, prenez vos distances de
<i>-current</i>.</b>

<p>
La plupart des utilisateurs devraient utiliser <i>-stable</i> ou
<i>-release</i>. Cela dit, plusieurs personnes utilisent <i>-current</i>
sur des systèmes en production, et il est important que certaines
personnes fassent cela pour identifier des bogues et tester les
nouvelles fonctionnalités. Cependant, si vous ne savez pas comment
décrire, diagnostiquer et gérer proprement un problème, ne vous dites
pas (ou à quelqu'un d'autre) que vous être entrain d'"aider le projet"
en utilisant <i>-current</i>. "Ça ne marche pas !" n'est pas un <a
href="../../report.html#bugtypes">rapport de bogue utile</a>. "Les
changements récents dans le pilote pciide a brisé la compatibilité avec
mon interface IDE basée sur Slugchip, ci-joint le dmesg d'un système
fonctionnel et un système ne fonctionnant pas..." peut être un rapport
utile.

<p>
Des fois, les utilisateurs "normaux" veulent disposer des derniers
développements et utiliser <i>-current</i>. La raison la plus commune de
faire cela est que l'utilisateur possède un périphérique qui n'est pas
supporté par <i>-release</i> (et donc, par <i>-stable</i> non plus), ou
il souhaite utiliser une nouvelle fonctionnalité de <i>-current</i>.
Dans ce cas, soit l'utilisateur utilise <i>-current</i> ou n'utilise pas
le périphérique, et utiliser <i>-current</i> est peut-être l'option la
plus logique. Cependant, il ne faut pas espérer que les développeurs
vous tiennent la main.

<h3>Snapshots</h3>
Entre les versions formelles d'OpenBSD, des <i>snapshots</i> sont mis à
disposition sur les <a href="../../fr/ftp.html">sites FTP </a>. Comme le
nom l'indique, ce sont des images du code dans l'arborescence à
l'instant où le créateur de l'image a pris une copie du code pour une
plate-forme donnée. Il est à noter que, pour certaines plates-formes, il
peut s'écouler des jours entiers avant que l'image soit complètement
construite et mise à disposition. Aucune garantie n'est donnée quant au
bon fonctionnement ou à la possibilité d'installer des snapshots.
Souvent, une modification qui a besoin d'être testée peut enclencher le
processus de création des snapshots. Quelques plates-formes ont des
snapshots construits pratiquement tous les jours, d'autres en ont
beaucoup moins fréquemment. Si vous souhaitez utiliser <i>-current</i>,
un snapshot récent est tout ce dont vous aurez besoin, et mettre à jour
un snapshot est un bon point de départ avant de tenter de compiler
<i>-current</i>.

<p>
Parfois, on demande s'il y a un moyen d'obtenir une copie exacte du code
qui a servi à construire un snapshot. La réponse est non. Primo, il n'y
a aucun intérêt. Secundo, les snapshots sont construits selon le souhait
des développeurs, lorsque le planning le permet, et lorsque des
ressources sont disponibles. Sur les plates-formes rapides, il est
possible de créer plusieurs snapshots en un jour. Sur les plates-formes
lentes, la création d'un snapshot peut durer une semaine ou plus.
Fournir des balises ou des marques dans l'arborescence des sources pour
chaque snapshot peut s'avérer peu pratique.

<h3>Garder Les Composants Synchronisés</h3>
Il est important de comprendre qu'OpenBSD est un Système d'Exploitation,
et il faut le prendre en tant que tel et non pas comme un noyau entouré
d'un ensemble d'outils. Vous devez vous assurer que votre noyau, le
"userland" (les utilitaires et fichiers complétant le noyau) et
l'arborescence des <a href="../../fr/ports.html"><tt>ports</tt></a> sont
synchronisés, autrement des choses désagréables peuvent arriver. Dit
autrement (vu que les gens continuent à commettre les mêmes erreurs),
vous ne pouvez pas utiliser des <tt>ports</tt> tout neufs sur un système
datant d'il y a un mois, ou reconstruire un noyau à partir de
<i>-current</i> et espérer qu'il fonctionne avec un "userland"
<i>-release</i>. Oui, cela veut dire que vous aurez besoin de mettre à
jour votre système si vous voulez utiliser un nouveau programme qui a a
été rajouté aujourd'hui à l'arborescence des ports. OpenBSD n'a
malheureusement que des ressources limitées.

<p>
Il faut aussi comprendre que lors de la
<a href="upgrade-minifaq.html">mise à jour des sources</a>, le processus
de mise à jour est uniquement supporté <b>dans une seule direction
uniquement : de l'ancien au nouveau</b>, et de <i>-stable</i> vers
<i>-current</i>. Vous ne pouvez pas utiliser <i>3.6-current</i> (ou un
snapshot), puis décider que c'est trop dangereux, et revenir vers
<i>3.6-stable</i>. Vous ne pouvez compter que sur vous-même si vous
choisissez un autre chemin que celui, supporté, consistant à réinstaller
votre système proprement. Vous ne devez espérer aucune aide de la part
de l'équipe de développement OpenBSD.

<p>
Oui, cela veut dire que vous devez prendre le temps de réfléchir avant
d'utiliser <i>-current</i>.


<p>
<a name="Why"></a>
<h2>5.2 - Pourquoi aurais-je besoin d'un noyau sur mesure?</h2>

<p>
En réalité, vous n'en avez très probablement pas besoin.

<p>
Un noyau sur mesure est un noyau construit à partir d'un fichier de
configuration autre que <tt>GENERIC</tt>, le fichier de configuration
fourni de base Un noyau sur mesure peut se baser sur du code source <a
href="#Flavors"><i>-release, -stable</i> or <i>-current</i></a> comme
c'est le cas pour le noyau <tt>GENERIC</tt>. Alors que la compilation de
votre propre noyau <tt>GENERIC</tt> est supportée par l'équipe OpenBSD,
la compilation de votre propre noyau sur mesure
<i>ne</i> l'est pas.

<p>
Le fichier de configuration noyau OpenBSD standard (<tt>GENERIC</tt>)
est conçu pour convenir à la plupart des utilisateurs. Bon nombre de
personnes ont rendu leur système inopérant en essayant d'optimiser le
noyau au lieu d'améliorer son fonctionnement. Il existe certaines
personnes qui pensent qu'un noyau et un système d'exploitation doivent
être taillés sur mesure pour obtenir des performances optimales. Ceci
n'est pas vrai dans le cas d'OpenBSD. Seules les personnes très
compétentes avec des applications très particulières doivent penser à
faire un noyau et un système sur mesure.

<p>
Voici quelques raisons pour lesquelles vous devriez créer un noyau sur
mesure :
<ul>
  <li>Vous savez vraiment ce que vous faites, et vous souhaitez utiliser
      OpenBSD sur une machine disposant de peu de ressources mémoire en
      supprimant tous les pilotes de périphériques dont vous n'avez pas
      besoin.
  <li>Vous savez vraiment ce que vous faites, et vous souhaitez
      supprimer des options par défaut ou ajouter des options qui ne
      sont pas activées par défaut (et vous avez vraiment une bonne
      raison pour le faire).
  <li>Vous savez vraiment ce que vous faites, et vous souhaitez activer
      des options expérimentales.
  <li>Vous savez vraiment ce que vous faites, et vous avez un besoin
      spécifique auquel le noyau <tt>GENERIC</tt> ne répond pas. Si
      quelque chose ne marche pas comme prévu, vous n'allez pas demander
      à autrui le pourquoi du comment.
</ul>

<p>
Voici quelques raisons pour lesquelles vous ne devez pas compiler un
noyau sur mesure :
<ul>
  <li>Vous n'en avez pas besoin en temps normal.
  <li>Votre système n'en sera pas plus rapide.
  <li>Vous rendrez probablement votre machine moins fiable.
  <li>Vous n'obtiendrez aucune aide de la part des développeurs.
  <li>Tout problème rencontré devra être obligatoirement reproduit avec
      un noyau <tt>GENERIC</tt> avant que les développeurs ne le
      prennent au sérieux.
  <li>Les autres utilisateurs et les développeurs vous riront au nez si
      vous cassez votre système.
  <li>D'habitude, des options de compilation sur mesure exposent les
      problèmes de compilateur au lieu d'améliorer les performances du
      système.
</ul>

<p>
La suppression de pilotes pourrait rendre plus rapide la phase de
démarrage système. Cependant, elle peut compliquer la récupération suite
à problème matériel. La suppression de pilotes est une tâche très
souvent mal réalisée. La suppression de pilotes <i>ne rendra pas</i>
votre système plus rapide de manière perceptible même si elle peut
produire un noyau plus petit. La suppression des parties liées au
déboguage et à la vérification d'erreurs peut améliorer les
performances, mais rendra impossible l'analyse du système si quelque
chose ne fonctionne plus ou pas.


<p>
Encore une fois, les développeurs ignorent d'habitude les rapports de
bogue relatifs à des noyaux personnalisés, sauf si le problème peut être
reproduit avec un noyau <tt>GENERIC</tt>. Vous aurez été prévenu.

<p>
<a name="Options"></a>
<h2>5.3 - Options de configuration du noyau</h2>
La création d'un noyau OpenBSD est contrôlée par le biais de fichiers de
configuration, se trouvant dans le répertoire
<tt>/usr/src/sys/arch/<i>&lt;arch&gt;</i>/conf/</tt> par défaut. Toutes
les architectures possèdent un fichier, <tt>GENERIC</tt>, qui peut être
utilisé pour générer un noyau OpenBSD standard pour une plate-forme
donnée. Il peut aussi y avoir d'autres fichiers de configuration qui
peuvent être utilisés pour créer des noyaux avec des objectifs
différents tels que la minimisation de l'utilisation de la RAM, les
stations de travail "diskless", etc.

<p>
Le fichier de configuration est traité par 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>,
qui crée et peuple un répertoire de compilation situé sous
<tt>../compile</tt>. Pour une installation typique, le chemin absolu du
répertoire serait situé sous
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/compile/</tt>. config(8) peut
aussi créer un fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">Makefile</a>,
et d'autres fichiers requis pour créer avec succès un noyau.

<p>
Les options de configuration du noyau sont des options que vous ajoutez
à la configuration de votre noyau pour activer certaines
caractéristiques dans celui-ci. Ceci vous permet d'avoir exactement le
support que vous voulez sans vous encombrer des pilotes inutiles. Il y a
une multitude d'options qui vous permettront de personnaliser votre
noyau. Veuillez consulter la page du manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4
">options(4)</a> pour une liste complète des options. Vous pouvez aussi
consulter les fichiers d'exemples de configurations qui sont disponibles
pour votre architecture.

<p>
<b>L'ajout, la suppression, ou la modification d'options dans votre
noyau ne doivent être effectués que si vous avez une bonne raison pour
le faire !</b> La seule configuration du noyau supportée par l'équipe
OpenBSD est le noyau GENERIC, la combinaison d'options figurant dans les
fichiers <tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/conf/GENERIC</tt> et
<tt>/usr/src/sys/conf/GENERIC</tt> <i>tels que livrés par l'équipe
OpenBSD</i> (i.e. non édités). Emettre un rapport de bogues concernant
un noyau personnalisé va dans la plupart des cas se résumer à une retour
vous demandant d'essayer de reproduire le problème avec un noyau
GENERIC. Les options ne sont pas toutes compatibles entre elles, et
plusieurs options sont nécessaires au bon fonctionnement du système. Il
n'y a aucune garantie quant au fonctionnement d'un noyau personnalisé
que vous avez réussi à compiler.

<p>
Vous pouvez voir les fichiers de configuration spécifiques à une
plate-forme donnée ici :

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Fichiers de Configuration du Noyau alpha </a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Fichiers de Configuration du Noyau i386</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/macppc/conf/">Fichiers de Configuration du Noyau macppc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Fichiers de Configuration du Noyau sparc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc64/conf/">Fichiers de Configuration du Noyau sparc64</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/vax/conf/">Fichiers de Configuration du Noyau vax</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/hppa/conf/">Fichiers de Configuration du Noyau hppa</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Other Arch's</a>
</ul>

<p>
Si vous lisez attentivement ces fichiers vous verrez une ligne du genre
:
<pre>
     include "../../../conf/GENERIC"
</pre>
Cela signifie que l'on fait référence à un autre fichier de
configuration. Ce fichier comprend toutes les options qui ne sont pas
dépendantes de l'architecture. Donc quand vous créez votre fichier de
configuration, soyez sûr de regarder
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">
/sys/conf/GENERIC</a> pour voir ce que vous voulez. 

<p>
Toutes les options ci-dessous doivent être placées dans le fichier de
configuration du noyau avec le format :
<blockquote>
<tt>option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><i>nom</i>
</blockquote>
Par exemple, pour utiliser l'option "DEBUG" dans le noyau, il faut
mettre la ligne suivante :
<pre>
     option      DEBUG
</pre>
Les options dans le noyau OpenBSD sont traduites en tant qu'options du
préprocesseur, donc une option telle que DEBUG compilerait les sources
avec l'option -DDEBUG. Ce qui est équivalent à placer un <tt>#define
DEBUG</tt> à travers les sources du noyau.

<p>
Quelques fois, vous aurez peut-être besoin de désactiver une option
précedemment définie dans le fichier "<tt>src/sys/conf/GENERIC</tt>"
typiquement. Bien entendu, vous pouvez modifier une copie de ce fichier,
mais une meilleure méthode consiste à utiliser la clause
<i>rmoption</i>. Par exemple, si vous souhaitiez vraiment désactiver le
débogueur intégré au noyau (<i>non recommandé !</i>), vous ajouteriez la
ligne suivante : <pre> rmoption DDB </pre> à votre fichier de
configuration du noyau. <tt>option DDB</tt> est définie dans
<tt>src/sys/conf/GENERIC</tt>, mais la ligne <tt>rmoption</tt> ci-dessus
la désactive.

<p>
Encore une fois, veuillez consulter 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>
pour plus d'informations concernant les spécificités de ces options. Il
est à noter que plusieurs options possèdent leurs propres pages de
manuel -- il faut toujours lire toutes les informations disponibles au
sujet d'une option avant de l'ajouter ou la supprimer de votre noyau.

<p> 
<a name="Building"></a>
<h2>5.4 - Construire votre propre noyau</h2>

<p>
Toutes les instructions pour créer votre noyau sur mesure sont dans la
page du manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&amp;sektion=8"> 
afterboot(8)</a>.

<p>
Pour compiler votre noyau depuis le cdrom vous aurez tout d'abord besoin
d'avoir le code source. Ce dernier est disponible à partir du <a
href="../../orders.html">CD officiel</a> (disque 3) et à partir des <a
href="../../fr/ftp.html">sites FTP</a>. Cet exemple suppose que le CD3
est monté sur /mnt :

<blockquote>
<pre>
# <strong>cd /usr/src</strong>
# <strong>tar xvzf /mnt/src.tar.gz</strong>
</pre>
</blockquote>

<b>Remarque :</b> Si vous effectuez un téléchargement à partir des
serveurs FTP, vous trouverez DEUX fichiers : <i>src.tar.gz</i> et
<i>sys.tar.gz</i>. Le premier correspond à "userland" -- tout excepté le
noyau, le second est le code source du noyau. Téléchargez et effectuez
une extraction des deux comme expliqué ci-dessus vu que pour la plupart
des utilisations, vous aurez besoin des deux. Sur le CD-ROM, ils sont
combinés dans un seul fichier.

<p>
Maintenant, pour créer votre noyau personnalisé il est plus facile de
partir du noyau GENERIC. Ce dernier est situé sous
<tt>/usr/src/sys/arch/$ARCH/conf/GENERIC</tt>, où $ARCH est votre
architecture. Il y a d'autres configurations en exemples dans le
répertoire. Voici deux exemples vous montrant comment compiler votre
noyau. Le premier exemple permet de compiler votre noyau avec des
sources en lecture seule. Le second correspond à des sources accessibles
en écriture.

<blockquote> 
<pre>
# <strong>cd /somewhere</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .</strong>
# <strong>vi SOMEFILE</strong>   <i>(pour effectuer les changements voulus)</i>
# <strong>config -s /usr/src/sys -b . SOMEFILE</strong>
</pre>
suivi par :

<pre>
    # <strong>make depend</strong>
         <b><i>- OU -</i></b>
    # <strong>make clean && make depend</strong>
# <strong>make</strong>
</pre>
</blockquote>

Vous devez exécuter '<tt>make depend</tt>' lorsque vous effectuez
n'importe quelle modification à votre arborescence des sources (y
compris des mises à jour et des correctifs) (en d'autres termes,
pratiquement toujours. Si config vous dit d'exécuter '<tt>make
clean</tt>', alors faites le avant d'exécuter '<tt>make depend</tt>'.

<p>
Si vous avez effectué des modifications aux options de configuration de
votre noyau, et/ou effectué des modifications majeures à votre
arborescence des sources, vous devriez utiliser '<tt>make clean</tt>' au
lieu de '<tt>made depend</tt>'. Il est à noter qu'il est toujours de bon
ton de faire un 'make clean', même si ça peut aboutir à des temps de
compilation plus longs, vu que plus de choses ont besoin d'être
reconstruites.

<p>
Pour compiler un noyau avec des sources accessibles en écriture il faut
effectuer les actions suivantes :

<blockquote>
<tt>
# <strong>cd sys/arch/$ARCH/conf</strong><br>
# <strong>vi SOMEFILE</strong><i> (pour effectuer tous les changements voulus)</i><br>
# <strong>config SOMEFILE</strong><i> (plus de détails sur cette
# opération sont disponibles ici :
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>)</i><br>
# <strong>cd ../compile/SOMEFILE</strong><br>
# <strong>make</strong> <br>
</tt>
</blockquote>

<p>
Où $ARCH est l'architecture que vous utilisez (par exemple i386). Vous
pouvez aussi faire un <strong>make depend</strong> pour créer les
dépendances pour la prochaine compilation de votre noyau.

<p>
Pour déplacer votre noyau à sa destination.

<blockquote>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd</strong>
</pre>
</blockquote>

Pour démarrer avec votre ancien noyau au démarrage, il suffit juste de
faire ceci

<blockquote>
<pre>
boot&gt; <strong>bsd.old</strong>
</pre>
</blockquote>

votre ancien noyau sera alors chargé à la place de /bsd.

<p>
Parfois quand vous installez un nouveau noyau, il vous faudra installer
de nouveaux blocs de démarrage. Pour ce faire, lisez <a
href="../faq14.html#InstBoot">FAQ 14, Installation des Bootblocks</a>,
qui vous donnera toutes les informations sur le bootloader OpenBSD.

<p>
<a name="BootConfig"></a>
<h2>5.5 - Configuration au démarrage</h2>

<p>
Parfois lorsque vous démarrez votre système vous remarquerez que votre
noyau trouve vos périphériques mais à la mauvaise IRQ. Et avez-vous
immédiatement besoin de ce périphérique. Sans recompiler votre noyau
vous pouvez utiliser la configuration au démarrage de celui-ci. Cela
permettra de corriger votre problème pour cette fois et uniquement pour
cette fois. Si vous redémarrez le système il faudra recommencer la
procédure. Il s'agit donc d'une méthode temporaire. Le problème devra
être corrigé en recompilant votre noyau. De plus votre noyau à besoin de
l'<strong>option BOOT_CONFIG</strong> dans la configuration du noyau. Le
noyau GENERIC possède cette option.

<p>
Une grande partie de ce document peut-être trouvé dans la page du manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&amp;sektion=8">boot_config(8)</a>.

<p>
Pour démarrer avec UKC (User Kernel Config), il faut spécifier l'option
-c au démarrage.

<blockquote><pre>
boot&gt; <strong>boot hd0a:/bsd -c</strong>
</pre></blockquote>

Où n'importe quel autre noyau que vous voulez démarrer. L'invite de
commandes UKC apparaîtra. De là vous pourrez spécifier au noyau les
périphériques que vous désirez modifier, ceux que vous voulez activer ou
désactiver.

<p>
Voici un liste des commandes les plus utilisées dans UKC.

<ul>
<li><tt>add <strong>device</strong></tt> - Ajoute un périphérique en en
    copiant un autre
<li><tt>change <strong>devno | device </strong></tt> - Modifie un ou
    plusieurs périphériques
<li><tt>disable <strong>devno | device </strong></tt> - Désactive un ou
    plusieurs périphériques
<li><tt>enable <strong>devno | device </strong></tt> - Active un ou
    plusieurs périphériques
<li><tt>find <strong>devno | device </strong></tt> - Trouver un ou
    plusieurs périphériques
<li><tt>help</tt> - Rapide sommaire de ces commandes
<li><tt>list</tt> - Liste TOUS les périphériques connus
<li><tt>exit/quit</tt> - Continue le démarrage
<li><tt>show <strong>[attr [val]]</strong></tt> - Montre les
    périphériques avec un attribut et une valeur spécifiée optionnelle
</ul>

<p>
Une fois votre noyau configuré, utilisez <tt>quit</tt> ou <tt>exit</tt>
et continuez le démarrage.
Une fois votre système démarré, vous devriez rendre la modification
permanente au niveau de votre binaire du noyau, tel que c'est décrit
dans <a href="faq5.html#config">utilisation de config(8) pour changer le
binaire du noyau</a>

<p>
<a name="VerboseBoot"></a>
<h2>5.6 - Avoir plus d'informations pendant le démarrage</h2>

Obtenir plus d'informations pendant le démarrage peut-être très pratique
lorsque vous essayez de régler certains problèmes lors de celui-ci. Si
vous avez un problème et que vous aimeriez avoir plus d'informations,
redémarrez votre machine. Quand vous obtenez l'invite "boot&gt;quot;
démarrez avec l'option -c. L'invite UKC&gt; apparaîtra et ensuite :

<blockquote><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enabled
UKC&gt; <strong>quit</strong>
</pre></blockquote>

<p>
Vous obtiendrez un démarrage extrêmement verbeux.

<p>
<a name="config"></a>
<h2>5.7 - Utilisation de config(8) pour changer le binaire du noyau</h2>

<p>
<p> Les options <b>-e</b> et <b>-u</b> de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
peuvent être très utiles et vous évitent de perdre du temps à recompiler
votre noyau. Le drapeau <b>-e</b> vous permet de rentrer en
configuration UKC alors que le système fonctionne. Les changements
prendront effets au prochain redémarrage. Le drapeau <b>-u</b> permet de
voir si des changements ont été effectués au noyau pendant le démarrage,
signifiant que vous avez utilisé <b>boot -c</b> pour entrer en
configuration UKC.

<p>
Les exemples suivants montrent la désactivation des périphériques ep*
dans le noyau. Pour plus de sécurité, il est préférable d'utiliser
l'option <b>-o</b> qui écrira les changements dans un fichier spécifié.
Par exemple : <strong>config -e -o bsd.new /bsd</strong> écrira les
changements dans bsd.new. Les exemples n'utilisent pas l'option <b>-
o</b>, mais les changements sont ignorés et non écrit dans le binaire du
noyau. Pour plus d'informations sur les messages d'erreur et
d'avertissement, lire la page du manuel

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
.

<blockquote><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 3.6 (GENERIC) #59: Fri Sep 17 12:32:57 MDT 2004
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc&gt; ?
        help                            Command help list
        add         dev                 Add a device
        base        8|10|16             Base on large numbers
        change      devno|dev           Change device
        disable     attr val|devno|dev  Disable device
        enable      attr val|devno|dev  Enable device
        find        devno|dev           Find device
        list                            List configuration
        lines       count               # of lines per page
        show        [attr [val]]        Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
        timezone    [mins [dst]]        Show/change timezone
        nmbclust    [number]            Show/change NMBCLUSTERS
        cachepct    [number]            Show/change BUFCACHEPERCENT
        nkmempg     [number]            Show/change NKMEMPAGES
        shmseg      [number]            Show/change SHMSEG
        shmmaxpgs   [number]            Show/change SHMMAXPGS
ukc&gt; <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*|neo*|cmpci*
|clcs*|clct*|auich*|autri*|auvia*|fms*|uaudio*|maestro*|esa*|yds*|emu* flags 0x0
  1 midi* at sb0|sb*|opl*|opl*|opl*|opl*|ym*|mpu*|autri* flags 0x0
  2 nsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  3 nsphyter* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|
vr*|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep
*|ep*|ep* phy -1 flags 0x0
  4 qsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  5 inphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  6 iophy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  7 eephy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  8 exphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
[...snip...]
ukc&gt; <strong>disable ep</strong>
 67 ep0 disabled
 68 ep* disabled
 69 ep* disabled
155 ep0 disabled
156 ep0 disabled
157 ep* disabled
158 ep* disabled
210 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</pre></blockquote>

<p>
Dans l'exemple ci-dessus, tous les périphériques ep* sont désactivés du
noyau et ne seront donc pas testés. Dans certaines situations où vous
aurez effectué ces changements au démarrage avec UKC et <b>boot -c</b>,
il vous faudra les rendre définitifs. Pour ce faire, il faudra utiliser
l'option <b>-u</b>. Dans l'exemple suivant, l'ordinateur a été démarré
avec UKC et les périphériques wi(4) sont désactivés. Ètant donné que les
changements fait par boot -c ne sont pas permanents, ceux-ci doivent
être écrits sur le disque. Cet exemple montre comment écrire les
changements effectués par boot -c dans un nouveau binaire noyau bsd.new.

<blockquote><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 3.6 (GENERIC) #59: Fri Sep 17 12:32:57 MDT 2004
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
105 wi* disabled
106 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</pre></blockquote>

<a name="buildprobs"></a>
<h2>5.8 - Problèmes Usuels de Compilation</h2>

<a name="sig11"></a>
<h3>5.8.1 - La compilation s'est arrêtée avec une erreur "Signal
    11"</h3>

<p>
La compilation d'OpenBSD et d'autres programmes à partir des sources est
une tâche qui sollicite le matériel plus que la plupart des autres
opérations, faisant un usage intensif du CPU, du disque et de la
mémoire. Par conséquence, si votre matériel a des problèmes, ces
derniers apparaîtront plus facilement durant une compilation. Les
défaillances "Signal 11" sont <tt>typiquement</tt> causées par des
problèmes matériel, et la plupart du temps à cause de problèmes de
mémoirei. Mais ces défaillances peuvent aussi causées par le CPU, la
carte mère, ou des problèmes de surchauffe. Votre système peut
d'ailleurs être stable la plupart du temps et connaître des défaillances
lors de la compilation de programmes.

<p>
Il est recommandé de réparer ou remplacer les composants à l'origine des
défaillances; les problèmes pouvant se manifester sous d'autres formes
plus tard. Si vous avez du matériel que vous souhaitez utiliser et qui
ne vous pose aucun problème, installez simplement une snapshot ou une
"release".

<p>
Pour plus d'informations, consultez la 
<a href="http://www.bitwizard.nl/sig11/">Faq Sig11</a>.

<a name="snake"></a>
<h3>5.8.2 - "make build" échoue en générant un
        message "cannot open output file snake: is a directory"</h3>

Ceci est le résultat de deux erreurs séparées :
<ul>
<li><b>Vous n'avez pas proprement récupéré ou mis à jour votre
    arborescence CVS.</b> Lorsque vous effectuez une opération "CVS
    checkout", vous devez utiliser l'option "<tt>-P</tt>", et lorsque
    vous mettez à jour votre arborescence des sources à partir de CVS,
    vous devez utiliser les options "<tt>-Pd</tt>" de
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1"
>cvs(1)</a>,
    tel que c'est documenté dans le 
    <a hrefi="../../fr/anoncvs.html">guide anoncvs </a>, l'
    <a href="upgrade-minifaq.html">upgrade-minifaq</a> et la 
    <a href="faq8.html#CVS">FAQ</a>. Ces options s'assurent que les
    nouveaux répertoires sont ajoutés et supprimés de l'arborescence
    suivant l'évolution d'OpenBSD.

<li><b>Vous n'avez pas correctement crée le répertoire <tt>obj</tt>
    avant de commencer la compilation.</b> La compilation de
    l'arborescence sans répertoire <tt>/usr/obj</tt> n'est pas
    supportée.

</ul>
Il est important de suivre soigneusement les instructions lors de <a
href="../../fr/anoncvs.html">l'obtention et de la mise à jour</a> de
votre arborescence des sources et lors de la
<a href="upgrade-minifaq.html">compilation</a>de votre arborescence.

<a name="BldRelease"></a>
<h2>5.9 -  Comment compiler une "release" OpenBSD</h2>
Après avoir compilé votre système, vous pouvez créer les <a
href="faq4.html#FilesNeeded">ensembles de fichiers</a> OpenBSD qui
peuvent être utilisés pour installer votre système sur une autre
machine.

<p>
La procédure nécessaire pour effectuer cette opération est détaillée
dans la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>


<p>
<font color= "#0000e0">
<a href= "index.html">[Index de La FAQ]</a>
<a href= "faq4.html">[Section 4 - Guide d'Installation]</a>
<a href= "faq6.html">[Section 6 - Le réseau]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[back]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq5.html,v 1.99 ]<br>
$Translation: faq5.html,v 1.42 2004/11/03 14:24:36 saad Exp $<br>
$OpenBSD: faq5.html,v 1.34 2004/11/03 21:01:24 saad Exp $ 
</small> 

</body>
</html>
