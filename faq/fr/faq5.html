<html>
<head>
<title>5.0 - Configuration du noyau</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>5.0 - Configuration du noyau</font><hr></h2>
</p>

<p>
<ul><h3>Table des matières</h3>
<li><a href= "#Why">5.1 - Pourquoi est-ce que j'ai besoin de faire un noyau sur mesure ?</a></li>
<li><a href= "#Options">5.2 - Options de configuration du noyau</a></li>
<li><a href= "#Building">5.3 - Construire votre propre noyau</a></li>
<li><a href= "#BootConfig">5.4 - Configuration au démarrage</a></li>
<li><a href= "#VerboseBoot">5.5 - Avoir plus d'informations pendant le démarrage</a></li>
<li><a href= "#config">5.6 - Utilisation de config(8) pour changer le binaire du noyau</a>
</ul>
</p>
<hr>
<br>

<p>
<a name= "Why"></a>
<a name= "5.1"></a>
<h2>5.1 - Pourquoi est-ce que j'ai besoin de faire un noyau sur mesure ?</h2>
</p>

<p>
Il y a plusieurs raisons, bien que cette pratique s'adresse avant tout
à des utilisateurs possédant une bonne compréhension du système 

<ul>
    <li>Votre ordinateur n'a que peu de RAM et vous voulez en
    préserver le plus possible en enlevant les pilotes de périphérique
    que vous n'utilisez pas. 
    <li>Enlever des options mises par défaut ou ajouter des options
    qui ne sont pas mises par défaut. 
    <li>Activer les options expérimentales.
    
</ul>
</p>
<p>
La plupart du temps, vous n'aurez PAS besoin de compiler votre propre
noyau. Le noyau GENERIC sera largement suffisant. En fait, plusieurs
raisons font que vous ne voudrez pas créer votre propre noyau. La
raison principale est qu'il facile de faire des 
changements à la configuration du noyau qui paraissent logiques mais
qui ne fonctionnent pas. Si quelque chose ne fonctionne pas
correctement, essayer le noyau GENERIC avant d'envoyer un rapport de
bug. 
</p>

<p>
<a name= "Options"></a>
<a name= "5.2"></a>
<h2>5.2 - Options de configuration du noyau</h2>
</p>

<p>
Les options de configuration du noyau sont des options que vous
ajoutez à la configuration de votre noyau pour activer certaines
caractéristiques dans celui-ci. Ceci vous permet d'avoir exactement
le support que vous voulez sans vous encombrer des pilotes inutiles. Il y a
une multitude d'options qui vous permettront de personnaliser votre
noyau. Veuillez consulter la page du manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>
pour une liste complète des options. Vous pouvez aussi consulter les
fichiers d'exemples de configurations qui sont disponibles pour votre
architecture.  
</p>

<P>
Toutes les options du noyau n'ont pas été testées au point de vue
compatibilité avec les autres options. Ne pas activer une option du
noyau à moins d'avoir une bonne raison de le faire ! La configuration
noyau qui est la plus testée est GENERIC. Il s'agit généralement
d'une combinaison des options des fichiers
/usr/src/sys/arch/&lt;votre architecture&gt;/conf/GENERIC et
/usr/src/sys/conf/GENERIC. 
</P>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Fichiers de configuration du noyau Alpha</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Fichiers de configuration du noyau i386</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/">Fichiers de configuration du noyau mac68k</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/">Fichiers de configuration du noyau pmax</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Fichiers de configuration du noyau sparc</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Autres architectures</a></li>
</ul>
</p>

<p>
Si vous lisez attentivement ces fichiers vous verrez une ligne du
genre :<br>
<strong>include "../../../conf/GENERIC"</strong><br>
Cela signifie que l'on <i>fait</i> référence à un autre fichier de
configuration. Ce fichier comprend toutes les options qui ne sont pas
dépendantes de l'architecture. Donc quand vous créez votre fichier de
configuration, soyez sûr de regarder <a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a>
pour voir ce que vous voulez. Il y a des options qui sont INDISPENSABLES. 
</p>

<p>
Toutes les options ci-dessous doivent être placées dans le fichier de  configuration du noyau avec le format :<br>
<strong>option      OPTION</strong><br>
Par exemple, pour placer l'option de debug dans le noyau, il faut ajouter une ligne telle que :<br>
<strong>option	    DEBUG</strong><br>
Les options dans le noyau OpenBSD sont traduites en tant qu'options du
préprocesseur, donc une option telle que DEBUG compilerait les
sources avec l'option -DDEBUG. Ce qui est équivalent à placer un
#define DEBUG à travers les sources du noyau.
</p>

<p>
OpenBSD possède un grand nombre d'options de compatibilité qui
permettent d'utiliser les binaires d'autres systèmes
d'exploitation. Elles ne sont pas toutes disponibles sur toutes les
architectures, donc veuillez lire les pages du manuel correspondantes
pour voir ce qui supporté sur la vôtre. 
</p>
<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SVR4(8)</a> - Compatibilité avec les binaires SVR4.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_BSDOS(8)</a> - Compatibilité avec les binaires BSD/OS.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_LINUX(8)</a> - Compatibilité avec les binaires Linux.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SUNOS(8)</a> - Compatibilité avec les binaires SunOS.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_ULTRIX(8)</a> - Compatibilité avec les binaires ULTRIX.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_FREEBSD(8)</a> - Compatibilité avec les binaires FreeBSD.</li>
<li>COMPAT_HPUX - Compatibilité avec les binaires HP-UX. Disponible uniquement sur quelques architectures m68k.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_IBCS2(8)</a> - Compatibilité pour faire tourner des binaires ibcs2.</li>
<li>COMPAT_OSF1 - Fait tourner les binaires Digital Unix. Uniquement disponible sur la plate-forme Alpha.</li>
<li>COMPAT_43 - Compatibilité avec 4.3BSD. Utilisation déconseillée, mais c'est utilisé par notre port de Netscape</li>
<li>COMPAT_11 - Compatibilité avec NetBSD 1.1</li>
<li>COMPAT_NOMID - Compatibilité avec les exécutables a.out qui n'ont pas d'identifiant de machine (id).
</ul>
</p>

<p>
Il est toujours utile de pouvoir mettre au point les problèmes avec
votre noyau. Mais de nombreuses personnes choisissent de pas mettre
ces options dans leur noyau parce que celles-ci prennent une place
considérable. Elles sont pourtant très utiles quand un bug est
présent. Cela permettra aux développeurs de trouver la source de vos
problèmes plus rapidement. Voici une liste des options de "debugging"
qui peuvent être ajoutées à votre noyau. 
</p>

<p>
<ul>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html">DDB</a>
- Ceci va compiler le debugger du noyau. Il n'est pas disponible sur
toutes les plates-formes donc veuillez consulter le manuel avant de l'ajouter.</li>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html">KGDB</a>
- Compile un debugger distant pour le noyau en utilisant la
caractéristique `remote target' de gdb.</li> 
<li>makeoptions  DEBUG="-g" - Créé bsd.gdb avec bsd. C'est très
pratique pour debugger un crashdump avec gdb.</li> 
<li>DEBUG - Utilisée pour placer diverses options de debug dans le
noyau où les sources les ont définies.</li> 
<li>KTRACE - Place des balises pour utiliser le système de suivi des
appels systèmes. Cela permet aux utilisateurs d'utiliser <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html">ktrace(1)</a>.</li> 
<li>DIAGNOSTIC - Ajoute du code dans le noyau qui effectuera des
contrôles logiques internes.</li> 
<li>GPROF - Ajoute du code dans le noyau pour examiner son profil à
l'aide de <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html">kgmon(8)</a>.</li> 
<li>makeoptions PROF="-pg" - Le drapeau (flags) -pg permet de compiler
le noyau avec le support pour le profiling. L'option GPROF requiert
l'utilisation de cette option.</li> 
</ul>
</p>

<p>
<strong>Options des systèmes de fichiers.</strong>
<ul>
<li>FFS - Berkeley Fast Filesystem <strong>REMARQUE :</strong> Cette option est indispensable</li>
<li>EXT2FS - Second Extended File System, nécessaire pour lire une partition Linux.</li>
<li>MFS - Memory File System, permet de stocker les fichiers en mémoire swap.</li>
<li>NFS - Network File System, nécessaire pour utiliser NFS.</li>
<li>CD9660 - Il s'agit du système de fichiers iso9660 + rockridge. Nécessaire pour lire les CD.</li>
<li>MSDOSFS - Nécessaire pour lire les systèmes de fichiers MS-DOS
FAT. Supporte aussi les noms long de Windows 95 et les caractères
minuscules/majuscules.</li> 
<li>FDESC - Inclus le code pour un système de fichiers qui peut être monté sur /dev/fd</li>
<li>KERNFS - Inclus le code qui permet de monter un système de fichiers
particulier (habituellement sur /kern) dans lequel les fichiers
représentent certaines variables et certains paramètres du noyau.</li> 
<li>NULLFS - Code pour avoir un système de fichiers bouclé. <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html">mount_null(8)</a>
pour plus d'informations</li> 
<li>PROCFS - Inclus le code d'un système de fichiers particulier (habituellement sur /proc)</li>
<li>PORTAL - Inclus le système de fichiers portal (expérimental). Il
permet quelques petites astuces intéressantes telles que l'ouverture
d'une socket TCP par l'ouverture d'un fichier.</li> 
<li>UMAPFS - Inclus un système de fichiers bouclé dans lequel chaque
uid et gid peut-être redéfini. Cela peut-être pratique quand on monte
un système de fichiers étranger avec des uid et des gid différents de
ceux du système local (tel qu'un système de fichiers distant par
NFS).</li> 
<li>UNION - Inclus le code pour le système de fichiers union qui permet
aux répertoires d'être montés les un au dessus des autres de telle
façon que les deux systèmes de fichiers restent visibles. Ce code
n'est pas encore stable.</li> 
<li>XFS - Ajoute ce qu'il faut pour utiliser un système de fichiers
compatible avec le système de fichier AFS. Utilisé actuellement par le
code AFS/Arla.</li> 
<li>LFS - Système de fichiers pour journaux structurés.</li>
<li>FFS_SOFTUPDATES - Permet l'utilisation des softupdates. Pour plus
d'information sur les softupdates, veuillez lire la section <a
href="../faq14.html#SoftUpdates">FAQ Softupdates</a>.
<li>NFSSERVER - Permet d'inclure le code serveur de NFS dans le noyau.</li>
<li>NFSCLIENT - Permet d'inclure le code client de NFS dans le noyau.</li>
<li>FIFO - Support pour les FIFOs... RECOMMANDÉ.</li>
<li>NVNODE=entier - Où entier est la taille du cache utilisé par les routines de traduction "nom vers i-node (name-to-inode)" (tel que le cache namei(), bien que portant d'innombrables autres noms dans les sources du noyau).</li>
<li>EXT2FS_SYSTEM_FLAG - Cette fonction change le comportement des drapeaux (flags) APPEND et IMMUTABLE pour un fichier sur un système de fichiers EXT2FS. Veuillez consulter <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a> pour de plus amples détails.</li>
<li>QUOTA - Support des quotas. Pour plus d'informations sur les quotas,
	veuillez lire la <a href="../faq10.html#Quotas">FAQ 10, Quotas</a></li>
</ul>
</p>

<p>
<strong>Options diverses</strong>
<ul>
<li>PCIVERBOSE - Rend la procédure de démarrage plus verbeuse pour les périphériques PCI.</li>
<li>EISAVERBOSE - Rend la procédure de démarrage plus verbeuse pour les périphériques EISA.</li>
<li>PCMCIAVERBOSE - Rend la procédure de démarrage plus verbeuse pour les périphériques PCMCIA.</li>
<li>APERTURE - Fourni un support pour le framebuffer dans le noyau aux
processus utilisateur. Indispensable pour utiliser X.</li>
<li>XSERVER - Support pour le pilote de périphérique de la console X. Indispensable pour utiliser X.</li>
<li>LKM - Support pour les modules noyau. N'est pas disponible sur
toutes les architectures. Lire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html">lkm(4)</a>
pour plus d'informations.</li> 
<li>INSECURE - Code (sans possibilité de changement) le niveau de
sécurité du noyau à -1. Lire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a>
pour plus d'informations sur les niveaux de sécurité du noyau.</li> 
<li>RAM_DISK_HOOKS - Permet l'utilisation de fonctions dépendantes de
l'architecture quand le pilote ramdisk est configuré.</li> 
<li>RAM_DISK_IS_ROOT - Force le ramdisk à être root.</li>
<li>CCDNBUF=integer - Fixe le nombre de tampons mémoires utilisés par CCD(4). Le
défaut est 8. Pour plus d'informations sur CCD, veuillez lire la page du manuel
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html">CCD(4)</a>,
ou la <a href="../faq11.html#ccd">section optimisation des performances de la FAQ.</a></li>
<li>KMEMSTATS - Permet de garder des statistiques sur l'utilisation de
malloc(9). Si l'option DEBUG est utilisée, cette option est
automatiquement activée.</li> 
<li>BOOT_CONFIG - Active le support pour l'option de démarrage -c.</li>
</ul>
</p>

<p>
<strong>Options réseau</strong><br>
Veuillez aussi consulter la<a href="../faq6.html">FAQ réseau</a> ou la
<a href="../faq11.html#Network">FAQ Optimisation des performances réseau</a>. 
<ul>
<li>GATEWAY - Active IPFORWARDING et (sur la plupart des ports) accroît la taille de NMBCLUSTERS.</li>
<li>NMBCLUSTERS=entier - Contrôle la taille des clusters de mbuf. </li>
<li>IPFORWARDING - Active le routage IP. Avec cette option, la machine transmettra les paquets IP entre ses interfaces qui sont destinés à d'autres machines.</li>
<li>MROUTING - Inclus le support pour les routeurs multicast IP.</li>
<li>INET - Inclus le support pour la pile de protocoles TCP/IP. Cette option est indispensable</li>
<li>MCLSHIFT=valeur - Cette option est le logarithme binaire (base 2)
de la taille des mbuf clusters. Lire <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a>
pour plus d'informations sur cette option.</li> 
<li>NS - Inclus le support pour la pile de protocoles Xerox
XNS. Voir<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current">ns(4)</a></li> 
<li>ISO,TPIP - Inclus le support pour la pile de protocoles OSI. Voir
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html">iso(4)</a>
pour plus d'informations.</li> 
<li>EON - Inclus le support pour les tunnels OSI dans IP.</li>
<li>CCITT,LLC,HDLC - Inclus le support pour la pile de protocoles X.25.</li>
<li>IPX, IPXIP - Inclus le support pour le protocole IPX (Internetwork
Packet Exchange) principalement utilisé par Novell NetWare.</li> 
<li>NETATALK - Inclus le support pour la famille de protocoles
AppleTalk.</li> 
<li>TCP_COMPAT_42 - L'utilisation de cette option est particulièrement
déconseillée. Il s'agit de la compatibilité avec un bug de
4.2BSD. Dans 4.2BSD, les numéros de séquence étaient des entiers
signés de 32 bits. Les mises en oeuvre modernes utilisent des valeurs
non signées.</li> 
<li>TCP_NEWRENO - Active la phase de recouvrement rapide NewReno qui
permet à un segment perdu d'être récupéré par "round trip time".</li> 
<li>TCP_SACK - Active les acquittements sélectifs.</li>
<li>TCP_FACK - Active la transmission des acquittements permettant une
estimation plus précise des données en suspens durant la phase de
recouvrement rapide grâce à l'utilisation des informations SACK. Cette
option peut-être utilisée avec TCP_SACK.</li> 
<li>PPP_FILTER - Cette option active le filtrage avec <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html">pcap(3)</a>
sur les connexions ppp.</li> 
<li>PPP_BSDCOMP - compression PPP BSD.</li>
<li>PPP_DEFLATE - Utilisé en conjonction avec PPP_BSDCOMP.
<li>IPSEC - Cette option active le support du protocole de sécurité
IP. Voir <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a>
pour plus de détails. Cette option implique l'option KEY, qui fournit
le support pour PFKEYv2.</li>  
<li>ENCDEBUG - Cette option active la journalisation des informations
de debug au cas où IPSEC rencontrerait des erreurs.</li> 
</ul>
</p>

<p>
<strong>Options du sous-système SCSI</strong>
<ul>
<li>SCSITERSE - Messages d'erreurs SCSI.  Les informations de décodage ASC/ASCQ sont omises ce qui permet de sauver environ 8 octets.</li>
<li>SCSIDEBUG - Afficher des informations de debug pour le sous-système SCSI à la console.</li>
</ul>
</p>


<p> 
<a name= "Building"></a>
<a name= "5.3"></a>
<h2>5.3 - Construire votre propre noyau</h2>
</p>

<p>
Toutes les instructions pour créer votre noyau sur mesure sont dans la
page du manuel <a href=
"http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html"> 
afterboot(8)</a>.
</p>

<p>
Pour compiler votre noyau depuis le cdrom vous aurez tout d'abord
besoin d'avoir le code source. Vous aurez juste besoin des sources du
noyau pour pouvoir le compiler et celles-ci se trouvent sur le
CD. Voici comment copier les sources depuis le CD. Cet exemple suppose
que le CD1 est monté sur /mnt. 
</p>

<ul>
<pre>
# <strong>mkdir -p /usr/src/sys</strong>
# <strong>cd /mnt/sys</strong>
# <strong>tar cf - . | ( cd /usr/src/sys; tar xvf - )</strong>
</pre>
</ul>

<p>
Maintenant pour créer votre noyau sur mesure, la manière la plus
simple est de partir du noyau GENERIC. Il se trouve dans
<i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>, où ${arch} est votre
architecture. Il y a d'autres configurations en exemples dans le
répertoire. Voici deux exemples vous montrant comment compiler votre
noyau. Le premier exemple permet de compiler votre noyau avec des
sources en lecture seule. Le second correspond à des sources
accessibles en écriture.
</p>

<ul> 
<pre>
# <strong>cd /quelque_part</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/UN_FICHIER .</strong>
# <strong>vi UN_FICHIER</strong> (pour effectuer les changements voulus)
# <strong>config -s /usr/src/sys -b . UN_FICHIER</strong>
<ul>
# <strong>make depend</strong> 
<ul>
(L'étape précédente est nécessaire si vous avez fait des changements
[comme des mises à jours ou des correctifs] dans les sources du
noyau. Cette étape peut-être ignorée si vous suivez l'étape suivante)
</ul>
<font size="+1">
<b><i>OR</i></b>
</font>
# <strong>make clean</strong>
<ul>
(L'étape ci-dessus est nécessaire si vous avez fait des changements
dans la configuration de votre noyau et elle est aussi recommandée si
vous avez fait une mise à jour majeure des sources. Vous pouvez
l'ignorer dans les autres cas et juste faire `make depend')
</ul>
</ul>
# <strong>make</strong>
</pre>
</ul>

<p>
Pour compiler un noyau avec des sources accessibles en écriture il faut effectuer les actions suivantes :
</p>

<ul>
<pre>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi UN_FICHIER</strong> (pour effectuer les changements voulus)
# <strong>config UN_FICHIER</strong> (pour en savoir plus lisez : <a
href=
"http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html">config(8)</a>) 
# <strong>cd ../compile/UN_FICHIER</strong>
# <strong>make</strong> 
</pre>
</ul>

<p>
Où $ARCH est l'architecture que vous utilisez (par exemple i386). Vous
pouvez aussi faire un <strong>make depend</strong> pour créer les
dépendances pour la prochaine compilation de votre noyau. 
</p>

<p>
Déplacer votre noyau à sa place.
</p>

<ul>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/UN_FICHIER/bsd /bsd</strong>
</pre>
</ul>

<p>
Pour démarrer avec votre ancien noyau au démarrage, il suffit juste de faire ceci
</p>

<ul>
<pre>
boot> <strong>bsd.old</strong>
</pre>
</ul>

<p>
votre ancien noyau sera chargé à la place de /bsd.
</p>

<p>
Parfois quand vous installez un nouveau noyau, il vous faudra
installer de nouveaux blocs de démarrage. Pour ce faire, lisez <a
href="../faq14.html#InstBoot">FAQ 14, Installation des bootblocks</a>, qui
vous donnera toutes les informations sur le bootloader OpenBSD.
</p>

<p>
<a name="BootConfig"></a> 
<a name="5.4"></a> 
<h2>5.4 - Configuration au démarrage</h2>
</p>

<p>
Parfois lorsque vous démarrez votre système vous remarquerez que
votre noyau trouve vos périphériques mais à la mauvaise IRQ. Et
avez-vous immédiatement besoin de ce
périphérique. Sans recompiler votre noyau vous pouvez utiliser la
configuration au démarrage de celui-ci. Cela permettra de corriger
votre problème pour cette fois et uniquement pour cette fois. Si vous
redémarrez le système il faudra recommencer la procédure. Il s'agit
donc d'une méthode temporaire. Le problème devra être corrigé en
recompilant votre noyau. De plus votre noyau à besoin de
l'<strong>option BOOT_CONFIG</strong> dans la configuration du
noyau. Le noyau GENERIC possède cette option.  
</p>

<p>
Une grande partie de ce document peut-être trouvé dans la page du
manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html">boot_config(8)</a> 
</p>

Pour démarrer avec UKC (User Kernel Config), il faut spécifier l'option -c au démarrage.

<ul><pre>
boot> <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

<p>
Où n'importe quel autre noyau que vous voulez démarrer. L'invite de
commandes UKC apparaîtra. De là vous pourrez spécifier au noyau les
périphériques que vous désirez modifier, ceux que vous voulez activer
ou désactiver.
</p>

<p>
Voici un liste des commandes les plus utilisées dans UKC.
</p>

<CODE>
<p>
add <strong>device</strong> - Ajoute un périphérique en en copiant un autre
</p>

<p>
change <strong>devno | device </strong> - Modifie un ou plusieurs périphériques
</p>

<p>
disable <strong>devno | device </strong> - Désactive un ou plusieurs périphériques
</p>

<p>
enable <strong>devno | device </strong> - Active un ou plusieurs périphériques
</p>

<p>
find <strong>devno | device </strong> - Trouver un ou plusieurs périphériques
</p>

<p>
help - Rapide sommaire de ces commandes
</p>

<p>
list - Liste TOUS les périphériques connus
</p>

<p>
exit/quit - Continue le démarrage
</p>

<p>
show <strong>[attr [val]]</strong> - Montre les périphériques avec un attribut et une valeur spécifiée optionnelle
</p></CODE>

<p>
Une fois que votre périphérique est configuré, utilisez quit ou exit
pour continuer à démarrer. Après avoir fait ceci, vous devriez
corriger la configuration de votre noyau et en compiler un
nouveau. Voir <a href="faq5.html#Building">Construire votre propre
noyau</a> pour plus de renseignements. 
</p>

<p>
<a name="VerboseBoot"></a>
<a name="5.5"></a>
<h2>5.5 - Avoir plus d'informations pendant le démarrage</h2>
</p>

<p>
Obtenir plus d'informations pendant le démarrage peut-être très
pratique lorsque vous essayez de régler certains problèmes lors de
celui-ci. Si vous avez un problème et que vous aimeriez avoir plus
d'informations, redémarrez votre machine. Quand vous obtenez l'invite
&quot;boot>&quot; démarrez avec l'option -c. L'invite UKC> apparaîtra
et ensuite : 
</p>


<ul><pre>
UKC> <strong>verbose</strong>
autoconf verbose enabled
UKC> <strong>quit</strong>
</pre></ul>

<p>
Vous obtiendrez un démarrage extrêmement verbeux.
</p>

<p>
<a name="config"></a>
<a name="5.6"></a>
<h2>5.6 - Utilisation de config(8) pour changer le binaire du noyau</h2>
</p>

<p>
Avec la version 2.6 sont apparues les options <b>-e</b> et <b>-u</b>
dans <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>. 
Ces options peuvent être très utiles et vous évitent de perdre du
temps à recompiler votre noyau. Le drapeau (flag) <b>-e</b> vous
permet de rentrer en configuration UKC alors que le système
fonctionne. Les changements prendront effets au prochain
redémarrage. Le drapeau (flag) <b>-u</b> permet de voir si des
changements ont été effectués au noyau pendant le démarrage, signifiant que
vous avez utilisé <b>boot -c</b> lors de celui-ci. 
</p>

<p>
Les exemples suivants montrent la désactivation des périphériques ep*
dans le noyau. Pour plus de sécurité, il est préférable d'utiliser
l'option <b>-o</b> qui écrira les changements dans un fichier
spécifié. Par exemple <strong>config -e -o bsd.new /bsd</strong> écrira
les changements dans bsd.new. Les exemples n'utilisent pas l'option
<b>-o</b>, mais les changements sont ignorés et non écrit dans le
binaire du noyau. Pour plus d'informations sur les messages d'erreur
et d'avertissement, lire la page du manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>
</p>

<ul><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc> <strong>?</strong>
        help                            Command help list
        add     dev                     Add a device
        base    8|10|16                 Base on large numbers
        change  devno|dev               Change device
        disable attr val|devno|dev      Disable device
        enable  attr val|devno|dev      Enable device
        find    devno|dev               Find device
        list                            List configuration
        lines   count                   # of lines per page
        show    [attr [val]]            Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
ukc> <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
  1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
  2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
 10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|ncr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
 11 cd* at scsibus* target -1 lun -1
 12 ch* at scsibus* target -1 lun -1
 13 sd* at scsibus* target -1 lun -1
 14 st* at scsibus* target -1 lun -1
 15 ss* at scsibus* target -1 lun -1
 16 uk* at scsibus* target -1 lun -1
 17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
--- more ---   
[snip]
ukc> <strong>disable ep</strong>
 31 ep0 disabled
 32 ep* disabled
 33 ep* disabled
 87 ep0 disabled
 88 ep0 disabled
 89 ep* disabled
 90 ep* disabled
136 ep* disabled
ukc> <strong>quit</strong>
not forced
</pre></ul>

<p>
Dans l'exemple ci-dessus, tous les périphériques ep* sont enlevés du
noyau et ne seront donc pas testés. Dans certaines situations où vous
aurez effectué ces changements au démarrage avec UKC et <b>boot
-c</b>, il vous faudra les rendre définitifs. Pour ce faire, il faudra
utiliser l'option <b>-u</b>. Dans l'exemple suivant, l'ordinateur a
été démarré avec UKC et les périphériques wi(4) sont désactivés. Ètant
donné que les changements fait par boot -c ne sont pas permanents,
ceux-ci doivent être écrits sur le disque. Cet exemple montre comment
écrire les changements effectués par boot -c dans un nouveau binaire
noyau bsd.new.
</p>

<ul><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
151 wi* disabled
Enter 'help' for information
ukc> <strong>quit</strong>
</pre></ul>


<p>
<font color= "#0000e0">
<a href= "index.html">[Retour à l'Index principal]</a>
<a href= "faq4.html">[To Section 4.0 - Guide d'installation]</a>
<a href= "../faq6.html">[To Section 6.0 - Réseau]</a>
</font>
</p>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[retour]"></a> 
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq5.html,v 1.57 2002/03/20 03:54:33 nick Exp ]<br>
$Translation: faq5.html,v 1.14 2002/04/13 14:47:44 jbm Exp $
$OpenBSD: faq5.html,v 1.10 2002/04/13 19:49:59 jufi Exp $
</small>
</p>
</body>
</html>
