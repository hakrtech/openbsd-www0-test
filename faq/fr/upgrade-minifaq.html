<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>Mini-FAQ de mise à jour d'OpenBSD</title>
  </head>

  <body bgcolor="#FFFFFF" text="#000000" link="#23238E">

    <h1>MINI-FAQ: Mise à jour d'OpenBSD</h1>

    <h2>Dernière version d'OpenBSD - 3.6</h2>

    <br>
    
    <blockquote>
      <p>
      Cette Mini-FAQ essaie de résoudre les difficultés les plus
      courantes lors de la mise à jour entre deux versions d'OpenBSD ou
      bien d'une version vers <em>-current</em>. Même si le terme de
      <em>Mini</em> n'est plus vraiment approprié, ce document garde le
      nom de Mini-FAQ pour des raisons historiques et/ou de cohérence.
      Des informations sur les anciennes versions se trouvent dans un
      <a href="../upgrade-old.html">document à part</a>.
      </p>

    </blockquote>

    <p>
    La Mini-FAQ de mise à jour est destinée aux <b>utilisateurs
    expérimentés</b>. Si vous êtes un débutant, ou bien si vous <b>ne
    maitrisez pas</b> les outils de compilation, alors la mise à jour
    via les sources <b>n'est pas pour vous</b>. Installez plutôt une
    version précompilée ou un "snapshot", puis suivez les instructions
    çi-dessous pour la mise à jour de <tt>/etc</tt>.
    <p>

    <h2>Questions générales concernant les mises à jour</h2>
    
    <p>
      <a href="#1.1">1.1: Terminologie. Qu'est-ce que <em>-current</em>?  Que sont les "Snapshots" ? Qu'est-ce que <em>-stable</em>?</a><br>
      
      <a href="#1.2">1.2: Comment faire, le plus simplement possible, une mise à jour ?</a><br>
      
      <a href="#1.3">1.3: Je n'ai trouvé aucun "snapshot" sur le site FTP. Où sont-ils ?</a><br>
      
      <a href="#1.4">1.4: Comment obtenir la dernière version des sources ?</a><br>
      
      <a href="#1.5">1.5: Maintenant que j'ai l'arborescence des sources, comment faire pour construire le système ?</a><br>
      
      <a href="#1.7">1.7: Si j'ai des erreurs lors de la compilation, qu'est-ce que je peux faire ?</a><br>
      
      <a href="#1.8">1.8: Y-a-t'il une méthode standard pour mettre à jour le compilateur <em>gcc</em> ?</a><br>
      
      <a href="#1.9">1.9: Quelle est la meilleure méthode pour mettre à jour <tt>/etc</tt> , <tt>/var</tt> , et <tt>/dev</tt> ?</a><br>
      
      <a href="#1.11">1.11: Est-ce que je dois être root pour faire un "<em>make build</em>" ?</a><br>
      
      <a href="#1.12">1.12: Pourquoi je ne vois pas de nouveaux périphériques ?</a><br>
      
      <a href="#1.13">1.13: Y-a-t'il une méthode simple pour mettre à jour l'arborescence des fichiers ?</a><br>

      <a href="#1.14">1.14: Après une mise à jour , <em>ps</em> retourne l'erreur suivante : "proc size mismatch."</a><br>

      <a href="#1.15">1.15: Comment passer au dernier "snapshot" ?</a><br> 

    </p>
    

    <h2>Passer de 3.6 à <i>-current</i></h2>
    <p>
      <a href="#3.6.1">3.6.1: Changement de la manière de gérer les
exceptions (amd64, cats, hppa, sgi, sparc64)</a><br>
      <a href="#3.6.2">3.6.2: Passage à gcc3 (macppc)</a><br>
      <a href="#3.6.3">3.6.3: Modification du comportement de bgpd</a><br>
      <a href="#3.6.4">3.6.4: Nouveaux compte et groupe _ftp</a><br>
      <a href="#3.6.5">3.6.5: Passage à gcc3 (i386)</a><br>
      <a href="#3.6.6">3.6.6: Nouveaux compte et groupe _ospfd</a><br>
      <a href="#3.6.7">3.6.7: pfsync utilise syncdev au lieu de syncif</a><br>
    </p>
    
    <h2>Passer de 3.5 à <i>3.6</i></h2>
    <p>
      <a href="#3.5.1">3.5.1: Modification des numéros mineurs des pty</a><br>
      <a href="#3.5.2">3.5.2: Nouveaux compte et groupe _dhcp</a><br>
      <a href="#3.5.3">3.5.3: Nouveaux compte et groupe _mopd</a><br>
      <a href="#3.5.4">3.5.4: Nouveaux compte et groupe _tftpd</a><br>
      <a href="#3.5.5">3.5.5: Nouveaux compte et groupe _rbootd</a><br>
      <a href="#3.5.6">3.5.6: cksum est maintenant sous /bin</a><br>
      <a href="#3.5.7">3.5.7: Nouveaux compte et groupe _afs</a><br>
      <a href="#3.5.8">3.5.8: Nouveaux compte et groupe _ppp</a><br>
      <a href="#3.5.9">3.5.9: Nouveaux compte et groupe _ntp</a><br>
      <a href="#3.5.10">3.5.10: Changement de version des bibliothèques</a><br>
      <a href="#3.5.11">3.5.11: Changement dans les ancres pf</a><br>
    </p>

    <h2>Passer de 3.4 à 3.5</h2>
    <p>
      <a href="#3.4.1">3.4.1: Modification des numéros mineurs des périphériques svnd</a><br>
      <a href="#3.4.2">3.4.2: Nouveaux compte et groupe _pflogd</a><br>
      <a href="#3.4.3">3.4.3: Clonage d'interfaces</a><br>
      <a href="#3.4.4">3.4.4: Nouveaux compte et groupe _bgpd</a><br>
      <a href="#3.4.5">3.4.5: Nouvelle version de  join(1)</a><br>
      <a href="#3.4.6">3.4.6: Changement dans la compilation de sudo</a><br>
      <a href="#3.4.7">3.4.7: Nouveaux compte et groupe _tcpdump</a><br>
      <a href="#3.4.8">3.4.8: Modification de machdep.c (i386)</a><br>
      <a href="#3.4.9">3.4.9: Mise-à-jour de  bsd.own.mk</a><br>
      <a href="#3.4.10">3.4.10: Passage à gcc3 (sparc64)</a><br>
    </p>
  
    <h2>Passer de 3.3 à 3.4</h2>

    <p>
      <a href="#3.3.1">3.3.1: Support de W^X sur plate-forme i386</a><br>
      <a href="#3.3.2">3.3.2: Modification de l'appel système mquery</a><br>
      <a href="#3.3.3">3.3.3: Evénement sur i386, modification d'exe addr/MAXDSIZ</a><br> <a href="#3.3.4">3.3.4: Suppression de l'authentification par Kerberos
      version IV</a><br>
      <a href="#3.3.5">3.3.5: Modification de config</a><br>
      <a href="#3.3.6">3.3.6: Utilisation de __attribute__((bounded)) dans certaines fonctions</a><br>
      <a href="#3.3.7">3.3.7: Nouveaux compte et groupe _syslogd</a><br>
      <a href="#3.3.8">3.3.8: Nouveau format de l'attribut __kprintf__ dans les fichiers en-tête du noyau</a><br>
    </p>
    
    <h2>Passer de 3.2 à 3.3</h2>
    
    <p>
      <a href="#3.2.1">3.2.1: Nouvelle version de Perl</a><br>
      <a href="#3.2.2">3.2.2: Nouveaux groupes _radius, _token and _shadow</a><br>
      <a href="#3.2.3">3.2.3: D'importantes modifications du compilateur</a><br>
      <a href="#3.2.4">3.2.4: Nouveaux compte et groupe _spamd</a><br>
      <a href="#3.2.5">3.2.5: Alias d'ipv6-icmp</a><br>
      <a href="#3.2.6">3.2.6: Nouveau groupe _lkm</a><br>
      <a href="#3.2.7">3.2.7: Nouvelle version de libpthread</a><br>
      <a href="#3.2.8">3.2.8: Modification du "linker" sur les architectures en format ELF</a><br>
      <a href="#3.2.9">3.2.9: Suppression de /var/at et modification de crontab</a><br>
    </p>

    <h2>Mise à jour des Versions Antérieures</h2>

    <p>
    Les informations pour passer d'OpenBSD 2.3 à 3.1 étant trop
    nombreuses, nous les avons déplacés dans un
    <a href="../upgrade-old.html">document à part</a>.
    </p>


    &nbsp;<hr width="30%">

    <a name="1.0"></a> 
    <h2>Questions générales concernant les mises à jour</h2>

    <a name="1.1"></a> 
    <h3>1.1: Terminologie. Qu'est-ce que <em>-current</em>? Que sont les
             "Snapshots" ? Qu'est-ce que <em>-stable</em>
             ?</h3>
    <p>
    Avant OpenBSD 2.7, le développement d'OpenBSD se faisait à partir
    d'une arborescence unique des sources. Depuis la version 2.7, une
    arborescence contenant les sources patchées d'une version est
    ajoutée.

    <p>
    A peu près tous les six mois, des "<em>releases</em>" d'OpenBSD sont
    produites. Elles sont numérotées de manière conventionnelle (2.X,
    3.X). La "release" actuelle d'OpenBSD est indiquée en tête de ce
    document.

    <p>
    "<em>-current</em>", version abrégée de "<em>openbsd-current</em>",
    se réfère à la version la plus à jour de l'arborescence des sources
    présente dans le dépot CVS. C'est à partir de cette arborescence que
    la plupart des développeurs d'OpenBSD travaillent. L'arboresence de
    <em>-current</em> contient tout le code qui est prévu pour la
    version suivante du système. De temps à autre, des intrépides vont
    quitter une version de série pour passer en openbsd-current,
    généralement pour profiter des dernières fonctions absentes des
    versions de série. Du fait de sa nature incertaine, le passage en
    <em>-current</em> n'est pas conseillé aux utilisateurs ne
    maîtrisant pas les techniques en oeuvre.

    <p>
    Entre deux versions officielles, une série de "<em>snapshots</em>"
    est mise
<a href="ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/">à disposition du public</a>.
    Un "snapshot" est une version de test des sources,
    extraite à un instant donné de la branche "<em>-current</em>".
    Provenant de la branche de développement, les "snapshots" ne
    garantissent aucunement un bon fonctionnement (voir même, ils
    peuvent ne pas fonctionner). Les "snapshots" sont très
    utiles si l'on souhaite passer d'une version officielle d'OpenBSD
    (ou d'une ancienne version de "-current") à la branche de
    développement. Si vous êtes sous <em>-current</em>, il est
    fortement recommandé de s'abonner à la 
    <a href="../../fr/mail.html">liste de discussion</a>
    <em>source-changes</em>. Les messages de validation CVS contiennent
    souvent des informations précieuses sur les dernières
    fonctionnalités géniales ajoutées au système.</p>

    <p>
    Depuis OpenBSD 2.7, une
    <a href=../../fr/stable.html>branche contenant les correctifs</a>
    (aussi appelée <em>-stable</em>) a été mise en place. Cette branche
    contient une version officielle à laquelle ont été ajoutés les
    correctifs importants (c'est-à-dire les correctifs d'erreurs, plus
    tous ceux simples et évidents qui n'ont pas pour autant une entrée
    dans la liste des erratas).

    <p>
    L'<a href="../../fr/stable.html">arborescence des ports</a> est une
    part intégrante du système. Vous devez mettre à jour l'arbre des
    ports en même temps que le reste du système, en suivant les mêmes
    règles que pour la mise à jour du système, c'est-à-dire que vous
    devez avoir l'arbre des ports sur -stable avec un système suivant
    -stable et suivre -current uniquement sur un système en version 
    -current.
    </p>

    <a name="1.2"></a>


    <h3>1.2: Comment faire, le plus simplement possible, une mise à jour
        ?</h3>
    
    <p>
    Du fait des changements dans les bibliothèques, une mise à jour via
    les sources du système est très difficile. <b>La meilleure méthode,
    et d'ailleurs la seule acceptée, pour passer vers <i>-current</i>
    est de passer en premier au
    <a href="#1.15">dernier "snapshot"</a>.</b>
    <b>La meilleure méthode, et d'ailleurs la seule acceptée, pour
    passer d'une version à une autre est d'installer les binaires de la
    dernière version.</b> Les instructions pour passer de la version 3.5
    à la version 3.6 se trouvent <a href="upgrade36.html">içi</a>.Une
    fois que le "snapshot", ou la release, sont installés, les sources peuvent
    être <a href="#1.4">récupérées</a>, puis <a href="#1.5"> recompilées</a>
    bien que cela soit rarement nécessaire.
    Cette procèdure devrait éliminer tous les problèmes avec les
    bibliothèques ou les outils de compilation. Encore une fois, essayer
    de mettre à jour son système à partir des sources sans avoir, au
    préalable, installé un "snapshot" ou une version récente n'est pas
    <i>une méthode reconnue</i>.

    <a name="1.3"></a> 
    <h3>1.3:  Je n'ai trouvé aucun "snapshot" sur le site FTP. Où sont-
        ils ?</h3>

    <p>
    Les "snapshots" peuvent être supprimés lorsqu'ils sont trop anciens
    (ou bien plus vraiment valables). Si aucun "snapshot" n'est
    disponible, le mieux est de passer à la dernière version de série et
    de reconstruire l'ensemble, à partir des sources
    </p>
 
    <a name="1.4"></a> 
    <h3>1.4: Comment obtenir la dernière version des sources ?</h3>

    <p>
    Réponse courte :
    <a href="../../fr/anoncvs.html">http://www.openbsd.org/anoncvs.html</a>
    </p>

    <p>
    Par exemple. Pour récupérer l'arborescence entière via CVS: (en se
    servant du shell ksh. Pour les autres, remplacer <em>export</em> par
    <em>setenv</em>)
    </p>

<pre>
  # export CVSROOT=anoncvs@anoncvs.ca.openbsd.org:/cvs
  # export CVS_RSH=/usr/bin/ssh
  # cd /usr
  # cvs -q get -P src
</pre>

    <p>
    A noter que par cette méthode, on récupère -current. Vous ne voulez
    sûrement pas cela. Pour récupérer par exemple 3.6-stable, il faut
    lancer
    </p>

<pre>
  # cvs -q get -rOPENBSD_3_6 -P src
</pre>

    <a name="1.5"></a> 
    <h3>1.5: Maintenant que j'ai l'arborescence des sources, comment
        faire pour construire le système ?</h3>
    
    <p>
    Les instructions de base sont dans 
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/Makefile"><tt>/usr/src/Makefile</tt></a>.
    Ce paragraphe en est une version plus élaborée.
    </p>
    
    <ol>
      <li>
        <p>
        Supprimez les fichiers objet anciens puis recréez les liens symboliques:
        </p>

<pre>
  # rm -rf /usr/obj/*
  # cd /usr/src
  # make obj
</pre>

        <p>
        Si vous pensez faire régulièrement cette étape , vous trouverez
        peut-être plus rapide de placer /usr/obj sur sa propre partition
        et de lancer un <em>newfs</em> au lieu d'un <em>rm</em>. Je
        lance par exemple les instructions suivantes :
        </p>

<pre>
  # umount /usr/obj
  # newfs wd0h
  # mount /usr/obj
  # make obj
</pre>

        <p>
        Si vous avez un doute sur la présence de fichiers objets dans
        l'arborescence des sources, faites ceci :
        </p>

<pre>
  # cd /usr/src
  # find . -type l -name obj | xargs rm
  # make cleandir
  # rm -rf /usr/obj/*
  # make obj
</pre>

      </li>
      
      <li>
        <p>
        Appliquez les changements de configuration spécifique à la
        version du système. Par exemple, les utilisateurs de la version
        3.5 d'OpenBSD ont dû ajouter les compte et groupe <em>_dhcp</em>
        avant de passer aux versions 3.6 ou supérieures. Consultez la
        section spécifique à votre version dans la Mini-FAQ.
        </p>
      </li>
      
      <li>
        <p>
        Vérifiez que tous les répertoires nécessaires sont créés. C'est
        particulièrement important lors du changement de version, mais
        c'est aussi nécessaire dans d'autres cas. La façon la plus
        simple est la suivante :
        </p>

<pre>
  # cd /usr/src/etc &amp;&amp; env DESTDIR=/ make distrib-dirs
</pre>

      </li>

      <li>
        <p>
        Compilez un nouveau noyau.
        </p>
<pre>
  # cd /usr/src/sys/arch/`machine`/conf
</pre>

        <p>
        La plupart des utilisateurs emploient GENERIC:
        </p>
<pre>
  # config GENERIC
  # cd ../compile/GENERIC
</pre>

        <p>
        <strong>NOTE:</strong> Les plus masochistes parmi vous voudront
        sûrement compiler un noyau personnalisé. Dans ce cas, le mieux
        est de faire des ajustements à partir de GENERIC.
        Suivez la procédure suivante :
        </p>

<pre>
  # cp GENERIC MYKERNEL
  # vi MYKERNEL
  (modifiez MYKERNEL à votre convenance)
  # config MYKERNEL
  # cd ../compile/MYKERNEL
</pre>
Notez que dans ce cas, votre système ne sera plus supporté.

        <p>
        Dans tous les cas,
        </p>
<pre>
  # make clean &amp;&amp; make depend &amp;&amp; make
  (architecture arc uniquement) copiez bsd.ecoff sur votre partition FAT
  # cp /bsd /bsd.old &amp;&amp; cp bsd /bsd
  # chown root:wheel /bsd (si vous avez utilisé un autre compte
  utilisateur pour la compilation)
  (redémarrez)
</pre>
      </li>

      <li>
        <p>Compilez le reste du système.</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
        <p>
        Mettez à jour <tt>/etc</tt> et <tt>/dev/</tt> manuellement. Ils
        ne sont pas mis à jour automatiquement. Choisissez un répertoire
        avec assez de place pour contenir /, /dev, /var et /etc. Dans
        mon cas, j'utilise <em>/home/newroot</em>
        </p>
<pre>
  # mkdir /home/newroot          
  # export DESTDIR=/home/newroot
  # cd /usr/src/etc &amp;&amp; make distribution-etc-root-var
</pre>

        <p>
        Maintenant, comparez les fichiers sous /home/newroot avec leurs
        alter-egos déjà installés. Remplacez ou mettez à jour les
        fichiers quand c'est nécessaire.
        </p>

<pre>
  # rm -rf /home/newroot   (quand terminé)
</pre>
      </li>

      <li>
        <p>
        Redémarrez afin de s'assurer que les nouveaux fichiers sous
        /etc/ sont valides.
        </p>
      </li>
    </ol>

    <a name="1.7"></a> 
    <h3>1.7: Si j'ai des erreurs lors de la compilation, qu'est-ce que
        je peux faire ?</h3>

    Voir <a href="#1.2">içi</a>.

    <a name="1.8"></a> 
    <h3>1.8: Y-a-t'il une méthode standard pour mettre à jour le
        compilateur <em>gcc</em> ?</h3>

    Vous devriez vraimment <a href="#1.2">installer le dernier "snapshot"</a>.

    <p>
    OpenBSD possède actuellement deux compilateurs dans l'arborescence
    des sources, gcc v2.95.3 qui est utilisé sur la plupart des plate-
    formes, mais aussi gcc v3.3.5 utilisé sur les quelques plate-formes
    qui se servent mieux de lui que de la v2.95.3.

    Les deux compilateurs sont à des endroits différents dans
    l'arborescence.:
       <ul>
       <li>gcc3: <tt>/usr/src/gnu/usr.bin/gcc</tt>
       <li>gcc2: <tt>/usr/src/gnu/egcs/gcc</tt>
       </ul>    

    Une partie des plate-formes passera à gcc3 dans le futur, mais
    d'autres ne feront sûrement jamais la transition, du fait d'un
    manque de support de celles-ci par gcc3.

    <p>
    Comme la mise à jour d'un compilateur est un peu comme le problème
    de l'oeuf et la poule, les changements sur les compilateurs propres
    aux sources nécessitent plus d'attention. Généralement, vous aurez à
    suivre la procédure suivante :
    </p>

    <p>
    (Et oui, vous le compilez bien deux fois)
    </p>

<pre>
  <b>Si votre plate-forme utilise gcc 2.95.3:</b>
    # rm -r /usr/obj/gnu/egcs/gcc/*
    # cd /usr/src/gnu/egcs/gcc
        <i>- ou -</i>
  <b>Si votre plate-forme utilise gcc 3.3.5:</b>
    # rm -r /usr/obj/gnu/usr.bin/gcc/*
    # cd /usr/src/gnu/usr.bin/gcc

  <b>Procédure commune à la compilation de la v3.3.5 ou de la
     v2.95.3</b>
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
</pre>

    <p>
    Maintenant, vous pouvez lancer un <em>make build</em> normal.
    </p>


    <a name="1.9"></a> 
    <h3>1.9: Quelle est la meilleure méthode pour mettre à jour
        <tt>/etc</tt> , <tt>/var</tt> , et <tt>/dev</tt> ?</h3>
    
    <p>
    <strong>Réponse courte</strong> : A la main.
    </p>
    
    <p>
    <strong>Réponse longue</strong> :
    </p>

    <p>
    Il existe une règle indiquant que les logiciels dans l'arborescence
    d'OpenBSD ne modifient pas automatiquement les fichiers dans
    <tt>/etc</tt>. Cela implique que c'est <em>toujours</em> à
    l'administrateur d'y appporter les modifications nécessaires. Les
    mise à jour n'y font pas exception. Pour mettre à jour les fichiers
    dans ces répertoires, il faut, en premier, déterminer ce qui a
    changé dans les fichiers de base (appartenant à la distribution),
    puis, réappliquer, à la main ces évolutions.
    </p>

    <p>
    Par exemple, pour voir les fichiers dans l'arborescences qui ont
    évolués le plus récemment, tapez :
    </p>

<pre>
  # cd /usr/src/etc
  # ls -lt |more
</pre>

    <p>
    Pour voir toutes les modifications sous <tt>/etc</tt> entre deux
    versions quelconque d'OpenBSD, vous pouvez utiliser
    <a href="../../fr/anoncvs.html">CVS</a>. Par exemple, pour voir les
    changements entre la version 3.5 et la 3.6, faites :
    </p>

<pre>
  # cd /usr/src/etc
  # cvs diff -u -rOPENBSD_3_5 -rOPENBSD_3_6
</pre>

    <p>
    Une fois que toutes les modifications ont été identifiées, 
    réappliquez-les à votre arborescence locale, en gardant toutes les
    configurations que vous avez déjà effectuées.
    </p>

    <p>
    Les modifications les plus courantes qui sont apportées à
    <tt>/etc</tt> entre deux versions sont :
    <p>

    <ul>
      <li>Ajout d'entrée à <tt>/etc/protocols</tt> et
          <tt>/etc/services</tt></li>
      <li>De nouveaux sysctls. (voir <tt>/etc/sysctl.conf</tt>)</li>
      <li>Des changements dans les travaux programmés par défaut (cron).
          Voir <tt>/etc/daily</tt>, <tt>/etc/weekly</tt>,
          <tt>/etc/monthly</tt>, et <tt>/etc/security</tt></li>
      <li>Les scripts rc, y compris netstart</li>
      <li>Les modifications des périphériques. voir
          <a href="#1.12">1.12</a></li>
      <li>Les évolutions dans l'arborescence des fichiers dans
          <tt>/etc/mtree</tt>. Voir <a href="#1.13">1.13</a></li>
      <li>De nouveaux comptes utilisateurs (<tt>/etc/passwd</tt>) et
          groupes (<tt>/etc/group</tt>)</li>
    </ul>

    <a name="1.11"></a> 
    <h3>1.11: Est-ce que je dois être root pour faire un "<em>make
        build</em>" ?</h3>

    Oui.

    <a name="1.12"></a> 
    <h3>1.12: Pourquoi je ne vois pas de nouveaux périphériques ?</h3>
    
    <p>
    Le script <tt>/dev/MAKEDEV</tt> n'est pas automatiquement mis à jour
    lors de la procédure du <em>make build</em>. Généralement, c'est une
    bonne idée de le copier, puis d'exécuter ce script dans
    l'arborescence des sources lors de la mise à jour.
    </p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <a name="1.13"></a> 
    <h3>1.13: Y-a-t'il une méthode simple pour mettre à jour
        l'arborescence des fichiers ?</h3>

    <p>
    De temps à autre des fichiers ou des répertoires sont ajoutés ou
    supprimés de la structure du système de fichiers. Les informations
    de propriété peuvent aussi subir des modifications sur des portions
    du système de fichiers. Une méthode simple pour s'assurer que
    l'arborescence des fichiers est à jour est d'utiliser la commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
    mtree(8)</a>.
    </p>

    <p>
    Tout d'abord, récuperez la dernière version des sources, puis tapez
    les commandes suivantes :
    </p>
    
<pre>
  # cd /usr/src/etc/mtree
  # install -c -o root -g wheel -m 600 special /etc/mtree
  # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre>

    <p>
    Votre système de fichiers devrait maintenant être à jour.
</p>

    <a name="1.14"></a> 
    <h3>1.14:  Après une mise à jour , <em>ps</em> retourne l'erreur
        suivante : "proc size mismatch."</h3>

    <p>
    Le noyau et les binaires utilisateurs sont désynchronisés. Ils
    doivent tous deux être compilés à partir de la même version des
    sources, car il existe des dépendances entre eux. Recompilez votre
    noyau et ses binaires utilisateurs à partir des mêmes sources pour
    corriger le problème.
    </p>

    <p>
    Maintenant que vous avez déjà commis une erreur, c'est le moment
    idéal pour relire ce document dans son ensemble et repèrer tout ce
    que vous avez manqué.
    Porter attention au conseil suivant: <a href="#1.15">installer un "snapshot"</a>.
    </p>


    <a name="1.15"></a>
    <h3>1.15: Comment passer au dernier "snapshot" ?</h3>

    <p>
    Installer un "snapshot" est la meilleure manière rester à jour. Nous
    souhaitons que vous testiez des "snapshots", afin de s'assurer que
    la prochaine version sera de qualité supérieure. Et c'est nettement
    moins difficile que de reconstruire le système à partir des sources.
    </p>

    <p>
    La méthode la plus simple pour tourner sous <em>-current</em> est de
    récupérer une image du "snapshot" amorçable et de la préparer comme
    décris dans la <a href="../faq4.html">FAQ</a>. Une fois démarré, vous
    choisissez (U)pgrade et suivez les instructions.
    </p>
    Utilisez un média amorçable d'une <i>version donnée</i> n'est PAS recommandé
    pour installer un "snapshot", utilisez un média de boot qui correspond
    à la version que vous installez.

    <p>
    Il y a plusieurs manières pour démarrer le programme de mise à jour.
    En général, la méthode la plus simple est de démarrer à partir d'une
    disquette ou d'un lecteur de CD-ROM, ou bien de placer un
    <a href="../faq4.html#bsd.rd">bsd.rd</a> de -current dans votre / et
    de booter à partir de lui à la place de <tt>/bsd</tt>. Les autres
    options sont de démarrer à partir du réseau ou d'une bande. Toutes
    les méthodes ne sont pas valables pour toutes les architectures, 
    réferez-vous aux instructions d'installation pour plus de
    renseignements.
    </p>

    <p>
    Alors que les mise à jour in-situ fonctionnent parfois, elles ne
    sont pas recommandées. La seule méthode sûre de mise à jour est de
    démarrer à partir d'un média d'installation / mise à jour comme
    décrit ci-dessus
    </p>

    <p>
    Dans tous les cas, vous devez mettre à jour manuellement
    <a href="#1.9">/etc, /var et /dev</a>.
    </p>

    <a name="3.6"></a>
    <h2>
      Passer de 3.6 à <i>-current</i>
    </h2>

    <a name="3.6.1"></a>
    <h3>
      3.6.1: Changement de la manière de gérer les
exceptions (amd64, cats, hppa, sgi, sparc64) (2004/10/27)
    </h3>
    <p>
      Des modifications ont été apportées à gcc3 afin de permettre
      l'utilisation de la gestion des exceptions basée sur DWARF sous
      OpenBSD. Vu que ces modifications dépendent d'un certain nombre de
      modifications relativement récentes apportées à libc, les étapes
      suivantes doivent être suivies afin de construire un système
      utilisable.
      <ul>
          <li>Mettez à jour votre réceptacle de code source
          <li>Construisez un nouveau noyau
	  <li>Installez-le et redémarrez
	  <li>Installez les nouveaux fichiers d'en-tête :
<pre>
     # cd /usr/src && make obj && make cleandir && make includes
</pre>
	  <li>Construisez et installez une nouvelle version de libc :
<pre>
     # cd /usr/src/lib/libc && make depend && make && env NOMAN=1 make
install
</pre>
          <li><a href="#1.8">Construisez et installez gcc3</a>
          <li>Construisez et installez une nouvelle version de
              libstdc++:
<pre>
     # cd /usr/src/gnu/lib/libstdc++
     # make -f Makefile.bsd-wrapper cleandir
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
</pre>
          <li>Construisez et installez le système comme d'habitude :
<pre>
     # cd /usr/src && make build
</pre>
    </ul>
    <a name="3.6.2"></a>
    <h3>
     3.6.2: Passage à gcc3 (macppc) (2004/10/29)
    </h3>
    <p>
    OpenBSD/macppc a été converti à gcc3. Pour effectuer la mise à jour,

<pre>
    # rm -rf /usr/include/g++
</pre>
    Maintenant, <a href="#1.8">construisez gcc3</a>, (en utilisant le
    répertoire gcc3) puis construisez le noyau et le système comme 
    <a href="#1.5">d'habitude</a>.

    <a name="3.6.3"></a>
    <h3>
     3.6.3: modification du comportement de bgpd (2004/11/11)
    </h3>
    <p>
    La nouveau <em>rde route-age [evaluate|ignore]</em> a modifié le
    comportement de bgpd.

    Jusqu'ici, <em>evaluate</em> était la valeur par défaut. Désormais
    c'est <em>ignore</em> qui est la valeur par défaut. L'évaluation de
    l'âge d'une route n'est pas spécifiiée dans la RFC 1771 et se
    traduit par des décisions non déterministes au lieu de liens plus
    stables.

    <p>

     <a name="3.6.4"></a>
     <h3>3.6.4: Nouveaux compte et groupe _ftp (2004/11/24)</h3>
     Le serveur FTP est actuellement retravaillé afin d'utiliser la
     séparation des privilèges.
     Ainsi un nouveau compte et groupe _ftp sont nécessaires.
     Ajouter le compte et le groupe en exécutant

     <pre>
      useradd -u84 -g=uid -c"FTP Daemon" -d/var/empty -s/sbin/nologin _ftp
     </pre>
     en tant que root.

    <a name="3.6.5"></a>
    <h3>
     3.6.5: Passage à gcc3 (i386) (2004/12/30)
    </h3>
    <p>
    OpenBSD/i386 est passé sous gcc3.
    Pour effectuer la mise à jour,

<pre>
    # rm -rf /usr/include/g++
</pre>
    Maintenant, <a href="#1.8">compilez gcc3</a>, (en utilisant le
    répertoire gcc3) puis compilez le noyau et le système <a
    href="#1.5">comme d'habitude</a>.
    <p>

   <a name="3.6.6"></a>
   <h3>3.6.6: Nouveaux compte et groupe _ospfd (2005/01/18)</h3>
   Le futur serveur ospf a besoin de ses propres compte et groupe _ospfd.
   Ajouter le compte et le groupe en exécutant

   <pre>
    useradd -u85 -g=uid -c"OSPF Daemon" -d/var/empty -s/sbin/nologin _ospfd
   </pre>
   en tant que root.

   <a name="3.6.7"></a>   
   <h3>3.6.7: pfsync utilise syncdev au lieu de syncif</h3>
   Lorsque vous configurez le périphérique
   <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4">pfsync</a>
   , utilisez 'syncdev' au lieu du mot-clé déprécié 'syncif'.
 
   <p>

    <a name="3.5"></a>
    <h2>Passer de 3.5 à <i>3.6</i></h2>

    <a name="3.5.1"></a>
    <h3>3.5.1: Modification des numéros mineurs des pty
        (2004/04/11)</h3>
    <p>
      Les numéros mineurs des
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pty&amp;sektion=4">pty</a>
      ont changé afin d'augmenter le nombre maximun de pseudo-terminaux
      de 256 à 992. Vous devrez donc exécuter le nouveau
      <tt>/dev/MAKEDEV</tt> avant de booter le nouveau noyau :
        <ul>
          <li>Mettez à jour vos sources
          <li>Compilez et installez un nouveau noyau
          <li>Compilez le reste du système (<em>make build</em>)
          <li>Copiez le nouveau script MAKEDEV dans le répertoire
              <tt>/dev</tt> et créez les nouveaux périphériques pty.

<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev && ./MAKEDEV pty0
</pre>
          <li>Bootez avec le nouveau noyau
          <li>Supprimez les anciennes entrées des ptys qui ne sont plus
              en utilisation :
<pre>
     # cd /dev && rm -f [pt]ty[rq]*
</pre>
          <li>Ou bien sur VAX:
<pre>
     # cd /dev && rm -f [pt]tyr*
</pre>
        </ul>

    <a name="3.5.2"></a>
    <h3>3.5.2: Nouveaux compte et groupe _dhcp (2004/04/12)</h3>
    <p>
    Les différents services liés à dhcp sont modifiés afin d'enlever les
    privilèges ou bien d'utiliser la séparation des privilèges. De ce
    fait, un nouveau compte et groupe sont nécessaires. Ajoutez le
    groupe en exécutant
<pre>
  # groupadd -g 77 _dhcp
</pre>
      en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _dhcp:*:77:77::0:0:DHCP programs:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.3"></a>
    <h3>
      3.5.3: Nouveaux compte et groupe _mopd (2004/04/14)
    </h3>
    <p>
    Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mopd&amp;sektion=8">mopd(8)</a>
    abandonne ses privilèges après initialisation, il nécessite donc un
    nouveau compte et groupe _mopd. Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 78 _mopd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _mopd:*:78:78::0:0:MOP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.4"></a>
    <h3>
      3.5.4: Nouveaux compte et groupe _tftpd (2004/04/17)
    </h3>
    <p>
    Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftpd&amp;sektion=8">tftpd(8)</a> 
    abandonne ses privilèges après initialisation à un nouveau compte et
    groupe _tftpd au lieu de nobody. Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 79 _tftpd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _tftpd:*:79:79::0:0:TFTP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.5"></a>
    <h3>3.5.5: Nouveaux compte et groupe _rbootd (2004/04/30)</h3>
    <p>
    Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rbootd&amp;sektion=8">rbootd(8)</a>
    abandonne ses privilèges après initialisation à un nouveau compte et
    groupe _rbootd. Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 80 _rbootd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _rbootd:*:80:80::0:0:rbootd Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.6"></a>
    <h3>3.5.6: cksum est maintenant sous /bin (2004/05/02)</h3>
    <p>
    La commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cksum&amp;sektion=1">cksum(1)</a>
    a été déplacée de <tt>/usr/bin</tt> vers <tt>/bin</tt>. Aprés avoir
    achevé le <em>make build</em>, tapez sous root :

<pre>
  # rm -f /usr/bin/cksum /usr/bin/sum
</pre>
    <p>

    <a name="3.5.7"></a>
    <h3>3.5.7: Nouveaux compte et groupe _afs (2004/05/06)</h3>
    <p>
    Bientôt, le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=afsd&amp;sektion=8">afsd(8)</a>
    va bientôt avoir ses priviléges séparés. Des nouveau compte et
    groupe _afs sont requis pour cela. Ajoutez le groupe en exécutant :
<pre>
  # groupadd -g 81 _afs
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _afs:*:81:81::0:0:afs Daemon:/var/empty:/sbin/nologin
</pre>
    <p>
    Vous devez changer le propriétaire du cache via :
<pre>
  # chown -R _afs:_afs /var/spool/afs
</pre>
    <p>

    <a name="3.5.8"></a>
    <h3>3.5.8: Nouveaux compte et groupe _ppp (2004/05/06)</h3>
    <p>
    Le programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8">pppoe(8)</a>
    abandonne maintenant ses privilèges en faveur d'un nouvel
    utilisateur _ppp. Ajoutez le groupe en exécutant :
<pre>
  # groupadd -g 82 _ppp
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _ppp:*:82:82::0:0:PPP utilities:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.9"></a>
    <h3>3.5.9: Nouveaux compte et groupe _ntp (2004/05/30)</h3>
    <p>
    Le futur programme
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd&amp;sektion=8">ntpd(8)</a>
    a besoin d'un nouvel utilisateur et groupe. Ajoutez le groupe en
    exécutant :
<pre>
  # groupadd -g 83 _ntp
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _ntp:*:83:83::0:0:NTP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.10"></a>
    <h3>3.5.10: Changement de version des bibliothèques (2004/07/13)</h3>
    <p>
    Des modifications dans les interfaces du sytème et les bibliothèques
    nécessitent un saut pour les numéros majeurs de version de chaque
    bibliothèque. Les étapes suivantes doivent être suivies pour
    compiler un système opérationnel.
         <ul>
          <li>Mettez à jour votre arborescence des sources
          <li>Compilez un nouveau noyau
          <li>Installez le nouveau noyau et redémarrez
          <li>Installez de nouveaux fichiers d'entêtes :
<pre>
     # cd /usr/src && make obj && make cleandir && make includes
</pre>
          <li>Compilez et installez une nouvelle version de la libc
<pre>
     # cd /usr/src/lib/libc && make depend && make && env NOMAN=1 make install
</pre>
          <li>Compilez et installez le système comme d'habitude
<pre>
     # cd /usr/src && make build
</pre>
         </ul>
    <p>

    <a name="3.5.11"></a>
    <h3>3.5.11: Changement dans les ancres pf (2004/08/07)</h3>
    <p>
    Les usagers d'authpf doivent changer leur ancre dans le groupe de
    règles principales de
<pre>
     anchor authpf
</pre>
        à
<pre>
     anchor "authpf/*"
</pre>
    <p>

    <a name="3.4"></a>
    <h2>Passer de 3.4 à 3.5</h2>

    <a name="3.4.1"></a>
    <h3>3.4.1:  Modification des numéros mineurs des périphériques svnd
        (2003/10/10)</h3>
    <p>
      Les numéros mineurs du périphérique
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=svnd&amp;sektion=4">svnd</a>
      ont changés. Vous devrez donc exécuter le nouveau
      <tt>/dev/MAKEDEV</tt> après avoir installé le nouveau noyau :
        <ul>
          <li>Mettez à jour votre arborescence des sources
          <li>Compilez un nouveau noyau
          <li>Copiez le nouveau script MAKEDEV dans le répertoire /dev,
              supprimez les périphériques svnd(4) et rsvnd déja
              existants, puis créez-en de nouveaux :
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev
     # rm svnd* rsvnd*
     # ./MAKEDEV vnd
</pre>
          <li>Continuez avec la compilation d'un système entier
        </ul>

      Cela affecte tous ceux qui utilisent les périphériques svnd, ce
      qui inclue ceux <tt>faisant des versions<tt>.
    <p>

    <a name="3.4.2"></a>
    <h3>3.4.2: Nouveaux compte et groupe _pflogd (2003/10/23)</h3>
    <p>
    Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8">pflogd(8)</a>
    s'exécute, dorénavant, en mode de séparation des privilèges et, pour
    cela, à besoin d'un nouvel utilisateur et groupe _pflod. Ajoutez le
    groupe en exécutant :
<pre>
  # groupadd -g 74 _pflogd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _pflogd:*:74:74::0:0:pflogd privsep:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.3"></a>
    <h3>3.4.3: Clonage d'interface (2003/12/07)</h3>
    <p>
    Plusieurs pseudo pilote réseaux (comme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo(4)</a>, et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun(4)</a>)
    supportent maintenant le clonage, c-à-d, la création ou la
    destruction dynamique des périphériques. Si vous utilisez ces
    interfaces, vous devez installer des nouvelles versions de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8">netstart(8)</a>
      avant de redémarrer avec un nouveau noyau.

    <p>
    En premier, compilez, puis installez un nouveau noyau comme
    d'habitude, puis

      <pre>
  # cd /usr/src && make includes
  # cd sbin/ifconfig
  # make obj depend
  # make
  # make install
  # cp /usr/src/etc/netstart /etc
      </pre>
      Maintenant, redémarrez votre machine et procédez à la compilation
      du reste de votre nouveau système.
    <p>

    <a name="3.4.4"></a>
    <h3>3.4.4: Nouveaux compte et groupe _bgpd (2003/12/17)</h3>
    <p>
    Le nouveau service
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgpd&amp;sektion=8">bgpd(8)</a>
    s'exécute en mode de séparation des privilèges et, pour cela, à
    besoin d'un nouvel utilisateur et groupe _bgpd. Ajoutez le groupe en
    exécutant :
<pre>
  # groupadd -g 75 _bgpd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>: <pre>
  _bgpd:*:75:75::0:0:BGP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.5"></a>
    <h3>3.4.5: Nouvelle version de  join(1) (2003/12/28)</h3>
    <p>
    La commmande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=join&amp;sektion=1">join(1)</a>
    est mise à jour pour suivre le standard POSIX lors de l'écriture de
    lignes n'ayant pas de champs communs. En conséquence de quoi,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=security&amp;sektion=8">security(8)</a>
    doit être mis à jour :
     <pre>
  # cp /usr/src/etc/security /etc
     </pre>
    <p>

    <a name="3.4.6"></a>
    <h3>3.4.6: Changement dans la compilation de sudo (2004/01/15)</h3>
    <p>
    La méthode de compilation de la commande 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
    est modifiée. Un effet de bord est que vous devez faire :
     <pre>
  # rm -f /usr/obj/usr.bin/sudo/*
     </pre>
    avant de pouvoir réussir un "make build". Si cela n'est pas fait, la
    compilation s'interrompra lors de la création des répertoires objs.
    <p>

    <a name="3.4.7"></a>
    <h3>3.4.7: Nouveaux compte et groupe _tcpdump (2004/01/19)</h3>
    <p>
    La commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8">tcpdump(8)</a>
    s'exécute, dorénavant, en mode de séparation des privilèges et a
    besoin, pour cela, d'un nouvel utilisateur et groupe _tcpdump.
    Ajoutez le groupe en exécutant :
<pre>
  # groupadd -g 76 _tcpdump
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _tcpdump:*:76:76::0:0:tcpdump:/var/empty:/sbin/nologin
</pre>

    <p>
    <a name="3.4.8"></a>
    <h3>3.4.8: Modification de machdep.c (i386) (2004/02/01)</h3>

    <p>
    Une modification dans <tt>machdep.c</tt> implique qu'une
    recompilation de binutils soit faite, avant de compiler un nouveau
    noyau. Cela concerne uniquement les plate-formes i386.


<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <p>
    Vous pouvez maintenant recompiler un noyau puis le reste du système
    comme expliqué dans la section <a href="#1.5">1.5</a>

    <p>
    <a name="3.4.9"></a>
    <h3>3.4.9: Mise-à-jour de bsd.own.mk (2004/02/20)</h3>

    <p>
    Vous devez mettre à jour <tt>/usr/share/mk/bsd.own.mk</tt> pour
    avoir la définition de USE_GCC3:

<pre>
    # cd /usr/src/share/mk
    # make install
</pre>

    <p>
    <a name="3.4.10"></a>
    <h3>3.4.10: Passage à gcc3 (sparc64) (2004/02/20)</h3>

    <p>
    OpenBSD/sparc64 est passé à gcc3. Pour mettre à jour,

<pre>
    # rm -rf /usr/include/g++
</pre>
    Maintenant, <a href="#1.8">compilez gcc3</a> (en vous servant du
    répertoire gcc3), puis compilez le noyau et le système, comme
    <a href="#1.5">d'habitude</a>.


    <a name="3.3"></a>
    <h2>Passer de 3.3 à 3.4</h2>
    
    <a name="3.3.1"></a>
    <h3>3.3.1: Support de W^X sur plate-forme i386 (2003/04/16)</h3>

    <p>
    Pour permettre le support de Writable xor eXecute (inscriptible ou-
    exclusif exécutable) sur i386, OpenBSD/i386 est passé du format
    d'exécutable a.out à ELF. La flexibilité de ELF permet un meilleur
    contrôle de l'agencement d'un exécutable et, donc, le support de
    W^X. La compatibilité avec a.out est uniquement disponible de
    manière limitée. Les binaires a.out statiques fonctionneront comme
    auparavant; les binaires a.out dynamiques, eux, NE SONT PAS
    SUPPORTÉS.
    </p>
    <p>
    LES MISES Á JOUR VIA LES SOURCES DE a.out -&gt; ELF NE SERONT PAS
    SUPPORTÉES. INSTALLEZ UN "SNAPSHOT";. Vous pourrez ensuite
    recompiler à partir des sources. C'est spécifique à la plate-forme
    i386, les autres architectures ne sont PAS impactées par cette
    modification.
    </p>

    <a name="3.3.2"></a>
    <h3>3.3.2: Modification de l'appel système mquery (2003/04/28)</h3>

    <p>
    Les paramètres de l'appel système mquery ont été modifiés pour
    s'accorder avec ceux de mmap(). Cela implique que le système soit
    mis à jour en suivant un ordre précis :

      <pre>
      1. Compilez et démarrez avec un nouveau noyau.
      2. (cd /usr/src && sudo make includes)
      3. (cd /usr/src/libexec/ld.so && make && sudo make install)
      4. 'make build'
      </pre>

      Seule la plate-forme i386 utilise mquery. En conséquence, les
      autres architectures n'ont pas besoin de suivre strictement cette
      séquence de compilation.

    <a name="3.3.3"></a>
    <h3>3.3.3: Evénement sur i386, modification d'exe addr/MAXDSIZ
        (2003/05/05)</h3>

    <p>
    Pour permettre à MAXDSIZ d'être ramené à 1G, l'adresse de base de
    tous les exécutables est déplacée de 0 à 0x1c000000. La combinaison
    de ces modifications nécessite une mise à jour via un "snapshot". La
    mise à jour à partir des sources n'est pas supportée. Cela ne
    concerne que la plate-forme i386.
    </p>
    
    <a name="3.3.4"></a>
    <h3>3.3.4: Suppression de l'authentification par Kerberos version IV
        (2003/05/13)</h3>

    <p>
    L'authentification à base de KerberosIV a été supprimée. En
    conséquence, vous devrez supprimer toute référence à <tt>krb4</tt>
    dans <tt>/etc/login.conf</tt>.
    </p>

    <a name="3.3.5"></a>
    <h3>3.3.5: Modification de <tt>config</tt> (2003/05/23)</h3>

    <p>
    Déplacer swapgeneric.c nécessitait un changement à 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.
    Avant de compiler un nouveau noyau, vous devrez d'abord compiler,
    puis installer un config(8) mis à jour :
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean
  # make obj
  # make
  # make install
</pre>
    Maintenant, vous pouvez lancer un "<tt>config</tt>" sur
    votre configuration de noyau et exécutez "<tt>make
    depend</tt>" dans votre répertoire de compilation du noyau
    comme détaillé <a href="#1.5">plus haut</a>.

   <a name="3.3.6"></a>
   <h3>3.3.6: Utilisation de __attribute__((bounded)) dans certaines
       fonctions (2003/06/26)</h3>
      
   <p>
   __attribute__((bounded)) est dorénavant utilisé pour détecter les
   arguments erronés des fonctions qui ont parmi leurs paramètres des
   longueurs de tampons. <br><br>Vous aurez à recompiler gcc en suivant
   les instructions de la section <a href="#1.8">1.8</a> de la Mini-FAQ
   avant de passer au <tt>make build</tt>.
   </p>

    <a name="3.3.7"></a>
    <h3>3.3.7: Nouveaux compte et groupe _syslogd (2003/07/31)</h3>
    <p>
    Le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8">syslogd(8)</a>
    s'exécute en mode de séparation des privilèges et, pour cela, à
    besoin d'un nouvel utilisateur et groupe _syslogd. Ajoutez le groupe
    en exécutant :
<pre>
  # groupadd -g 73 _syslogd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _syslogd:*:73:73::0:0:Syslog Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.3.8"></a>
    <h3>3.3.8: Nouveau format de l'attribut __kprintf__ dans les
        fichiers en-tête du noyau (2003/08/23)</h3>
    <p>
    Un nouvel attribut de format __kprintf__ est maintenant utilisé dans
    les fichiers d'en-têtes du noyau, ceci afin que gcc soit informé des
    extensions de format dans le
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=printf&amp;sektion=9">printf(9)</a>
    du noyau. 
    <br><br>Vous aurez à recompiler gcc en suivant les instructions de
    la section <a href="#1.8">1.8</a> de la Mini-FAQ avant de passer au
    <tt>make build</tt>. Vous n'aurez à recompiler gcc qu'une fois, à
    partir des sources de "current", pour avoir aussi le
    support de l'attribut __bounded__ décrit dans la section
    <a href="#3.3.6">3.3.6</a>.

    </p>

    <a name="3.2"></a>
    <h2>Passer de 3.2 à 3.3</h2>

    <a name="3.2.1"></a>
    <h3>3.2.1: Nouvelle version de Perl (2002/11/05)</h3>

    <p>
    Perl est passé à la version 5.8.0.<br>

    Dans Perl 5.8.0, l'API du module XS a évolué du fait d'un passage de
    stdio vers PerlIO (voir la page de manuel perldelta pour plus
    d'informations). Cela veut dire que tous les modules XS (fichiers
    perl .so) que vous avez installés <strong>doivent</strong> être
    recompilés. Si vous rencontrez une erreur comme <em>"Undefined
    symbol perl_get_sv"</em> c'est votre problème. Si les seuls modules
    que vous avez installés l'étaient par des paquets ou via le système
    des ports, vous pouvez vérifier la présence de modules XS dans votre
    système en exécutant :
      <pre>
        # grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
    Vous pouvez alors supprimer les modules incriminés avec
    <em>pkg_delete -f</em> et les recompiler/installer à partir de
    l'arbre des ports.

    <a name="3.2.2"></a>
    <h3>3.2.2: Nouveaux groupes _radius, _token and _shadow
        (2002/11/21)</h3>

    <p>
    Plusieurs nouveaux groupes ont été ajoutés :
      <ul>
      <li>Le groupe <em>_radius</em> contrôle l'accès en lecture seule
          au fichier <tt>/etc/raddb/servers</tt>.
      <li>Le groupe <em>_token</em> contrôle l'accès en lecture seule à
          la base des jetons utilisée par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a> et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>.   
      <li>Le groupe <em>_shadow</em> contrôle l'accès en lecture seule à
          la base des mots de passe shadow.
      </ul>

    Vous devrez ajouter ces groupes, puis ajuster les permissions de
    certains fichiers avant de passer au "make build". Grâce aux
    instructions suivantes, effectuées en tant que root, vous obtiendrez
    le résultat voulu :
        <pre>
          # groupadd -g 63 _radius
          # chgrp _radius /etc/raddb /etc/raddb/servers
          # chmod g+x /etc/raddb
          # chmod g+r /etc/raddb/servers

          # groupadd -g 64 _token
          # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
          # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

          # groupadd -g 65 _shadow
          # chgrp _shadow /etc/spwd.db
          # chmod 0640 /etc/spwd.db
        </pre>

    Ne soyez pas inquiété par les messages d'erreur signalants qu'un
    fichier n'est pas trouvé. Cela indique seulement que vous n'avez pas
    mis en place une authentification par <em>token</em> ou
    <em>radius</em>.

    <a name="3.2.3"></a>
    <h3>3.2.3: D'importantes modifications du compilateur
        (2002/12/02)</h3>
    <p>
    L'extension de protection de la pile
<a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a> a
    fusionnée dans 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1">
      gcc</a>.
    Cela implique un léger changement dans le scénario de mise à jour :
      <ul>
      <li><b>Ne</b> recompilez pas tout de suite un nouveau noyau.
      <li><b>Ne</b> recompilez pas tout de suite gcc.
      <li>Compilez, puis installez un nouveau chargeur dynamique ld.so,
          si votre système possède des bibliothèques partagées.
        <pre>
        # cd /usr/src
        # make obj
        Pour les plate-formes ELF (alpha, macppc, sparc, sparc64):
        # cd /usr/src/libexec/ld.so
        # make depend &amp;&amp; make &amp;&amp; make install
        Pour les plate-formes a.out (amiga, hp300, i386, mac68k, mvme68k):
        # cd /usr/src/gnu/usr.bin/ld/rtld
        # make depend &amp;&amp; make &amp;&amp; make install
        </pre>
      <li>Recompilez, puis installez une nouvelle libc, en suivant les
          premières instructions de <i>make build</i>.
        <pre>
        # cd /usr/src/include
        # make prereq &amp;&amp; make includes
        # cd /usr/src/lib/libc
        # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
        </pre>
          Notez que si votre compilateur est trop ancien, il ne sera pas
          capable de compiler la libc. Dans ce cas, vous devrez faire
          une mise à jour binaire à partir d'un "snapshot".
      <li>Recompilez et installez gcc comme indiqué en section
          <a href="#1.8">1.8</a>.
      <li>Vous pouvez maintenant recompiler un noyau. Soyez certain
          d'exécuter à nouveau
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config</a>
          pour régénérer le Makefile du noyau.
      <li>Redémarrez avec le nouveau noyau, et exécutez un <i>make
          build</i> pour bénéficier d'une protection de la pile.
      </ul>

    <a name="3.2.4"></a>
    <h3>3.2.4: Nouveaux compte et groupe _spamd (2002/12/24)</h3>
    <p>
    De nouveaux compte et groupe _spamd pour le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8">spamd(8)</a>
    ont été ajoutés. Ajoutez le groupe en exécutant :
<pre>
  # groupadd -g 62 _spamd
</pre>
    en tant que root, puis ajoutez le compte en vous servant de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>3.2.5: Alias d'ipv6-icmp (2002/12/30)</h3>

    <p>
    Un nouvel alias pour ipv6-icmp, <em>icmp6</em> , a été ajouté à
    <tt>/etc/protocols</tt>. Si vous souhaitez utiliser l'alias
    <em>icmp6</em> (utilisé dans les tests de régression de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>),
    vous devez modifier la ligne d'<em>ipv6-icmp</em> dans
    <tt>/etc/protocols</tt>,en ajoutant le mot clé <em>icmp6</em> avant
    le #. La ligne doit se présenter comme ceci :
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>3.2.6: Nouveau groupe _lkm (2003/01/05)</h3>

    <p>
    Le groupe <em>_lkm</em> contrôlant l'accés à <tt>/dev/lkm</tt>.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
    est dorénavant setgid _lkm.
    <p>
    Vous devrez ajouter ce groupe et ajuster les permissions de
    <tt>/dev/lkm</tt> avant de lancer un "make build". Grâce
    aux instructions suivantes, effectuées en tant que root, vous
    obtiendrez le résultat voulu :
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>3.2.7: Nouvelle version de libpthread (2003/01/14)</h3>

    <p>
    <em>libc_r</em> et <em>libnpthread</em> ont été supprimés et
    remplacés par <em>libpthread</em>. Les programmes se servant des
    "thread" doivent toujours être compilés avec l'option <em>-
    pthread</em>; le compilateur se charge de faire correctement le
    travail.

    <p>
    Avant de supprimer <em>libc_r</em> et <em>libnpthread</em>, les
    applications "threadées" doivent être recompilées en utilisant
    <em>libpthread</em>. La séquence recommandée pour recompiler est la
    suivante :

    <ol>
      <li>
        <p>compilez gcc en suivant les instructions de la section
        <a href="#1.8">1.8</a>.
      <li>
        <p>recompilez le système en suivant les instructions de la
           section <a href="#1.5">1.5</a>.
      <li>
        <p>recompilez tous les ports "threadés".
      <li>
        <p>supprimez les bibliothèques dorénavant inutiles :
<pre>
# rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>3.2.8: Modification du "linker" sur les architectures en format
        ELF (2003/01/17)</h3>

    <p>
    Binutils/ld ont été modifiés pour introduire une nouvelle
    fonctionnalité de sécurité aux exécutables ELF. Au lieu de permettre
    aux sections de données des exécutables et aux bibliothèques
    partagées d'être marquées exécutables par le chargeur, l'agencement
    a été changé pour ne marquer que les sections appropriées comme
    exécutable. Cette modification ne concerne que les architectures
    basées sur ELF: alpha, sparc, sparc64, macppc.
    <p>
    Il est recommandé de recompiler binutils avant le reste du système.
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
    Vous pouvez alors recompiler le système en suivant les instructions
    de la section <a href="#1.5">1.5</a>.

    <a name="3.2.9"></a>
    <h3>3.2.9: Suppression de /var/at et modification de crontab
        (2003/02/19)</h3>

    <p>
    Le contenu de <tt>/var/at</tt> a fusionné dans <tt>/var/cron</tt>
    maintenant que <em>at</em> a été intégré dans <em>cron</em>. De plus
    les fichiers d'autorisation et d'interdiction de <em>cron</em> ont
    été renommés en cron.allow et cron.deny pour être conformes avec
    POSIX et cohérents avec at.allow et at.deny.
    <p>
    Premièrement, recompilez le système en suivant les instructions de
    la section <a href="#1.5">1.5</a>. Puis, déplacez les fichiers
    existants et redémarrez cron comme indiqué:
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
    Ne pas tenir compte des alarmes concernant des fichiers
    d'autorisation ou d'interdiction absents. Tous ne font pas partis de
    l'installation par défaut.
    <p>
    Si vous n'avez pas déja un fichier cron.deny file (celui-ci n'était
    pas installé avant OpenBSD 3.3), vous devrez exécuter
    <em>crontab</em> avec un utilisateur autre que le super-utilisateur.
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>

    <hr>
<p>
<small>
<!--
Originally [OpenBSD: upgrade-minifaq.html,v 1.235 ]<br>
$Translation: upgrade-minifaq.html,v 1.27 2005/01/26 17:29:36 aanriot Exp $<br>
-->
$OpenBSD: upgrade-minifaq.html,v 1.14 2005/01/28 09:03:50 saad Exp $
</small><br>
Copyright &copy; 1998-2004, OpenBSD.<br>
Les remarques vis à vis de <i>ce document</i> peuvent être
envoyées à <a href="mailto:www@openbsd.org">www@openbsd.org</a>
(en langue anglaise).<br>
Les questions d'ordre général sur OpenBSD doivent être
dirigées vers la
<a href="../../fr/mail.html">liste de discussion</a> appropriée.

</body>
</html>
