<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>11 - O sistema X Window</title>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rev="made" href="mailto:www@openbsd.org">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1998-2009 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">

<a href="../../pt/index.html">
<img alt="[OpenBSD]" src="../../images/smalltitle.gif" border="0" height="30" width="141">
</a>
<p>
<font color="#0000e0">
<a href="index.html">[Índice da FAQ]</a>
<a href="faq10.html">[Seção 10 - Administração do Sistema]</a>
<a href="faq12.html">[Seção 12 - Questões Específicas de Hardware e Plataforma]</a>
</font>

<h1><font color="#e00000">11 - O sistema X Window</font></h1>
<hr>

<p>
<h3>Conteúdo</h3>
<ul>
<li><a href="#Intro">11.1 - Introdução ao X</a>
<li><a href="#ConfigX">11.2 - Configuração do X</a>
<li><a href="#amd64i386">11.3 - Configuração do X nas plataformas
    amd64 e i386</a>
<li><a href="#StartingX">11.4 - Inicialização do X</a>
<li><a href="#CustomizingX">11.5 - Personalização do X</a>
<!-- li><a href="#TuningRes">11.9 - Tuning your monitor resolution under
  X</a -->
</li>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>11.1 - Introdução ao X</h2>

O sistema X Window (algumas vezes chamado apenas de "X" e, outras,
chamado incorretamente de "X Windows") é o ambiente que fornece serviços
gráficos para o OpenBSD e outros sistemas baseados no Unix.
No entanto, sozinho o X fornece muito pouco: é preciso ter um
"Gerenciador de Janela" para apresentar uma interface de usuário.
A maior parte da "personalidade" que alguém sentirá do X será devido
ao gerenciador de janela, e não do próprio X.
O OpenBSD é distribuído com uma versão livre do gerenciador de janela
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fvwm&amp;sektion=1">fvwm(1)</a>,
mas você pode usar qualquer um dos outros gerenciadores de janela
que estão nos <a href="faq15.html">pacotes</a>.
Faça uma pesquisa usando "<tt>window manager</tt>" para obter uma lista
de vários gerenciadores de janela disponíveis.

<p>
O X é considerado um protocolo estruturado do tipo "cliente-servidor",
no entanto, a terminologia confunde algumas vezes.
O computador com os gráficos na tela é o "Servidor X".
A aplicação que ordena o que o servidor X deve colocar na tela é
chamada de "Cliente X", mesmo se esta é uma máquina potente em um
centro de dados.
Esse modelo pode ser usado para ter aplicações (clientes X) grandes,
que usam muito processamento, em execução em uma máquina muito potente,
e usar um Servidor X, em execução em uma máquina pequena e de baixa
potência, como sua interface.

<p>
É possível executar clientes X em um sistema sem nenhum suporte gráfico.
Por exemplo, é possível ter uma aplicação (o cliente X) sendo executada
em uma máquina mvme88k, e mostrar sua saída em uma tela gráfica de uma
máquina alpha (o servidor X).
O X é um protocolo bem definido e multiplataforma, sendo possível
ter uma aplicação X em execução (por exemplo) em uma máquina Solaris e
usar uma máquina OpenBSD para mostrar a saída.

<p>
O cliente e o servidor podem também estar em execução na mesma máquina,
e para a maior parte desta seção, isso será assumido.

<h3>11.1.1 - Preciso de um computador potente para executar o X?</h3>
O X é um programa grande, um computador rápido será o ideal se você está
usando-o regularmente.
No entanto, uma vez em execução, ele responde rapidamente mesmo em um
computador modesto.
Para ter um bom desempenho na resposta da tela, mesmo apenas para
texto, você irá querer executar o X.
Algumas plataformas, como a
<a href="../../sparc.html">sparc</a> e a
<a href="../../sparc64.html">sparc64</a>,
são pensadas para serem usadas com uma interface gráfica, e o
desempenho em um console de texto é muito pobre.

<p>
Dito isso, executar o X é geralmente para executar aplicações X.
Algumas aplicações X são leves, outras aparentemente pegam e usam
todo o processador e RAM que você tiver.
Normalmente, alguns usuários gostam de usar o X apenas para ter um
grande número de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xterm&amp;sektion=1">xterm(1)</a>s,
o que pode ser feito em hardware muito modesto.

<h3>11.1.2 - Posso ter algum tipo de gráfico sem o X?</h3>
Assumindo que você não aceitaria
<a href="http://en.wikipedia.org/wiki/ASCII_Art">gráficos ASCII</a>,
isso requer algum tipo de driver framebuffer para console.
Alguns sistemas operacionais fornecem isso, mas não existe, atualmente,
nenhum para o OpenBSD, e nem existe muito interesse dos desenvolvedores
por um.

<a name="ConfigX"></a>
<h2>11.2 - Configuração do X</h2>
A configuração do X varia consideravelmente de plataforma para
plataforma.
Em todos os casos, existem instruções e outras informações específicas
de plataforma no arquivo <tt>/usr/X11R6/README</tt>
(no sistema instalado).

<p>
Várias plataformas requerem o driver de abertura do X
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xf86&amp;sektion=4">xf86(4)</a>,
que fornece o acesso à memória e às portas de E/S da placa VGA e aos
registros de configuração requeridos pelos servidores X.
Esse driver precisa ser ativado antes de ser usado, o que pode ser feito
respondendo "yes" para esta questão durante a instalação:

<blockquote><pre>
Do you expect to run the X window System [no]
</pre></blockquote>

ou alterando o valor de <tt>machdep.allowaperture</tt> para um valor
não-nulo, apropriado para sua arquitetura, em <tt>/etc/sysctl.conf</tt>,
e reinicializando a máquina (por razões de segurança, esse valor do
sysctl não pode ser modificado após a inicialização estar completa).
Existem implicações de segurança nisso, então não faça isso se você
não precisa.


<h3>11.2.1 - alpha</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.alpha"
>/usr/X11R6/README</a> para alpha.

<p>
Defina <tt>machdep.allowaperture=1</tt> no <tt>/etc/sysctl.conf</tt>.

<p>
As placas TGA e algumas VGA são suportadas.
Nenhuma configuração, além dessa, deve ser necessária.

<h3>11.2.2 - amd64</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.amd64"
>/usr/X11R6/README</a> para amd64.

<p>
Defina <tt>machdep.allowaperture=2</tt> no <tt>/etc/sysctl.conf</tt>.

<p>
O X na arquitetura amd64 frequentemente configura-se corretamente de
forma automática, então nenhuma configuração é necessária em vários
casos. Se uma configuração adicional é necessária, use o processo
<a href="#amd64i386">X&nbsp;-configure</a>
<a href="#amd64i386example">abaixo</a>.

<h3>11.2.3 - armish</h3>
Sem servidores X, somente clientes X.

<h3>11.2.4 - hp300</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.hp300"
>/usr/X11R6/README</a> para hp300.

<h3>11.2.5 - hppa</h3>
Sem servidor X, somente clientes X.

<h3>11.2.6 - i386</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.i386"
>/usr/X11R6/README</a> para i386.

<p>
Defina <tt>machdep.allowaperture=2</tt> no <tt>/etc/sysctl.conf</tt>.

<p>
Devido à incrível variedade de placas de vídeo, mouses, teclados e
outros periféricos, configurar um sistema i386 para executar o X pode
ser excitante.
Excitante o bastante, que uma <a href="#amd64i386">seção separada</a> é
fornecida.

<p>
Felizmente, as coisas não são sempre tão ruins quanto aparentam --
em muitos casos, o X "Simplesmente Funciona" ao executar o "startx".
Nesses casos, seu hardware é detectado e consultado pelas suas
capacidades, e o X funciona muito bem.


<h3>11.2.7 - landisk</h3>
Sem servidores X, somente clientes X.

<h3>11.2.8 - luna88k</h3>
Sem servidores X, somente clientes X.

<h3>11.2.9 - mac68k</h3>
Sem servidores X, somente clientes X.

<h3>11.2.10 - macppc</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.macppc"
>/usr/X11R6/README</a> para macppc.

<p>
Defina <tt>machdep.allowaperture=2</tt> no <tt>/etc/sysctl.conf</tt>.

<p>
Sistemas Macintosh PPC suportados podem funcionar em um dos dois modos
diferentes: "acelerado" e "framebuffer" (não-acelerado).

<p>
No modo "framebuffer", o sistema funciona com 8 bits por pixel,
e a resolução do vídeo é controlada pelo ambiente Macintosh,
então você irá, provavelmente, querer manter uma pequena seção MacOS
no seu disco para ajustar essas configurações.
Esse modo tem a vantagem de "Simplesmente Funcionar", no entanto pode
ser frustrantemente inflexível (por exemplo, alterar a resolução requer
a inicialização do MacOS).

<p>
Se o seu Macintosh tem um sistema de vídeo da ATI, ele pode
ser executado usando um servidor X acelerado, o que gera um melhor
desempenho e mais controle no ambiente OpenBSD.
As placas de vídeo da NVIDIA, em alguns sistemas macppc, também
funcionam em muitos casos.
O arquivo README possui detalhes da configuração do driver acelerado,
comece usando o arquivo de exemplo de lá.

<p>
Embora o arquivo README forneça detalhes sobre o uso do mouse padrão de
um botão da Apple no X, a menos que você esteja usando um laptop, é
altamente recomendado que você compre de terceiros um mouse USB
moderno.


<h3>11.2.11 - mvme68k</h3>
Sem servidores X, somente clientes X.

<h3>11.2.12 - mvme88k</h3>
Sem servidores X, somente clientes X.

<h3>11.2.13 - sgi</h3>
O X funciona no framebuffer do sistema 02 em modo não-acelerado.

<h3>11.2.14 - sparc</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.sparc"
>/usr/X11R6/README</a> para sparc.

<p>
Com um único framebuffer suportado, não precisa de configuração.
Se você deseja usar uma configuração com múltiplos monitores,
veja o arquivo README acima para obter detalhes.

<p>
A resolução é controlada pelo firmware antes do OpenBSD ser
inicializado.

<h3>11.2.15 - sparc64</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.sparc64"
>/usr/X11R6/README</a> para sparc64.

<p>
Existe um certo número de variações dessas máquinas; você precisa
saber que tipo de barramento seu sistema possui (PCI ou SBus), em que
tipo de porta seu mouse está ligado (zstty, com, ou USB/PS2) e que tipo
de placa de vídeo você tem.
Comece com o arquivo <tt>xorg.conf</tt> de exemplo no arquivo
<tt>README</tt>, então modifique como indicado para seu hardware real
e suas necessidades.
<i>Não espere que o arquivo de exemplo funcione sem modificações na
sua máquina!</i>

<h3>11.2.16 - vax</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.vax"
>/usr/X11R6/README</a> para vax.

<p>
Atualmente, o servidor X só funciona em modelos VAXstation 4000,
com um framebuffer
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lcg&amp;sektion=4&amp;arch=vax">lcg(4)</a>
ou
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lcspx&amp;sektion=4&amp;arch=vax">lcspx(4)</a>.

<h3>11.2.17 - zaurus</h3>
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/xenocara/distrib/notes/README.zaurus"
>/usr/X11R6/README</a> para zaurus.

<p>
Nenhuma configuração é necessária, o X "Simplesmente Funciona".


<p>
<a name="amd64i386"></a>
<h2>11.3 - Configuração do X nas plataformas amd64 e i386</h2>
A grande variedade de opções de hardware nessas plataformas torna a
configuração do X um processo "trabalhoso".

<h3>11.3.1 - Configuração do X.Org</h3>
O X.Org tem feito um grande progresso para permitir que seus servidores
"Simplesmente Funcionem".
Em muitos casos, ele simplesmente funciona sem nenhum arquivo
<tt>/etc/X11/xorg.conf</tt>.
Mas nem sempre isso ocorre, e você precisa modificar alguma coisa que
não funciona.

<p>
Existem dois programas que podem ser usados para criar um arquivo de
configuração para os servidores X do X.Org para i386.
Infelizmente, nenhum deles garante a criação de um arquivo xorg.conf
utilizável.


<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=Xorg&amp;sektion=1">Xorg(1)</a>
    executado no modo "X -configure" carrega todos os drivers de
    vídeo disponíveis, detecta o hardware e, baseando-se no que
    encontrar, escreve um arquivo xorg.conf que pode ou não
    funcionar, mas mesmo se não funcionar, ele pode ser um bom ponto
    de partida para criar um manualmente.

<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorgconfig&amp;sektion=1">xorgconfig</a>
    é um outro que tenta criar interativamente um arquivo xorg.conf, em
    uma aplicação baseada puramente em texto.

</ul>

Em adição aos aplicativos acima, uma outra forma demorada de configurar
o X é usar sua ferramenta de busca preferida para procurar alguém que
já resolveu seu problema.
Enquanto isso não é uma má ideia, tal método não é tratado aqui.

<p>

<a name="amd64i386example"></a>
<h3>11.3.2 - Nossa máquina de exemplo</h3>
Como uma demonstração da configuração do X, nós usaremos um velho
sistema Celeron 400MHz, com um slot de vídeo AGP.
A placa de vídeo é uma velha placa AGP, mostrada no dmesg como:

<blockquote><pre>
vga1 at pci1 dev 0 function 0 "3DFX Interactive Banshee" rev 0x03
</pre></blockquote>

Essa é uma antiga placa de vídeo de alta capacidade, com 16M de RAM,
mas hoje não é suportada pelas versões modernas dos sistemas
operacionais "principais".
A tela ligada no sistema é um monitor CRT Sony Multiscan G400 19",
e seria legal usar uma resolução de 1280x1024, com uma frequência
de atualização decente e cores de 24 bits.

<p>
Em primeiro lugar, depois de instalar o OpenBSD com o X (e tendo
certeza que o driver de abertura está ativado no kernel), vamos ver
o que a detecção automática e a configuração do X.Org nos propõe; depois
de tudo nós podemos estar com sorte.
Então, simplesmente nos identificamos no sistema e usamos o comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=startx&amp;sektion=1">startx(1)</a>.
A tela fica vazia por alguns momentos, então nós obtemos o fundo de tela
em "tabuleiro de xadrez" do X, o cursor "X", e então uma janela xterm.

<p>
Funcionou!

<p>
Mais ou menos.
Embora o sistema esteja completamente funcional, ele aparentemente não
selecionou nenhuma das capacidades do monitor, e está funcionando
claramente em uma baixa resolução (640x480).
Esperamos conseguir algo melhor que isso.
Muito melhor, na verdade.
Isso significa que nós precisamos fazer nosso próprio arquivo xorg.conf.

<p>
Vamos usar o processo "X -configure" para gerar um arquivo
<tt>xorg.conf</tt> como ponto de partida.
Você precisa fazer isto como root:
<blockquote><pre>
# <b>X -configure</b>
 [...]
Your xorg.conf file is /root/xorg.conf.new

To test the server, run 'X -config /root/xorg.conf.new'
</pre></blockquote>

Pelo jeito, a mensagem é séria -- use o caminho completo para seu
arquivo <tt>xorg.conf.new</tt>, mesmo se ele está no seu diretório
padrão atual.
Ao falhar nessa parte, o resultado é que o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=X&amp;sektion=7">X(7)</a>
não encontra o arquivo, e ele silenciosamente usa a
configuração padrão, que não tem nada a ver com o arquivo que você
está trabalhando atualmente.
Isso previne você de ter que procurar o porquê de não funcionar.
Confie em nós sobre isso.

<p>
Vamos fazer o que ele diz, e vejamos o que acontece:
<blockquote><pre>
# <b>X -config /root/xorg.conf.new</b>
</pre></blockquote>

Agora, tudo que nós recebemos é uma tela preta.
As coisas começaram tão bem...

<p>
Esta pode ser uma boa hora para falar sobre as formas de
sair do X quando ele carrega desse modo.
Em ordem de preferência:
<ul>
<li><b>CTRL-ALT-Backspace</b>: Isso faz com que o X termine
    imediatamente, junto com todas as aplicações X que estão em
    execução. Normalmente, durante o processo de configuração, você não
    tem nenhuma aplicação em execução, então esse não é um problema (e,
    de fato, neste ponto, essa é a <i>melhor</i> forma de sair do X).
<li><b>Conecte-se através do SSH</b> e execute o comando
    "<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkill&amp;sektion=1">pkill</a>
    Xorg", que pode matar os processos X, e pode fazer com que retorne
    a um console utilizável.
<li><b>Conecte-se através do SSH</b> e reinicialize.
<li><b>Botão de alimentação.</b> Algumas vezes as coisas
    acontecem de modo realmente ruim.
    Sim, normalmente é bom conseguir executar o X antes que você
    carregue aplicações críticas no sistema.
    Algumas vezes, uma má configuração do X trava a máquina
    inteira em um ponto onde somente um desligamento manual resolve o
    problema.
</ul>

Felizmente, para nós, o CTRL-ALT-Backspace cumpriu sua tarefa aqui, e
retornamos ao prompt de comando.
Então agora nós precisamos ver se podemos descobrir o que está errado.
Em primeiro lugar, nós devemos olhar o que o Xorg está fazendo, e isso
é registrado no arquivo <tt>/var/log/Xorg.0.log</tt>.
Nesse caso, parece que o X acha que tudo está funcionando bem, não
existem erros significantes mostrados no registro (linhas que começam
com "<tt>(EE)</tt>" são erros).

<p>
Aqui é a parte onde saber sobre o seu hardware é útil.
Ao ligar este sistema em um monitor diferente, enquanto ele está
mostrando a tela em branco, faz com que a mensagem "Sync. Out of Range"
apareça na tela.
Então, aparentemente, a configuração do X que nos foi passada não
funciona neste monitor, e pode não funcionar em NENHUM monitor se o
modo de vídeo selecionado não for possível para esta placa em particular
(lembre-se que o X procura nos chips da placa o que eles são
potencialmente capazes de fazer, e não como o fabricante integrou todos
os elementos).
Monitores diferentes fazem coisas diferentes quando a atualização
está ruim; alguns tentam mostrar o que eles podem, outros entram em
modo de economia de energia, alguns produzem ruídos horríveis,
alguns mostram mensagens úteis na tela.
Este monitor parece não fazer coisa alguma.
Uma anotação é feita para NÃO usar este monitor em alguma configuração
inicial do X no futuro.

<p>
Olhando o arquivo xorg.conf.new gerado, nós vemos isto:
<blockquote><pre>
Section "Monitor"
        #DisplaySize      370   270     # mm
        Identifier   "Monitor0"
        VendorName   "SNY"
        ModelName    "SONY CPD-G400"
 ### Comment all HorizSync and VertSync values to use DDC:
        HorizSync    30.0 - 107.0
        VertRefresh  48.0 - 120.0
        Option      "DPMS"
EndSection
</pre></blockquote>

Como um teste, vamos tentar usar o DDC ("Data Display Channel", um modo
de fazer com que o monitor diga ao computador e à placa de vídeo quais
são suas capacidades), e ver o que acontece.
Desta vez, nós recebemos o padrão de rede X e um cursor se movendo,
que é tudo que esperamos quando executamos o X dessa forma (nós
encerramos o X usando a dica do CTRL-ALT-Backspace).
Ele está (novamente) em uma resolução baixa, mas está funcionando,
o que significa que certamente o problema é a resolução e a frequência
de atualização.
Nós restauramos as linhas "HorizSync" e "VertRefresh" aos valores
anteriores, como também verificamos as especificações do monitor
através de uma pesquisa na Internet.

<p>
Vamos tentar forçar o Xorg para uma resolução em particular, e ver se
temos alguma sorte.
Na parte <tt>Section "Screen"</tt> do arquivo xorg.conf, nós
adicionamos algumas linhas.
As linhas adicionadas são mostradas em negrito:

<blockquote><pre>
Section "Screen"
        Identifier "Screen0"
        Device     "Card0"
        Monitor    "Monitor0"
<b>        DefaultDepth   24</b>
        SubSection "Display"
                Viewport   0 0
                Depth     1
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     4
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     8
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     15
        EndSubSection
        SubSection "Display"
                Viewport   0 0 
                Depth     16
        EndSubSection
        SubSection "Display"
                Viewport   0 0
                Depth     24
<b>                Modes	"1280x1024"</b>
        EndSubSection
EndSection
</pre></blockquote>

Essas duas mudanças dizem ao X que queremos usar uma profundidade de
tela de 24 bits e, para essa profundidade, queremos a resolução
1280x1024.
Como nenhuma outra resolução está listada para o modo "Depth 24", o
sistema será forçado a utilizar aquela resolução.

<p>
Nós testamos as mudanças e... SUCESSO!
Nós obtemos o que aparenta ser uma tela em alta resolução.
Note que TUDO que você deve ver é um padrão de rede (chamado
"<a href="http://www.openbsd.org/cgi-bin/cvsweb/xenocara/data/bitmaps/root_weave">root
weave</a>", ele é muito bom para ver o quão bom seu monitor REALMENTE
é, e também é bom para calibrar telas LCD) e um cursor móvel.
Neste ponto, não precisa ser algo funcional.

<p>
Agora, instalamos o arquivo xorg.conf para vermos como ele se comporta
em um X funcionando de modo usável.

<blockquote><pre>
# cp xorg.conf.new /etc/X11/xorg.conf
</pre></blockquote>

Nós podemos agora tentar carregar o X usando o comando startx(1).
Funcionou!

<p>
Será, provavelmente, uma boa ideia verificar que estamos na resolução e
profundidade de cor desejada, e também que nós estamos em uma
frequência de atualização correta.
Nós podemos fazer isso com os comandos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xrandr&amp;sektion=1">xrandr(1)</a>
e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdpyinfo&amp;sektion=1">xdpyinfo(1)</a>.
Entre outras coisas, o xdpyinfo(1) nos informa:
<blockquote><pre>
    [...]
screen #0:
  print screen:    no
  dimensions:    1280x1024 pixels (433x347 millimeters)
  resolution:    75x75 dots per inch
  depths (7):    24, 1, 4, 8, 15, 16, 32
  root window id:    0x44
  depth of root window:    24 planes
    [...]
</pre></blockquote>

Sim, estamos com a resolução 1280x1024, com uma profundidade de 24
"planes" (bits).

<p>
xrandr(4) nos informa:
<blockquote><pre>
 SZ:    Pixels          Physical       Refresh
*0   1280 x 1024   ( 433mm x 347mm )  *85   75   60  
 1   1280 x 960    ( 433mm x 347mm )   85   60  
    [...]
</pre></blockquote>

que significa que estamos em uma frequência de atualização de
85Hz, que deve ser uma configuração confortável para a maioria dos
usuários.

<p>
<h3>11.3.3 - E se não for tão "fácil"?</h3>
Algumas vezes as coisas não funcionam sozinhas.
Estas são algumas dicas.

<ul>
<li>Leia a página de manual do servidor X que você está usando.
    No nosso exemplo, no arquivo <tt>/var/log/Xorg.0.log</tt>, nós
    podemos ver que o X está usando o TDFX como driver, e a página de
    manual deste é
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tdfx&amp;sektion=4">tdfx(4)</a>.
    Você irá encontrar com frequência dicas, limitações e opções para
    configurar sua placa de vídeo.
    Elas variam de driver para driver, então não assuma que você não
    precisa ler a página de manual do driver que está usando agora só
    porque já leu uma página diferente antes.

<li>Tente monitores diferentes.
    Como nós descobrimos no exemplo acima, diferentes monitores dão
    pistas diferentes sobre o que pode estar errado.

<li>Tente o driver
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vesa&amp;sektion=4">vesa(4)</a>
    do X.
    Essa é, definitivamente, por razões de desempenho, uma "última
    saída", mas ele funciona na maioria das placas de vídeo, incluindo
    aquelas que não funcionam com nenhum dos drivers "recomendados" do
    servidor X.

<li>Utilize outro hardware.
    Se você pode escolher a placa de vídeo, tente algumas outras.


</ul>

<a name="StartingX"></a>
<h2>11.4 - Inicialização do X</h2>
Existem dois modos comuns de executar o X:

<h3>11.4.1 - Por comando:</h3>
Inicie a sessão normalmente no console, então execute o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=startx&amp;sektion=1">startx(1)</a>.

<h3>11.4.2 - Inicializar diretamente no X:</h3>
Isso é feito usando o gerenciador de conexão gráfica
("X Display Manager")
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdm&amp;sektion=1">xdm(1)</a>.
Normalmente, o xdm(1) é iniciado pelo usuário root através do
<a href="faq10.html#rc">rc</a>, e apresenta um prompt de início de
sessão. Após uma autenticação correta, ele carrega uma sessão X para
aquele usuário.
Se, ou quando aquela sessão X deva ser, terminada (incluindo a
utilização do CTRL-ALT-Backspace), o xdm(1) retorna para a tela de
início de sessão.
Por essa razão, NÃO tente iniciar o xdm(1) a partir de
<tt>/etc/rc.conf.local</tt>, a menos que você verificou que o X funciona
como você deseja, ou sua máquina pode tornar-se muito difícil de
gerenciar!
(no pior dos casos: inicialize em modo usuário único, como se você
tivesse <a href="faq8.html#LostPW">perdido sua senha</a>, e altere a
linha xdm_flags em seu arquivo <tt>/etc/rc.conf.local</tt>.)

<p>
Em algumas plataformas, você precisa desativar o console
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=getty&amp;sektion=8">getty(8)</a>
para usar o xdm(1).


<a name="CustomizingX"></a>
<h2>11.5 - Personalização do X</h2>

<h3>11.5.1 - Introdução</h3>
O ambiente X padrão do OpenBSD é plenamente funcional, mas você pode
querer personalizá-lo.
Você pode querer mudar o padrão ou a cor de fundo, ou você pode querer
alterar o "Gerenciador de Janela" (o programa que mais define o seu
ambiente X), ou modificar os aplicativos que são carregados quando o
X inicia.

<p>
O gerenciador de janela padrão no OpenBSD é o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fvwm&amp;sektion=1">fvwm(1)</a>.
O Fvwm é um bom gerenciador de janela de propósitos gerais, mas ele não
é sua única escolha; ele não é o único gerenciador de janela incluído
no OpenBSD
(veja
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cwm&amp;sektion=1">cwm(1)</a>
e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=twm&amp;sektion=1">twm(1)</a>).
Uma grande quantidade de gerenciadores de janela também está
disponível através de
<a href="faq15.html">pacotes</a>.

<p>
Similarmente ao
<a href="faq10.html#rc">script de inicialização do sistema</a>,
o X possui um procedimento para configurar o ambiente do usuário.
Mais precisamente, ele possui mais de um procedimento, e isso depende
de como você <a href="#StartingX">inicia o X</a>.
Entender como o X inicia ajuda você a entender como personalizar o
seu ambiente de trabalho do jeito que você quer.

<p>
Note que você pode personalizar o ambiente tanto em nível de sistema
quanto de usuário.
É, provavelmente, melhor fazer mudanças a nível de usuário em vez de
alterar os padrões do sistema, já que os scripts do usuário são
guardados no diretório pessoal do usuário, e você terá menos arquivos
para instalar quando for atualizar a sua versão do OpenBSD.

As configurações do sistema estão em
<tt>/etc/X11</tt> e são inicialmente instaladas a partir do
<a href="faq4.html#FilesNeeded">xetcXX.tgz</a>, que não é reinstalado
pelo <a href="../upgrade46.html">processo de atualização de versão</a>;
então, se você fez mudanças a nível de sistema, elas vão persistir,
mas você pode precisar mesclar essas mudanças em futuras versões
daqueles arquivos.


<h3>11.5.2 - Inicialização do startx(1)</h3>
O startx(1) procura o arquivo <tt>.xinitrc</tt> no diretório pessoal do
usuário.
O <tt>.xinitrc</tt> é um script shell que pode carregar quantos
programas "clientes" X (aplicativos que usam o X) for necessário.
Quando o script termina a sua execução, o servidor X é encerrado.
Geralmente, a maioria dos programas executados por esse script devem
ser executados em segundo plano, e o último deve ser executado em
primeiro plano (tipicamente, o gerenciador de janela), e, quando este
termina, o script termina e o X é encerrado.

<p>
Em um caso simplificado, esse arquivo pode conter apenas o nome do
gerenciador de janela que você deseja executar:

<blockquote><pre>
cwm
</pre></blockquote>

Ou você pode conseguir algo mais enfeitado com:

<blockquote><pre>
xconsole -geometry -0+0 -fn 5x7 &
oclock -geometry 75x75-0-0 &
xsetroot -solid grey &
cwm
</pre></blockquote>

Isso carrega o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xconsole&amp;sektion=1">xconsole(1)</a>,
que fornece uma cópia de todo texto que o kernel envia para o
console (que agora está coberto pela tela gráfica), um relógio
analógico,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=oclock&amp;sektion=1">oclock(1)</a>,
e define o fundo para um fundo cinza sólido com o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xsetroot&amp;sektion=1">xsetroot(1)</a>,
tudo isso antes de executar o gerenciador de janela
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cwm&amp;sektion=1">cwm(1)</a>.
Note que somente o gerenciador de janela não é colocado em segundo
plano com o caractere "&amp;".
Isso significa que o X continua em execução até que o cwm(1) termine sua
execução.

<p>
Se o diretório pessoal do usuário não possui um arquivo
<tt>.xinitrc</tt>, o arquivo <tt>/etc/X11/xinit/xinitrc</tt> do
sistema é usado.
Esse arquivo pode fornecer algumas ideias adicionais para o seu
script .xinitrc.


<h3>11.5.3 - Inicialização do xdm(1)</h3>
O <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xdm&amp;sektion=1">xdm(1)</a>
normalmente é carregado pelos <a href="faq10.html#rc">scripts de
inicialização do sistema</a>, mas por propósitos de teste (recomendado,
a menos que você saiba que a sua configuração do X está correta!), ele
pode ser executado como root.

<p>
O xdm(1) possui muitas outras funcionalidades que não serão mostradas
aqui, mas para nossos propósitos, o xdm mostra ao usuário uma tela de
início de sessão, recebe o nome de usuário e senha, e então mostra ao
usuário o seu ambiente X.
Quando o X é encerrado, propositalmente ou acidentalmente, o xdm
é mostrado novamente. Esse é o motivo para se ter certeza de que o X
está configurado corretamente antes de usar o xdm(1) e, certamente,
antes de colocar o xdm(1) para carregar no momento da inicialização,
caso contrário, você pode ter alguma dificuldade para conseguir o
controle da sua máquina.

<p>
Quando o xdm(1) inicializa, ele executa o
<tt>/etc/X11/xdm/Xsession</tt>, que faz uma verificação para ver se o
usuário tem um arquivo <tt>.xsession</tt> em seu diretório pessoal.
Então, se você deseja mudar seu gerenciador de janela padrão,
simplesmente execute-o (junto com outras coisas) no <tt>.xsession</tt>.
Novamente, qualquer programa que você deseja que seja carregado com o
X (por exemplo, três xterm(1)s) pode ser colocado aqui, mas todos devem
executar em segundo plano, exceto o seu gerenciador de janela, que,
novamente, quando termina sua execução, sua sessão X é encerrada.
Nesse caso, o xdm(1) reinicia o X e mostra novamente a tela de início
de sessão.

<h3>11.5.4 - Como usar um gerenciador de janela diferente</h3>
Você pode executar um gerenciador de janela quando você
carrega o X, sem alterar nenhuma configuração padrão:

<blockquote><pre>
$ startx /usr/local/bin/fluxbox
</pre></blockquote>

Diversos gerenciadores de janela (incluindo o cwm(1) e o fvwm(1))
oferecem a capacidade de mudar o gerenciador de janela durante a
execução, sem ter que reinicializar o X ou qualquer um dos seus
aplicativos.
Seu novo gerenciador de janela substitui o antigo; terminar a execução
do gerenciador de janela recém-carregado encerra o X, e ele não mostra
o seu gerenciador de janela anterior.
O fvwm(1) permite que você carregue um gerenciador de janela diferente
clicando com o botão esquerdo no fundo da tela ("root window"),
escolhendo "(Re)Start", e então selecionando o seu gerenciador de
janela preferido (no entanto, note que você precisa adicionar seus
gerenciadores de janela alternativos no seu arquivo <tt>.fvwmrc</tt>
(a configuração a nível de sistema é
<tt>/usr/X11R6/lib/X11/fvwm/.fvwmrc</tt>)).
O cwm(1) permite que você execute outro gerenciador de janela usando
as teclas Ctrl-Alt-w, e então digitando o nome do gerenciador que
você deseja usar.

<p>
Após encontrar um gerenciador de janela que te agrade, você pode
defini-lo como o programa final a ser executado pelos scripts de
inicialização, como demonstrado acima.



<p>
<!-- a name= "TuningRes"></a>
<h2>11.9 - Tuning your monitor resolution under X</h2>

<i>Note: Most users do NOT need to worry about manually creating a 
ModeLine in modern versions of X.
HOWEVER, sometimes it is needed for unusual situations.</i>

<p>
Getting an X server working at an acceptable resolution with many multi-sync
monitors is possible.  If anyone has tried to do this with the standard
xorgconfig or XF86Setup utilities, they probably didn't get the best possible
results.  One of the more painful aspects is simply getting your monitor running
with your preferred resolution,
and then
getting the vertical scan rate set to at least 72-75 Hz,
a rate where the screen flicker is much less visible to humans.  
Conversely, what if you are trying to set the vertical scan rate so it is very low?
You can set it at 50 Hz so that it can be captured on to video without flicker,
but the methods to do this are non-obvious with the standard X tools and
documentation.

<p>
Finally, at the resolutions many people normally use with inexpensive VGA monitors
(800x600, 1024x768, 1152x900,
1280x1024), it is possible (at least on newer monitors) to use vertical scan rates of
85Hz and above, to achieve an extremely clean, palatable picture.
The X server has a mechanism which allows you to describe in detail the video
mode you want to use, this is the ModeLine.  A ModeLine has four sections, a single number for the pixel clock,
four numbers for horizontal timings, four numbers for vertical timings,
and an optional section with a list of flags specifying other characteristics
of the mode (such as Interlace, DoubleScan, and more... see the
xorg.conf(5) manual page for more ModeLine details).

<p>
Generating a ModeLine is a black art... Luckily, there are several scripts
which can do this for you.  One is <a href="http://koala.ilog.fr/cgi-bin/nph-colas-modelines">
Colas XFree86 ModeLine Generator</a>.  Another is
<a href="http://xtiming.sourceforge.net/">The XFree86 Modeline Generator</a>
hosted at SourceForge, and there are several others available on
<a href="http://freshmeat.net/search/?q=modeline">Freshmeat</a>.
Before you can use these ModeLine generators, you need to figure
out the vertical
and horizontal sync limits for your monitor.  This is often documented
in the manual, or on the manufacturer's web site.  If you can't find
either of those, simply search the web for the monitor make and model,
several people have been kind enough to compile lists with this information.

<p>
For example, say you have a Dell D1226H monitor.  You searched in agony
at Dell's web site to find that it has a 30-95 kHz horizontal scan range,
and a 50-160 Hz vertical scan range.  Visit the ModeLine generator page,
enter this information.  Next, you need to enter the minimum
vertical scan rate you want.  Any rate at or above 72 Hz should generally have low
visible flicker.  As you go higher, the clearer and crisper your screen
image becomes.  

<p>
With all of these bits of information, the script will generate a ModeLine
for every possible 4x3 resolution which your monitor can support, above
the minimum vertical scan rate which you enter.  If someone enters the Dell specs above
and a 75 Hz vertical scan minimum, the script gives out something like the
following:

<pre>
ModeLine "320x240" 20.07 320 336 416 448 240 242 254 280 #160Hz
ModeLine "328x246" 20.86 328 344 424 456 246 248 260 286 #160Hz
...
ModeLine "816x612" 107.39 816 856 1056 1136 612 614 626 652 #145Hz
ModeLine "824x618" 108.39 824 864 1064 1144 618 620 632 658 #144Hz
ModeLine "832x624" 109.38 832 872 1072 1152 624 626 638 664 #143Hz
...
ModeLine "840x630" 109.58 840 880 1080 1160 630 632 644 670 #141Hz
ModeLine "848x636" 110.54 848 888 1088 1168 636 638 650 676 #140Hz
...
ModeLine "1048x786" 136.02 1048 1096 1336 1432 786 788 800 826 #115Hz
ModeLine "1056x792" 136.58 1056 1104 1344 1440 792 794 806 832 #114Hz
ModeLine "1064x798" 137.11 1064 1112 1352 1448 798 800 812 838 #113Hz
...
ModeLine "1432x1074" 184.07 1432 1496 1816 1944 1074 1076 1088 1114 #85Hz
ModeLine "1576x1182" 199.86 1576 1648 2008 2152 1182 1184 1196 1222 #76Hz
ModeLine "1584x1188" 198.93 1584 1656 2016 2160 1188 1190 1202 1228 #75Hz
</pre>

<p>
Now, this monitor claims to do 1600x1200 @ 75 Hz, but the script does not
say this is within 75 Hz.  So, if you really want exactly 1600x1200, 
go down a notch with your minimum vertical rate... (Here, we go down
to 70 Hz)

<pre>
ModeLine "1592x1194" 197.97 1592 1664 2024 2168 1194 1196 1208 1234 #74Hz
ModeLine "1600x1200" 199.67 1600 1672 2032 2176 1200 1202 1214 1240 #74Hz
ModeLine "1608x1206" 198.65 1608 1680 2040 2184 1206 1208 1220 1246 #73Hz
ModeLine "1616x1212" 197.59 1616 1688 2048 2192 1212 1214 1226 1252 #72Hz
ModeLine "1624x1218" 199.26 1624 1696 2056 2200 1218 1220 1232 1258 #72Hz
ModeLine "1632x1224" 198.15 1632 1704 2064 2208 1224 1226 1238 1264 #71Hz
ModeLine "1640x1230" 199.81 1640 1712 2072 2216 1230 1232 1244 1270 #71Hz
ModeLine "1648x1236" 198.64 1648 1720 2080 2224 1236 1238 1250 1276 #70Hz
</pre>

<p>
Here, we see the monitor really does 1600x1200 @ 74 Hz when the dot clock
(bandwidth) is limited to 200MHz.  Set the bandwidth according to the
limits defined by the monitor.

<p>
Once you have your ModeLines, put them into your /etc/X11/xorg.conf file. 
Comment out the old ModeLines, so that you can use them again if the new ones
don't work.
Next, choose what resolution you actually want to run at.   First,
figure out if X is running in accelerated mode (which it does with most video
cards), so you know which <tt>"Screen"</tt> section of the xorg.conf to modify.
Or, just modify all of the Screen sections.

<pre>
Section "Screen"
   Driver          "Accel"
   Device          "Primary Card"
   Monitor         "Primary Monitor"
   DefaultColorDepth 32
   SubSection "Display"
      Depth        32
      Modes        "1280x1024" "1024x768"
   EndSubSection
</pre>

<p>
The first resolution you see after the "Modes" keyword is the resolution that
X is going to start in.  By pressing CTRL-ALT-KEYPAD MINUS, or CTRL-ALT-KEYPAD
PLUS, you can switch between any resolutions that you list here.  According
to the section above, X will try to start in 32-bit color mode (via
the DefaultColorDepth directive, without it X will start in 8-bit color mode.)
The first resolution it will try to use is 1280x1024 (it follows the order
of the Modes line.)  Note that "1280x1024" is just a label for the values in
the ModeLine.

<p>
Note that the ModeLine generator script has options to relax its timings for older
or smaller monitors, and also has the ability to provide ModeLines for
specific resolutions.  Depending on the type of hardware you have, it
may not be very easy to use with the default options.  If the picture is
too tall, too wide, or too small, or is shifted horizontally or vertically,
and the controls of the monitor aren't enough to correct its appearance,
one can use xvidtune(1) to adjust the ModeLine to better fit with the
monitor's timings.

<p>
On most modern monitors, there is no fixed limit on the bandwidth, thus
they are often not listed anymore in the specs. What happens is that the
more you go up in bandwidth, the fuzzier the screen image becomes.
So you may want to put in the bandwidth of your card (also named
"dotclock") to test (you cannot damage your monitor this way), and go
progressively down in bandwidth until you have a nice crisp image.

<p>
If this seems needlessly complex, that's because it is.  X.Org addresses
this, and makes this process much easier since it has several built-in
modes and is capable of reading back capabilities from "plug and play" monitors
through DDC and DDC2.

<p>
You can download the Colas XFree86 ModeLine Generator script at:
<a href="http://koala.ilog.fr/ftp/pub/Klone/">http://koala.ilog.fr/ftp/pub/Klone/</a>.
You need to grab the Klone interpreter, and compile it.  It is in the
ports as <tt>lang/klone</tt>.  The scripts
exist under the scripts directory in the Klone distribution.  (The
port installs them to /usr/local/lib/klone/scripts.)

<p>
There are two versions of the script included, the first is a CGI version identical
to the web page above.  The second is a non-CGI version
which will take your complete xorg.conf file, decode the monitor specs that
you entered into xorgconfig/XF86Setup (Now, think, did you actually
enter the specs for your monitor or just choose generic ones?),
and fix the existing ModeLines accordingly. 

<p -->
<font color= "#0000e0">
<a href= "index.html">[Índice da FAQ]</a>
<a href= "faq10.html">[Seção 10 - Administração do Sistema]</a>
<a href= "faq12.html">[Seção 12 - Questões Específicas de Hardware e Plataforma]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[voltar]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq11.html,v 1.81 ]<br>
$Translation: faq11.html,v 1.6 2009/10/21 19:25:52 alan Exp $<br>
-->
$OpenBSD: faq11.html,v 1.6 2009/10/26 20:27:01 ajacoutot Exp $
</small>
</body>
</html>
