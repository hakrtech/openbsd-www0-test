<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>5 - Construção do Sistema a partir do Código Fonte</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2010 by OpenBSD.">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<!-- Passes validator.w3.org.  Please keep it this way -->

<a href="../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[Índice da FAQ]</a>
<a href= "faq4.html">[Seção 4 - Guia de Instalação]</a>
<a href= "faq6.html">[Seção 6 - Redes]</a>
</font>

<h1><font color="#e00000">5 - Construção do Sistema a partir do Código Fonte</font></h1>
<hr>

<p>
<h3>Conteúdo</h3>
<ul>
<li><a href="#Flavors">5.1 - Os sabores ("Flavors") do OpenBSD</a>
<li><a href="#WhySrc">5.2 - Por que eu preciso compilar meu sistema a
    partir do código fonte?</a>
<li><a href="#Bld">5.3 - Compilação do OpenBSD a partir do código fonte</a>
<ul>
  <li><a href="#BldOverview">5.3.1 - Visão geral</a>
  <li><a href="#BldBinary">5.3.2 - Instalação ou atualização de versão
      para os binários mais recentes</a>
  <li><a href="#BldGetSrc">5.3.3 - Download do código fonte apropriado</a>
  <li><a href="#BldKernel">5.3.4 - Compilação do kernel</a>
  <li><a href="#BldUserland">5.3.5 - Compilação do espaço de usuário</a>
</ul>
<li><a href="#Release">5.4 - Compilação de uma release</a>
<li><a href="#Xbld">5.5 - Compilação do X</a>
<li><a href="#Why">5.6 - Por que eu preciso de um kernel personalizado?</a>
<li><a href="#Options">5.7 - Compilação de um kernel personalizado</a>
<li><a href="#BootConfig">5.8 - Configuração em tempo de inicialização</a>
<li><a href="#config">5.9 - Como usar o config(8) para alterar seu
    kernel</a>
<li><a href="#VerboseBoot">5.10 - Como obter mais mensagens durante a
    inicialização</a>
<li><a href="#buildprobs">5.11 - Problemas comuns, dicas e perguntas
    sobre compilação e construção</a>
    <ul>
    <li><a href="#sig11">5.11.1 - A compilação para com um erro
        "Signal 11"</a>
    <li><a href="#snake">5.11.2 - "make build" falha com a mensagem
        "cannot open output file snake: is a directory"</a>
    <li><a href="#ProbIPv6">5.11.3 - Meu sistema sem IPv6 não funciona!</a>
    <li><a href="#ProbObj">5.11.4 - Opa! Eu esqueci de criar o diretório
        <tt>/usr/obj</tt> antes de começar!</a>
    <li><a href="#ProbObjPt">5.11.5 - Coloque o diretório
        <tt>/usr/obj</tt> em sua própria partição</a>
    <li><a href="#ProbSKIPDIR">5.11.6 - Como não compilar partes da
        árvore?</a>
    <li><a href="#ProbMoreInfo">5.11.7 - Onde eu posso aprender mais
        sobre o processo de compilação?</a>
    <li><a href="#NoSnaps">5.11.8 - Eu não vejo nenhuma snapshot no
        sítio FTP. Para onde elas foram?</a>
    <li><a href="#NewCompiler">5.11.9 - Como iniciar uma nova versão
        do compilador (<i>gcc</i>)?</a>
    <li><a href="#UpdateEtc">5.11.10 - Qual é o melhor jeito de
        atualizar <tt>/etc</tt>, <tt>/var</tt> e <tt>/dev</tt>?</a>
    <li><a href="#Hierarchy">5.11.11 - Há algum jeito fácil de fazer
        todas as mudanças nos arquivos da hierarquia?</a>
    <li><a href="#ProbXComp">5.11.12 - Posso fazer compilação cruzada?
        Por que não?</a>
    </ul>
</ul>
<hr>
<br>


<a name="Flavors"></a>
<h2>5.1 - Os sabores ("Flavors") do OpenBSD</h2>
<!-- XXXversion - revise doodle -->
Existem três "sabores" do OpenBSD:
<ul>
<li><b>-release:</b> A versão do OpenBSD lançada a cada seis meses em
    CD.
<li><b>-stable:</b> "release", mais as correções consideradas críticas
    para a segurança e estabilidade.
<li><b>-current:</b> Onde o novo trabalho de desenvolvimento está sendo
    feito agora e, consequentemente, tornar-se-á a próxima "release".
</ul>

Graficamente, o desenvolvimento dessas versões se parece com isto:

<blockquote>
<pre>
       ,------o-----------o----X                    4.4 Stable
       |      .           .
       |      .    ,------o---------o----X          4.5 Stable
       |      .    |      .         .
       |      .    |      .    ,----o----------o--&gt; 4.6 Stable
       |      .    |      .    |    .          .
       |      .    |      .    |    .    ,-----o--&gt; 4.7 Stable
       |      .    |      .    |    .    |     .
       |      .    |      .    |    .    |     .
 --&gt;4.4Rel-----&gt;4.5Rel-----&gt;4.6Rel-----&gt;4.7Rel----&gt; Current

          Tempo ---&gt;
</pre>
</blockquote>

<p>
<i>-Current</i> é onde o trabalho de desenvolvimento ativo é feito e,
consequentemente, ela tornar-se-á a nova <i>-release</i> do OpenBSD.
A cada seis meses, quando uma nova versão do OpenBSD é lançada,
<i>-current</i> é marcada e torna-se <i>-release</i>: um ponto de
congelamento na história da árvore de código fonte.
Cada <i>-release</i> nunca é alterada; ela é a que está nos
<a href="../../orders.html">CDs</a> e
<a href="../../ftp.html">servidores FTP</a>.

<p>
<i>-Stable</i> é baseada na <i>-release</i>, e é um ramo do caminho de
desenvolvimento principal do OpenBSD.
Quando correções muito importantes são feitas na <i>-current</i>, elas
são portadas (integradas) para o ramo <i>-stable</i>; por causa disso,
<i>-stable</i> também é conhecida como o "<i>patch branch</i>"
(ramo corrigido).
Na ilustração acima, as linhas verticais pontilhadas marcam correções de
falhas incorporadas ao ramo <i>-stable</i>. Você também pode notar que
no exemplo acima, o ramo <i>4.4-stable</i> chega ao fim com
o <i>4.6-release</i>, e o ramo <i>4.5-stable</i> chega ao fim com
o <i>4.7-release</i> -- releases antigas são tipicamente suportadas
durante "duas releases" no máximo. Suportar versões antigas toma
recursos e tempo; enquanto nós gostamos de oferecer suporte a
releases antigas, nós preferencialmente nos focamos em novas
funcionalidades. O ramo <i>-stable</i> é, pelo seu projeto, muito fácil
de construir a partir da <i>-release</i> da mesma versão
(ou seja, ir da <i>4.7-release</i> para a <i>4.7-stable</i>).

<p>
O ramo <i>-stable</i> é a <i>-release</i> mais as correções encontradas
na <a href="../../errata.html">página errata</a>.
O funcionamento da <i>-stable</i> é a mesmo em que a <i>-release</i>
está baseada. Se as
<a href="http://www.openbsd.org/cgi-bin/man.cgi">páginas de manual</a>
tiverem alguma mudança, ela provavelmente não vai para a <i>-stable</i>.
Em outras palavras, o suporte a novos dispositivos e novas
funcionalidades não serão adicionados à <i>-stable</i>.

<p>
É útil apontar que o nome "<i>-stable</i>" (estável) não significa que
a <i>-current</i> é instável.
Pelo contrário, <i>-current</i> está mudando e desenvolvendo-se,
enquanto o funcionamento e as APIs da <i>-stable</i> não estão sendo
mudados, assim você não tem que reaprender seu sistema, mudar quaisquer
arquivos de configuração, ou acabar tendo algum problema ao adicionar
aplicativos no seu sistema.

<p>
De fato, como nossa esperança é continuar melhorando o OpenBSD, o
objetivo é que a <i>-current</i> deve ser mais estável, mais segura
e, naturalmente, ter mais funcionalidades que a <i>-stable</i>.
Assim sendo, a "melhor" versão do OpenBSD é a <i>-current</i>.

<p>
A maioria dos usuários devem usar tanto a <i>-stable</i> quanto a
<i>-release</i>. Isso quer dizer que, muitas pessoas usam a
<i>-current</i> como sistema de produção, e é importante que as pessoas
façam isso para identificar falhas e testar novas funcionalidades. No
entanto, se você não sabe como descrever corretamente, diagnosticar e
lidar com um problema, não diga para você mesmo (ou a qualquer outra
pessoa) que você está "ajudando o projeto" por usar a <i>-current</i>.
"Isto não funciona!" não é um
<a href="../../report.html#bugtypes">relato de falha útil</a>.
"As mudanças recentes no driver pciide quebraram a compatibilidade com
minha interface IDE baseada no Slugchip, segue o dmesg do sistema
funcionando e dele quebrado..." pode ser um relato útil.

<p>
Às vezes usuários "normais" querem viver no limite e usar
a <i>-current</i>. A razão mais comum é que o usuário tem um dispositivo
que não é suportado pela versão <i>-release</i> (e, assim, também não
pela <i>-stable</i>), ou deseja usar uma nova funcionalidade da
<i>-current</i>. Nesse caso, a escolha pode ser entre usar a
<i>-current</i> ou não usar o dispositivo, e <i>-current</i> pode ser
a escolha menos dolorosa. No entanto, não espere ajuda dos
desenvolvedores.

<h3>Snapshots</h3>
Entre as releases formais do OpenBSD, as <i>snapshots</i> são
disponibilizadas nos <a href="../../ftp.html">sítios FTP</a>. Como o
nome indica, estas são compilações de qualquer código fonte que estava
na árvore no momento em que o construtor pegou uma cópia do código fonte
para uma plataforma em particular.
Lembre-se: em algumas plataformas pode-se levar DIAS até que uma
snapshot seja terminada e colocada para distribuição. Não há promessa de
que as snapshots são completamente funcionais, ou mesmo que instalam.
Frequentemente, uma mudança que precisa ser testada pode ocasionar
a criação de uma snapshot. Algumas plataformas têm snapshots criadas
diariamente, outras em menor frequência. Se você deseja usar a
<i>-current</i>, uma snapshot recente é normalmente tudo que você
precisa, e atualizar a versão para uma snapshot é um ponto de partida
exigido antes de tentar compilar a <i>-current</i> a partir do código
fonte.

<p>
Uma pergunta frequente é se existe algum modo de pegar uma cópia exata
do código fonte usado para compilar uma snapshot. A resposta é não.
Primeiro, não existe benefício significante nisso. Segundo, as snapshots
são criadas quando desejado, quando existe tempo, e quando os recursos
estão disponíveis. Em plataformas lentas, pode-se levar uma semana ou
mais para criar-se uma snapshot. A inclusão de marcas ou etiquetas na
árvore de código fonte para cada snapshot não seria nem um pouco
prático. Terceiro, snapshots frequentemente contêm código fonte
experimental que ainda não foi incluído na árvore.

<h3>Upgrade vs. Update</h3>
Você irá ver com frequência referências a "upgrading" e "updating"
na instalação do OpenBSD.
Mesmo que essas palavras tenham significados parecidos, elas são usadas
de maneira um pouco diferente no OpenBSD.

<p>
<b>"Upgrading"</b> (atualização de versão) é o processo de instalar uma
nova versão do OpenBSD, com novas funcionalidades.
Por exemplo, passar da v4.6 para a v4.7, ou passar da snapshot de
12 de junho para a snapshot de 20 de junho.
Na atualização de versão, você terá que consultar tanto
<a href="../current.html">Seguindo a -current</a> quanto o
<a href="../upgrade47.html">Guia de Atualização de Versão</a> (ao mudar
de release) para fazer as mudanças requeridas para usar a versão
atualizada do OpenBSD.

<br>
<b>"Updating"</b> (atualização) é o processo de aplicar correções em um
sistema para melhorar o funcionamento SEM mudar as funcionalidades
básicas ou a compatibilidade binária. Isso é tipicamente feito
utilizando o
<a href="faq10.html#Patches">processo de correção de código fonte</a>
ou o documento <a href="../../pt/stable.html">Seguindo a -stable</a>.
Quando você faz uma atualização do seu sistema, ele vai de
<i>-release</i> para <i>-stable</i> (ou <i>-release</i> corrigida) da
mesma versão da release; por exemplo, 4.7-release para 4.7-stable.
Você pode então mais tarde atualizar para uma nova <i>-stable</i>
da mesma versão da release.
O processo de atualização é tipicamente indolor, nem arquivos do
diretório <tt>/etc</tt> nem outras configurações do sistema precisam
ser mudados.

<p>
Desse modo, você pode instalar um sistema (por exemplo, 4.5-release)
pelo CD, fazer poucas vezes a atualização dele para 4.5-stable, e então
fazer a atualização para a versão 4.6-release pelo CD, e fazer a
atualização desta poucas vezes antes da nova atualização de versão para
a 4.7-release.

<h3>Mantendo as coisas sincronizadas</h3>
É importante entender que o OpenBSD é um sistema operacional, cuja a
intenção é ser utilizado por completo, não um kernel com uma quantidade
de utilidades integradas. Você precisa ter certeza de que seu kernel,
espaço de usuário (as utilidades e arquivos de suporte) e árvore de
<a href="faq15.html#Ports"><tt>portes</tt></a> estão todos
sincronizados, ou coisas desagradáveis acontecerão. Dito de outra forma
(porque alguns usuários seguem cometendo este erro), não é possível
usar novos <tt>portes</tt> em um sistema que já tenha um mês, ou
recompilar um kernel a partir do código fonte <i>-current</i> e esperar
que ele trabalhe com o espaço de usuário da <i>-release</i>. Sim, isso
significa que você precisa fazer a atualização de versão do seu sistema
se você quer usar novos programas que foram adicionados hoje à árvore
de portes. Desculpe-nos, mas repetindo: os recursos disponíveis do
OpenBSD são limitados.

<p>
Outro fato a ser compreendido é que o processo de atualização de versão
é suportado em <b>somente uma direção: do antigo para o novo</b>, e da
<i>-stable</i> para a <i>-current</i>. Você não pode usar a
<i>4.7-current</i> (ou snapshot), e então decidir que você está vivendo
muito perigosamente e voltar para a <i>4.7-stable</i>. Você está em
suas próprias mãos se decidir qualquer caminho contrário à opção
suportada de recomeçar seu sistema do zero; portanto, não espere
assistência da equipe de desenvolvimento do OpenBSD.

<p>
Sim, isso significa que você deve pensar bem e refletir antes de
utilizar a <i>-current</i>.

<a name="WhySrc"></a>
<h2>5.2 - Por que eu preciso compilar meu sistema a partir do código fonte?</h2>
Na verdade, há muitas chances disso não ser necessário.

<p>
Algumas razões para NÃO compilar seu sistema a partir do código fonte:
<ul>
<li>Compilar seu próprio sistema como um modo de atualização de versão
    não é suportado.
<li>Você NÃO vai obter melhor desempenho compilando seu próprio sistema.
<li>Mudar as opções do compilador mais comumente acaba quebrando
    seu sistema do que melhorando-o.
</ul>

Algumas razões pelas quais você realmente deseja ou precisa compilar
a partir do código fonte:
<ul>
<li>Testar ou desenvolver novas funcionalidades.
<li>A compilação do sistema coloca uma grande carga de stress no
    computador, isso pode ser um jeito de assegurar que o sistema que
    você irá usar o OpenBSD, ou adquirir, está em boas condições.
<li>Você deseja seguir o <a href="../../pt/stable.html">ramo stable.</a>
<li>Você deseja criar uma versão altamente personalizada do OpenBSD para
    alguma aplicação especial.
</ul>

<p>
A equipe do OpenBSD disponibiliza novas snapshots baseadas no código
fonte da <i>-current</i> para todas as plataformas.
Isso normalmente será tudo que você precisa para usar a
<i>-current</i>.

<p>
A razão mais comum para compilar a partir do código fonte é seguir o
ramo <i>-stable</i>, onde compilar a partir do código fonte é a única
opção suportada.

<a name="Bld"></a>
<h2>5.3 - Compilação do OpenBSD a partir do código fonte</h2>

<a name="BldOverview"></a>
<h3>5.3.1 - Visão geral</h3>

Compilar o OpenBSD a partir do código fonte envolve os seguintes passos:
<ul>
<li><a href="#BldBinary">Instalação ou atualização de versão para os
    binários mais recentes.</a>
<li><a href="#BldGetSrc">Download do código fonte apropriado.</a>
<li><a href="#BldKernel">Compilação de um novo kernel e inicialização
    através dele.</a>
<li><a href="#BldUserland">Compilação do "espaço de usuário"
    ("make build").</a>
</ul>

Existem etapas suplementares que alguns usuários talvez queiram
realizar, dependendo do propósito da compilação e da presença ou não
do X:
<ul>
<li><a href="#Release">Compilação de uma release.</a>
<li><a href="#Xbld">Compilação do X.</a>
</ul>


<a name="BldBinary"></a>
<h3>5.3.2 - Instalação ou atualização de versão para os binários mais
recentes</h3>

O primeiro passo na compilação a partir do código fonte é ter certeza
que você tem os binários mais recentes instalados.

Use esta tabela para procurar onde você está, aonde você deseja ir, e
com qual binário começar:

<p>
<table border="1" style="empty-cells: show;">
<tr>
  <td><b>Você está em</b></td> <td><b>Objetivo</b></td>
  <td><b>Atualização binária para</b></td> <td><b>então...</b></td>
</tr>
<tr>
  <td> -release antiga </td> <td> Nova release </td> <td> Release atual </td>
  <td> Feito! </td>
</tr>
<tr>
  <td> -release </td> <td> -stable </td> <td> Release Atual </td>
  <td>Baixar &amp; compilar a <i>-stable</i></td>
</tr>
<tr>
  <td> -stable antiga </td> <td> -stable </td> <td> Release Atual </td>
  <td>Baixar &amp; compilar a <i>-stable</i></td>
</tr>
<tr>
  <td> -release </td> <td> -current </td> <td> Última Snapshot </td>
  <td> (opcional) Baixar &amp; compilar a <i>-current</i>
</tr>
<tr>
  <td> -current antiga </td> <td> -current </td> <td> Última Snapshot </td>
  <td> (opcional) Baixar &amp; compilar a <i>-current</i>
</tr>
</table>

<p>
É recomendado que você instale os binários usando a opção "Upgrade" da
mídia de instalação.
Se isso não é possível, você pode também descompactar os binários como
descrito <a href="../upgrade47.html">aqui</a>.
Você deve fazer o processo completo de atualização de versão, incluindo
criar quaisquer usuários ou outras mudanças necessárias no diretório
<tt>/etc</tt>.


<a name="BldGetSrc"></a>
<h3>5.3.3 - Download do código fonte apropriado</h3>
O código fonte do OpenBSD é gerenciado usando o sistema de controle de
versão <a href="http://ximbiot.com/cvs/cvshome/">CVS</a>, e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">cvs(1)</a>
é usado para puxar uma cópia do código fonte desejado para a sua máquina
local, para os fins da compilação.
Isso pode ser feito usando um servidor
<a href="../../anoncvs.html">AnonCVS</a>
(uma máquina que guarda uma cópia de acesso público de todo o
repositório CVS usado pelo projeto OpenBSD) ou de um repositório CVS
local que você mantém usando o programa
<a href="../../pt/cvsup.html">CVSup</a> ou
<a href="../../cvsync.html">CVSync</a>, disponíveis como
<a href="faq15.html#PkgMgmt">pacotes</a>.
O CVSup pode também ser usado em modo "checkout", mas isso não será
explicado aqui.
Se você tem múltiplas máquinas e deseja manter as árvores de código
fonte ativas, você deve utilizar um repositório CVS local, criado e
mantido usando CVSup ou CVSync.

<p>
Depois de decidir qual
<a href="../../anoncvs.html">servidor AnonCVS</a>
você deseja usar, você deve fazer o "checkout" da árvore de código
fonte, depois disso você então mantém a árvore executando "updates"
(atualizações), para puxar arquivos atualizados para a sua árvore local.

<p>
O comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">CVS(1)</a>
tem muitas opções, algumas delas são <i><b>requeridas</b></i> para
o checkout e update de uma árvore.
Outros comandos podem causar a quebra da árvore.
O fato de compreender e seguir estas direções é importante.

<p>
<b>Seguindo a <i>-current</i></b><br>
<blockquote>
Neste caso, assumimos que você está usando um servidor público AnonCVS,
<b>anoncvs@anoncvs.exemplo.org:/cvs</b>.
Nós também assumimos que você está usando o shell
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh(1)</a>,
se você está usando um shell diferente, você terá que fazer alguns
ajustes nestes comandos.

<p>
Para fazer o checkout da árvore src CVS da <i>-current</i>, você pode
usar o seguinte:

<pre>
    # <b>cd /usr</b>
    # <b>export CVSROOT=anoncvs@anoncvs.exemplo.org:/cvs</b>
    # <b>cvs -d$CVSROOT checkout -P src</b>
</pre>

<p>
Uma vez que você tem a árvore, você pode atualizar ela mais tarde com:
<pre>
    # <b>cd /usr/src</b>
    # <b>export CVSROOT=anoncvs@anoncvs.exemplo.org:/cvs</b>
    # <b>cvs -d$CVSROOT up -Pd</b>
</pre>
</blockquote>

<!-- XXXrelease -->
<b>Seguindo a <i>-Stable</i></b><br>
<blockquote>
Se você deseja pegar um "ramo" alternativo da árvore, tal como o ramo
<i>-stable</i>, você deve usar o modificador "<tt>-r</tt>" em seu
checkout:
<pre>
    # <b>cd /usr</b>
    # <b>export CVSROOT=anoncvs@anoncvs.exemplo.org:/cvs</b>
    # <b>cvs -d$CVSROOT checkout -rOPENBSD_4_7 -P src</b>
</pre>

Isso puxa os arquivos src do ramo OPENBSD_4_7, o qual é também
conhecido como "Ramo corrigido" ou
"<a href="../../pt/stable.html">-stable</a>".
Você também pode atualizar o código fonte assim:
<pre>
    # <b>cd /usr/src</b>
    # <b>export CVSROOT=anoncvs@anoncvs.exemplo.org:/cvs</b>
    # <b>cvs -d$CVSROOT up -rOPENBSD_4_7 -Pd</b>
</pre>

O CVS é realmente bom o bastante para afixar uma etiqueta nos arquivos
verificados, assim você não tem que lembrar a parte
"<tt>-rOPENBSD_4_7</tt>" da linha de comando; ele irá lembrar isso
até que você explicitamente limpe ou configure uma nova etiqueta usando
a opção "<tt>-A</tt>" no "<tt>update</tt>".
No entanto, é provavelmente melhor colocar mais informações em suas
linhas de comando CVS do que poucas.
</blockquote>

<p>
Enquanto somente a árvore "<tt>src</tt>" esteve presente até o momento,
você deve fazer os mesmos passos para "<tt>xenocara</tt>" e
"<tt>ports</tt>".
Como todas as partes do OpenBSD precisam estar em sincronia, todas as
árvores que você usar devem ser verificadas e atualizadas ao mesmo
tempo. Você pode juntar os checkouts em uma linha (<i>-stable</i> é
mostrada):
<pre>
    # <b>export CVSROOT=anoncvs@anoncvs.exemplo.org:/cvs</b>
    # <b>cd /usr</b>
    # <b>cvs -d$CVSROOT checkout -rOPENBSD_4_7 -P src ports xenocara</b>
</pre>

No entanto, atualizações precisam ser feitas diretório por diretório.

<p>
Neste ponto, se você segue a <i>-stable</i> ou a <i>-current</i>,
você já deve ter uma árvore de código fonte correta.
Esteja atento sobre qual árvore você pegou -- você pode acabar tentando
compilar a <i>-current</i> quando o objetivo é a <i>-stable</i>.

<h4>Pré-carregando a árvore: <tt>src.tar.gz, sys.tar.gz</tt></h4>
Enquanto você pode fazer o download de toda a árvore de um servidor
AnonCVS, você pode muitas vezes salvar tempo e banda de rede
"pré-carregando" sua própria árvore de código fonte com os arquivos
tanto do CD do OpenBSD quanto de um servidor FTP.
Isso é particularmente verdadeiro se você está usando a
<a href="../../pt/stable.html"><i>-stable</i></a>, com relativamente
poucos arquivos alterados entre essa versão e a <i>-release</i> em que
está baseada.

<p>
Para extrair a árvore de código fonte do CD para <i>/usr/src</i>
(assumindo que o CD está montado em /mnt):
<pre>
    # <b>cd /usr/src; tar xzf /mnt/src.tar.gz</b>
    # <b>cd /usr; tar xzf /mnt/xenocara.tar.gz</b>
    # <b>cd /usr; tar xzf /mnt/ports.tar.gz</b>
</pre>

Os arquivos de código fonte disponíveis para download nos servidores FTP
são separados em dois arquivos para minimizar o tempo de download para
aqueles que querem trabalhar com somente uma parte da árvore. Os dois
arquivos são <tt>sys.tar.gz</tt>, o qual contém os arquivos usados para
a criação do kernel, e <tt>src.tar.gz</tt>, que contém todas as outras
utilidades do espaço de usuário, exceto a árvore de portes e o código
fonte do X11. Geralmente, no entanto, talvez você queira ambos
instalados. Assumindo que os arquivos baixados,
<tt>src.tar.gz</tt> e <tt>sys.tar.gz</tt>, estão em <tt>/usr</tt>:
  
<pre>
    # <b>cd /usr/src</b>
    # <b>tar xzf ../sys.tar.gz</b>
    # <b>tar xzf ../src.tar.gz</b>
    # <b>cd /usr</b>
    # <b>tar xzf xenocara.tar.gz</b>
    # <b>tar xzf ports.tar.gz</b>
</pre>

<p>
Nem todas as pessoas querem descompactar todos os pacotes de arquivos,
mas conforme o sistema precisar ser colocado em sincronia, você
geralmente terá a necessidade de configurar todas as partes da árvore.


<a name="CVSTips"></a>
<h4>Dicas comuns de CVS</h4>

Como mencionado anteriormente, algumas opções são obrigatórias para
pegar uma árvore <tt>src</tt> válida no OpenBSD.
A opção "<tt>-P</tt>" acima é uma delas: Ela faz "prunes" (remove) em
diretórios que estão vazios.
Com o passar do anos, diretórios foram criados e excluídos na árvore
de código fonte do OpenBSD, e algumas vezes os nomes dos diretórios
antigos são atualmente usados como nomes de arquivos.
Sem a opção "<tt>-P</tt>", seu mais recente "checked-out" da árvore
não irá compilar corretamente.

<p>
Muitas opções parecidas que usam <tt>-d</tt> no comando 'update' -- isso
cria novos diretórios que podem ter sido adicionados na árvore desde seu
checkout inicial.
Para atualizar corretamente, você precisa usar as opções <tt>-Pd</tt>.

<p>
Usuários experientes de CVS podem se perguntar por que a CVSROOT foi
especificada e usada nesse exemplo, quando o cvs(1) registra a
localização do servidor CVS na árvore checada.
Isso é correto, contudo, muitas vezes é um jeito necessário para
sobrescrever o servidor anoncvs padrão, muitas pessoas recomendam
<i>sempre</i> especificar explicitamente o repositório.
É também de valia notar que enquanto a variável de ambiente CVSROOT
pode ser usada diretamente pelo cvs(1), ela é usada somente se nenhuma
outra sobrescrevê-la (ou seja, cvs(1) teria um erro sem ela), apesar de
que especificar ela na linha de comando cvs(1) sobrescreve todos os
outros valores.

<p>
É bastante útil usar um <tt>.cvsrc</tt> no seu diretório pessoal para
especificar padrões para algumas dessas opções.
Um exemplo de arquivo <tt>.cvsrc</tt>:
<pre>
    $ <b>more ~/.cvsrc</b>
    cvs -q -danoncvs@anoncvs.exemplo.org:/cvs
    diff -up
    update -Pd
    checkout -P
</pre>

Esse arquivo faz o cvs(1) usar o servidor
<tt>anoncvs@anoncvs.exemplo.org:/cvs</tt>, suprimir saída desnecessária
("<tt>-q</tt>" é "quieto") para todas as operações,
um comando "cvs up" padronizado para usar <tt>-Pd</tt>,
um "cvs diff" padronizado para providenciar "unified diffs" imposto por
"<tt>-u</tt>", e um "cvs checkout" usa a opção "<tt>-P</tt>".
Enquanto isso é conveniente, se você se esquecer que esse arquivo
existe, ou tentar executar comandos que você tem usado em uma máquina
sem esse arquivo, você terá problemas.

<p>
Como a árvore de código fonte consiste, em sua maioria, de vários
arquivos pequenos, ativar o
<a href="faq14.html#SoftUpdates">soft updates</a>
para a partição que a árvore de código fonte está localizada vai
melhorar significantemente o desempenho.


<a name="BldKernel"></a>
<h3>5.3.4 - Compilação do kernel</h3>
Nós assumimos que você deseja compilar um kernel padrão (GENERIC ou
GENERIC.MP) aqui.
Normalmente, isso é o que você deseja fazer.
<i>Não</i> considere a ideia de compilar um kernel personalizado se você
não dominou o processo de compilação padrão.

<p>
Obviamente, o kernel é uma porção do sistema MUITO dependente do
hardware.
O código fonte para o kernel está no diretório <tt>/usr/src/sys</tt>.
Algumas partes do código fonte do kernel do OpenBSD são usadas em outras
plataformas, outras são específicas de um processador ou de uma
arquitetura.
Se você olhar no diretório <tt>/usr/src/sys/arch/</tt>, você pode ver
algumas coisas que parecem um pouco confusas -- por exemplo, existem
os diretórios <tt>mac68k</tt>, <tt>m68k</tt> e <tt>mvme68k</tt>.
Nesse caso, ambos os sistemas mvme68k e mac68k usam o mesmo
processador, mas as máquinas em que eles são baseados são diferentes e,
dessa forma, requerem um kernel diferente (há muito mais coisas sobre o
projeto de um computador do que de seu processador!).
No entanto, partes do kernel são comuns, e essas partes são mantidas
no diretório m68k.
Se você está simplesmente compilando um kernel, a base da arquitetura
de diretórios como <tt>m68k</tt> não é nada para você se preocupar,
você deve trabalhar exclusivamente com os diretórios da
"área da arquitetura", tal como <tt>mvme68k</tt>.

<p>
Kernels são compilados baseados nos
<a href="#Options">arquivos de configuração do kernel</a>, que estão
localizados no diretório
<tt>/usr/src/sys/arch/&lt;<i>sua plataforma</i>&gt;/conf</tt>.
A compilação do kernel consiste no uso do programa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
para criar e popular o diretório de compilação do kernel, que no fim
estará em
<tt>/usr/src/sys/arch/&lt;<i>sua plataforma</i>&gt;/compile/&lt;<i>Nome do Kernel</i>&gt;</tt>.
Para este exemplo, nós assumimos que você está usando a plataforma i386:

<blockquote><pre>
# <b>cd /usr/src/sys/arch/i386/conf</b>
# <b>config GENERIC</b>
# <b>cd ../compile/GENERIC</b>
# <b>make clean && make depend && make</b>
    <i>[...várias mensagens de saída...]</i>
# <b>make install</b>
</pre></blockquote>

Troque "<tt>i386</tt>", na primeira linha, pelo nome da sua plataforma.
O comando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=machine&amp;sektion=1">machine(1)</a>
pode dizer a você qual é o nome da sua plataforma, assim uma
generalização óbvia pode ser usada com o comando
"<tt>cd /usr/src/sys/arch/`machine`/conf</tt>" em vez da primeira
linha.

<p>
Neste ponto, reinicialize sua máquina para ativar esse novo kernel.
Note que o novo kernel deve estar em execução antes do próximo passo;
de qualquer forma, se você seguiu o aviso
<a href="#BldBinary">acima</a> sobre atualização de versão para o mais
recente snapshot disponível, isso não é tão importante.
Algumas vezes, no entanto, as APIs mudam e o kernel antigo fica
impossibilitado de executar novas aplicações, mas o novo kernel
geralmente suporta as antigas.

<h4>Variação do processo acima: Árvore de código fonte apenas para
leitura ("Read-only")</h4>
Algumas vezes, você pode querer ter certeza que seu diretório
<tt>/usr/src/sys</tt> permanecerá intocável.
Isso pode ser feito usando o seguinte processo:

<blockquote><pre>
$ <b>cd <i>/qualquer_lugar</i></b>
$ <b>cp /usr/src/sys/arch/i386/conf/GENERIC .</b>
$ <b>config -s /usr/src/sys -b . GENERIC</b>
$ <b>make clean && make depend && make</b>
   ... várias mensagens de saída ...
</pre></blockquote>

Note que você pode compilar o kernel sem acesso root, mas você precisa
ter acesso ao root para instalar o kernel.


<a name="BldUserland"></a>
<h3>5.3.5 - Compilação do espaço de usuário</h3>

Há um processo específico usado pelo OpenBSD.
Os processos usados em outros SOs que você tem familiaridade normalmente
não irão funcionar no OpenBSD.

<p>
<ul>
<li>Limpe seu diretório <tt>/usr/obj</tt> e refaça as ligações
simbólicos:
<blockquote><pre>
# <b>rm -rf /usr/obj/*</b>
# <b>cd /usr/src</b>
# <b>make obj</b>
</pre></blockquote>

Note que o uso do diretório <tt>/usr/obj</tt> é obrigatório.
A falha nesse passo antes de compilar o resto da árvore irá comumente
deixar sua árvore <tt>src</tt> em mau estado.

<p>
<li>Tenha certeza que todos os diretórios apropriados estão criados.
<blockquote><pre>
# <b>cd /usr/src/etc && env DESTDIR=/ make distrib-dirs</b>
</pre></blockquote>

<p>
<li>Compile o sistema:
<blockquote><pre>
# <b>cd /usr/src</b>
# <b>make build</b>
</pre></blockquote>
Isso compila e instala todos os utilitários do espaço de usuário na
ordem apropriada.
Esse é um passo que consome bastante tempo -- uma máquina muito rápida
pode completar isso em cerca de uma hora, uma máquina muito lenta
pode levar vários dias.
Quando esse passo está completo, você tem novos binários compilados
em seu sistema.

<p>
<li><b>Se estiver compilando a <i>-current</i>:</b> atualize
    <tt>/dev</tt> e <tt>/etc</tt> com as mudanças listadas em
    <a href="../current.html">current.html</a>.
    Se está seguindo a -stable depois de um correto
    <a href="../upgrade47.html">processo de atualização de versão</a> ou
    uma instalação dos <a href="#BldBinary">binários correspondentes</a>,
    esse passo não é necessário ou desejado.
</ul>


<a name="Release"></a>
<a name="BldRelease"></a> <!-- old tag -->
<h2>5.4 - Compilação de uma release</h2>
<h3>O que é uma "release", e por que eu vou querer fazer uma?</h3>
Uma release é um conjunto de arquivos completos que você pode usar para
instalar o OpenBSD em outro computador.
Se você tem somente um computador executando o OpenBSD, você realmente
não tem nenhuma razão para fazer uma release; o processo de compilação
<a href="#Bld">acima</a> vai fazer tudo que você precisa.
Um exemplo de uso do processo de fazer uma release é compilar
a <i>-stable</i> em uma máquina rápida, e então fazer uma release para
ser instalada em todas as suas outras máquinas no seu escritório.

<p>
O processo de criar uma release usa os binários criados no diretório
<tt>/usr/obj</tt> no processo de compilação mostrado acima, então você
precisa primeiro completar corretamente a compilação, e nada deve
atrapalhar o diretório <tt>/usr/obj</tt>.
Um momento onde isso pode ser um problema é se você usa um
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_mfs&amp;sektion=8">disco de memória</a>
como seu <tt>/usr/obj</tt>, para um pouco de desempenho extra no
processo de compilação: você não vai querer reinicializar seu computador
entre os passos de "build" e "release"!

<p>
O processo de criar uma release requer dois diretórios para o trabalho,
que nós vamos chamar de DESTDIR e RELEASEDIR.
Todos os arquivos que são parte de uma instalação "limpa" do OpenBSD
são copiados para seus lugares apropriados dentro do DESTDIR.
Eles então são compactados com o tar(1) e colocados em RELEASEDIR.
No fim do processo, RELEASEDIR guarda a release completa do OpenBSD.
O processo de criar uma release também usa o <tt>/mnt</tt>, então
este não deve ser usado por nada enquanto o processo de criação da
release estiver em execução. Para propósitos de exemplo, nós usaremos o
DESTDIR em <tt>/usr/dest</tt> e o RELEASEDIR em <tt>/usr/rel</tt>.


<p>
O processo de criar uma release envolve um utilitário,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crunchgen&amp;sektion=8">crunchgen(8)</a>,
que é utilizado para criar um único arquivo executável feito de vários
binários individuais.
O nome como esse único arquivo executável é executado determina qual
componente binário é executado.
É dessa maneira que vários arquivos de programas individuais são
comprimidos em um kernel ramdisk presente em disquetes de inicialização
e outras mídias de inicialização.

<p>
Você precisa ter privilégios de root para fazer uma release.

<p>
<h3>Como fazer uma release</h3>

Defina nossas variáveis de ambiente DESTDIR e RELEASEDIR:
<blockquote><pre>
# <b>export DESTDIR=/usr/dest</b>
# <b>export RELEASEDIR=/usr/rel</b>
</pre></blockquote>

Nós agora limpamos DESTDIR e, se necessário, criamos os diretórios:
<blockquote><pre>
# <b>test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}.old && rm -rf ${DESTDIR}.old &</b>
# <b>mkdir -p ${DESTDIR} ${RELEASEDIR}</b>
</pre></blockquote>

RELEASEDIR normalmente não precisa ser esvaziado antes de começar o
processo de fazer uma release; no entanto, se existem mudanças nos
arquivos de release ou em seus nomes, arquivos antigos serão
conservados. Você pode desejar também apagar esse diretório antes de
começar.

<p>
Nós agora faremos a release em si:
<blockquote><pre>
# <b>cd /usr/src/etc</b>
# <b>make release</b>
</pre></blockquote>

Depois que a release está pronta, é uma boa ideia verificá-la para ter
certeza de que os arquivos tar correspondem aos que estão no DESTDIR.
A saída deste passo deve ser mínima.

<blockquote><pre>
# <b>cd /usr/src/distrib/sets</b>
# <b>sh checkflist</b>
</pre></blockquote>

Você agora tem o conjunto de arquivos completo e verificado em
RELEASEDIR. Esses arquivos podem agora ser usados para a instalação
ou atualização de versão do OpenBSD em outras máquinas.

<p>
As instruções confiáveis sobre como fazer uma release estão em
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>.

<p>
Nota: se você deseja distribuir os arquivos resultantes por HTTP, para
uso em scripts de instalação ou upgrade, você também precisa
adicionar um arquivo "index.txt", o qual contém a lista de todos os
arquivos em sua recém-criada release.
<blockquote><pre>
# <b>/bin/ls -1 >index.txt</b>
</pre></blockquote>

Após você ter feito a release, você pode usar aqueles arquivos para uma
<a href="faq4.html">instalação</a> padrão ou
<a href="../upgrade47.html">atualização de versão</a> de outra máquina,
ou se for atualizar uma máquina para uma nova <i>-stable</i>,
simplesmente <a href="faq4.html#AddFileSet">descompacte</a> os arquivos
tar no diretório raiz da máquina de destino.

<a name="Xbld"></a>
<h2>5.5 - Compilação do X (Xenocara)</h2>
A partir do <a href="http://x.org/">X.org v7,</a> o X mudou para um
sistema de "compilação modular", dividindo a árvore de código fonte no
X.org v7 em mais de trezentos pacotes mais ou menos independentes.

<p>
Para simplificar a vida dos usuários do OpenBSD, uma "meta-build"
chamada <a href="http://xenocara.org">Xenocara</a> foi desenvolvida.
Esse sistema "converte" o X novamente em uma grande árvore para
ser compilada em um único processo.
Como um bônus, esse processo é mais similar ao processo de compilação
usado pelo resto do OpenBSD do que as versões anteriores eram.

<p>
As instruções oficiais para a compilação do X estão no arquivo
<tt>/usr/xenocara/README</tt> e em
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>.

<h3>Como obter o código fonte</h3>
A localização "normal" para a árvore xenocara é
<tt>/usr/xenocara</tt>, e o código fonte é guardado no módulo
<tt>xenocara</tt> no CVS.
Dessa forma, o processo de "checkout" é este:
<blockquote><pre>
$ <b>cd /usr</b>
$ <b>cvs -qdanoncvs@anoncvs.exemplo.org:/cvs checkout -P xenocara</b>
</pre></blockquote>

<h3>Compilação da Xenocara</h3>
Para a compilação da árvore xenocara padrão, suportada pelo OpenBSD,
nenhuma ferramenta externa é necessária.

<blockquote><pre>
# <b>cd /usr/xenocara</b>
# <b>rm -rf /usr/xobj/*</b>
# <b>make bootstrap</b>
# <b>make obj</b>
# <b>make build</b>
</pre></blockquote>

Se você deseja fazer mudanças na árvore de código fonte, você irá
provavelmente precisar adicionar vários <a href="faq15.html">pacotes</a>.
Detalhes estão no arquivo <tt>/usr/xenocara/README</tt>.

<h3>Como fazer uma release do X</h3>
Isso é similar ao processo de criar uma release do sistema principal.
Depois de compilar corretamente o X, você vai definir as variáveis
DESTDIR e RELEASEDIR, com os mesmos propósitos mostrados mais acima.
O RELEASEDIR pode ser o mesmo diretório que o RELEASEDIR do sistema
principal, mas DESTDIR é apagado e refeito nesse processo.
Se feito cuidadosamente, isso não é um problema, mas usar um DESTDIR
separado pode ser "mais seguro".

<p>
Para este exemplo, nós usaremos as variáveis DESTDIR e RELEASEDIR em
/usr/dest e /usr/rel, respectivamente.
Isso precisa ser feito depois do processo de compilação mostrado acima.

<blockquote><pre>
# <b>export DESTDIR=/usr/dest</b>
# <b>export RELEASEDIR=/usr/rel</b>
# <b>test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && \</b>
 <b>    rm -rf ${DESTDIR}- &</b>
# <b>mkdir -p ${DESTDIR} ${RELEASEDIR}</b>
# <b>make release</b>
</pre></blockquote>

Quando esse processo completar, você terá um conjunto de arquivos
de release em $RELEASEDIR.

<p>
<a name="Why"></a>
<h2>5.6 - Por que eu preciso de um kernel personalizado?</h2>

<p>
Na verdade, você provavelmente não precisa.

<p>
Um kernel personalizado é uma compilação com um arquivo de configuração
diferente daquele fornecido no arquivo de configuração <tt>GENERIC</tt>.
Um kernel personalizado pode ser baseado no código fonte da
<a href="#Flavors"><i>-release, -stable</i> ou <i>-current</i></a>,
igual ao que um kernel <tt>GENERIC</tt> pode ser.
Enquanto compilar seu próprio <tt>GENERIC</tt>, você terá suporte
da equipe do OpenBSD, se compilar seu próprio kernel personalizado, você
<i>não</i> terá.

<p>
A configuração do kernel padrão do OpenBSD (<tt>GENERIC</tt>) é
projetada para ser útil para a maioria das pessoas.
Muitas pessoas quebram seus sistemas, ao tentar otimizar o kernel, em
vez de melhorar o funcionamento.
Existem algumas pessoas que acreditam que você precisa personalizar
seu kernel e o sistema para obter um desempenho otimizado, mas esse não
é o caso do OpenBSD. Somente os usuários mais avançados e com
conhecimentos nas aplicações exigentes precisam se preocupar com um
kernel personalizado, ou com o sistema todo.

<p>
Algumas razões pelas quais você deseja ou precisa compilar um kernel
personalizado:
<ul>
  <li>Você realmente sabe o que está fazendo, e quer encaixar o
      OpenBSD em um computador com uma quantidade pequena de RAM,
      removendo drivers de dispositivos que você não precisa.
  <li>Você realmente sabe o que está fazendo, e quer remover opções
      padrão ou adicionar opções que não estão ativas por padrão
      (e tem uma boa razão para isso).
  <li>Você realmente sabe o que está fazendo, e quer ativar opções
      experimentais.
  <li>Você realmente sabe o que está fazendo, e tem uma necessidade
      especial não conhecida pelo <tt>GENERIC</tt>, e não vai perguntar
      por que isso não funciona se alguma coisa der errado.
</ul>

<p>
Algumas razões pelas quais você não deve compilar um kernel
personalizado:
<ul>
  <li>Você não precisa fazer isso, normalmente.
  <li>Você não terá um sistema rápido.
  <li>Você certamente tornará sua máquina menos confiável.
  <li>Você não vai receber nenhum suporte dos desenvolvedores.
  <li>Todos os problemas encontrados devem ser obrigatoriamente
      reproduzidos usando um kernel <tt>GENERIC</tt> antes que os
      desenvolvedores recebam qualquer relato de problema sério.
  <li>Usuários e desenvolvedores vão rir de você quando você quebrar o
      seu sistema.
  <li>Opções personalizadas do compilador normalmente fazem um bom
      trabalho de exposição dos problemas do compilador do que melhorar
      o desempenho do sistema.

</ul>

<p>
Remover drivers de dispositivos pode acelerar o processo de
inicialização no seu sistema, mas pode complicar a recuperação se você
tiver um problema de hardware, além de ser, frequentemente, feito de
forma errada.
Remover drivers de dispositivos <i>não vai</i> fazer seu sistema
funcionar mais rápido em qualquer quantidade notável, apesar de produzir
um kernel pequeno.
Remover a verificação e depuração de erro pode resultar em um ganho
limitado de desempenho, mas ficará impossível descobrir problemas
no sistema se alguma coisa não funcionar.


<p>
Novamente, desenvolvedores normalmente ignoram relatos de erro sobre
kernels personalizados, a menos que o problema possa ser reproduzido em
um kernel <tt>GENERIC</tt>.
Você foi avisado.

<p>
<a name="Options"></a>
<h2>5.7 - Compilação de um kernel personalizado</h2>
É assumido que você leu o texto <a href="#Why">acima</a> e realmente
adora sofrer.
É também assumido que você tem um objetivo que não pode ser alcançado
pela
<a href="#BootConfig">Configuração em tempo de inicialização (UKC>)</a>
nem <a href="#config">config(8)urando o kernel GENERIC</a>.
Se todas as possibilidades são falsas, você deve parar de usar o
GENERIC. Realmente.

<p>
A geração do kernel do OpenBSD é controlada por arquivos de
configuração, que estão localizados nos diretórios
<tt>/usr/src/sys/arch/<i>&lt;arch&gt;</i>/conf/</tt>
por padrão. Todas as arquiteturas possuem um arquivo, <tt>GENERIC</tt>,
que é usado para gerar um kernel padrão do OpenBSD para aquela
plataforma.
Também podem existir outros arquivos de configuração que são usados
para criar kernels com focos diferentes; por exemplo, para
utilização mínima de RAM, estações de trabalho sem disco, etc.

<p>
O arquivo de configuração é processado pelo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>,
que faz a criação e população do diretório de compilação
<tt>../compile</tt>, em uma instalação típica, que será feita em
<tt>/usr/src/sys/arch/<i>&lt;arch&gt;</i>/compile/</tt>. O config(8)
também cria um
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">Makefile</a>
e outros arquivos requeridos para uma compilação correta do kernel.

<p>
As opções de configuração do kernel são as opções que você adiciona
na sua configuração do kernel para ativar certos recursos dele.
Isso permite que você tenha exatamente o suporte que você quer,
sem ter suporte para dispositivos desnecessários. Há um monte de opções
que permitem que você personalize seu kernel. Aqui nós vamos ver somente
algumas delas, aquelas que são de uso mais comum. Verifique na página
de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>
a lista completa de opções, e como esta muda de tempos em tempos,
você deve ter certeza de que está usando a página de manual da mesma
versão do OpenBSD que você está compilando. Você também pode verificar
os exemplos de arquivos de configuração que estão disponíveis para a
sua arquitetura.

<p>
<b>Não adicione, remova, ou mude opções em seu kernel a menos que você
tenha realmente uma razão para isso! Não edite o arquivo de configuração
<tt>GENERIC</tt>!!</b>
A única configuração do kernel que é suportada pela equipe do OpenBSD
é o kernel GENERIC, a combinação das opções em
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/conf/GENERIC</tt>
e <tt>/usr/src/sys/conf/GENERIC</tt> <i>distribuídas pela equipe do
OpenBSD</i> (ou seja, NÃO-editadas). Relatar um problema em um kernel
personalizado quase sempre resulta em você ter que tentar reproduzir o
problema com um kernel GENERIC. Nem todas as opções são compatíveis
entre elas, e muitas opções são requeridas para um sistema trabalhar.
Não há garantia de que apenas porque você conseguiu um kernel compilado
e personalizado, ele irá funcionar.
Não há garantia de que um kernel que pôde ser "config(8)urado" possa
ser compilado.

<p>
Você pode ver os arquivos de configuração de plataformas específicas
aqui:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Arquivos de Configuração do Kernel alpha</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Arquivos de Configuração do Kernel i386</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/macppc/conf/">Arquivos de Configuração do Kernel macppc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Arquivos de Configuração do Kernel sparc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc64/conf/">Arquivos de Configuração do Kernel sparc64</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/vax/conf/">Arquivos de Configuração do Kernel vax</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/hppa/conf/">Arquivos de Configuração do Kernel hppa</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Outras Arquiteturas</a>
</ul>

<p>
Olhe com atenção esses arquivos e você irá notar uma linha perto do
topo do arquivo, similar a esta:
<pre>
     include "../../../conf/GENERIC"
</pre>
Isso significa que ele está referenciando outro arquivo de configuração,
um que armazena opções independentes da plataforma. Quando criar sua
configuração do kernel, tenha certeza de olhar o conteúdo do
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">sys/conf/GENERIC</a>.
<p>
As opções de configuração do kernel devem ser colocadas no seu arquivo
de configuração no formato:
<blockquote>
<tt>option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><i>nome</i>
</blockquote>
ou
<blockquote><pre>
<tt>option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><i>nome=valor</i>
</pre></blockquote>

Por exemplo, para ativar a opção "DEBUG" no kernel, adicione uma linha
como esta:

<blockquote><pre>
option      DEBUG
</pre></blockquote>

Opções no kernel do OpenBSD são traduzidas em opções de pré-processador
do compilador, então uma opção como DEBUG vai fazer com que o código
fonte seja compilado com a opção -DDEBUG, que é equivalente a colocar um
<tt>#define DEBUG</tt> nos arquivos de código fonte do kernel.

<p>
Algumas vezes você pode desejar desabilitar uma opção que está
definida, tipicamente no arquivo
"<tt>src/sys/conf/GENERIC</tt>". Enquanto você deve modificar uma cópia
daquele arquivo, uma melhor escolha pode ser usar a instrução
<i>rmoption</i>. Por exemplo, se você quer realmente desabilitar o
depurador interno do kernel (<i>não recomendado!</i>), você deve
adicionar uma linha igual a esta:
<pre>
     rmoption DDB
</pre>
em seu arquivo de configuração do kernel. A <tt>option DDB</tt> é
definida em <tt>src/sys/conf/GENERIC</tt>, mas a linha <tt>rmoption</tt>
acima desativa-a.

<p>
Novamente, por favor veja em
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>
mais informação sobre as especificações dessas opções. Também note
que muitas das opções também têm suas próprias páginas de manual --
sempre leia todas as coisas disponíveis sobre uma opção antes de
adicioná-la ou removê-la do seu kernel.

<p>
<h3>Compilação de um kernel personalizado</h3>

Neste caso, nós vamos compilar um kernel que suporta a placa serial
ISA multiportas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boca&amp;sektion=4">boca(4)</a>.
Essa placa não está no kernel GENERIC, devido aos conflitos com outros
drivers.

Existem dois jeitos simples para fazer um kernel personalizado: copiar
o arquivo de configuração GENERIC com um outro nome e editá-lo, ou criar
um arquivo "invólucro" que inclui o kernel padrão GENERIC e quaisquer
opções que você precise que não estão no GENERIC.
Nesse caso, nosso arquivo invólucro se parece com isto:
<blockquote><pre>
include "arch/i386/conf/GENERIC"

boca0  at       isa? port 0x100 irq 10     # BOCA 8-port serial cards
com*   at       boca? slave ?
</pre></blockquote>

As duas linhas referentes à placa boca(4) são copiadas das linhas
comentadas em <tt>GENERIC</tt>, com o IRQ ajustado se necessário.
A vantagem de usar esse arquivo invólucro é que qualquer mudança
não avisada no GENERIC é atualizada automaticamente com qualquer
outra atualização de código fonte.
A desvantagem é que não se pode remover dispositivos (apesar de que
geralmente essa é uma ideia ruim, de qualquer forma).

<p>
Uma outra maneira de gerar um kernel personalizado é fazer uma cópia do
<tt>GENERIC</tt> padrão, dando a ela um outro nome, e editando-a
o quanto for necessário.
A desvantagem disso é que atualizações posteriores no arquivo de
configuração GENERIC precisam ser colocadas na sua cópia, ou você vai
ter que refazer seu arquivo de configuração.

<p>
Em ambas as ocasiões, depois de fazer seu arquivo personalizado de
configuração do kernel, use o config(8) e faça seu kernel como
documentado <a href="#BldKernel">acima</a>.


<p>
Instruções completas para criar seu próprio kernel personalizado estão
na página de manual
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8#EXAMPLES+(kernel">
config(8)</a>.


<a name="BootConfig"></a>
<h2>5.8 - Configuração em tempo de inicialização</h2>

<p>
Algumas vezes quando seu sistema está inicializando, pode ser que você
receba a notícia de que o kernel achou seu dispositivo, mas talvez no
IRQ errado. E talvez você precise usar esse dispositivo imediatamente.
Bem, sem recompilar o kernel você pode usar a configuração do kernel
em tempo de inicialização do OpenBSD. Isso somente corrige seu problema
uma vez. Se você reinicializar, você terá que repetir esse procedimento.
Assim sendo, isso é somente uma correção temporária, e você deve
corrigir o problema usando o <a href="#config">config(8)</a>. Seu
kernel, no entanto, precisa da <strong>option BOOT_CONFIG</strong>;
o kernel GENERIC possui essa opção.

<p>
Uma grande parte deste documento pode ser encontrada na página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&amp;sektion=8">boot_config(8)</a>.

<p>
Para inicializar no UKC ("User Kernel Config"), use a opção -c no
momento da inicialização.

<blockquote><pre>
boot&gt; <strong>boot hd0a:/bsd -c</strong>
</pre></blockquote>

Ou qualquer kernel que você queira inicializar. Fazendo isso, aparecerá
um prompt UKC. A partir daí você pode passar comandos diretamente para o
kernel, especificando dispositivos que você quer mudar ou desabilitar,
ou mesmo ativar.

<p>
Aqui está uma lista de comandos comuns no UKC.

<ul>
<li><tt>add <strong>device</strong></tt> - Adiciona um dispositivo
    através da cópia de outro
<li><tt>change <strong>devno | device </strong></tt> - Modifica um ou
    mais dispositivos
<li><tt>disable <strong>devno | device </strong></tt> - Desativa um ou
    mais dispositivos
<li><tt>enable <strong>devno | device </strong></tt> - Ativa um ou mais
    dispositivos
<li><tt>find <strong>devno | device </strong></tt> - Procura um ou mais
    dispositivos
<li><tt>help</tt> - Sumário curto destes comandos
<li><tt>list</tt> - Lista TODOS os dispositivos conhecidos
<li><tt>exit/quit</tt> - Continua a inicialização
<li><tt>show <strong>[attr [val]]</strong></tt> - Mostra dispositivos
    com um atributo e, opcionalmente, com um valor especificado
</ul>

<p>
Uma vez que você tem seu kernel configurado, use <tt>quit</tt> ou
<tt>exit</tt> e continue a inicialização.
Depois disso, você deve fazer a mudança permanente em sua imagem
do kernel, conforme descrito em <a href="#config">Como usar o config(8)
para alterar seu kernel</a>.


<p>
<a name="config"></a>
<h2>5.9 - Como usar o config(8) para alterar seu kernel</h2>
<p>
As opções <b>-e</b> e <b>-u</b> com o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
podem ser extremamente úteis e salvar a perda de tempo compilando seu
kernel. O sinalizador <b>-e</b> permite que você entre na configuração
UKC em um sistema em funcionamento. Essas mudanças terão efeito após a
próxima reinicialização. O sinalizador <b>-u</b> testa para ver se
quaisquer mudanças foram feitas no sistema em funcionamento durante a
inicialização, significando que você usou <b>boot -c</b> para entrar na
configuração UKC enquanto seu sistema inicializava.

<p>
O exemplo seguinte mostra o desabilitamento dos dispositivos
ep* no kernel. Por razões de segurança, você deve usar a opção <b>-o</b>
que escreve as mudanças em um arquivo especificado. Por exemplo:
<strong>config -e -o bsd.new /bsd</strong> grava as mudanças em
bsd.new. O exemplo não usa a opção <b>-o</b>, então mudanças são
apenas ignoradas, e não são escritas de volta no arquivo binário do
kernel. Para mais informações relacionadas a erros e mensagens de aviso,
leia a página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.

<!--XXXver -->
<blockquote><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 4.7 (GENERIC) #558: Thu Mar  17 20:46:15 MDT 2010
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc&gt; <strong>?</strong>
        help                                Command help list
        add             dev                 Add a device
        base            8|10|16             Base on large numbers
        change          devno|dev           Change device
        disable         attr val|devno|dev  Disable device
        enable          attr val|devno|dev  Enable device
        find            devno|dev           Find device
        list                                List configuration
        lines           count               # of lines per page
        show            [attr [val]]        Show attribute
        exit                                Exit, without saving changes
        quit                                Quit, saving current changes
        timezone        [mins [dst]]        Show/change timezone
        bufcachepercent [number]            Show/change BUFCACHEPERCENT
        nkmempg         [number]            Show/change NKMEMPAGES
        shmseg          [number]            Show/change SHMSEG
        shmmaxpgs       [number]            Show/change SHMMAXPGS
ukc&gt; <strong>list</strong>
  0 video* at uvideo* flags 0x0
  1 audio* at uaudio*|btsco*|sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|envy*
|eso*|sv*|neo*|cmpci*|clcs*|clct*|auacer*|auglx*|auich*|auixp*|autri*|auvia*|aza
lia*|fms*|maestro*|esa*|yds*|emu* flags 0x0
  2 midi* at umidi*|sb0|sb*|opl*|opl*|opl*|opl*|opl*|ym*|mpu*|mpu*|autri*|eap* f
lags 0x0
  3 midi* at pcppi0 flags 0x0
  4 drm* at inteldrm*|radeondrm* flags 0x0
  5 inteldrm* at vga0|vga* flags 0x0
  6 radeondrm* at vga0|vga* flags 0x0
  7 radio* at udsbr*|bktr0|fms* flags 0x0
  8 softraid0 at root flags 0x0
  9 nsphy* at url*|udav*|mos*|axe*|aue*|xe*|ef*|hme*|lii*|bce*|ale*|age*|jme*|et
*|nfe*|stge*|vge*|bnx*|bge*|lge*|nge*|msk*|sk*|ste*|sis*|wb*|tl*|vr*|pcn*|sf*|ge
m*|ne0|ne1|ne2|ne*|ne*|ne*|epic*|sm0|sm*|dc*|dc*|re*|re*|rl*|rl*|mtd*|fxp*|fxp*|
xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|ep*|ep* phy -1 flags 0x0
 10 nsphyter* at url*|udav*|mos*|axe*|aue*|xe*|ef*|hme*|lii*|bce*|ale*|age*|jme*
|et*|nfe*|stge*|vge*|bnx*|bge*|lge*|nge*|msk*|sk*|ste*|sis*|wb*|tl*|vr*|pcn*|sf*
|gem*|ne0|ne1|ne2|ne*|ne*|ne*|epic*|sm0|sm*|dc*|dc*|re*|re*|rl*|rl*|mtd*|fxp*|fx
p*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|ep*|ep* phy -1 flags 0x0
[...recorte...]
ukc&gt; <strong>disable ep</strong>
 98 ep0 disabled
 99 ep* disabled
100 ep* disabled
278 ep0 disabled
279 ep0 disabled
280 ep* disabled
281 ep* disabled
344 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</pre></blockquote>

<p>
No exemplo acima, todos os dispositivos ep* são desativados no kernel
e não serão examinados. Em algumas situações onde você tem usado o
UKC durante a inicialização, via <b>boot -c</b>, você precisa dessas
mudanças escritas permanentemente. Para fazer isso, você deve usar a
opção <b>-u</b>. No exemplo seguinte, o computador foi inicializado em
UCK e o dispositivo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">wi(4)</a>
foi desabilitado. Desde que as mudanças feitas com boot -c NÃO são
permanentes, essas mudanças precisam ser gravadas.
Este exemplo grava as mudanças feitas a partir do boot -c em um
novo arquivo binário de kernel chamado bsd.new.

<blockquote><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 4.6 (GENERIC) #58: Thu Jul  9 21:24:42 MDT 2009
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
162 wi* disabled
163 wi* disabled
416 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</pre></blockquote>


<a name="VerboseBoot"></a>
<h2>5.10 - Como obter mais mensagens durante a inicialização</h2>

Obter mais mensagens de saída pode ser muito útil para tentar depurar
problemas durante a inicialização. Se você tem um problema onde seu
disquete de inicialização não inicializa e precisa obter mais
informação, simplesmente reinicialize. Quando você entrar no prompt
&quot;boot&gt;&quot;, inicialize com boot -c. Isso levará você ao
UKC&gt;, então faça:

<blockquote><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enabled
UKC&gt; <strong>quit</strong>
</pre></blockquote>

<p>
Agora você tem muitas mensagens de saída quando inicializar.



<p>
<a name="buildprobs"></a>
<h2>5.11 - Problemas comuns, dicas e perguntas sobre compilação e
construção</h2>
Na maioria das vezes, problemas no processo de compilação são causados
por não se seguir cuidadosamente as direções mostradas acima.
Existem, ocasionalmente, problemas reais com a compilação da versão
<i>-current</i> da mais recente snapshot, mas falhas durante a
compilação da <i>-release</i> ou <i>-stable</i> são quase sempre erro do
usuário.

<p>
A maioria dos problemas são normalmente um dos seguintes:
<ul>
<li>Falha ao começar a partir do <a href="#BldBinary">binário
    apropriado</a>, incluindo tentativa de atualização de versão a
    partir do código fonte, ou achar que uma snapshot de uma semana é
    "próximo o bastante".
<li><a href="#BldGetSrc">Fazer o download</a> do ramo errado da
    árvore.
<li>Não seguir o <a href="faq5.html">processo</a>.
<li>Tentar <a href="#Why">personalizar</a> ou "otimizar" seu sistema.
</ul>

Estes são alguns problemas adicionais que você pode encontrar,
no entanto:

<a name="sig11"></a>
<h3>5.11.1 - A compilação para com um erro "Signal 11"</h3>

<p>
A compilação do OpenBSD e outros programas a partir do código fonte é
uma tarefa que exige mais do hardware do que outras coisas, fazendo
uso intensivo de CPU, disco e memória. Como resultado, se você possui
um hardware que tem um problema, o momento mais apropriado para o
problema aparecer é durante uma compilação. Erros "Signal 11" são
causados <i>tipicamente</i> por problemas de hardware, muitas vezes
problemas de memória, mas também pode ser CPU, placa-mãe, ou problemas
de aquecimento. Seu sistema pode realmente ser muito estável, mas
incapaz de compilar programas.

<p>
Você provavelmente achará melhor reparar ou trocar os componentes que
estão causando problemas, pois os problemas podem se manifestar de
outras formas no futuro. Se você tem um hardware onde você realmente
deseja usar e não te causa outro problema, simplesmente instale uma
snapshot ou uma release.

<p>
Para muito mais informação, veja a
<a href="http://www.bitwizard.nl/sig11/">FAQ Sig11</a>.

<a name="snake"></a>
<h3>5.11.2 - "make build" falha com a mensagem "cannot open output
file snake: is a directory"</h3>

Esse é o resultado de dois erros separados:
<ul>
<li><b>Você não baixou ou atualizou sua árvore CVS corretamente.</b>
    Quando estiver fazendo uma operação de checkout CVS, você deve usar
    a opção "<tt>-P</tt>", quando você está atualizando seu código fonte
    com CVS, você deve usar as opções "<tt>-Pd</tt>" no
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1"
    >cvs(1)</a>,
    como documentado <a href="#BldGetSrc">acima</a>.
    Essas opções asseguram que novos diretórios são adicionados e
    removidos na medida em que o OpenBSD evolui.

<li><b>Você não criou corretamente seu diretório <tt>obj</tt> antes da
    sua compilação.</b> A compilação da árvore sem um diretório
    <tt>/usr/obj</tt> não é suportada.

</ul>
É importante seguir cuidadosamente as instruções ao
<a href="#BldGetSrc">baixar</a> e <a href="#Bld">compilar</a> sua
árvore.

<a name="ProbIPv6"></a>
<h3>5.11.3 - Meu sistema sem IPv6 não funciona!</h3>
Sim.
Por favor, não faça modificações na base do sistema onde você não
entende as implicações delas.
Uma "pequena" mudança no kernel pode ter um impacto muito forte no
resto do sistema inteiro.
Por favor, releia <a href="#Why">isto</a>.


<a name="ProbObj"></a>
<h3>5.11.4 - Opa! Eu esqueci de criar o diretório <tt>/usr/obj</tt>
antes de começar!</h3>

Ao fazer um "make build" antes de um "make obj", você terminará com os
arquivos de objetos espalhados em seu diretório <tt>/usr/src</tt>.
Isso é uma coisa ruim.
Se você deseja tentar evitar fazer novamente o download de toda a
árvore src, você pode tentar o seguinte para limpar seus arquivos obj:
<pre>
    # <b>cd /usr/src</b>
    # <b>find . -type l -name obj | xargs rm</b>
    # <b>make cleandir</b>
    # <b>rm -rf /usr/obj/*</b>
    # <b>make obj</b>
</pre>

<a name="ProbObjPt"></a>
<h3>5.11.5 - Dica: Coloque o diretório <tt>/usr/obj</tt> em sua própria
partição</h3>
Se você compila muitas vezes, pode achar mais rápido colocar o
<tt>/usr/obj</tt> em sua própria partição.
O benefício é simples, é tipicamente mais rápido:
<pre>
    # <b>umount /usr/obj</b>
    # <b>newfs <i>YourObjPartition</i></b>
    # <b>mount /usr/obj</b>
</pre>
do que "rm -rf /usr/obj/*".

<a name="ProbSKIPDIR"></a>
<h3>5.11.6 - Como não compilar partes da árvore?</h3>
Algumas vezes você pode desejar não compilar certas partes da sua
árvore, tipicamente porque você tem instalado um substituto para uma
aplicação incluída a partir dos pacotes, ou deseja fazer uma release
"pequena" por qualquer razão.
A solução para isso é usar a opção SKIPDIR do
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mk.conf&amp;sektion=5">/etc/mk.conf</a>.

<p>
Nota: é possível fazer um sistema quebrado desse modo.
Os resultados dessa opção não são suportados pelo projeto OpenBSD.

<a name="ProbMoreInfo"></a>
<h3>5.11.7 - Onde eu posso aprender mais sobre o processo de compilação?</h3>
Aqui estão algumas outras fontes:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&amp;sektion=8#COMPILING+A">afterboot(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mk.conf&amp;sektion=5">mk.conf(5)</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/Makefile"><tt>/usr/src/Makefile</tt></a>
<li><a href="../../pt/stable.html">Ramo Corrigido</a> (<i>-stable</i>)
<li>(para o X) <tt>/usr/X11R6/README</tt> em seu sistema instalado

</ul>

<a name="NoSnaps"></a>
<h3>5.11.8 - Eu não vejo nenhuma snapshot no sítio FTP. Para onde
elas foram?</h3>

<p>
Snapshots podem ser removidas quando elas se tornam velhas (ou
irrelevantes) ou aproxima-se o momento de uma nova <i>-release</i>.

<a name="NewCompiler"></a>
<h3>5.11.9 - Como iniciar uma nova versão do compilador
(<i>gcc</i>)?</h3>

Você deve realmente apenas
<a href="#BldBinary">instalar a última snapshot</a>.

<p>
O OpenBSD agora suporta dois compiladores na árvore, o gcc v3.3.5, usado
pela maioria das plataformas, mas também o gcc v2.95.3, usado por
algumas plataformas que não foram convertidas ainda, ou que não serão
convertidas devido à carência de suporte ou desempenho pobre do gcc3.

<p>
Os dois compiladores estão em diferentes partes da árvore:
<ul>
<li>gcc3: <tt>/usr/src/gnu/usr.bin/gcc</tt>
<li>gcc2: <tt>/usr/src/gnu/egcs/gcc</tt>
</ul>

<p>
A atualização de versão de um compilador é um pouco como o problema da
galinha e do ovo; mudanças no compilador da árvore requerem uma atenção
extra. Você tem que compilar o compilador duas vezes -- o primeiro
processo de compilação produz um compilador que gera novo código, mas
executa com o código gerado pelo compilador antigo, o segundo processo
de compilação produz um compilador completamente novo.
Geralmente, você vai querer fazer o seguinte procedimento:

<pre>
    <b>Se a sua plataforma usa o gcc 2.95.3:</b>
       # rm -r /usr/obj/gnu/egcs/gcc/*
       # cd /usr/src/gnu/egcs/gcc
        <i>- ou -</i>
    <b>Se a sua plataforma usa o gcc 3.3.5:</b>
       # rm -r /usr/obj/gnu/usr.bin/gcc/*
       # cd /usr/src/gnu/usr.bin/gcc

    <b>Procedimento de compilação similar para v3.3.5 e v2.95.3</b>
    # make -f Makefile.bsd-wrapper clean
    # make -f Makefile.bsd-wrapper obj
    # make -f Makefile.bsd-wrapper depend
    # make -f Makefile.bsd-wrapper
    # make -f Makefile.bsd-wrapper install
    # make -f Makefile.bsd-wrapper clean
    # make -f Makefile.bsd-wrapper depend
    # make -f Makefile.bsd-wrapper
    # make -f Makefile.bsd-wrapper install
</pre>

<p>
E então execute um <a href="#BldUserland">make build</a> normalmente.

<a name="UpdateEtc"></a>
<h3>5.11.10 - Qual é o melhor jeito de atualizar <tt>/etc</tt>,
<tt>/var</tt> e <tt>/dev</tt>?</h3>

<p>Como uma política, software na árvore do OpenBSD não faz modificações
no <tt>/etc</tt> automaticamente.
Isso significa que ele <i>sempre</i> deixa para o administrador fazer
as modificações necessárias aqui.
Atualizações de versão não são exceções.
Para atualizar os arquivos nesses diretórios, primeiro determine
que mudanças ocorreram nos arquivos da base (distribuição), e então
repita manualmente essas mudanças.

<p>
Por exemplo, para ver os arquivos na árvore que foram modificados
mais recentemente, faça um:

<pre>
    # cd /usr/src/etc
    # ls -lt |more
</pre>

<!-- XXXversion -->
<p>Para ver todas as mudanças no <tt>/etc</tt>, entre versões
arbitrárias do OpenBSD, você pode usar o
<a href="../../anoncvs.html">CVS</a>.
Por exemplo, para ver as mudanças entre 4.6 e 4.7, faça um:

<pre>
    # cd /usr/src/etc
    # cvs diff -u -rOPENBSD_4_6 -rOPENBSD_4_7
</pre>

Para ver as mudanças entre 4.7 e <i>-current</i> ("HEAD"), use:
<pre>
    # cd /usr/src/etc
    # cvs diff -u -rOPENBSD_4_7 -rHEAD
</pre>

O script
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">/dev/MAKEDEV</a>
não é atualizado automaticamente como parte do processo make build,
no entanto ele é instalado como parte de uma
<a href="#BldBinary">atualização de versão binária</a>.
Como regra geral, é uma boa ideia copiar (se necessário) e executar esse
script a partir da árvore de código fonte quando estiver fazendo a
atualização de versão:

<pre>
    # cd /dev
    # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
    # ./MAKEDEV all
</pre>

<p>
Uma vez identificadas as mudanças, aplique-as em sua árvore local,
preservando qualquer configuração local que você tenha feito.

<p>
As mudanças típicas em <tt>/etc</tt> a considerar, entre as releases,
incluem:

<ul>
<li>Adições a <tt>/etc/protocols</tt> e <tt>/etc/services</tt></li>
<li>Novos sysctls (veja <tt>/etc/sysctl.conf</tt>)</li>
<li>Mudanças nas tarefas padrões do cron. Veja <tt>/etc/daily</tt>,
    <tt>/etc/weekly</tt>, <tt>/etc/monthly</tt> e <tt>/etc/security</tt>
<li>Todos os scripts rc, incluindo o netstart</li>
<li>Mudanças nos dispositivos, veja acima
<li>Mudanças na hierarquia de arquivos em <tt>/etc/mtree</tt>, veja
    <a href="#Hierarchy">abaixo</a>
<li>Novos usuários (<tt>/etc/passwd</tt>) e grupos (<tt>/etc/group</tt>)
</ul>

<!-- XXXversion -->
Essas mudanças são sumarizadas em
<a href="../upgrade47.html">upgrade47.html</a> (para ir para
4.7-release) ou <a href="../current.html">current.html</a> (para ir para
<i>-current</i>).


<a name="Hierarchy"></a>
<h3>5.11.11 - Há algum jeito fácil de fazer todas as mudanças nos
arquivos da hierarquia?</h3>

<p>
De tempos em tempos, arquivos e diretórios são adicionados ou
removidos do arquivo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hier&amp;sektion=7">hierarchy</a>.
Além disso, a informação de propriedade de partes do sistema de arquivos
pode mudar. Um jeito fácil de assegurar que sua hierarquia está em dia é
usar o utilitário
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>.

<p>
Primeiramente, baixe o código fonte mais recente, então faça o seguinte:

<pre>
    # cd /usr/src/etc/mtree
    # install -c -o root -g wheel -m 600 special /etc/mtree
    # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
    # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre>

<p>
Sua hierarquia de arquivos deve estar em dia agora.

<a name="ProbXComp"></a>
<h3>5.11.12 - Posso fazer compilação cruzada? Por que não?</h3>
Ferramentas de compilação cruzada estão no sistema, para uso pelos
desenvolvedores para a criação de suporte às novas plataformas.
No entanto, elas não são mantidas para uso geral.

<p>
Quando os desenvolvedores trazem o suporte para uma nova plataforma,
um dos primeiros grandes testes é a compilação nativa.
Compilar o sistema a partir do código fonte coloca uma considerável
carga no SO e na máquina, e faz um bom trabalho de testar o quanto bem o
sistema trabalha.
Por essa razão, o OpenBSD faz todo o processo de compilação na
plataforma onde a compilação será usada, processo também conhecido como
"compilação nativa".
Sem a compilação nativa é muito mais difícil ter certeza de que as
várias plataformas estão realmente em funcionamento estável, e não
apenas inicializando.

<p>
<font color= "#0000e0">
<a href= "index.html">[Índice da FAQ]</a>
<a href= "faq4.html">[Seção 4 - Guia de Instalação]</a>
<a href= "faq6.html">[Seção 6 - Redes]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[voltar]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq5.html,v 1.178 ]<br>
$Translation: faq5.html,v 1.13 2010/06/12 20:04:24 renato Exp $<br>
-->
$OpenBSD: faq5.html,v 1.11 2010/06/19 07:38:08 ajacoutot Exp $
</small>
</body>
</html>
