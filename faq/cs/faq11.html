<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>11.0 - Ladìní výkonu</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000"> 

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>11.0 - Ladìní výkonu</font><hr></h2>
</p>

<p>
<ul><h3>Obsah</h3>
<li><a href="#Network">11.1 - Sí»</a></li>
<li><a href="#Disk">11.2 - Diskové I/O operace</a></li>
<!-- li><a href="#kmem">11.3 - Ladìní kmem</a></li -->
<li><a href="#HW">11.4 - Výbìr hardware</a></li>
<li><a href="#Async">11.5 - Proè nepou¾íváme async mount ?</a></li>
<li><a href="#XF86">11.6 - Nastavení rozli¹ení monitoru pod XFree86</a></li>
</ul>
</p> 
<hr>

<p>
Pokud provozujete vytí¾ený server, gateway nebo firewall, mìli byste se
ujistit ¾e jste nastavili nìkteré z defaultních parametrù abyste
získali optimální výkon. 
Manuálová stránka 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>
pojednává o rùzných mo¾nostech jak toto realizovat. Tyto options
jsou umístìny do konfiguraèního souboru kernelu pøedtím ne¾
zkompilujete vlastní kernel. Pro více detailù se podívejte do <a
href="faq5.html">FAQ 5</a>.
<p>
<a name= "Network"></a>
<h2>11.1 - Sí»</h2>
</p>

<p>
Jeden z parametrù, který budete chtít zmìnit na zatí¾eném serveru, gatewayi
nebo firewallu je NMBCLUSTERS.
Ta kontroluje velikost pamìti "kernel mbuf cluster map".
Pokud kernel hlásí nìco jako "mb_map full", mìli byste tuto hodnotu zvý¹it.
Pokud se sí»ový provoz nebo si»ový interface zastaví bez pøíèiny, mù¾e to být
známka toho, ¾e byste mìli hodnotu NMBCLUSTERS zvý¹it.
Rozumná hodnota pro i386 verzi s vìt¹inou 100mbit ethernet interfacù (bez
ohledu na to, jak je stroj rychlý) je 8192.
</p>

<ul>
<strong>
option NMBCLUSTERS=8192<BR>
</strong>
</ul>
Implicitní hodnota NMBCLUSTERS se li¹í platforma od platformy, od
256 do 2048. Je nastavena v platformovì-závislém hlavièkovém
souboru pokud není pøepsána hodnotou v konfiguraèním souboru
kernelu.
<br>

<p>
<a name= "Disk"></a>
<h2>11.2 - Diskové I/O operace</h2>
</p>

<p>
Rychlost diskových I/O operací je dùle¾itý faktor v posuzovaní celkového
výkonu va¹eho poèítaèe. Jeho dùle¾itost se zvy¹uje v multi-u¾ivatelských
prostøedích (bráno pro u¾ivatele jakéhokoliv typu, a» u¾ pro ty kteøí se
logují interaktivnì nebo ty, kteøí pou¾ívají napø. file-server  nebo web
server)
Ukládání dat vy¾aduje soustavnou pozornost, zvlá¹tì kdy¾ na diskových oddílech
dochází místo nebo kdy¾ se zhroutí disk. OpenBSD nabízí nìkolik mo¾ností jak
zrychlit diskové operace a jak poskytnout faul-tolerance øe¹ení.
</p>

<ul>Obsah
	<li><a href="#ccd">CCD</a> - Concatenated Disk Driver.
	<li><a href="#raid">RAID</a>
	<li><a href="#buf">Filesystem Buffer</a>
	<li><a href="#softu">Soft Updates</a>
        <li><a href="#maxvnodes">Velikost namei() cache</a>
</ul>
<p>
<a name="ccd"></a>
<H3>11.2.1 - CCD</H3><UL>
<p>
První mo¾ností je pou¾ít <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&apropos=0&sektion=4&format=html">ccd(4)</a>, Concatenated Disk Driver.
To vám dovolí spojit nìkolik diskových oddílù do jednoho virtuálního disku (a
tak mù¾ete dosáhnout toho, ¾e nìkolik diskù se bude navenek jevit jako jedinný
disk). Tento koncept je podobný jako LVM ("logical volume management"), který
mù¾ete nalézt v mnoha komerèních implementacích UNIXu.
<P>
Jestli¾e je va¹e jádro GENERIC, je u¾ ccd pøipraveno k pou¾ití. 
(v <tt>/usr/src/sys/conf/GENERIC</tt>). Pokud jste upravovali vá¹
kernel, mù¾ete ho zapnout v konfiguraci jádra.
Ka¾dopádnì, øádek jato tento by mìl být ve va¹em konfiguraèním
souboru:
</p>

<p>
<pre>
       <strong>pseudo-device   ccd     4       # concatenated disk devices</strong>
</pre>
</p>

<p>
Vý¹e uvedený pøíklad vám dovolí pou¾ít a¾ 4 ccd zaøízení (virtuální disky).
Teï budete potøebovat zjistit jaké diskové oddíly budete chtít v ccd pou¾ít.
Pou¾ijte disklabel k oznaèení tìchto oddílu pro pou¾ití v ccd tím, ¾e je
oznaèíte jako typ 'ccd'. Na nìkterých architekturách vám to disklabel nemusí
dovolit, v takovém pøípadì je oznaète jako typ 'ffs'.
<p>
Jestli¾e pou¾íváte ccd jako prostøedek k zlep¹ení výkonu, mìli byste vìdìt, ¾e
optimálního výkonudosáhnete pouze pou¾itím stejného modelu disku s tìmi samými
diklabel nastaveními.
<P>
Zeditujte /etc/ccd.conf aby vypadal nìjak takto:
(pro více informací jak zkonfigurovat ccd se podívejte na:
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccdconfig&apropos=0&sektion=8&format=html">ccdconfig(8)</a>)
<UL>
<PRE>
# Konfiguraèní soubor pro ccd disky
#
# ccd   ileave  flags   component devices
ccd0   16      none    /dev/sd2e /dev/sd3e
</PRE></UL>
Aby se zmìny projevily, spus»te:
<UL><PRE># ccdconfig -C
</PRE></UL>
Jestli¾e existuje /etc/ccd.conf, ccd se nastaví po bootu.
Teï máte nový disk ccd0, co¾ je kombinace /dev/sd2e a /dev/sd3e.
Teï mù¾ete pou¾ít disklabel, jako kdybyste normálnì nastavovali diskové
oddíly, které chcete pou¾ít. Opìt, nepou¾ívejte diskový oddíl 'c' pro ukládání
dat. Ujistìte se, ¾e diskové oddíly urèené k pou¾ití budeou aspoò jeden
cylindr vzdálené od zaèátku disku.
</p>
</UL>
<br>

<a name="raid"></a>
<H3>11.2.2 - RAID</H3>
<UL>
<p>
Dal¹ím øe¹ením je <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html">raid(4)</a>,
které budete chtít pou¾ít <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html">raidctl(8)</a>
k obsluze va¹ich raid zaøízení. OpenBSD implementace RAID je zalo¾ena na 
Greg Osterovì <a href="http://www.cs.usask.ca/staff/oster/raid.html">NetBSD
portu</a>
CMU
<a href="http://www.pdl.cs.cmu.edu/RAIDframe/">RAIDframe</a> software.
OpenBSD podporuje RAID úrovní
0, 1, 4, a 5.<P> Raid, stejnì jako ccd, vy¾aduje podporu v KERNELu.
Narozdíl od ccd, podpora pro RAID není obsa¾ena v GENERIC konfiguraci
kernelu, tak¾e musí být zakompilována (RAID podpora pøidá kernelu na 'váze' zhruba o
500K, my¹leno na i386 verzi jádra) 
</p>

<p>
<UL>
<pre>
<strong>pseudo-device   raid   4       # RAIDframe disk device</strong>
</pre>
</UL>
<P>
Nastavení RAIDu na nìkterých operaèních systémech je zmatené a nepøijemné. Ne
tak s RAIDframe.

Pøeètìte si <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raid&apropos=0&sektion=4&format=html">raid(4)</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=raidctl&apropos=0&sektion=8&format=html">raidctl(8)</a>
manuálové stranky pro více detailù. Existuje mnoho
mo¾ností a mo¾ných konfigurací, a detailní vysvìtlení je pro tento dokument moc
detailní.
</UL>
<BR>

<a name="buf"></a>
<H3>11.2.3 - Filesystem Buffer</H3>
<UL>
Pro souborové servery s dostatkem pamìti mù¾ete zvý¹it BUFCACHEPERCENT.
To udává, kolik procent systémové pamìti mù¾e být pou¾ito jako buffer pro
souborové operace. Tato volba se mù¾e zmìnit, a¾ bude 'Unified Buffer Cache'
zakomponováana do systému OpenBSD. Mezitím, pokud chcete zvý¹it tuto hodnotu,
pøidejte do konfigurèního souboru jádra øádku:
</p>

<p>
<UL>
<strong>option	BUFCACHEPERCENT=30</strong><BR>
</UL>
</p>
<p>
Samozøejmì mù¾ete tuto hodnotu sní¾it i na 5 procent (defaultní hodnota) nebo
klidnì 50 procent (nebo více).
</p>
</UL>
<br>

<a name="softu"></a>
<H3>11.2.4 - Soft updates</H3><UL>
Dal¹ím nástrojem, který mù¾e být pou¾it ke zvý¹ení výkonnosti va¹eho systému
jsou tzv. softupdates. Jednou z nejpomalej¹ích operací v BSD file systému je
obnova metainfo hodnot (co¾ se stane ve chvíli, kdy vytváøíte/ma¾ete
soubory/adresáøe). Softupdaty toto øe¹í obnovou metainfa v RAM místo
zapisování na disk pøi ka¾dé operaci, kdy se matainfo mìní.
Toto má dal¹í dodateèný efekt - metainfo na disku by mìlo být v¾dy kompletní,
aèkoliv ne v¾dy úplnì aktuální. To znamená, ¾e kdy¾ spadne systém, nebude
muset být spu¹tìn <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fsck&amp;sektion=8">fsck(8)</a> po bootu, ale jednodu¹e se pustí fsck na pozadí, která
zmìní pøíslu¹né hodnoty v RAM (a la softupdates). To znamená, ¾e rebootovaní
serveru je mnohem rychlej¹í, tím ¾e nemusíte èekat na fsck ! (OpenBSD je¹tì
touto vlastností nedisponuje) Více o softupdatech si mù¾ete pøeèíst v 
<a href="faq14.html#SoftUpdates">softupdates FAQ</a>.
</UL>
</p>
<BR>
<p>
<a name="maxvnodes"></a>
<H3>11.2.5 - Velikost namei() cache</H3>
<DL>
<DD>
<p>
Poznámka: døíve doporuèovala manuálová stránka  
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a>
nastavit volbu jádra <TT>NVNODE=integer</TT>. Toto se ale ji¾ nedoporuèuje; mìli byste pou¾ít
místo toho pøíkaz 
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8&format=html">sysctl(8)</a>.
 </p>
 <p>
Tzv. namei() cache známá také jako name-to-inode translation cache slou¾í pro urychlení pøekladu
názvu souboru na èíslo jeho i-uzlu 
 (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inode&sektion=5&format=html">inode(5)</a>).
Standardnì má tato cache <TT>NPROC * (80 + NPROC / 8)</TT> polo¾ek.  <TT>NPROC</TT> je nastaveno
na <TT>20 + 16 * MAXUSERS</TT>; viz. manuálová stránka 
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>,
kde je vysvìtlen význam polo¾ky <TT>maxusers</TT> v konfiguraci jádra.
Postup pøi získávání optimální hodnoty cache spoèívá v tom, ¾e pomocí nástrojù jako je
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=systat&sektion=1&format=html">systat(1)</a>,
zjistíte jaké procento prohledávání namei() cache (cache lookups) bylo úspì¹né, zjistíte tzv. hit ratio.
Pomocí  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8&format=html">sysctl(8)</a>,
(promìnná její¾ hodnotu hledáme se nazývá v sysctl stromu  "<TT>kern.maxvnodes</TT>") zvý¹íme nastavení
velikosti namei() cache. Hodnotu <i>kern.maxvnodes</i> zvy¹ujeme tak dlouho, dokud pozorujeme nìjaký viditelný
narùst úspì¹nosti zásahu (hit ratio) pøi práci namei() cache. Poté co jste nalezli optimální hodnotu, mù¾ete ji
nastavit pøi startu v 
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5&format=html">sysctl.conf(5)</a>.
 </DD>
 </DL>
 </p>
 <BR>
<p>
<!-- a name= "kmem"></a>
<h2>11.3 - Ladìní kmem</h2>
</p>
Tato èást bvyla pøesunuta do <a href="../faq11-2.5.html#11.2">OpenBSD 2.5 sekce</a>.
<br>
<p -->
<a name= "HW"></a>
<h2>11.4 - Výbìr hardware</h2>
</p>
<i>(Poznámka- tato sekce je hlavnì o i386 (PC) architektuøe.
Jinak øeèeno... ostatní arhitektury vám neávají tolik mo¾ností na výbìr!)
</i>
<P>
Výkon va¹ich aplikací závisí hodnì na OS a slu¾bách které poskytuje. To mù¾e
být jeden z dùvodù pro pou¾íváte OpenBSD.
Výkon va¹ich aplikaí zároveò závisí velkou mìrou na hardware.
Pro mnoho lidí mù¾e být pomìr Cena/Výkon nového PC s procesorem Intel Pentium
IV nebo AMD Athlonem mnohem lep¹í ne¾ pomìr Cena/Výkon u Sun UltraSparc 60!
Samozøejmì, cena OpenBSD je bezkonkurenèní.
<P>
Jestli¾e nakupujete nové PC, a jestli¾e ho sestavujete èást po èásti, budete
se chtít nejprve ujistit, ¾e kupujete spolehlivé èásti. Ve svìtì PC to není
lehké. 

<b>
©patné nebo jinak nespolehlivé èásti mohou mít ¹patný vliv na bìh OpenBSD nebo
dokonce ml¾ou zpùsobovat jeho èastý pád.
</b>.
Nejlep¹í rada terou vám ml¾eme dát je být opatrní, kupovat znaèky nebo èásti
které byly ovìøené autoritou, které dùvìøujete. Nìkdy, kdy¾ na PC ¹etøíte, mù¾ete
zratit na kvalitì!
<P>
Jsou urèité vìci, které vám mohou pøinést maximální výkon:
<UL>
<LI>Pou¾ijte více diskù.
<P>
Kupte více 9GB diskù místo nákupu jednoho 20GB disku. I kdy¾ vás to bude stát
víc, distribuovat záte¾ na více disk sní¾í èas nutný k pøístupu k datùm na
discích. A s více disky mù¾ete dosáhnout vìtí spolehlivosti a rychlej¹ího
pøistupu k datùm pokud pou¾ijete RAID.
<p>
<LI>
Pou¾ívejte SCSI poka¾dé, kdy¾ potøebujete velmi rychlé diskového IO operace.
<P>IDE disky normálnì bì¾í od 5400 RPM do 7200 RPM. Pokud
pou¾íváte high-end IDE disky, bylo by nerozumné oèekávat vy¹¹í prùtok dat ne¾
15 a¾ 20 megabytù za sekundu z jednoho disku.
Pokud pou¾ijete high-end SCSI disky (disky od 10k RPM do 15k RPM stojí o dost více),
mù¾ete dosáhnout výkonu, který je mnohem vy¹¹í ne¾ tyto hodnoty. Pokud se
rozhodnete pou¾ít medium nebo low-end SCSI disky, je to ztráta penìz, IDE
øe¹ení by vám slou¾ilo stejnì dobøe, ne-li lépe.
<P>
Jestli¾e stavíte server a potøebujete více nez 20GB diskového prostoru, mìli
byste uva¾ovat o SCSI. IDE vás limituje dvìma disky na øadiè. Souèasný pøístup
k tìmto diskùm mù¾e mít negativní vliv na I/O výkon tìchto diskù.
Wide SCSI vás limituje 15 disky na øadiè a má lep¹í podporu
souèasného pøístupu ne¾ IDE.
Zatímco SCSI vás stojí více, pru¾nost a výkon mohou být  v jistých prostøedích 
dobrým dùvodem proè pou¾ít toto øe¹ení.
<P>
<li>Pou¾ijte SDRAM namísto DRAM.
<P>
Tato mo¾nost se týká hlavnì PC. Na ostatnéích architekturách nemáte moc
mo¾ností na výbìr jaký typ RAM pou¾ít. S SDRAM doáhnete vy¹¹ího výkonu ne¾
kdybyste pou¾ili DRAM (SIMM moduly). Pokud vá¹ systém podporuje
RDRAM, DDR nebo
jiný typ, jste o krok napøed...
<P>
<li>Pou¾ijte ECC nebo RAM s paritou.
<P>
Konrola parity pøidává mo¾nost vidìt, jestli byla data v RAM po¹kozena. ECC
roz¹iøuje tuto mo¾nost tak, ¾e pøidává funkci jak tyto chyby opravit za bìhu.
Tato mo¾nost se týká hlavnì PC. Na jiných architekruách je jednodu¹e
vy¾adována pøítomnost RAm s paritou nebo ECC. Nìkteré ne-PC architektury
dokonce odmítnout nabootovat s jinou RAM ne¾ s RAM s paritou.
Pokud nepou¾íváte RAM  kontrolou parity/ECC mù¾ete oèekávat po¹kození dat nebo
jiné abnormální jevy. Nìkteøí výrobci RAM dokonce nenabízejí RAM s ECC! To vám
mù¾e napovìdìt, ¾e se jim máte vyhnout! Výrobci PC èasto dodávají nìkolik øad
rozdìlench na "servery" a "workstations". Servery zahrnují zpravidla ECC RAM
ve svých konfiguracích. Výrobci pracovních stanic s Unixem pou¾ívají RAm s
kontrolou parity (a dnes ECC) u¾ nìkolik let ve v¹ech svých produktových
øadách.
<P>
<LI>Vyhnìte se pou¾ití ISA zaøízení.
<P>
IPøesto¾e se mnoho lidí sna¾í vyhnout ISA zaøízením, proto¾e jsou obecnì tì¾¹í
nakonfigurovat, stále jich existuje je¹tì dost. Pokud pou¾íváte ISA sbìrnici
pro va¹e disky nebo sí»ové karty (nebo je¹tì hùøe oboje) pamatujte, ¾e ISA
mù¾e být právì to úzké hrdlo, které omezuje vá¹ výkon. Pokud potøebujete
rychlost, poohlédnìte se po PCI. Samozøejmì, stále exituje nìkolik ISA
sbìrnicových karet, které pracují docela dobøe. Nane¹tìstí vìt¹ina tìchto
karet jsou zvukové karty nebo karty se sériovými porty.
<P>
<LI> Vyhnìte se levným sí»ovým PCI kartám.
<P>
OpenBSD podporuje spostu levných PCI sí»ových adaptérù. Tyto adaptéry pracují
perfektnì v systémech doma, a také v klidných byznys a vývojových prostøedích.
Ale jakmile potrebujete vysoký prùtok a pøitom malou zátì¾ va¹eho serveru,
mìli byste lépe pou¾ít kvalitní PCI adaptér. Nane¹tìstí, nìkteré drahé
znaèkové adaptéry (jako napøíklad øada 3com XL) nejsou o moc lep¹í ne¾ jejich
levné varianty. Na¹e oblíbené adaptéry pro 10/100Mbps ethernet jsou karty
Intel EtherExpress PRO/100.
<b>Poznámka: Toto mù¾eme z hlediska èeského OpenBSD projektu jenom potvrdit.
Levné sí»ové adaptéry mohou dokonce pøi vysokém prùtoku dat zpùsobovat tuhnutí
serveru, o kterém se nedozví ani kernel!</b>
<P>
</ul>
<br>
<p>
<a name= "Async"></a>
<h2>11.5 - Proè nepou¾íváme asynchronní mount?</h2>
<p>
Otázka: "Jednodu¹e provedu "mount -u -o async /" co¾ je nutné pro balík který
pou¾ívám.
(proto¾e èas od èasu vy¾aduje pøístup k nìkolika sotvkám souborù souèasnì)

Proè je asynchronní mount nepou¾íván defaultnì (jako v nìkolika ostatních
unixech ) ? Není to je mnohem jednodu¹¹í a tím pádem i bezpènìj¹í cesta jak
dosáhnout zlep¹ení výkonu v mnoha aplikacích ?"
</p>
<p>
Odpovìï: "Asynchronní mount je opravdu rychlek¹í nez synchronní, ale je naopak
ménì bezpeènìj¹í. Co se stane v pøípadì, ¾e vypadne proud? Nebo hardwarový
problém? Hon za výkonem by nìmel být obìtí spolehlivosti nebo stability
systému. Pøeètìte si manuálovou stránku pro
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=mount&apropos=0&sektion=8&format=html">mount(8)</a>."
</p>
<pre>
	     async   All I/O to the file system should be done asynchronously.
		     This is a dangerous flag to set since it does not guaran-
		     tee to keep a consistent file system structure on the
		     disk.  You should not use this flag unless you are pre-
		     pared to recreate the file system should your system
		     crash.  The most common use of this flag is to speed up
		     restore(8) where it can give a factor of two speed in-
		     crease.
</pre>
<p>
Na druhou stranu, pokud se jedná o temp data která mù¾ete vytvoøit znovu po
crashi, mù¾ete získat rychlost tím, ¾e vytvoøíte oddìlený diskový oddíl, který
budete pou¾ívat pouze pro tato data a bude ho mountovat asychronnì.
Opìt, udìlejte to <i>jen tehdy</i>,  pokud vám
nevadí mo¾nost ztráty v¹ech dat na tomto diskovém oddílu pokud se nìco pokazí.
Z tohoto dùvodu jsou 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=mfs&sektion=8">mfs(8)</a>
oddíly mountovány asynchronnì, proto¾e stejnì budou pøi rebootu
zru¹eny a znovu vytvoøeny.
</p>

<br>
<p>
<a name= "XF86"></a>
<h2>11.6 - nastavení rozli¹ení monitoru pod XFree86</h2>
<p>
Na mnoha multi-async monitorech je mo¾né nastavit pod X serverm pøijatelné
rozli¹ení. Pokud to nìkdo zkou¹el za pomoci standartních utilit jako jsou
xf86config nebo XF86Setup, nedostal pravdìpodobnì nejlep¹í mo¾né rozli¹ení.
Jeden z nejtì¾¹ích úkolù je dostat vámi po¾adované rozli¹ení a zároveò
nastavit vertiklání obnovovací frekvenci aspoò 72-75 Hz, co¾ je dolní hodnota
nad kterou je blikání pro lidské oko ménì viditelné pro vìt¹inu lidí. 
Naopak, mù¾ete chtít nastavit vertikální frekvenci tak, aby byla dost nízká.
Mù¾ete ji nastavit napø. na 50 Hz, tak¾e obraz na monitoru bude mo¾no zachytit
na video bez blikání, ale motody jak thoo dosáhnout jsou ne a¾ tak zøejmé pøi
pou¾ití standartních metod poskyovaných XFree86 a pøislu¹né dokumentaci.
<P>
Koneènì, v rozli¹eních, které pou¾ívá mnoho lidí s docela levnými VGA monitory
(800x600, 1024x768, 1152x900,
1280x1024), 
je mo¾né (aspoò na novìj¹ích monitorech) nastavit vertikální obnovoací
frekvenci na 85Hz a vý¹e k dosa¾ení extrémnì èistého obrazu.
XFree86 X server poskytuje mechanismus, terý vám dovolí popsat detailnì vido
mód který budete chtít pou¾ít, který se nazývá ModeLine. ModeLine má ètyøi
sekce, jedno èíslo pro pixel clock, ètyøi èísla pro horizontální èasování,
ètyøi pro vertikální èasování a nepovinnou sekci, kde je mo¾né nastavit
speciální flagy (jako napø. Interlace, DoubleScan, a dal¹í... Podívejte se na 
manuálovou stránku XF86Config(5) pro více detailù.)
<P>
Vygenerování ModeLine je magie... Na¹tìstí, existuje nìkolik skriptù,
které to mohou udìlat za vás. Jeden je  
<a href="http://www-sop.inria.fr/cgi-bin/koala/nph-colas-modelines">Colas
XFree86 ModeLine Generator</a>. Dal¹í je 
<a href="http://xtiming.sourceforge.net/">The XFree86 Modeline
Generator</a> na SourceForge a nìkolik dal¹ích, které jsou na 
<a href="http://freshmeat.net/search/?q=modeline">Freshmeatu</a>.
Ne¾ pou¾ijete tyto ModeLine generátory, mìli byste si zjistit vertikální a gorizontální
maxima pro vá¹ monitor. Toto je èasto popsáno v dokumentaci nebo na stránce
výrobce. Jestli¾e jste to nena¹li ani tam, zkuste hledat jednodu¹e na webu
znaèku monitoru a model, nìkteøí lidé byli tak laskaví, ¾e slo¾ili seznamy s
tìmito informacemi.
<P>
Na pøíklad, øeknìme, ¾e máte monitor Dell D1226H. Tì¾ce jste na webu
spoleènosti Dell na¹li, ¾e ml¾ete pou¾ít rozmezí 30-95 kHz pro horizontální
frekvence. Podívejte se na stránku ModeLine generatoru a zadejte tuto
informaci. Dále budete potøebovat zadat minimální vetrtikální obnovovací
frekvenci, kterou budete chtít pou¾ít. 
Hodnoty nad 72Hz by mìluy obecnì produkovat docela malé blikání obrazu. S tím
jak pùjdete vý¹e, tím lep¹í bude kvalita a stabilita obrazu.
<P>
Se v¹emi tìmito kousky informace, vygeneruje skript ModeLine pro ka¾dé mo¾né
4x3 ozli¹ení, které vás monitor ml¾e podporovat, aspoò s  hodnotou vertikální
obnovovací frekvence kterou jste zadali. 
Pokud nìkdo zadá paramerty Dell monitoru uvedené vý¹e s nejni¾¹í vertikální
frekvencí 75 Hz, skript vyprodukuje nìco jako následující:
<P>
<PRE>
ModeLine "320x240" 20.07 320 336 416 448 240 242 254 280 #160Hz
ModeLine "328x246" 20.86 328 344 424 456 246 248 260 286 #160Hz
...
ModeLine "816x612" 107.39 816 856 1056 1136 612 614 626 652 #145Hz
ModeLine "824x618" 108.39 824 864 1064 1144 618 620 632 658 #144Hz
ModeLine "832x624" 109.38 832 872 1072 1152 624 626 638 664 #143Hz
...
ModeLine "840x630" 109.58 840 880 1080 1160 630 632 644 670 #141Hz
ModeLine "848x636" 110.54 848 888 1088 1168 636 638 650 676 #140Hz
...
ModeLine "1048x786" 136.02 1048 1096 1336 1432 786 788 800 826 #115Hz
ModeLine "1056x792" 136.58 1056 1104 1344 1440 792 794 806 832 #114Hz
ModeLine "1064x798" 137.11 1064 1112 1352 1448 798 800 812 838 #113Hz
...
ModeLine "1432x1074" 184.07 1432 1496 1816 1944 1074 1076 1088 1114 #85Hz
ModeLine "1576x1182" 199.86 1576 1648 2008 2152 1182 1184 1196 1222 #76Hz
ModeLine "1584x1188" 198.93 1584 1656 2016 2160 1188 1190 1202 1228 #75Hz
</PRE>
<P>
Monitor tvrdí, ¾e umí 1600x1200 @ 75 Hz, ale skript netvrdí, ¾e to je v
rozmezí 75 Hz. Tak¾e, pokud opravdu chcete pou¾ít rozli¹ení 1600x1200, budete
muset o nìco sní¾it minimální evtrtikální frekvenci... (Tady jsme ¹li dolù na
70 Hz)
<Pre>
ModeLine "1592x1194" 197.97 1592 1664 2024 2168 1194 1196 1208 1234 #74Hz
ModeLine "1600x1200" 199.67 1600 1672 2032 2176 1200 1202 1214 1240 #74Hz
ModeLine "1608x1206" 198.65 1608 1680 2040 2184 1206 1208 1220 1246 #73Hz
ModeLine "1616x1212" 197.59 1616 1688 2048 2192 1212 1214 1226 1252 #72Hz
ModeLine "1624x1218" 199.26 1624 1696 2056 2200 1218 1220 1232 1258 #72Hz
ModeLine "1632x1224" 198.15 1632 1704 2064 2208 1224 1226 1238 1264 #71Hz
ModeLine "1640x1230" 199.81 1640 1712 2072 2216 1230 1232 1244 1270 #71Hz
ModeLine "1648x1236" 198.64 1648 1720 2080 2224 1236 1238 1250 1276 #70Hz
</PRE>
<P>
Tady vidíme, ¾e monitor opravdu umí 1600x1200 @ 74 Hz kdy¾ bude bandwidth
limitován na 200MHz. Nastavte bandwidth podle limitù definovaných monitorem.
<P>
Jakmile máte va¹e nastaveni ModeLine, ulo¾te je do souboru /etc/XF86Config.
Zakomentujte staré ModeLine, tak¾e je budete moci pou¾ít znovu, pokud nové
nastavní nebude fungovat.
Dále, vyberte si rozli¹ení, které budete chtít provozovat. Nejdøíve zjistìte,
jestli X server bì¾í v akcelerovaném módu (co¾ je pravda s vìt¹inou karet),
tak¾e víte kterou sekci  <TT>"Screen"</tt> modifikovat.
Nebo jednudu¹e zmìnte v¹echny tyto sekce.
<PRE>
Section "Screen"
   Driver          "Accel"
   Device          "Primary Card"
   Monitor         "Primary Monitor"
   DefaultColorDepth 32
   SubSection "Display"
      Depth        32
      Modes        "1280x1024" "1024x768"
   EndSubSection
</PRE>
První rozli¹ení, kterou vidíte za øádkou s "Modes" je ta frekvence s kerou se
X server spustí. jestli ¾e stisknete CTRL-ALT-KEYPAD MINUS, nebo
CTRL-ALT-KEYPAD PLUS, mù¾ete pøepínat mezi frekvencemi, které jsou zde
ulo¾eny. 
Podle sekce uvedené vý¹e se X server spustí v 32-bit barevném médu (pøes
direktivu DefaultColorDepth, bez ní by se X server spustil v 8-bitovém módu.)
První rozli¹ení které X server zkusí pou¾ít bude 1280x1024 (podle poøadí na
øádce s Modes.) "1280x1024" je pouze oznaèení pøíslu¹né rádky ModeLine.
<P>
ModeLine generator skript má mo¾nosti nastavit volnìji rozmezí èasování pro
star¹í nebo men¹í monitory a zároveò schopnost poskytnout ModeLines pro
specifická rozli¹ení. V zaávislosti na typu hardware, který pou¾íváte nemusí
být moc snadné pou¾ít jej s defaultním nastavením. Pokud je obraz moc vysoký,
¹iroký nebo pøíli¹ malý, nebo je posunutý horizontálnì nebo vertilálnì, a
mo¾nosti monitoru jak nastavit obraz nestaèí, zkuste pou¾ít xvidtune(1) k
nastavení ModeLine aby lépe vyhovovala parametrùm monitoru. 
<P>
Vìt¹ina nových monitorù nemá pevný bandwidth, tak¾e nejsou èasto zahrnuty v
sepcifikacích. Èím vy¹¹í nastavujete bandwidth, tím více se obraz stává
zaml¾enìj¹í.
Tak¾e pokud chcete nastavit optimální bandwidth (èasto nazývaný "dotclock")
mù¾ete testovat (tímto zpùsobem nemù¾ete vás monitor po¹kodit) a pak jít dolù
a¾ do chvíle kdy dostanete èistý obraz.
<P>
Mù¾e to vypada zbyteènì slo¾ité, to proto, ¾e to ve skuteènosti je. XFree86
4.0 se s tímto sna¾í vyrovnat a tento proces zjednodu¹it tím, ¾e má mnoho
módù u¾ zabudovaných a umí si naèíst parametry z "plug and play" monitorù pøes
DDC a DDC2. 
<P>
Colas XFree86 ModeLine Generator script si mù¾ete stáhnout z: 
<a href="ftp://koala.inria.fr/pub/Klone/">ftp://koala.inria.fr/pub/Klone/</a>.
Budete potøebovat Klone interpretr, a zkompilovat ho. Je v portech jako
lang/klone. Skripty se nacházejí v adresáøi s distribucí Klone (port se
nainstaluje do /usr/local/lib/klone/scripts.)
<P>
Existují dvì verze skriptu = jedna je CGI verze identická s tou, která se
nachází na stránce urèené vý¹e. Ta druhá je ne-CGI verze, která vezme vá¹
kompletní XF86Config soubor, dekóduje specifikace monitoru, které jste zadali
do  xf86config/XF86Setup (teï se zamyslete, jestli jste oprabvdu zadali
hodnoty nebo si vybrali z nabízených) a pøenastaví podle toho øádky s
ModeLines.
<p>
<font color= "#0000e0">
<a href= "index.html">[Zpìt na Index]</a>
<a href= "faq10.html">[To Section 10.0 - Administrace systému]</a>
<a href= "faq12.html">[To Section 12.0 - Pro pokroèilé]</a>
</font>
</p>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq11.html,v 1.29 ]
<br>
$Translation: faq11.html,v 1.7 2002/08/17 22:08:54 certik Exp $
<br>
$OpenBSD: faq11.html,v 1.7 2002/08/18 04:43:28 jufi Exp $
</small>

</body>
</html>
