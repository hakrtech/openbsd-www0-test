<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>5 - Vytvoøení systému ze zdrojových kódù</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">
<!-- Passes validator.w3.org.  Please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
<a href= "faq4.html">[Do sekce 4 - Prùvodce instalací]</a>
<a href= "faq6.html">[Do sekce 6 - Nastavení sítì]</a>
</font>

<h1><font color="#e00000">5 - Vytvoøení systému ze zdrojových kódù</font></h1>
<hr>

<p>
<h3>Obsah</h3>
<ul>
<li><a href= "#Flavors">5.1 - Pøíchutì OpenBSD</a>
<li><a href= "#Why">5.2 - Proè potøebuji vlastní jádro?</a>
<li><a href= "#Options">5.3 - Soubory pro konfiguraci jádra</a>
<li><a href= "#Building">5.4 - Tvorba vlastního jádra</a>
<li><a href= "#BootConfig">5.5 - Konfigurace pøi startu</a>
<li><a href= "#VerboseBoot">5.6 - Jak získat podrobnìj¹í výpis
  bìhem bootování</a>
<li><a href= "#config">5.7 - Pou¾ití pøíkazu config(8) pro zmìnu
zkompilovaného jádra</a>
<li><a href="#buildprobs">5.8 - Bì¾né problémy pøi kompilaci a vytváøení
systému</a>
	<ul>
	<li><a href="#sig11">5.8.1 - Build se zastaví s chybou "Signal 11"</a>
	<li><a href="#snake">5.8.2 - "make build" skonèí s hlá¹kou
 "cannot open output file snake: is a directory"</a>
	</ul>
</ul>
<hr>
<br>


<a name="Flavors"></a>
<h2>5.1 - Druhy OpenBSD</h2>
<!-- XXXversion - revise doodle -->

Existují tøi "pøíchutì" OpenBSD:
<blockquote>
<li><b>-release:</b> Verze OpenBSD dodávaná ka¾dých ¹est mìsícù na CD.
<li><b>-stable:</b>  Release, plus opravy pova¾ované za kritické
    pro bezpeènost a spolehlivost.
<li><b>-current:</b> Momentální verze OpenBSD, z které se stane
    dal¹í release.
</blockquote>

Graficky se vývoj tìchto pøíchutí dá znázornit takto:

<blockquote>
<pre>
       ,------o-----------o----X          	    3.0 Stable
       |      .           .
       |      .    ,------o---------o----X	    3.1 Stable
       |      .    |      .         .
       |      .    |      .    ,----o----------o--&gt; 3.2 Stable
       |      .    |      .    |    .	       .
       |      .    |      .    ,    o    ,-----o--&gt; 3.3 Stable
       |      .    |      .    |    .    |     . 
       |      .    |      .    |    .    |     . 
 --&gt;3.0Rel-----&gt;3.1Rel-----&gt;3.2Rel-----&gt;3.3Rel----&gt; Current 

          Èas ---&gt;
</pre>
</blockquote>

<p>
Ka¾dých ¹est mìsícù se kód vìtví do <i>-current</i>, <i>-release</i> a
<i>-stable</i> -- <i>-release</i> se stane zmrazený bod
(&quot;Tag&quot;) v historii stromu zdrojových souborù - nikdy se
nemìní a je to to co je na CD discích a <a href="../ftp.html">FTP
serverech</a>.  <i>-Current</i> je místo, kde probíhá aktivní vývoj
a stane se z nìj dal¹í <i>-release</i> OpenBSD.

<p>
<i>-stable</i> (také známý jako "Patch branch") je zalo¾en na 
<i>-release</i>, a jak ka¾dý mù¾e vidìt, je to "vìtev" z hlavní
vývojové cesty OpenBSD. Dùle¾ité opravy provedené do
<i>-current</i>, jsou "back portovány" do vìtví <i>i-stable</i>.
Na obrázku uvedeném vý¹e odpovídají svislé teèkované èáry opravám chyb,
které jsou pøidávány do vìtvì <i>-stable</i>.
Rovnì¾ si mù¾ete vý¹e v¹imnout, ¾e vìtev <i>3.0-stable</i> byla
ukonèena po vydání <i>3.2-release</i>, a <i>3.1-stable</i> vìtev
<i>3.1-stable</i> byla ukonèena po vydání <i>3.3-release</i> -- star¹í
verze jsou typicky podporovány 2 verze zpìtnì.
Podpora star¹ích verzí zabírá prostøedky a èas, zatímco bychom mohli
poskytovat podporu pro star¹í releasy, chtìli bychom se radìji
zamìøit na vylep¹ování a nové vlastnosti. Vìtev <i>-stable</i> je ze své 
podstaty velmi snadno buildovatelná z <i>-release</i> 
té samé verze (napø. pøechod z <i>3.3-release</i> k <i>3.3-stable</i>).

<p>
Vìtev <i>-stable</i> je typicky shodná s <i>-release</i>, navíc obsahuje
opravy, uvedené na
<a href="../errata.html">stránce errata</a>, a nìkteré jednoduché
opravy, které se nevyskytují v errata.
Obvykle nejsou <i>-stable</i> a <i>release</i> na které je stable
zalo¾en mìnìny, pokud zmìna vy¾aduje úpravu <a
href="http://www.openbsd.org/cgi-bin/man.cgi">manuálové
stránky</a>. Jinými slovy, podpora nových zaøízení NEbude do <i>-stable</i>
nikdy pøidána a podpora pro nové vlastnosti bude pøidána pouze vyjímeènì,
pokud je to velmi dùle¾ité.

<p>
Varování: <i>-current</i> se neustále mìní. Zmìny následují doslova
minutu po minutì a èaso se mù¾e stát, ¾e v dobì, kdy zrovna aktualizujete
zdrojové kódy, dojde k takové zmìnì.
Jak bylo zmínìno døíve, neexistuje ¾ádný slib,
¾e systém se podaøí zkompilovat nebo ¾e bude pracovat (samozøejmì,
doufáme ¾e ano). Je úplnì mo¾né a ne tak výjimeèné, ¾e si stáhnete
zdrojové soubory <i>-current</i> a nepodaøí se vám je zkompilovat,
zatímco o pìt minut pozdìji to mù¾e bì¾et docela dobøe.
Pokud nejste pøipraveni si s tím poradit, dr¾te se od
<i>-current</i> dále.

<p>
Vìt¹ina u¾ivatelù bì¾í buï <i>-stable</i> nebo <i>-release</i>.
Mnoho lidí bì¾í <i>-current</i> na produkèních systémech, a je
dùle¾ité, ¾e nìkteøí lidé tak èiní proto, aby identifikovali chyby
a otestovali nové fíèury. Nicménì, pokud nevíte jak správnì
popsat, diagnostikovat a poradit si s problémem, neøíkejte sobì
(nebo komukoliv jinému), ¾e "pomáháte projektu" tím, ¾e bì¾íte
<i>-current</i>. "Tohle nepracuje!" není <a
href="../report.html#bugtypes">u¾iteèné hlá¹ení o chybì</a>.
"Nedávné zmìny v driveru pciide po¹kodily kompatibilitu s mým IDE
rozhraním zalo¾eném na Slugchip, dmesg funkèního a nefunkèního
systému následují..." mù¾e být u¾iteèné chybové hlá¹ení.

<p>
Stává se, ¾e "normální" u¾ivatelé chtìjí ¾ít na hranì a bì¾í
<i>-current</i>, nejèastìji tehdy, kdy¾ mají zaøízení, které není
podporované v <i>-release</i> (a tím pádem i ve <i>-stable</i>),
nebo chtìjí pou¾ít novou fíèuru v <i>-current</i>. V tomto
pøípadì je volba buï pou¾ívat <i>-current</i> nebo nepou¾ívat ono
zaøízení a <i>-current</i> mù¾e být men¹í zlo. Nicménì, èlovìk
nemù¾e oèekávat pomocnou ruku od developerù.

<h3>Snapshots</h3>
Mezi jednotlivými verzemi OpenBSD jsou na
<a href="../ftp.html">FTP serverech</a> k dispozici tzv. <i>snapshoty</i>.
Jak jméno napovídá, jedná se o build zdrojových kódù, který byl k dispozici
v dobì výroby snapshotu pro tu kterou platformu. Pamatujte si, ¾e 
u urèitých platforem trvá øádovì DNY, ne¾ je build snapshotu dokonèen
a dodán k distribuci. Nikdo nemù¾e slíbit, ¾e snapshot bude kompletnì fungovat,
nebo jej pùjde nainstalovat. Èasto je motivací k vytvoøení snapshotu
provedení dùle¾ité zmìny, kterou je tøeba otestovat. Pro nìkteré platformy
se snapshoty vytváøejí dennì, u jiných ménì frekventovanìji.
Pokud chcete provozovat <i>-current</i>, poslední snapshot je vìt¹inou
to, co potøebujete a upgrade za pou¾ití snapshotu je obvykle dobrý
odrazový mùstek pøedtím ne¾ se pokusíte vybuildovat <i>-current</i>.

<p>
Èas od èasu se nìkdo ptá, zda existuje zpùsob, jak získat kopii pøesnì
toho kódu, ze kterého byl snapshot vytvoøen. Odpovìd zní ne. Jednak
je diskutabilní, na co by to bylo dobré, jednak jsou snapshoty vytváøeny
podle libovùle, podle èasových mo¾ností a podle dostupných zdrojù.
Na rychlých platformách mù¾ete vytvoøit nìkolik snapshotù dennì. Na pomalých
platformách mù¾ete èekat týden, ne¾ se snapshot vytvoøí. Poskytování
tagù nebo znaèek pro ka¾dý snapshot ve zdrojovém kódu by bylo nepraktické.

<h3>Udr¾ování vìcí v souladu</h3>
Je dùle¾ité porozumìt ¾e OpenBSD je Operaèní Systém, my¹lený jako
celek, nejenom kernel s nìkolika utilitami. Musíte zajistit, aby
kernel, "userland" (podpùrné utility a soubory) a strom <a
href="../ports.html"><tt>portù</tt></a> byly, co se týèe jejich
verzí, v souladu. Jinak
se mohou pøihodit nepøíjemné vìci. Jinak øeèeno (proto¾e lidé
prostì poøád dìlají tuto chybu), nemù¾ete bì¾et úplnì nový strom
<tt>portù</tt> na mìsíc starém systému nebo vytváøet kernel ze
zdrojových souborù <i>-current</i> a oèekávát, ¾e bude fungovat
s userlandem z <i>-release</i>. Ano, mù¾ete namítat, ¾e to znamená,
¾e pokud byl nový program
pøidán dnes do <tt>portù</tt>, který chcete pou¾ívat, bude k tomu
nutný update. Litujeme, ale znovu opakujeme: na¹e zdroje jsou omezené.

<p>
Dále je nutné porozumìt tomu, ¾e pøi
<a href="upgrade-minifaq.html">upgrade zdrojových souborù</a>
je aktualizaèní proces podporován <b>pouze v jednom smìru: ze starého na
nový</b>, a z <i>-stable</i> na <i>-current</i>. Nemù¾ete provozovat
<i>3.3-current</i> èi snapshot a poté se rozhodnout, ¾e je to pøíli¹
nebezpeèné a vrátíte se zpìt k <i>3.3-stable</i>. 
Pokud si vyberete jinou cestu ne¾ podporovanou, pak jste v tom sami.

<p>
Ano, toto znamená ¾e pøedtím ne¾ zaènete pou¾ívat <i>-current</i>
mìli byste se dlouze a dùkladnì zamyslet.


<p>
<a name="Why"></a>
<h2>5.2 - Proè bych mìl vytvoøit své vlastní jádro?</h2>

<p>
Nìkolik dùvodù, pøesto¾e vlastní jádro vìt¹inou sestavují pøedev¹ím zku¹ení
u¾ivatelé, kteøí dobøe rozumí celému systému.

<blockquote>
    <li>vá¹ poèítaè má obecnì velmi málo pamìti RAM a vy byste jí rádi co nejvíce
u¹etøili, co¾ provedete vyøazením tìch ovladaèù zaøízení z jádra, které nepou¾íváte, napø. GENERIC jádro i386 architektury má pøibli¾nì velikost 3,1 MB , prùmìrná velikost u¾ivatelského jádra bez nepou¾ívaných ovladaèù je cca 1,7MB.
    <li>Odstraníte nìkteré pùvodní volby, se kterými bylo jádro kompilováno a 
mù¾ete naopak pøidat jiné, které nebyly pùvodnì v konfiguraci zahrnuty
    <li>Mù¾ete pøidat nìkteré volby experimentálního, zku¹ebního významu, které
jsou k dispozici pro testování nového kódu jádra

</blockquote>

<p>
Ve vìt¹inì pøípadù NEbudete potøebovat kompilovat vlastní jádro.
GENERIC jádro bude obvykle tím, které potøebujete. Vlastnì je tu i
nìkolik dùvodù, ze kterých byste nemìli chtít kompilovat va¹e
vlastní jádro. Hlavní dùvod je ten, ¾e je
snadné udìlat nìjaké zmìny v nastavení jádra, které se zdají být
logické, ale nefungují. To je nebezpeèí, které vá¹ zásah provází.
Jestli¾e nìco v novém jádøe nefunguje tak jak by mìlo, vyzkou¹ejte
prosím nejprve GENERIC jádro, døíve ne¾ ode¹lete zprávu o chybì
(bug report). Vývojáøi budou obvykle ignorovat takové hlá¹ení o
chybì, které se zabývají vlastními jádry dokud nebude problém
reprodukován také v GENERIC kernelu. Byli jste varováni.

<p>
<a name= "Options"></a>
<h2>5.3 - Soubory pro konfiguraci jádra</h2>

<p>
Generování OpenBSD jádra je øízeno z nìkolika konfiguraèních souborù,
je¾ jsou umístìny standardnì v adresáøi
<tt>/usr/src/sys/arch/<i>&lt;arch&gt;</i>/conf/</tt>.
V¹echny architektury mají soubor <tt>GENERIC</tt>, který se pou¾ívá
pro vygenerování standardního OpenBSD jádra pro danou platformu (GENERIC jádro).
Dále zde mohou být dal¹í konfiguraèní soubory, které se pou¾ívají pro vytvoøení
jádra s urèitým zamìøením, napø. pro minimální RAM, bezdiskové stanice apod.

<p>
Konfiguraèní soubor je zpracován programem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>,
který vytváøí konfiguraci a kompilaèní adresáø v <tt>../compile</tt>.
V typické instalaci OpenBSD je kompilaèní adresáø umístìn v
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/compile/</tt>.
Program config(8) rovnì¾ vytváøí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">Makefile</a>
a dal¹í soubory, které jsou potøeba pro úspì¹nou kompilaci jádra.

<p>
Volby (options) pøi konfiguraci jádra jsou nastavení, kterými konfigurujete
slo¾ení va¹eho jádra. Tyto nastavení pøidávají pøi
kompilaci do jádra èásti kódu, který realizuje po¾adované operace.
Takto mù¾ete specifikovat pøesnì to co od svého jádra oèekáváte, zahrnout podporu pøesnì pro ta zaøízení, které potøebujete a která pou¾íváte, a naopak vyjmout z jádra ty ovladaèe, které jsou pro vás nepotøebné. Je zde spousta voleb, které
mù¾ete pøi konfiguraci zapnout nebo vypnout. Zde se zamìøíme jen na nìkteré
z nich, pøedev¹ím na ty, které se pou¾ívají nejèastìji. Pro kompletní seznam
tìchto voleb si pøeètìte manuálovou stránku pøíkazu <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a> a proto¾e se seznam tìchto voleb èas od èasu mìní, ujistìtì se, ¾e
máte manuálovou stránku pro stejnou verzi OpenBSD, jako tu, kterou kompilujete.
Mù¾ete se rovnì¾ podívat na pøíklady konfiguraèních souborù, které jsou
dostupné pro va¹i architekturu.

<p>
<b>Nepøidávejte, neodebírejte ani nemìnte volby v konfiguraèním souboru jádra,
pokud pro to nemáte dùvod!</b> Jediná konfigurace jádra, která je podporována
OpenBSD týmem je jádro GENERIC, s kombinací voleb nacházející se v
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/conf/GENERIC</tt> a
<tt>/usr/src/sys/conf/GENERIC</tt> <i>tak jak jsou dodávány OpenBSD týmem</i>
(tj. NE editovány). Reportování problémù s u¾ivatelským jádrem témìø
v¾dy vyústí v to, ¾e budete vyzvání, aby jste reprodukovali problém
s jádrem GENERIC. Ne v¹echny volby jsou kompatibilní jedna s druhou a mnoho
voleb je po¾adováno k tomu, aby systém vùbec mohl fungovat.
Není ¾ádná garance toho, ¾e tím, ¾e se vám podaøí jádro zkompilovat,
tak bude také bez problémù bì¾et.

<p>
Následuje seznam umístìní konfiguraèních souborù jádra pro jednotlivé
architektury:
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Konfiguraèní soubory pro architekturu Alpha</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Konfiguraèní soubory pro i386</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/macppc/conf/">Konfiguraèní soubory pro macppc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Kon
figuraèní soubory pro architekturu sparc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc64/conf/">Kon
figuraèní soubory pro architekturu sparc64</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/vax/conf/">Konfiuraèní soubory pro vax</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/hppa/conf/">Konfiguraèní soubory pro hppa</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Ostatní architektury</a>
</blockquote>

<p>
Pøi bli¾¹ím ohledání tìchto souborù zjistíte, ¾e obsahují øádku
typu:
<pre>
	include "../../../conf/GENERIC"
</pre>
To znamená, ¾e se v nich odkazuje je¹tì na dal¹í konfiguraèní soubor.
V tomto souboru se nacházejí na architektuøe nezávislé volby. Pøi
vytváøení va¹eho vlastního jádra se tedy urèitì podívejte na 
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a>.

<p>
Konfiguraèní volby jádra by mìly být napsány v konfiguraèním souboru jádra
ve formátu :
<blockquote>
<tt>option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><i>jméno</i>
</blockquote>
Kupøíkladu pro pøidáné volby "DEBUG" do jádra, pøidejte øádek:
<pre>
     option      DEBUG
</pre>
Volby v OpenBSD jádøe jsou pøekládány na volby preprocesoru pøi
kompilaci, proto volba jako DEBUG zpùsobí kompilaci zdrojového
kódu s volbou -DDEBUG. Co¾ je ekvivalentní tomu, ¾e bychom ve
v¹ech zdrojových souborech pøipsali <tt>#define DEBUG</tt>.

<p>
Èas od èasu je potøeba vypnout nìjakou volbu, která je u¾ definovaná, typicky
v souboru "<tt>src/sys/conf/GENERIC</tt>". I kdy¾ byste mohli modifikovat
kopii tohoto souboru, lep¹í volba je pou¾ít statement <i>rmoption</i>.
Kupøíkladu pokud skuteènì nechcete zakompilovat interní debugger jádra
(<i>co¾ vám nedoporuèujeme!</i>), pou¾ili v konfiguraèním souboru øádek typu:
<pre>
     rmoption DDB
</pre>
<tt>option DDB</tt> je definováno v <tt>src/sys/conf/GENERIC</tt>, ale
vý¹e uvedený øádek <tt>rmoption</tt> ji deaktivuje.

<p>
Je¹tì jednou bychom vás chtìli poprosit, aby se podívali 
do manuálové stránky
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>,
kde naleznete dostatek informací o jednotlivých volbách jádra. Takté¾
poznamenejme, ¾e mnoho z tìchto voleb má svoji vlastní manuálovou stránku
-- v¾dycky si pøeètìte v¹echno, co je o dané volbì k dispozici, ne¾ 
pøikroèíte k jejímu pøidání nebo odstranìní z jádra.

<p> 
<a name="Building"></a>
<h2>5.4 -  Tvorba va¹eho vlastního jádra</h2>

<p>
Úplné instrukce pro vytvoøení vlastního jádra jsou v manuálové stránce 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&amp;sektion=8">
afterboot(8)</a>.

<p>
Pro kompilaci jádra, které bylo na CD-ROM potøebujete nejprve mít k ruce
zdrojový kód. Zdrojový kód jádra se nachází jak na
<a href="../orders.html">officiálním CD</a> (disk 3), tak na 
<a href="../ftp.html">FTP serverech</a>.
Následující pøíklad pøedpokládá, ¾e CD3 je pøipojeno na /mnt:

<blockquote>
<pre>
# <strong>cd /usr/src</strong>
# <strong>tar xvzf /mnt/src.tar.gz</strong>
</pre>
</blockquote>

<b>Poznámka:</b> Pokud stahujete z FTP serverù, budete potøebovat DVA soubory,
<i>src.tar.gz</i> a <i>sys.tar.gz</i>. První jsou zdrojové kódy
"userlandu" -- v¹e kromì jádra, druhý jsou zdrojové kódy jádra. Stáhnìte
a rozbalte oba dva jako vý¹e, proto¾e povìt¹inou budete potøebovat
oba dva. Na CD-ROM jsou oba dva soubory kombinovány do jednoho.

<p>
Pøi tvorbì vlastního jádra je nejjednodu¹¹í zaèít s GENERIC
jádrem. To se nachází v
<i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>, kde $ARCH je
va¹e architektura. V tomto adresáøi se rovnì¾ nachází dal¹í pøíklady
konfigurací. V následujícím vám uká¾eme dva pøíklady pro kompilaci
jádra. První kompiluje jádro v adesáøovém stromu, který je pouze
pro ètení. Druhý v zapisovatelném adresáøi. 

<blockquote> 
<pre>
# <strong>cd /somewhere</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .</strong>
# <strong>vi SOMEFILE</strong> <i>(udìláte zmìny, které chcete)</i>
# <strong>config -s /usr/src/sys -b . SOMEFILE</strong>
</pre>
následované buï:

<pre>
    # <strong>make depend</strong>
         <b><i>- NEBO -</i></b>
    # <strong>make clean</strong>
# <strong>make</strong>
</pre>
</blockquote>

Musíte spustit '<tt>make depend</tt>' kdy¾ provádíte nìjaké zmìny
(vèetnì updatù a patchù) ve va¹em stromu zdrojových souborù
(jinými slovy skoro v¾dy, dokud nepotøebujete spustit '<tt>make
clean</tt>').

<p>
Pokud jste provedli zmìny do voleb konfigurace jádra, a/nebo  jste
udìlali velké zmìny ve va¹em stromì zdrojových souborù, mìli byste
pou¾ít '<tt>make clean</tt>' namísto vý¹e zmínìného '<tt>made
depend</tt>'. V¾dy je bezpeèné provést 'make clean', aèkoliv to
mù¾e mít za následek del¹í èas kompilace, proto¾e toho bude více
buildováno. 

<p>
Pro kompilaci jádra uvnitø zapisovatelného adresáøového stromu,
vykonejte následující:

<blockquote>
<tt>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi SOMEFILE</strong> (udìláte zmìny, které chcete)
# <strong>config SOMEFILE</strong> (o tomhle si pøeètìte více zde:
 <a href= # "http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>)</i><br>
# <strong>cd ../compile/SOMEFILE</strong>
# <strong>make</strong>
</tt>
</blockquote>

<p>
Kde $ARCH je architektura, kterou pou¾íváte, napø. i386. Mù¾ete rovnì¾ spustit <strong>make depend</strong> pro zji¹tìní závislostí, a¾ budete kompilovat jádro
pøí¹tì.

<p>
Umístìní jádra na své místo.

<blockquote>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd</strong>
</pre>
</blockquote>

Pro pøechod k va¹emu starému jádru v èase startu systému napi¹te pouze:

<blockquote>
<pre>
boot&gt; <strong>bsd.old</strong>
</pre>
</blockquote>

a va¹e staré jádro bude nahráno namísto /bsd.

<p>
Nìkdy budete potøebovat spolu s novým jádrem instalovat i nový
boot blok. Více viz. <a href="faq14.html#InstBoot">
faq14.8 o OpenBSD Bootloaderu</a>. Zde naleznete základní pøehled
o jeho pou¾ívání.

<p>
<a name= "BootConfig"></a>
<h2>5.5 - Konfigurace pøi bootu</h2>

<p>
Nìkdy pøi startu systému se stane, ¾e va¹e jádro nalezne zaøízení,
ale mo¾ná se ¹patným IRQ. A mo¾ná právì toto zaøízení budete muset
ihned pou¾ít. Ani¾ byste museli vytváøet nové jádro, mù¾ete zkusit
konfiguraci  OpenBSD jádra v okam¾iku bootování. Tato konfigurace
opraví vá¹ problém pouze v jednom startu systému. Po rebootování
budete muset tuto proceduru opakovat. Tento postup je tudí¾ my¹len
jen jako doèasná záplata, a problém byste mìli opravit opravou a
rekompilací jádra. Va¹e jádro musí být zkompilované s volbou
<strong>option BOOT_CONFIG</strong>, co¾ pro GENERIC jádra platí.

<p>
Vìt¹ina této dokumentace se nachází v manuálové stránce
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&amp;sektion=8">boot_config(8)</a>.

<p>
Pro start s u¾ivatelskou konfigurací jádra, ( User Kernel Config, UKC) ,
pou¾ijte pøi bootování volbu -c.

<blockquote><pre>
boot&gt; <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

Nebo jakékoliv jiné jádro, které chcete nabootovat. Poté co provedete pøedchozí
krok, obdr¾íte UKC prompt. Odtud mù¾ete vykonávat pøíkazy pøímo specifikující
zaøízení jádra, která chcete zmìnit, vypnout nebo zapnout.

<p>
Zde je seznam pøíkazù v UKC.
<ul>
<li><tt>add <strong>device</strong></tt> - pøidání zaøízení pomocí okopírování jiného
<li><tt>change <strong>devno | device </strong></tt> - zmìna jednoho nebo více zaøízení
<li><tt>disable <strong>devno | device </strong></tt> - vypnutí jednoho nebo více zaøízení
<li><tt>enable <strong>devno | device </strong></tt> - zapnutí jednoho nebo více zaøízení
<li><tt>find <strong>devno | device </strong></tt> - nalezení jednoho nebo více zaøízení
<li><tt>help</tt> - krátký pøehled tìchto pøíkazù
<li><tt>list</tt> - seznam V©ECH známých zaøízení
<li><tt>exit/quit</tt> - pokraèuj v bootování
<li><tt>show <strong>[attr [val]]</strong></tt> - vypí¹e zaøízení s danou vlastností attr a volitelnì s danou hodnotou val
</ul>

<p>
Jakmile jste jednou nakonfigurovali va¹e  zaøízení, pou¾ijte quit nebo exit
a continue pro pokraèování bootování. Poté byste mìli opravit
nastavení jádra a zkompilovat nové jádro. Dal¹í info viz. <a
href="faq5.html#Building"> Tvorba va¹eho vlastního jádra.
</p>

<p>
<a name= "VerboseBoot"></a>
<h2>5.6 - Jak získat podrobnìj¹í výpis bìhem bootování</h2>
</p>

<p>
Podrobnìj¹í výpis pøi bootování mù¾e být velmi u¾iteèný, pokud se
sna¾íte ladit problémy. Pokud napøíklad systém nedetekuje floppy
disk a potøebujete více informací, prostì rebootujete. Poté co
obdr¾íte &quot;boot>&quot; prompt, bootujte s -c. Dostanete 
UKC&gt;, pak vykonejte:
</p>


<blockquote><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enable
UKC&gt; <strong>quit</strong>
</pre></ul>

<p>
Následovat budou extrémnì podrobné startovací hlá¹ky.

<p>
<a name="config"></a>
<h2>5.7 - Pou¾ití pøíkazu config(8) pro zmìnu zkompilovaného jádra</h2>

<p>
Volby <b>-e</b> a <b>-u</b> pøíkazu 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
mohou být velmi u¾iteèné a ¹etøí èas strávený kompilací jádra.
Volba <b>-e</b> umo¾òuje, abyste vstoupili do UKC neboli User
Kernel Configu v bì¾ícím systému. Zmìny, které provedete, se pak
objeví pøi dal¹ím bootu. Volba <b>-u</b> testuje , zda byly
provedeny pøi bootování v jádøe nìjaké zmìny. Za pøedpokladu,
¾e jste pou¾ili <b>boot -c</b> pro vstup do UKC pøi bootování
systému.
</p>

<p>
Následující pøíklad nám ukazuje vyøazení ep* zaøízení z jádra. Pro
¹etrnost va¹eho poèínání musíte pou¾ít volbu <b>-o</b>, která
zapisuje provedené zmìny do souboru, který uvedete. Napø.
<strong>config -e -o bsd.new /bsd</strong> zapí¹e zmìny do bsd.new
. Pøíklad nepou¾ívá volbu <b>-o</b> , proto zmìny jsou ignorovány
a nejsou zapsány zpìt do binárky jádra. Pro více informací o tom,
jak obdr¾et chybové a varovné hlá¹ky, ètìte manuálovou stránku 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.

<blockquote><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 3.3 (GENERIC) #44: Sat Mar 29 13:22:05 MST 2003
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
+ukc&gt; ?
        help                            Command help list
        add         dev                 Add a device
        base        8|10|16             Base on large numbers
        change      devno|dev           Change device
        disable     attr val|devno|dev  Disable device
        enable      attr val|devno|dev  Enable device
        find        devno|dev           Find device
        list                            List configuration
        lines       count               # of lines per page
        show        [attr [val]]        Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
        timezone    [mins [dst]]        Show/change timezone
        nmbclust    [number]            Show/change NMBCLUSTERS
        cachepct    [number]            Show/change BUFCACHEPERCENT
        nkmempg     [number]            Show/change NKMEMPAGES
        shmseg      [number]            Show/change SHMSEG
        shmmaxpgs   [number]            Show/change SHMMAXPGS
ukc&gt; <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*|neo*|cmpci*
|clcs*|clct*|auich*|autri*|auvia*|fms*|uaudio*|maestro*|esa*|yds*|emu* flags 0x0
  1 midi* at sb0|sb*|opl*|opl*|opl*|opl*|ym*|mpu*|autri* flags 0x0
  2 nsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  3 nsphyter* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|
vr*|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep
*|ep*|ep* phy -1 flags 0x0
  4 qsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  5 inphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  6 iophy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  7 eephy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  8 exphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
[...snip...]
ukc&gt; <strong>disable ep</strong>
 67 ep0 disabled
 68 ep* disabled
 69 ep* disabled
155 ep0 disabled
156 ep0 disabled
157 ep* disabled
158 ep* disabled
210 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</pre></blockquote>

<p>
V pøedcházejícím pøíkladì byla v¹echna zaøízení ep* v jádøe
vypnuta a nebudou zkou¹ena pøi startu. V nìkterých situacích, kdy
pou¾ijete pøi bootu UKC, pomocí <b>boot -c</b>, budete chtít zmìny
ulo¾it trvale. Provést to mù¾ete pomocí volby <b>-u</b> . V
následujícím pøíkladì, poèítaè nabootoval do UKC a zaøízení wi(4)
bylo odstranìno. Proto¾e zmìny pøi boot -c  NEJSOU trvalé, musí
být zapsány.
Tento pøíklad zapisuje zmìny provedené z boot -c do nového jádra
ulo¾eného v bsd.new.

<blockquote><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 3.3 (GENERIC) #44: Sat Mar 29 13:22:05 MST 2003
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
105 wi* disabled
106 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</pre></blockquote>

<p>
<a name="buildprobs"></a>
<h2>5.8 - Spoleèné problémy pøi kompilaci a buildování</h2>

<a name="sig11"></a>
<h3>5.8.1 - Build se zastavil s chybou "Signal 11"</h3>

<p>
Buildování OpenBSD a dal¹ích programù ze zdrojových kódù je úloha, která
klade vy¹¹í nároky na hardware ne¾ vìt¹ina ostatních, intezivnì pou¾ívá
procesor, disky a pamì». Výsledkem je, ¾e pokud máte problémový hardware,
s vysokou pravdìpodobností se tyto problémy objeví v prùbìhu buildování.
Chyby typu Signal 11 jsou <i>typicky</i> zpùsobeny problémy s hardware,
èasto se také jedná o problémy s pamìtí, ale mù¾e to být také problém
CPU, základní desky nebo tøeba pøehøátí. Mù¾ete mít systém, který je
v podstatì velmi stabilní, ale na kterém nejste schopni zkompilovat programy,
(tomuhle moc nevìøím, pozn. pøekladatele).

<p>
Zøejmì zjistíte, ¾e je nejjednodu¹¹í opravit nebo nahradit komponenty,
které zpùsobují chyby, proto¾e problémy se do budoucna budou s nejvy¹¹í
pravdìpodobností prohlubovat. Pokud máte hardware, který chcete skuteènì
pou¾ít a máte s ním problémy, jednodu¹e nainstalujte snapshot nebo release
(nebo tøeba zkuste NetBSD).

<p>
Více informací najdete napø. v 
<a href="http://www.bitwizard.nl/sig11/">Sig11 FAQ</a>.

<a name="snake"></a>
<h3>5.8.2 - "make build" skonèí s hlá¹kou "cannot open output file snake: is
a directory"</h3>

Jedná se o výsledek dvou rùzných chyb:
<ul>
<li><b>Nesprávnì jste provedly update èi sta¾ení va¹eho CVS stromu.</b>
V prùbìhu operace CVS checkout musíte pou¾ít volbu "<tt>-P</tt>",
pokud provádíte update zdrojových kódù s CVS, musíte pou¾ít
volby "<tt>-Pd</tt>" programu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1"
>cvs(1)</a>, jak je zdokumentováno v <a href="../../cs/anoncvs.html">prùvodci
anoncvs</a>, <a href="upgrade-minifaq.html">upgrade-minifaq</a> a
<a href="faq8.html#CVS">FAQ</a>. Tyto volby vám zajistí, ¾e jsou pøidány
nové adresáøe a odstranìny prázdné adresáøe, které u¾ nejsou ve stromu
zapotøebí.

<li><b>Nesprávnì jste vytvoøili adresáø <tt>obj</tt> pøed zapoèetím buildu.</b>
Buildování stromu bez adresáøe <tt>/usr/obj</tt> není podporováno.

</ul>
Je dùle¾ité peèlivì následovat instrukce, kdy¾
<a href="../../cs/anoncvs.html">stahujete a aktualizujete</a> va¹e
zdrojové kódy a <a href="upgrade-minifaq.html">buildujete</a> vá¹ strom.

<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
<a href= "faq4.html">[Do sekce 4 - Prùvodce instalací]</a>
<a href= "faq6.html">[Do sekce 6 - Nastavení sítì]</a>
</font>

<p>
<hr>
+<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq5.html,v 1.87 ]
<br>
$Translation: faq5.html,v 1.14 2003/10/29 08:13:12 certik Exp $
<br>
$OpenBSD: faq5.html,v 1.14 2003/10/30 18:00:22 horacio Exp $
</small>
</body>
</html>
