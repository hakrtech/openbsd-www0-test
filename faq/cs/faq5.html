<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>5.0 - Buildování systému ze zdrojových souborù</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">
<!-- Passes validator.w3.org.  Please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color="#e00000">5.0 - Buildování systému ze zdrojových
souborù</font></h2>
<hr>

<p>
<h3>Obsah</h3>
<blockquote>
<li><a href= "#Flavors">5.1 - Pøíchutì OpenBSD</a></li>
<li><a href= "#Why">5.2 - Proè potøebuji vlastní jádro?</a></li>
<li><a href= "#Options">5.3 - Volby pøi konfiguraci jádra</a></li>
<li><a href= "#Building">5.4 - Tvorba vlastního jádra</a></li>
<li><a href= "#BootConfig">5.5 - Konfigurace pøi startu</a></li>
<li><a href= "#VerboseBoot">5.6 - Jak získat podrobnìj¹í výpis
  bìhem bootování</a></li>
<li><a href= "#config">5.6 - Pou¾ití pøíkazu config(8) pro zmìnu
zkompilovaného jádra</a>
</blockquote>
<hr>
<br>


<a name="Flavors"></a>
<h2>5.1 - Druhy OpenBSD</h2>

Existují døi "pøíchutì" OpenBSD:
<blockquote>
<li><b>-release:</b> Verze OpenBSD dodávaná ka¾dých ¹est mìsícù na CD.
<li><b>-stable:</b>  Release, plus patche pova¾ované za kritické
    pro bezpeènost a spolehlivost.
<li><b>-current:</b> Momentální verse OpenBSD, z které se stane
    dal¹í release.
</blockquote>

Graficky se vývoj tìchto pøíchutí dá znázornit takto:

<blockquote>
<pre>
       ,------o-----------o----X          2.9 Stable
       |      .           .
       |      .    ,------o---------o---> 3.0 Stable
       |      .    |      .         .
       |      .    |      .    ,----o---> 3.1 Stable
       |      .    |      .    |    .
       |      .    |      .    |    .
 -->2.9Rel----->3.0Rel----->3.1Rel------> Current 

          Time --->
</pre>
</blockquote>

<p>
Ka¾dých ¹est mìsícù je kód vyvìtven mezi <i>current</i>, <i>release</i> a
<i>stable</i> -- <i>release</i> se stane zmrazený bod
(&quot;Tag&quot;) v historii stromu zdrojových souborù - nikdy se
nemìní a je to to co je na CD discích a <a href="../ftp.html">FTP
serverech</a>.  <i>Current</i> je místo, kde probíhá aktivní vývoj
a stane se z nìj dal¹í release OpenBSD.

<p>
<i>-stable</i> (také známý jako "Patch branch") je zalo¾en na 
<i>-release</i>, a jak ka¾dý mù¾e vidìt, je to "vìtev" z hlavní
vývojové cesty OpenBSD. Dùle¾ité opravy provedené do
<i>-current</i>, jsou "back portovány" do vìtví <i>i-stable</i>.
Také si v¹imnete, ¾e v pøíkladì uvedeném vý¹e byla vìtev
2.9-stable ukonèena s 3.1-release -- staré release jsou typicky
podporovány do dvou release zpìtnì. Podpora star¹ích verzí zabírá
prostøedky a èas, zatímco bychom mohli poskytovat podporu pro
star¹í releasy, chtìli bychom se zamìøit na nové fíèury. Vìtev
<i>-stable</i> z hlediska svého návrhu velmi snadno buildovatelná
z release té samé verze (napø. pøechod z 3.1-release na
3.1-stable).

<p>
Typicky, co jde do <i>-stable</i> jsou opravy nalezené na 
<a href="../errata.html">stránce errata</a>, a nìkteré jednoduché
opravy, které se nevyskytují v errata.
Obvykle nejsou <i>-stable</i> a <i>release</i> na které je stable
zalo¾en mìnìny, pokud zmìna vy¾aduje úpravu <a
href="http://www.openbsd.org/cgi-bin/man.cgi">manuálové
stránky</a>. Podpora nových zaøízení nebude do <i>-stable</i>
pøidána. 

<p>
<i>-current</i> je pohybující se cíl.  Mìní se skoro minutu po
minutì, a mù¾e být zmìnìn nìkolikrát za èas za který stáhnete
zdrojové soubory. Jak bylo zmínìno døíve, neexistuje ¾ádný slib,
¾e systém se podaøí zkompilovat nebo ¾e bude pracovat (samozøejmì,
doufáme ¾e ano). Je úplnì mo¾né a ne tak výjimeèné, ¾e si stáhnete
zdrojové soubory <i>-current</i> a nepodaøí se vám je zkompilovat,
zatímco o pìt minut pozdìji to mù¾e bì¾et docela dobøe.
Pokud nejste pøipraveni si s tím poradit, dr¾te se od
<i>-current</i> dále.

<p>
Vìt¹ina u¾ivatelù bì¾í buï <i>-stable</i> nebo <i>-release</i>.
Mnoho lidí bì¾í <i>-current</i> na produkèních systémech, a je
dùle¾ité, ¾e nìkteøí lidé tak èiní proto, aby identifikovali chyby
a otestovali nové fíèury. Nicménì, pokud nevíte jak správnì
popsat, diagnostikovat a poradit si s problémem, neøíkejte sobì
(nebo komukoliv jinému), ¾e "pomáháte projektu" tím, ¾e bì¾íte
<i>-current</i>. "Tohle nepracuje!" není <a
href="../report.html#bugtypes">u¾iteèné hlá¹ení o chybì</a>.
"Nedávné zmìny v driveru pciide po¹kodily kompatibilitu s mým IDE
rozhraním zalo¾eném na Slugchip, dmesg funkèního a nefunkèního
systému následují..." mù¾e být u¾iteèné chybové hlá¹ení.

<p>
Jsou èasy, kdy "normální" u¾ivatelé chtìjí ¾ít na hranì a bì¾í
<i>-current</i>, nejèastìji tehdy, kdy¾ mají zaøízení, které není
podporované v <i>-release</i> (a tím pádem i ve <i>stable</i>),
nebo chtìjí pou¾ít novou fíèuru v <i>-current</i>. V tomto
pøípadì je volba buï pou¾ívat <i>-current</i> nebo nepou¾ívat ono
zaøízení a <i>-current</i> mù¾e být men¹í zlo. Nicménì, èlovìk
nemù¾e oèekávat pomocnou ruku od developerù.

<h3>Udr¾ování vìcí syncnutých</h3>
Je dùle¾ité porozumìt ¾e OpenBSD je Operaèní Systém, my¹lený jako
celek, nejenom kernel s nìkolika utilitami. Musíte zajistit, aby
kernel, "userland" (podpùrné utility a soubory) a strom <a
href="../ports.html"><tt>portù</tt></a> byly v¹echny syncnuté nebo
se mohou pøihodit nepøíjemné vìci. Jinak øeèeno (proto¾e lidé
prostì poøád dìlají tuto chybu), nemù¾ete bì¾et úplnì nový strom
<tt>portù</tt> na mìsíc starém systému nebo rebuildovat kernel ze
zdrojových souborù -current a oèekávát, ¾e bude pracovat s
userlandem z <i>-release</i>. 

are all in sync, or unpleasant things will happen.  Said another
way na mìsíc starém systému nebo rebuildovat kernel ze zdrojových
souborù -current a oèekávát, ¾e bude pracovat s userlandem z
<i>-release</i>. A ano, to znamená, ¾e pokud byl nový program
pøidán dnes do <tt>portù</tt>, který chcete pou¾ívat, bude k tomu
nutný update. Sorry, ale znovu, OpenBSD má omezené prostøedky.

<p>
Dále je nutné porozumìt tomu, ¾e upgradováním zdrojových souborù
je proces podporován <b>pouze v jednom smìru: ze starého na
nový</b>, a z <i>-stable</i> na <i>-current</i>. Nemù¾ete se
pøesunout z post 3.1 na 3.1-stable, a oèekávat podporu nebo
asistenci vývojového týmu. Pokud si vyberete jinou cestu ne¾
podporovanou - reload systému od zaèátku, jste v tom sami.

<p>
Ano, toto znamená ¾e pøedtím ne¾ zaènete pou¾ívat <i>-current</i>
mìli byste se dlouze a dùkladnì zamyslet.


<p>
<a name= "Why"></a>
<a name= "5.1"></a>
<h2>5.2 - Proè bych mìl vytvoøit své vlastní jádro?</h2>

<p>
Nìkolik dùvodù, pøesto¾e vlastní jádro vìt¹inou sestavují pøedev¹ím zku¹ení
u¾ivatelé, kteøí dobøe rozumí celému systému.

<blockquote>
    <li>vá¹ poèítaè má obecnì velmi málo pamìti RAM a vy byste jí rádi co nejvíce
u¹etøili, co¾ provedete vyøazením tìch ovladaèù zaøízení z jádra, které nepou¾íváte, napø. GENERIC jádro i386 architektury má pøibli¾nì velikost 3,1 MB , prùmìrná velikost u¾ivatelského jádra bez nepou¾ívaných ovladaèù je cca 1,7MB.
    <li>Odstraníte nìkteré pùvodní volby, se kterými bylo jádro kompilováno a 
mù¾ete naopak pøidat jiné, které nebyly pùvodnì v konfiguraci zahrnuty
    <li>Mù¾ete pøidat nìkteré volby experimentálního, zku¹ebního významu, které
jsou k dispozici pro testování nového kódu jádra

</blockquote>

<p>
Ve vìt¹inì pøípadù NEbudete potøebovat kompilovat vlastní jádro.
GENERIC jádro bude obvykle tím, které potøebujete. Vlastnì je tu i
nìkolik dùvodù, ze kterých byste nemìli chtít kompilovat va¹e
vlastní jádro. Hlavní dùvod je ten, ¾e je
snadné udìlat nìjaké zmìny v nastavení jádra, které se zdají být
logické, ale nefungují. To je nebezpeèí, které vá¹ zásah provází.
Jestli¾e nìco v novém jádøe nefunguje tak jak by mìlo, vyzkou¹ejte
prosím nejprve GENERIC jádro, døíve ne¾ ode¹lete zprávu o chybì
(bug report). Vývojáøi budou obvykle ignorovat takové hlá¹ení o
chybì, které se zabývají vlastními jádry dokud nebude problém
reprodukován také v GENERIC kernelu. Byli jste varováni.

<p>
<a name= "Options"></a>
<a name= "5.2"></a>
<h2>5.3 - Volby pøi konfiguraci jádra</h2>

<p>
Volby (options) pøi konfiguraci jádra jsou nastavení, kterými konfigurujete
slo¾ení va¹eho jádra. Tyto nastavení pøidávají pøi
kompilaci do jádra èásti kódu, který realizuje po¾adované operace.
Takto mù¾ete specifikovat pøesnì to co od svého jádra oèekáváte, zahrnout podporu pøesnì pro ta zaøízení, které potøebujete a která pou¾íváte, a naopak vyjmout z jádra ty ovladaèe, které jsou pro vás nepotøebné. Je zde spousta voleb, které
mù¾ete pøi konfiguraci zapnout nebo vypnout. Zde se zamìøíme jen na nìkteré
z nich, pøedev¹ím na ty, které se pou¾ívají nejèastìji. Pro kompletní seznam
tìchto voleb si pøeètìte manuálovou stránku pøíkazu <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>. Mù¾ete se rovnì¾ podívat na pøíklady konfiguraèních souborù, které jsou
dostupné pro va¹i architekturu.

<p>
Ne v¹echny volby byly testovány na kompatibilitu s jinými.
Nepøidávejte do jádra volbu, pokud nemáte skuteènì dùvod tak
uèinit! Jediná konfigurace jádra,
která byla dostateènì testována, je GENERIC kernel. Jedná se
obvykle o kombinaci voleb v
<tt>/usr/src/sys/arch/`arch -s`/conf/GENERIC</tt>
a <tt>/usr/src/sys/conf/GENERIC</tt>. 

<p>
<blockquote>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Konfiguraèní soubory pro architekturu Alpha</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Konfiguraèní soubory pro i386</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/">Konfiguraèní soubory pro mac68k</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sun3/conf/">Kon
figuraèní soubory pro sun3</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Kon
figuraèní soubory pro architekturu sparc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Ostatní architektury</a>
</blockquote>

<p>
Pøi bli¾¹ím ohledání tìchto souborù zjistíte, ¾e obsahují øádku
typu:<br>
<strong>include "../../../conf/GENERIC"</strong><br>
To znamená, ¾e se v nich odkazuje je¹tì dal¹í konfiguraèní soubor.
V tomto souboru se nacházejí na architektuøe nezávislé volby. Pøi
vytváøení va¹eho
vlastního jádra se tedy urèitì podívejte na 
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a>.
<b>jsou</b> zde volby, které jsou <b>nutné</b>.
</p>

<p>
V¹echny z dále uvedených voleb, by mìly být umístìny ve va¹em
konfiguraèním souboru jádra ve formátu:<br>
<strong>option      VOLBA</strong><br>
napøíklad chcete-li mít jádro s podporou ladìní (volba DEBUG), pøidejte øádek: <br>
<strong>option      DEBUG</strong><br>
Volby v OpenBSD jádøe jsou pøekládány na volby preprocesoru pøi
kompilaci, proto volba jako DEBUG zpùsobí kompilaci zdrojového
kódu s volbou -DDEBUG. Co¾ je ekvivalentní tomu, ¾e bychom ve
v¹ech zdrojových souborech pøipsali #define DEBUG.

<p>
OpenBSD má mnoho voleb týkajících se kompatibility, které vám
umo¾òují spou¹tìt binární soubory z jiných operaèních systémù. Ne
v¹echny jsou dostupné pro ka¾dou architekturu, proto se ujistìte v
manuálové stránce, ¾e daná volba pro danou architekturu je
podporována.

<p>
<blockquote>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SVR4(8)</a> 
  - Kompatibilita programù ze SVR4<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_BSDOS(8)</a> - Kompatibilita programù z BSD.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_LINUX(8)</a> 
  - Kompatibilita Linuxového kódu.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SUNOS(8)</a> 
  - Kompatibilita programù z SunOS.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_ULTRIX(8)</a> 
  - Kompatibilita programù z Ultrixu.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_FREEBSD(8)</a> 
  - Kompatibilita kódu pro FreeBSD.
<li>COMPAT_HPUX 
  - Kompatibilita programù pro HP-UX. Dostupná pouze pro nìkteré
    m68k architektury.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_IBCS2(8)</a> 
  - Kompatibilita pro spou¹tìní kódu z ibcs2
<li>COMPAT_OSF1 
  - Pro spu¹tìní kódu z Digital Unix. Dostupná pouze pro platformu Alpha.
<li>COMPAT_43 
  - Kompatibilita s 4.3BSD. Pou¾ití této volby se nedoporuèuje.
    Je v¹ak nutná pro ná¹ port Netscape Navigator.
<li>COMPAT_11 - Kompatibilita s NetBSD 1.1
<li>COMPAT_NOMID 
  - Kompatibilita pro binárky ve formátu a.out s
    chybìjícím ID systému.
</blockquote>

<p>
V¾dy je vhodné umo¾nit ladìní kódu jádra. Hodnì lidí sice tyto
volby odstraòuje, proto¾e jsou zdrojem velkého mno¾ství dal¹ího
kódu jádra a tedy zvy¹ují jeho velikost. Jsou v¹ak velmi výhodné v
pøípadì, ¾e se objeví nìjaká chyba v kódu jádra. Pomáhají
vývojáøùm objevit zdroj problémù mnohem rychleji. Zde je seznam
nejèastìj¹ích voleb pro ladìní, které mù¾ete pøidat do va¹í
konfigurace.
</p>

<p>
<blockquote>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html">DDB</a> 
  - Tato volba zakompiluje do jádra interní debugger. Není k
    dispozici na v¹ech platformách. Proto si nejdøíve o ní
    pøeètìte v dokumentaci.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html">KGDB</a> 
  - Tato volba zakompiluje do jádra remote kernel debugger.
    Umo¾òuje debugování jádra bì¾ícího na cílovém stroji z jiného
    poèítaèe pomocí gdb, tak¾e se celý proces debugování neli¹í od
    ladìní jakéhokoliv jiného programu. Oba stroje jsou spojeny
    sériovým kabelem pøes COM port, gdb bì¾ící na vzdáleném
    (remote) stroji se spojí po startu s debugovaným kernelem na
    druhém poèítaèi. Na vzdáleném stroji mù¾eme pou¾ít i grafické
    nástavby ke gdb, jako je ddd . Více o nastavení remote kernel
    debuggeru na <a
    href="http://www.netbsd.org/Documentation/kernel/kgdb.html">kgdb.html.</a>,
    opìt je ale nutné pøipomenout, ¾e pro øadu
    architektur (ne-li v souèasnosti pro v¹echny) není k dispozici
    <li>makeoptions  DEBUG="-g" - Vytvoøí spolu s bsd také bsd.gdb .
    Dodá do zkompilovaného jádra úplnou tabulku ladících symbolù.
    Pou¾ívá se pro debugování jádra pomocí gdb. Vzhledem k tomu, ¾e
    velikost jádra s pøíponou .gdb dosahuje øádovì 34.0 MB, je rozumné
    ji pou¾ívat pouze 'offline' s odpovídajícím kernel c0re. 
<li>DEBUG 
  - Pøidává do jádra rùzné ladící volby, tam kde jsou ve zdrojovém kódu
    definovány.
<li>KTRACE 
  - Pøidává do jádra kód pro sledování volání jádra. Dovoluje
    u¾ivatelùm pou¾ívat <a
    href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html">ktrace(1)</a>.
<li>DIAGNOSTIC 
  - Pøidává do jádra kód, který kontroluje interní konzistenci
    datových struktur.
<li>GPROF 
  - Pøidává do jádra kód pro kernel profiling spolu s <a
    href="http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html">kgmon(8)</a>.
<li>makeoptions PROF="-pg" - volba -pg zpùsobuje, ¾e jádro je
  kompilované s podporou pro profiling.  Pro pou¾ití musíte dodat
  rovnì¾ volbu GPROF.
</blockquote>

<p>
<strong>Filesystem Options.</strong>
<blockquote>
<li>FFS - Berkeley Fast Filesystem <strong>POZN:</strong> Tato
  volba je NUTNÁ
<li>EXT2FS - Second Extended File System, nutné pro ty z vás,
  kteøí budou chtít èíst Linuxové oddíly.
<li>MFS - Memory File System který skladuje soubory ve
i  swapovatelné pamìti.
<li>NFS - Network File System, je potøeba tam, kde budete pou¾ívat
  NFS.
<li>CD9660 - iso9660 + rockridge extensions filesystem. NUTNÁ pro
  ètení z CD.
<li>MSDOSFS - Nutná pro ètení MS-DOS FAT filesystému. Obsahuje i
  podporu pro Windows 95 dlouhá jména souborù + rùzné znaky ve
  jménech souborù.
<li>FDESC - Obsahuje kód pro souborový systém, který mù¾e být
  pøipojen na /dev/fd.
<li>KERNFS - Pøidává kód, který umo¾òuje pøipojení speciálního
  souborového systému (bì¾nì pøipojeném na /kern) se soubory,které
  reprezenují èetné promìnné jádra a jeho parametry (pøíli¹ se
  nepou¾ívá)
<li>NULLFS - Kód pro loopback filesystém. Více viz. <a
  href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html">mount_null(8)</a>
<li>PROCFS - Kód pro speciální filesystém (obvykle pøipojený na
  /proc), opìt (narozdíl od FreeBSD), se nepou¾ívá.
<li>PORTAL - Kód pro experimentální portal filesystém. Tento
  souborový systém
  dovoluje zajímavé triky, jako napø. otevøení TCP socketu
  prostøednictvím otevøení souboru ve file systému.
<li>UMAPFS - Obsahuje kód pro loopback filesystém, ve kterém mohou
  být user a group ids pøemapována -- toto mù¾e být u¾iteèné v
  pøípadì pøipojení cizího filesystému s odli¹nými uids a gids ne¾
  lokální filesystém (napø. vzdálený NFS). 
<li>UNION - Pøidává kód pro union filesystém, který umo¾òuje, aby
  adresáøe byly namountovány na sebe tím zpùsobem, aby oba file
  systémy zùstaly viditelné.
  Tento kód není zatím stabilní.
<li>XFS - Pøidává podporu pro pou¾ívání filesystému kompatibilních
  s AFS filesystémem. Bì¾nì pou¾íváno kódem Arla/AFS.
<li>LFS - Log Structured Filesystem.
<li>FFS_SOFTUPDATES - umo¾òuje softupdates. Více o softupdates v
  <a href="faq14.html#SoftUpdates">Softupdates FAQ</a>.
<li>NFSSERVER - Pøidává do jádra kód pro NFS server.
<li>NFSCLIENT - Pøidává do jádra kód pro NFS klienta.
<li>FIFO - Podpora pro FIFO (pojmenovaná roura). Ta by NEmìla chybìt.
<li>NVNODE=integer - kde integer je velikost cache pou¾ívané
  pøekladovou rutinou name-to-inode, (napø. namei() cache a jiné
  podobnì pojmenované)..
<li>EXT2FS_SYSTEM_FLAG - tato volba mìní chování flagù APPEND a
  IMMUTABLE pro soubor na EXT2FS filesystému. Více viz <a
  href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a>.
<li>QUOTA - Podpora pro kvóty ve filesystému. Pou¾ívání kvót více
  viz <a href="faq10.html#Quotas">FAQ 10, Quota</a>
</blockquote>


<strong>Rùzné volby</strong>
<blockquote>
<li>PCIVERBOSE - podrobnìj¹í výpis pøi bootování pro zaøízení PCI.
<li>EISAVERBOSE - podrobnìj¹í výpis pøi bootování pro zaøízení EISA.
<li>PCMCIAVERBOSE - podrobnìj¹í výpis pøi bootování pro zaøízení PCMCIA.
<li>APERTURE - dodává interní podporu jádra pro VGA framebuffer mapování u¾ivatelským procesem. Nutné pro spu¹tìní X.
<li>XSERVER - Podpora pro X server console driver. Nutné pro X.
<li>LKM - podpora pro Loadable Kernel Modules. Není na v¹ech architekturách. Více viz.  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html">lkm(4)</a>, pøíli¹ se nepou¾ívá .
<li>INSECURE - Pevnì stanoví hodnotu kernel security levelu na -1. Více viz.  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a> pro informace o kernel security levelech..
<li>RAM_DISK_HOOKS - Umo¾òuje volat na architektuøe závislé funkce, poté co je nakonfigurován ramdisk (jako napø. nahrání druhé diskety po jejím vlo¾ení).
<li>RAM_DISK_IS_ROOT - Pevnì stanoví ramdisk jako root device .
<li>CCDNBUF=integer - nastaví poèet component bufferù pou¾ívaných CCD(4). Default je 8. Více o CCD viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html">CCD(4)</a> man page, nebo <a href="faq11.html#ccd">Sekce FAQ Ladìní výkonu.</a>
<li>KMEMSTATS - Pøimìje funkci malloc(9), kernel memory allocator, aby uchovávala statistiku o svém pou¾ívání. Je-li nastaveno DEBUG, tato volba je automaticky zapnutá config-em.. 
<li>BOOT_CONFIG - Pøidává podporu pro volbu -c na boot promptu , související s runtime konfigurací jádra (UKC) pøi startu systému.
</blockquote>

<strong>Sí»ové volby</strong><br>
Rovnì¾ si pøeètìte <a href="faq6.html">Sí»ové FAQ</a> nebo <a
href="faq11.html#Network">Networking Performance Tuning FAQ</a>.
<blockquote>
<li>GATEWAY - umo¾òuje IPFORWARDING a (pro vìt¹inu portù) zvy¹uje velikost NMB
clusterù. .
<li>NMBCLUSTERS=integer - øídí velikost mbuf cluster map. 
<li>IPFORWARDING - umo¾òuje IP routování. S touto volbou bude stroj forwardovat
IP datagramy mezi svými sí»ovými rozhraními, pokud budou adresovány jiným strojùm.
<li>MROUTING - Zahrnuje podporu pro IP multicast routery.
<li>INET - Zahrnuje podporu pro TCP/IP protokol stack. Tato volba je NUTNÁ
<li>MCLSHIFT=value - tato volba je logaritmem pøi základu 2 velikosti mbuf clusterù. Lépe viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a> .
<li>NS - Pøidává podporu pro Xerox XNS protokol stack. Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current">ns(4)</a>
<li>ISO,TPIP - Pøidává podporu pro v¹udypøítomný OSI protokol stack. Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html">iso(4)</a> .
<li>EON - Podpora pro OSI tunneling pomocí IP. 
<li>CCITT,LLC,HDLC - Podpora pro X.25 protokol stack. 
<li>IPX, IPXIP - Pøidává podporu pro Internetwork Packet Exchange protokol 
, který pou¾ívá bì¾nì Novell NetWare. 
<li>NETATALK - Kernel podpora pro rodinu protokolù AppleTalk.
<li>TCP_COMPAT_42 - Pou¾ití této volby dùraznì nedoporuèujeme, tedy by mìla být
vypnutá. Jedná se o TCP bug compatibility s 4.2BSD. Ve 4.2BSD, TCP sequence numbers byla 32-bitová èísla se znaménkem. Moderní implementace TCP pou¾ívají unsigned hodnoty, tedy datové typy bez znaménka. 
<li>TCP_NEWRENO - Zapíná NewReno fast recovery phase, která umo¾òuje, aby 
one lost segment to be recovered per round trip time ;).
<li>TCP_SACK -  Turns on selective acknowledgements.
<li>TCP_FACK - Turns on forward acknowledgements allowing a more precise estimate of outstanding data during the fast recovery phase by using SACK information. This option can be used together with TCP_SACK.
(pozn.> a¾ budete mít nìkdo rozumný pøeklad tìchto bodù, dejte vìdìt. @milosh)
<li>PPP_FILTER - Tato volba zapíná filtrování ppp spojení na základì <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html">pcap(3)</a> .
<li>PPP_BSDCOMP - PPP BSD komprese.
<li>PPP_DEFLATE - pou¾ívá se ve spojení s  PPP_BSDCOMP.
<li>IPSEC - Tato volba pøidává podporu pro IP security protokol. Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a> pro více informací o IPsecu. Tato volba pøedpokládá volbu KEY, která pøidává podporu pro PFKEYv2.
<li>ENCDEBUG - Tato volba umo¾òuje logování ladících informací v pøípadì
, ¾e IPSEC se setká s chybami. 
</blockquote>

<strong>Volby subsystému SCSI </strong>
<blockquote>
<li>SCSITERSE - Struènìj¹í chybová hlá¹ení SCSI. Vynechání dekódovací ASC/ASCQ info tabulky, u¹etøí asi 8 bytù. 
<li>SCSIDEBUG - Vypí¹e speciální ladící informace pro SCSI subsystém na konzoli.
</blockquote>
</p>


<p> 
<a name= "Building"></a>
<a name= "5.3"></a>
<h2>5.4 -  Tvorba va¹eho vlastního jádra</h2>

<p>
Úplné instrukce pro vytvoøení vlastního jádra jsou v manuálové stránce 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&amp;sektion=8">
afterboot(8)</a>.

<p>
Pro kompilaci jádra, které bylo na cdrom potøebujete nejprve mít k ruce
zdrojový kód. Zdrojový kód jádra se nachází právì na 
<a href="../orders.html">officiálím CD</a> (disk 3) a na 
<a href="../ftp.html">FTP serverech</a>.
Následující pøíklad pøedpokládá, ¾e CD3 je pøipojeno na /mnt:

<blockquote>
<pre>
# <strong>cd /usr/src</strong>
# <strong>tar xvzf /mnt/src.tar.gz</strong>
</pre>
</blockquote>

<p>
Pøi tvorbì vlastního jádra je nejjednodu¹¹í zaèít s GENERIC
jádrem. To se nachází v
<i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>, kde $ARCH je
va¹e architektura. V tomto adresáøi se rovnì¾ nachází dal¹í pøíklady
konfigurací. V následujícím vám uká¾eme dva pøíklady pro kompilaci
jádra. První kompiluje jádro v adesáøovém stromu, který je pouze
pro ètení. Druhý v zapisovatelném adresáøi. 

<blockquote> 
<pre>
# <strong>cd /somewhere</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .</strong>
# <strong>vi SOMEFILE</strong> <i>(udìláte zmìny, které chcete)</i>
# <strong>config -s /usr/src/sys -b . SOMEFILE</strong>
</pre>
následované buï:

<pre>
    # <strong>make depend</strong>
         <b><i>- NEBO -</i></b>
    # <strong>make clean</strong>
# <strong>make</strong>
</pre>
</blockquote>

Musíte spustit '<tt>make depend</tt>' kdy¾ provádíte nìjaké zmìny
(vèetnì updatù a patchù) ve va¹em stromu zdrojových souborù
(jinými slovy skoro v¾dy, dokud nepotøebujete spustit '<tt>make
clean</tt>').

<p>
Pokud jste provedli zmìny do voleb konfigurace jádra, a/nebo  jste
udìlali velké zmìny ve va¹em stromì zdrojových souborù, mìli byste
pou¾ít '<tt>make clean</tt>' namísto vý¹e zmínìného '<tt>made
depend</tt>'. V¾dy je bezpeèné provést 'make clean', aèkoliv to
mù¾e mít za následek del¹í èas kompilace, proto¾e toho bude více
buildováno. 

<p>
Pro kompilaci jádra uvnitø zapisovatelného adresáøového stromu,
vykonejte následující:

<blockquote>
<tt>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi SOMEFILE</strong> (udìláte zmìny, které chcete)
# <strong>config SOMEFILE</strong> (o tomhle si pøeètìte více zde:
 <a href= # "http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>)</i><br>
# <strong>cd ../compile/SOMEFILE</strong>
# <strong>make</strong>
</tt>
</blockquote>

<p>
Kde $ARCH je architektura, kterou pou¾íváte, napø. i386. Mù¾ete rovnì¾ spustit <strong>make depend</strong> pro zji¹tìní závislostí, a¾ budete kompilovat jádro
pøí¹tì.

<p>
Umístìní jádra na své místo.

<blockquote>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd</strong>
</pre>
</blockquote>

Pro pøechod k va¹emu starému jádru v èase startu systému napi¹te pouze:

<blockquote>
<pre>
boot&gt; <strong>bsd.old</strong>
</pre>
</blockquote>

a va¹e staré jádro bude nahráno namísto /bsd.

<p>
Nìkdy budete potøebovat spolu s novým jádrem instalovat i nový
boot blok. Více viz. <a href="faq14.html#InstBoot">
faq14.8 o OpenBSD Bootloaderu</a>. Zde naleznete základní pøehled
o jeho pou¾ívání
</p>

<p>
<a name= "BootConfig"></a>
<a name="5.4"></a>
<h2>5.5 - Konfigurace pøi bootu</h2>

<p>
Nìkdy pøi startu systému se stane, ¾e va¹e jádro nalezne zaøízení,
ale mo¾ná se ¹patným IRQ. A mo¾ná právì toto zaøízení budete muset
ihned pou¾ít. Ani¾ byste museli vytváøet nové jádro, mù¾ete zkusit
konfiguraci  OpenBSD jádra v okam¾iku bootování. Tato konfigurace
opraví vá¹ problém pouze v jednom startu systému. Po rebootování
budete muset tuto proceduru opakovat. Tento postup je tudí¾ my¹len
jen jako doèasná záplata, a problém byste mìli opravit opravou a
rekompilací jádra. Va¹e jádro musí být zkompilované s volbou
<strong>option BOOT_CONFIG</strong>, co¾ pro GENERIC jádra platí.

<p>
Vìt¹ina této dokumentace se nachází v manuálov0 stránce
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&amp;sektion=8">boot_config(8)</a>

Pro start s u¾ivatelskou konfigurací jádra, ( User Kernel Config
aka UKC) , pou¾ijte pøi bootování volbu -c.

<blockquote><pre>
boot&gt; <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

Nebo jakékoliv jiné jádro, které chcete nabootovat. Poté co provedete pøedchozí
krok, obdr¾íte UKC prompt. Odtud mù¾ete vykonávat pøíkazy pøímo specifikující
zaøízení jádra, která chcete zmìnit, vypnout nebo zapnout.

<p>
Zde je seznam pøíkazù v UKC.
<ul>
<li><tt>add <strong>device</strong></tt> - pøidání zaøízení pomocí okopírování jiného
<li><tt>change <strong>devno | device </strong></tt> - zmìna jednoho nebo více zaøízení
<li><tt>disable <strong>devno | device </strong></tt> - vypnutí jednoho nebo více zaøízení
<li><tt>enable <strong>devno | device </strong></tt> - zapnutí jednoho nebo více zaøízení
<li><tt>find <strong>devno | device </strong></tt> - nalezení jednoho nebo více zaøízení
<li><tt>help</tt> - krátký pøehled tìchto pøíkazù
<li><tt>list</tt> - seznam V©ECH známých zaøízení
<li><tt>exit/quit</tt> - pokraèuj v bootování
<li><tt>show <strong>[attr [val]]</strong></tt> - vypí¹e zaøízení s danou vlastností attr a volitelnì s danou hodnotou val
</ul>

<p>
Jakmile jste jednou nakonfigurovali va¹e  zaøízení, pou¾ijte quit nebo exit
a continue pro pokraèování bootování. Poté byste mìli opravit
nastavení jádra a zkompilovat nové jádro. Dal¹í info viz. <a
href="faq5.html#Building"> Tvorba va¹eho vlastního jádra.
</p>

<p>
<a name= "VerboseBoot"></a>
<a name="5.5"></a>
<h2>5.6 - Jak získat podrobnìj¹í výpis bìhem bootování</h2>
</p>

<p>
Podrobnìj¹í výpis pøi bootování mù¾e být velmi u¾iteèný, pokud se
sna¾íte ladit problémy. Pokud napøíklad systém nedetekuje floppy
disk a potøebujete více informací, prostì rebootujete. Poté co
obdr¾íte &quot;boot>&quot; prompt, bootujte s -c. Dostanete 
UKC&gt;, pak vykonejte:
</p>


<blockquote><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enable
UKC&gt; <strong>quit</strong>
</pre></ul>

<p>
Následovat budou extrémnì podrobné startovací hlá¹ky.

<p>
<a name="config"></a>
<a name="5.6"></a>
<h2>5.7 - Pou¾ití pøíkazu config(8) pro zmìnu zkompilovaného jádra</h2>

<p>
Volby <b>-e</b> a <b>-u</b> pøíkazu 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
mohou být velmi u¾iteèné a ¹etøí èas strávený kompilací jádra.
Volba <b>-e</b> umo¾òuje, abyste vstoupili do UKC neboli User
Kernel Configu v bì¾ícím systému. Zmìny, které provedete, se pak
objeví pøi dal¹ím bootu. Volba <b>-u</b> testuje , zda byly
provedeny pøi bootování v jádøe nìjaké zmìny. Za pøedpokladu,
¾e jste pou¾ili <b>boot -c</b> pro vstup do UKC pøi bootování
systému.
</p>

<p>
Následující pøíklad nám ukazuje vyøazení ep* zaøízení z jádra. Pro
¹etrnost va¹eho poèínání musíte pou¾ít volbu <b>-o</b>, která
zapisuje provedené zmìny do souboru, který uvedete. Napø.
<strong>config -e -o bsd.new /bsd</strong> zapí¹e zmìny do bsd.new
. Pøíklad nepou¾ívá volbu <b>-o</b> , proto zmìny jsou ignorovány
a nejsou zapsány zpìt do binárky jádra. Pro více informací o tom,
jak obdr¾et chybové a varovné hlá¹ky, ètìte manuálovou stránku 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.

<blockquote><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 3.1 (GENERIC) #2: Sat Apr 20 21:44:54 EDT 2002
    root@build:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
+ukc&gt; ?
        help                            Command help list
        add         dev                 Add a device
        base        8|10|16             Base on large numbers
        change      devno|dev           Change device
        disable     attr val|devno|dev  Disable device
        enable      attr val|devno|dev  Enable device
        find        devno|dev           Find device
        list                            List configuration
        lines       count               # of lines per page
        show        [attr [val]]        Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
        timezone    [mins [dst]]        Show/change timezone
        nmbclust    [number]            Show/change NMBCLUSTERS
        cachepct    [number]            Show/change BUFCACHEPERCENT
        nkmempg     [number]            Show/change NKMEMPAGES
        shmseg      [number]            Show/change SHMSEG
        shmmaxpgs   [number]            Show/change SHMMAXPGS
ukc&gt; <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*|neo*|cmpci*
|clcs*|clct*|auich*|autri*|auvia*|fms*|uaudio*|maestro*|esa*|yds*|emu* flags 0x0
  1 midi* at sb0|sb*|opl*|opl*|opl*|opl*|ym*|mpu*|autri* flags 0x0
  2 nsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  3 nsphyter* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|
vr*|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep
*|ep*|ep* phy -1 flags 0x0
  4 qsphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  5 inphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  6 iophy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  7 eephy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
  8 exphy* at aue*|xe*|ef*|gx*|stge*|bge*|nge*|sk*|ste*|sis*|sf*|wb*|tx*|tl*|vr*
|ne0|ne1|ne2|ne*|ne*|ne*|dc*|dc*|rl*|fxp*|fxp*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|e
p*|ep* phy -1 flags 0x0
[...snip...]
ukc&gt; <strong>disable ep</strong>
 65 ep0 disabled
 66 ep* disabled
 67 ep* disabled
149 ep0 disabled
150 ep0 disabled
151 ep* disabled
152 ep* disabled
202 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</pre></blockquote>

<p>
V pøedcházejícím pøíkladì byla v¹echna zaøízení ep* v jádøe
vypnuta a nebudou zkou¹ena pøi startu. V nìkterých situacích, kdy
pou¾ijete pøi bootu UKC, pomocí <b>boot -c</b>, budete chtít zmìny
ulo¾it trvale. Provést to mù¾ete pomocí volby <b>-u</b> . V
následujícím pøíkladì, poèítaè nabootoval do UKC a zaøízení wi(4)
bylo odstranìno. Proto¾e zmìny pøi boot -c  NEJSOU trvalé, musí
být zapsány.
Tento pøíklad zapisuje zmìny provedené z boot -c do nového jádra
ulo¾eného v bsd.new.

<blockquote><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 3.1 (GENERIC) #2: Sat Apr 20 21:44:54 EDT 2002
    root@build:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
105 wi* disabled
106 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</pre></blockquote>


<p>
<font color= "#0000e0">
<a href= "index.html">[Zpátky na hlavní stránku]</a>
<a href= "faq4.html">[Do sekce 4.0 - Prùvodce instalací]</a>
<a href= "faq6.html">[Do sekce 6.0 - Nastavení sítì]</a>
</font>

<p>
<hr>
+<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq5.html,v 1.69 ]
<br>
$Translation: faq5.html,v 1.13 2002/09/23 15:42:55 certik Exp $
<br>
$OpenBSD: faq5.html,v 1.13 2002/09/23 18:05:59 jufi Exp $
</small>
</body>
</html>
