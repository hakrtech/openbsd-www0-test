<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>5.0 - Nastavení jádra</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>5.0 - Nastavení jádra</font><hr></h2>
</p>

<p>
<ul><h3>Obsah</h3>
<li><a href= "#Why">5.1 - Proè potøebuji u¾ivatelské jádro?</a></li>
<li><a href= "#Options">5.2 - Volby pøi konfiguraci jádra</a></li>
<li><a href= "#Building">5.3 - Tvorba vlastního jádra</a></li>
<li><a href= "#BootConfig">5.4 - Konfigurace pøi startu</a></li>
<li><a href= "#VerboseBoot">5.5 - Jak získat podrobnìj¹í výpis bìhem bootování</a></li>
<li><a href= "#config">5.6 - Pou¾ití pøíkazu config(8) pro zmìnu zkompilovaného jádra</a>
</ul>
</p>
<hr>
<br>

<p>
<a name= "Why"></a>
<a name= "5.1"></a>
<h2>5.1 - Proè bych mìl vytvoøit své vlastní jádro?</h2>
</p>

<p>
Nìkolik dùvodù, pøesto¾e vlastní jádro vìt¹inou sestavují pøedev¹ím zku¹ení
u¾ivatelé, kteøí dobøe rozumí celému systému.

<ul>
    <li>vá¹ poèítaè má obecnì velmi málo pamìti RAM a vy byste jí rádi co nejvíce
u¹etøili, co¾ provedete vyøazením tìch ovladaèù zaøízení z jádra, které nepou¾íváte, napø. GENERIC jádro i386 architektury má pøibli¾nì velikost 3,1 MB , prùmìrná velikost u¾ivatelského jádra bez nepou¾ívaných ovladaèù je cca 1,7MB.
    <li>Odstraníte nìkteré pùvodní volby, se kterými bylo jádro kompilováno a 
mù¾ete naopak pøidat jiné, které nebyly pùvodnì v konfiguraci zahrnuty
    <li>Mù¾ete pøidat nìkteré volby experimentálního, zku¹ebního významu, které
jsou k dispozici pro testování nového kódu jádra

</ul>
</p>
<p>
Ve vìt¹inì pøípadù NEbudete potøebovat kompilovat vlastní jádro. GENERIC jádro bude obvykle tím, které potøebujete. Vlastnì je tu i nìkolik dùvodù, ze kterých byste nemìli chtít kompilovat va¹e vlastní jádro. Hlavní dùvod je ten, ¾e je
snadné udìlat nìjaké zmìny v nastavení jádra, které se zdají být logické, ale
nefungují. To je nebezpeèí, které vá¹ zásah provází. Jestli¾e nìco v novém
jádøe nefunguje tak jak by mìlo, vyzkou¹ejte prosím nejprve GENERIC jádro, 
døíve ne¾ ode¹lete zprávu o chybì (bug report).
</p>

<p>
<a name= "Options"></a>
<a name= "5.2"></a>
<h2>5.2 - Volby pøi konfiguraci jádra</h2>
</p>

<p>
Volby (options) pøi konfiguraci jádra jsou nastavení, kterými konfigurujete
slo¾ení va¹eho jádra. Tyto nastavení pøidávají pøi
kompilaci do jádra èásti kódu, který realizuje po¾adované operace.
Takto mù¾ete specifikovat pøesnì to co od svého jádra oèekáváte, zahrnout podporu pøesnì pro ta zaøízení, které potøebujete a která pou¾íváte, a naopak vyjmout z jádra ty ovladaèe, které jsou pro vás nepotøebné. Je zde spousta voleb, které
mù¾ete pøi konfiguraci zapnout nebo vypnout. Zde se zamìøíme jen na nìkteré
z nich, pøedev¹ím na ty, které se pou¾ívají nejèastìji. Pro kompletní seznam
tìchto voleb si pøeètìte manuálovou stránku pøíkazu <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>. Mù¾ete se rovnì¾ podívat na pøíklady konfiguraèních souborù, které jsou
dostupné pro va¹i architekturu.
</p>

<P>
Ne v¹echny volby byly testovány na kompatibilitu s jinými. Nepøidávejte do jádra volbu, pokud nemáte skuteènì dùvod tak uèinit! Jediná konfigurace jádra,
která byla dostateènì testována, je GENERIC kernel. Jedná se obvykle o kombinaci voleb v /usr/src/sys/arch/&lt;va¹e_architektura&gt;/conf/GENERIC a  /usr/src/sys/conf/GENERIC.
</P>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Konfiguraèní soubory pro architekturu Alpha</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Konfiguraèní soubory pro i386</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/">Konfiguraèní soubory pro mac68k</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sun3/conf/">Kon
figuraèní soubory pro sun3</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Kon
figuraèní soubory pro architekturu sparc</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Ostatní architektury</a></li>
</ul>
</p>

<p>
Pøi bli¾¹ím ohledání tìchto souborù zjistíte, ¾e obsahují øádku typu:<br>
<strong>include "../../../conf/GENERIC"</strong><br>
To znamená, ¾e se v nich odkazuje je¹tì dal¹í konfiguraèní soubor. V tomto souboru se nacházejí na architektuøe nezávislé volby. Pøi vytváøení va¹eho
vlastního jádra se tedy urèitì podívejte na <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a>. JSOU zde volby, které
jsou NUTNÉ.
</p>

<p>
V¹echny z dále uvedených voleb, by mìly být umístìny ve va¹em konfiguraèním souboru jádra ve formátu:<br>
<strong>option      VOLBA</strong><br>
napøíklad chcete-li mít jádro s podporou ladìní (volba DEBUG), pøidejte øádek: <br>
<strong>option      DEBUG</strong><br>
Volby v OpenBSD jádøe jsou pøekládány na volby preprocesoru pøi kompilaci,
proto volba jako DEBUG zpùsobí kompilaci zdrojového kódu s volbou -DDEBUG. Co¾
je ekvivalentní tomu, ¾e bychom ve v¹ech zdrojových souborech pøipsali #define DEBUG.
</p>

<p>
OpenBSD má mnoho voleb týkajících se kompatiblity, které vám umo¾òují spou¹tìt  
binární soubory z jiných operaèních systémù. Ne v¹echny jsou dostupné pro ka¾dou architekturu, proto se ujistìte v manuálové stránce, ¾e daná volba pro danou architekturu je podporována.
</p>
<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SVR4(8)</a> - Kompatibilita programù ze SVR4<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_BSDOS(8)</a> - Kompatibilita programù z BSD.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_LINUX(8)</a> - Kompatibilita Linuxového kódu.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SUNOS(8)</a> - Kompatibilita programù z SunOS.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_ULTRIX(8)</a> - Kompatibilita programù z Ultrixu.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_FREEBSD(8)</a> - Kompatibilita kódu pro FreeBSD.</li>
<li>COMPAT_HPUX - Kompatibilita programù pro HP-UX. Dostupná pouze pro nìkteré m68k architektury.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_IBCS2(8)</a> - Kompatibilita pro spou¹tìní kódu z ibcs2</li>
<li>COMPAT_OSF1 - Pro spu¹tìní kódu z Digital Unix. Dostupná pouze pro platformu Alpha.</li>
<li>COMPAT_43 - Kompatibilita s 4.3BSD. Pou¾ití této volby se nedoporuèuje. Je
v¹ak nutná pro ná¹ port Netscape Navigator.</li>
<li>COMPAT_11 - Kompatibilita s NetBSD 1.1</li>
<li>COMPAT_NOMID - Kompatibilita pro binárky ve formátu a.out s chybìjícím ID systému.
</ul>
</p>

<p>
V¾dy je vhodné umo¾nit ladìní kódu jádra. Hodnì lidí sice tyto volby odstraòuje, proto¾e jsou zdrojem velkého mno¾ství dal¹ího kódu jádra a tedy zvy¹ují jeho velikost. Jsou v¹ak velmi výhodné v pøípadì, ¾e se objeví nìjaká chyba v kódu jádra. Pomáhají vývojáøùm objevit zdroj problémù mnohem rychleji. Zde je seznam
nejèastìj¹ích voleb pro ladìní, které mù¾ete pøidat do va¹í konfigurace.
</p>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html">DDB</a> - Tato volba zakompiluje do jádra interní debugger. Není k dispozici na v¹ech platformách. Proto si nejdøíve o ní pøeètìte v dokumentaci.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html">KGDB</a> - Tato volba zakompiluje do jádra remote kernel debugger. Umo¾òuje debugování jádra bì¾ícího na cílovém stroji z jiného poèítaèe pomocí gdb, tak¾e se celý proces debugování neli¹í od ladìní jakéhokoliv jiného programu. Oba stroje jsou spojeny sériovým kabelem pøes COM port, gdb bì¾ící na vzdáleném (remote) stroji se spojí po startu s debugovaným kernelem na druhém poèítaèi. Na vzdáleném stroji mù¾eme pou¾ít i grafické nástavby ke gdb, jako je ddd . Více o nastavení remote kernel debuggeru na <a href="http://www.netbsd.org/Documentation/kernel/kgdb.html">kgdb.html.</a>, opìt je ale nutné pøipomenout, ¾e pro øadu
architektur (ne-li v souèasnosti pro v¹echny) není k dispozici</li>
<li>makeoptions  DEBUG="-g" - Vytvoøí spolu s bsd také bsd.gdb . Dodá do zkompilovaného jádra úplnou tabulku ladících symbolù. Pou¾ívá se pro debugování jádra pomocí gdb. Vzhledem k tomu, ¾e velikost jádra s pøíponou .gdb dosahuje øádovì 34.0 MB, je rozumné ji pou¾ívat pouze 'offline' s odpovídajícím kernel c0re. </li>
<li>DEBUG - Pøidává do jádra rùzné ladící volby, tam kde jsou ve zdrojovém kódu
definovány.</li>
<li>KTRACE - Pøidává do jádra kód pro sledování volání jádra. Dovoluje
u¾ivatelùm pou¾ívat <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html">ktrace(1)</a>.</li>
<li>DIAGNOSTIC - Pøidává do jádra kód, který kontroluje interní konzistenci datových struktur.</li>
<li>GPROF - Pøidává do jádra kód pro kernel profiling spolu s <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html">kgmon(8)</a>.</li>
<li>makeoptions PROF="-pg" - volba -pg zpùsobuje, ¾e jádro je kompilované s podporou pro profiling.  Pro pou¾ití musíte dodat rovnì¾ volbu GPROF.</li>
</ul>
</p>

<p>
<strong>Filesystem Options.</strong>
<ul>
<li>FFS - Berkeley Fast Filesystem <strong>POZN:</strong> Tato volba je NUTNÁ</li>
<li>EXT2FS - Second Extended File System, nutné pro ty z vás, kteøí budou chtít
èíst Linuxové oddíly.</li>
<li>MFS - Memory File System který skladuje soubory ve swapovatelné pamìti.</li>
<li>NFS - Network File System, je potøeba tam, kde budete pou¾ívat NFS.</li>
<li>CD9660 - iso9660 + rockridge extensions filesystem. NUTNÁ pro ètení z CD</li>
<li>MSDOSFS - Nutná pro ètení MS-DOS FAT filesystému. Obsahuje i podporu pro Windows 95 dlouhá jména souborù + rùzné znaky ve jménech souborù.</li>
<li>FDESC - Obsahuje kód pro souborový systém, který mù¾e být pøipojen na /dev/fd</li>
<li>KERNFS - Pøidává kód, který umo¾òuje pøipojení speciálního souborového systému (bì¾nì pøipojeném na /kern) se soubory,které reprezenují èetné promìnné jádra a jeho parametry (pøíli¹ se nepou¾ívá)</li>
<li>NULLFS - Kód pro loopback filesystém. Více viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html">mount_null(8)</a></li>
<li>PROCFS - Kód pro speciální filesystém (obvykle pøipojený na /proc), opìt (narozdíl od FreeBSD), se nepou¾ívá</li>
<li>PORTAL - Kód pro experimentální portal filesystém. Tento souborový systém
dovoluje zajímavé triky, jako napø. otevøení TCP socketu prostøednictvím otevøení souboru ve file systému.</li>
<li>UMAPFS - Obsahuje kód pro loopback filesystém, ve kterém mohou být user a
group ids pøemapována -- toto mù¾e být u¾iteèné v pøípadì pøipojení cizího filesystému s odli¹nými uids a gids ne¾ lokální filesystém (napø. vzdálený NFS). </li>
<li>UNION - Pøidává kód pro union filesystém, který umo¾òuje, aby adresáøe byly
namountovány na sebe tím zpùsobem, aby oba file systémy zùstaly viditelné.
Tento kód není zatím stabilní.</li>
<li>XFS - Pøidává podporu pro pou¾ívání filesystému kompatibilních s AFS filesystémem. Bì¾nì pou¾íváno kódem Arla/AFS.  </li>
<li>LFS - Log Structured Filesystem.</li>
<li>FFS_SOFTUPDATES - umo¾òuje softupdates. Více o softupdates v <a href="faq14.html#SoftUpdates">Softupdates FAQ</a>.
<li>NFSSERVER - Pøidává do jádra kód pro NFS server.</li>
<li>NFSCLIENT - Pøidává do jádra kód pro NFS klienta.</li>
<li>FIFO - Podpora pro FIFO (pojmenovaná roura). Ta by NEmìla chybìt.</li>
<li>NVNODE=integer - kde integer je velikost cache pou¾ívané pøekladovou rutinou name-to-inode, (napø. namei() cache a jiné podobnì pojmenované)..</li>
<li>EXT2FS_SYSTEM_FLAG - tato volba mìní chování flagù APPEND a IMMUTABLE pro soubor na EXT2FS filesystému. Více viz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a>.</li>
<li>QUOTA - Podpora pro kvóty ve filesystému. Pou¾ívání kvót více viz <a href="faq10.html#Quotas">FAQ 10, Quota</a></li>
</ul>
</p>

<p>
<strong>Rùzné volby</strong>
<ul>
<li>PCIVERBOSE - podrobnìj¹í výpis pøi bootování pro zaøízení PCI.</li>
<li>EISAVERBOSE - podrobnìj¹í výpis pøi bootování pro zaøízení EISA.</li>
<li>PCMCIAVERBOSE - podrobnìj¹í výpis pøi bootování pro zaøízení PCMCIA.</li>
<li>APERTURE - dodává interní podporu jádra pro VGA framebuffer mapování u¾ivatelským procesem. Nutné pro spu¹tìní X.</li>
<li>XSERVER - Podpora pro X server console driver. Nutné pro X.</li>
<li>LKM - podpora pro Loadable Kernel Modules. Není na v¹ech architekturách. Více viz.  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html">lkm(4)</a>, pøíli¹ se nepou¾ívá .</li>
<li>INSECURE - Pevnì stanoví hodnotu kernel security levelu na -1. Více viz.  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a> pro informace o kernel security levelech..</li>
<li>RAM_DISK_HOOKS - Umo¾òuje volat na architektuøe závislé funkce, poté co je nakonfigurován ramdisk (jako napø. nahrání druhé diskety po jejím vlo¾ení).</li>
<li>RAM_DISK_IS_ROOT - Pevnì stanoví ramdisk jako root device .</li>
<li>CCDNBUF=integer - nastaví poèet component bufferù pou¾ívaných CCD(4). Default je 8. Více o CCD viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html">CCD(4)</a> man page, nebo <a href="faq11.html#ccd">Sekce FAQ Ladìní výkonu.</a></li>
<li>KMEMSTATS - Pøimìje funkci malloc(9), kernel memory allocator, aby uchovávala statistiku o svém pou¾ívání. Je-li nastaveno DEBUG, tato volba je automaticky zapnutá config-em.. </li>
<li>BOOT_CONFIG - Pøidává podporu pro volbu -c na boot promptu , související s runtime konfigurací jádra (UKC) pøi startu systému.</li>
</ul>
</p>

<p>
<strong>Sí»ové volby</strong><br>
Rovnì¾ si pøeètìte <a href="faq6.html">Sí»ové FAQ</a> nebo <a href="faq11.html#Network">Networking Performance Tuning FAQ</a>.
<ul>
<li>GATEWAY - umo¾òuje IPFORWARDING a (pro vìt¹inu portù) zvy¹uje velikost NMB
clusterù. .</li>
<li>NMBCLUSTERS=integer - øídí velikost mbuf cluster map. </li>
<li>IPFORWARDING - umo¾òuje IP routování. S touto volbou bude stroj forwardovat
IP datagramy mezi svými sí»ovými rozhraními, pokud budou adresovány jiným strojùm.</li>
<li>MROUTING - Zahrnuje podporu pro IP multicast routery.</li>
<li>INET - Zahrnuje podporu pro TCP/IP protokol stack. Tato volba je NUTNÁ</li>
<li>MCLSHIFT=value - tato volba je logaritmem pøi základu 2 velikosti mbuf clusterù. Lépe viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a> .</li>
<li>NS - Pøidává podporu pro Xerox XNS protokol stack. Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current">ns(4)</a></li>
<li>ISO,TPIP - Pøidává podporu pro v¹udypøítomný OSI protokol stack. Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html">iso(4)</a> .</li>
<li>EON - Podpora pro OSI tunneling pomocí IP. </li>
<li>CCITT,LLC,HDLC - Podpora pro X.25 protokol stack. </li>
<li>IPX, IPXIP - Pøidává podporu pro Internetwork Packet Exchange protokol 
, který pou¾ívá bì¾nì Novell NetWare. </li>
<li>NETATALK - Kernel podpora pro rodinu protokolù AppleTalk.</li>
<li>TCP_COMPAT_42 - Pou¾ití této volby dùraznì nedoporuèujeme, tedy by mìla být
vypnutá. Jedná se o TCP bug compatibility s 4.2BSD. Ve 4.2BSD, TCP sequence numbers byla 32-bitová èísla se znaménkem. Moderní implementace TCP pou¾ívají unsigned hodnoty, tedy datové typy bez znaménka. </li>
<li>TCP_NEWRENO - Zapíná NewReno fast recovery phase, která umo¾òuje, aby 
one lost segment to be recovered per round trip time ;).</li>
<li>TCP_SACK -  Turns on selective acknowledgements.</li>
<li>TCP_FACK - Turns on forward acknowledgements allowing a more precise estimate of outstanding data during the fast recovery phase by using SACK information. This option can be used together with TCP_SACK.</li>
(pozn.> a¾ budete mít nìkdo rozumný pøeklad tìchto bodù, dejte vìdìt. @milosh)
<li>PPP_FILTER - Tato volba zapíná filtrování ppp spojení na základì <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html">pcap(3)</a> .</li>
<li>PPP_BSDCOMP - PPP BSD komprese.</li>
<li>PPP_DEFLATE - pou¾ívá se ve spojení s  PPP_BSDCOMP.</li>
<li>IPSEC - Tato volba pøidává podporu pro IP security protokol. Viz. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a> pro více informací o IPsecu. Tato volba pøedpokládá volbu KEY, která pøidává podporu pro PFKEYv2.</li>
<li>ENCDEBUG - Tato volba umo¾òuje logování ladících informací v pøípadì
, ¾e IPSEC se setká s chybami. </li>
</ul>
</p>

<p>
<strong>SCSI Subsystem Options</strong>
<ul>
<li>SCSITERSE - Struènìj¹í chybová hlá¹ení SCSI. Vynechání dekódovací ASC/ASCQ info tabulky, u¹etøí asi 8 bytù. </li>
<li>SCSIDEBUG - Vypí¹e speciální ladící informace pro SCSI subsystém na konzoli.</li>
</ul>
</p>


<p> 
<a name= "Building"></a>
<a name= "5.3"></a>
<h2>5.3 -  Tvorba va¹eho vlastního jádra</h2>
</p>

<p>
Úplné instrukce pro vytvoøení vlastního jádra jsou v manuálové stránce <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html">
afterboot(8)</a>.
</p>

<p>
Pro kompilaci jádra, které bylo na cdrom potøebujete nejprve mít k ruce zdrojový kód. Zdrojový kód jádra se nachází právì na CD. Zde je pøíklad jak zkopírovat zdrojový kód z cd. Tento pøíklad pøedpokládá, ¾e CD1 je pøipojeno na /mnt.
</p>

<ul>
<pre>
# <strong>mkdir -p /usr/src/sys</strong>
# <strong>cd /mnt/sys</strong>
# <strong>tar cf - . | ( cd /usr/src/sys; tar xvf - )</strong>
</pre>
</ul>

<p>
Pøi tvorbì vlastního jádra je nejjednodu¹¹í zaèít s GENERIC jádrem. To se nachází v <i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>, kde ${arch} je va¹e architektura. V tomto adresáøi se rovnì¾ nachází dal¹í pøíklady konfigurací. V následujícím vám uká¾eme dva pøíklady pro kompilaci jádra. První kompiluje jádro v adesáøovém
stromu, který je pouze pro ètení. Druhý v zapisovatelném adresáøi. 
</p>

<ul>
<pre>
# <strong>cd /somewhere</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .</strong>
# <strong>vi SOMEFILE</strong> (udìláte zmìny, které chcete)
# <strong>config -s /usr/src/sys -b . SOMEFILE</strong>
<ul>
# <strong>make depend</strong>
<ul>
(Pøedcházející krok je nutný, pokud jste udìlali nìjaké zmìny [vèetnì updatù a patchù] ve stromu zdrojového kódu jádra. Tento krok mù¾e být vynechán, pokud 
provedete následující krok.)
</ul>
<font size="+1">
<b><i>NEBO</i></b>
</font>
# <strong>make clean</strong>
<ul>
Pøedcházející krok je nutný, pokud udìláte zmìny ve volbách nastavení jádra,
a je doporuèován také pokud provedete vìt¹í updaty ve stromu zdrojového kódu.
Mù¾ete v¹ak tento krok vynechat a provést jen 'make depend'.)
</ul>
</ul>
# <strong>make</strong>
</pre>
</ul>

<p>
Pro kompilaci jádra uvnitø zapisovatelného adresáøového stromu, vykonejte následující:
</p>

<ul>
<pre>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi SOMEFILE</strong> (udìláte zmìny, které chcete)
# <strong>config SOMEFILE</strong> (o tomhle si pøeètìte více zde: <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html">config(8)</a>)
# <strong>cd ../compile/SOMEFILE</strong>
# <strong>make</strong>
</pre>
</ul>

<p>
Kde $ARCH je architektura, kterou pou¾íváte, napø. i386. Mù¾ete rovnì¾ spustit <strong>make depend</strong> pro zji¹tìní závislostí, a¾ budete kompilovat jádro
pøí¹tì.
</p>

<p>
Umístìní jádra na své místo.
</p>

<ul>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd</strong>
</pre>
</ul>

<p>
Pro pøechod k va¹emu starému jádru v èase startu systému napi¹te pouze:
</p>

<ul>
<pre>
boot> <strong>bsd.old</strong>
</pre>
</ul>

<p>
a va¹e staré jádro bude nahráno namísto /bsd.
</p>

<p>
Nìkdy budete potøebovat spolu s novým jádrem instalovat i nový boot blok. Více
viz. <a href="faq14.html#InstBoot">
faq14.8 o OpenBSD Bootloaderu</a>. Zde naleznete základní pøehled o jeho pou¾ívání
</p>

<p>
<a name= "BootConfig"></a>
<a name="5.4"></a>
<h2>5.4 - Konfigurace pøi startu </h2>
</p>

<p>
Nìkdy pøi startu systému se stane, ¾e va¹e jádro nalezne zaøízení, ale mo¾ná
se ¹patným IRQ. A mo¾ná právì toto zaøízení budete muset ihned pou¾ít. Ani¾
byste museli vytváøet nové jádro, mù¾ete zkusit konfiguraci  OpenBSD jádra
v okam¾iku bootování. Tato konfigurace opraví vá¹ problém pouze v jednom startu
systému. Po rebootování budete muset tuto proceduru opakovat. Tento postup je
tudí¾ my¹len jen jako doèasná záplata, a problém byste mìli opravit opravou
a rekompilací jádra. Va¹e jádro musí být zkompilované s volbou <strong>option BOOT_CONFIG</strong>, co¾ pro GENERIC jádra platí. 
</p>

<p>
Vìt¹ina této dokumentace se nachází v manuálových stránkách <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html">boot_config(8)</a>
</p>

Pro start s u¾ivatelskou konfigurací jádra, ( User Kernel Config aka UKC) , pou¾ijte pøi bootování volbu -c.

<ul><pre>
boot> <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

<p>
Nebo jakékoliv jiné jádro, které chcete nabootovat. Poté co provedete pøedchozí
krok, obdr¾íte UKC prompt. Odtud mù¾ete vykonávat pøíkazy pøímo specifikující
zaøízení jádra, která chcete zmìnit, vypnout nebo zapnout.
</p>

<p>
Zde je seznam pøíkazù v UKC.
</p>

<CODE>
<p>
add <strong>device</strong> - pøidání zaøízení pomocí okopírování jiného
</p>

<p>
change <strong>devno | device </strong> - zmìna jednoho nebo více zaøízení
</p>

<p>
disable <strong>devno | device </strong> - vypnutí jednoho nebo více zaøízení
</p>

<p>
enable <strong>devno | device </strong> - zapnutí jednoho nebo více zaøízení
</p>

<p>
find <strong>devno | device </strong> - nalezení jednoho nebo více zaøízení
</p>

<p>
help - krátký pøehled tìchto pøíkazù
</p>

<p>
list - seznam V©ECH zaøízení
</p>

<p>
exit/quit - pokraèuj v bootování
</p>

<p>
show <strong>[attr [val]]</strong> - vypí¹e zaøízení s danou vlastností attr
a volitelnì s danou hodnotou val
</p></CODE>

<p>
Jakmile jste jednou nakonfigurovali va¹e  zaøízení, pou¾ijte quit nebo exit
a continue pro pokraèování bootování. Poté byste mìli opravit nastavení jádra
a zkompilovat nové jádro. Dal¹í info viz. <a href="faq5.html#Building"> Tvorba va¹eho vlastního jádra.
</p>

<a name= "VerboseBoot"></a>
<a name="5.5"></a>
<h2>5.5 - Jak získat podrobnìj¹í výpis bìhem bootování</h2>
</p>

<p>
Podrobnìj¹í výpis pøi bootování mù¾e být velmi u¾iteèný, pokud se sna¾íte ladit
problémy. Pokud napøíklad systém nedetekuje floppy disk a potøebujete více informací, prostì rebootujete. Poté co obdr¾íte &quot;boot>&quot; prompt, bootujte s -c. Dostanete 
UKC>, pak vykonejte:
</p>


<ul><pre>
UKC> <strong>verbose</strong>
autoconf verbose enable
UKC> <strong>quit</strong>
</pre></ul>

<p>
Následovat budou docela podrobné startovací hlá¹ky.
</p>

<p>
<a name="config"></a>
<a name="5.6"></a>
<h2>5.6 - Pou¾ití pøíkazu config(8) pro zmìnu zkompilovaného jádra</h2>
</p>

<p>
Spoleènì s OpenBSD 2.6 se objevily volby <b>-e</b> a <b>-u</b> pøíkazu <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>.
Tyto volby jsou velmi u¾iteèné a ¹etøí èas strávený kompilací jádra. Volba <b>-e</b> umo¾òuje, abyste vstoupili do UKC neboli User Kernel Configu v bì¾ícím systému. Zmìny, které provedete, se pak objeví pøi dal¹ím bootu. Volba <b>-u</b> testuje , zda byly provedeny pøi bootování v jádøe nìjaké zmìny. Za pøedpokladu,
¾e jste pou¾ili <b>boot -c</b> pro vstup do UKC pøi bootování systému.
</p>

<p>
Následující pøíklad nám ukazuje vyøazení ep* zaøízení z jádra. Pro ¹etrnost 
va¹eho poèínání musíte pou¾ít volbu <b>-o</b>, která zapisuje provedené zmìny
do souboru, který uvedete. Napø. <strong>config -e -o bsd.new /bsd</strong> zapí¹e zmìny do bsd.new . Pøíklad nepou¾ívá volbu <b>-o</b> , proto zmìny jsou
ignorovány a nejsou zapsány zpìt do binárky jádra. Pro více informací o tom,
jak obdr¾et chybové a varovné hlá¹ky, ètìte manuálovou stránku <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>
.
</p>

<ul><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc> <strong>?</strong>
        help                            Command help list
        add     dev                     Add a device
        base    8|10|16                 Base on large numbers
        change  devno|dev               Change device
        disable attr val|devno|dev      Disable device
        enable  attr val|devno|dev      Enable device
        find    devno|dev               Find device
        list                            List configuration
        lines   count                   # of lines per page
        show    [attr [val]]            Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
ukc> <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
  1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
  2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
 10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|ncr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
 11 cd* at scsibus* target -1 lun -1
 12 ch* at scsibus* target -1 lun -1
 13 sd* at scsibus* target -1 lun -1
 14 st* at scsibus* target -1 lun -1
 15 ss* at scsibus* target -1 lun -1
 16 uk* at scsibus* target -1 lun -1
 17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
--- more ---
[snip]
ukc> <strong>disable ep</strong>
 31 ep0 disabled
 32 ep* disabled
 33 ep* disabled
 87 ep0 disabled
 88 ep0 disabled
 89 ep* disabled
 90 ep* disabled
136 ep* disabled
ukc> <strong>quit</strong>
not forced
</pre></ul>

<p>
V pøedcházejícím pøíkladì byla v¹echna zaøízení ep* odstranìna z jádra a nebudou zkou¹ena pøi startu. V nìkterých situacích, kdy pou¾ijete pøi bootu UKC, pomocí <b>boot -c</b>, budete chtít zmìny ulo¾it trvale. Provést to mù¾ete pomocí volby <b>-u</b> . V následujícím pøíkladì, poèítaè nabootoval do UKC a zaøízení wi(4) bylo odstranìno. Proto¾e zmìny pøi boot -c  NEJSOU trvalé, musí být zapsány.
Tento pøíklad zapisuje zmìny provedené z boot -c do nového jádra ulo¾eného v bsd.new .
</p>

<ul><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
151 wi* disabled
Enter 'help' for information
ukc> <strong>quit</strong>
</pre></ul>


<p>
<font color= "#0000e0">
<a href= "index.html">[Zpátky na hlavní stránku]</a>
<a href= "faq4.html">[Do sekce 4.0 - Prùvodce instalací]</a>
<a href= "faq6.html">[Do sekce 6.0 - Nastavení sítì]</a>
</font>
</p>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq5.html,v 1.57 ]
<br>
$Translation: faq5.html,v 1.8 2002/04/03 20:24:30 certik Exp $
<br>
$OpenBSD: faq5.html,v 1.8 2002/04/05 06:15:31 jufi Exp $
</small>
</body>
</html>
