<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
    <title>OpenBSD Upgrade Mini-FAQ</title>
  </head>

  <body bgcolor="#FFFFFF" text="#000000" link="#23238E">

    <h1>MINI-FAQ: Upgrade OpenBSD</h1>

    <h2>Poslední OpenBSD Release - 3.3</h2>

    <address>
      <p>Kjell Wooding 
	&lt;<a href="mailto:kjell@openbsd.com">kjell@openbsd.org</a>&gt;<br>
	Aktualizováno:
	$OpenBSD: upgrade-minifaq.html,v 1.2 2003/11/09 23:58:56 horacio Exp $</p>
      <p>Èeský pøeklad: Milo¹ Urbánek
	&lt;<a href="mailto:milos_at_openbsd.cz">milos_at_openbsd.cz</a>&gt;<br>
    </address>
    <br>
    
    <blockquote>
      <p>Cílem tìchto Mini-FAQ je pokusit se adresovat problémy, kterým
	u¾ivatelé èelí nejèastìji pøi upgrade mezi rùznými verzemi OpenBSD,
      nebo mezi verzemi a <em>-current</em>. Aèkoliv lze tyto FAQ
	stì¾í pova¾ovat za
      <em>Mini</em>, tento dokument si ponechal jméno Mini-FAQ
      svého pøedchùdce z historických dùvodù a také kvùli konzistenci.
      Informace o star¹ích verzích lze nalézt  <a href=
      "../upgrade-old.html">v oddìleném dokumentu</a>.</p>
    </blockquote>

    <p>
      Upgrade-MiniFAQ jsou urèeny pro <b>pokroèilé u¾ivatele</b>.
      Pokud jste zaèáteèník, nebo si <b>úplnì nerozumíte</b>
      s va¹ím kompilátorem a toolchain, pak upgrade ze zdrojových kódù
      <b>není urèen pro vás</b>. Nainstalujte si místo toho binární release
      nebo snapshot a pak aplikujte relevantní instrukce ní¾e pro upgrade
      <tt>/etc</tt>.
    </p>

    <h2>Obecné otázky ohlednì upgrade</h2>
    
    <p>
      <a href="#1.1">1.1: Terminologie. Co je <em>-current</em>?
	Co jsou to snapshoty? Co je to <em>-stable</em>?</a><br>
      
      <a href="#1.2">1.2: Jaká je nejjednodu¹¹í cesta pro upgrade na
	<em>-current</em>?</a><br>
      
      <a href="#1.3">1.3: Hledal jsem, ale ¾ádné snapshoty na FTP jsem nena¹el.
	Kam se podìly?</a><br>
      
      <a href="#1.4">1.4: Jak získám poslední verzi zdrojových kódù?</a><br>
      
      <a href="#1.5">1.5: OK, mám zdrojáky. Jak je teï vybuilduji?
	</a><br>
      
      <a href="#1.6">1.6: Pustil jsem make build, ale skonèil v pùli cesty.
	Musím to celé zase pustit nanovo?
	</a><br>
      
      <a href="#1.7">1.7: V prùbìhu buildování se objevují chyby. Co s tím?
	</a><br>
      
      <a href="#1.8">1.8: Existuje standardní zpùsob, jak upgradovat
	kompilátor, <em>gcc</em>?</a><br>
      
      <a href="#1.9">1.9: Jaký je nejlep¹í zpùsob pro upgrade
	<tt>/etc</tt>, <tt>/var</tt> a <tt>/dev</tt>?</a><br>
      
      <a href="#1.10">1.10: Jak vyèístím ten nepoøádek ze stromu se zdrojovými
	kódy?</a><br>
      
      <a href="#1.11">1.11: Musím být root, abych mohl pustit <em>make
	  build</em>?</a><br>
      
      <a href="#1.12">1.12: Proè nevidím nová zaøízení?
	</a><br>
      
      <a href="#1.13">1.13: Je jednoduchý zpùsob, jak zmìnit souborovou
	hierarchii?</a><br>

      <a href="#1.14">1.14: Po provedení upgrade <em>ps</em> hlásí
	"proc size mismatch."</a><br>

      <a href="#1.15">1.15: Jak mohou upgradovat na poslední snapshot?</a><br>


    </p>
    
    <h2>Upgrade z 3.4</h2>
    <p>
      <a href="#3.4.1">3.4.1: Zmìna minor number u zaøízení svnd</a>
      <a href="#3.4.2">3.4.2: Nový u¾ivatel a skupina _pflogd</a><br>
    </p>
  
    <h2>Upgrading z 3.3</h2>

    <p>
      <a href="#3.3.1">3.3.1: Podpora i386 W^X</a><br>
      <a href="#3.3.2">3.3.2: Zmìna syscallu mquery</a><br>
      <a href="#3.3.3">3.3.3: i386 flag day, zmìna exe addr/MAXDSIZ</a><br>
      <a href="#3.3.4">3.3.4: Zmìna config</a><br>
      <a href="#3.3.5">3.3.5: Pou¾ití __attribute__((bounded)) u urèitých
                funkcí</a><br>
      <a href="#3.3.6">3.3.6: Nová u¾ivatel a skupina _syslogd</a><br>
      <a href="#3.3.7">3.3.7: Nový formátovací atribut __kprintf__ 
		v kernel headers</a><br>
    </p>
    
    <h2>Upgrade z 3.2</h2>
    
    <p>
      <a href="#3.2.1">3.2.1: Nový Perl</a><br>
      <a href="#3.2.2">3.2.2: Nové skupiny _radius, _token a _shadow</a><br>
      <a href="#3.2.3">3.2.3: Dùle¾ité zmìny v kompilátoru</a><br>
      <a href="#3.2.4">3.2.4: Nový u¾ivatel a skupina _spamd</a><br>
      <a href="#3.2.5">3.2.5: Alias pro ipv6-icmp</a><br>
      <a href="#3.2.6">3.2.6: Nová skupina _lkm</a><br>
      <a href="#3.2.7">3.2.7: Nová libpthread</a><br>
      <a href="#3.2.8">3.2.8: Zmìny linkeru pro ELF architektury </a><br>
      <a href="#3.2.9">3.2.9: Odstranìní /var/at a zmìny v crontabu</a><br>
    </p>
    
    <h2>Upgrade z 3.1</h2>
    
    <p>
      <a href="#3.1.1">3.1.1: Noví u¾ivatelé/skupiny</a><br>
      <a href="#3.1.2">3.1.2: Nová skupina crontab(1) a at(1)</a><br>
      <a href="#3.1.3">3.1.3: Nové Binutils</a><br>
      <a href="#3.1.4">3.1.4: Nová konfigurace S/Key</a><br>
      <a href="#3.1.5">3.1.5: Nová práva pro lp*</a><br>
      <a href="#3.1.6">3.1.6: atrun(8) není potøeba</a><br>
      <a href="#3.1.7">3.1.7: nat.conf zakomponován do pf.conf</a><br>
      <a href="#3.1.8">3.1.8: Nová polo¾ka v souboru fbtab pro xdm</a><br>
      <a href="#3.1.9">3.1.9: Pou¾ití __attribute__((sentinel)) pro urèité
	funkce</a><br>
    </p>

    <h2>Upgrade z 3.0</h2>
    
    <p>
      <a href="#3.0.1">3.0.1: Nová klávesnice podporována v mtree(8)</a><br>
      <a href="#3.0.2">3.0.2: Odstranìní libdl na ELF platformách</a><br>
      <a href="#3.0.3">3.0.3: Nový regression framework</a><br>
      <a href="#3.0.4">3.0.4: ssh config files pøesunuty do /etc/ssh/</a><br>
    </p>
    
    <h2>Upgrade z 2.9</h2>

    <p>
      <a href="#2.9.1">2.9.1: Noví u¾ivatelé/skupiny - <em>proxy</em>,
	<em>smmsp</em> a <em>popa3d</em></a><br>

      <a href="#2.9.2">2.9.2: Nový packet filter: <em>pf</em></a><br>

      <a href="#2.9.3">2.9.3: Zmìny v <em>make</em></a><br>

      <a href="#2.9.4">2.9.4: Build neprobìhne kvùli chybì v KerberosV
	</a><br>

      <a href="#2.9.5">2.9.5: Nová verze <em>sendmail</em></a><br>

      <a href="#2.9.6">2.9.6: <tt>/etc/primes</tt> pøesunuty</a>

    </p>
    

    <h2>Upgrade z døívìj¹ích verzí</h2>

    <p>Informace ohlednì upgrade pro OpenBSD 2.3 a¾ 2.8 
      byly pøesunuty do <a href="../upgrade-old.html">separátního dokumentu
	</a>. Tenhle dokument byl u¾ moc velký.
      </p>


    &nbsp;<hr width="30%">

    <a name="1.0"></a> 
    <h2>Obecné otázky ohlednì upgrade</h2>

    <a name="1.1"></a> 
    <h3>1.1: Terminologie. Co je to <em>-current</em>? Co to jsou 
      snapshoty? Co to je <em>-stable</em>?</h3>
    
    <p>Pøed verzí OpenBSD 2.7 se vývoj OpenBSD realizoval z jednoho,
	nerozvìtveného stromu zdrojových kódù. Poèínaje 2.7, byla pøidána
	tzv. patch branch -- vìtev oprav.
      </p>
    
    <p>V pøibli¾nì ¹esti-mìsíèních intervalech jsou vydávány nové verze --
      <em>release</em> OpenBSD. Jejich èíslování je provádìno bì¾ným zpùsobem
      (2.x, 3.x). Nejaktuálnìj¹í verze OpenBSD je v¾dy uvedena na vrchu
	tohoto dokumentu.
      </p>
    
    <p><em>-current</em>, zkratka pro <em>openbsd-current</em>,
      reprezentuje nejaktuálnìj¹í (do posledního okam¾iku) verzi stromu
	zdrojových kódù OpenBSD, obsa¾ených v CVS repozitáøi.
      Jedná se o strom zdrojových kódù, se kterým pracují nejèastìji
	vývojáøi OpenBSD. Verze <em>-current</em> obsahuje ve¹kerý kód,
      který je plánován pro budoucí verzi OpenBSD. Èas od èasu dobrodruhové
	zapomenou na stabilní verze OpenBSD a rozbìhnou na svém poèítaèi
	openbsd-current, obykle proto, aby mohli s výhodou pou¾ít nové
	vlastnosti a mo¾nosti, které nejsou dosud k dispozici v nové
	formální verzi. Upgrade na <em>-current</em> nedoporuèujeme
	u¾ivatelùm bez nále¾itých technických znalostí.</p>
    
    <p>Mezi formálními verzemi je vytváøena øada tzv. <em>snapshotù</em>,
které jsou k dispozici na
      <a href="ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/">FTP
	serverech.</a> Snapshoty jsou v podstatì testovací
      <em>-current</em> verze zdrojových kódù. Proto¾e snapshoty odrá¾ejí
	nejaktuálnìjí stav vývoje OpenBSD, není mo¾né garantovat,
	¾e budou fungovat korektnì (nebo budou vùbec fungovat).
	Snapshoty jsou docela u¾iteèné, kdy¾ se chcete od formální verze
	OpenBSD (nebo star¹í verze -current) dostat k nejaktuálnìj¹í
	verzi systému. Pokud se rozhodnete bì¾et na
      <em>-current</em> doporuèujeme vám sledovat
      <a href="../../cs/mail.html">konferenci</a> <em>source-changes</em>.
      Do této konference jsou automaticky odesílány krátké zprávy o zmìnách,
	 obsahující hodnotnou informaci o provedené zmìnì, napø.
	vylep¹ené podpoøe konkrétního hardware, èi nové vlastnosti apod.
      </p>
    
    <p>Poèínaje OpenBSD 2.7, byla vytvoøena vìtev patchù --
	 <a href="../../cs/stable.html">patch branch</a>
	 (nazývaná také jako <em>-stable</em>). Tato vìtev zdrojových kódù
      obsahuje v základì release, ke kterému se vztahuje a dùle¾ité opravy
	nebo záplaty (dùle¾ité jsou zejména opravy chyb, plus dal¹í opravy,
	 které jsou zøejmé a jednoduché, ale nezaslou¾í si separátní polo¾ku
	 v errata).
      </p>
    
    <p>The <a href="../../cs/ports.html">ports tree</a> -- strom portù
	je integrální èást systému. Strom portù byste mìli aktualizovat
	ve stejném èase jako zbytek celého systému, postupujíce podle pravidel
	pro aktualizaci ostatních èástí systému; tj. mìli byste bì¾et
	pouze -stable porty a -stable systém nebo -current porty a -current
	systém.
      </p>

    <a name="1.2"></a>
    <h3>1.2: Jaká je nejlep¹í cesta pøi upgrade na
      <em>-current</em>?</h3>
    
    <p>V dùsledku zmìn v knihovnách je pøímý pøesun z release na
      <em>-current</em> nìkdy nesnadný. Nejménì bolestivá cesta pøi
      upgrade na <em>-current</em> je provést nejprve upgrade na
      <a href="#1.15">poslední snapshot</a>.
      Jakmile máte jednou nainstalovaný snaphot, poslední zdrojové kódy
	si <a href="#1.4">stáhnete</a> a <a href="#1.5">vybuildujete</a>. Tato
      procedura by mìla eliminovat vìt¹inu problémù, vzniklých kvùli
	nekompatibilitì toolchain a knihoven.
      </p>

    <a name="1.3"></a> 
    <h3>1.3: Hledal jsem, ale ¾ádné snapshoty na FTP jsem nena¹el.
      Kam se podìly?</h3>
    
    <p>Snapshoty jsou odstraòovány jakmile zastarají
      (a nejsou ji¾ dùle¾ité). Pokud nejsou k dispozici ¾ádné snapshoty,
	mìli byste provést upgrade na poslední release a provést build
	ze zdrojových kódù.
      </p>

    <a name="1.4"></a> 
    <h3>1.4: Jak získám poslední verzi zdrojových kódù?</h3>

    <p>Krátká odpovìï:
      <a href="../../cs/anoncvs.html">http://www.openbsd.org/cs/anoncvs.html</a></p>
    
    <p>Pøíklad. Pro sta¾ení celého stromu zdrojových kódù pomocí CVS: 
	(za pou¾ití shellu ksh). Ostatní nahraïte <em>setenv</em> místo
      <em>export</em>)</p>

<pre>
  # export CVSROOT=anoncvs@anoncvs.ca.openbsd.org:/cvs
  # export CVS_RSH=/usr/bin/ssh
  # cd /usr
  # cvs -q get -P src
</pre>

    <p>Poznamenejme, ¾e takto stáhnete -current. To jste zøejmì nechtìli.
      Pro sta¾ení verze napø. 3.2-stable pou¾ijte</p>

<pre>
  # cvs -q get -rOPENBSD_3_2 -P src
</pre>

    <a name="1.5"></a> 
    <h3>1.5: Dobøe, mám zdrojové kódy. Jak je vybuilduji?</h3>
    
    <p>Základní instrukce jsou v
      <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/Makefile"
	 ><tt>/usr/src/Makefile</tt></a>.
      Zde uvádíme sumáø aktivit.</p>
    
    <ol>
      <li>
        <p>Sma¾te staré objektové soubory.</p>
	
        <p>Pokud máte oddìlenì vytvoøený adresáø /usr/obj, sma¾te jej
	  a znovu vytvoøte symbolické odkazy:</p>

<pre>
  # rm -rf /usr/obj/*
  # cd /usr/src
  # make obj
</pre>

        <p>Pokud máte pocit, ¾e tento krok trvá moc dlouho, mù¾e se vám
	hodit umístìní /usr/obj na oddìlený diskový oddíl
	a pou¾ití <em>newfs</em> namísto <em>rm</em>. Já napøíklad pou¾ívám:
	  </p>

<pre>
  # umount /usr/obj
  # newfs wd0h
  # mount /usr/obj
  # make obj
</pre>

        <p>Pokud máte strach, ¾e vám nìjaké objektové soubory zùstaly ve
	stromì se zdrojovými kódy, spus»te:
	  </p>

<pre>
  # cd /usr/src
  # find . -type l -name obj | xargs rm
  # make cleandir
  # rm -rf /usr/obj/*
  # make obj
</pre>

      </li>
      
      <li>
        <p>Proveïte jakékoliv konfiguraèní zmìny, které jsou specifické
	pro danou verzi. Kupøíkladu u¾ivatelé
	  verze 2.3 musí pøidat u¾ivatele a skupinu <em>named</em>
	  pøedtím ne¾ provedou pøesun k 2.4 a pozdìj¹í. Podívejte se
	do sekce Mini-FAQ specifické pro danou verzi OpenBSD.
	</p>
      </li>
      
      <li>
        <p>Ujistìtì se, ¾e jsou vytvoøeny v¹echny dùle¾ité adresáøe.
	  To je zejména dùle¾ité pøi upgrade ze star¹ích verzí, ale je
	to také nutné obèas i v jiných pøípadech. Nejjednodu¹¹í cesta
	jak to zjistit je provést:
	  </p>
<pre>
  # cd /usr/src/etc &amp;&amp; DESTDIR=/ make distrib-dirs
</pre>

      </li>

      <li>
        <p>Zkompilujte nové jádro.</p>
<pre>
  # cd /usr/src/sys/arch/`machine`/conf
</pre>

        <p>Vìt¹ina u¾ivatelù pou¾ije GENERIC:</p>
<pre>
  # config GENERIC
  # cd ../compile/GENERIC
</pre>

        <p><strong>Poznámka:</strong> Èistý sadomasochista si bude chtít
	jistì zkompilovat vlastní jádro. V takovém pøípadì je nejlep¹í
	zaèít od jádra GENERIC a jeho konfiguraci oøezat. Vhodná je následující
	procedura:</p>
<pre>
  # cp GENERIC MYKERNEL
  # vi MYKERNEL
  (oeditujte MYKERNEL podle libovùle)
  # config MYKERNEL
  # cd ../compile/MYKERNEL
</pre>

        <p>V ka¾dém pøípadì:</p>
<pre>
  # make clean &amp;&amp; make depend &amp;&amp; make
  (pouze pro architekturu arc) zkopírujte bsd.ecoff na vá¹ oddíl s FAT
  # cp /bsd /bsd.old &amp;&amp; cp bsd /bsd
  # chown root:wheel /bsd (pokud jste kompilovali jako nìkdo jiný)
  (reboot)
</pre>
      </li>

      <li>
        <p>Kompilace systému.</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
        <p>Aktualizujte<tt>/etc</tt> a <tt>/dev</tt> ruènì. Tyto dva
	adresáøe nejsou automaticky aktualizovány. Vyberte si adresáø,
	který má dost místa, aby se do nìj ve¹ly /, /dev, /var, a /etc.
	V následujícím pøíkladì pou¾ijeme
	  <em>/home/newroot</em></p>
<pre>
  # mkdir /home/newroot          
  # export DESTDIR=/home/newroot
  # cd /usr/src/etc &amp;&amp; make distribution-etc-root-var
</pre>

        <p>Nyní porovnejte soubory v /home/newroot s tìmi, co se 
	nainstalovaly. Nahraïte èi zaktualizujte soubory podle nutnosti.
	  </p>
<pre>
  # rm -rf /home/newroot   (poté co jste hotovil)
</pre>
      </li>

      <li>
        <p>Proveïte reboot, abyste se ujistili, ¾e soubory v /etc jsou 
	korektní</p>
      </li>
    </ol>

    <a name="1.6"></a> 
    <h3>1.6: Pustil jsem make build, ale zastavil se v pùli. Mám to celé
	pustít znovu?</h3>

    <p>My bychom to udìlali, ale pokud chcete opravdu zaèít tam, kde jste
	skonèili, udìlejte:
      </p>
<pre>
  # cd /usr/src
  # make -n build
</pre>

    <p>Takto zjistíte, co dìlá make build. Kupøíkladu, nám øíká:
      </p>
<pre>
  (cd /usr/src/share/mk &amp;&amp;  make install)
  (cd /usr/src/include; make prereq;  make includes)
  make cleandir
  (cd /usr/src/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/gnu/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/kerberosIV/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/gnu/usr.bin/perl &amp;&amp;  make -f Makefile.bsd-wrapper config.sh &amp;&amp;  make -f Makefile.bsd-wrapper depend &amp;&amp;  make -f Makefile.bsd-wrapper perl.lib &amp;&amp;
  make -f Makefile.bsd-wrapper install.lib)
  make depend &amp;&amp; make &amp;&amp;  make install
</pre>

    <p>Chcete-li zaèít, kde jste skonèili, vyberte jednodu¹¹e pøíkazy
	od bodu, kde jste pøedtím skonèili.
      </p>
    
    <p>Pokud aplikujete tuto proceduru, mù¾ete si vytvoøit vlastní target
	v makefajlu. Jednodu¹e zkopírujte polo¾ku pro 
      <em>build</em> (do <em>build-noclean</em>, kupøíkladu), a
      sma¾te odkaz na <em>make cleandir</em>.</p>

    <a name="1.7"></a> 
    <h3>1.7: Dostávám chyby bìhem buildování. Co mám dìlat?
      </h3>
    
    <p>Pokud vám skonèí <em>make build</em> s chybou, je to mo¾ná kvùli
	tomu, ¾e jste zapomnìli pøedtím smazat staré objektové soubory.
      Podívejte se na <a href="#1.5">1.5</a> pro detaily.
      </p>

    <p>Pokud jsi si jisti, ¾e vá¹ strom je èistý a prostý v¹ech tìch
	objektových souborù a poøád máte problémy s make build, stala
	se pravdìpodobnì jedna z následujících vìcí:
      </p>
    
    <ol>
      <li>Pøihodil se vám známý problém pøi upgrade. Ujistìte se,
	¾e jste si pøeèetli odpovídající sekci tohoto dokumentu 
	(pøípadnì jeho anglického originálu) a ¾e jste nále¾itì pou¾ili
	uvedené instrukce.</li>
      
      <li>Objevili jste nový problém pøi upgrade. To je dùsledek va¹eho
	¾ivota na hranì s -current. Sna¾te se prosondovat 
	<a href="../../cs/mail.html">misc@ a tech@</a> pro mo¾né workarounds.
	</li>
      
      <li>Nìkdo patrnì svojí zmìnou naru¹il zdrojové kódy. Tento typ chyby
	 se vyskytuje zøídka a obvykle je okam¾itì opraven.
	Zkuste poèkat pár hodin a poté stáhnìte zdrojové kódy znovu.
	Pokud mù¾ete èekat déle, zkuste stáhnout zdrojové kódy o den èi dva
	pozdìji.
	</li>
    </ol>

    <p>Pokud jste vyzkou¹eli v¹echny uvedené alternativy a problém
	pøetrvává po nìkolik dnù, po¹lete mail do 
      misc@openbsd.org. Ujistìtì se, ¾e za¹lete v¹echny chybové hlá¹ky,
	pøípadnì informace o va¹em nastavení.
      </p>

    <a name="1.8"></a> 
    <h3>1.8: Provádím upgrade na novou verzi kompilátoru
      (<em>gcc</em>). Existuje standardní postup?
      </h3>

    <p>Proto¾e upgrade kompilátoru je svým zpùsobem podobný problému
	slepice a vejce, zmìny ve kompilátoru, který je ve stromu se
	zdrojovými kódy vy¾adují trochu více pozornosti. Obecnì mù¾ete
	provést nìkterou z tìchto procedur:
      </p>

    <p>(ano, ní¾e buildujete dvakrát)</p>

<pre>
  # rm -r /usr/obj/gnu/egcs/gcc/*
  # cd /usr/src/gnu/egcs/gcc
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
</pre>

    <p>A pak zase spus»te jako obvykle <em>make build</em>.</p>

    <p>Tento postup mù¾ete urychlit za pou¾ití tzv.
      BOOTSTRAP procedury:</p>

<pre>
  # cd /usr/src/gnu/egcs/gcc
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper -DBOOTSTRAP
  # make -f Makefile.bsd-wrapper -DBOOTSTRAP install
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <a name="1.9"></a> 
    <h3>1.9: Jaká je nejlep¹í cesta pro upgrade <tt>/etc</tt>,
      <tt>/var</tt>, a <tt>/dev</tt>?</h3>
    
    <p><strong>Krátká odpovìï</strong>: ruènì.</p>
    
    <p><strong>Dlouhá odpovìï</strong>:</p>

    <p>Podle nepsaného zákona software v OpenBSD nemodifikuje soubory v
      <tt>/etc</tt> automaticky. To znamená, ¾e je
      <em>v¾dy</em> na administrátorovi, aby udìlal zmìny sám.
      Upgrade není ¾ádnou vyjímkou. Pro aktualizaci souborù v tomto adresáøi
	nejprve zjistìtì, k jakým zmìnám do¹lo v základních
      (distribuèních) souborech a poté manuálnì provìdte potøebné zmìny.
      </p>

    <p>Chcete-li napø. zjistit, jaké soubory se nedávno zmìnily, udìlejte:
      </p>

<pre>
  # cd /usr/src/etc
  # ls -lt |more
</pre>

    <p>Chcete-li vidìt v¹echny zmìny v <tt>/etc</tt> mezi libovolnými
	verzemi OpenBSD, pou¾ijte
      <a href="../../cs/anoncvs.html">CVS</a>. Pro výpis zmìn mezi
      3.1 a 3.2, udìlejte:</p>

<pre>
  # cd /usr/src/etc
  # cvs diff -u -rOPENBSD_3_1 -rOPENBSD_3_2
</pre>

    <p>Poté, co jste identifikovali potøebné zmìny, aplikujte je do va¹eho
	lokálního stromu, pøi zachování v¹ech lokálních nastavení, které
	jste provedli døíve.
      </p>

    <p>Typické zmìny v <tt>/etc</tt> mezi verzemi OpenBSD jsou:
      </p>
     
    <ul>
      <li>Zmìny v <tt>/etc/protocols</tt> a <tt>/etc/services</tt></li>
      <li>Nová sysctl. (viz <tt>/etc/sysctl.conf</tt>)</li>
      <li>Zmìny standardních úloh pro cron. Viz <tt>/etc/daily</tt>, 
	<tt>/etc/weekly</tt>, <tt>/etc/monthly</tt>, a <tt>/etc/security</tt>
      </li>
      <li>V¹echny rc skripty, vèetnì netstart</li>
      <li>Zmìny zaøízení. Viz
	<a href="#1.12">1.12</a>
      </li>
      <li>Zmìny souborové hierarchie v  <tt>/etc/mtree</tt>. Viz
	<a href="#1.13">1.13</a>
      </li>
      <li>
	Noví u¾ivatelé v (<tt>/etc/passwd</tt>) a skupiny v (<tt>/etc/group</tt>)
      </li>
    </ul>


    <a name="1.10"></a> 
    <h3>1.10: Jak sma¾u v¹echen ten nepoøádek z mých zdrojových kódù?
      </h3>
    
    <p>Nejdùle¾itìj¹í vìc, kterou musíte udìlat je smazat va¹e obj adresáøe.
      Zde je procedura, která zaktualizuje zdrojové kódy a zároveò
	odstraní v¹echny zbylé obj soubory:
      </p>

<pre>
  # cd /usr/src
  # cvs -q -d anoncvs@some.anon.server:/cvs up -Pd
  # find . -type l -name obj | xargs rm
  # make -k cleandir
  # rm -rf /usr/obj/*
  # make obj
</pre>

    <p>Pokud máte poøád problémy, mo¾ná budete potøebovat pøidat volby
      <tt>-I ! -I CVS -I obj</tt> do va¹ich aktualizaèních pøíkazù pro CVS.
      Tímto identifikujete zbytkový "bordýlek" ve va¹ich zdrojových kódech.
	</p>

    <a name="1.11"></a> 
    <h3>1.11: Musím být root pro pu¹tìní <em>make
	build</em>?</h3>

    <p>Aèkoliv urèité kroky procesu make build potøebují privilegia superu¾ivatele,
      samotný build proces obsahuje vazbu na pøíkaz
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8"
	 >sudo(8)</a> který tento proces dostateènì zjednodu¹í.
      </p>

    <p>Pokud máte dobøe nastavený soubor <tt>/etc/sudoers</tt>,
      mù¾ete pou¾ít sudo následujícím zpùsobem:</p>
    
    <ul>
      <li>Nastavte SUDO=/usr/bin/sudo ve va¹em prostøedí pøes spu¹tìním
	buildu, nebo
	</li>

      <li>Pøidejte øádku "SUDO=/usr/bin/sudo" do va¹eho souboru
	<tt>/etc/mk.conf</tt>.</li>
    </ul>

    <a name="1.12"></a> 
    <h3>1.12: Proè nevidím nová zaøízení?</h3>
    
    <p>Skript <tt>/dev/MAKEDEV</tt> není aktualizován automaticky
	bìhem <em>make build</em> build procesu. Obecnì platí, ¾e
	je dobré zkopírovat a spustit tento skript z va¹eho stromu
	se zdrojovým kódem bìhem provádìní upgrade:
      </p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <a name="1.13"></a> 
    <h3>1.13: Existuje jednoduchý zpùsob jak provést zmìny v souborové
	hierarchii?
      </h3>

    <p>Èas od èasu jsou pøidány/odstranìny soubory a adresáøe ze souborové
	hierarchie. Rovnì¾ se mù¾e zmìnit nastavení práv na èásti nebo
	celém filesystému. Jednoduchý zpùsob, jak zajistit, ¾e souborová
	hierarchie je up-to-date je pou¾ít program
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	mtree(8)</a>.</p>
    
    <p>Nejprve stáhntìtì aktuální zdrojové kódy, a pak:</p>

<pre>
  # cd /usr/src/etc/mtree
  # install -c -o root -g wheel -m 600 special /etc/mtree
  # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre>

    <p>Va¹e souborová hierarchie by nyní mìla být up-to-date.</p>

    <a name="1.14"></a> 
    <h3>1.14: Po provedení upgrade <em>ps</em> hlásí
      "proc size mismatch."</h3>

    <p>
	Vás userland a kernel nejsou v souladu. Obé musí být zkompilováno
	ze stejných zdrojových kódù, jeliko¾ mezi nimi existují urèité
	závislosti. Pøekompilujte kernel nebo userland z tìch samých
	zdrojových kódù a problém bude opraven.
    </p>
    
    <p>
	Proto¾e jste právì udìlali jednu z chyb, je právì teï ideální
	èas, abyste si tento dokument pøeèetli celý znovu, abyste tak
	pøede¹li pøípadným dal¹ím chybám a problémùm.
    </p>


    <a name="1.15"></a>
    <h3>1.15: Jak mù¾u provést upgrade na poslední snapshot?</h3>

    <p>
      Instalace snapshotu je dobrý zpùsob, jak zùstat up-to-date.
      Po¾adujeme po vás, abyste snapshoty testovali, obzvlá¹» v èase,
	kdy vychází beta-verze, abychom si mohli být v¹ichni jisti, ¾e
	dal¹í verze OpenBSD bude mít nejvy¹¹í kvalitu.
	Instalace snapshotu je také mnohem ménì nároèná ne¾ vybuildování
	celého systému ze zdrojových kódù.
    </p>

    <p>
      Nejjednodu¹¹í cesta, jak se dostat ke <em>-current</em> je stáhnout
	boot image a pøipravit se podle návodu ve
      <a href="faq4.html">FAQ</a>. Jakmile nabootujete, vyberte
	si volbu
      &quot;(U)pgrade&quot; a následujte instrukce.
    </p>

    <p>
	Existuje nìkolik zpùsobù, jak zpustit upgrade program.
      Obykle je nejjednodu¹¹í nabootovat z floppy nebo CD-ROM, èi umístit
	-current <a href="faq4.html#bsd.rd">bsd.rd</a> do va¹eho /
      a nabootovat jej místo <tt>/bsd</tt>.
      Jiné mo¾nosti zahrnjí nabootování ze sítì èi magnetické pásky.
      Ne v¹echny metody jsou k dispozici pro v¹echny architektury, odkazujeme
	vás proto na instalaèní instrukce pro dal¹í informace.
    </p>

    <p>
	I kdy¾ upgrade ruènì z místa obèas funguje, není to doporuèovaný
	postup. Jediná bezpeèná cesta pro provedení upgrade je nabootovat
	z nového instalaèního/upgrade média jak popsáno vý¹e.
    </p>

    <p>
	Ve v¹ech pøípadech musít provést upgrade
      <a href="#1.9">/etc, /var and /dev</a>
      ruènì.
    </p>

    <a name="3.4"></a>
    <h2>
     Upgrade z 3.4
    </h2>

    <a name="3.4.1"></a>
    <h3>
      3.4.1: minor number zmìny u zaøízení svnd (2003/10/10)
    </h3>
    <p>
      Minor number zaøízení
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=svnd&amp;sektion=4">svnd</a>
      bylo zmìnìno, budete muset zaktualizovat
      <tt>/dev/MAKEDEV</tt> poté, co nainstalujete nové jádro:
        <ul>
          <li>zaktualizujte zdrojové kódy
          <li>vybuildujte nové jádro
          <li>zkopírujte nový skript MAKEDEV do adresáøe dev, odstraòte
              zaøízení svnd(4) a rsvnd a vytvoøte nové:
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev
     # rm svnd* rsvnd*
     # ./MAKEDEV vnd
</pre>
          <li>Pokraèujte v build procesu
        </ul>

      Tento problém postihuje kohokoliv, kdo pou¾ívá snd zaøízení, co¾ je
	ka¾dý, kdo spustí
      <tt>make release</tt>.
    </p>
    <a name="3.4.2"></a>
    <h3>
      3.4.2: Nový u¾ivatel a skupina _pflogd (2003/10/23)
    </h3>
    <p>Démon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8"
      >pflogd(8)</a> nyní bì¾í se separovanými privilegii, a tudí¾ je tøeba nového u¾ivatele a skupinu.
      Skupinu pøidáte spu¹tìním pøíkazu
<pre>
  # groupadd -g 74 _pflogd
</pre>
      jako root a pøidáním u¾ivatelovy polo¾ky za pomocí
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _pflogd:*:74:74::0:0:pflogd privsep:/var/empty:/sbin/nologin
</pre>
    </p>


    <a name="3.3"></a>
    <h2>
      Upgrade z 3.3
    </h2>
    
    <a name="3.3.1"></a>
    <h3>
      3.3.1: Podpora W^X na i386 (2003/04/16)
    </h3>

    <p>Pro zapnutí podpory Writable xor eXecute na platformì i386 se
	OpenBSD/i386 pøesunulo od formátu a.out pro spustitelné soubory
	k formátu ELF. Flexibilita ELFu umo¾òuje lep¹í kontrolu nad
	rozvr¾ením spustitelného programu a umo¾òuje podporu
      	W^X support. a.out kompatibilita je pouze k dispozici v omezené
	podobì. Statické binární a.out soubory budou fungovat jako døíve,
	dynamické a.out binárky NEJSOU podporovány.
    </p>
    <p>UPGRADE zdrojových kódù z a.out -&gt; na ELF NENÍ podporován.
      INSTALACE SNAPSHOTU a vybuildování systému ze zdrojových kódù je
	jedna z mo¾ností, které budou fungovat.
      Vý¹e uvedené platí pouze pro i386, ostatních platforem se to netýká.
    </p>

    <a name="3.3.2"></a>
    <h3>
      3.3.2: zmìna syscallu mquery (2003/04/28)
    </h3>

    <p>Parametry systémového volání mquery byly zmìnìny tak, aby odpovídali
    volání mmap().
      Je zapotøebí provést upgrade systému ve správném poøadí:

      <pre>
      1. Vybuildujte a nabootujte nové jádro.
      2. (cd /usr/src && sudo make includes)
      3. (cd /usr/src/libexec/ld.so && make && sudo make install)
      4. 'make build'
      </pre>

	mquery pou¾ívá pouze platforma i386, ostatní architektury
	nemusí striktnì následovat vý¹e uvedené instrukce.

    <a name="3.3.3"></a>
    <h3>
      3.3.3: i386 flag day, zmìna exe addr/MAXDSIZ (2003/05/05)
    </h3>

    <p>Proto, aby MAXDSIZ mohla být nastavena zpìt na 1G, byla zmìnìna
	bázová adresa v¹ech spustitelných souborù z 0 na 0x1c000000. Kombinace
	tìchto zmìn vy¾aduje provést update ze snapshotu.
	Update ze zdrojových kódù není podporován. Zmìna postihuje pouze i386.
    </p>

    <a name="3.3.4"></a>
    <h3>
      3.3.4: Zmìna v <tt>config</tt> (2003/05/23)
    </h3>

    <p>Pøesunutí swapgeneric.c si vy¾ádalo zmìnu do
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.
      Pøed vybuildováním jádra musíte nejprve vybuildovat a nainstalovat 
	aktualizovaný config(8):
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean
  # make obj
  # make
  # make install
</pre>
      Nyní pust»e <tt>config</tt> na konfiguraci va¹eho jádra a spus»te
      "<tt>make depend</tt>" v adresáøi, kde kompilujete jádro jak uvedeno
      <a href="#1.5">vý¹e</a>. 

   <a name="3.3.5"></a>
   <h3>
    3.3.5: Pou¾ití  __attribute__((bounded)) u urèitých funkcí (2003/06/26)
   </h3>
      
   <p>
     __attribute__((bounded)) se nyní pou¾ívá pro detekci nesprávných argumentù
	u funkcí, které jako jeden z parametrù mají délku bufferu.
     <br><br>Budete muset vybuildovat gcc podle sekce
     <a href="#1.8">1.8</a>
     tìchto Mini-FAQ pøedtím, ne¾ se pustíte do <tt>make build</tt>.
   </p>

    <a name="3.3.6"></a>
    <h3>
      3.3.6: Nový u¾ivatel a skupina _syslogd (2003/07/31)
    </h3>
    <p>Démon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
      >syslogd(8)</a> nyní bì¾í s privilege separation a je nutné, abyste
vytvoøili u¾ivatele a skupinu _syslogd.
Skupinu pøidáte takto:
<pre>
  # groupadd -g 73 _syslogd
</pre>
      jako root, u¾ivatele pøidáte za pou¾ití
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _syslogd:*:73:73::0:0:Syslog Daemon:/var/empty:/sbin/nologin
</pre>
    </p>

    <a name="3.3.7"></a>
    <h3>
      3.3.7: Pou¾ití formátovacího atributu __kprintf__ v kernel headers
	(2003/08/23)
    </h3>
    <p>
      V kernel headers se pou¾ívá nový formátovací atribut __kprintf__ 
      proto, aby gcc vìdìlo o roz¹íøeních formátu v rámci kernelového
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=printf&amp;sektion=9">printf(9)</a>.
      <br><br>Budete muset vybuildovat gcc podle instrukcí v sekci<a href="#1.8">1.8</a>
     tìchto Mini-FAQ pøedtím, ne¾ spustíte <tt>make build</tt>. 
	Musíte takté¾ vybuildovat gcc z aktuálních zdrojových kódù, abyste
	získali podporu pro atribut __bounded__ uvedený v sekci
     <a href="#3.3.5">3.3.5</a>.
    </p>

    <a name="3.2"></a>
    <h2>
      Upgrade z 3.2
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: Nový Perl (2002/11/05)
    </h3>

    <p>Perl byl aktualizován na verzi 5.8.0.<br>
      V Perlu 5.8.0 se zmìnilo API modulu XS module v dùsledku pøechodu
	od stdio k PerlIO (viz perldelta manual page pro více informací).
      To znamená, ¾e jakýkoliv XS modul (perl .so soubory) který máte
	nainstalován
      <strong>MUSÍ</strong> být znovu vybuildován. Pokud uvidíte chybu typu
      <em>Undefined symbol "perl_get_sv"</em> pak je to právì tento problém.
	Pokud jste moduly, které máte, instalovali pomocí packages èi
	portù, pak mù¾ete zkontrolovat XS moduly ve va¹em systému pomocí:
      <pre>
	# grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
      Poté mù¾ete odstranit zbývající moduly pomocí<em>pkg_delete -f</em>
      a vybuildovat/nainstalovat je opìt z ports tree.

    <a name="3.2.2"></a>
    <h3>
      3.2.2: Nové skupiny _radius, _token a _shadow (2002/11/21)
    </h3>
    <p>Bylo pøidáno nìkolik nových skupin:
      <ul>
      <li>Skupina <em>_radius</em> pro read-only pøístup k souboru
	  <tt>/etc/raddb/servers</tt>.
      <li>Skupina <em>_token</em> pro read-only pøístup k databázi tokenù
	pou¾ívanou
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>,
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a>, a
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>.
      <li>Skupina <em>_shadow</em> pro read-only pøístup k
	  databázi shadow hesel.
      </ul>

	Budete muset pøidat vý¹e uvedené skupiny a upravit práva pro 
	nìkteré soubory pøedtím, ne¾ pustíte &quot;make build&quot;.
	Následující pøíkazy spus»te jako root:
	<pre>
	  # groupadd -g 63 _radius
	  # chgrp _radius /etc/raddb /etc/raddb/servers
	  # chmod g+x /etc/raddb
	  # chmod g+r /etc/raddb/servers

	  # groupadd -g 64 _token
	  # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
	  # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

	  # groupadd -g 65 _shadow
	  # chgrp _shadow /etc/spwd.db
	  # chmod 0640 /etc/spwd.db
	</pre>

      Nic si nedìlejte z hlá¹ek, které vám øíkají, ¾e soubor nebyl nalezen.
	To pouze znamená, ¾e jste nenastavili
      <em>token</em> èi <em>radius</em> autentizaci.

    <a name="3.2.3"></a>
    <h3>
      3.2.3: Dùle¾ité zmìny v kompilátoru (2002/12/02)
    </h3>
    <p>Ochrana stacku
 <a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
	byla pøidána do
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1"
      >gcc</a>. Budete muset lehce pozmìnit postup upgrade:
      <ul>
      <li>Zatím <b>NEBUILDUJTE</b> nové jádro.
      <li>Zatím <b>NEBUILDUJTE</b> gcc.
      <li>Vybuildujte a nainstalujte nový dynamický loader ld.so, pokud máte
	v systému sdílené knihovny.
        <pre>
	  # cd /usr/src
	  # make obj
          Pro ELF platformy (alpha, macppc, sparc, sparc64):
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
	  Pro a.out platformy (amiga, hp300, i386, mac68k, mvme68k):
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
	</pre>
      <li>Znovu vybuildujte a nainstalujte novou libc, za pou¾ití 
	nìkolika mála pøíkazù z
        <i>make build</i>.
	<pre>
          # cd /usr/src/include
	  # make prereq &amp;&amp; make includes
	  # cd /usr/src/lib/libc
	  # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
	</pre>
	Pokud máte pøíli¹ starý kompilátor, nebudete moci vybuildovat libc.
	V takovém pøípadì vám nezbývá, ne¾ provést upgrade ze snapshotu.
      <li>Znovu vybuildujte a nainstalujte gcc, viz <a href="#1.8">1.8</a>.
      <li>Pøekompilujte jádro.
        Spus»te znovu
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8"
	>config</a>, abyste pøegeneovali Makefile.
      <li>Proveïte reboot na nové jádro, a spus»te <i>make build</i>, abyste
	mohli zaèít pou¾ívat stack protection.
      </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: Nový u¾ivatel a skupina _spamd (2002/12/24)
    </h3>
    <p>Byly pøidány nový u¾ivatel a skupina _spamd pro démon
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8"
      >spamd(8)</a>.
	Spus»te jako root
<pre>
  # groupadd -g 62 _spamd
</pre>
      a pøidejte entry pomocí
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>
      3.2.5: Alias pro ipv6-icmp (2002/12/30)
    </h3>

    <p>Byl pøidán nový alias pro ipv6-icmp, <em>icmp6</em>  do 
      <tt>/etc/protocols</tt>.  Pokud chcete pou¾ít <em>icmp6</em> alias
      (pou¾itý v 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
      regression testech) musítì modifikovat øádku v <em>ipv6-icmp</em>
      <tt>/etc/protocols</tt>, pøidáním keywordu <em>icmp6</em> pøed #.
      Øádka bude vypadat takto:
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: Nová skupina _lkm (2003/01/05)
    </h3>

    <p>Nová skupina <em>_lkm</em> øídí pøístup k zaøízení
	  <tt>/dev/lkm</tt>.
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
          je¾ je nyní setgid _lkm.
    <p>
      Pøidejte skupinu a upravte práva na
      <tt>/dev/lkm</tt> pøedtím ne¾ pustíte &quot;make build&quot;.
	Pou¾ijte tyto pøíkazy jako root:
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: Nová libpthread (2003/01/14)
    </h3>

    <p><em>libc_r</em> a <em>libnpthread</em> byly odstranìny a nahrazeny
    <em>libpthread</em>.  Multithreadové programy by i nadále mìly být
	kompilovány s volbou <em>-pthread</em>; aby kompilátor provedl v¹e
	správnì.

    <p>Pøed odstranìním <em>libc_r</em> a <em>libnpthread</em> musí být
	threadované aplikac pøekompilovány s <em>libpthread</em>. Doporuèená
	sekvence:

    <ol>
      <li>
        <p>vybuildovat gcc podle <a href="#1.8">1.8</a>.
      <li>
        <p>vybuildovat system podle <a href="#1.5">1.5</a>.
      <li>
        <p>vybuildovat v¹echny multithreadové porty.
      <li>
        <p>odstranit nepou¾ívané knihovny:
<pre>
  # rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>
      3.2.8: Zmìny v linkeru pro platformy s ELF (2003/01/17)
    </h3>

    <p>Binutils/ld byly zmìnìny, aby poskytly nové bezpeènostní mo¾nosti
	pro spustitelné programy formátu ELF.
    	Namísto toho, aby datová sekce spustitelných programù byla oznaèena
	jako executable linkerem, zmìnilo se rozvr¾ení binárních souborù
	tak, aby bylo tøeba oznaèit jako executable pouze odpovídající
	sekce programu. Zmìna postihuje ELF platformy: alpha, sparc, sparc64,
 macppc.
    <p>
    Doporuèujeme pøedìlat binutils pøedtím ne¾ pøedìláte celý systém.
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
    Poté pøedìlejte celý systém podle <a href="#1.5">1.5</a>

    <a name="3.2.9"></a>
    <h3>
      3.2.9: Odstranìní /var/at a zmìny v crontabu (2003/02/19)
    </h3>

    <p>Obsah <tt>/var/at</tt> byl spojen s <tt>/var/cron</tt>
    a <em>at</em> bylo integrováno do <em>cron</em>. Navíc soubory allow
	a deny pro <em>cron</em> byly pøejmenovány na cron.allow a
    cron.deny, aby odpovídaly POSIXu a byly konzistentní s
	at.allow a at.deny.
    <p>
    Nejprve pøedìlejte systém podle <a href="#1.5">1.5</a>
    Poté pøesuòte existující soubory a restartujte crona:
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
    Ignorujte hlá¹ky o chybìjícíh allow èi deny souborech.
    Ne v¹echny jsou souèástí defaultní instalace.
    <p>
    Pokud je¹tì nemáte soubor cron.deny (nebyl instalován pøed
    OpenBSD 3.3) budete ho muset vytvoøit, abyste mohl spustit
	<em>crontab</em> jako jiný u¾ivatel ne¾ root.
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>

    <a name="3.1"></a>
    <h2>
      Upgrade z 3.1
    </h2>
    
    <a name="3.1.1"></a>
    <h3>
      3.1.1: Noví u¾ivatelé skupiny
    </h3>

    <p>Bylo pøidáno nìkolik nových u¾ivatlù a skupin:
      Podpora pro
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8"
      >authpf(8)</a> -- zapotøebí nová skupina. Rovnì¾ podpora pro 
	separaci privilegií v 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a>
      vy¾aduje u¾ivatele a skupinu <em>sshd</em>.
      Dal¹í u¾ivatelé a skupiny pro systémové slu¾by byly pøidány s pøíponou
      &quot;_&quot;.
	Pøidejte následující polo¾ky do
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
    </p>
<pre>
  sshd:*:27:27::0:0:sshd privsep:/var/empty:/sbin/nologin
  _portmap:*:28:28::0:0:portmap:/var/empty:/sbin/nologin
  _identd:*:29:29::0:0:identd:/var/empty:/sbin/nologin
  _rstatd:*:30:30::0:0:rpc.rstatd:/var/empty:/sbin/nologin
  _rusersd:*:32:32::0:0:rpc.rusersd:/var/empty:/sbin/nologin
  _fingerd:*:33:33::0:0:fingerd:/var/empty:/sbin/nologin
  _x11:*:35:35::0:0:X server:/var/empty:/sbin/nologin
</pre>
    
    <p>Pøidejte do <tt>/etc/group</tt>:</p>
       
<pre>
  sshd:*:27:
  _portmap:*:28:
  _identd:*:29:
  _rstatd:*:30:
  _rusersd:*:32:
  _fingerd:*:33:
  _sshagnt:*:34:
  _x11:*:35:
  authpf:*:72:
</pre>

    <a name="3.1.2"></a>
    <h3>
      3.1.2: Nové skupiny pro crontab(1) a at(1)
    </h3>

    <p>
      Programy
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
      crontab(1)</a> a
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=at&amp;sektion=1">
      at(1)</a> u¾ nemusí být setuid root, nyní jsou setgid
      <em>crontab</em>.

    <p>
      Ne¾ pustíte &quot;make build&quot;, pøidejte skupinu
      <em>crontab</em>.
      Pøidejte do <tt>/etc/group</tt>:</p>

<pre>
  crontab:*:66:
</pre>

<p>
      &quot;make build&quot; zaktualizuje nìkterá, ale ne v¹echna práva.
      Po dobìhnutí &quot;make build&quot; pus»te ruènì
      (pøedpokládejme shell <tt>/bin/csh</tt>):
</p>

<pre>
  # chgrp crontab /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # chmod 0640 /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # foreach f ( /var/cron/tabs/* )
	  set u=`basename $f`
 	  chown $u:crontab $f
    end
</pre>

<p>
      Pravdìpodobnì nebudete mít v¹echny allow/deny soubory, co¾ není problém.
</p>

    <a name="3.1.3"></a>
    <h3>
      3.1.3: Nové Binutils
    </h3>

<p>
Byly pøidány nové binutils (2.11.2), co¾ si vy¾ádalo aktualizovat
<em>libiberty</em>. Pøedìlejte tuto knihovnu v nìkolika krocích:
</p>
  
<pre>
  # cd /usr/src/gnu/egcs/libiberty
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <a name="3.1.4"></a>
    <h3>
      3.1.4: Nová konfigurace S/Key
    </h3>

    <p>
      Starý databázový soubor S/Key, <tt>/etc/skeykeys</tt>, byl nahrazen
	ze adresáø, <tt>/etc/skey</tt>, kde ka¾dý soubor je vlastnìn u¾ivatelem,
	ke kterému pøíslu¹í. <tt>/etc/skeykeys</tt> mù¾ete zkonvertovat
	do nového formátu pomocí (jako root):
    </p>
<pre>
  # skeyinit -C
  # mv /etc/skeykeys /etc/skeykeys.OLD
</pre>

<p>
      Poznamenejme, ¾e programy tøetích stran, které pou¾ívají pøímo
	S/Key budou muset být pøekompilovány.
</p>

    <a name="3.1.5"></a>
    <h3>
      3.1.5: Nová práva pro lp*
    </h3>

    <p>
      Spool adresáøe pou¾ívané lpd nyní musí být zapisovatelné skupinou daemon
	na to, aby lpr mohlo spoolovat soubory. Navíc musí být soubory
	ve spool adresáøi vlastnìny u¾ivatelem a skupinou daemon.
	Toho lze dosáhnout takto:
    </p>
<pre>
 # find /var/spool/output /var/spool/lpd -type d \
	-execdir chgrp daemon {} \; -execdir chmod g+rwx {} \;
 # find /var/spool/output /var/spool/lpd -type f \
	-execdir chown daemon:daemon {} \;
</pre>

    <a name="3.1.6"></a>
    <h3>
      3.1.6: atrun(8) ji¾ netøeba
    </h3>

    <p>
      Pøíkazu <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atrun&amp;sektion=8">atrun(8)</a>
      ji¾ není zapotøebí.  Jeho funkcionalita byla zahrnuta do programu
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8">cron(8)</a>.
      Mìli byste odstranit job <tt>/usr/libexec/atrun</tt> z crontabu
	u¾ivatele root za pou¾ití:
    </p>
    <pre>
      # crontab -e
    </pre>

    <p>
      Rovnì¾ odstraòte <tt>/usr/libexec/atrun</tt>,
      <tt>/usr/share/man/cat8/atrun.0</tt> a adresáø
      <tt>/var/at/spool</tt>.
    </p>

    <a name="3.1.7"></a>
    <h3>
      3.1.7: nat.conf slouèen s pf.conf
    </h3>

    <p>
	<tt>/etc/nat.conf</tt> byl slouèen s <tt>/etc/pf.conf</tt>.
	Musíte vlo¾it pravidla z nat.conf do pf.conf hned po pravidlech
	scrub a pøed filtrovací pravidla.
    </p>
    <p>
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
	má novou volbu pro nahrání sady pravidel,
	-f, a volby -R and -N mají nyní nový význam. Pøeètìtì si man page
	a zaktualizujte <tt>/etc/rc</tt>.
    </p>

    <a name="3.1.8"></a>
    <h3>
     3.1.8: Zapotøebí nová polo¾ka ve fbtab pro xdm
    </h3>

    <p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login&amp;sektion=1">
login(1)</a> potøebuje zmìnit vlastníka /dev/wsmouse na nového u¾ivatele
_x11, který je pou¾íván xdm pro revokaci privilegií na øadì platforem.
Zmìna do
<tt>/etc/fbtab</tt> je na platformì závislá. Soubor je vytvoøen
pomocí:
    </p>
<pre>
  # cat /usr/src/etc/fbtab.head > /etc/fbtab
  # cat /usr/src/etc/etc.`uname -m`/fbtab >> /etc/fbtab
  # cat /usr/src/etc/fbtab.tail >> /etc/fbtab
</pre>
<p>
Pokud máte vlastní zmìny v <tt>/etc/fbtab</tt>, musíte je spojit dohromady
s novým souborem ruènì.
</p>
   <a name="3.1.9"></a>
   <h3>
    3.1.9: Pou¾ití __attribute__((sentinel)) pro urèité funkce
   </h3>

   <p>
     Existuje nový atribut __attribute__((sentinel)) v gcc, který se
	pou¾ívá, pokud urèité funkce typu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exec&amp;sektion=3">
exec(3)</a>
     jsou pou¾ity bez ukonèovacího ukazatele na NULL.
     <br><br>Budete muset pøedìlat gcc podle 
     <a href="#1.8">1.8</a>
     tìchto Mini-FAQ, pøedtím ne¾ se pustíte do <tt>make build</tt>.
   </p>

    <a name="3.0"></a>
    <h2>
      Upgrade z 3.0
    </h2>
    
    <a name="3.0.1"></a>
    <h3>
      3.0.1: Nová klíèová slova pro mtree(8)
    </h3>

    <p>
      Musíte pøedìlat a nainstalovat novou verzi utility
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
      mtree(8)</a>, pøedtím ne¾ pustíte &quot;make build&quot;.
    </p>
<pre>
  # cd /usr/src/usr.sbin/mtree
  # make cleandir
  # make obj
  # make depend
  # make
  # make install
</pre>

    <a name="3.0.2"></a>
    <h3>
      3.0.2: Odstranìní libdl na ELF platformách
    </h3>
    
    <p>
      ELF platformy (alpha, macppc and sparc64) u¾ nepou¾ívají libdl.
      Pro upgrade následujte tyto kroky:
    </p>

    <ul>
      <li>
	<p>Rekompilace systému:</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
	<p>
	  Pokud jste úspì¹nì provedli &quot;make build&quot;, mù¾ete
	  smazat libdl. Packages, které byly slinkovány s libdl
	musí být pøeinstalovány. Pokud na to nejste pøipraveni, 
	pøeskoète následující krok. Snapshoty s opravenými balíky budou
	brzo k dispozici.
	</p>
<pre>
  # rm -f /usr/lib/libdl.* /usr/lib/libdl_pic.a
</pre>
	</li>
      <li>
	<p>
	  Po odstranìní libdl regenerujte cache sdílených knihoven:
	</p>
	
<pre>
  # ldconfig -R
</pre>
      </li>
    </ul>

    <a name="3.0.3"></a>
    <h3>
      3.0.3: Nový regresní framework
    </h3>
    
    <p>
      Do <tt>bsd.regress.mk</tt> byla pøidána nová infrastruktura pro
	regresní testování. Pøed spu¹tìním <em>make obj</em> si
	nainstalujte tento soubor.
    </p>

<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <a name="3.0.4"></a>
    <h3>
      3.0.4: konfiguraèní soubory ssh config pøesunuty do /etc/ssh/
    </h3>

    <p>
      Nejdøíve vytvoøte /etc/ssh/ podle sekce
      <a href="#1.13">1.13</a>
    </p>

    <p>
      Rekompilujte vá¹ systém:
    </p>
<pre>
  # cd /usr/src
  # make build
</pre>

    <p>
      Pøesuòte soubory /etc/ssh*_* do nového adresáøe /etc/ssh:
    </p>
<pre>
  # cd /etc
  # mv ssh*_* ssh/
</pre>

    <p>
      Budete muset
      <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.diff?r1=1.188&amp;r2=1.189">
	zmìnit va¹e <tt>rc</tt> skripty</a>.
    </p>

    <p>
      Zaktualizujte øádky <tt>HostKey</tt> v sshd_config. Napøíklad:
    </p>
<pre>
  HostKey /etc/ssh_host_key
</pre>

    <p>se zmìní na:</p>

<pre>
  HostKey /etc/ssh/ssh_host_key
</pre>

    <p>
      Poté restartujte sshd.
    </p>

    <a name="2.9"></a> 
    <h2>Upgrading from 2.9</h2>

    <a name="2.9.1"></a> 
    <h3>2.9.1: New users/groups - <em>proxy</em>, <em>smmsp</em>, and
      <em>popa3d</em>.</h3>

    <p>
      First, with the addition of the 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">
	pf(4)</a> firewalling package, and its 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8"
	 >ftp-proxy(8)</a> suite, a new user and group named
      <em>proxy</em> were added to the system. To support this
      addition, add the following user entry using 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
	vipw(8)</a>:</p>
    
<pre>
proxy:*:71:71::0:0:Proxy Services:/nonexistent:/sbin/nologin
</pre>

    <p>Also add the <em>proxy</em> group to /etc/group:</p>

<pre>
proxy:*:71:
</pre>

    <p>Second, as part of the Sendmail 8.12 upgrade, sendmail no
      longer runs setuid root. Both a new user and a new group, named
      <em>smmsp</em>, have been added to the system. Add a line like
      the following to your <tt>/etc/group</tt>:</p>

<pre>
smmsp:*:25:
</pre>

    <p>Then, run 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
	vipw(8)</a> and add the following line for the <em>smmsp</em>
      user:</p>

<pre>
smmsp:*:25:25::0:0:Sendmail Message Submission Program:/nonexistent:/sbin/nologin
</pre>

    <p>Make sure this line appears before any <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=yp&amp;sektion=8">
      yp(8)</a> settings line.</p>

    <p>Finally, a new user and group were added for Solar
      Designer's popa3d server, now part of the core system. Add the
      following to <tt>/etc/group</tt>:</p>

<pre>
popa3d:*:26:
</pre>

    <p>And using <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
      vipw(8)</a>, add</p>
<pre>
popa3d:*:26:26::0:0:POP3 server:/var/empty:/sbin/nologin
</pre>

    <a name="2.9.2"></a> 
    <h3>2.9.2: New packet filter: <em>pf</em></h3>

    <p>The IPF firewalling package that has been part of previous
      OpenBSD releases has been replaced with an all-new firewalling
      suite called <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">
	pf(4)</a>. As a result, a number of changes need to be
      made.</p>

    <p>First, <em>pf</em> depends on a new device file. To ensure
      that this special device is created, do the following:</p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <p>Second, a number of filesystem change have occurred. For
      your reference, the following binaries have been replaced:</p>

<pre>
OLD:
/sbin/ipf /sbin/ipfstat /sbin/ipnat /usr/sbin/ipfs
/usr/sbin/ipftest /usr/sbin/ipmon /usr/sbin/ipresend
/usr/sbin/ipsend /usr/sbin/iptest
NEW:
/sbin/pfctl
/usr/libexec/ftp-proxy
</pre>

    <p>Similarly, for the devices:</p>

<pre>
OLD: /dev/ipl /dev/ipnat /dev/ipstate /dev/ipauth
NEW: /dev/pf
</pre>

    <p>And finally, the filter configuration files:</p>

<pre>
OLD: /etc/ipf.rules /etc/ipnat.rules
NEW: /etc/pf.conf /etc/nat.conf
</pre>
    <p>The old ipfilter sample configuration files may be removed:
    </p>
<pre>
  # rm -rf /usr/share/ipf
</pre>

    <p>A mechanism for safely enabling <em>pf</em> has been added
      to the <tt>/etc/rc</tt> and <tt>/etc/rc.conf</tt> files. You
      will need to update these files to include the new hooking
      mechanism. If you wish to enable <em>pf</em>, set PF=YES in
      <tt>/etc/rc.conf</tt>.</p>

    <a name="2.9.3"></a> 
    <h3>2.9.3: Changes to <em>make</em></h3>

    <p>There have been changes to <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">
	make(1)</a> and its data files which may cause difficulties in
      the build process. This usually manifests as errors from
      <em>bsd.own.mk</em> during the build. To avoid these issues,
      first update the data files:</p>
<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <p>Then build and install the new make.</p>

<pre>
  # cd /usr/src/usr.bin/make
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  # make install
</pre>

    <p>Now proceed with your upgrade.</p>
    
    <a name="2.9.4"></a>
    <h3>2.9.4: Build fails because of KerberosV errors</h3>

    <p>Before you try building the whole system, you need to first
      build KerberosV.</p>

    <p>First, there is a new KerberosV configuration directory in
      <em>/etc</em>. If you have not already done so, use the <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	mtree(8)</a> procedure described in <a href="#1.13">section
	1.13</a> to create it:</p>

    <p>Now, build KerberosV</p>

<pre>
  # cd /usr/src/kerberosV
  # make obj
  # cd lib/roken
  # make 
  # cd ../../usr.bin/asn1_compile
  # make
  # make install
</pre>

    <p>You may also need to update your <tt>/etc/login.conf</tt>,
      to reflect that the file
      <tt>/usr/libexec/auth/login_krb-or-pwd</tt> has been renamed to
      <tt>login_krb<strong>4</strong>-or-pwd</tt>.</p>

    <a name="2.9.5"></a> 
    <h3>2.9.5: New <em>sendmail</em> version</h3>

    <p><a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">
	sendmail(8)</a> has been upgraded to version 8.12. As this
      version of <em>sendmail</em> no longer runs setuid root,
      significant changes have resulted.</p>

    <ol>
      <li>Both a new user and a new group (<em>smmsp</em>) have
	been added. If you have not yet done so, follow the procedure
	in <a href="#2.9.1">section 2.9.1</a> to create them.</li>

      <li>Several changes to the file hierarchy have occurred,
	including a new <tt>/var/spool/clientmqueue</tt> directory
	and new permissions for <tt>/var/spool/mqueue</tt>. These
	changes can both be made using the <a href=
        "http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	  mtree(8)</a> procedure described in <a href="#1.13">section
	  1.13</a>.</li>

      <li>
        <p>Add the following to root's <a href=
          "http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
	    crontab(1)</a>. This is necessary since <em>sendmail</em>
	  is no longer setuid root, and relies on this entry to do
	  parts of its job:</p>

<pre>
# sendmail clientmqueue runner
*/30    *       *       *       *       /usr/sbin/sendmail -L sm-msp-queue -Ac -q
</pre>

      </li>
      
      <li>
        <p>Upgrade sendmail:</p>

<pre>
  # cd /usr/src/gnu/usr.sbin/sendmail
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

        <p><strong>Note:</strong> The files <tt>submit.cf</tt> and
	  <tt>localhost.cf</tt> have been installed to your
	  <tt>/etc/mail</tt> directory. The first of these,
	  <tt>submit.cf</tt> (referred to as the "client"
	  configuration file in current sendmail documentation) is
	  used by mail user agents that want to submit mail locally
	  for delivery via sendmail. Due to the permissions changes
	  described above, this does not require root privileges; the
	  sendmail binary is set-groupid to group smmsp. The second
	  file, <tt>localhost.cf</tt>, is an OpenBSD-ism that runs
	  sendmail only listening on the localhost interface to
	  accept mail from the local host but not accept connections
	  from the network (you almost certainly want this if you
	  also use e.g., <a href=
          "http://www.openbsd.org/cgi-bin/man.cgi?query=smtpd&amp;sektion=8">
	    smtpd(8)</a> listening on the SMTP port on your outside
	  interface). For more details, see the file
	  <tt>SECURITY</tt> in
	  <tt>/usr/src/gnu/usr.sbin/sendmail/sendmail</tt>.</p>

        <p>It is highly recommended that you regenerate and update
	  your sendmail configuration files in <tt>/etc/mail</tt>.
	  You can find some working configuration files in
	  <tt>/usr/share/sendmail/cf</tt>. Note that localhost.cf is
	  generated from openbsd-localhost.mc.</p>
      </li>

      <li>
        <p>If you were running sendmail without the <tt>-bd</tt>
	  option in <tt>/etc/rc.conf</tt>, as the default
	  installation settings do, you will need to use
	  <tt>localhost.cf</tt>. Edit <tt>rc.conf</tt> to use the
	  following:</p>
<pre>
# For normal use: "-L sm-mta -bd -q30m"
sendmail_flags="-L sm-mta -C/etc/mail/localhost.cf -bd -q30m"
</pre>
      </li>

      <li>
        <p>Once your configuration file is ready, <a href=
         "http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">
	    kill(1)</a> the existing sendmail:</p>
<pre>
  kill `sed 1q /var/run/sendmail.pid`
</pre>

        <p>Restart the new sendmail with the appropriate options,
	  for example:</p>
<pre>
  /usr/sbin/sendmail -L sm-mta -bd -q30m
</pre>

        <p>for a configuration accepting mail from outside, or</p>

<pre>
  /usr/sbin/sendmail -L sm-mta -C/etc/mail/localhost.cf -bd -q30m
</pre>

        <p>for a local mail-only configuration.</p>
	
        <p><strong>Note:</strong> the <tt>-bd</tt> flag is now
	  needed in both cases.</p>
      </li>
    </ol>

    <p>The new <em>sendmail</em> should now be running.</p>

    <a name="2.9.6"></a> 
    <h3>2.9.6: <tt>/etc/primes</tt> Moved</h3>

    <p><tt>/etc/primes</tt> has been renamed to
      <tt>/etc/moduli</tt>. Simply copy this file from its old
      location or from <tt>/usr/src/etc</tt>.</p>


    <hr width="30%">

    <address>
      <p>
	<br>
	Originally [OpenBSD: upgrade-minifaq.html,v 1.177 ]
	<br>
	$Translation: upgrade-minifaq.html,v 1.3 2003/11/09 21:15:46 certik Exp $
	<br>
	$OpenBSD: upgrade-minifaq.html,v 1.2 2003/11/09 23:58:56 horacio Exp $<br>
	Copyright &copy; 1998-2003, Kjell Wooding.<br>
	Please send any comments, questions, or suggestions to <a
          href="mailto:kjell@openbsd.org">kjell@openbsd.org</a></p>
	Poznámky k èeskému pøekladu za¹lete na <a
	href="mailto: milos_at_openbsd.cz">milos_at_openbsd.cz</a></p>
    </address>
  </body>
</html>

