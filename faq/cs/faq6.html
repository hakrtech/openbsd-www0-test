<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>6.0 - Networking</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-1999 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>6.0 - Nastavení sítì</font><hr></h2>
</p>

<p>
<ul><h3>Obsah</h3>
<li><A href= "#6.0.1">6.0.1 - Pøedtím ne¾ pùjdeme dále</a>
<li><a href= "#6.1">6.1 - Úvodní nastavení sítì</a>
<li><a href= "#6.2">6.2 - IP filtr</a>
<li><a href= "#6.3">6.3 - Pøeklad sí»ových adres (NAT) </a>
<li><a href= "#6.4">6.4 - Dynamic Host Configuration Protocol (DHCP)</a>
<li><a href= "#6.5">6.5 - Point to Point Protokol</a>
<li><A href= "#6.6">6.6 - Zlep¹ování výkonu sítì</a>
<li><a href= "#6.7">6.7 - Pou¾ívání NFS</a>
<li><a href= "#6.8">6.8 - Domain Name Service  - DNS, BIND a named</a>
<li><a href= "#6.9">6.9 - Nastavení PPTP spojení v OpenBSD</a>
</ul>
</p>
<hr>

<br>
<P>
<A name="6.0.1"></a>
<H2>6.0.1 - Pøedtím ne¾ pùjdeme dále</h2>
<P>
Na úvod pøedpokládáme, ¾e ètenáø pøeèetl a alespoò èásteènì chápe sekci <A href="faq5.html">Konfigurace jádra</a> tìchto FAQ, stejnì jako manuálové stránky
pøíkazù <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html">
ifconfig(8)</a> a 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html">
netstat(1)</a> .
<P>
Pokud jste administrátor sítì a nastavujete smìrovací protokoly, pokud pou¾íváte OpenBSD box jako router, pokud chcete hloubìji poznat princip fungovaní sítì
s IP protokolem, pak byste si rozhodnì mìli pøeèíst <A HREF="http://www.3com.com/solutions/en_US/ncs/501302.html">V¹e co potøebujete vìdìt o IP adresování</a>.
Jedná se skuteènì o vynikající dokument, který obsahuje zcela nepostradatelné informace pro práci se sítìmi na bázi IP protokolu, obzvlá¹tì pokud pokud máte co doèinìní nebo zodpovídáte za více ne¾ jednu sí».
<P>
Pokud pracujete s aplikacemi jako jsou web servery, ftp servery a mail servery,
mù¾ete najít mnoho cenných informací <A HREF="http://the.rfceditor.org/rfc.html">ètením RFC dokumentù</a>.
Samozøejmì, ¾e je nemù¾ete pøeèíst v¹echny. 
Radìji si vyberte téma, o které se zajímáte, nebo které pou¾íváte v práci.
RFC definují mnoho (øádovì tisíce) standardù protokolù internetu a popisují,
jak tyto protokoly jsou navr¾eny a jak pracují.

<a name="6.1"></a>
<h2>6.1 - Úvodní nastavení sítì</h2>

<p>
<a name="6.1.1"></a>
<h3>6.1.1 - Identifikace a nastavení va¹ich sí»ových rozhraní</h3>
</p>

<p>
Nejprve je nutné identifikovat v systému vá¹ sí»ový hardware. V OpenBSD jsou
sí»ová rozhraní pojmenovaná podle sí»ové karty, ne podle typu spojení. 
To zda byla va¹e sí»ová karta inicializovaná, mù¾ete vidìt pøi startu systému,
nebo pozdìji pomocí pøíkazu <strong>dmesg(8)</strong>. Rovnì¾ mù¾ete svoje
sí»ová rozhraní identifikovat ve výpisu pøíkazu <strong>ifconfig(8)</strong>.
Napøíklad zde je výstup z pøíkazu dmesg pro sí»ovou kartu ne2000, které
odpovídá název zaøízení ne.
</p>

<ul><pre>
ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port 0x340/16 irq 9
ne3: address 00:e0:98:04:95:ba
</pre></ul>

<p>
Pokud nevíte, jaké jméno v systému odpovídá va¹í kartì, zde je seznam bì¾ných
typù karet a odpovídajících názvù zaøízení.
<ul>
<li> sí»ové karty ne2000 - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4&format=html">ne</a>
<li>3Com EtherLink III a Fast EtherLink III Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4&format=html">ep</a>
<li>3Com EtherLink XL a Fast EtherLink XL Ethernet (3C9xx) - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4&format=html">xl</a>
<li>Intel 82586 chip Ethernet device driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&format=html">ie</a>
<ul>Který zahrnuje karty jako:
  <li>3Com 3C507
  <li>AT&T StarLAN 10
  <li>AT&T EN100
  <li>AT&T StarLan Fiber
  <li>Intel EtherExpress 16
</ul>
<li>DEC/Intel 21142/3 a clone 10/100 Ethernet driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&sektion=4&format=html">dc</a>
<ul><FONT SIZE="-1"> <b>Pozn:</b> Nìkteré drivery, které byly v OpenBSD 2.6,
jako napø. mx, ax, al a pn byly nahrazeny tímto driverem.</font><BR>
Který zahrnuje rovnì¾ karty jako:
  <li>Intel 21142/21143 (døíve vyrábìnými firmou DEC)
  <li>Macronix 98713, 98713A, 98715, 98715A and 98725
  <li>Davicom DM9100 a DM9102
  <li>ASIX Electronics AX88140A a AX88141
  <li>ADMtek AL981 Comet a AN985 Centaur
  <li>Lite-On 82c168 a 82c169 PNIC
  <li>Lite-On/Macronix 82c115 PNIC II
<P>
Pokud upgradujete na OpenBSD 2.7 ze star¹í verze OpenBSD, musíte zde dávat
vìt¹í pozor.
Jakékoliv odkazy v souborech /etc/ifaliases, /etc/ipf.rules, /etc/ipnat.rules
na staré názvy zaøízení jako mx, al, ax nebo pn musí být nahrazeny za dc.
Stejnì tak v¹echny soubory s názvem hostname.xxx se starým názvem zaøízení musí
být pøejmenovány na hostname.dcX, aby byly akceptovány. 'X' nahraïte èíslem
va¹eho zaøízení.
</ul>
<li>Lucent Technologies WaveLAN/IEEE 802.11DS - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&sektion=4">wi</a>
<li>Aironet Communications 4500/4800 IEEE 802.11DS - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=an&sektion=4">an</a>
</ul>

<p>
Znovu pøipomeòme, ¾e chcete-li zjistit, která zaøízení byla identifikována,
mù¾ete pou¾ít pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>. Zde je jeho výstup zobrazující  
zaøízení ne2k.
</p>

<ul><pre>
$ <strong>ifconfig -a</strong>
lo0: flags=8009&lt;UP,LOOPBACK,MULTICAST&gt;
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt;
ne3: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt;
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt;
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt;
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt;
tun0: flags=10&lt;POINTOPOINT&gt;
tun1: flags=10&lt;POINTOPOINT&gt;
enc0: flags=0&lt;&gt;
bridge0: flags=0&lt;&gt;
bridge1: flags=0&lt;&gt;
</pre></ul>

<p>
Jak je vidìt, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>
dává více informací, ne¾ v této fázi potøebujeme. Umo¾òuje nám ale vidìt na¹e
zaøízení. V pøedcházejícím pøíkladì je ji¾ sí»ová karta nakonfigurována.
Poznáte to podle vypsaných hodnot &quot;inet 10.0.0.38 netmask
0xffffff00 broadcast 10.0.0.255&quot;, odpovídající nastavení parametrù a také
pomocí pøíznakù <strong>UP</strong> a <strong>RUNNING</strong> . Také jste
si urèitì v¹imli mnoha dal¹ích zaøízení. Zde je seznam zaøízení, které byste
zde mìli nalézt.
</p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4&format=html">lo</a> - Loopback Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4&format=html">sl</a> - SLIP Network Interface
<li>ppp - Point to Point Protocol
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4&format=html">tun</a> - Tunnel Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4&format=html">enc</a> - Encapsulating Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4&format=html">bridge</a> - Ethernet bridge interface
</ul>

<p>
Pokud va¹e zaøízení nemáte nakonfigurované, prvním krokem je vytvoøení souboru
<strong>/etc/hostname.${IF}</strong> .
Kde jméno zaøízení se nachází na místì ${IF}. V pøedcházejícím pøíkladì by
by jméno bylo <strong>/etc/hostname.ne3</strong>. Formát tohoto souboru
je následující:
Více informací o formátu tohoto souboru najdete v manuálové stránce <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html">hostname.if(5)</a>
.
</p>

<ul><pre>
[address_family] [va¹e_ip] [va¹e_sí»ová_maska] [media options]
</pre></ul>

<p>
Pro pøedcházející pøíklad by tento soubor vypadal následovnì:
</p>

<ul><pre>
$ <strong>cat /etc/hostname.ne3</strong>
inet 10.0.0.38 255.255.255.0 NONE
</pre></ul>

<p>
Dal¹í krok je nastavení defaultního routeru. Provedete to tak, ¾e jeho IP adresu
umístíte do souboru s názvem <strong>/etc/mygate</strong>. Tak umo¾òíte, aby
vá¹ defaultní router byl nastaven pøi startu. 
Poté byste mìli nastavit va¹e nameservery a soubor <strong>/etc/hosts</strong>.
Nastavení nameserverù spoèívá mmj. ve vytvoøení souboru s názvem <strong>/etc/resolv.conf</strong>. Více informací o formátu tohoto souboru naleznete v manuálové stránce <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">resolv.conf(5)</a>. Pro standardní pou¾ití zde je pøíklad
takového souboru. V tomto pøíkladu pøedpokládejme, ¾e adresy va¹ich nameserverù
jsou  125.2.3.4 a 125.2.3.5. Patøíte rovnì¾ do domény &quot;yourdomain.com&quot;.
</p>

<ul><pre>
$ <strong>cat /etc/resolv.conf</strong>
search yourdomain.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre></ul>

<p>
Nyní mù¾ete buïto restartovat poèítaè, nebo spustit skript <strong>/etc/netstart</strong>. Udìláte to jednodu¹¹e napsáním (jako u¾ivatel root) :
</p>

<ul><pre>
$ <strong>sh /etc/netstart</strong>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre></ul>

<p>
V¹imnìte si, ¾e do¹lo k nìkolika chybám, ale ty se týkají jen zaøízení loopback.
Tak¾e je mù¾eme ignorovat. Nyní by vá¹ sí»ový subsystém mìl být správnì nastaven a mìl by fungovat. Opìt se mù¾ete pøíkazem <strong>ifconfig(8)</strong> pøesvìdèit, ¾e je va¹e zaøízení nastaveno správnì. Smìrování paketù na sí»ových rozhraních, nastavení rout mù¾ete zkontrolovat pomocí pøíkazu <strong>netstat(1)</strong> nebo <strong>route(8)</strong>. Zde je pøíklad jak si prohlédnout va¹e routovací tabulky.
</p>

<ul><pre>
$ <strong>netstat -rn</strong>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  ne3
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  ne3
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  ne3
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)
$ <strong>route show</strong>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre></ul>

<p>
<a name="6.1.2"></a>
<h3>6.1.2 - Nastavení OpenBSD jako routeru</h3>
</p>

<p>
Následují základní informace, které potøebujete znát, abyste mohli nastavit
va¹e OpenBSD jako router . Pokud pou¾íváte OpenBSD jako
router v síti Internet, doporuèujeme vám, abyste si pøeèetli rovnì¾ nastavení
IP filtru, o kterém pojednává dal¹í èást, pomocí IP filtru mù¾ete blokovat
potenciálnì nebezpeèné sí»ové relace. Rovnì¾ z dùvodu nedostatkù IP adres na
Internetu pro IPv4 se mù¾ete podívat na Pøekládání sí»ových adres (Network address translation), kde najdete informace jak roz¹íøit vá¹ adresový prostor.
</p>

<p>
Jádro kompilované jako GENERIC má ji¾ v sobì podporu IP Forwardingu, která musí
být v tomto pøípadì zapnutá. Mù¾ete tak uèinit pomocí pøíkazu  <strong>sysctl(8)</strong>. Pro trvalou zmìnu byste mìli zeditovat soubor <strong>/etc/sysctl.conf</strong> . Udìláte to snadno pøidáním následující øádky do tohoto souboru.
</p>

<ul><pre>
net.inet.ip.forwarding=1
</pre></ul>

<p>
Chcete-li tuto zmìnu provést bez restartu stroje, mìli byste pou¾ít pøíkaz <strong>sysctl(8)</strong>. Pamatujte si v¹ak, ¾e tato zmìna nebude trvalá, vydr¾í
jen do rebootu a také ¾e tento pøíkaz musíte spustit jako u¾ivatel root.
</p>

<ul><pre>
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
net.inet.ip.forwarding: 0 -> 1
</pre></ul>

<p>
Nyní zmìòte routovací tabulky na jiných strojích. Je mnoho zpùsobù pou¾ití OpenBSD jako router, pomocí softwaru <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html">routed(8)</a>,
<A HREF="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a>, a <A href="http://www.zebra.org">zebra</a>.
OpenBSD podporuje porty v ports tree jak pro gated tak mrtd.
OpenBSD podporuje mnoho sí»ových zaøízení, jako T1, HSSI, ATM, FDDI, Ethernet
a sériové PPP/SLIP zaøízení.
</p>

<p>
<a name="6.1.3"></a>
<h3>6.1.3 - Nastavení aliasù zaøízení.</h3>
</p>

<strong>Poèínaje OpenBSD 2.8, <i>/etc/ifaliases</i> se u¾ dále nepou¾ívá!</strong>

<p>
OpenBSD má jednoduchý mechanismus, který umo¾òuje nastavit ip aliasy na zaøízení. V¹e spoèívá v jednoduché editaci souboru <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><i>/etc/hostname.&lt;if&gt;</i></a>. Tento soubor
je pøeèten pøi startu systému skriptem <i>/etc/rc</i>, který je souèástí <a href="faq10.html#10.3">rc startup hierarchy</a>. Napøíklad pøedpokládejme, ¾e u¾ivatel má zaøízení <b>dc0</b> a je na síti 192.168.0.0. Dal¹í podstatné informace
jsou:
</p>

<ul>
<li>IP adresa pro dc0 je 192.168.0.2
<li>sí»ová maska  255.255.255.0
</ul>

<p>
Nìkolik poznámek o aliasech. V OpenBSD pou¾íváte pouze název zaøízení. Není tady rozdíl mezi prvním aliasem nebo druhým aliasem. Narozdíl od nìkterých operaèních systémù, OpenBSD se na nì neodkazuje jako dc0:0, dc0:1. Pokud se odkazujete
na urèitou aliasovanou IP adresu pomocí ifconfig, nebo pøidáváte alias, ujistìte se, ¾e pí¹ete "<tt>ifconfig interface alias</tt>" namísto  "<tt>ifconfig interface</tt>". Smazat alias mù¾ete pomocí "<tt>ifconfig interface delete</tt>".
<P>
Pøedpokládejme, ¾e pou¾íváte více IP adres, které jsou na stejné podsíti, a pou¾íváte k tomu aliasy. va¹e sí»ová maska pro ka¾dý alias má automaticky hodnotu
255.255.255.255. Není nutné, aby sí»ové masky aliasù následovaly sí»ovou masku
prvního IP spojeného s tímto zaøízením. V následujícím pøíkladì <i>/etc/hostname.dc0</i> jsou pøidány dva aliasy pro zaøízení dc0, které mimo jiné bylo nastaveno
jako 192.168.0.2 netmask 255.255.255.0.
</p>

<ul><pre>
$ <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
dc0 192.168.0.3 255.255.255.255
dc0 192.168.0.4 255.255.255.255
</ul></pre>
<P>
Ve v¹ech tìchto pøíkladech je pou¾itá maska taková, aby se zabránilo vytvoøení
duplicitní routovací tabulky pro stejnou sí».


<p>
<b>Poznámka:</b><br>

Poèínaje OpenBSD 2.7, mù¾ete nastavit aliasy v souboru <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><i>/etc/hostname.*</i></a>. Pro provedení stejného nastavení jako v pøedcházejícím pøíkladì, byste vytvoøili následující soubor  <i>/etc/hostname.dc0</i> :
</p>


<ul><pre>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255 NONE
inet alias 192.168.0.4 255.255.255.255 NONE
</pre></ul>


<p>
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se zmìny nastavení promítly. Nebo mù¾ete nastavit aliasy ruènì pomocí <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>.
 Nastavení prvního aliasu by se provedlo takto:
</p>

<ul><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></ul>

<p>
Pro prohlí¾ení tìchto aliasù je vhodný pøíkaz:
</p>

<ul><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></ul>



<p>
<a name= "6.2"></a>
<h2>6.2 - IP Filter</h2>
</p>

<p>

Softwarový balík IP Filter od Darrena Reeda slou¾í pro zaji¹tìní následujících dvou úloh:
filtrovací pravidla pro filtrování na úrovni paketù 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html">ipf(8)</a> a mapování
poèítaèù, podsítí na okruh externích adres 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html">ipnat(8)</a>. Konfiguraèní soubory pro tyto dvì slu¾by jsou <i>/etc/ipf.rules</i> a <i>/etc/ipnat.rules</i>.
</p>

<p>
Je nutné zeditovat <i>/etc/rc.conf</i> pro jejich aktivaci pøi startu; øádky nastavte na:
</p>
<ul><pre>
ipfilter=YES
ipnat=YES
</pre></ul>

<p><p>
<b>Poznámka:</b> Pokud nebudete pou¾ívat ipnat a ipfilter zároveò, nemusíte nastavovat obì volby. 
Pokud ov¹em pou¾íváte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>,
musí být aktivován také ipfilter.
</p>

<p>
Pokud pou¾íváte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>,
nejspí¹e bude muset nastavit hodnotu sysctl &quot;net.inet.ip.forwarding&quot; na 1. To mù¾ete
udìlat odkomentováním pøíslu¹ného øádku v <i>/etc/sysctl.conf</i>.
</p>

<P>
Pokud máte IP filtr zakompilovaný v jádøe, ale nemáte ho aktivován v <i>/etc/rc.conf</i>, mù¾ete ho stále je¹tì jednodu¹¹e aktivovat.

<ul><pre>
# <strong>ipf -Fa -f /etc/ipf.rules -E</strong>
# <strong>ipnat -CF -f /etc/ipnat.rules</strong>
</pre></ul>

<P>
Volba <tt>-E</tt> u ipf 'umo¾òuje' IP filtr.  <Tt>-Fa</tt> ma¾e v¹echna pravidla pro filtrování, která mohla být ji¾ nastavena. <tt>-f /etc/ipf.rules</tt> nahraje nová pravidla ze souboru 
<i>/etc/ipf.rules</i>.
<p>
Pokud udìláte zmìny v <i>/etc/ipf.rules</i> poté co ipf je nahrán, mù¾ete pravidla
jednodu¹¹e nahrát znova.

<ul><pre>
# <strong>ipf -Fa -f /etc/ipf.rules</strong>
</pre></ul>
Stejné pro ipnat...

<ul><pre>
# <strong>ipnat -CF -f /etc/ipnat.rules</strong>
</pre></ul>
Také budete chtít spustit ipmon pro ladìní.
<ul><pre>
# <strong>ipmon -Ds</strong>
</pre></ul>
<p>
Tento dokument obsahuje jen nìkolik základních 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&sektion=8">ipf(8)</a> a 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a> konfigurací.
Spousta pìkných pøíkladù je v <i>/usr/share/ipf/</i> . Doporuèujeme, abyste si
vybrali tu, která je vám nejbli¾¹í a modifikovali ji pro va¹e potøeby.
Informace o IP filtru naleznete na IP Filter <A HREF="http://false.net/ipfilter/">mailing list archívu</a>,
<A HREF="http://coombs.anu.edu.au/~avalon/">IP Filter web site</a>, a koneènì <A
HREF="http://www.obfuscation.org/ipf/">IP Filter HOWTO</a>.
</p>

<p>
<h3>IPF</h3>
</p>

<p>
Pro konfiguraci IP filtru pøi startu, budete muset modifikovat /etc/rc.conf ,aby zde bylo IPFILTER=YES. 
IP Filtr  (ipf) je kontrolován sadou pravidel ze souboru /etc/ipf.rules, která
jsou naètena pøi startu. Pro detailnìj¹í popis si pøeètìte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html">ipf(5)</a>. V pøikladech, které následují, fxp0 reprezentuje externí rozhraní k internetu. Ve va¹em  pøípadì bude patrnì jiné, na základì ethernetového adaptéru ve va¹em poèítaèi.  Pravidla pøedpokládají trvalé spojení s Internetem, jaké byste
zaøídili patrnì pro webserver.
</p>

<p>
Pravidla IP filtru jsou zpracovávána postupnì od shora dolù. Ka¾dý paket musí
pøejít pøes tyto pravidla, pøedtím ne¾ dosáhne svého urèení.
</p>

<p>
Napøíklad implicitní soubor pravidel umo¾òuje ka¾dému paketu cestovat dovnitø a ven:

<ul><pre>
pass out from any to any
pass in from any to any
</pre></ul>

Nyní pøedpokládejme, ¾e nechceme dovolit jakoukoliv pøichozí konekci na port
3306 (mysql) proto¾e k databázi by mìl být pøístup pouze z localhostu.
Soubor pravidel by vypadal takto:

<ul><pre>
pass out from any to any
pass in from any to any
block in on fxp0 from any to any port = 3306
</pre></ul>

Toto øíká  &quot;blokuj v¹echny pøíchozí pakety, pøicházející na interfejs fxp0 odkudkoliv, smìøující kamkoliv, jejich¾ destinace je port 3306.&quot;
Pøirozenì, paket urèený pro port 3306 na zaøízení fxp0 projde pøes první
&quot;pass in&quot; pravidlo a potom bude odhozen díky pravidlu &quot;block in port = 3306&quot; . Pokud zmìníte poøadí va¹ich pravidel (pamatujte si, poøadí
je dùle¾ité):

<ul><pre>
pass out from any to any
block in on fxp0 from any to any port = 3306
pass in from any to any
</pre></ul>

Pakety urèené pro port 3306 projdou, proto¾e poslední pravidlo souboru dovoluje
v¹em pøíchozím paketùm projít. Je dùle¾ité pamatovat si pøi psaní pravidel
pro IP filtr, ¾e:
 <b> Poslední odpovídající pravidlo vítìzí</b>.
</p>

<p>
Samozøejmì, jsou zde vyjímky pro ka¾dé pravidlo. Volba <em>quick</em> ukonèí 
zpracování paketu na prvním pravidlu, které odpovídá. Podívejme se na pøedcházející pøíklad.
Pokud pøidáme  <em>quick</em>  k pravidlu &quot;block in&quot; :

<ul><pre>
pass out from any to any
block in quick on fxp0 from any to any port = 3306
pass in from any to any
</pre></ul>

ck</em> <p>
Paket urèený pro ná¹ poèítaè na port 3306 bude zpracován bezprostøednì pravidlem
&quot;block in quick&quot; a bude odhozen. V¹echny pakety urèené pro jiné porty
nenajdou odpovídající pravidlo, dokud nedosáhnou pravidla &quot;pass in&quot;, které jim dovolí projít.
</p>

<b>Default Deny</b>
<p> Nejbezpeènìj¹í politika filtrování paketù je tzv. politika default deny.
V¹echny pakety, které nejsou pøímo dovoleny, jsou odhozeny. Tato politika je
mnohem bezpeènìj¹í ne¾ pøímo nepovolovat ka¾dou chránìnou slu¾bu, také umo¾òuje
mít relativnì malý soubor pravidel a mù¾e ochránit od ¹patnì nakonfigurované
slu¾by, která je ponechána svému osudu.
<p>
Nyní se podívejte na jiný pøíklad skuteèného ¾ijícího pøíkladu pravidel a vysvìtleme si øádku po øádce jejich význam. Je zde pøíklad webserveru s default deny
politikou, která povoluje pouze ssh spojení (pro administraci) a spojení
http (port 80) a https (port 443).
<ul><pre>
pass in quick on fxp0 from any to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any 
</pre></ul>

<p>
Tyto pravidla dovolí pøíchozím spojením odkudkoliv na porty 22(ssh), 80(http)
a 443(https) projít. Odhodí v¹echny ostatní pakety a umo¾ní v¹echna odchozí
spojení.
Co ale kdy¾ chcete dovolit ssh spojení pouze z interních strojù , ale dovolit
spojení zvenku na http a https?
</p>

<ul><pre>
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
</pre></ul>

Docela dobré, ale co kdy¾ chceme dovolit pouze jednomu stroji (1.1.1.1) administrovat webserver vzdálenì?
V tomto pøípadì  mù¾eme zmìnit :

<ul><pre>
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
</pre></ul>
na:
<ul><pre>
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
</pre></ul>
IP filtr podporuje jak teèkovou desítkovou tak CIDR notaci sí»ové masky. Pøedcházející byste mohli napsat také jako:
<ul><pre>
pass in quick on fxp0 from 1.1.1.1/255.255.255.255 to any port = 22
</pre></ul>
ale proè byste to dìlali?
</p>
<b> Pøíklad souboru pravidel</b>
<p>
Zde je nìkolik pravidel pro ka¾dého (pøedpokládejme, ¾e fxp0 je externí zaøízení
pøipojené na internet). Nejprve nastolíme jednoduchou address spoofing ochranu.
<ul><pre>
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8
</pre></ul>
Dobrá my¹lenka je rovnì¾ oddìlit pravidla pro va¹e loopback rozhraní od ostatních. 
 
<ul><pre>
pass out quick on lo0
pass in quick on lo0
</pre></ul>
Ná¹ soubor pravidel zdá se zatím vypadá dobøe, kdy¾ to dáme v¹echno dohromady,
vypadá to takto:
<ul><pre>
# loopback rules

pass out quick on lo0
pass in quick on lo0

# don't allow anyone to spoof non-routeable addresses

block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

# only allow our administration machine to connect via ssh

pass in quick on fxp0 from 1.1.1.1/32 to any port = 22

# allow others to use http and https

pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443

# finally lock the rest down with a default deny

block in quick on fxp0 from any to any

# and let out-going traffic out

pass out on fxp0 from any to any
</pre></ul>
</p>

<b>Logování paketù</b>
<p>
Nyní je na¹e situace dost dobrá, ale mohla by být je¹tì lep¹í. Co kdy¾ chceme
logovat ka¾dý pokus o spojení na port 22(ssh), který byl firewallem zablokován?
Jednodu¹¹e, IP filtr to umo¾òuje pomocí slova <em>log</em> :
<ul><pre>
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 from any to any port = 22
</pre></ul>
Toto pravidlo dovolí na¹emu vzdálenému administraènímu poèítaèi spojení na port
22, ale blokuje a loguje v¹echny ostatní pokusy o spojení na port 22.
</p>
<b> Filtrování na základì protokolù</b>
<p>
IP filtr umí filtrovat jakýkoliv IP protokol podle jeho èísla nebo názvu
v souboru <a href=file://localhost/etc/protocols>/etc/protocols</a>. My
se zamìøíme jen na protokoly tcp, udp a icmp. Tyto jsou nejèastìji u¾ívány. 
V¹echny zásadní internetové aplikace závisí na implementaci a správném fungování tìchto protokolù.</p>
<p>
Pro filtrování podle protokolù se u¾ívá v konfiguraci ipf klíèové slovo <em>proto</em>. Podíváme-li se na ná¹ pøedchozí pøíklad pravidla pro ssh, proto¾e ssh
pou¾ívá pro svoji komunikaci tcp, mìli bychom dovolit spojení pouze tcp paketùm. Pou¾itím slova <em>proto</em> umo¾níme uspìt pouze tcp paketùm a dostáváme pravidlo podobné tomuto:
<ul><pre>
pass in quick on fxp0 proto tcp from 1.1.1.1/32 to any port = 22
</pre></ul>
Co ale v pøípadì, kdy potøebujeme umo¾nit spojení slu¾bì pou¾ívající jak tcp
tak i udp, jako je napøíklad bind? V pøípadì tcp/udp IP filtr dovoluje spojit
oba protokoly dohromady. Poznámka: toto je mo¾né pouze v pøípadì tcp/udp. Pou¾ití v pøípadì slu¾by dns v prostøedí s defaultní politikou deny je následující:
<ul><pre>
pass in quick on fxp0 proto tcp/udp from any to any port = 53
</pre></ul>
</p>
<b> Filtrování fragmentù</b>
<p>
Kromì filtrování zalo¾eného na protokolech je IP filtr schopen filtrovat
rovnì¾ fragmentované IP pakety (bì¾ná metoda obcházení paket filtrù). Jsou
zde dvì klíèová slova, která se pou¾ívají pro práci s fragmentovanými ip pakety,  <em>frag</em> pro bì¾nì fragmentované pakety nebo <em>short</em> pro IP pakety, jejich¾ hlavièky jsou pøíli¹ malé pro porovnávání. Proto¾e fragmentované
pakety se mohou vyskytnout v dùsledku bì¾ného provozu, je nejlep¹í filtrovat
pouze pakety, jejich¾ hlavièky jsou pøíli¹ malé pro smysluplné porovnávání. 
Toho dosáhneme pou¾itím následujícího pravidla:
<ul><pre>
block in quick proto tcp all with short
</pre></ul>
A co IP paket s nastavenými IP volbami ?
IP filtr pracuje i s tìmito fenomény. Pakety mohou být odfiltrovány, pokud
mají nastaveny volby jako takové, nebo pokud mají nastaveny urèité volby.
Napøíklad následující pravidlo zaká¾e a loguje v¹echny pakety s nastavenými
volbami.
<ul><pre>
block in log quick on fxp0 all with ipopts
</pre></ul>
Toto pravidlo mù¾e ale znemo¾nit funkci nìkterých programù, jako napøíklad
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=traceroute&sektion=8&format=html">traceroute(8)</a>. Mù¾ete rovnì¾ specifikovat, které volby IP paketu
nepovolujete. Napøíklad takto:
<ul><pre>
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr
</pre></ul>
<b>TCP pøíznaky, vytvoøená spojení a keeping state</b>
<p>
Nyní zaèíná být filtrování progresivní. Nejvìt¹í silou IP filtru je toti¾
schopnost filtrovat pakety na základì nastavených pøíznakù TCP protokolu,
udr¾ovat vytvoøená spojení a jejich stav. Doporuèujeme, aby v¹ichni u¾ivatelé,
kteøí chtìjí filtrovat podle TCP pøíznakù  vìdìli, jakou roli ka¾dý
pøíznak má. Napøíklad , pokud chcete zakázat v¹echny pakety s nastavenými
flagy FIN, URG a PSH (jako napøíklad v pøípadì pokusu o OS fingerprinting pomocí nmap-u ) mù¾ete pou¾ít pravidlo jako je toto:
<ul><pre>
block in quick on fxp0 proto tcp from any to any flags FUP
</pre></ul>
( Díky  <a href=mailto:halogen@nol.net>Kyle Hargraves</a> za tento tip)
</p>
<p>
Dal¹í výborná vlastnost IP filtru je schopnost udr¾ovat stav. Tato vlastnost
spoèívá v tom, ¾e jakmile je jednou vytvoøeno spojení, pakety týkající se
tohoto spojení u¾ dále nepodstupují filtrování. Toto je velmi silná vlastnost
, která umo¾òuje psát pravidla filtru jednodu¹¹eji a bezpeènìji.</p>
<p>
Napøíklad, podívejme se, jak mu¾eme uplatnit tuto vlastnost pøi psaní na¹í ukázkové sestavy pravidel. Pro pøipomenutí, dovolujeme administraèní pøístup z
na¹í adresy tøídy C na port 22(ssh) a dovolujeme v¹echna pøíchozí spojení 
na port 80 (http) a 443 (https). Blokujeme v¹echna ostatní spojení. Co ale
dìlat v pøípadì, ¾e se chceme spojit pomocí ssh z web serveru, nebo chceme
pou¾ít lynx abychom se podívali na nìco ve FAQ? To udìlat nemù¾eme, proto¾e
jsme zablokovali v¹echna pøíchozí spojení, které smìøují na jiné ne¾ námi
povolené porty. Aèkoliv nastavení ip filtru je tak bezpeèné jak to jen jde,
mù¾e být ponìkud nevyhovující. Pøídáním slova <em>keep state</em> do pravidla
 &quot;pass out&quot; mù¾eme automaticky dovolit spojení, která pøicházejí
jako odezva na na¹e pokusy o spojení, jako je napø. surfování na webu.
<ul><pre>
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 proto tcp from any to any keep state
</pre></ul>
</p>
<p>
Tato malá zmìna dramaticky zvy¹uje flexibilitu a bezpeènost na¹í sady pravidel
. Napøíklad, v pøecházejícím pøíkladì umo¾òujeme tcp spojení na port 80 a 443.
Mù¾eme to ale je¹tì zlep¹it. K tomu, aby se vytvoøilo tcp spojení, potøebujeme
aby probìhl jen poèáteèní handshake, jakmile k nìmu dojde, mù¾eme blokovat
spojení na tento port a pomocí na¹eho &quot;keep state&quot; pravidlo bude
udr¾ovat vytvoøené spojení. Abychom dovolili poèáteèní handshake, potøebujeme
dovolit pakety pouze s nastavenými flagy SIN a SIN/ACK. Propu¹tìním paketù pouze s pøíznaky SIN a SIN/ACK se ubráníme mnoha formám port skenù jako je napøíklad
FIN skenování. Pravidla nyní vypadají takto:
<ul><pre>
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA
block in quick on fxp0 from any to any
pass out on fxp0 proto tcp from any to any keep state
</pre></ul>
</p>
<p>
Nyní dejme dohromady v¹echny pravidla, která jsme mìli dosud v na¹í sadì.
Tato sada bude mít default deny politiku, umo¾òující pouze administrativní
spojením z interní sítì (pøes ssh) a umo¾òující pøíchozí spojení na porty
80 (http) a 443 (https). Ochrání nás rovnì¾ pøed spoofovanými neroutovatelnými
ip adresami a zaká¾e v¹echny pakety, které jsou pøíli¹ fragmentované nato, aby
se daly vy¹etøit. Docela dobré nastavení pro veøejný webserver. Zde je
ukázka souboru /etc/ipf.rules :
<ul><pre>
# loopback rules
pass out quick on lo0
pass in quick on lo0

# drop itsy bitsy frags
block in quick proto tcp all with short

# drop source routed packets
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr

# don't allow anyone to spoof non-routeable addresses
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

# only allow our machines to connect via ssh
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22

# allow others to use http and https
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA

# finally lock the rest down with a default deny
block in quick on fxp0 from any to any

# and let out-going traffic out and maintain state on established connections
#  -- The flags S on the keep state is to ensure that state tracking starts
#    only on the first outbound packet in a tcp session.
#    unnecessary consumption of state table entries.
# -- The flag s only works on the tcp protocol, so three entries are required to
#    to cover all three protocols (tcp, udp, icmp).

pass in        quick on fxp0 proto tcp  from any to any flags S keep state
pass in        quick on fxp0 proto udp  from any to any         keep state
pass in        quick on fxp0 proto icmp from any to any         keep state
</pre></ul>
</p>
<p>
Pokud se vyskytnou nìjaké problémy, mù¾ete chtít zprovoznit logování u jednotlivých pravidel, abyste vìdìli co se dìje, napø.:
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22<br>
Pokud zmìníte svùj konfiguraèní soubor, aby pravidla logovaly pakety, nezapmeòte dát ipf -Fa -f /etc/ipf.rules aby se zmìny promítly!
<br>ipmon bude psat ip log hlá¹ky do /var/log/ipflog .<br>
Pro dal¹í informace o ipf je k dispozici excelentní <a href=http://www.obfuscation.org/ipf/ipf-howto.txt>IPF how-to</a>, stejnì jako <a href=http://coombs.anu.edu.au/~avalon/ip-filter.html>IP Filter</a> homepage.
</p>

<p>
<a name="6.3"></a>
<h2>6.3 - IPNAT</h2>
</p>

<p>
Initial work done by Wayne Fergerstrom &lt;wayne@methadonia.net&gt;
</p>

<a name="nat1.0"></a>
<h3><u>6.3.1 NAT Úvod</u></h3>

<a name="nat1.1"></a>
<b>Sekce Úvod</b>
<p>
Tato sekce se pokou¹í pomoci tìm, kteøí instalují a konfigurují Network Address Translation ("NAT") na systému OpenBSD.

Pøedpokládá se, ¾e u¾ivatel u¾ nastavil a nakonfiguroval OpenBSD se dvìma
sí»ovými kartami (jedna pøipojena k Internetu a druhá k lokální síti).
Pøeklad IP adres bude fungovat i na strojích s jedním sí»ovým rozhraním, pøesto
je nutné poznamenat, ¾e pakety budou procházet pøes toto jediné rozhraní dovnitø a ven a ¾e ethernetové kolize sní¾í významnì výkon.
</p>

<p>
Na základì <a HREF="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>, ipnat dává jednoduchý zpùsob jak namapovat interní sí» na jedinou routovatelnou
("reálnou") internetovou adresu. Toto je velmi u¾iteèné, pokud je¹tì napøíklad
nemáte oficiálnì pøiøazené adresy pro ka¾dý stroj na va¹í interní síti. Pøi
nastavování soukromé/interní sítì, mù¾ete s výhodou pou¾ít rezervovaných adresových blokù (pøiøazených v <A HREF="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), jako jsou:
<P>

10.0.0.0/8 (10.0.0.0 - 10.255.255.255)<br>
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)<br>
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)<br>

</p>

<a name="nat1.2"></a>
<b>Terminologie</b>

<p>
Pro informaci uvádíme nìkolik zkratek a formát jaký bude v dokumentu pou¾it.
<ul>
<strong>"NAT"</strong>
<p>
Tato zkratka popisuje funkci "Network Address Translation"  tj. pøekladu
sí»ových adres. Proces pøekladu je popsán pozdìji.
</p>
</ul>

<ul>
<strong>"ipnat"</strong>

<p>
Zkratka za "IP Network Address Translation." V podstatì mù¾e být pou¾ita
podobnì jako NAT. Pøesto v tomto dokumentu bude oznaèovat termín "ipnat" pouze
pro pou¾ití na pøíkazové øádce.
</p>
</ul>

<ul>
<strong>"IPF"</strong>

<p>
Zkratka za IP filtr. IP filtr je portovatelný software pro filtrování paketù,
který je dodáván jako souèást OpenBSD. IP filtr musí být zapnut, pøedtím ne¾
spustíte ipnat. Je to snadné, docílíte toho editací souboru /etc/rc.conf a
zmìníte ipf=NO na ipf=YES. Tato zmìna zmìní stav vìcí pro dal¹í bootování.
Pokud jste u¾ systém nastartovali mù¾ete ip filtr zapnout pomocí pøíkazu 'ipf -E' . Samozøejmì toto je popsáno dále.
</p>
</ul>

<br>
<a name="nat1.3"></a>
<b>Nastavení</b>

<p>
Následují informace o nastavení poèítaèù, které figurují v tomto dokumentu.
</p>

<ul>
<b>Operaèní systém: </b>OpenBSD v2.7 i386<br>
<br>
<b>Sí»ové karty: </b>
<ul>
  NetGear 10/100MB <b>dc0</b><br>
  Connected to the EXTERNAL LAN (or WAN)<br>
  <b>IP Address: </b>24.5.0.5<br>
  <b>Netmask: </b>255.255.255.0<br>
  <br>
  NetGear 10/100MB <b>dc1</b><br>
  Connected to the INTERNAL LAN<br>
  <b>IP Address: </b>192.168.1.1<br>
  <b>Netmask: </b>255.255.255.0<br>
</ul>
<br>
<b>Externí, internetová routa (dodal ji ISP, v tomto pøípadì se jedná o linku
modemovou)<br></b>
<ul>
  <b>IP Address: </b>24.5.0.5<br>
  <b>Netmask: </b>255.255.255.0<br>
  <b>Gateway: </b>24.5.0.1<br>
</ul>
<br>
<b>Lokální sí»</b><br>
<ul>
Poèítaèe na LAN pou¾ívají adresové schéma 192.168.1.xxx (kde xxx je jedineèné
èíslo). Na LAN je mnoho rùzných OS, vèetnì Windows 98, Windows NT, OpenBSD a
Linux. Ka¾dý stroj je pøipojen k hubu, který je vybaven pro interní pou¾ití.
V tomto dokumentu a v jeho pøíkladech  klient na LAN bude pou¾ívat IP adresu
192.168.1.40
</ul>
<br>
<b>Diagram nastavení</b>
<ul><pre>
+-----+              +---------+         +----------+
| Hub |--------- dc1 |   NAT   | dc0 ----| Internet |
+-----+              +---------+         +----------+
  | |
  | +-- Klient A
  +---- Ostatní stroje  

                              +-------------------------+
                              |        LEGENDA          |
                              +-------------------------+
                              |  NIC dc0 - 24.5.0.5     |
                              |  NIC dc1 - 192.168.1.1  |
                              | Klient A - 192.168.1.40 |
                              +-------------------------+

</pre></ul>
</ul>
<br>
<a name="nat2.0"></a>
<h3><u>6.3.2 Pøeklad sí»ových adres</u></h3>
<br>

<a name="nat2.1"></a>
<b>Seznámení s NATem</b>

<p>
Jak pøibývají dal¹í a dal¹í firmy, které chtìjí mít spojení na Internet, ka¾dá
musí mít vlastní IP adresu. Veøejných IP adres je èímdál ménì. Øe¹ením pro mnoho lidí je Network Address Translation (NAT), neboli pøeklad sí»ových adres . NAT je jednoduchý zpùsob, jak pøipojit va¹i LAN na Internet, ani¾ byste si
museli zakoupit nebo pronajmout IP adresu pro ka¾dý stroj. 
</p>

<p>
Zpùsob, jakým NAT pracuje je pøekvapivì jednoduchý. Kdy¾ se klient na LAN chce
spojit se strojem v Internetu, po¹le ven TCP paket se ¾ádostí o spojení. Uvnitø
TCP hlavièky paketu je klientova IP adresa (napø. 192.168.1.40) a po¾adovaná
IP adresa cílového poèítaèe (napø. 123.45.67.89). Stroj, na kterém bì¾í NAT
obdr¾ít tento TCP paket a zmìní klientovu IP adresu v hlavièce z 192.168.1.40
na IP adresu pøipojenou na Internet (napø.  24.5.0.5). Tímto zpùsobem
efektivnì docílíme toho, ¾e cílový poèítaè se domnívá, ¾e vlastní spojení pøichází ze stroje, na kterém bì¾í NAT. Cílový poèítaè (host) posílá dále pakety
týkající se daného spojení na adresu stroje s NATem. Kdy¾ stroj s NATem obdr¾í
paket od host-a, pøelo¾í rychle cílovou IP adresu na adresu klienta a po¹le paket klientovi. Klient nemá ani tu¹ení o tom, co se stalo a Internetové spojení
je zcela transparentní.
</p>

<p>
Následující pøíklad ozøejmí dosud nepochopené:
</p>

<ul><pre>
Klient ----------------- dc1 [ NAT ] dc0 ---------- Internet Host
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

Odcházející TCP paket                     Odcházející TCP paket
From: 192.168.1.40    >>=== NAT ===>>     From: 24.5.0.5
To: 123.45.67.89                          To: 123.45.67.89

Pøicházející TCP paket                    Pøicházející TCP paket
From: 123.45.67.89                        From: 123.45.67.89
To:   192.168.1.40    <<=== NAT ===<<     To: 24.5.0.5
</pre></ul>

<br>
<a name="nat2.2"></a>
<b>Proè pou¾ívat NAT?</b>

<p>
Kdy¾ jsem se nastìhoval do nového bytu, byl jsem postaven pøed men¹í problém.
Jak dát pøipojení k Internetu mým spolubydlícím, kdy¾ modemový kabel je
pouze v mé místnosti? Bylo tu nìkolik mo¾ností, které jsem mohl implementovat,
poèínají tím, ¾e ka¾dý z nás obdr¾í vlastní IP adresu, pøes nastavení proxy
serveru a¾ po nastavení NATu. (Nenechejte se mýlit pøíkladem s modemovým kabelem. NAT je dostateènì silný aby zamaskoval velikou LAN se stovkami ba i tisíci
poèítaèù!)
</p>

<p>
Je tu mnoho dùvodù, proè jsem chtìl nastavit NAT. Dùvodem èíslo jedna bylo u¹etøit peníze. V mém domì jsou tøi spolubydlící (ka¾dý s vlastním PC) a já sám
se tøemi poèítaèi. Mùj ISP dovolí pouze tøi IP adresy v ka¾dé domácnosti.
To znamená, ¾e zde není dostatek IP adres , aby ka¾dému poèítaèi mohl být
dovolen internetový pøístup.
</p>

<p>
Za pou¾ití NATu bude mít ka¾dý stroj unikátní (interní) IP adresu, ale budou
sdílet jednu IP adresu pro pøístup na Internet. Náklady jdou dolù.
</p>

<br>
<a name="nat2.3"></a>
<b>Setup</b>

<p>
Nejprve budete muset na va¹em OpenBSD systému zapnout IPF a NAT. Toho jednodu¹¹e docílíte editací souborù uvedených dále (zmìny udìlejte tak, aby odpovídající
øádky vypadaly jako ty následující):
</p>

<p>
<b>/etc/rc.conf</b> (Z tohoto souboru se startují programy pøi bootování)
</p>

<ul>
  ipfilter=YES<br>
  ipnat=YES
</ul>

<p>
<b>/etc/sysctl.conf</b>
</p>

<ul>
  net.inet.ip.forwarding=1
</ul>

<p>
Po tìchto zmìnách je stroj pøipraven pro konfiguraci NATu.
</p>

<br>
<a name="nat2.4"></a>
<b>Konfigurace</b>

<p>
Prvním krokem je nastavit soubor s pravidly pro IPF (<i>/etc/ipf.rules</i>).
Pro úèely tohoto dokumentu dovolíme spojení pøes tento firewall bez omezení.
Soubor by mìl vypadat asi takto:
</p>

<ul><pre>
pass in from any to any
pass out from any to any
</pre></ul>

<p>
Pro více informací si pøeètìte <a href="#6.2">FAQ 6.2</a>
</p>

<p>
Soubor s nastavením NATu (<i>/etc/ipnat.rules</i>) má velmi jednoduchý syntax.
Pro pøípad nastaveného firewallu (viz. vý¹e) bude vypadat takto:
</p>

<ul><pre>
map dc0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -> 24.5.0.5/32
</pre></ul>

<p>
Zde je vysvìtlení pøedcházejících øádek.
</p>

<ul>
<strong>"map"</strong>
<p>
Tímto pøíkazem øíkate NATu,  ¾e podle následujících dat se bude mìnit adresa
mezi LAN a Internetem.
</p>
</ul>

<ul>
<strong>"dc0"</strong>
<p>
Název sí»ového rozhraní pøipojeného na Internet.
</p>
</ul>

<ul>
<b>"192.168.1.0/24"</b>
<p>
IP adresa a sí»ová maska (maska je v CIDR formátu). Dohromady to znamená
"jakákoliv IP adresa o hodnotì od 192.168.1.1 do 192.168.1.254" má být
mapována. Pokud nechcete pou¾ít CIDR (classless inter-domain routing) notaci,
mù¾ete  "/24" nahradit "/255.255.255.0".
</p>
</ul>

<ul>
<b>"24.5.0.5/32"</b>
<p>
Tato IP adresa a sí»ová maska zastupují IP adresu, na kterou budou namapovány
adresy z LAN. /32 znamená, ¾e se jedná o jednu IP adresu. Mù¾ete také mapovat
na /24 nebo  256 IP adres (nebo /27  nebo jakýkoliv poèet bitù, který chcete)!!  Toto je u¾iteèné, pokud máte nìkolik tisíc klientù umístìných za NATem ....
(Samozøejmì, je to u¾iteèné jenom pokud tìch /24 je smìrováno na vá¹ stroj s OpenBSD!)
</p>
</ul>

<ul>
<b>"portmap tcp/udp 10000:60000"</b>
<p>
Toto mapuje v¹echny tcp/udp pakety na porty v rozsahu od 10000 do 60000.
</p>
</ul>

<p>
Druhý øádek je témìø stejný s výjimkou poslední èásti.
Ta øíká ipnat-u aby mapoval v¹echno ostatní (ne tcp/udp, tyto pakety byly
u¾ obslou¾eny prvním øádkem) na jakýkoliv port, který je po¾adován (pou¾ívá
se pro ICMP a jiné protokoly). Jakmile máte tohle v¹echno v souboru, jediné
co potøebujete je spustit IPF démona.
</p>

<br>

<a name="nat2.5"></a>
<b>Selektivní NAT</b>

<p>
Mohli byste chtít zabránit NAT pro nìkterý rozsah venkovních adres.
Pokraèujme v pøedchozím pøíkladu a pøedpokládejme, ¾e chcete, aby se pro poèítaèe v síti 24.5.0.0/28
Va¹e NAT gateway chovala jako obyèejný router bez pøekladu adres.
Potlaèit pøeklad adres pro odchozí spojení z dc0 do této podsítì mù¾ete takto:
</p>

<ul><pre>
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28 -> 24.5.0.5/32
</pre></ul>

<a name="nat2.5"></a>
<b>Running</b>

<p>
Spu¹tìní NATu je také velmi jednoduché. Jakmile je jednou konfigurace kompletní, jsou zde dva zpùsoby jak spustit NAT. První je rebootovat OpenBSD stroj.
Je to v¹ak metoda pomìrnì nedeterministická a pro toho kdo si nainstaloval OpenBSD jenom poukazuje na neznalost problematiky.
</p>

<p>
Spu¹tìní ipnat-u z pøikazové øádky docílíte pøíkazy:
</p>

<ul><pre>
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
</pre></ul>

<p>
První øádek spou¹tí IPF (pamatujte si, ¾e NAT závisí na IPF, proto IPF musí
být spu¹tìn pøed inicializací NATu ). Volby na pøíkazové øádce: "-Fa" vyèistí
filtrovací sadu od ji¾ existujících pravidel, "-f /etc/ipf.rules" øíká ipf,
kde najde filtrovací pravidla, "-E" je pøepínaè spou¹tìjící IPF démona.
</p>

<p>
Druhý øádek spou¹tí NATa. "-CF" sma¾e a instaluje nová pravidla v NAT tabulce.
"-f /etc/ipnat.rules" øíká, kde NAT najde soubor s pravidly. NAT nyní bì¾í.
</p>


<p>
<b>Poznámka:</b> budete-li potøebovat updatovat nastavení NATu (v pøípadì, ¾e
editujete soubor, ale nechcete rebootovat) staèí pøedchozí pøíkaz spustit znovu. Nastavení bude obnoveno s provedenými zmìnami.
</p>

<br>
<a name="nat3.0"></a>
<h3><u>6.3.3 Testování NATu</u></h3>

<br>
<a name="nat3.1"></a>
<b>Kontrola stavu NATu</b>

<p>
Chcete-li zjistit, jak NAT právì pracuje,nebo se ujistit o tom, zda nastavení
jsou funkèní, pou¾ijte volbu "-l". Tato volba vypí¹e seznam v¹ech nastavení
a souèasných spojení, které zpracovává ipnat:
</p>

<ul><pre>
# <b>ipnat -l</b>
map dc0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -> 24.5.0.5/32

List of active sessions:
MAP 192.168.1.40  2473  <- -> 24.5.0.5  13463 [129.128.5.191 80]
</pre></ul>

<p>
První dva øádky informují o souèasném nastavení NATu, které jste zapsali
do /etc/ipnat.rules ji¾ døíve. Øádek pod nimi ukazuje seznam souèasných spojení,
které NAT kontroluje. 
</p>

<ul>
<b>"MAP 192.168.1.40  2473"</b>
<p>
Toto vám øíká IP adresu stroje na LAN, který pou¾ívá NAT. Port pou¾itý pro toto
spojení je zobrazen za ní.
</p>
</ul>

<ul>
<b>"&lt;- -&gt;"</b>
<p>
Toto ukazuje, ¾e NAT zpracovává spojení v obou smìrech.
</p>
</ul>

<ul>
<b>"24.5.0.5  13463"</b>
<p>
Toto øíká, ¾e spojení jde do internetu pøes IP adresu 24.5.0.5 a port 13463.
</p>
</ul>

<ul>
<b>"129.128.5.191 80"</b>
<p>
IP adresa a port, na který spojení vede jsou vypsány jako poslední.
</p>
</ul>

<a name="nat3.2"></a>
<b> Omezení NATu (v FTP)</b>

<p>
Existuje nìkolik omezení, která s sebou NAT pøiná¹í. Jedním z nich je FTP.
Kdy¾ se u¾ivatel spojí s FTP serverem v Internetu a ¾ádá informace nebo soubory, FTP server vytvoøí spojení s klientem a pøená¹í tyto informace. Spojení probíhá na náhodném volném portu. Toto je problém pro u¾ivatele poukou¹ející se spojit
s FTP serverem zevnitø LAN. Kdy¾ FTP server ode¹le informaci, po¹le ji na náhodný port na externí sí»ové rozhraní. Stroj s NATem ale nemá ¾ádné mapování pro 
neznámý paket a daný port, opustí tedy paket a nedodá jej. 

<p>
Vyøe¹it celý problém mù¾ete tak, ¾e se pøepnete ve FTP klientovi  do "passivního módu". Poté, kdy¾ vytváøíte spojení ven, NAT bude správnì pracovat.
<P>
IP filtr umo¾òuje jiné øe¹ení v této situaci, tj. ftp proxy, která je vestavìna
do kódu NATu. Aktivace dosáhnete tak, ¾e umístíte podobné pravidlo jako je následující pøed va¹e mapování NATu .
<PRE>
map dc0 192.168.1.0/24 -> 24.5.0.5/32 proxy port ftp ftp/tcp
</pre>
S tímto øádkem na svém místì bude kernel hlídat va¹e FTP spojení a v okam¾iku
kdy se v nìm objeví pøíkaz "PORT" pøicházející z ftp klienta, nahradí
IP adresu a port se svou vlastní IP adresou a portem, který si vybere. Potom
otevøe tento port a posílat data pøes tunel na port va¹eho ftp klienta, který
jste po¾adovali. Sice takto docílíte ponìkud pomalej¹ího zpracování paketù, domnívám se ale, ¾e je ve své podstatì zanedbatelné.
ok.
<P>


<br>
<a name="nat3.3"></a>
<b>Pøesmìrování spojení</b>

<p>
Stane se, ¾e potøebujete pøesmìrovat pøíchozí nebo odchozí spojení pro urèitý
protokol nebo port. Dobrý pøíklad tohoto je vá¹ web server nacházející se
uvnitø LAN. Pøíchozí spojení na platnou Internetovu IP adresu v¹ak budou
bez odezvy, proto¾e na stroji s NATem nebì¾í web server. Pro tento úèel
pou¾íváme direktivu NATu 'rdr' v souboru s pravidly, která dává instrukce pro
pøesmìrování urèitého spojení.
</p>

<p>

V na¹em pøípadì pøedpokládejme, ¾e web server se nachází na LAN s IP adresou
192.168.1.80. Soubor s pravidly pro NAT potøebuje novou direktivu, která se
o toto postará. Pøidejte øádku podobnou této do ipnat.conf :
</p>

<ul><pre>
rdr dc0 24.5.0.5/32 port 80 -> 192.168.1.80 port 80
</pre></ul>

<p>
Vysvìtlení:
</p>

<ul>
<b>"rdr"</b>
<p>
Pøíkaz, který dáváte ipnatu. Data na této øádce mají význam pøesmìrování spojení.
</p>
</ul>


<ul>
<b>"dc0"</b>
<p>
Sí»ové rozhraní pøipojené k Internetu.
</p>
</ul>

<ul>
<b>"24.5.0.5/32"</b>
<p>
Pøíchozí spojení na IP adresu vý¹e (pouze na device dc0 )
</p>
</ul>

<ul>
<b>"port 80"</b>
<p>
Port, který má být pøesmìrován. "port 80" mù¾ete nahradit "port www". Pokud
chcete pou¾ít jméno namísto èísla, musí odpovídající název a èíslo existovat
v souboru /etc/services.
</p>
</ul>

<ul>
<b>"192.168.1.80"</b>
<p>
IP adresa a maska stroje na LAN, na který se budou pøesmìrovávat pakety.
Maska je v¾dy "/32" a proto nemusí být uvedena.
</p>
</ul>

<br>
<a name="nat3.4"></a>
<b>NAT versus Proxy</b>

<p>
Rozdíl mezi NATem a aplikaènì zalo¾enou proxy je ten, ¾e proxy software jedná
jako prostøedník mezi Internetem a strojem pøipojeným na LAN. To je v poøádku,
pøesto ka¾dá aplikace, kterou chcete spustit MUSÍ být schopna pou¾ít proxy
server. Ne v¹echny aplikace to doká¾í (obzvlá¹» hry). Dále, nejsou zde proxy
server aplikace pro v¹echny Internetové slu¾by. NAT prùhlednì mapuje va¹i iterní sí», aby mohla být spojena s Internetem. Jediná výhoda, proè pou¾ívat
proxy software narozdíl od NATu je, ¾e proxy software by mìl být bezpeèný a mù¾e
provádìt filtrování na základì obsahu paketù, uchrání tak vá¹ stroj s Windows
od macro viru, mù¾e ochránit od buffer overflowu software klienta a více. 
Pou¾ívání tìchto filtrù je vìt¹inou nároèný úkol.
</p>

<a name="nat4.0"></a>
<b>6.3.4 Odkazy</b>

<p>
Soubory na OpenBSD:
<ul>
<li>/etc/ipnat.rules - pravidla pro NAT
<li>/etc/rc.conf - nutné editovat pro spu¹tìní ipnat a ipf pøi bootu
<li>/etc/sysctl.conf - nutné editovat pro IP forwarding
<li>/usr/share/ipf/nat.1 - pøíklad pravidel pro ipnat.
</ul>
</p>

<p>
NAT Internet Links:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&format=html">Man page showing correct ipnat.rules syntax</a>
<li><a href="http://coombs.anu.edu.au/~avalon/">http://coombs.anu.edu.au/~avalon/</a>
<li><a href="http://www.geektools.com/rfc/rfc1631.txt">http://www.geektools.com/rfc/rfc1631.txt</a>
</ul>
<p>

<br>

<p>
<a name= "6.4"></a> <h2>6.4 - DHCP</h2> </p>

<h3>6.4.1 DHCP Klient</h3>
<p>Pro pou¾ívání DHCP klienta <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html">dhclient(8)</a> dodávaného spolu
s OpenBSD, zeditujte soubor /etc/hostname.xl0 (za pøedpokladu, ¾e va¹e hlavní
ethernetové rozhraní je xl0. Mù¾ete mít jiné rozhraní, napø. ep0 nebo fxp0 nebo
jiné!) Jediné slovo, které musí tento soubor po editaci obsahovat je 'dhcp' .
<pre>
# <strong>echo dhcp >/etc/hostname.xl0</strong>
</pre>
Tento pøíkaz zpùsobí automatické nastartovaní DHCP klienta pøi bootování. OpenBSD bude od DHCP serveru po¾adovat informaci o své IP adrese, defaultním routeru a DNS serverech.
<p>
Chcete-li spou¹tìt DHCP klienta z pøíkazové øádky, ujistìte se, ¾e existuje
soubor /etc/dhclient.conf a potom vyzkou¹ejte:
<PRE>
# <strong>dhclient fxp0</strong>
</pre>
Kde fxp0 je rozhraní, na kterém chcete konfigurovat pomocí DHCP.
<P>Bez ohledu na to, jak spustíte DHCP klienta, mù¾ete zeditovat soubor /etc/dhclient.conf , aby napø. nedo¹lo ke zmìnì v ji¾ nakonfigurovaném DNS na základì
odezvy DHCP serveru. V tomto pøípadì staèí kdy¾ odkomentujete øádku zaèínající
slovem 'require' (tato øádka se nachází v pùvodním souboru), tak docílíte zmìny v chování DHCP klienta.
<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>
a potom <b>odstraòte</b> slovo domain-name-servers. Samozøejmì mù¾ete chtít
odstranit i jiná nastavení jako napø. hostname.
<P>
<h3>6.4.2 DHCP Server</h3>

Pokud chcete pou¾ívat OpenBSD jako DHCP server <A href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html">dhcpd(8)</a>,
zeditujte /etc/rc.conf.  Nastavte v nìm volbu  dhcpd_flags="-q"  namísto pùvodní dhcpd_flags=NO.
Nyní uveïte rozhraní, na kterých chcete aby <b>poslouchal</b> DHCP server, v
souboru /etc/dhcpd.interfaces.
<pre>
# <strong>echo xl1 xl2 xl3 >/etc/dhcpd.interfaces</strong>
</pre>
Pak zeditujte /etc/dhcpd.conf.
Volby uvedené v tomto souboru jsou dostateènì zøejmé.
<pre>
        option  domain-name "xyz.mil";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>
<p>
Takovéto nastavení øíká va¹im DHCP klientùm, ¾e doména, kterou mají pøidávat
k DNS dotazùm je xyz.mil (tedy pokud u¾ivatel napí¹e 'telnet joe' , pak ve skuteènosti se bude spojovat se strojem joe.xyz.mil).  Dále odká¾ete klienta, aby
pou¾íval DNS servery 192.168.1.3 a 192.168.1.5.  Poèítaèùm na stejné síti jako
je ethernetové rozhraní DHCP serveru, je¾ je v rozsahu 192.168.1.0/24 , bude
DHCP server pøiøazovat IP adresy mezi 192.168.1.32 a 192.168.1.127.  Defaultní
router klientù bude nastaven na 192.168.1.1.
<p>
Pokud chcete spou¹tìt dhcpd z pøíkazové øádky, po editaci /etc/dhcpd.conf vyzkou¹ejte:
<PRE>
# <strong>dhcpd -q fxp0</strong>
</PRE>
Kde fxp0 je rozhraní, na kterém chcete nastartovat DHCP server. Volba -q øíká
dhcpd , aby vypisoval co nejménì informací, v opaèném pøípadì je toti¾ dhcpd
velmi "ukecaný".
<P>
Pou¾íváte-li DHCP server pro stroje s Windows, mù¾ete dát klientovi adresu
'WINS' serveru. Docílíte toho tímto øádkem v /etc/dhcpd.conf:
<pre>
option  netbios-name-servers  192.168.92.55;
</pre>
(kde 192.168.92.55 je IP va¹eho Windows nebo Samba serveru. )
Více voleb pro dhcp klienty se nachází zde: <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5&format=html">dhcp-options(5)</a> .
<p>
<a name= "6.5"></a>
<h2>6.5 - PPP </h2>
</p>

Point-to-Point Protokol je tím protolem, který se dnes pou¾ívá pro spojení s
modemem va¹eho ISP. OpenBSD má dva zpùsoby jak toto spojení nakonfigurovat.

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html">pppd(8)</a> - Jedná se o ppp démona zaèlenìného do jádra systému .
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html">ppp(8)</a> - Tento ppp démon pracuje jako u¾ivatelský proces (nesystémový).
</ul>

<p>
První, který popí¹eme bude nesystémový ppp démon. Pøedtím ne¾ zaènete s konfigurací je dobré zjistit si nìkteré údaje od va¹eho ISP. Jedná se pøedev¹ím o:
</p>

<ul>
<li>Telefonní (dialup) èíslo va¹eho ISP
<li>vá¹ nameserver
<li>va¹e u¾ivatelské jméno a heslo
<li>vá¹ router
</ul>

<p>
Nìkteré z tìchto informací nutnì nepotøebujete, bez jiných se zase neobejdete.
Nesystémový ppp démon pou¾ívá <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a> jako svùj konfiguraèní soubor.
V adresáøi <b>/etc/ppp</b> se obecnì nachází øada souborù, které nabízejí
rùzné nastavení pro rùzné situace. Mìli byste si je prohlédnout.
</p>

<p>
Také se ujistìte, v pøípadì, ¾e pou¾íváte jádro GENERIC, ¾e máte následující
øádku ve va¹em konfiguraèním souboru:
</p>

<ul><pre><strong>
pseudo-device   tun             2
</strong></pre></ul>


<h3>Úvodní nastavení - pro PPP(8)</h3>

<p>
Úvodní nastavení nesystémového démona se sestává z editace souboru <b>/etc/ppp/ppp.conf</b>. Tento soubor defaultnì neexistuje, ale je tu soubor <b>/etc/ppp/ppp.conf.sample</b> , který mù¾ete jednodu¹¹e zeditovat a vytvoøit tak vlastní <b>ppp.conf</b> . Zde zaèneme s nejjednodu¹¹ím a patrnì také nejèastìj¹ím nastavením. Zde je soubor <b>ppp.conf</b>, díky kterému se ppp spojí s va¹ím ISP a nastaví defaultní routy a nameserver. S tímto souborem potøebujete vìdìt jen informaci
o telefonním èísle va¹eho ISP, u¾ivatelském jménu a heslu.
</p>

<ul>
<pre>
default:
set log Phase Chat LCP IPCP CCP tun command
set device /dev/cua01
set speed 115200
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</ul>

<p>
<b>Poznámka</b> - Na OpenBSD 2.6 byl systém dodáván se souborem <i>/etc/ppp/ppp.conf.example</i> , který mìl nesprávné nastavení sériového portu. Tento port
byl oznaèen jako zaøízení <i>"/dev/cuaa0"</i>. Zatímco tam mìlo být <i>/dev/cua00</i> , co¾ odpovídá sériovému portu èíslo 1. (COM1). Vá¹ modem  nemusí být na
 COM1, pøesto schéma pojmenování bylo ¹patné.
</p>

<p>
Sekce uvedená slovem <b>default:</b> bude vykonána pøi ka¾dém spu¹tìní. Zde
nastavujeme v¹echny kritické informace. Slovem  &quot;set log&quot; nastavujeme
záznamovou úroveò. Je mo¾né to zmìnit, více <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html">ppp(8)</a> man page. Sériový port
se nastavuje pøíkazem &quot;set device&quot;. Toto je zaøízení, na kterém se
nachází modem. V na¹em  pøípadì je modem na portu 2. Proto com port 1 by byl
/dev/cua00. Slovem  &quot;set speed&quot; nastavujeme rychlost dialup spojení
a pomocí &quot;set dial&quot; nastavujeme parametry dialup-u. Pomocí nich
mù¾eme zmìnit ná¹ timeout atd. 
</p>

<p>
Nyní mù¾eme pokraèovat nastavením informací o na¹em ISP. Provedeme to pøidáním
nové sekce za sekci <b>default:</b> . Tato sekce se mù¾e jmenovat jakkoliv,
nejjednodu¹¹í je pou¾ít jméno va¹eho ISP. My pou¾ijeme oznaèení <b>myisp:</b> .
Následuje krátké a jednoduché nastavení, které poskytuje to nejnutnìj¹í pro
na¹e spojení.
<p>

<ul>
<pre>
myisp:
set phone 1234567
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR
enable dns
</pre>
</ul>

<p>
Zde jsme nastavili  &quot;set phone&quot; telefonní èíslo na¹eho ISP,  &quot;set login&quot; volby pro pøihlá¹ení (timeout nastavený na 5 znamená, ¾e pøeru¹íme
pokus o pøihlá¹ení po pìti sekundách není-li na lince signál. Jinak budeme
èekat na zaslání na poslání øetìzce &quot;login:&quot; a pak po¹leme na¹e u¾ivatelské jméno a heslo. U nás to bude username=ppp a password=ppp. Tyto hodnoty
si zmìnte na va¹e vlastní. &quot;set timeout&quot; nastavuje timeout pro celý
pøihla¹ovací proces na 120 sekund. &quot;set ifaddr&quot; je ponìkud trikové.
Vysvìtlení je zde:
</p>

<ul><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></ul>

<p>
V øádku nahoøe nastavujeme na¹i IP adresu ve formátu  &quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeraddr]]]]</b>&quot;. Tedy první IP adresa na øádce specifikuje èíslo, které chceme obdr¾et od ISP jako na¹i IP adresu. Pokud máte statickou IP adresu,
nastavte ji zde. U nás pou¾ijeme /0 , co¾ øíká, ¾e ¾ádný z bitù ip adresy nemusí odpovídat a proto celá adresa mù¾e být nahrazena jinou (dynamicky pøiøazenou).
Druhá IP adresa je adresa, kterou oèekáváme jako IP adresu na¹eho ISP. Pokud
ji znáte, mù¾ete ji specifikovat. My opìt nevíme, co máme oèekávat, proto pou¾ijeme opìt /0 . Tøetí èíslo je na¹e sí»ová maska, zde nastavena na 255.255.255.0 . Pokud specifikujeme triggeraddr, je pou¾ita namísto myaddr v pùvodní IPCP komunikaci. Pøesto, pouze adresa v rozsahu myaddr bude akceptována. Toto je u¾iteèné
pøi komunikaci s nìkterými implementacemi PPP, které nedovolují pøiøadit IP adresu, pokud peer ¾ádá ``0.0.0.0''.
</p>

<p>
Dal¹í volba  &quot;add default HISADDR&quot; nastavuje defaultní routu na IP adresu providera. Dobré je, ¾e pokud se zmìní IP adresa providera za chodu, bude
va¹e routa automaticky upravena. Volbou  &quot;enable dns&quot; øíkáme na¹emu
ISP, aby nám sdìlil adresu nameserveru. Nepøidávejte tuto volbu, pokud u vás
bì¾í lokální DNS, proto¾e ppp lehce znemo¾ní její pou¾ívání tím, ¾e pøidá
nìkolik øádek do souboru /etc/resolv.conf.
</p>

<h3>Pou¾ívání PPP(8)</h3>

<p>
Nyní máme základní nastavení v souboru <b>ppp.conf</b> pøipravené a mù¾eme
zaèít zou¹et spojení s na¹ím ISP. Obvyklé formy pøikazu jsou:
</p>

<ul>
<li><b>ppp -auto myisp</b> - Spustí ppp, nastaví rozhraní a spojí se s na¹im isp, poté pøechází na pozadí.
<li><b>ppp -ddial myisp</b> - Podobné jako -auto, ale pokud konekce je zru¹ena, pokusí se znovu o spojení.
</ul>

<p>
Spu¹tìní <b>/usr/sbin/ppp</b> bez voleb vás zavede do interaktivního módu. V nìm mù¾ete komunikovat pøímo s modemem, velmi vhodné pøi ladìní problémù ve va¹em  <b>ppp.conf</b> .
</p>

<h3>ppp(8) extra</h3>

<p>
V nìkterých situacích mù¾ete chtít spustit dodateènì nìjaké pøíkazy, kdy¾ je
vytvoøeno nebo naopak zru¹eno spojení. Jsou zde dva soubory, které mù¾ete vytvoøit pro tyto situace. <b>/etc/ppp/ppp.linkup</b> a <b>/etc/ppp/ppp.linkdown</b>.
Pøíklad nastavení je zde:
</p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Dal¹í informace: <a href="http://www.freebsd.org/handbook/userppp.html">http://www.freebsd.org/handbook/userppp.html</a> nebo <a href="http://www.freebsd.org/faq/userppp.html">http://www.freebsd.org/faq/userppp.html</a>.
</p>

<p>
<a name= "6.6"></a>
<h2>6.6 - Zlep¹ování výkonu sítì</h2>

<H3>6.6.1 - Jak pøinutit jádro, aby dovolovalo vìt¹í poèet pokusù a del¹í timeout pro TCP spojení?</h3>
Normálnì byste to mìl vyu¾ít v pøípadì smìrovacích nebo spojovacích problémù.
Samozøejmì, nejefektivnìj¹í je, kdy¾ obì strany spojení pou¾ívají podobné hodnoty. 
<P>
Pou¾ijte <tt>sysctl</tt> a zvìt¹ete hodnoty promìnných:
<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>
Díky sysctl -a mù¾ete vidìt souèasné hodnoty tìchto a mnoha dal¹ích parametrù.
Zmìnu provedete pomocí <tt>sysctl -w</tt> jako napø. <tt>sysctl -w
net.inet.tcp.keepidle=28800</tt>.
<h3>6.6.2 - Jak mohu umo¾nit directed broadcast?</h3>
Normálnì to nepotøebujete dìlat. Directed broadcast umo¾òuje komukoliv poslat pakety na veøejnou adresu va¹í pøipojené sítì, pokud pou¾íváte OpenBSD jako router.<P>
V nìkterých pøípadech uzavøených sítí mù¾e být directed broadcast u¾iteèný,
zejména pøi pou¾ívání starých iplementací NetBIOS protokolu. Pou¾ijte <Tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> pro tuto vlastnost. Rovnou si ale
pøeètìte také èlánek o <A HREF="http://www.netscan.org">smurf útocích</a>,
pokud chcete vìdìt, proè je tato vlastnost defaultnì vypnutá.
<H3>6.6.3 - Nechci, aby kernel dynamicky alokoval urèité porty</h3>
Na tohle tu také máme jedno sysctl. v <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html">sysctl(8)</a> se pí¹e:
<PRE>
Nastavení rezervovaných TCP portù, které by nemìly být dynamicky pøidìlovány jádrem. Seznam èísel tìchto portù mù¾e být oddìlen èárkami a/nebo mezerami.

sysctl -w net.inet.tcp.baddynamic=749,750,751,760,761,871

Je také mo¾né odstranit nebo pøidat èásti souèasného seznamu.

   sysctl -w net.inet.tcp.baddynamic=+748
   sysctl -w net.inet.tcp.baddynamic=-871
</pre>

<a name="6.7"></a>
<h2>6.7 - Jednoduché pou¾ití NFS</h2>

<p> NFS , neboli Network File System, se pou¾ívá pro sdílení souborových systémù na síti. Dobré je, kdy¾ pøed pokusem o nastavení NFS serverù si pøeètete pár manuálových stránek:

<p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8&format=html">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8&format=html">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a>
</ul>

<p>
Tato sekce vás provede základními kroky pro jednoduché nastavení NFS. V pøíkladì pøedpokládejme server na LAN, s klienty pøistupujícími na NFS na LAN. Nemluvíme zde o zabezpeèení NFS. Pøedpokládáme, ¾e jste ji¾ nastavili filtrování paketù,
nebo jinou firewallovou ochranu pro odepøení pøístupu zvenèí. Pokud dovolujete
vnìj¹í pøístup na vá¹ NFS server a máte na nìm nìjaká citlivá data, dùraznì doporuèujeme, abyste zprovoznil <A HREF="faq13.html">IPSec</a>. V opaèném pøípadì
mohou cizí lidé potenciálnì vidìt va¹e  NFS spojení. Mù¾e to vést i k nìkterým
útokùm. Pokud je IPSec protokol správnì nastaven, mù¾e vás od tohoto typu útokù
ochránit. 
<P>
Jiná podstatná bezpeènostní poznámka. Nepøidávejte filesystém do /etc/exports bez urèitého seznamu povolených strojù. Bez seznamu strojù, které mohou pøipojit
daný adesáø mù¾e kdokoliv, kdo má spojení s va¹ím poèítaèem pøipojit adresáøe,
které pøes NFS exportujete.
</p>

<p>
Nastavení obsahuje server s ip <b>10.0.0.1</b>, který slou¾í jako NFS server
pouze klientùm na této síti. První krok pøi nastavení NFS je nastavit soubor 
<i>/etc/exports</i> . Tento soubor obsahuje seznam filesystému, které chcete
zpøístupnit pøes NFS a definuje, komu je mù¾ete zpøístupnit. V <i>/etc/exports</i> mù¾ete pou¾ít spoustu voleb a nejlépe je pøeèíst si <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a> man page. My máme <i>/etc/exports</i> takovýto:
</p>

<ul><pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></ul>

<p>
To znamená, ¾e lokální filesystém  <b>/work</b> bude zpøístupnìn pøes NFS.
<b>-alldirs</b> øíká, ¾e klienti budou moci pøipojit kterýkoliv podadresáø
adresáøe <b>/work</b>. <b>-ro</b> øíká, ¾e pøipojit filesystém bude mo¾né jen
pro ètení. Poslední dva argumenty øíkají, ¾e pouze klienti v rozsahu sítì 10.0.0.0 s maskou 255.255.255.0 budu oprávnìni pøipojit filesystém. To je dùle¾ité
zejména pro sítì, které jsou pøistupné zvenku.
</p>

<p> Máte-li nastaven <i>/etc/exports</i>, mù¾ete pokraèovat v nastavení 
NFS serveru. Nejprve se ujistìte, ¾e máte zkompilované jádro s volbami NFSSERVER a NFSCLIENT. (jádra GENERIC jsou ok ). Dále nastavte v <i>/etc/rc.conf</i> <strong>nfs_server=YES</strong> . Tím spustíte nfsd(8) i mountd(8) po rebootování.
Pro zaèátek mù¾ete spustit démony ruènì. Musíte je spustit jako root a potøebujete se ujistit, ¾e vám na systému bì¾í portmap(8). Pøíklad jak spustit nfsd(8),
který pracuje jak na TCP tak na UDP ve 4 instancích. Mìli byste nastavit maximální poèet klientù se ¾ádostí o spojení na slu¾bu NFS.

<P>

<ul><pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre></ul>

<p>
Nestaèí pustit jen nfsd(8) server, musíte spustit i mountd(8). Jedná se o démona, který vlastnì obsluhuje ¾ádosti o NFS spojení. Napi¹te:
<p>

<ul><pre>
# <strong>/sbin/mountd</strong>
</pre></ul>

<P>
Pokud udìláte zmìny v /etc/exports poté co u¾ NFS bì¾í, musíte na to mountd
upozornit! Takhle:

<UL><PRE>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre></ul>

<P>

<h3>Kontrola stavu NFS</h3>

<p>
Nyní se mù¾ete podívat a ujistit se, ¾e démoni bì¾í a jsou registrováni s RPC.
Pou¾ijte procinfo(8).
<p>

<ul><pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></ul>

<p>V normálním provozu máte k dispozici dal¹í utility, které vám dovolují sledovat co se dìje na NFS. Jedna z nich je <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8&format=html">showmount(8)</a>
, která umo¾òuje sledovat co je právì pøipojeno a kdo to pøipojil. Dále také nfsstat(8) s podrobnìj¹ím výpisem. Pou¾ití pøíkazu showmount(8): zkuste <b>/usr/bin/showmount -a host</b>. Napøíklad:

<P>

<ul><pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></ul>

<h3>Pøipojení NFS filesystému</h3>

<p>
NFS filesystém by mìl být pøipojen pomocí pøíkazu mount(8),  nebo speciálnì <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html">mount_nfs(8)</a>.
Pro pøipojení filesystému /work na stroji 10.0.0.1 na lokální filesystém /mnt,
udìlejte toto: (pozn. nepotøebujete pou¾ívat ip adresy, mount resolvuje jména):
<p>

<ul><pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre></ul>

<P>
Pøipojení systému pøi bootu:
pøidejte do <i>/etc/fstab</i>:
<P>

<UL><PRE>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></ul>

<P>
Je dùle¾ité pou¾ít <tt>0 0</tt> na konci øádky, jinak bude vá¹ poèítaè pou¹tìt fsck na NFS filesystém pøi startu!!!!
Jiné standardní security volby jsou noexec, nodev, a nosuid ta poslední by mìla
být pou¾ita kde jen to je mo¾né. Napø.:
<P>

<UL><PRE>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></ul>

<P>
Diky tomu nebudou moci ¾ádné suid bit binárky na NFS serveru podlomit bezpeènost na NFS klientovi. Pokud nepøipojujete programy, které by mìly bì¾et na klientovi, pøidejte noexec.


<a name="6.8"></a>
<h2>6.8 - Domain Name Service  - DNS, BIND, a named</h2>

<h3>6.8.1 Co je DNS?</h3>

<p>
Domain Name Service je sí»ová slu¾ba zprostøedkující sí»ovým doménám na bázi IP
pøeklad sí»ových IP adres na jména a jména strojù na sí»ové adresy. va¹e instalace OpenBSD je nastavena defaultnì jako DNS klient, ne jako DNS server. Tj. va¹e instalace OpenBSD mù¾e dávat DNS serverùm DNS dotazy, ale nemù¾e sama odpovídat
na DNS dotazy , pokud není speciálnì nastavena. Tu je info jak na to.</p>

<p>
Máte-li OpenBSD pøipojené k Internetu pøes va¹eho ISP, mù¾ete spustit <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>, program, který provádí DNS dotazy:
</p>

<ul><pre>
$ <strong>nslookup www.openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre></ul>

<p>
<b>165.87.201.244</b> je nameserver , který odpovìdìl, je to nameserver, který
mùj ISP doporuèuje, abych ho pou¾íval v rámci svého úètu a toto èíslo je
ulo¾eno v <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">/etc/resolv.conf</a>. Odpovìï ale nebyla autoritativní. Pro
autoritativní odpovìï na DNS dotaz zjistíme nejprve, který DNS server je autoritativní pro doménu <i>openbsd.org</i> a zeptáme se ho pak na adresu <i>www.openbsd.org</i>:
</p>

<ul><pre>
# Identify the name servers for openbsd.org
# with the help of my ISP's name server.
$ <strong>nslookup -type=NS openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# Use the info gained to query for an authoritative
# resolution: query the authoritative zeus.theos.com.
$ <strong>nslookup www.openbsd.org zeus.theos.com</strong>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre></ul>

<p>
<i>zeus.theos.com</i> je , jak se dá pøedpokládat, server s OpenBSD, který
je správnì nastaven jako DNS server pro doménu <i>openbsd.org</i>.
</p>

<a name="6.8.1.1"></a>
<h3>6.8.1.1 Kde se dozvím v¹echno o DNS a jeho iplementaci pod OpenBSD?</h3>

<ul>
<li>Jednak RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, a <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> s více informacemi o DNS.</li>
<li>Kniha od O'Reilly Associates <i><a href="http://www.openbsd.org/books.html#dns&bind">DNS a BIND</a> </i>.</li>
<li>Dále pak <a href="http://www.openbsd.org/cgi-bin/man.cgi">OpenBSD Manual</a> speciálnì manuálové stránky </li>
  <ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3&format=html">gethostbyname(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8&format=html">named(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3&format=html">resolver(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5&format=html">resolver(5)</a>
  </ul>
</ul>

<p>
Pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> je u¾iteèný tím, ¾e vrací informaci o doménì ve stejném formátu, jaký je nutný pro konfiguraèní soubory BINDu. Mù¾ete pou¾ít  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> pro prozkoumání nameserverù, které pracují správnì, abyste mohli porovnat jejich
nastavení s va¹ím.
</p>

<h3>6.8.2 Potøebuji, aby mùj stroj slou¾il jako nameserver?</h3>

<p>
Pokud si nejste jisti, zda by mìl vá¹ stroj slou¾it jako DNS server, nekonfigurujte ho tak. Instalace OpenBSD defaultnì neaktivuje stroj jako domain name server, aèkoliv v¹echny potøebné soubory jsou instalovány. Pro vìt¹inu poèítaèù
je dostaèující soubor  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5&format=html">/etc/hosts</a> s názvy lokálních strojù a jejich IP
adresami a soubor <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">/etc/resolv.conf</a>, který udává adresy DNS serverù,
pou¾ívaných vámi na internetu nebo intranetu.
</p>

<p>
Na druhou stranu mù¾e být ve va¹em pøípadì potøeba nastavit stroj jako domain
name server:
<ul>
<li>Pokud máte IP LAN a nechcete replikovat "hosts" soubory lokálních adres
stroj od stroje. V takovém pøípadì byste mohli konfigurovat OpenBSD jako
DNS server a odpovídat na DNS dotazy strojù z va¹í LAN.</li>
<ul>
<li><b>Poznámka:</b> Neexistuje praktické omezení poètu DNS serverù na LAN.
¾ádný nebo naopak v¹echny poèítaèe na LAN mohou nabízet DNS service, pokud
jsou tak konfigurovány. Zda je ten který server pova¾ován za autoritativní
zvenku va¹í LAN (nebo je vùbec znám venkovním sítím) je vlastnost konfigurace,
která je vìt¹inou kontrolována na vy¹¹í úrovni doménové hierarchie.</li>
</ul>
<li>Pokud máte IP LAN, na které se nacházejí poèítaèe, které byste chtìli mít
dostupné z hlediska DNS dotazù, ze strojù z jiných IP LAN nebo WAN.</li>
<li>Pokud máte potí¾e s pøevodem názvu stroje na IP adresu nebo s pøevodem lokálních názvù na IP adresy, pøesto¾e máte správnì nastaven obsah souborù <i>/etc/hosts</i> a <i>/etc/resolv.conf</i> (Napø. Netscape na OpenBSD obèas vykazuje
podobné problémy, proto¾e implementuje vlastní resolver místo pou¾ití funkce
<i>gethostbyname(3)</i> pro kladení DNS dotazù.))</li>
</ul>

<p>
Dal¹ím faktorem je rychlost procesu. Proto¾e pøeklad jmen na adresy je opakující se proces, ve kterém name servery opakovanì odpovídají jiným nameserverùm na dotazy ohlednì adres jiných domén, pøeklad jmen mù¾e trvat ponìkud déle, pokud
máte modemové spojení s Internetem a dotazujete se vlastního DNS serveru na adresy vzdálených poèítaèù (který se pak bude opakovanì dotazovat vzdálených name
serverù pomocí modemu), ne¾ pokud se dotazujete name serveru va¹eho ISP (který
má zøejmì rychlej¹í spojení se vzdálenými name servery).
</p>

<h3>6.8.3 Jaké jsou softwarové komponenty DNS serveru?</h3>

<ul>
<li>named <i>("name daemon")</i></li>
<li>Konfiguraèní soubory v adresáøovém hierarchii pod <i>/var/named/</i></li>
</ul>

<h4>6.8.3.1 Jaká úroveò BINDu je podporována?</h4>

<p>
BIND je oznaèení implementaci DNS. Komponenty domain name serveru spoleènì implementují BIND.
</p>

<p>
Existují dvì odli¹né specifikace BIND:
<ol>
<li>BIND 4</li>
<li>BIND 8</li>
</ol>

<p>
V bì¾né instalaci OpenBSD <b>named</b> podporuje BIND 4.x.

<h4>6.8.3.2 Jaké jsou nìkteré mo¾nosti provozování DNS prostøednictvím defaultní implementace BIND 4.x?</h4>

<ul>
<li>Iplementace BIND 8.x v <i>/usr/ports/net/bind8</i>.(Viz. <a href="../../cs/ports.html">ports</a>)
<li>D. J. Bernstein's <a href="http://cr.yp.to/dnscache.html">DNSCache</a>. DNSCache je také dostupná v ports tree na <i>/usr/ports/net/dnscache/</i>.
Tento program obsahuje minimalistický DNS server, který je vynikající pro místa,
která nemají velkou databázi DNS polo¾ek. DNSCache mù¾e být jednodu¹¹e øízena
pomocí skriptu. Více na home page.
<LI>Nìkteøí lidé, kteøi mìli ¹patné zku¹enosti s BINDem se rozhodli napsat Dents, jejich vlastní DNS server, <A HREF="http://www.dents.org">Dents</a>.
Obsahuje øadu zajímavých vlastností.
</ul>

<h5>6.8.3.2.1 <u>Poznámka o bezpeènosti</h5></u>

<p>
Pokud pou¾íváte tyto alternativní implementace domain name slu¾by, provozujete kritickou sí»ovou slu¾bu za pou¾ití softwaru, který nebyl pøedmìtem bezpeènostního auditu jako <a href="http://www.openbsd.org/security.html">auditovaný</a> <b>named</b> name daemon v základní instalaci. Toto je zapotøební zvá¾it, ponìvad¾
v pøípadì bezpeènostního naru¹ení domain name serveru mohou být resolvery pou¾ívající tento name server pøesmìrovány na cizí místa.
</p>

<h3>6.8.4 Kolik toho musím nainstalovat?</h3>

<p>
Pokud bylo nále¾itì nainstalováno pùvodní sí»ové nastavení pøi instalaci OpenBSD, pak je u¾ v¹echno vlastnì instalováno. Musíte je¹tì nastavit name daemona ("<tt>named</tt>").
</p>

<h3>6.8.5 Jak konfigurovat DNS?</h3>

<p>
Konfigurace se sestává na OpenBSD z editace nebo vytvoøení souborù, které øídí
name daemona <tt>named</tt>. Tyto soubory se nacházejí pùvodnì v adresáøi <i>/var/named</i> a v jeho podadresáøích, obzvlá¹tì soubor  <i>/var/named/named.boot</i>, co¾ je inicializaèní soubor pro <b>named</b>. Je tu rovnì¾ nìkolik dal¹ích
krokù konfigurace, které se nacházejí v <i>/etc</i>.
</p>

<p>
V tomto dokumentu budeme konfigurovat name daemona na <i>nemo.yewtopia.com</i> jako primární nameserver pro (velmi malou!!!) doménu <i>yewtopia.com</i>. Adresa i>nemo.yewtopia.com</i> je <i>192.168.1.9</i>. Dva jiné poèítaèe <i>crater.yewtopia.com </i> na 192.168.1.1 a <i>earhart.yewtopia.com</i> na 192.168.1.2 se nacházejí v její podsíti.
</p>

<h4>6.8.5.1 Konfigurace v <i>/var/named</i></h4>

<h5>6.8.5.1.1 <i>/var/named/named.boot</i></h5>

<ul><pre>
; tell what subdir has the lookup database files
directory       /namedb

; type    domain                source host/file
backup file
cache
root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; example primary server config:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
</pre></ul>

<p>
Obsah souboru øíká inicializaèními procesu, ve kterém podadresáøi a pod kterými
jmény se nacházejí konfiguraèní soubory pro <i>yewtopia.com</i>.

<h5>6.8.5.1.2 <i>/var/named/namedb/localhost.rev</i></h5>

<ul><pre>
; Reverse lookup for localhost interface
@       IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
</pre></ul>

<h5>6.8.5.1.3 <i>/var/named/namedb/yewtopia</i></h5>

<ul><pre>
; yewtopia.com domain database
yewtopia.com.        IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Addresses
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre></ul>

<h5>6.8.5.1.4 <i>/var/named/namedb/yewtopia.rev</i></h5>

<ul><pre>
; yewtopia domain reverse lookup database
1.168.192.in-addr.arpa. IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Addresses
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre></ul>

<h4>6.8.5.2 Konfigurace v <i>/etc</i></h4>

<h5>6.8.5.2.1 <i>/etc/resolv.conf</i></h5>
<p>
Ujistìte se, ¾e <i>/etc/resolv.conf</i> nyní odkazuje na doménu lokálního
stroje (namísto napøíklad nameserveru va¹eho ISP) tak, aby ¾ádosti na DNS
dotazy byly zasílány na <b>named</b>, kterého jste konfigurovali!
</p>

<ul><pre>
domain yewtopia.com
lookup file bind
</pre></ul>

<h4>6.8.5.2.2 <i>/etc/hosts</i></h4>

<p>
Pokud jste døíve pøidali adresy rùzných strojù do souboru <i>/etc/hosts</i>, mù¾ete zvá¾it zkrácení souboru <i>/etc/hosts</i> do pùvodního stavu:
</p>

<ul><pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre></ul>

<p>
Takto není <b>named</b> obcházen v pøípadì (mo¾ná zastaralých) adres v souboru
<i>/etc/hosts</i>. <u>Ujistìte se, ¾e máte pøinejmen¹ím v tomto souboru polo¾ku <i>localhost</i> </u> jinak se va¹e sí» správnì nenastaví! V¹imnìte si také, ¾e
 <i>nemo</i> se mustí objevit ve vlastním hosts souboru, jinak uvidíte (vìt¹inou málo nebezpeènou) chybovou hlá¹ku pøi startu, kdy¾ <i>/etc/netstart</i> spustí <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8&format=html">route(8)</a> , aby pøidal <i>nemo</i> (jeho¾ adresa se objeví v  <i>/etc/myname</i>).
</p>

<h4>6.8.5.3 Pou¾ití <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> pro zkoumání výsledkù.</h4>

<ul><pre>
$ <strong>dig @nemo.yewtopia yewtopia any any</strong>

; <<>> DiG 2.2 <<>> @nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia, type = ANY, class = ANY

;; ANSWERS:
yewtopia.        3600   SOA     nemo.yewtopia.
your_id.nemo.yewtopia. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.        3600   NS      nemo.yewtopia.

;; ADDITIONAL RECORDS:
nemo.yewtopia.   3600   A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre></ul>

<h3>6.8.6 Jak a kdy mám nastartovat a zastavit DNS?</h3>

<h4>6.8.6.1 Start DNS</h4>

<p>
Démon <b>named</b> je spu¹tìn pøi startu systému z <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">/etc/rc</a>, v øádce instalované v pùvodním <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8&format=html">/etc/rc.conf</a>.
</p>

<ul><pre>
named_flags=NO          # for normal use: ""
</pre></ul>

<p>
je zmìnìno na 
</p>

<ul><pre>
named_flags=""          # for normal use: ""
</pre></ul>

<p>
Rovnì¾ si v¹imnìte øádkù v /etc/rc.conf:
</p>

<ul><pre>
named_user=named                # Named should not run as root unless neccesary
named_chroot=/var/named         # Where to chroot named if not empty
</pre></ul>

<p>
Tato nastavení budou správná pro vìt¹inou míst.
</p>

<p>
Ruèní spu¹tìní <b>named</b>: pou¾ijte pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>. Napøíklad:
</p>

<ul><pre>
# <strong>ndc start</strong>
nebo 
# <strong>ndc reload</strong>
</pre></ul>

<h4>6.8.6.2 Zastavení DNS</h4>

<p>
Nejlep¹í zpùsob jak zastavit démona je pou¾ít pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>. Napøíklad:
</p>

<ul><pre>
# <strong>ndc stop</strong>
</pre></ul>

<p>
Pokud toto nefunguje, najdìte proces id procesu named a pou¾ijte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1&format=html">kill(1)</a> pro ukonèení procesu. PID of <b>named</b>, pokud bì¾í, mù¾ete najít v první øádce souboru <i>/var/named/named.pid</i>
</p>

<ul><pre>
# <strong>cat /var/named/named.pid</strong>
4608
named -t /var/named -u named
# <strong>kill -KILL 4608</strong>
</pre></ul>

<h4>6.8.6.3 Restart DNS se zmìnìnou konfigurací</h4>

<p>
Chcete-li, aby bì¾ící instance déman named restartovala sama sebe, s naètením
nové konfigurace, za¹lete procesu signál "hangup":
</p>

<ul><pre>
# <strong>kill -HUP 4608</strong>
</pre></ul>

<p>
nebo pou¾ijte pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>. Napø.:
</p>

<ul><pre>
# <strong>ndc restart</strong>
</pre></ul>

<h3>6.8.7 Jak zablokovat AXFR dotazy? </h3>
<p>
pøíklad:
<ul><pre>
garden:/home/jeremy$<strong>  host -l openssh.com</strong>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre></ul>
<p>
Tato informace je u¾iteèná pri ladìní DNS, ale v nìkterých pøípadech nemusí být vhodné nabízet tento výstup veøejnì.
Pokud pou¾íváte classless in-addr(rfc2317) jako reverz, host -l bude informovat o ka¾dé doménì, která se nachází ve va¹em systému! Zákazu zónových transferù 
docílíte pomocí klauzule 'allow-transfer' ve va¹em zónovém souboru.
<br><br>
Pokud pou¾íváte Bind8, mù¾ete specifikovat poèítaèe, kterým dovolíte zónové
transfery zón ve va¹ich zónových souborech:
<ul><pre>
zone "foo.com" in {
        type master;
        file "directory/zonefile";
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre></ul>
Mù¾ete také zablokovat transfery V¹ech domén editováním souboru /var/named.conf a pøidáním parametru 'allow-transfer' do sekce options:
<pre><ul>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre></ul>
Metoda Bind8 pracuje takté¾ s Bind9.<br>
Pokud pou¾íváte Bind 4 (default v OpenBSD) mù¾ete editovat /var/named/named.boot a pou¾ít volbu 'xfrnets'.<br>

<pre><ul>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre></ul><br>
Bind 4 dovoluje transfery z celých tøíd, tak¾e není tak pøesný.
Typicky jediné stroje, které potøebují vykonávat DNS transfery jsou va¹i DNS slaves a stroje, ze kterých chcete DNS debugovat (127.0.0.1 je vìt¹inou dobrá volba, u které dovolit transferu!)
Blokování AXFR dotazù pøidává dal¹í úroveò soukromí, ale mù¾e znemo¾nit debugování DNS. 
(Thanks to <a href=mailto:ntang@nachtwache.org>Nicholas Tang</a> za tento tip)
</p>
<h3>6.8.8 Co jste mi neøekli o nastavení DNS?</h3>
<p>
Je zde toho mnoho, napøíklad, jak nastavit DNS, aby dotazy na intranetové domény, které nejsou viditelné z koøene doménové hierarchie byly pøevádìny na servery v rámci va¹í spoleènosti. Radìji si pøeètìte <a href="#6.8.1.1">Dokumenty které doporuèujeme</a> , kde najdete více informací o DNS.
</p>

<a name="6.9"></a>
<h2>6.9 - Nastavení PPTP spojení v OpenBSD</h2>

<p>
<strong>POZNÁMKA:</strong> Informace se nevztahují ke  <strong>V©EM</strong> ADSL providerùm, ale mnoho informací mù¾e být pøevzato z tohoto nastavení. O nìm je známo, ¾e funguje pro ADS providera v Rakousku <a href="http://www.inode.at">Inode</a>. 
</p>

<p>
Pro zaèátek potøebujete nainstalovat pptp. Port byl pøidán do OpenBSD portù POTÉ co bylo vydáno OpenBSD 2.8 a pracuje dobøe s OpenBSD 2.8 ports tree. Port se nachází v <i>/ports/net/pptp</i>. Pøeètìte si <a href="faq8.html#8.6">FAQ 8.6</a> pro více informací o OpenBSD ports tree.
</p>

<p>
V dùsledku konfliktu pptp s podporou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386&format=html">gre(4)</a> v jádøe budete nutné pøekompilovat jádro a odstranit podporu pro gre(4).
</p>

<ul>Patch pro odstranìní GRE(4) podpory.
pre>
Index: sys/conf/GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.66
diff -u -r1.66 GENERIC
--- sys/conf/GENERIC    2000/10/13 04:21:14     1.66
+++ sys/conf/GENERIC    2000/12/26 19:55:31
@@ -97,6 +97,6 @@
 pseudo-device  ksyms   1       # kernel symbols device
 pseudo-device  bridge  2       # network bridging support
 #pseudo-device vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface

 option         BOOT_CONFIG     # add support for boot -c
</pre></ul>

<p>
Pro pøekompilování jádra proveïte checkout  OpenBSD 2.8-stable pomocí cvs (podívejte se na webovou stránku <a href="../../cs/stable.html">OpenBSD Stable</a> pro více informací), aplikujte pøedcházející patch a pøekompilujete kernel podle <a href="faq5.html#5.3">FAQ 5.3</a>.
</p>

<p>
Poté co nainstalujete balík <b>pptp</b> a nové jádro, potøebujete zeditovat soubory pro nastavení spojení. Tento balík pou¾ívá do OpenBSD zakomponované <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386&format=html">ppp(8)</a>, tak¾e pokud se v nìm vyznáte, pak velká èást nastavení vypadá stejnì. Rovnì¾ se podívejte na <a href="#6.5">FAQ 6.5</a>.
</p>

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Soubor <i>/etc/ppp/options</i> s následujícím nastavením bude dìlat pravdìpodobnì co potøebujete:
</p>

<ul><pre>
# <strong>cat /etc/ppp/options</strong>
name "LOGINNAME"
noauth
noipdefault
defaultroute
debug
</pre></ul>

<p>
<tt>LOGINNAME</tt> Mìlo by být nahrazeno va¹ím User-ID.
</p>

<p>
V  <i>/etc/ppp/pap-secrets</i> øádek:

<ul><pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre></ul>

<p>
Kde LOGINNAME je va¹e User-ID a PASSWORD je va¹e heslo. 10.0.0.138 je IP pøiøazené va¹emu MODEMu v pøípadì ¾e pou¾íváte ADSL, atd. Ujistìte se, ¾e soubor mù¾e èíst pouze u¾ivatel root (mód 600).
</p>

<h3>6.9.1 - Pøiøazení adresy sí»ovému rozhraní</h3>

<p>
V pøedcházejícím pøípadì mìl ná¹ modem pøedkonfigurovaný interfejs na 10.0.0.138. Nyní potøebujeme pøiøadit adresu  NA©EMU rozhraní. Nejlépe je vybrat si jedno IP blízko tomu, které vám bylo pøiøazeno va¹ím modemem, nebo pou¾ít statické IP které vám pøiøadili. Více si pøeètìte v <a href="#6.1">FAQ 6.1</a>.
</p>

<p>
Poté co nastavíte interfejsy, mìli byste být schopni vytvoøit pptp spojení pøíkazem.

<ul><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &</strong>
</pre></ul>

<p>
Proto¾e pou¾íváme do OpenBSD zaèlenìné ppp(8), jsou nastartovány dva procesy. Mù¾ete zastavit pptp ukonèením obou procesù:
</p>

<ul><pre>
# <strong>kill -9 [pid of pppd]</strong>
% <strong>kill -9 [pid of pptp]</strong>
</pre></ul>

Doporuèujeme otevøít si  <tt>/var/log/messages</tt> v oddìleném terminálovém oknì, abyste rozpoznali mo¾né problémy.

<ul>
<pre>
# <strong>tail -f /var/log/message</strong>
</pre></ul>
</p>

<p>
Rovnì¾ si pøidejte startovací pøíkaz do <i>/etc/rc.local</i> abyste se mohli automaticky spojit pøi restartu.
</p>


<p>
<font color= "#0000e0">
<a href= "index.html">[Zpìt na hlavní stránku]</a>
<a href= "faq5.html">[Do sekce 5.0 - Nastavení jádra]</a>
<a href= "faq7.html">[Do sekce 7.0 - Keyboard controls]</a>
</font>
</p>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq6.html,v 1.99 ]
<br>
$Translation: faq6.html,v 1.3 2001/05/31 10:47:38 certik Exp $
<br>
$OpenBSD: faq6.html,v 1.2 2001/05/31 19:02:35 jufi Exp $
</small>

</body>
</html>


