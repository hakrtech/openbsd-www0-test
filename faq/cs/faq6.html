<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>6 - Nastavení sítì</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- passes validator.w3.org, please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[FAQ Index]</a>
<a href="faq5.html">[Sekce 5 - Pøeklad systému ze zdrojových kódù</a>
<a href="faq7.html">[Sekce 7 - Nastavení klávesnice a displeje]</a>
</font>

<h1><font color="#e00000">6 - Nastavení sítì</font></h1>

<p>
<h3>Obsah</h3>
<ul>
<li><a href= "#Intro" >6.0.1 - Pøedtím ne¾ pùjdeme dále</a>
<li><a href= "#Setup" >6.1 - Úvodní nastavení sítì</a>
<li><a href= "#PF"    >6.2 - Packet Filter (PF)</a>
<li><a href= "#DHCP"  >6.4 - Dynamic Host Configuration Protocol (DHCP)</a>
<li><a href= "#PPP"   >6.5 - Point to Point Protokol</a>
<li><A href= "#Tuning">6.6 - Zlep¹ování výkonu sítì</a>
<li><a href= "#NFS"   >6.7 - Pou¾ívání NFS</a>
<li><a href= "#PPTP"  >6.9 - Nastavení PPTP spojení v OpenBSD</a>
<li><a href= "#Bridge">6.10 - Nastavení bridge s OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<a name="6.0.1"></a>

<p>
Na úvod pøedpokládáme, ¾e ètenáø pøeèetl a alespoò èásteènì chápe sekci 
<a href="faq5.html">Konfigurace jádra</a> tìchto FAQ, stejnì jako
manuálové stránky pøíkazù 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;amp;sektion=8">
ifconfig(8)</a> a 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;amp;sektion=1">
netstat(1)</a>.

<p>
Pokud jste administrátor sítì a nastavujete smìrovací protokoly, pokud 
pou¾íváte OpenBSD box jako router, pokud chcete hloubìji poznat princip 
fungovaní sítì s IP protokolem, pak byste si rozhodnì mìli pøeèíst
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">
V¹e co potøebujete vìdìt o IP adresování</a>.
Jedná se skuteènì o vynikající dokument, který obsahuje zcela
nepostradatelné informace pro práci se sítìmi na bázi IP protokolu,
obzvlá¹tì pokud pokud máte co do èinìní nebo zodpovídáte za více ne¾
jednu sí».

<p>
Pokud pracujete s aplikacemi jako jsou web servery, ftp servery a mail
servery, mù¾ete najít mnoho cenných informací 
<a href="http://the.rfc-editor.org/rfc.html">ètením RFC dokumentù</a>.
Samozøejmì, ¾e je nemù¾ete pøeèíst v¹echny. 
Radìji si vyberte téma, o které se zajímáte, nebo které pou¾íváte
v práci.  RFC definují mnoho (øádovì tisíce) standardù protokolù
internetu a popisují, jak tyto protokoly jsou navr¾eny a jak pracují.

<p>
<a name="Setup"></a>
<h2>6.1 - Úvodní nastavení sítì</h2>

<p>
<a name="Setup.1"></a>
<h3>6.1.1 - Identifikace a nastavení va¹ich sí»ových rozhraní</h3>

<p>
Nejprve je nutné identifikovat v systému vá¹ sí»ový hardware. V OpenBSD
jsou sí»ová rozhraní pojmenovaná podle sí»ové karty, ne podle typu
spojení.  To zda byla va¹e sí»ová karta inicializovaná, mù¾ete vidìt pøi
startu systému, nebo pozdìji pomocí pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;amp;sektion=8">dmesg(8)</a>.
Rovnì¾ mù¾ete svoje sí»ová rozhraní identifikovat ve výpisu pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;amp;sektion=8">ifconfig(8)</a>
Napøíklad zde je výstup z pøíkazu dmesg pro sí»ovou kartu Intel Fast
Ethernet, které odpovídá název zaøízení fxp.
</p>

<blockquote><pre>
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre></blockquote>

<p>
Pokud nevíte, jaké jméno v systému odpovídá va¹í kartì, podívejte se,
prosím, na <a href="../../cs/plat.html">seznam podporovaného hardwaru</a>
pro Va¹i platformu. Najdete tam seznam mnoha bì¾ných sí»ových karet a
jména je OpenBSD ovladaèù. Spojte krátké alfabetické jméno zaøízení
(jako fxp) s èíslem pøiøazeným kernelem a získáte jméno rozhraní (napø.
fxp0).
</p>

<p>
Chcete-li zjistit, která zaøízení byla identifikována, mù¾ete pou¾ít
pøíkaz 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Následující pøíkaz uká¾e v¹echna sí»ová rozhraní v systému.
V tomto vzorovém výstupu vidíme pouze jedno fyzické rozhraní,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>.
</p>

<blockquote><pre>
$ <strong>ifconfig -a</strong>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000 
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
	inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
	address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
	address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre></blockquote>	 

<p>
Jak je vidìt, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
dává více informací, ne¾ v této fázi potøebujeme. Umo¾òuje nám ale najít
na¹e zaøízení. V pøedcházejícím pøíkladì je ji¾ sí»ová karta
nakonfigurována.  Poznáte to podle vypsaných hodnot &quot;inet 10.0.0.38
netmask 0xffffff00 broadcast 10.0.0.255&quot;, odpovídající nastavení
parametrù a také pomocí pøíznakù <strong>UP</strong> a
<strong>RUNNING</strong>.

<p>
Zaznamenáte také nìkolik dal¹í rozhraní, která jsou standardnì zapnuta.
Ta poskytují rùzné slu¾by. Následující manuálové stránky je popisují:

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
  - Loopback Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog</a>
 - Packet Filter Logging Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
 - SLIP Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
 - Point to Point Protocol
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
 - Tunnel Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
 - Encapsulating Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
 - Ethernet Bridge Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
 - IEEE 802.1Q Encapsulation Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
 - GRE/MobileIP Encapsulation Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
 - Generic IPv4/IPv6 Tunnel Interface
</ul>

<p>
Pokud va¹e zaøízení nemáte nakonfigurované, prvním krokem je vytvoøení
souboru <strong>/etc/hostname.xxx</strong>.
Jméno zaøízení se nachází na místì xxx. V pøedcházejícím pøíkladu by by
jméno bylo <strong>/etc/hostname.ne3</strong>. Formát tohoto souboru
je jednoduchý:<br>
</p>

<blockquote><pre>
address_family va¹e_ip va¹e_sí»ová_maska [media options]
</pre></blockquote>

(Mnohem více informací o formátu tohoto souboru najdete v manuálové stránce 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>.)

<p>
Typický konfiguraèní soubor rozhraní nastaveného na IPv4 adresu bude
vypadat takto:

<blockquote><pre>
$ <strong>cat /etc/hostname.fxp0</strong>
inet 10.0.0.38 255.255.255.0 NONE
</pre></blockquote>

<p>
Mù¾ete také urèit typ Ethernetového média, tøeba kdy¾ si budete chtít
vynutit 100baseTX full-duplex mód.
</p>

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
(Samozøejmì byste si nikdy nemìli vynutit full duplex mód, pokud to
neudìlají obì strany spojení! Pokud nemáte speciální potøeby, nastavení
média by mìlo být vynecháno.)

<p> 
Nebo mù¾ete chtít nastavit speciální flagy pro urèité zaøízení. Formát
souboru hostname se pøíli¹ nezmìní!

<blockquote><pre>
$ <strong>cat /etc/hostname.vlan0</strong>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
Dal¹í krok je nastavení defaultního routeru. Provedete to tak, ¾e jeho
IP adresu umístíte do souboru s názvem <strong>/etc/mygate</strong>. Tím
umo¾níte, aby vá¹ defaultní router byl nastaven pøi startu. 
Poté byste mìli nastavit va¹e nameservery a soubor <strong>/etc/hosts</strong>
(viz manuálová stránka
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>).
Nastavení nameserverù spoèívá mj. ve vytvoøení souboru s názvem 
<strong>/etc/resolv.conf</strong>. Více informací o formátu tohoto
souboru naleznete v manuálové stránce 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a>.
Pro standardní pou¾ití zde je pøíklad takového souboru. V tomto pøíkladu
pøedpokládejme, ¾e adresy va¹ich nameserverù jsou 125.2.3.4 a 125.2.3.5. 
Patøíte rovnì¾ do domény &quot;example.com&quot;.

<blockquote><pre>
$ <strong>cat /etc/resolv.conf</strong>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre></blockquote>

<p>
Nyní mù¾ete buïto restartovat poèítaè, nebo spustit skript
<strong>/etc/netstart</strong>. Udìláte to jednodu¹e napsáním (jako
u¾ivatel root):

<blockquote><pre>
# <strong>sh /etc/netstart</strong>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre></blockquote>

<p>
V¹imnìte si, ¾e do¹lo k nìkolika chybám.  Spu¹tìním tohoto skriptu
rekonfigurujete vìci, které jsou ji¾ zkonfigurovány. Tak tøeba nìkteré
routy u¾ existovaly v routovacích tabulkách jádra.  Nyní by vá¹ systém
mìl být nastaven a mìl by fungovat. Opìt se mù¾ete pøíkazem 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
pøesvìdèit, ¾e je va¹e zaøízení nastaveno správnì. Smìrování paketù na
sí»ových rozhraních, nastavení rout mù¾ete zkontrolovat pomocí pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>
nebo <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Pokud máte problémy s routováním, pou¾ijte route(8) s volbou -n,
která zpùsobí, ¾e budou vypisovány IP adresy místo provádìní DNS
dotazù a vypsání hostname.
Zde je pøíklad, jak si obìma zpùsoby prohlédnout routovací tabulky.

<blockquote><pre>
$ <strong>netstat -rn</strong>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0 
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0 
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <strong>route show</strong>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre></blockquote>

<p>
<a name="Setup.2"></a>
<h3>6.1.2 - Nastavení OpenBSD jako routeru</h3>

<p>
Následují základní informace, které potøebujete znát, abyste mohli
nastavit va¹e OpenBSD jako router . Pokud pou¾íváte OpenBSD jako router
v síti Internet, doporuèujeme vám, abyste si pøeèetli rovnì¾ nastavení
Packet Filteru, o kterém pojednává dal¹í èást. Pomocí Packet Filteru
mù¾ete blokovat potenciálnì nebezpeèné sí»ové relace. Rovnì¾ se z dùvodu
nedostatkù IP adres na Internetu pro
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a>
mù¾ete podívat na Pøeklad sí»ových adres (Network address
translation), kde najdete informace, jak roz¹íøit vá¹ adresový prostor.
</p>

<p>
Jádro kompilované jako GENERIC má ji¾ v sobì podporu IP Forwardingu,
kterou je nutné zapnout. Mù¾ete tak uèinit pomocí pøíkazu  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>. 
Pro trvalou zmìnu byste mìli zeditovat soubor 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf</a>.
Udìláte to snadno pøidáním následující øádky do tohoto souboru.
</p>

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Chcete-li tuto zmìnu provést bez restartu stroje, mìli byste pou¾ít
pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Pamatujte si v¹ak, ¾e tato zmìna nebude trvalá, vydr¾í jen do rebootu a
také ¾e tento pøíkaz musíte spustit jako u¾ivatel root.
</p>

<blockquote><pre>
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
net.inet.ip.forwarding: 0 -&gt; 1
</pre></blockquote>

<p>
Nyní zmìòte routovací tabulky na jiných strojích. Je mnoho zpùsobù
pou¾ití OpenBSD jako router, pomocí softwaru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>,
<a href="http://www.mrtd.net">mrtd</a> a <a href="http://www.zebra.org">zebra</a>.
OpenBSD podporuje porty v ports tree zebra, gated, a mrtd.
OpenBSD podporuje mnoho sí»ových zaøízení, jako T1, HSSI, ATM, FDDI,
Ethernet a sériové PPP/SLIP zaøízení.

<p>
<a name="Setup.3"></a>
<h3>6.1.3 - Nastavení aliasù zaøízení</h3>

<p>
OpenBSD má jednoduchý mechanismus, který umo¾òuje nastavit ip aliasy na
zaøízení.  V¹e spoèívá v jednoduché editaci souboru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a>.
Tento soubor je pøeèten pøi startu systému skriptem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a>,
který je souèástí <a href="faq10.html#rc">rc startup hierarchy</a>. 
Napøíklad pøedpokládejme, ¾e u¾ivatel má zaøízení <b>dc0</b> a je na
síti 192.168.0.0.  Dal¹í podstatné informace jsou:

<ul>
<li>IP adresa pro dc0 je 192.168.0.2
<li>sí»ová maska  255.255.255.0
</ul>

<p>
Nìkolik poznámek o aliasech. V OpenBSD pou¾íváte pouze název zaøízení.
Není tady rozdíl mezi prvním aliasem nebo druhým aliasem. Narozdíl od
nìkterých operaèních systémù, OpenBSD se na nì neodkazuje jako dc0:0,
dc0:1. Pokud se odkazujete na urèitou aliasovanou IP adresu pomocí
ifconfig, nebo pøidáváte alias, ujistìte se, ¾e pí¹ete "<tt>ifconfig
interface alias</tt>" namísto  "<tt>ifconfig interface</tt>". Smazat
alias mù¾ete pomocí "<tt>ifconfig interface delete</tt>".

<p>
Pøedpokládejme, ¾e pou¾íváte více IP adres, které jsou na stejné
podsíti, a pou¾íváte k tomu aliasy. va¹e sí»ová maska pro ka¾dý alias má
automaticky hodnotu 255.255.255.255. Není nutné, aby sí»ové masky aliasù
následovaly sí»ovou masku prvního IP spojeného s tímto zaøízením. V
následujícím pøíkladì <i>/etc/hostname.dc0</i> jsou pøidány dva aliasy
pro zaøízení dc0, které mimo jiné bylo nastaveno jako 192.168.0.2
netmask 255.255.255.0.

<blockquote><pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre></blockquote>

<p>
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se
zmìny nastavení projevily. Nebo mù¾ete nastavit aliasy ruènì pomocí 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Nastavení prvního aliasu by se provedlo takto:

<blockquote><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></blockquote>

<p>
Pro prohlí¾ení tìchto aliasù je vhodný pøíkaz:

<blockquote><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></blockquote>

<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.2 - Packet Filter (PF)</h2>
Packet Filter (dále je PF) je systém pro filtrování TCP/IP provozu
a provádìní pøekladu adres (Network Address Translation) v OpenBSD.
PF je také pou¾itelný k normalizování a pomiòování TCP/IP provozu
a ke kontrole ¹íøky pásma a prioritizaci paketù. PF je souèástí
GENERIC OpenBSD kernelu od verze OpenBSD 3.0. Je popsán v nové
<a href="../pf/cs/index.html">U¾ivatelské pøíruèce PF</a>.

<p>
Staré PF FAQ je stále dostupné <a href="faq6pf.html">zde</a>.

<p>
<a name= "DHCP"></a>
<h2>6.4 - DHCP</h2>

<h3>6.4.1 DHCP Klient</h3>
<p>
Pro pou¾ívání DHCP klienta 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>
dodávaného spolu s OpenBSD, zeditujte soubor /etc/hostname.xl0 (za
pøedpokladu, ¾e va¹e hlavní ethernetové rozhraní je xl0. Mù¾ete mít jiné
rozhraní, napø. ep0 nebo fxp0 nebo jiné!) Jediné slovo, které musí tento
soubor po editaci obsahovat je 'dhcp'.

<pre>
# <strong>echo dhcp  &gt;/etc/hostname.xl0</strong>
</pre>

<p>
Tento pøíkaz zpùsobí automatické nastartovaní DHCP klienta pøi
bootování.  OpenBSD bude od DHCP serveru po¾adovat informaci o své IP
adrese, defaultním routeru a DNS serverech.

<p>
Chcete-li spou¹tìt DHCP klienta z pøíkazové øádky, ujistìte se, ¾e
existuje soubor /etc/dhclient.conf a potom vyzkou¹ejte:

<pre>
# <strong>dhclient fxp0</strong>
</pre>

<p>
kde fxp0 je rozhraní, které chcete konfigurovat pomocí DHCP.

<p>
Bez ohledu na to, jak spustíte DHCP klienta, mù¾ete zeditovat soubor
/etc/dhclient.conf , aby napø. nedo¹lo ke zmìnì v ji¾ nakonfigurovaném
DNS na základì odezvy DHCP serveru. V tomto pøípadì staèí kdy¾
odkomentujete øádku zaèínající slovem 'request' (tato øádka se nachází v
pùvodním souboru, ale potøebujete ji odkomentovat abyste docílili zmìny
v chování DHCP klienta).

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
a potom <b>odstraòte</b> slovo domain-name-servers. Samozøejmì mù¾ete
chtít odstranit i jiná nastavení jako napø. hostname.

<p>
<h3>6.4.2 DHCP Server</h3>
<p>
Pokud chcete pou¾ívat OpenBSD jako DHCP server 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>,
zeditujte /etc/rc.conf. Nastavte v nìm volbu dhcpd_flags="-q" namísto
pùvodní dhcpd_flags=NO. Nyní uveïte rozhraní, na kterých chcete, aby
<b>poslouchal</b> DHCP server, v souboru /etc/dhcpd.interfaces.

<pre>
     # <b>echo xl1 xl2 xl3  &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
Pak upravte <tt>/etc/dhcpd.conf</tt>.
Volby uvedené v tomto souboru jsou dostateènì zøejmé.

<pre>
        option  domain-name "example.com";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Takovéto nastavení øíká va¹im DHCP klientùm, ¾e doména, kterou mají
pøidávat k DNS dotazùm je xyz.mil (tedy pokud u¾ivatel napí¹e 'telnet
joe', pak ve skuteènosti se bude spojovat se strojem joe.xyz.mil).
Dále odká¾ete klienta, aby pou¾íval DNS servery 192.168.1.3 a
192.168.1.5.  Poèítaèùm na stejné síti jako je ethernetové rozhraní DHCP
serveru, je¾ je v rozsahu 192.168.1.0/24 , bude DHCP server pøiøazovat
IP adresy mezi 192.168.1.32 a 192.168.1.127. Defaultní router klientù
bude nastaven na 192.168.1.1.

<p>
Pokud chcete spou¹tìt dhcpd z pøíkazové øádky, po editaci
/etc/dhcpd.conf vyzkou¹ejte:

<pre>
     # <b>dhcpd -q fxp0</b>
</pre>

<p>
kde fxp0 je rozhraní, na kterém chcete nastartovat DHCP server. Volba -q øíká
dhcpd; aby vypisoval co nejménì informací, v opaèném pøípadì je toti¾
velmi "ukecaný".

<p>
Pou¾íváte-li DHCP server pro stroje s Windows, mù¾ete dát klientovi adresu
'WINS' serveru. Docílíte toho tímto øádkem v /etc/dhcpd.conf:

<pre>
     option  netbios-name-servers  192.168.92.55;
</pre>

<p>
(kde 192.168.92.55 je IP va¹eho Windows nebo Samba serveru.)
Více voleb pro dhcp klienty se najdete zde: 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a>.

<p>
<a name="PPP"></a>
<h2>6.5 - PPP </h2>
<p>
Point-to-Point Protokol je tím protokolem, který se dnes pou¾ívá pro spojení s
modemem va¹eho ISP. OpenBSD má dva zpùsoby jak toto spojení nakonfigurovat.

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a>
 - Jedná se o ppp démona zaèlenìného do jádra systému .
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
 - Tento ppp démon pracuje jako u¾ivatelský proces (nesystémový).
</ul>

<p>
První, který popí¹eme bude nesystémový ppp démon. Pøedtím ne¾ zaènete s
konfigurací je dobré zjistit si nìkteré údaje od va¹eho ISP. Jedná se
pøedev¹ím o:

<ul>
<li>Telefonní (dialup) èíslo va¹eho ISP
<li>vá¹ nameserver
<li>va¹e u¾ivatelské jméno a heslo
<li>vá¹ router
</ul>

<p>
Nìkteré z tìchto informací nutnì nepotøebujete, bez jiných se zase
neobejdete.  Nesystémový ppp démon pou¾ívá
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
jako svùj konfiguraèní soubor.
V adresáøi <b>/etc/ppp</b> se obecnì nachází øada souborù, které nabízejí
rùzné nastavení pro rùzné situace. Mìli byste si je prohlédnout.

<p>
Také se ujistìte, v pøípadì, ¾e pou¾íváte jádro GENERIC, ¾e máte
následující øádku ve va¹em konfiguraèním souboru:

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Úvodní nastavení - pro PPP(8)</h3>

<p>
Úvodní nastavení nesystémového démona se sestává z editace souboru
<b>/etc/ppp/ppp.conf</b>. Tento soubor defaultnì neexistuje, ale je tu
soubor <b>/etc/ppp/ppp.conf.sample</b> , který mù¾ete jednodu¹e
zeditovat a vytvoøit tak vlastní <b>ppp.conf</b> . Zde zaèneme s
nejjednodu¹¹ím a patrnì také nejèastìj¹ím nastavením. Zde je soubor
<b>ppp.conf</b>, díky kterému se ppp spojí s va¹ím ISP a nastaví
defaultní routy a nameserver. S tímto souborem potøebujete vìdìt jen
informaci o telefonním èísle va¹eho ISP, u¾ivatelském jménu a heslu.

<blockquote>
<pre>
default:
set log Phase Chat LCP IPCP CCP tun command
set device /dev/cua01
set speed 115200
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</blockquote>

<p>
Sekce uvedená slovem <b>default:</b> bude vykonána pøi ka¾dém spu¹tìní.
Zde nastavujeme v¹echny kritické informace. Slovem  &quot;set log&quot;
nastavujeme záznamovou úroveò. Je mo¾né to zmìnit; více manuálová
stránka
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>.
Sériový port se nastavuje pøíkazem &quot;set device&quot;. Toto je
zaøízení, na kterém se nachází modem. V na¹em  pøípadì je modem na portu
2. Proto com port 1 by byl /dev/cua00. Slovem  &quot;set speed&quot;
nastavujeme rychlost dialup spojení a pomocí &quot;set dial&quot;
nastavujeme parametry dialup-u. Pomocí nich mù¾eme zmìnit ná¹ timeout
atd. 

<p>
Nyní mù¾eme pokraèovat nastavením informací o na¹em ISP. Provedeme to
pøidáním nové sekce za sekci <b>default:</b> . Tato sekce se mù¾e
jmenovat jakkoliv, nejjednodu¹¹í je pou¾ít jméno va¹eho ISP. My
pou¾ijeme oznaèení <b>myisp:</b> .  Následuje krátké a jednoduché
nastavení, které poskytuje to nejnutnìj¹í pro na¹e spojení.

<blockquote>
<pre>
myisp:
set phone 1234567
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR
enable dns
</pre>
</blockquote>

<p>
Zde jsme nastavili  &quot;set phone&quot; telefonní èíslo na¹eho ISP,
&quot;set login&quot; volby pro pøihlá¹ení (timeout nastavený na 5
znamená, ¾e pøeru¹íme pokus o pøihlá¹ení po pìti sekundách není-li na
lince signál. Jinak budeme èekat na zaslání na poslání øetìzce
&quot;login:&quot; a pak po¹leme na¹e u¾ivatelské jméno a heslo. U nás
to bude username=ppp a password=ppp. Tyto hodnoty si zmìnte na va¹e
vlastní. &quot;set timeout&quot; nastavuje timeout pro celý pøihla¹ovací
proces na 120 sekund. &quot;set ifaddr&quot; je ponìkud trikové.
Vysvìtlení je zde:

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
V øádku nahoøe nastavujeme na¹i IP adresu ve formátu &quot;<b>set ifaddr
[myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]</b>&quot;. Tedy
první IP adresa na øádce specifikuje èíslo, které chceme obdr¾et od ISP
jako na¹i IP adresu. Pokud máte statickou IP adresu, nastavte ji zde. U
nás pou¾ijeme /0 , co¾ øíká, ¾e ¾ádný z bitù ip adresy nemusí odpovídat
a proto celá adresa mù¾e být nahrazena jinou (dynamicky pøiøazenou).
Druhá IP adresa je adresa, kterou oèekáváme jako IP adresu na¹eho ISP.
Pokud ji znáte, mù¾ete ji specifikovat. My opìt nevíme, co máme
oèekávat, proto pou¾ijeme opìt /0 . Tøetí èíslo je na¹e sí»ová maska,
zde nastavena na 255.255.255.0 . Pokud specifikujeme triggeraddr, je
pou¾ita namísto myaddr v pùvodní IPCP komunikaci. Pøesto, pouze adresa v
rozsahu myaddr bude akceptována. Toto je u¾iteèné pøi komunikaci s
nìkterými implementacemi PPP, které nedovolují pøiøadit IP adresu, pokud
peer ¾ádá ``0.0.0.0''.

<p>
Dal¹í volba  &quot;add default HISADDR&quot; nastavuje defaultní routu
na IP adresu providera. Dobré je, ¾e pokud se zmìní IP adresa providera
za chodu, bude va¹e routa automaticky upravena. Volbou  &quot;enable
dns&quot; øíkáme na¹emu ISP, aby nám sdìlil adresu nameserveru.
Nepøidávejte tuto volbu, pokud u vás bì¾í lokální DNS, proto¾e ppp lehce
znemo¾ní její pou¾ívání tím, ¾e pøidá nìkolik øádek do souboru
/etc/resolv.conf.

<p>
<h3>Pou¾ívání PPP(8)</h3>

<p>
Nyní máme základní nastavení v souboru <b>ppp.conf</b> pøipravené a
mù¾eme zaèít zkou¹et spojení s na¹ím ISP. Obvyklé formy pøíkazu jsou:
</p>

<ul>
<li><tt>ppp -auto myisp</tt> - Spustí ppp, nastaví rozhraní a spojí se
s na¹im isp, poté pøechází na pozadí.
<li><tt>ppp -ddial myisp</tt> - Podobné jako -auto, ale pokud konekce je
zru¹ena, pokusí se znovu o spojení.
</ul>

<p>
Spu¹tìní <b>/usr/sbin/ppp</b> bez voleb vás zavede do interaktivního
módu. V nìm mù¾ete komunikovat pøímo s modemem, co¾ je velmi vhodné
k ladìní problémù ve va¹em <b>ppp.conf</b>.

<h3>ppp(8) extra</h3>

<p>
V nìkterých situacích mù¾ete chtít spustit dodateènì nìjaké pøíkazy,
kdy¾ je vytvoøeno nebo naopak zru¹eno spojení. Jsou zde dva soubory,
které mù¾ete vytvoøit pro tyto situace. <b>/etc/ppp/ppp.linkup</b> a
<b>/etc/ppp/ppp.linkdown</b>.
Pøíklad nastavení je zde:
</p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Dal¹í informace mù¾ete najít ve 
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">FreeBSD Handbook, èást User PPP</a>.

<p>
<a name="Tuning"></a>
<h2>6.6 - Zlep¹ování výkonu sítì</h2>
<!-- XXXrelease -->

<p>
<h3>6.6.1 - Jak pøinutit jádro, aby dovolovalo vìt¹í poèet pokusù a
del¹í timeout pro TCP spojení?</h3>

<p>
Normálnì byste to mìl vyu¾ít v pøípadì smìrovacích nebo spojovacích
problémù.  Samozøejmì, nejefektivnìj¹í je, kdy¾ obì strany spojení
pou¾ívají podobné hodnoty. 

<p>
Pou¾ijte <tt>sysctl</tt> a zvìt¹ete hodnoty promìnných:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Díky sysctl -a mù¾ete vidìt souèasné hodnoty tìchto a mnoha dal¹ích parametrù.
Zmìnu provedete pomocí <tt>sysctl -w</tt> jako napø. <tt>sysctl -w
net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - Jak mohu umo¾nit directed broadcast?</h3>

<p>
Normálnì to nepotøebujete dìlat. Directed broadcast umo¾òuje komukoliv
poslat pakety na veøejnou adresu va¹í pøipojené sítì, pokud pou¾íváte
OpenBSD jako router.

<p>
V nìkterých pøípadech uzavøených sítí mù¾e být directed broadcast
u¾iteèný, zejména pøi pou¾ívání starých implementací NetBIOS protokolu.
Pou¾ijte <tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> pro tuto
vlastnost. Rovnou si ale pøeètìte také èlánek o <a
href="http://www.netscan.org">smurf útocích</a>,
pokud chcete vìdìt, proè je tato vlastnost defaultnì vypnutá.

<p>
<h3>6.6.3 - Nechci, aby kernel dynamicky alokoval urèité porty</h3>

<p>
Na tohle tu také máme jedno sysctl. 
V <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
se pí¹e:

<pre>
Nastavení rezervovaných TCP portù, které by nemìly být dynamicky
pøidìlovány jádrem. Seznam èísel tìchto portù mù¾e být oddìlen èárkami
a/nebo mezerami.

 #  <strong>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>

Je také mo¾né odstranit nebo pøidat èásti souèasného seznamu.

 #  <strong>sysctl -w net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl -w net.inet.tcp.baddynamic=-871</strong>
</pre>

<p>
<a name="NFS"></a>
<h2>6.7 - Jednoduché pou¾ití NFS</h2>

<p>
NFS, neboli Network File System, se pou¾ívá pro sdílení souborových
systémù na síti. Dobré je, kdy¾ pøed pokusem o nastavení NFS serverù si
pøeètete pár manuálových stránek:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
</ul>

<p>
Tato sekce vás provede základními kroky pro jednoduché nastavení NFS.
V pøíkladì pøedpokládejme server na LAN, s klienty pøistupujícími na NFS
na LAN. Nemluvíme zde o zabezpeèení NFS. Pøedpokládáme, ¾e jste ji¾
nastavili filtrování paketù, nebo jinou firewallovou ochranu pro
odepøení pøístupu zvenèí.  Pokud dovolujete vnìj¹í pøístup na vá¹ NFS
server a máte na nìm nìjaká citlivá data, dùraznì doporuèujeme, abyste
zprovoznil IPsec.  V opaèném pøípadì mohou cizí lidé potenciálnì vidìt
va¹e  NFS spojení. Nìkdo mù¾e také pøedstírat, ¾e má IP adresu, která
je povolená na va¹em NFS serveru. Mù¾e to vést i k nìkterým
útokùm. Pokud je IPsec protokol správnì nastaven, mù¾e vás od tohoto
typu útokù ochránit. 

<p>
Jiná podstatná bezpeènostní poznámka. Nepøidávejte filesystém do
/etc/exports bez urèitého seznamu povolených strojù. Bez seznamu strojù,
které mohou pøipojit daný adresáø, mù¾e kdokoliv, kdo má spojení s va¹ím
poèítaèem, pøipojit adresáøe, které pøes NFS exportujete.

<p>
NFS potøebuje, aby
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
bì¾el pøed tím, ne¾ zaène fungovat. Portmap(8) je nyní standardnì
vypnut na OpenBSD 3.2 a novìj¹ím, tak¾e ho musíte zapnout v
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
zmìnou øádky <tt>portmap</tt> na

<blockquote><pre>
portmap=YES
</pre></blockquote>
a rebootem, aby se to projevilo.

<p>
Nastavení obsahuje server s ip <b>10.0.0.1</b>, který slou¾í jako NFS
server pouze klientùm na této síti. První krok pøi nastavení NFS je
nastavit soubor <i>/etc/exports</i> . Tento soubor obsahuje seznam
filesystému, které chcete zpøístupnit pøes NFS a definuje, komu je
mù¾ete zpøístupnit.  V <i>/etc/exports</i> mù¾ete pou¾ít spoustu voleb a
nejlépe je pøeèíst si manuálovou stránku 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>.
My máme <i>/etc/exports</i> takovýto:

<blockquote><pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
To znamená, ¾e lokální filesystém  <b>/work</b> bude zpøístupnìn pøes
NFS.  <b>-alldirs</b> øíká, ¾e klienti budou moci pøipojit kterýkoliv
podadresáø adresáøe <b>/work</b>. <b>-ro</b> øíká, ¾e pøipojit
filesystém bude mo¾né jen pro ètení. Poslední dva argumenty øíkají, ¾e
pouze klienti v rozsahu sítì 10.0.0.0 s maskou 255.255.255.0 budu
oprávnìni pøipojit filesystém. To je dùle¾ité zejména pro sítì, které
jsou pøístupné zvenku.

<p>
Máte-li nastaven <i>/etc/exports</i>, mù¾ete pokraèovat v nastavení
NFS serveru. Nejprve se ujistìte, ¾e máte zkompilované jádro s volbami
NFSSERVER a NFSCLIENT (jádra GENERIC jsou ok).  Dále nastavte v
<i>/etc/rc.conf</i> <strong>nfs_server=YES</strong> . Tím spustíte
nfsd(8) i mountd(8) po rebootování.  Pro zaèátek mù¾ete spustit démony
ruènì. Musíte je spustit jako root a potøebujete se ujistit, ¾e vám na
systému bì¾í portmap(8). Pøíklad jak spustit nfsd(8), který pracuje jak
na TCP tak na UDP ve 4 instancích. Mìli byste nastavit maximální poèet
klientù se ¾ádostí o spojení na slu¾bu NFS.

<blockquote><pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre></blockquote>

<p>
Nestaèí pustit jen nfsd(8) server, musíte spustit i mountd(8). Jedná se
o démona, který vlastnì obsluhuje ¾ádosti o NFS spojení. Ujistìte se. ¾e
existuje prázdný soubor mountdtab, a spus»te démona: 

<blockquote><pre>
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
</pre></blockquote>

<p>
Pokud udìláte zmìny v /etc/exports poté co u¾ NFS bì¾í, musíte na to
mountd upozornit! Takhle:

<blockquote><pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre></blockquote>

<p>
<h3>Kontrola stavu NFS</h3>

<p>
Nyní se mù¾ete podívat a ujistit se, ¾e démoni bì¾í a jsou registrováni
s RPC.  Pou¾ijte procinfo(8).

<blockquote><pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
V normálním provozu máte k dispozici dal¹í utility, které vám
dovolují sledovat co se dìje na NFS. Jedna z nich je 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>,
která umo¾òuje sledovat co je právì pøipojeno a kdo to pøipojil. Dále
také nfsstat(8) s podrobnìj¹ím výpisem. Pou¾ití pøíkazu showmount(8):
zkuste <tt>/usr/bin/showmount -a host</tt>. Napøíklad:

<p>

<blockquote><pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>Pøipojení NFS filesystému</h3>

<p>
NFS filesystém by mìl být pøipojen pomocí pøíkazu mount(8), nebo konkrétnìji 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
Pro pøipojení filesystému /work na stroji 10.0.0.1 na lokální filesystém
/mnt, udìlejte toto: (pozn. nepotøebujete pou¾ívat ip adresy, mount
pøekládá jména):

<blockquote><pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre></blockquote>

<p>
Pøipojení systému pøi bootu:
pøidejte do <i>/etc/fstab</i>:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
Je dùle¾ité pou¾ít <tt>0 0</tt> na konci øádky, jinak bude vá¹ poèítaè
pou¹tìt fsck na NFS filesystém pøi startu!!!!  Jiné standardní security
volby jsou noexec, nodev, a nosuid - ta poslední by mìla být pou¾ita,
kde jen to je mo¾né.
Napø.:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
Díky tomu nebudou moci ¾ádné suid bit binárky na NFS serveru podlomit
bezpeènost na NFS klientovi. Pokud nepøipojujete programy, které by mìly
bì¾et na klientovi, pøidejte noexec.

<p>
<a name="PPTP"></a>
<h2>6.9 - Nastavení PPTP spojení v OpenBSD</h2>

<p>
<strong>POZNÁMKA:</strong> Informace se nevztahují ke
<strong>V©EM</strong> ADSL providerùm, ale mnoho informací mù¾e být
pøevzato z tohoto nastavení. O nìm je známo, ¾e funguje pro ADS
providera v Rakousku <a href="http://www.inode.at">Inode</a>.

<p>
Pro zaèátek potøebujete nainstalovat pptp.  Port se nachází v
<i>/usr/ports/net/pptp</i>. Pøeètìte si <a href="faq8.html#Ports">FAQ 8,
Ports</a> pro více informací o OpenBSD ports tree.

<p>
V dùsledku konfliktu pptp s podporou 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;apropos=0&amp;sektion=0">gre(4)</a>
v jádøe budete nutné pøekompilovat jádro a odstranit podporu pro gre(4).

<blockquote>Patch pro odstranìní GRE(4) podpory.
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@ -87,7 +87,7 @@               
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre></blockquote>

<p>
Pro pøekompilování jádra proveïte checkout  OpenBSD source tree pomocí cvs 
(podívejte se na webovou stránku <a href="../../cs/anoncvs.html">AnonCVS</a>
pro dal¹í informace), aplikujte pøedcházející patch a pøekompilujete kernel
podle <a href="faq5.html#Building">FAQ 5, Kompilace kernelu</a>.

<p>
Poté co nainstalujete balík <b>pptp</b> a nové jádro, potøebujete zeditovat
soubory pro nastavení spojení. Tento balík pou¾ívá do OpenBSD zakomponované
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;apropos=0&amp;sektion=0">ppp(8)</a>,
tak¾e pokud se v nìm vyznáte, pak velká èást nastavení vypadá stejnì. Rovnì¾
se podívejte na <a href="#PPP">FAQ 6, PPP</a>.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Soubor <i>/etc/ppp/options</i> s následujícím nastavením bude dìlat
pravdìpodobnì co potøebujete:

<blockquote><pre>
# <strong>cat /etc/ppp/options</strong>
name "LOGINNAME"
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
<tt>LOGINNAME</tt> Mìlo by být nahrazeno va¹ím User-ID.

<p>
V  <i>/etc/ppp/pap-secrets</i> øádek:

<blockquote><pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
Kde LOGINNAME je va¹e User-ID a PASSWORD je va¹e heslo. 10.0.0.138 je IP
pøiøazené va¹emu MODEMu v pøípadì ¾e pou¾íváte ADSL, atd. Ujistìte se,
¾e soubor mù¾e èíst pouze u¾ivatel root (mód 600).

<p>
<h3>6.9.1 - Pøiøazení adresy sí»ovému rozhraní</h3>

<p>
V pøedcházejícím pøípadì mìl ná¹ modem pøedkonfigurované rozhraní na
10.0.0.138.  Nyní potøebujeme pøiøadit adresu  NA©EMU rozhraní. Nejlépe
je vybrat si jedno IP blízko tomu, které vám bylo pøiøazeno va¹ím
modemem, nebo pou¾ít statické IP, které vám pøiøadili. Více si pøeètìte
v <a href="#Setup">FAQ 6, Úvodní nastavení sítì</a>.

<p>
Poté co nastavíte rozhraní, mìli byste být schopni vytvoøit pptp
spojení pøíkazem.

<blockquote><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre></blockquote>

<p>
Proto¾e pou¾íváme do OpenBSD zaèlenìné ppp(8), jsou nastartovány dva
procesy. Mù¾ete zastavit pptp ukonèením obou procesù:

<blockquote><pre>
# <strong>kill -9 [pid of pppd]</strong>
$ <strong>kill -9 [pid of pptp]</strong>
</pre></blockquote>

Doporuèujeme otevøít si  <tt>/var/log/messages</tt> v oddìleném
terminálovém oknì, abyste rozpoznali mo¾né problémy.

<blockquote>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre></blockquote>
</p>

<p>
Rovnì¾ si pøidejte startovací pøíkaz do <i>/etc/rc.local</i>, abyste se
mohli automaticky spojit pøi restartu.

<p>
<a name= "Bridge"></a>
<h2>6.10 - Nastavení bridge s OpenBSD</h2>

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">Bridge</a>
je spojení mezi dvìma nebo více oddìlenými sítìmi. Narozdíl od routeru
prochází pakety bridgem "neviditelnì" -- dva sí»ové segmenty se logicky
tváøí jako jeden segment pro uzly na obou stranách bridge. Bridge
forwarduje jenom pakety, které mají projít z jednoho segmentu do druhého,
tak¾e mimo jiné pøedstavuje jednoduchý zpùsob jak sní¾it provoz 
v komplexních sítích a pøitom umo¾nit libovolnému uzlu pøístup 
k ostatním, kdy¾ je zapotøebí.

<p>
V¹imnìte si, ¾e kvùli své "neviditelné" povaze mù¾e i nemusí mít
rozhraní bridge svou IP adresu. Pokud ji má, pracuje rozhraní vlastnì ve
dvou módech, jednak jako èást bridge, jednak jako standardní sí»ový
adaptér. Pokud ¾ádné rozhraní nemá IP adresu, bridge bude propou¹tìt
sí»ová data, ale nebude externì udr¾ovatelný (co¾ mù¾e být výhoda).

<p>
<h3>Pøíklad aplikace bridge</h3>
V jednom z mých rackù je nìkolik star¹ích systémù, z nich¾ ¾ádný nemá
integrovaný 10BASE-TX NIC. Vzhledem k tomu, ¾e v¹echny mají AUI nebo
AAUI konektory, mù¾u pou¾ít jenom koaxiální transceivery. Jedna z ma¹in
v tomto racku je OpenBSD terminálový server, který stále bì¾í a je
pøipojen k vysokorychlostní síti. Pøidání druhé sí»ové karty s
koaxiálním portem mi umo¾ní pou¾ít tento stroj jako bridge do koaxiální
sítì.

<p>
Systém má nyní dvì sí»ové karty, Intel EtherExpress/100
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
a 3c590-Combo
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
s koaxiálním portem. <tt>fxp0</tt> je spojení do zbytku mojí sítì a
proto bude mít IP adresu, <tt>ep0</tt> bude slou¾it jenom k bridgování a
nebude mít IP adresu. Poèítaèe v koaxiálním segmentu budou komunikovat
tak, jako by byly ve zbytku mojí sítì. Tak¾e, jak to udìláme?

<p>
Soubor <tt>hostname.fxp0</tt> obsahuje konfiguraci karty <tt>fxp0</tt>.
Tento stroj je nastavován pøes DHCP, tak¾e soubor vypadá takhle:

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre>
</blockquote>

<p>
®ádné pøekvapení.

<p>
Karta <tt>ep0</tt> je trochu jinak, jak jste asi uhodli:
<blockquote>
<pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre>
</blockquote>

<p>
Tady øíkáme systému, aby aktivoval toto rozhraní pøes 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
a nastavil ho na 10BASE-2 (koax). ®ádnou IP adresa nebo podobné informace
nemusíme pro toto rozhraní specifikovat. Volby, které karta <tt>ep</tt>
umo¾òuje, jsou detailnì popsány v její
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">manuálové stránce</a>.

<p>
Teï potøebujeme nastavit bridge. Bridge jsou inicializovány pøítomností
souboru pojmenované nìjak jako
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">
<tt>bridgename.bridge0</tt></a>.
Tady je pøíklad pro mojí situaci:

<blockquote>
<pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre>
</blockquote>

<p>
Toto øíká: nastav bridge skládající se ze dvou karet, fxp0 a ep0,
a aktivuj ho. Zále¾í na poøadí, ve kterém jsou karty uvedeny? Ne,
vzpomeòte si, ¾e bridge je velmi symetrický -- pakety chodí sem a tam
obìma smìry.

<p>
A je to! Reboot, a máte funkèní bridge.

<p>
<h3>Filtrování na bridge</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->

I kdy¾ urèitì existuje vyu¾ití pro takhle jednoduché bridge, je mo¾né,
¾e budete chtít s pakety nìco DÌLAT, kdy¾ procházejí bridgem. Jak se
dalo èekat, k omezení, který provoz pùjde skrz bridge, mù¾e být pou¾it
<a href="#PF">Packet Filter</a>.

<p>
Uvìdomte si, ¾e, z podstaty bridge, stejná data prochází obìma
rozhraními, tak¾e potøebuje filtrovat pouze na jednom z nich. Va¹e
defaultní pravidla "Pass all" by vypadala nìjak takhle:

<blockquote>
<pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre>
</blockquote>

<p>
Nyní øeknìme, ¾e chci filtrovat provoz zasahující moje staré stroje.
Chci, aby se k nim dostal jenom Web a SSH. V tomto pøípadì povolíme
v¹echen provoz dovnitø a ven rozhraní ep0, ale budeme filtrovat na
rozhraní fxp0 s vyu¾itím keep state pro data odpovìdí:

<blockquote>
<pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre>
</blockquote>

<p>
V¹imnìte si, ¾e tato sada pravidel zabráním v¹emu kromì HTTP a SSH
spojení dosáhnout samotného bridge nebo kterékoliv ma¹iny "za" ním.
Jiných výsledkù je mo¾né dosáhnout filtrováním na druhém rozhraní.

<p>
K monitorování a kontrole bridge, který jste vytvoøili, pou¾ijte pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>,
který je také mo¾no pou¾ít k vytvoøení bridge po bootu.

<p>
<h3>Tipy k bridgování</h3>

<ul>
<li>Je VELMI doporuèováno, abyste filtrovali pouze na jednom rozhraní.
Je sice mo¾né filtrovat na obou, ale musíte to rozumìt opravdu dobøe,
abyste to udìlali správnì.

<li>Pou¾itím volby <i>blocknonip</i> pro
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
nebo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
mù¾ete zabránit ne-IP provozu (jako je IPX nebo NETBEUI) v proklouznutí
va¹imy filtry. To mù¾e být v nìkterých situacích dùle¾ité, ale uvìdomte
si, ¾e bridge funguje v¹echny typy provozu, nejen IP.

<li>Bridging vy¾aduje, aby byly sí»ové karty v "Promiskuitním re¾imu" --
poslouchají V©ECHEN sí»ový provoz, nejen ten, urèený pro dané rozhraní.
Tím dojde k vìt¹ímu zatí¾ení procesoru a sbìrnice ne¾ by èlovìk èekal.
Nìkteré karty v tomto re¾imu nefungují dobøe, TI ThunderLAN chipy
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
jsou pøíkladem chipu, který nebude fungovat jako èást bridge.
</ul>


<p>
<font color= "#0000e0">
<a href="index.html">[FAQ index]</a>
<a href="faq5.html">[Do sekce 5.0 - Nastavení jádra]</a>
<a href="faq7.html">[Do sekce 7.0 - Keyboard controls]</a>
</font>

<p>
<hr>
<a href="index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq6.html,v 1.178 ]
<br>
$Translation: faq6.html,v 1.17 2003/11/02 21:49:28 certik Exp $
<br>
$OpenBSD: faq6.html,v 1.17 2003/11/03 14:19:31 horacio Exp $
</small>

</body>
</html>
