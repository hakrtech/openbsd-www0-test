<html>
<head>
<title>5.0 - Configuración del Núcleo</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 1998-2000 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238E">

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<h2><font color="#e00000">5.0 - Configuración del Núcleo del Sistema 
(``Kernel'')</font><hr></h2>
</p>

<p>
<ul><h3>Tabla de Contenidos</h3>
<li><a href="faq5.html#5.1">5.1 - ¿Para Qué Necesita un Núcleo 
    Personalizado?</a></li>
<li><a href="faq5.html#5.2">5.2 - Opciones de Configuración del Núcleo</a></li>
<li><a href="faq5.html#5.3">5.3 - Compilación del Núcleo</a></li>
<li><a href="faq5.html#5.4">5.4 - Configuración para el Arranque</a></li>
<li><a href="faq5.html#5.5">5.5 - Obtener una Salida con Más Información
    durante el Arranque</a></li>
<li><a href="faq5.html#5.6">5.6 - Usar config(8) para Cambiar el Binario del
    Núcleo</a>
</ul>
</p>

<hr>
<br>

<p>
<a name="5.1"></a>
<h2>5.1 - ¿Para Qué Necesita un Núcleo Personalizado?</h2>
</p>

<p>
Existen varias razones, aunque esta práctica, por regla general, está
dirigida hacia usuarios expertos con un conocimiento amplio y profundo del
sistema.

<ul>
   <li>Si su máquina dispone de una pequeña cantidad de memoria de RAM, y
       quiere preservar tanta como le sea posible eliminando dispositivos de
       control que no son útiles para Vd.
   <li>Si quiere eliminar opciones predefinidas o añadir otras opciones que
       no vengan activadas por definición.
   <li>Si desea activar opciones experimentales (como puedan ser TCP_SACK, 
       TCP_FACK, FFS_SOFTUPDATES)
</ul>
</p>

<p>
En la mayor parte de los casos NO es necesario compilar un nuevo núcleo.
El núcleo GENERIC que se instala por definición es todo lo que necesitará.
De hecho, existen varias razones para no crear un nuevo núcleo.
La prinicipal razón es la facilidad para aplicar cambios que parezcan
lógicos pero que no funcionen, a la configuración del núcleo.
Si algo no funciona correctamente, por favor pruebe con el núcleo GENERIC 
antes de enviar un informe sobre el error.
</p>

<p>
<a name="5.2"></a>
<h2>5.2 - Opciones de Configuración del Núcleo</h2>
</p>

<p>
Las Opciones de Configuración del Núcleo son opciones que pueden ser añadidas
a la configuración del núcleo y que implementan varias funcionalidades en
éste.
Esto le permite tener el tipo de soporte exacto que desea, sin que tenga que
mantener el soporte para dispositivos que no son necesarios o de los que no
dispone.
Existe una gran cantidad de opciones que le permiten personalizar su núcleo.
En este documento veremos sólo unas cuantas, aquéllas que se usan con más
frecuencia.
Si quiere ver una lista más completa de opciones, mire la página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>.
También puede verificar los ficheros de configuración de ejemplo que estén
disponibles para su arquitectura.
</p>

<p>
La compatibilidad entre distintas opciones no ha sido comprobada para todas
las opciones del núcleo.
¡No añada una opción en su núcleo a menos que tenga una buena razón para
hacerlo!
La configuración del núcleo que más comprobaciones tiene es la del núcleo
GENERIC.
Generalmente este núcleo es una combinación de las opciones en
/usr/src/sys/arch/&lt;su_arquitectura&gt;/conf/GENERIC y
/usr/src/sys/conf/GENERIC.
</p>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Ficheros de Configuración del Núcleo para alpha</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Ficheros de Configuración del Núcleo para i386</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/">Ficheros de Configuración del Núcleo para mac68k</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/">Ficheros de Configuración del Núcleo para pmax</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Ficheros de Configuración del Núcleo para sparc</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Ficheros de Configuración del Núcleo para Otras Arquitecturas</a></li>
</ul>
</p>

<p>
Mire esos ficheros con atención y podrá ver una línea como la siguiente:<br>
<strong>include "../../../conf/GENERIC"</strong><br>
Esto significa que <i>hace referencia</i> a otro fichero de configuración.
Este fichero almacena opciones que no dependen de ninguna arquitectura, por
lo que al crear su fichero de configuración del núcleo debe asegurarse de que
mira en
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a> y ver qué es lo que quiere.
ALGUNAS de las opciones que ahí se encuentran son NECESARIAS.
</p>

<p>
Todas las opciones que aparecen en la lista más abajo deberían incluirse en
el fichero de configuración de su núcleo, en el siguiente formato:<br>
<strong>option      OPTION</strong><br>
Por ejemplo, para incluir la opción debug en el núcleo, añada una línea como
ésta:<br>
<strong>option	    DEBUG</strong><br>
Las opciones del núcleo de OpenBSD se traducen en opciones de preprocesador
del compilador, por tanto una opción como DEBUG tendría los fuentes
compilados con la opción -DDEBUG.
Esto es equivalente a hacer un #define DEBUG en todo el núcleo.
</p>

<p>
OpenBSD dispone de varias opciones de compatibilidad muy útiles que le
permitirán usar binarios de otros sistemas operativos.
No todas se encuentran disponibles para cada arquitectura, por lo que debe 
leer las páginas de manual para cada opción para comprobar si está soportada 
en su arquitectura.
</p>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SVR4(8)</a> - Compatibilidad con binarios de SVR4.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_BSDOS(8)</a> - Compatibilidad con binarios de BSD/OS.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_LINUX(8)</a> - Compatibilidad con binarios de Linux.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SUNOS(8)</a> - Compatibilidad con binarios de SunOS.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_ULTRIX(8)</a> - Compatibilidad con binarios de Ultrix.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_FREEBSD(8)</a> - Compatibilidad con binarios de FreeBSD.</li>
<li>COMPAT_HPUX - Compatibilidad con binarios de HP-UX.
    Disponible sólo en algunas arquitecturas m68k.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_IBCS2(8)</a> - Compatibilidad con binarios de ibcs2.</li>
<li>COMPAT_OSF1 - Compatibilidad con binarios de Digital Unix.
    Disponible sólo en la plataforma Alpha.</li>
<li>COMPAT_43 - Compatibilidad con 4.3BSD.
    No se aconseja su uso, aunque es necesario para nuestro porte de
    Navigator.</li>
<li>COMPAT_11 - Compatibilidad con NetBSD 1.1</li>
<li>COMPAT_NOMID - Compatibilidad con ejecutables a.out sin identificador de
    máquina.
</ul>
</p>

<p>
Poder depurar problemas en el núcleo del sistema es siempre de gran ayuda,
pero muchos usuarios no añaden estas opciones en  sus núcleos porque agrandan
el tamaño del núcleo.
Sin embargo, estas opciones son extremadamente útiles para casos en los que
pudiera existir un error de programación.
De este modo ayudaría a los desarrolladores a descubrir la fuente de sus
problemas de un modo mucho más rápido.
En la siguiente lista aparecen opciones de depurado bien conocidas que puede
añadir a su núcleo.
</p>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html">DDB</a> - Compila el depurador integrado del núcleo.
    Esta opción no está disponible en todas las plataformas, así que
    asegúrese antes de añadirla.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html">KGDB</a> - Compila un depurador remoto del núcleo que usa la funcionalidad &quot;remote target&quot; de gdb.</li>
<li>makeoptions  DEBUG="-g" - Compila bsd.gdb junto con bsd.
    Esta opción es útil para depurar volcados de caídas del sistema con gdb.
    NOTA: Esta opción también activa <strong>option DEBUG</strong>.</li>
<li>DEBUG - Se usa para poner varias opciones de depurado del núcleo donde el
    código fuente las tiene definidas.</li>
<li>KTRACE - Añade gancho para facilitar la búsqueda de llamadas del sistema.
    Esta opción permite al usuario la utilización de
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html">ktrace(1)</a>.</li>
<li>DIAGNOSTIC - Añade al núcleo código que lleva a cabo comprobaciones de
    consistencia internas.</li>
<li>GPROF - Añade al núcleo código para la perfilación del núcleo con
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html">kgmon(8)</a>.</li>
<li>makeoptions PROF="-pg" - El indicador -pg hace que el núcleo se compile
    con soporte para la perfilación.
    Se require la opción GPROF para poder usar esta opción.</li>
</ul>
</p>

<p>
<strong>Opciones para el Sistema de Archivos:</strong>
<ul>
<li>FFS - Berkeley Fast Filesystem. <strong>NOTA:</strong> Esta opción es
    obligatoria.</li>
<li>EXT2FS - Second Extended File System. Necesario para poder leer
    particiones de Linux.</li>
<li>MFS - Memory File System. Almacena ficheros en memoria de swap.</li>
<li>NFS - Network File System. Necesario para usar NFS.</li>
<li>CD9660 - iso9660 + rockridge filesystem. Requerido para la lectura de
    CDs.</li>
<li>MSDOSFS - Necesario para leer sistemas de archivos MS-DOS FAT. También
    contiene soporte para nombre largos de Windows 95 + extensiones de caso
    mixto.</li>
<li>FDESC - Include el código para un sistema de archivos que se puede montar
    en /dev/fd</li>
<li>KERNFS - Incluye código que permite montar un sistema de archivos
    especial (generalmente montado en /kern), en el que se pueden encontrar
    ficheros que representan varias variables y parámetros del núcleo.</li>
<li>NULLFS - Incluye el código para un sistema de archivos de
    &quot;loopback&quot;. Puede ver más información en
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html">mount_null(8)</a>.</li>
<li>PROCFS - Incluye código para un sistema de archivos especial (que se
    suele montar en /proc).</li>
<li>PORTAL - Incluye el sistema de archivos (experimental) portal. Este
    sistema permite la utilización de trucos interesantes, como abrir sockets
    TCP al abrir ficheros en el sistema archivos.</li>
<li>UMAPFS - Incluye un sistema de archivos de &quot;loopback&quot; en el que
    los identificadores de usuario y grupo se pueden reasignar. Esto puede
    ser útil cuando se monten sistemas de archivos extraños con uids y gids
    diferentes al del sistema local (v.g. NFS remoto).</li>
<li>UNION - Incluye código para el sistema de archivos &quot;union&quot;, que
    permite montar unos directorios sobre otros, de tal modo que ambos
    sistemas de archivos sean visibles. Este código todavía es bastante
    inestable.</li>
<li>XFS - Añade ganchos para que se pueda usar un sistema de archivos que es
    compatible con el sistema de archivos AFS. Actualmente lo usa el código
    Arla/AFS.</li>
<li>LFS - Log Structured Filesystem.</li>
<li>FFS_SOFTUPDATES - Permite el uso de &quot;softupdates&quot;. Puede
    obtener información sobre esto en la <a href="../faq14.html#14.5">sección 
    sobre &quot;softupdates&quot;</a> de las Preguntas Frecuentes.</li>
<li>NFSSERVER - Permite la inclusión del código de NFS para servidores en el 
    núcleo.</li>
<li>NFSCLIENT - Permite la inclusión del código de NFS para clientes en el
    núcleo.</li>
<li>FIFO - Soporte para FIFOs - RECOMENDADO.</li>
<li>NVNODE=integer - En donde &quot;integer&quot; es el tamaño del caché
    usado por las rutinas de traducción de nombre a i-nodo (conocidas como
    caché namei(), aunque también tienen otros nombres en el código fuente
    del núcleo).</li>
<li>EXT2FS_SYSTEM_FLAG - Esta opción cambia el comportamiento de los
    indicadores APPEND y IMMUTABLE por un fichero en un sistema de archivos
    EXT2FS. Más detalles en
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a>.</li>
<li>QUOTA - Soporte para el sistema de archivos &quot;Quota&quot;. La
    información sobre como usar &quot;quotas&quot; la puede obtener en el
    <a href="faq10.html#10.10">capítulo 10</a> de las Preguntas
    Frecuentes.</li>
</ul>
</p>

<p>
<strong>Opciones Misceláneas:</strong>

<ul>
<li>PCIVERBOSE - Incrementa la verbosidad durante el inicio del sistema sobre
    periféricos PCI.</li>
<li>EISAVERBOSE - Incrementa la verbosidad durante el inicio del sistema
    sobre periféricos EISA.</li>
<li>PCMCIAVERBOSE - Incrementa la verbosidad durante el inicio del sistema
    sobre periféricos PCMCIA.</li>
<li>APERTURE - Soporte integrado en el núcleo para la memoria de 
    almacenamiento intermedio de imágenes VGA por medio de procesos de
    usuario. Necesaria para que funcione X.</li>
<li>XSERVER - Soporte para el controlador de consola del servidor de X.
    Necesaria para X.</li>
<li>LKM - Soporte para Módulos Cargables en el Núcleo. No está disponible en
    todas las arquitecturas. Para más información lea
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html">lkm(4)</a>.</li>
<li>INSECURE - Rebaja el nivel de seguridad del núcleo a -1. Más información
    sobre niveles de seguridad del núcleo en
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a>.</li>
<li>MACHINE_NONCONTIG - Cambia parte de la interfaz VM/pmap para permitir el
    uso de memoria no contigua.</li>
<li>RAM_DISK_HOOKS - Permite que se pueda llamar algunas funciones
    dependientes de la máquina cuando el controlador del disco de ram
    (&quot;ramdisk&quot;) está configurado.</li>
<li>RAM_DISK_IS_ROOT - Forzar root como disco de ram.</li>
<li>CCDNBUF=integer - Configurar el número de memorias intermedias
    (&quot;buffers&quot;) usadas por
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html">CCD(4)</a>. Más información en la
    <a href="faq11.html#11.2">sección sobre E/S del disco</a> del capítulo
    &laquo;Afinar el Rendimiento&raquo; de las Preguntas Frecuentes.</li>
<li>KMEMSTATS - Esto hace que el asignador de memoria del núcleo, malloc(9),
    guarde datos estadísticos sobre su uso. Si se usa la opción DEBUG, config
    desactivará esta opción automáticamente.</li>
<li>BOOT_CONFIG - Soporte para la opción de arranque -c.</li>
</ul>
</p>

<p>
<strong>Opciones de Redes</strong><br>

Mire también el <a href="faq6.html">capítulo &laquo;Redes&raquo;</a> o la
<a href="faq11.html#11.1">sección sobre redes</a> del capítulo &laquo;Afinar
el Rendimiento&raquo; de las Preguntas Frecuentes.

<ul>
<li>GATEWAY - Permite el uso de IPFORWARDING y, en la mayoría de puertos,
    incrementa el tamaño de NMBCLUSTERS.</li>
<li>NMBCLUSTERS=integer - Controla el tamaño del mapa de clusters mbuf.</li>
<li>IPFORWARDING - Activa el comportamiento de enrutamiento IP. Con esta
    opción activada, la máquina enviará datagramas de IP entre sus
    interfaces, que estén destinados a otras máquinas.</li>
<li>MROUTING - Incluye soporte para enrutadores multicast IP.</li>
<li>INET - Incluye soporte para el protocolo TCP/IP. REQUERIDA.</li>
<li>MCLSHIFT=value - Esta opción es el logaritmo en base 2 del tamaño de los
    clusters mbuf. Para más información sobre esta opción, lea
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a>.</li>
<li>NS - Incluye soporte para el protocolo XNS de Xerox. Más información en
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current">ns(4)</a>.</li>
<li>ISO,TPIP - Incluye soporte para el ubicuo protocolo OSI. Más información
    en <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html">iso(4)</a>.</li>
<li>EON - Incluye soporte para &quot;tunneling&quot; OSI sobre IP.</li>
<li>CCITT,LLC,HDLC - Incluye soporte para el protocolo X.25.</li>
<li>IPX, IPXIP - Incluye soporte para el protocolo &laquo;Intercambio de
    Paquetes por Redes en Internet&raquo; (IPX), muy usado por Novell
    Netware.</li>
<li>NETATALK - Incluye soporte en el núcleo para la familia de protocolos
    AppleTalk.</li>
<li>TCP_COMPAT_42 - Se desaconseja encarecidamente el uso de esta opción.
    Error de compatibilidad con 4.2BSD. En 4.2BSD, los números de secuencia
    de TCP eran valores firmados de 32 bits. Las implementaciones modernas de
    TCP usan valores no firmados.</li>
<li>TCP_NEWRENO - Activa la fase de recuperación rápida NewReno, que permite
    recuperar un segemento perdido por cada viaje completo.</li>
<li>TCP_SACK - Activa reconocimientos selectivos.</li>
<li>TCP_FACK - Activa el envío de reconocimientos que permiten estimar con
    más precisión datos destacados durante la fase de recuperación rápida,
    usando información SACK. Esta opción se puede usar junto con
    TCP_SACK.</li>
<li>IPFILTER - Esta opción permite el uso de filtros IP a nivel de paquete,
    por medio del paquete ipfilter.</li>
<li>IPFILTER_LOG - Esta opción, en conjunción con IPFILTER, permite el
    ingreso de paquetes IP por medio de ip-filter.</li>
<li>IPFILTER_DEFAULT_BLOCK - Esta opción configura la política por definición
    de ip-filter. Si está activada, el comportamiento predefinido de
    ip-filter será el de bloquear los paquetes.</li>
<li>PPP_FILTER - Esta opción activa el filtrado basado en
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html">pcap(3)</a>
    para conexiones ppp.</li>
<li>PPP_BSDCOMP - Compresión BSD para PPP.</li>
<li>PPP_DEFLATE - Usado en conjunción con PPP_BSDCOMP.</li>
<li>IPSEC - Esta opción activa el soporte para el protocolo de seguridad de
    IP. Para una información más detallada, vea
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a>.
    Esto implica la opción KEY, que da soporte a PFKEYv2.</li>
<li>ENCDEBUG - Esta opción permite que la información de depurado aparezca
    de modo condicional en caso de que IPSEC se encuentre con errores.</li>
<li>TCP_SIGNATURE - Firmas TCP MD5, para sesiones de enrutamiento BGP.</li>
</ul>
</p>

<p>
<strong>Opciones para PCVT</strong> (<i>sólo válidas en la arquitectura i386</i>)

<ul>
<li>PCVT_NSCREENS=integer - Número de pantallas pcvt.  Ocho por
    definición.</li>
<li>PCVT_VT220KEYB - Si se activa, se generará una composición de teclado
    parecida a la DEC VT200 (TM).</li>
<li>PCVT_SCREENSAVER - Activa la funcionalidad del salvapantallas integrado. 
    Su funcionamiento estará activado por definición.</li>
<li>PCVT_PRETTYSCRNS - Si se activa usará un destello como salvapantallas. Su
    funcionamiento estará desactivado por definición.</li>
<li>PCVT_CTRL_ALT_DEL - Si está activada, la combinación de teclado
    &lt;Ctrl&gt; &lt;Alt&gt; &lt;Del&gt; invocará un reinicio de la CPU.
    Desactivada por definición.</li>
<li>PCVT_USEKBDSEC - NO permitir la anulación de un bloqueo de seguridad para
    el teclado. Activado por definición.</li>
<li>PCVT_24LINESDEF - Si está activada, el modo de 25 líneas (emulación VT
    con 25 líneas y emulación HP con 28 líneas) será de 24 líneas por
    defecto, sólo para ofrecer una mejor compatibilidad con el DEV VT220 (TM)
    original.</li>
<li>PCVT_EMU_MOUSE - Emular un ratón de tres botones mediante el teclado
    numérico. Útil para notebooks con XFree86. Desactivada por
    definición.</li>
<li>PCVT_META_ESC - Si está activada, se emitirá una secuencia de teclado 
    compuesta por &lt;esc&gt; y seguida por el código normal de tecla, si se
    pulsa una tecla con el modificador &lt;Alt&gt;. Si está desactivada, se
    enviará un código de tecla normal con el valor 0x80 añadido. Desactivada
    por definición.</li>
</ul>
</p>

<p>
<strong>Opciones del Subsistema SCSI</strong>

<ul>
<li>SCSITERSE - Errores de mensaje SCSI más escuetos. Omite la tabla de
    información de descodificación ASC/ASCQ, ahorrando aproximadamente unos 8
    bytes.</li>
<li>SCSIDEBUG - Muestra en consola información extra sobre depurado del
    subsistema SCSI.</li>
</ul>
</p>


<p> <a name="5.3"></a>
<h2>5.3 - Compilación del Núcleo</h2>
</p>

<p>
La página de manual <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html">afterboot(8)</a>
contiene instrucciones completas sobre cómo crear un núcleo personalizado.
</p>

<p>
Para compilar su propio núcleo desde el cdrom, antes que nada necesita
disponer del código fuente.
Sólo necesita los fuentes de núcleo para la compilación de éste, y los podrá
encontrar en el CD.
A continuación puede ver un ejemplo de cómo copiar los fuentes desde el CD.
En este ejemplo se asume que el CD 1 está montado en /mnt.
</p>

<ul>
<pre>
# <strong>mkdir -p /usr/src/sys</strong>
# <strong>cd /mnt/sys</strong>
# <strong>tar cf - . | ( cd /usr/src/sys; tar xvf - )</strong>
</pre>
</ul>

<p>
Para crear su propio núcleo es más fácil comenzar con el núcelo GENERIC.
Éste se encuentra ubicado en <i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>,
en donde ${arch} es la arquitectura de su máquina.
En es directorio también puede encontrar otros ejemplos de configuraciones.
Aquí mostraremos dos ejemplos de cómo compilar su núcleo.
En el primer ejemplo se compilará el núcleo en un árbol de fuentes con
permisos de sólo lectura.
En el segundo, en un árbol de fuentes con permisos para escritura.
</p>

<ul> 
<pre>
# <strong>cd /directorio</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/FICHERO .</strong>
# <strong>vi FICHERO</strong> (para hacer los cambios que desee)
# <strong>config -s /usr/src/sys -b . FICHERO</strong>
<ul>
# <strong>make depend</strong> 

<ul>
(el paso anterior será necesario cuando haya efectuado algún cambio 
[incluidos actualizaciones y parches] sobre su árbol de fuentes del núcleo.
Este paso se puede saltar si sigue el paso siguiente)
</ul>

<font size="+1">
<b><i>Ó</i></b>
</font>
# <strong>make clean</strong>

<ul>
(este paso es necesario si ha efectuado algún cambio en las opciones de
configuración de su núcleo, y también se recomienda si lleva a cabo alguna
actualización importante en su árbol de fuentes.  Si no es así, puede ignorar
este paso y simplemente usar 'make depend')
</ul>

</ul>
# <strong>make</strong>
</pre>
</ul>

<p>
Para compilar un núcleo desde un árbol de fuentes con permisos de escritura,
siga los pasos que vienen a continuación:
</p>

<ul>
<pre>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi FICHERO</strong> (para hacer cualquier cambio que desee)
# <strong>config FICHERO</strong> (lea más sobre esto en <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html">config(8)</a>)
# <strong>cd ../compile/FICHERO</strong>
# <strong>make</strong> 
</pre>
</ul>

<p>
En donde $ARCH es la arquitectura de su máquina (v.g. i386).
También puede ejecutar <strong>make depend</strong> para compilar las
dependencias para la próxima vez que compile su núcleo.
</p>

<p>
Para copiar su núcleo a su directorio.
</p>

<ul>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/FICHERO/bsd /bsd</strong>
</pre>
</ul>

<p>
Para volver a su viejo núcleo durante el arranque, sólo debe hacer
</p>

<ul>
<pre>
boot&gt; <strong>bsd.old</strong>
</pre>
</ul>

<p>
y cargará su viejo núcleo en lugar de /bsd.
</p>

<p>
A veces, cuando compile un núcleo nuevo, se le requerirá que instale nuevos
bloques de arranque.
Para ello lea la <a href="../faq14.html#14.8">sección 14.8</a> sobre el
&laquo;Gestor de Arranque&raquo; de OpenBSD, que le dará una idea de cómo
usar este gestor de arranque.
</p>

<p>
<a name="5.4"></a> 
<h2>5.4 - Configuración del Arranque</h2>
</p>

<p>
Algunas veces, al arrancar el sistema, es posible que note que el núcleo
encuentra su dispositivo pero en el IRQ equivocado.
Y puede que necesite usar este dispositivo enseguida.
Bien, Vd. puede usar la configuración del núcleo de arranque de OpenBSD sin
tener que recompilar su núcleo.
De este modo tan sólo corregirá su problema por una vez.
Si reinicia el sistema tendrá que repetir este procedimiento, por lo tanto
ésta es sólo una solución temporal, y debería solucionar el problema mediante
una recompilación de su núcleo.
Si embargo, su núcleo necesita <strong>option BOOT_CONFIG</strong> compilada
en el núcleo, y el núcleo GENERIC la tiene.
</p>

<p>
La mayor parte de lo que aquí se explica se puede encontrar en la página de
manual <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html">boot_config(8)</a>.
</p>

Para iniciar en el modo &quot;User Kernel Config&quot; (&laquo;Configuración 
del Núcleo del Usuario&raquo;), o UKC, en el momento del arranque use la
opción -c.

<ul><pre>
boot&gt; <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

<p>
O cualquier otro núcleo que desee arrancar.
Al hacer esto le llevará al punto de pedido de UKC, desde donde podrá enviar
órdenes directamente al núcleo, especificando los dispositivos que quiera
cambiar o desactivar, o incluso activar.
</p>

<p>
He aquí una lista de órdenes comunes en UKC.
</p>

<p>
<code>add <strong>device</strong> - Añadir un dispositivo copiando otro
</p>

<p>
change <strong>devno | device </strong> - Modifificar uno o más dispositivos
</p>

<p>
disable <strong>devno | device </strong> - Desactivar uno o más dispositivos 
</p>

<p>
enable <strong>devno | device </strong> - Activar uno o más dispositivos 
</p>

<p>
find <strong>devno | device </strong> - Encontrar uno o más dispositivos
</p>

<p>
help - Breve sumario de estas órdenes
</p>

<p>
list - Mostrar una lista de TODOS los dispositivos conocidos
</p>

<p>
exit/quit - Continuar el proceso de arranque
</p>

<p>
show <strong>[attr [val]]</strong> - Mostrar dispositivos con un atributo y,
de forma opcional, con un valor especificado
</p></code>

<p>
Una vez que haya configurado su dispositivo, use quit o exit y continúe con
el proceso de arranque.
Después de esto debe corregir la configuración de su núcleo y compilar un
nuevo núcleo.
Vuelva a la <a href="faq5.html#5.3">sección 5.3</a> para obtener ayuda al
respecto.
</p>

<a name="5.5"></a>
<h2>5.5 - Obtener una Salida con Más Información Durante el Arranque</h2>

<p>
Los mensajes con más verbosidad durante el arranque pueden ayudar mucho al
intentar depurar problemas de arranque.
Si tiene un problema en el que su disquete de arranque no funciona y necesita
más información, simplemente reinicie.
Cuando llegue al punto de pedido &quot;boot&gt;&quot;, arranque con boot -c.
Esto le llevará al punto de pedido UKC&gt;, desde donde:
</p>


<ul><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enabled
UKC&gt; <strong>quit</strong>
</ul></pre>

<p>
A continuación obtendrá unos mensajes con mucha verbosidad en el arranque.
</p>

<a name="5.6"></a>
<h2>5.6 - Usar config(8) para Cambiar el Núcleo</h2>

<p>
A partir de la versión 2.6 se introdujeron las opciones <b>-e</b> y <b>-u</b>
en <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>.
Estas opciones pueden llegar a ser de gran ayuda y ahorrar tiempo malgastado
en la compilación del núcleo.
El indicador <b>-e</b> le permite entrar en UKC en un sistema en 
funcionamiento.
Los cambios que se apliquen comenzarán a funcionar a partir del siguiente
reinicio del sistema.
El indicador <b>-u</b> comprueba si se ha efectuado algún cambio al núcleo en
funcionamiento durante el arranque.
O sea, si ha usado <b>boot -c</b> para entrar en UKC mientras arrancaba su
sistema.
</p>

<p>
El siguiente ejemplo muestra cómo desactivar los dispositivos ep* del núcleo.
Por motivos de seguridad debería usar la opción <b>-o</b>, que guarda los
cambios efectuados al fichero que se especifique.
Por ejemplo: <strong>config -e -o bsd.new /bsd</strong> guardará los cambios
en bsd.new.
El ejemplo a continuación no usa la opción <b>-o</b>, por lo tanto los
cambios se ignorarán y no se guardarán en el binario del núcleo.
Para más información con respecto a los mensajes de errores y de avisos, lea
la página de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>.
</p>

<ul><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc&gt; <strong>?</strong>
        help                            Command help list
        add     dev                     Add a device
        base    8|10|16                 Base on large numbers
        change  devno|dev               Change device
        disable attr val|devno|dev      Disable device
        enable  attr val|devno|dev      Enable device
        find    devno|dev               Find device
        list                            List configuration
        lines   count                   # of lines per page
        show    [attr [val]]            Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
ukc&gt; <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
  1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
  2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
 10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|ncr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
 11 cd* at scsibus* target -1 lun -1
 12 ch* at scsibus* target -1 lun -1
 13 sd* at scsibus* target -1 lun -1
 14 st* at scsibus* target -1 lun -1
 15 ss* at scsibus* target -1 lun -1
 16 uk* at scsibus* target -1 lun -1
 17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
--- more ---   
[snip]
ukc&gt; <strong>disable ep</strong>
 31 ep0 disabled
 32 ep* disabled
 33 ep* disabled
 87 ep0 disabled
 88 ep0 disabled
 89 ep* disabled
 90 ep* disabled
136 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</ul></pre>

<p>
En el anterior ejemplo, todos los dispositivos ep* han sido eliminados del
núcleo y no serán comprobados.
En algunas situaciones en las que haya usado UKC durante el arranque, por
medio de <b>boot -c</b>, necesitará que esos cambios se guarden
permanentemente.
Para ello necesitará usar la opción <b>-u</b>.
En el siguiente ejemplo, la máquina se arrancó en UKC y el dispositivo wi(4)
fue eliminado.
Ya que los cambios efectuados con <b>boot -c</b> NO son permanentes, estos
cambios deben ser guardados.
En este ejemplo los cambios hechos con <b>boot -c</b> se guardan en un nuevo
núcleo binario, bsd.new.
</p>

<ul><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
151 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</ul></pre>


<p>
<font color="#0000e0">
<a href="index.html">[Volver al Índice Principal]</a>
<a href="faq4.html">[Capítulo 4.0 - Guía de Instalación]</a>
<a href="faq6.html">[Capítulo 6.0 - Redes]</a>
</font>
</p>

<hr>
<a href="index.html"><img height="24" width="24" src="../../back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq5.html,v 1.43 2000/03/10 02:47:22 wvdputte Exp ]
<br>
$Translation: faq5.html,v 1.9 2000/04/20 16:41:09 horacio Exp $
<br>
$OpenBSD: faq5.html,v 1.4 2000/04/22 11:06:58 wvdputte Exp $
</small>
</p>
</body>
</html>
