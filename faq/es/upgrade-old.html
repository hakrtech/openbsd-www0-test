<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <meta http-equiv="Content-Language" content="es">

 <title>Gu&iacute;a de actualizaci&oacute;n de OpenBSD
 (versiones antiguas)</title>
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">


<h1>Gu&iacute;a de actualizaci&oacute;n de las versiones
antiguas de OpenBSD</h1>
<h2>Versiones: desde la 2.3 hasta la 2.7</h2>

<address>
<p>
Kjell Wooding 
&lt;<a href="mailto:kjell@openbsd.com">kjell@openbsd.org</a>&gt; <br />
Updated:
$OpenBSD: upgrade-old.html,v 1.1 2002/01/26 11:46:29 jufi Exp $
</p>
</address>

<br>

<blockquote>
<p>
Este documento contiene la informaci&oacute;n para la
actualizaci&oacute;n de versiones de OpenBSD para las que ya
no existe soporte activo.  La informaci&oacute;n sobre las
versiones m&aacute;s recientes y las instrucciones generales
sobre actualizaci&oacute;n se encuentran en la
<a href="upgrade-minifaq.html">gu&iacute;a de
actualizaci&oacute;n</a>.
</p>
</blockquote>


<h2>1.0: Instrucciones generales para la actualizaci&oacute;n
del sistema</h2>

<p>
<a href="#1.1">
1.1: &iquest;D&oacute;nde puedo encontrar informaci&oacute;n
sobre la actualizaci&oacute;n de las versiones m&aacute;s
recientes de OpenBSD?
</a><br>
</p>

<h2>2.0: C&oacute;mo actualizar desde la versi&oacute;n
2.3</h2>

<p>
<a href="#2.1">
2.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.3 a la 2.4?
</a><br>

<a href="#2.2">
2.2: El proceso de compilaci&oacute;n falla cuando intenta
compilar <em>ssleay</em>.
</a><br>

<a href="#2.3">
2.3: El proceso de compilaci&oacute;n falla cuando intenta
compilar algo para PowerPC.
</a><br>
</p>

<h2>3.0: C&oacute;mo actualizar desde la versi&oacute;n
2.4</h2>

<p>
<a href="#3.1">
3.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.4 a la 2.5?
</a><br>

<a href="#3.2">
3.2: El proceso de compilaci&oacute;n falla en
<code>cap_mkdb</code>.
</a><br>
</p>

<h2>4.0: C&oacute;mo actualizar desde la versi&oacute;n
2.5</h2>

<p>
<a href="#4.1">
4.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.5 a la 2.6?
</a><br>

<a href="#4.2">
4.2: C&oacute;mo actualizar <em>gcc</em> a <em>egcs</em>.
</a>
</p>

<blockquote>
<p>
<a href="#4.2.1">4.2.1 - i386 y sparc ya no usan
<code>#define</code></a><br>
<a href="#4.2.2">4.2.2 - La compilaci&oacute;n falla en
<em>xlint</em></a><br>
<a href="#4.2.3">4.2.3 - &laquo;Volcado de memoria&raquo;
(<em>core dump</em>) en
<code>uthread_autoinit.c</code></a><br>
<a href="#4.2.4">4.2.4 - egcs parece ir mucho m&aacute;s lento
que gcc</a><br>
<a href="#4.2.5">4.2.5 - egcs genera un c&oacute;digo de mayor
tama&ntilde;o que gcc</a><br>
<a href="#4.2.6">4.2.6 - Despu&eacute;s de instalar egcs queda
muy poco espacio en el disco</a><br>
<a href="#4.2.7">4.2.7 - El proceso de compilaci&oacute;n
falla al compilar <em>libcurses</em></a><br>
<a href="#4.2.8">4.2.8 - <kbd>make obj</kbd> falla</a>
</p>
</blockquote>

<p>
<a href="#4.3">
4.3: <kbd>make build</kbd> se corta con errores tipo
<em>unimplemented syscall</em>.
</a><br>

<a href="#4.4">
4.4: Enlace al nuevo directorio de 2.6.
</a><br>

<a href="#4.5">
4.5: Despu&eacute;s de <em><strong>(U)</strong>pgrade</em>
(actualizar), la extracci&oacute;n de <em>base26.tar.gz</em>
falla mostrando un mensaje.
</a>
</p>


<h2>5.0: C&oacute;mo actualizar desde la versi&oacute;n
2.6</h2>

<p>
<a href="#5.1">
5.1: Las entradas de <em>termcap</em> son demasiado largas.
</a><br>

<a href="#5.2">
5.2: El n&uacute;cleo del sistema ya no reconoce los
dispositivos <em>pn</em> (or <em>mx</em>, <em>al</em>,
<em>ax</em>).
</a><br>

<a href="#5.3">
5.3: Actualizaci&oacute;n de gcc 2.95.1 a 2.95.2.
</a><br>

<a href="#5.4">
5.4: Actualizaci&oacute;n de Kerberos.
</a><br>

<a href="#5.5">
5.5: Actualizaci&oacute;n de M4.
</a><br>

<a href="#5.6">
5.6: Actualizaci&oacute;n de sendmail.
</a><br>

<a href="#5.7">
5.7: Despu&eacute;s de actualizar, los n&uacute;cleos con
soporte para <em>apm(8)</em> incluido ya no arrancan.
</a><br>
</p>

<h2>6.0 - C&oacute;mo actualizar desde la versi&oacute;n
2.7</h2>

<p>
<a href="#6.1">
6.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.7 a la 2.8?
</a><br>
</p>


&nbsp;<hr width="30%">


<a name="1.0"></a>
<h2>1.0: Instrucciones generales para la actualizaci&oacute;n
del sistema</h2>


<a name="1.1"></a>
<h3>
1.1: &iquest;D&oacute;nde puedo encontrar informaci&oacute;n
sobre la actualizaci&oacute;n de las versiones m&aacute;s
recientes de OpenBSD?
</h3>

<p>
En la <a href="upgrade-minifaq.html">gu&iacute;a de
actualizaci&oacute;n</a>.
</p>

<a name="2.0"></a>
<h2>2.0: C&oacute;mo actualizar desde la versi&oacute;n
2.3</h2>

<a name="2.1"></a>
<h3>
2.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.3 a la 2.4?
</h3>

<h4>New User: <em>named</em></h4>

<p>
A partir de la versi&oacute;n 2.3, el d&aelig;mon
<em>named</em> de DNS se ha cambiado a un entorno
<em>chroot</em><!-- chroot jail -->.  Para que esto fuera
posible se cre&oacute; el usuario <em>named</em>.  Si este
usuario todav&iacute;a no existe en su sistema, tendr&aacute;
que crearlo para asegurarse que todos los directorios sean
correctamente creados durante el proceso de
compilaci&oacute;n.
</p>

<p>
A&ntilde;ada la siguiente entrada a <em>/etc/passwd</em>
usando <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
</p>

<pre>
named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin
</pre>

<p>
Y a&ntilde;ada lo siguiente a <em>/etc/group</em>:
</p>

<pre>
named:*:70:
</pre>

<a name="2.2"></a>
<h3>
2.2: El proceso de compilaci&oacute;n falla cuando intenta
compilar <em>ssleay</em>.
</h3>

<p>
Lo m&aacute;s probable es que falte una entrada para el el
usuario <em>named</em> en el fichero de contrase&ntilde;as.
</p>

<p>
<strong>Respuesta corta:</strong>
</p>

<p>
Cree este usuario antes de la compilaci&oacute;n.
</p>

<p>
<strong>Respuesta larga:</strong>
</p>

<p>
El usuario <em>named</em> es necesario para configurar
correctamente los permisos.  Si falta este usuario, parte del
proceso de compilaci&oacute;n fallar&aacute;.  Si tiene una
captura del proceso de compilaci&oacute;n (puede obtenerla con
<kbd>make build &amp;&gt;/tmp/build.log</em>), podr&aacute;
ver el siguiente mensaje:
</p>

<pre>
(cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)
</pre>

<p>
Desafortunadamente, la compilaci&oacute;n ha continuado sin
tener en cuenta que ha ocurrido un error.
</p>

<p>
Si el usuario <em>named</em> existe, <em>mtree</em>
funcionar&aacute; correctamente:
</p>

<pre>
missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
Por lo tanto, el motivo del fallo es que el directorio
<em>/usr/include/ssl</em> nunca fue creado.  Sin los ficheros
de cabecera, la compilaci&oacute;n de <em>ssleay</em> falla.
</p>

<p>
<strong>Soluci&oacute;n:</strong>
</p>

<p>
Cree el usuario y grupo <em>named</em>.  Elimine
<em>/usr/include/ssl</em>, <em>/var/named</em>, y cualquier
otro directorio de la lista anterior que haya sido creado por
error como un archivo corriente por <kbd>make build</kbd>.
</p>


<a name="2.3"></a>
<h3>
2.3: El proceso de compilaci&oacute;n falla cuando intenta
compilar algo para PowerPC.
</h3>

<p>
El &aacute;rbol del directorio est&aacute; incompleto.
M&aacute;s en concreto, falta el directorio
<em>/usr/share/man/cat4/powerpc</em>.
</p>

<p>
<strong>Soluci&oacute;n r&aacute;pida:</strong>
</p>

<p>
Cree este directorio y siga con la compilaci&oacute;n.
</p>

<p>
<strong>Soluci&oacute;n completa:</strong>
</p>

<p>
Cree el &aacute;rbol del directorio completo:
</p>

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

<p>
Es muy probable que vea algo como lo que sigue:
</p>

<pre>
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
N&oacute;tese que <em>/usr/share/man/cat4/powerpc</em> era uno
de los directorios creados por este proceso.
</p>

<a name="3.0"></a>
<h2>3.0: C&oacute;mo actualizar desde la versi&oacute;n
2.4</h2>

<a name="3.1"></a>
<h3>
3.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.4 a la 2.5?
</h3>

<p>
<h3>cap_mkdb</h3>
</p>

<p>
La sintaxis utilizada para invocar <em>cap_mkdb</em> ha
cambiado un poco.  Antes de ejecutar <kbd>make build</kbd>,
recompile <em>cap_mkdb</em> desde el c&oacute;digo fuente
m&aacute;s reciente:
</p>

<pre>
# cd /usr/src/usr.bin/cap_mkdb
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Ahora el proceso de <kbd>make build</kbd> deber&iacute;a
ejecutarse hasta completarse.
</p>

<p>
<h3>Cambios en la p&aacute;ginas del manual</h3>
</p>

<p>
Varias p&aacute;ginas del manual han pasado de la
secci&oacute;n 1 a secciones posteriores.  Si las
p&aacute;ginas antiguas se quedan en la secci&oacute;n 1, este
cambio pasar&aacute; inadvertido para los usuarios y no
ver&aacute;n la revisi&oacute;n m&aacute;s reciente de esas
p&aacute;ginas.
</p>

<p>
Las siguientes p&aacute;ginas deben ser eliminadas:
</p>

<pre>
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0
</pre>

<p>
<h3>Snake</h3>
</p>

<p>
Debe eliminar el contenido del directorio <em>obj</em> antes
de actualizar <code>/usr/src/games/snake</code>.
</p>

<h3><a name="3.2">
3.2: El proceso de compilaci&oacute;n falla en
<code>cap_mkdb</code>.
</a></h3>

<p>
<strong>S&iacute;ntoma:</strong>
</p>

<p>
El resultado de <kbd>make build</kbd> es un error como el
siguiente:
</p>

<pre>
cap_mkdb -i -f terminfo terminfo.src
cap_mkdb: illegal option -- i
usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
*** Error code 1
</pre>

<p>
<strong>Soluci&oacute;n r&aacute;pida:</strong>
</p>

<p>
Debe recompilar un <em>cap_mkdb</em> nuevo (v&eacute;ase la
<a href="#3.1">secci&oacute;n 3.1</a>).
</p>


<a name="4.0"></a>
<h2>4.0: C&oacute;mo actualizar desde la versi&oacute;n
2.5</h2>

<a name="4.1"></a>
<h3>
4.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.5 a la 2.6?
</h3>

<h5><em>perl</em> y <em>make</em></h5>

<p>
La &uacute;ltima versi&oacute;n de Perl (5.005_03) requiere
una nueva versi&oacute;n de <em>make</em> para compilar
correctamente.  Antes de compilar Perl, debe recompilar
<em>make</em>:
</p>

<pre>
# cd /usr/src/usr.bin/make
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
A continuaci&oacute;n siga con la compilaci&oacute;n del nuevo
Perl.  Para ello tendr&aacute; que limpiar a mano todo el
directorio <em>obj</em> de Perl antes de compilar.
</p>

<p>
Los programadores en Perl deber&iacute;an tomar nota de los
&uacute;ltimos cambios.  De millert@openbsd.org:
</p>

<pre>
La versi&oacute;n de perl en el &aacute;rbol de fuentes de OpenBSD
(post-2.5) ha sido actualizada con la 5.005_03.  El m&eacute;todo de
compilaci&oacute;n ha cambiado algo, pero en su mayor parte esto no
deber&iacute;a ser visible.  Los cambios importantes que afectan a los
usuarios son los siguientes:

1) Los ficheros lib de Perl han cambiado su ubicaci&oacute;n de
/usr/lib/perl5 a /usr/libdata/perl5, que es m&aacute;s correcto.
2) Los directorios predeterminados site_perl se encuentran ahora
en /usr/local.  O sea que si instala un m&oacute;dulo de perl, se
ubicar&aacute; a s&iacute; mismo en /usr/local/libdata/perl5/site_lib.
De este modo es m&aacute;s f&aacute;cil ver los m&oacute;dulos no regulares que hay
instalados.  Tambi&eacute;n es m&aacute;s f&aacute;cil tener m&oacute;dulos de perl
en el sistema de portes.
3) Las p&aacute;ginas del manual de las bibliotecas de perl ahora se
instalan en /usr/share/man/cat3p.  Para verlas tendr&aacute; que actualizar
man.conf de acuerdo con /src/etc/man.conf.  Esto quiere decir que
ahora puede ejecutar &quot;man 3p less&quot; y obtener informaci&oacute;n sobre el
pragma de less, pero &quot;man less&quot; le seguir&aacute; mostrando la p&aacute;gina
del manual del paginador less.

Si tiene instalados m&oacute;dulos o fichero no regulares de perl, lo
m&aacute;s sencillo es pasar /usr/lib/perl5 a /usr/libdata/perl5 y
a&ntilde;adir un enlace desde /usr/lib/perl5 a /usr/libdata/perl5.
De forma alternativa, puede editar el fichero Config.pm instalado
y corregir en &eacute;ste los caminos.

</pre>

<h5>Cambio en el compilador: <em>egcs</em> substituye a
<em>gcc</em></h5>

<p>
Este cambio es, probablemente, el m&aacute;s significativo de
todos los cambios que se puedan encontrar.
En la <a href="#4.2">secci&oacute;n 4.2</a> puede ver
instrucciones detalladas.
</p>

<h5>Cambios en la estructura <code>statfs</code> del
n&uacute;cleo del sistema</h5>

<p>
La estructura <code>statfs</code> ha cambiado desde el 31 de
mayo.  Debe recompilar el n&uacute;cleo (<em>kernel</em>)
antes de intentar ejecutar <kbd>make build</em>.
The <tt>statfs</tt> structure has changed as of May 31. You must
rebuild your kernel before attempting a <em>make build</em>.
M&aacute;s detalles en la <a href="#4.3">secci&oacute;n
4.3</a>.
</p>

<a name="4.2"></a>
<h3>
4.2: C&oacute;mo actualizar <em>gcc</em> a <em>egcs</em>.
</h3>

<p>
El modo m&aacute;s seguro es el de actualizar a una
versi&oacute;n preliminar (<em>snapshot</em>) reciente en
cuanto haya una disponible.  <strong>&iexcl;Busque un
<em>snapshot</em> primero!</strong>  Usar una rutina de
arranque (<em>bootstrap</em>) para el nuevo compilador desde
el viejo debe considerarse como un &uacute;ltimo recurso.
</p>

<p>
Antes, inf&oacute;rmese sobre qu&eacute; plataformas no han
podido usar rutinas de arranque con &eacute;xito
todav&iacute;a.  En el momento de escribir esto,
deber&iacute;a funcionar en las siguientes plataformas si
tiene cuidado:
</p>

<ul>
<li><strong>i386</strong>
<li><strong>sparc</strong>
<li><strong>m68k</strong>
<li><strong>alpha</strong>
</ul>

<p>
<strong>mips</strong> y <strong>rs6000</strong> tienen
problemas.
</p>

<p>
Para verificar si funcionan las rutinas de arranque en su
plataforma, installe <em>egcs-snapshot</em>, que se encuentra
en la <a href="../ports.html">colecci&oacute;n de portes</a>.
Si funciona, es muy probable que tambi&eacute;n funcione la
versi&oacute;n integrada en el &aacute;rbol de fuentes.
&Eacute;ste es el m&eacute;todo m&aacute;s seguro.
</p>

<p>
Antes de ir m&aacute;s lejos, aseg&uacute;rese de que todas
sus copias de <em>binutils</em>, <em>gas</em>, y <em>ld</em>
sean actuales.  N&oacute;tese que existen dos copias de
<em>gas</em> y <em>ld</em> en el &aacute;rbol.  En las
plataformas <strong>i386</strong> y <strong>sparc</strong>, no
se utilizan las versiones de <em>binutils</em>.  En lugar de
eso, compruebe <em>/usr/src/gnu/usr.bin/gas</em> y
<em>/usr/src/gnu/usr.bin/ld</em>.
</p>

<p>
Las siguientes instrucciones hacen referencia a la
versi&oacute;n preliminar original de egcs (egcs-990517).
Desde entonces hay una segunda versi&oacute;n preliminar
(egcs-990608) en el &aacute;rbol.  Si la versi&oacute;n 2.5
de que dispone era la versi&oacute;n final, es poco probable
que pueda compilar directamente esta versi&oacute;n.  En este
caso tendr&aacute; que usar una rutina de arranque con una
versi&oacute;n intermedia utilizando las instrucciones que
siguen a continuaci&oacute;n.
</p>

<p>
De espie@openbsd.org:
</p>

<blockquote>
<pre>
Hoy cambia el compilador.

Sale gcc 2.8.1 y entra egcs ... o, para ser m&aacute;s preciso, gcc 2.95.

Esto es probable que complique las cosas de momento, pero no puedo
solucionar todas las rarezas de cada arquitectura yo solo.

Voy a empezar a importarlo *ahora*.  En cuanto est&eacute; todo
estabilizado enviar&eacute; un segundo mensaje a tech@.

Gracias a todos los que me han ayudado con esto, y de manera muy
especial a niklas, turan y millert.

Porqu&eacute; del cambio
-----------------
Como la mayor&iacute;a ya sabr&aacute;, egcs es en este momento el compilador
*oficial* con soporte de la FSF.  La pr&oacute;xima versi&oacute;n de julio
ha sido rebautizada gcc 2.95.

Con una simple mirada a los mensajes de registro se pueden ver
muchas mejoras:  el soporte para los procesadores m&aacute;s nuevos es
mejor, C++ se aproxima mucho m&aacute;s a las especificaciones ANSI/ISO,
Fortran 77 est&aacute; mucho m&aacute;s integrado.  Tambi&eacute;n hay un sinn&uacute;mero
de errores reparados y de mejoras en la generaci&oacute;n de c&oacute;digo.

Adem&aacute;s, el modelo de desarrollo es m&aacute;s abierto.  Hay un &aacute;rbol de
cvs, hay varias listas de correo disponibles, y  estamos cooperando
con el equipo de egcs.  Para ser m&aacute;s preciso, he enviado parches al
equipo de egcs para que las opciones de configuraci&oacute;n de OpenBSD
tengan soporte oficial.  El equipo de desarrollo ha ofrecido un
alto nivel de respuesta a los informes sobre errores, y se han
solucionado problemas.

Tambi&eacute;n hay algo m&aacute;s:  todos est&aacute;n migrando a egcs, lo que significa
que hay mucho c&oacute;digo sobre el que poder probar el compilador, y que
podemos beneficiarnos de proyectos relacionados.

Porqu&eacute; ahora
------------
egcs-1.1 no serv&iacute;a para algunos prop&oacute;sitos.  En concreto, el tama&ntilde;o
del c&oacute;digo en i386 era mayor que el de gcc 2.8.1, lo que provocaba
problemas con los disquetes.  En el momento en que se congel&oacute; la
versi&oacute;n 2.5 de OpenBSD, el &uacute;nico c&oacute;digo que se ajustaba para ser
incluido en el sistema era una versi&oacute;n preliminar algo inestable.
En inter&eacute;s de la estabilidad, y despu&eacute;s de muchos intentos, egcs
no fue incluido en 2.5.

Ahora mismo, el proyecto egcs se encuentra en fase de producci&oacute;n
de egcs 1.2.  A juzgar por la marcha del proyecto, hay un amplio 
margen entre egcs 1.2 y la pr&oacute;xima versi&oacute;n oficial de OpenBSD.
Adem&aacute;s, queremos disponer ya de &eacute;l, para poder tener la oportunidad
de enviar informes sobre los problemas en las arquitecturas menos
utilizadas, y tenerlo todo solucionado para la versi&oacute;n 1.2.

La &laquo;congelaci&oacute;n del desarrollo de funcionalidades&raquo; de egcs deber&iacute;a
tener lugar el 7 de mayo, y la versi&oacute;n preliminar 19990502 ya
ofrece solidez.

Qu&eacute; funciona y qu&eacute; no
---------------------
egcs funciona sin problemas en el sistema i386 de OpenBSD.  Tambi&eacute;n
funciona en m68k, con algunos arreglos relacionados con errores
extra&ntilde;os que se solucionar&aacute;n.  Tambi&eacute;n parece funcionar en sparc.
Hay algunos problemas con el enlazador en algunas otras arquitecturas
que deben ser solucionados antes del lanzamiento de nuestra pr&oacute;xima
versi&oacute;n.

En este instante, los constructores de bibliotecas din&aacute;micas
todav&iacute;a no est&aacute;n listos.

egcs dispone ahora de un preprocesador cpp independiente que ser&aacute;
mejor que el arreglo que usamos en este momento.  Esto conllevar&aacute;
algunos cambios en la interfaz y probablemente avisos extra&ntilde;os.

&iquest;Se mantendr&aacute; gcc 2.8.1?
------------------------
Debido al espacio que ocupa, gcc pasar&aacute; al m&oacute;dulo Attic de cvs
en cuanto se importe egcs.  Si no quiere pasar todav&iacute;a a egcs,
deber&aacute; tener cuidado con las actualizaciones por cvs.
Habr&aacute; algunos cambios en los ficheros Makefile:  los include,
gnu/usr.bin, y gnu/lib.  xlint y cpp.sh tambi&eacute;n cambiar&aacute;n.

C&oacute;mo instalar el compilador mediante rutinas de arranque
--------------------------------------------------------
El modo m&aacute;s f&aacute;cil es el de confiar en los mantenedores de las
arquitecturas y obtener una versi&oacute;n preliminar.

Si quiere complicarse la vida, primero tendr&aacute; que volver a compilar
los directorios obj:
cd /usr/src
make obj

Si la plataforma es i386, se debe actualizar gas.
Si la plataforma es sparc, se debe actualizar ld.

compilar libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

compilar el compilador de C:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

recompilar el compilador de C con la nueva versi&oacute;n:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

recompilar los ficheros de inclusi&oacute;n:
cd /usr/src/include
make includes

compilar todas las bibliotecas egcs e instalarlas:
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

e instalar el nuevo controlador cpp
cd /usr/src/usr.bin/cpp
make install

y ya est&aacute; listo para una compilaci&oacute;n general que ahora
deber&iacute;a funcionar.
</pre>


<p>
[nota del autor: en realidad no funcionar&aacute; del todo, ya
que fallar&aacute; la compilaci&oacute;n de xlint.  Sin
embargo la  soluci&oacute;n es simple.  Cambie al directorio
<em>/usr/src/usr.bin/xlint/xlint</em> y ejecute <kbd>make
&amp;&amp; make install</kbd> antes de ejecutar <kbd>make
build</kbd>.  Luego prosiga con normalidad.  Lea la referencia
en la <a href="#4.2.2">secci&oacute;n 4.2.2</a>]
</p>

<pre>
Si no funciona, entonces es que est&aacute; usando una arquitectura
que todav&iacute;a no ha pasado por make build.  Lo m&aacute;s probable es
que ocurra un error interno del compilador, como el que se
conoce por ICE.

Primero intente ver si el ICE desaparece con -O1 &oacute; -O0.
Si es as&iacute;, puede incluir un arreglo en el fichero Makefile
hasta que se solucione (mire en el fichero
/usr/src/lib/libm/Makefile a modo de ejemplo de c&oacute;mo incluir
arreglos para m68k).

Es necesario que se informe sobre el error en la lista de
correo de egcs-bugs.

Como m&iacute;nimo, debe compilar el c&oacute;digo fuente con la misma
invocaci&oacute;n del compilador, a&ntilde;adiendo -v -save-temps a las
opciones.

La opci&oacute;n -v produce la secuencia exacta de instrucciones
invocadas por gcc.  La opci&oacute;n -save-temps le dar&aacute; un fichero
C preprocesado (.i) o uno C++ (.ii) de utilidad para los
programadores de egcs... no les puede pedir que instalen OpenBSD
en sus m&aacute;quinas.

Si dispone de m&aacute;s tiempo, puede intentar reducir el fichero
de C preprocesado hasta un m&iacute;nimo en el que evite el error.
La dicotom&iacute;a funciona bastante bien.
</pre>
</blockquote>

Si ha tenido &eacute;xito con este procedimiento y todo
funciona, le felicito.  Pero si no es as&iacute;, lea las
siguientes secciones.  Los problemas que no aparezcan
aqu&iacute; deben ser enviados a tech@openbsd.org.

<a name="4.2.1"></a>
<h5>
4.2.1 - i386 y sparc ya no usan <code>#define</code>
</h5>

<p>
En efecto, <em>egcs</em> usa <code>__i386</code>
<code>__sparc</code>, que son m&aacute;s limpios.  Si necesita
compilar c&oacute;digo que dependa de los antiguos
<code>define</code>, a&ntilde;ada <em>-Dsparc</em> o
<em>-Di386</em> en el lugar apropiado de su fichero
<em>Makefile</em>.
</p>

<a name="4.2.2"></a>
<h5>
4.2.2 - La compilaci&oacute;n falla en <em>xlint</em>
</h5>

<p>
Esto se debe a diferencias de sem&aacute;ntica en
<em>cpp</em>.  La soluci&oacute;n es simple y parecida al
problema con <code>cap_mkdb</em> descrito en la
<a href="#3.1">la secci&oacute;n 3.1</a>:
</p>

<pre>
# cd /usr/src/usr.bin/xlint/xlint
# make &amp;&amp; make install
</pre>

<p>
vuelva a ejecutar <kbd>make</kbd>, y la compilaci&oacute;n
debre&iacute;a continuar.
</p>

<a name="4.2.3"></a>
<h5>
4.2.3 - &laquo;Volcado de memoria&raquo; (<em>core dump</em>)
en <code>uthread_autoinit.c</code>
</h5>

<p>
Ha sido v&iacute;ctima de un error en el enlazador.  He
aqu&iacute; un mensaje al respecto:
</p>

<pre>
From: Marc Espie &lt;Marc.Espie@liafa.jussieu.fr&gt;
Subject: egcs core-dumping on uthread_autoinit.c

Si le ocurre esto, es un problema consabido con el enlazador...
el cc1 que tiene ha sido enlazado de forma extra&ntilde;a.

Al principio cre&eacute; un enlace de cc1 a /usr/lib/libiberty.a,
para evitar este problema;  pero no fue suficiente y el error
volvi&oacute; a aparecer, probablemente debido a cambio sin
relaci&oacute;n alguna en libc o alguna otra parte.

En el &aacute;rbol se ha incluido una soluci&oacute;n en

src/gnu/egcs/f/lang-options.h

Aseg&uacute;rese de tener la versi&oacute;n parcheada de ese fichero
(revisi&oacute;n 1.2 como m&iacute;nimo), recompile y reinstale cc1,
y el problema deber&iacute;a desaparecer.

Lo que sucede es que el enlazador para 386 obtiene alg&uacute;n error
debido a las enormes estructuras de cadenas de caracteres en
toplev.c, y algo se desenlaza, de tal modo que
void f(void) --attribute((constructor)) {} mata cc1.

Como soluci&oacute;n, he matado los textos de ayuda de las opciones 
de Fortran, hasta que alguien encuentre d&oacute;nde se producen los
errores del enlazador.
</pre>

<a name="4.2.4"></a>
<h5>
4.2.4 - <em>egcs</em> parece ir mucho m&aacute;s lento que
<em>gcc</em>
</h5>

<p>
Es as&iacute;, pero existe una raz&oacute;n.  <em>egcs</em>
lleva a cabo m&aacute;s pases de optimizaci&oacute;n.  El
alineamiento de datos y otras funcionalidades parecidas
estar&aacute;n mejor con c&oacute;digo generado por
<em>egcs</em>.
</p>

<a name="4.2.5"></a>
<h5>
4.2.5 - <em>egcs</em> genera un c&oacute;digo de mayor
tama&ntilde;o que <em>gcc</em>
</h5>

<p>
Correcto.  Esto se nota mucho m&aacute;s con la antigua
opci&oacute;n <em>-O2</em> de <em>gcc</em>.  <em>egcs</em>
introduce una nueva opci&oacute;n, <em>-Os</em>, que optimiza
el espacio.  Se podr&iacute;a comparar <em>grosso modo</em>
con el comportamiento de la antigua opci&oacute;n
<em>-O2</em>.
</p>

<a name="4.2.6"></a>
<h5>
4.2.6 - Despu&eacute;s de instalar <em>egcs</em> queda muy
poco espacio en el disco
</h5>

<p>
<em>egcs</em> se instala en un subdirectorio diferente al de
gcc 2.8.1.  Puede eliminar <em>gcc</em> una vez que
<em>egcs</em> est&eacute; funcionando.
</p>

<p>
En relaci&oacute;n con esto, los cambios en perl que se
mencionan en la <a href="#4.1">secci&oacute;n 4.1</a> implican
que puede obtener m&aacute;s espacio eliminando el directorio
<em>/usr/lib/perl5</em>.  La nueva ubicaci&oacute;n de estos
datos es <em>/usr/libdata/perl5</em>.
</p>

<a name="4.2.7"></a>
<h5>
4.2.7 - El proceso de compilaci&oacute;n falla al compilar
<em>libcurses</em>
</h5>

<p>
Ahora, <em>libcurses</em> depende de la &uacute;ltima
versi&oacute;n de <em>cpp</em>.  B&aacute;jese la
&uacute;ltima versi&oacute;n de <em>cpp</em>,
recomp&iacute;lela, y contin&uacute;e.  Por ejemplo:
</p>

<pre>
# cd /usr/src/usr.bin/cpp &amp;&amp; make install
</pre>

<p>
y vuelva a la ejecuci&oacute;n de <kbd>make build</kbd>.
</p>

<a name="4.2.8"></a>
<h5>
4.2.8 - <kbd>make obj</kbd> falla</a>
</h5>

<p>
Si <kbd>make obj</kbd> falla y le indica errores en un fichero
<em>Makefile</em>, es probable que los ficheros de
inclusi&oacute;n (<em>include</em>) de su <em>Makefile</em>
est&eacute;n obsoletos.  Un ejemplo de estos errores:
</p>

<pre>
===&gt; lib/libkvm
&quot;Makefile&quot;, line 30: Malformed conditional ((${UVM} == &quot;yes&quot;))
&quot;Makefile&quot;, line 30: Missing dependency operator
&quot;Makefile&quot;, line 32: if-less endif
&quot;Makefile&quot;, line 32: Need an operator
Fatal errors encountered -- cannot continue

</pre>

<p>
Esto no se puede resolver recompilando los ficheros de
inclusi&oacute;n del <em>Makefile</em>, sino:
</p>

<pre>
cd /usr/src/share/mk &amp;&amp; make install
</pre>

<p>
y vuelva a intentar la compilaci&oacute;n.
</p>

<a name="4.3"></a>
<h3>
4.3: <kbd>make build</kbd> se corta con errores tipo
<em>unimplemented syscall</em>.
</h3>

<p><strong>Respuesta corta:</strong> </p>

<p>
La estructura <code>statfs</code> del n&uacute;cleo del
sistema ha cambiado.  Debe recompilar el n&uacute;cleo antes
de intentar ejecutar <kbd>make build</kbd>.
</p>

<p><strong>Respuesta larga:</strong> </p>

<p>
La estructura <code>statfs</code> del n&uacute;cleo del
sistema ha cambiado.  La nueva <code>struct statfs</code>
tiene las siguientes funcionalidades:
</p>

<ul>
<li>Un campo de indicadores <code>u_int32_t</code>;  ahora
softdep puede tener un indicador real.</li>

<li>Usa <code>u_int32_t</code> en lugar de <code>longs</code>
(mejor en alpha).<br>
Nota: la p&aacute;gina del manual ment&iacute;a sobre la
configuraci&oacute;n de campos no v&aacute;lidos/no usados a
-1.  SunOS s&iacute; los configura, pero nuestro c&oacute;digo
nunca lo ha hecho.</li>

<li>Elimina completamente <code>f_type</code>.  No ha sido
utilizado desde NetBSD 0.9, y el tenerlo ah&iacute; pero que
siempre sea 0 es confuso.  Es normal que esto pueda hacer que
algo de c&oacute;digo antiguo no compile, pero es mejor eso a
que se caiga en silencio.</li>

<li>A&ntilde;ade una uni&oacute;n <code>mount_info</code> que
contiene la estructura <code>FSTYPE_args</code>.  Esto
significa que ahora <em>mount</em> puede indicar todas las
opciones con las que se haya montado un sistema de archivos.
Es especialmente &uacute;til para NFS.</li>
</ul>

<p>
Otros cambios:
</p>

<ul>
<li>La emulaci&oacute;n statfs de linux no conviert&iacute;a
entre nombres de sistemas de archivos de BSD y n&uacute;meros
<code>f_type</code> de linux.  Ahora lo hace, ya que el
n&uacute;mero <code>f_type</code> de BSD no es de utilidad
para las aplicaciones de linux (y de todos modos ha sido
eliminado).</li>

<li>La estructura statfs de FreeBSD es diferente de la nuestra
(tanto la antigua como la nueva) y por lo tanto es necesaria
la conversi&aocute;n.  Anteriormente, las llamadas al sistema
de OpenBSD se usanban sin ninguna traducci&oacute;n real.
</li>

<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;apropos=0&amp;sektion=8&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">mount(8)</a>
muestra ahora informaci&oacute;n adicional cuando se invoca
sin argumentos.  Sin embargo, para verlo <em>todo</em>, debe
usar el indicador <em>-v</em>.</li>
</ul>

<a name="4.4"></a>
<h3>
4.4: Enlace al nuevo directorio de 2.6.
</h3>

<p>
Cuando actualice a la versi&oacute;n 2.6 deber&aacute; crear
un simple enlace para <em>gcc</em>:
</p>

<pre>
   cd /usr/lib/gcc-lib
   ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6
</pre>

<a name="4.5"></a>
<h3>
4.5: Despu&eacute;s de <em><strong>(U)</strong>pgrade</em>
(actualizar), la extracci&oacute;n de <em>base26.tar.gz</em>
falla mostrando un mensaje.
</h3>

<p>
<em>tar: Unable to remove directory ./usr/include/machine
&lt;Directory not empty&gt;</em>
</p>

<p>
En 2.5, <em>/usr/include/machine</em> era un directorio, y
<em>/usr/include/i386</em> un enlace a ese directorio.  En
2.6, esta situaci&oacute;n se ha invertido.
</p>

<p>
Para corregir el problema pase al int&eacute;rprete de
&oacute;rdenes (<em>shell</em>), elimine el directorio
<em>/usr/include/machine</em>, y vuelva a intentar la
actualizaci&oacute;n.
</p>

<a name="5.0"></a>
<h2>
5.0 - C&oacute;mo actualizar desde la versi&oacute;n 2.6
</h2>

<a name="5.1"></a>
<h3>
5.1: Las entradas de <em>termcap</em> son demasiado largas.
</h3>

<p>
Hay un nuevo fichero <em>termcaps.master</em>.  Debe regenerar
los ficheros <em>terminfo</em> y <em>termcaps</em> con la
versi&oacute;n actual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tic&amp;apropos=0&amp;sektion=1&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">tic(1)</a>.
Si va a actualizar con <kbd>make build</kbd>, usar&aacute; la
versi&oacute;n correcta de tic(1) y los regenerar&aacute; sin
m&aacute;s.  De lo contrario, le dar&aacute; el siguiente
error:
</p>

<pre>
    terminfo.src is corrupt! You need to update /usr/bin/tic
</pre>

<p>
En este caso debe recompilar e instalar tic(1)
(asegur&aacute;ndose de que usa la versi&oacute;n actual de
<em>libcurses</em>), o compilar la versi&oacute;n de tic(1) en
su &aacute;rbol de fuentes.
</p>

<a name="5.2"></a>
<h3>
5.2: El n&uacute;cleo del sistema ya no reconoce los
dispositivos <em>pn</em> (or <em>mx</em>, <em>al</em>,
<em>ax</em>).
</h3>

<p>
Nota: <em>pn</em> se usa en este texto para simplificar.  En
realidad debe ser <em>pn</em>, <em>mx</em>, <em>al</em>, o
<em>ax</em> seg&uacute;n sea apropiado.
</p>

<p>
Estos cuatro controladores han sido substituidos por el
controlador unificado <em>dc</em>.  Debe cambiar todas las
referencias a <em>pn*</em>, <em>mx</em>, <em>al</em>, o
<em>ax</em> en los ficheros de configuraci&oacute;n.  Esto
incluye:
</p>

<ul>
<li>Actualizar el fichero (o los ficheros) de
configuraci&oacute;n del n&uacute;cleo del sistema (puede
empezar con un n&uacute;cleo GENERIC nuevo, e ir
modific&acute;ndolo).</li>
<li>Cambiar <em>/etc/hostname.pn*</em> a
<em>/etc/hostnam.dc*</em>.</li>
<li>Actualizar el fichero <em>/etc/ifaliases</em>.</li>
<li>Cambiar <em>/etc/ipnat.rules</em> y
<em>/etc/ipf.rules</em> para reflejar el nuevo nombre de la
interfaz.</li>
</ul>

<p>
Si modifica un n&uacute;cleo personailzado, aseg&uacute;rese
de que ha incluido el dispositivo <em>dcphy</em> en la
configuraci&oacute;n del n&uacute;cleo:
</p>

<pre>
dcphy*  at mii? phy ?                           # PHYs cl&oacute;nicos de Digital
</pre>

<p>
y de paso, tambi&eacute;n puede a&ntilde;adir:
</p>

<pre>
ukphy*  at mii? phy ?                           # PHYs desconocidos
</pre>

<a name="5.3"></a>
<h3>
5.3: Actualizaci&oacute;n de gcc 2.95.1 a 2.95.2.
</h3>

<p>
<em>gcc</em> 2.95.2 fue fusionado en el &aacute;rbol de
fuentes alrededor del 19 de enero de 2.000.  Para que
<em>gcc</em> se compile correctamente, se requiere una
versi&oacute;n de <em>libiberty</em> m&aacute;s reciente
(posterior a la incluida en 2.6).  Para compilar esta
biblioteca, haga lo siguiente:

<pre>
	cd /usr/src/gnu/egcs/libiberty
	make -f Makefile.bsd-wrapper clean
	make -f Makefile.bsd-wrapper obj
	make -f Makefile.bsd-wrapper
	make -f Makefile.bsd-wrapper install
</pre>

<p>
NOTA: en las arquitecturas basadas en mips, como pmax, debe
ejecutar <kbd>ldconfig</kbd> despu&eacute;s de que las
bibliotecas hayan sido compiladas e instaladas.
</p>

<p>
Una vez que <em>libiberty</em> haya sido compilada, puede
continuar con una rutina de arranque de <em>gcc</em> normal:
</p>

<pre>
   cd /usr/src/gnu/egcs/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper 
   make -f Makefile.bsd-wrapper install
</pre>

<a name="5.4"></a>
<h3>
5.4: Actualizaci&oacute;n de Kerberos.
</h3>

<p>
Para que Kerberos IV se compile correctamente, debe seguir los
siguientes pasos:
</p>

<ul>
<li>
<p>
Obtener y compilar la &uacute;ltima versi&oacute;n de
<code>usr.bin/compile_et</code>.
</p>

<pre>
   # cd /usr/src/usr.bin/compile_et
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p>
Obtener y compilar la &uacute;ltima versi&oacute;n de
<code>lib/libcom_err</code>.
</p>
<pre>
   # cd /usr/src/lib/libcom_err
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p>
Limpiar y reinstalar los ficheros de cabecera de Kerberos:
</p>
<pre>
  # rm -r /usr/include/kerberosIV/*
  # cd /usr/src/kerberosIV
  # make includes
</pre>
</li>

<li>
<p>
A continuaci&oacute;n, recompilar los ficheros de bibliotecas
de Kerberos:
</p>
<pre>
   # cd /usr/src/kerberosIV/lib
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p>
Si no va a hacer una compilaci&oacute;n completa, recompile
Kerberos:
</p>
<pre>
   # cd /usr/src/kerberosIV
   # make cleandir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
O de otro modo, vuelva a empezar <kbd>make build</kbd>.
</li>
</ul>

<a name="5.5"></a>
<h3>
5.5: Actualizaci&oacute;n de M4.
</h3>

<p>
La versi&oacute;n de m4 incluida en OpenBSD 2.6 produce un
bucle infinito mientras procesa los ficheros <em>.mc</em> de
sendmail en ficheros <em>.cf</em>.  Por ello, debe instalar la
nueva versi&oacute;n de m4 <strong>antes</strong> iniciar
<kbd>make build</kbd>.  En otras palabras:
</p>

<pre>
    # cd /usr/src/usr.bin/m4
    # make &amp;&amp; make install &amp;&amp; make cleandir
</pre>

<a name="5.6"></a>
<h3>
5.6: Actualizaci&oacute;n de sendmail.
</h3>

<p>
La ubicaci&oacute;n (y los nombres) de los ficheros de
configuraci&oacute;n han cambiado en sendmail 8.10.X.  A
excepci&oacute;n del fichero <em>pid</em>, ahora todo se
encuentra en <em>/etc/mail</em>.  Adem&aacute;s, varios
ficheros han cambiado de nombre.
</p>

<table border="0">
<tr>
  <td><strong>VIEJO</strong></td>
  <td><strong>NUEVO</strong></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cf</tt></td>
  <td><tt>/etc/mail/sendmail.cf</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cw</tt></td>
  <td><tt>/etc/mail/local-host-names</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.ct</tt></td>
  <td><tt>/etc/mail/trusted-users</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.oE</tt></td>
  <td><tt>/etc/mail/error-header</tt></td>
</tr>
<tr>
  <td><tt>/etc/aliases</tt></td>
  <td><tt>/etc/mail/aliases</tt></td>
</tr>
<tr>
  <td><tt>/etc/service.switch</tt></td>
  <td><tt>/etc/mail/service.switch</tt></td>
</tr>
<tr>
  <td><tt>/etc/userdb</tt></td>
  <td><tt>/etc/mail/userdb</tt></td>
</tr>
<tr>
  <td><tt>/usr/share/misc/sendmail.hf</tt></td>
  <td><tt>/etc/mail/helpfile</tt></td>
</tr>
</table>

<p>
Existe un par de formas para convertir el fichero antiguo de
sendmail a uno nuevo, pero en cualquiera de los casos el
primer paso es el mismo.
</p>

<ol>
<li>
Actualizar <em>/etc/rc</em> para que busque
<em>/etc/mail/sendmail.cf</em> en lugar de
<em>/etc/sendmail.cf</em>
</li>
<li>
<kbd>mv /etc/sendmail.cf /etc/mail/sendmail.cf</kbd><br>
&Eacute;ste es el camino m&aacute;s f&aacute;cil, y no
tendr&aacute; que cambiar la ubicaci&oacute;n de nin&uacute;n
otro fichero.
</li>
<li>
O compile un nuevo fichero <em>.cf</em> desde el fichero
fuente <em>.mc</em>.  N&oacute;tese que ya no tendr&aacute;
que especificar la l&iacute;nea:
<pre>include(`../m4/cf.m4')</pre>, ya que la habr&aacute;
incluido <em>make</em>.  Adem&aacute;s, cuando a&ntilde;a
m&aacute;quinas a la clase w (por medio de &quot;Cw
nombre_de_m&aacute;quina&quot;), ahora debe hacerlo en la
secci&oacute;n LOCAL_CONFIG (v&eacute;ase ejemplo en
<em>openbsd-lists.mc</em>).
</li>
</ol>

<a name="5.7"></a>
<h3>
5.7: Despu&eacute;s de actualizar, los n&uacute;cleos con
soporte para <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;apropos=0&amp;sektion=8&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">apm(8)</a> incluido ya no arrancan.
</h3>

<p>
Tiene que actualizar sus bloques de arranque
(<em>bootblocks</em>).  Vea los detalles en la
<a href="faq14.html#14.8">Secci&oacute;n 14.8</a>.
</p>


<a name="6.0"></a>
<h2>
6.0 - C&oacute;mo actualizar desde la versi&oacute;n 2.7
</h2>

<a name="6.1"></a>
<h3>
6.1: &iquest;Cu&aacute;les son los principales problemas para
actualizar desde la versi&oacute;n 2.7 a la 2.8?
</h3>

<p>
Se ha introducido un cambio significativo en <em>gcc</em> que
facilita la generaci&oacute;n de las bibliotecas de
<em>libc</em> con auto-referencia.  Por ello, las
actualizaciones deben seguir el siguiente procedimiento con
extactitud:
</p>

<ol>
<li>
<a href="upgrade-minifaq.html#1.10">Limpiar lo sobrante</a> de
la &uacute;ltima compilaci&oacute;n del &aacute;rbol de
fuentes, y obtener el c&oacute;digo fuente de la
versi&oacute;n 2.8.
</li>

<li>
<p>
Compilar e instalar un nuevo enlazador.  Esto
<strong>debe</strong> hacerse antes de una compilaci&oacute;n
completa de <em>gcc</em>.
</p>
<pre>
  $ cd /usr/src/gnu/usr.bin/ld
  $ make clean &amp;&amp; make obj &amp;&amp; make
  $ sudo make install
</pre>
</li>

<li>
Compilar e instalar el nuevo <em>gcc</em>.  Use el
procedimiento de
<a href="upgrade-minifaq.html#1.8">rutinas de arranque
(<em>bootstrap</em>)</a> para aligerar el proceso.
</li>

<li>
<p>
Compilar un nuevo n&uacute;cleo.  No lo instale
todav&iacute;a.
</p>
<pre>
  $ cd /usr/src/sys/arch/`machine`/conf
  $ config GENERIC
  $ cd ../compile/GENERIC
  $ make clean &amp;&amp; make depend &amp;&amp; make
</pre>
</li>

<li>
<p>
Debido a algunos cambios en <em>libc</em>, su m&aacute;quina
se puede quedar colgada durante el arranque, a menos que
<em>/etc/resolv.conf</em> contenga la l&iacute;nea <em>lookup
file bind</em>.  A&ntilde;adala si no la tiene.
</p>
<pre>
  # echo &quot;lookup file bind&quot; &gt;&gt; /etc/resolv.conf
</pre>
</li>

<li>
<p>
Instalar el nuevo n&uacute;cleo y reiniciar.
</p>
<pre>
  # cd /usr/src/sys/arch/`machine`/compile/GENERIC
  # mv /bsd /bsd.old
  # mv bsd /bsd
  # chown root.wheel /bsd
  # shutdown -r now
</pre>
<p>
(si este paso fallara, puede recuperar arrancando con el
n&uacute;cleo antiguo, <em>bsd.old</em>, desde el punto de
inicio <em>boot&gt;</em>).
</p>
</li>

<li> 
<p>
Compilar e instalar el nuevo <em>make</em> (y los ficheros de
soporte).  No se salte el paso <kbd>make depend</kbd>.
</p>
<pre>
  $ cd /usr/src/usr.bin/make
  $ make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  $ sudo make install
  $ cd /usr/src/share/mk
  $ sudo make install
</pre>
</li>

<li>
Instalar el <em>mtree</em> m&aacute;s reciente, y asegurarse
de que se est&eacute; presente la estructura de directorio
necesaria.
<pre>
  $ cd /usr/src/etc/mtree
  $ sudo install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  $ sudo mtree -qdef /etc/mtree/
</pre>
</li>

<li>
<p>
Iniciar el proceso <kbd>make build</kbd>.
</p>
<pre>
  # cd /usr/src &amp;&amp;; make build
</pre>
</li>

<li>
<a href="upgrade-minifaq.html#1.9">Actualizar <em>/etc</em>
<em>/var</em> y <em>/dev/MAKEDEV</em></a> a mano.
</li>
</ol>


<p>
--
</p>

<address>
<p>
Originally [OpenBSD: upgrade-old.html,v 1.1 2002/01/17 05:21:58 kjell Exp ]<br>
$Translation: upgrade-old.html,v 1.1 2002/01/25 14:33:46 horacio Exp $<br>
$OpenBSD: upgrade-old.html,v 1.1 2002/01/26 11:46:29 jufi Exp $<br>
Copyright &copy; 1998-2002, Kjell Wooding.<br>
Env&iacute;e cualquier comentario, pregunta o sugerencia
(s&oacute;lo en ingl&eacute;s, por favor) a
<a href="mailto:kjell@openbsd.org">kjell@openbsd.org</a>
</p>
</address>

</body>
</html>
