<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <title>Gu&iacute;a de Actualizaci&oacute;n de OpenBSD</title>
</head>
<body bgcolor="#ffffff" text="#000000" link="#23238e">


<h2>Gu&iacute;a de Actualizaci&oacute;n de OpenBSD</h2>
<h3>&Uacute;ltima Versi&oacute;n de OpenBSD - 2.7</h3>

<h4>Kjell Wooding 
&lt;<a href="mailto:kwooding@codetalker.com">kwooding@codetalker.com</a>&gt;
</h4>

Last Update - $OpenBSD: upgrade-minifaq.html,v 1.6 2000/09/29 07:00:06 jufi Exp $

<p>

<blockquote>
<font size="-1">
Si alguna vez ha intentado compilar los fuentes de <i>-current</i> de alguna
versi&oacute;n de OpenBSD antigua, se habr&aacute; dado cuenta de que el
proceso no siempre es f&aacute;cil.
En esta gu&iacute;a se intentan solucionar los problemas m&aacute;s comunes
que se encuentran al actualizar entre versiones de OpenBSD, o desde las
versiones a <i>-current</i>.
</font>
</blockquote>

<p>

<h3>1.0: Preguntas Generales sobre la Actualizaci&oacute;n</h3>

<a href="#1.1">
1.1: Terminolog&iacute;a.  &iquest;Qu&eacute; es <i>-current</i>?
&iquest;Qu&eacute; son los <i>snapshots</i>?  &iquest;Qu&eacute; es
<i>-stable</i>?
</a>
<br>

<a href="#1.2">
1.2: &iquest;Cu&aacute;l es la forma m&aacute;s f&aacute;cil de
actualizar a <i>-current</i>?
</a>
<br>

<a href="#1.3">
1.3: No puedo encontrar ning&uacute;n &quot;snapshot&quot; en el
servidor de FTP.  &iquest;D&oacute;nde est&aacute;n?
</a>
<br>

<a href="#1.4">
1.4: &iquest;C&oacute;mo obtengo los fuentes m&aacute;s recientes?
</a>
<br>

<a href="#1.5">
1.5: Ya tengo el &aacute;rbol, &iquest;c&oacute;mo lo compilo?
</a>
<br>

<a href="#1.6">
1.6: 'make build' par&oacute; en la mitad del proceso, &iquest;tengo
que hacerlo todo de nuevo?
</a>
<br>

<a href="#1.7">
1.7: Me da errores durante la compilaci&oacute;n, &iquest;qu&eacute;
hago?
</a>
<br>

<a href="#1.8">
1.8: Estoy actualizando el compilador (<code>gcc</code>) a una
versi&oacute;n m&aacute;s nueva.  &iquest;Hay alg&uacute;n
procedimiento para el sistema de arranque?
</a>
<br>

<a href="#1.9">
1.9: &iquest;Cu&aacute;l es la mejor forma de actualizar <em>/etc</em>,
<em>/var</em>, y <em>/dev</em>?
</a>
<br>

<h4><a name="1.8">
Estoy actualizando el compilador (<code>gcc</code>) a una
versi&oacute;n m&aacute;s nueva.  &iquest;Hay alg&uacute;n
procedimiento para el sistema de arranque?
</a></h4>

<p>
Debido a que la actualizaci&oacute;n de un compilador es como &laquo;el
problema del huevo y la gallina&raquo;, los cambios al compilador
original del &aacute;rbol requieren que se les preste algo m&aacute;s
de atenci&oacute;n.  Por regla general se seguir&aacute; este
procedimiento:

<p>
(... y s&iacute;, se compilar&aacute; dos veces)

<pre>
  # rm -r /usr/obj/gnu/egcs/gcc/*
  # cd /usr/src/gnu/egcs/gcc
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
  # make -f Makefile.bsd-wrapper clean
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper 
  # make -f Makefile.bsd-wrapper install
</pre>

y a continuaci&oacute;n ejecute un <kbd>make build</kbd> normal.


<h4><a name="1.9">
1.9: &iquest;Cu&aacute;l es la mejor forma de actualizar <em>/etc</em>,
<em>/var</em>, y <em>/dev</em>?
</a></h4>

<p>
<strong>Respuesta corta</strong>: A mano.

<p>
<strong>Respuesta larga</strong>:

<p>
Como parte de la pol&iacute;tica de OpenBSD, el <em>software</em> en el
&aacute;rbol de cvs no modifica los ficheros en <em>/etc</em> de forma
autom&aacute;tica.  Esto quiere decir que es <strong>siempre</strong>
el administrador quien debe llevar a cabo las modificaciones necesarias
a los ficheros de configuraci&oacute;n.  Las actualizaciones no
constituyen una excepci&oacute;n.  Para actualizar los ficheros en
estos directorios, primero determine qu&eacute; cambios ha sufrido los
ficheros b&aacute;sicos de la distribuci&oacute;n, y a
continuaci&oacute;n vuelva a aplicar esos cambios manualmente.

<p>
Por ejemplo, para ver los ficheros que han cambiado m&aacute;s
recientemente en el &aacute;rbol, haga:

<pre>
  # cd /usr/src/etc
  # ls -lt |more
</pre>

Para ver todos los cambios en <em>/etc</em> entre versiones de OpenBSD
arbitrarias, puede usar <a href="../../es/anoncvs.html">CVS</a>.  Por
ejemplo, para ver los cambios acontecidos entre 2.6 y 2.7, haga:

<pre>
  # cd /usr/src/etc
  # cvs diff -u -rOPENBSD_2_6 -rOPENBSD_2_7
</pre>

Una vez que haya identificado los cambios, vuelva a aplicarlos a su
&aacute;rbol local, conservando cualquier configuraci&oacute;n a nivel
local que haya hecho Vd. anteriormente.


<h3>2.0: Actualizar desde la Versi&oacute;n 2.3</h3>

<a href="#2.1">
2.1: &iquest;Cu&aacute;les son los mayores problemas para actualizar
desde la 2.3 a la 2.4?
</a>
<br>

<a href="#2.2">
2.2: He intentado compilar todo, pero falla cuando intento compilar
<i>ssleay</i>.
</a>
<br>

<a href="#2.3">
2.3: He intentado compilar todo, pero 'make' falla para PowerPC.
</a>
<br>


<h3>3.0: Actualizar desde la Versi&oacute;n 2.4</h3>

<a href="#3.1">
3.1: &iquest;Cu&aacute;les son los mayores problemas para actualizar
desde la 2.4 a la 2.5?
</a>
<br>

<a href="#3.2">
3.2: He intentado compilar, pero falla en cap_mkdb.
</a>
<br>


<h3>4.0: Actualizar desde la Versi&oacute;n 2.5</h3>

<a href="#4.1">
4.1: &iquest;Cu&aacute;les son los mayores problemas para actualizar
desde la 2.5 a la 2.6?
</a>
<br>

<a href="#4.2">
4.2: &iquest;C&oacute;mo actualizo <i>gcc</i> a <i>egcs</i>?
</a>

<blockquote>
<font size="-1">
<a href="#4.2.1">4.2.1 - i386 y sparc ya no usan #define</a><br>
<a href="#4.2.2">4.2.2 - La compilaci&oacute;n falla en xlint</a><br>
<a href="#4.2.3">4.2.3 - &laquo;Volcado de Memoria&raquo; (&quot;Core
			 Dump&quot;) en uthread_autoinit.c</a><br>
<a href="#4.2.4">4.2.4 - egcs parece mucho m&aacute;s lento que
                         gcc</a><br>
<a href="#4.2.5">4.2.5 - egcs genera c&oacute;digo de mayor
			 tama&ntilde;o que gcc</a><br>
<a href="#4.2.6">4.2.6 - Despu&eacute;s de instalar egcs, me queda muy
                         poco espacio en el disco</a><br>
<a href="#4.2.7">4.2.7 - La compilaci&oacute;n falla al compilar
                         libcurses</a><br>
<a href="#4.2.8">4.2.8 - 'make obj' falla</a>
</font>
</blockquote>

<a href="#4.3">
4.3: <i>make build</i> muere con errores de tipo <i>unimplemented
syscall</i>.
</a>
<br>

<a href="#4.4">
4.4: Enlace al nuevo directorio 2.6.
</a>
<br>

<a href="#4.5">
4.5: Despu&eacute;s de <b>(U)</b>pgrade (actualizar), la
extracci&oacute;n de <i>base26.tar.gz</i> falla con un mensaje.
</a>

<h3>5.0 - Actualizar desde la Versi&oacute;n 2.6</h3>

<a href="#5.1">
5.1: Las entradas de termcap son demasiado largas.
</a>
<br>

<a href="#5.2">
5.2: El n&uacute;cleo del sistema ya no reconoce mi dispositivo
<i>pn</i> (o <i>mx</i>, <i>al</i>, <i>ax</i>).
</a>
<br>

<a href="#5.3">
5.3: Actualizar de gcc 2.95.1 a 2.95.2
</a>
<br>

<a href="#5.4">
5.4: Actualizar Kerberos.
</a>
<br>

<a href="#5.5">
5.5: Actualizar M4.
</a>
<br>

<a href="#5.6">
5.6: Actualizar Sendmail.
</a>
<br>

<a href="#5.7">
5.7: Despu&eacute;s de actualizar, los n&uacute;cleos que incluyen
<i>apm(8)</i> ya no arrancan.
</a>
<br>

<h3>6.0 - Actualizar desde la versi&oacute;n 2.7 a <i>-current</i></h3>

<a href="#6.1">
6.1: Actualizar gcc 2.95.2 a 2.95.3-pre (27 de mayo)
</a>
<br>

<p>

&nbsp;<hr width="30%"><p>

<p>
<h3>1.0: Preguntas Generales sobre la Actualizaci&oacute;n</h3>

<p>
<a name="1.1"></a>
<h4>1.1: Terminolog&iacute;a. &iquest;Qu&eacute; es <i>-current</i>?
&iquest;Qu&eacute; son los <i>snapshots</i>?  &iquest;Qu&eacute; es
<i>-stable</i>?</h4>

<p>
Con anterioridad a OpenBSD 2.7, el desarrollo de OpenBSD ten&iacute;a
lugar desde un s&oacute;lo &aacute;rbol de fuentes sin ramificaciones.
A partir de la versi&oacute;n 2.7 se introdujo una ramificaci&oacute;n
de parches.

<p>
Las &laquo;versiones oficiales&raquo; (&quot;releases&quot;) de OpenBSD
se producen con intervalos aproximados de seis meses.  &Eacute;stas se
enumeran en un modo convencional (2.x).  La versi&oacute;n oficial de
OpenBSD actual es la 2.7.

<p>
<b>-current</b>, la contracci&oacute;n de <i>openbsd-current</i>
(&laquo;openbsd-actual&raquo;), se refiere a la versi&oacute;n de
&uacute;ltima hora del &aacute;rbol de fuentes contenida en el
repositorio de CVS.  &Eacute;ste es el &aacute;rbol que usan con
m&aacute;s asiduidad los desarrolladores de OpenBSD.  El &aacute;rbol
<i>-current</i> contiene todo el c&oacute;digo que est&aacute; planeado
para el lanzamiento de la siguiente versi&oacute;n.  De vez en cuando,
algunos valientes abandonan las versiones oficiales y utilizan
<i>openbsd-current</i>, generalmente para aprovechar funcionalidades
que todav&iacute;a no se han implementado en las versiones oficiales.
Sin embargo, debido a su naturaleza de incertidumbre, la
actualizaci&oacute;n a <i>-current</i> no se recomienda a usuarios no
t&eacute;cnicos.

<p>
Entre una versi&oacute;n oficial y otra, se ponen a disposici&oacute;n
unas versiones llamadas 
<i><a href="ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/">snapshots</a></i>.
&Eacute;stas son versiones de prueba del &aacute;rbol de fuentes de
<i>-current</i>.  Debido a que son un reflejo del estado actual de
desarrollo, no se puede garantizar que los <i>snapshots</i> funcionen
correctamente... ni siquiera que funcionen.  Los <i>snapshots</i> son
bastante &uacute;tiles cuando se est&aacute; actualizando desde una
versi&oacute;n oficial (o una versi&oacute;n de <i>-current</i>
m&aacute;s antigua) a la del &aacute;rbol actual.

<p>
A partir de OpenBSD 2.7 se introdujo una 
<a href="../../es/stable.html">ramificaci&oacute;n de parches</a>
(llamada <b>-stable</b>).  Esta ramificaci&oacute;n contiene la
versi&oacute;n oficial (&quot;release&quot;) base de 2.7, m&aacute;s
cualquier parche que se haya publicado en la p&aacute;gina de erratas.

<p>
<a name="1.2"></a>
<h4>1.2: &iquest;Cu&aacute;l es la forma m&aacute;s f&aacute;cil de
actualizar a <i>-current</i>?</h4>

<p>
Debido a cambios en las bibliotecas de base, actualizar de una
versi&oacute;n oficial a <i>-current</i> no siempre es f&aacute;cil.
La forma m&aacute;s dif&iacute;cil de actualizar a <i>-current</i> es
actualizar primero al <i>snapshot</i> m&aacute;s reciente (por lo
general, mediante una instalaci&oacute;n por FTP).  Una vez el
<i>snapshot</i> ha sido instalado, se pueden <a href="#1.4">obtener</a>
los fuentes m&aacute;s recientes y <a href="#1.5">compilarlos</a>.
Este procedimiento deber&iacute;a eliminar la mayor&iacute;a de
problemas con las bibliotecas y las herramientas necesarias.

<p>
<a name="1.3"></a>
<h4>1.3: No puedo encontrar ning&uacute;n &quot;snapshot&quot; en el
servidor de FTP.  &iquest;D&oacute;nde est&aacute;n?</h4>

<p>
Los <i>snapshots</i> se sol&iacute;an retirar de los servidores de
distribuci&oacute;n justo antes del lanzamiento de una nueva
versi&oacute;n oficial.  Esto ya no forma parte de la pol&iacute;tica
de OpenBSD.

<p>
Los <i>snapshots</i> se pueden retirar seg&uacute;n se vayan anticuando
(o seg&uacute;n dejen de ser relevantes).  Si no hay ning&uacute;n
<i>snapshots</i> disponible, entonces debe actualizar a la
versi&oacute;n m&aacute;s reciente y compilar lo restante desde los
fuentes.

<p>
<a name="1.4"></a>
<h4>1.4: &iquest;C&oacute;mo obtengo los fuentes m&aacute;s
recientes?</h4>

<p>
Respuesta corta:
<a href="../../es/anoncvs.html">http://www.openbsd.org/es/anoncvs.html</a>

<p>
Por ejemplo, para obtener el &aacute;rbol completo mediante CVS (usando
la shell bash;  para otras, substituya <i>export</i> por
<i>setenv</i>):

<pre>
# export CVSROOT=anoncvs@anoncvs.ca.openbsd.org:/cvs
# export CVS_RSH=/usr/local/bin/ssh
# cd /usr
# cvs -q get -PA src
</pre>

<p>
<a name="1.5"></a>
<h4>1.5: Ya tengo el &aacute;rbol, &iquest;c&oacute;mo lo compilo?</h4>

<p>
Hay unas instrucciones b&aacute;sicas en /usr/src/Makefile.
&Eacute;sta es una versi&oacute;n ligeramente extendida.

<ol>
<li>Limpie los ficheros objeto antiguos.

<p>
Si hab&iacute;a creado un directorio /usr/obj separado, l&iacute;mpielo
y reconstruya los enlaces simb&oacute;licos:

<pre>
# rm -rf /usr/obj
# mkdir /usr/obj
# cd /usr/src
# make obj
</pre>

Si se encuentra con que tiene que realizar este paso muchas veces,
puede encontrar mucho m&aacute;s r&aacute;pido poner <em>/usr/obj</em>
en su propia partici&oacute;n y usar <kbd>newfs</kbd> en lugar de
<kbd>rm</kbd>.  Por ejemplo, lo que yo hago es:

<pre>
# umount /dev/wd0h                 (la partici&oacute;n /usr/obj)
# newfs wd0h
# mount -a
# make obj
</pre>

Si est&aacute; preocupado porque pueda haber ficheros objeto en su
&aacute;rbol de fuentes, haga lo siguiente:

<pre>
# cd /usr/src
# find . -type l -name obj | xargs rm
# make cleandir
# rm -rf /usr/obj
# mkdir /usr/obj
# make obj
</pre>

<li>Lleve a cabo cualquier cambio de configuraci&oacute;n
espec&iacute;fico para la versi&oacute;n.  Por ejemplo, los usuarios de
la versi&oacute;n 2.3 deben a&ntilde;adir el usuario y el grupo
<strong>named</strong> antes de actualizar a la versi&oacute;n 2.4 o
posterior.  Lea la secci&oacute;n espec&iacute;fica para su
versi&oacute;n en este documento.


<li>Aseg&uacute;rese de que todos los directorios apropiados hayan sido
creados.  Esto es muy importante cuando se actualiza desde versiones
m&aacute;s antiguas, pero a veces necesario en otros casos.  La forma
m&aacute;s f&aacute;cil de hacerlo es:

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

<li>Compile un nuevo n&uacute;cleo (&quot;kernel&quot;):

<pre>
# cd /usr/src/sys/arch/`machine`/conf
# cp GENERIC MYKERNEL
# vi MYKERNEL
(edite MYKERNEL como le convenga)
# config MYKERNEL
# cd ../compile/MYKERNEL
# make clean &amp;&amp; make depend &amp;&amp; make
(s&oacute;lo en la arquitectura arc) copie bsd.ecoff en su partici&oacute;n FAT
# cp /bsd /bsd.old &amp;&amp; cp bsd /bsd
# chown root.wheel /bsd (if you compiled as someone else)
(reinicie)
</pre>


<li>Compile el sistema:

<pre>
# cd /usr/src
# make build
</pre>


<li>Actualice <em>/etc</em> y <em>/dev</em> a mano.  &Eacute;stos no se
actualizan de forma autom&aacute;tica.  Escoja un directorio con
espacio suficiente para <em>/</em>, <em>/dev</em>, <em>/var</em>, y
<em>/etc</em>.  En este ejemplo usar&eacute; <em>/home/newroot</em> 
<p>
(<b>Nota</b>: aseg&uacute;rese de que la jerarqu&iacute;a de directorio
que escoja no tenga permiso de escritura para grupo (g+w) u otro
permiso de escritura (o+w), o sendmail se quejar&aacute; durante este
paso.  Esto hace que <em>/tmp</em> sea una mala elecci&oacute;n):

<pre>
# mkdir /home/newroot          
# export DESTDIR=/home/newroot
# cd /usr/src/etc &amp;&amp; make distribution-etc-root-var
</pre>

Ahora compare los ficheros en <em>/home/newroot</em> con sus
correspondientes ya instalados.  Reemplace o actualice los ficheros
seg&uacute;n sea necesario.

<pre>
# rm -rf /home/newroot   (cuando haya acabado)
</pre>


<li>Reinicie para asegurarse de que los nuevos ficheros en
<em>/etc</em> sean los correctos.
</ol>

<p>
<a name="1.6"></a>
<h4>1.6: 'make build' par&oacute; en la mitad del proceso,
&iquest;tengo que hacerlo todo de nuevo?</h4>

<p>
Yo lo har&iacute;a, pero si realmente quiere retomarlo desde el punto
en que se qued&oacute;, haga lo siguiente:

<pre>
# cd /usr/src
# make -n build
</pre>

De este modo le mostrar&aacute; lo que 'make build' est&eacute;
haciendo.  Por ejemplo, el m&iacute;o dice:

<pre>
(cd /usr/src/share/mk &amp;&amp;  make install)
(cd /usr/src/include; make prereq;  make includes)
make cleandir
(cd /usr/src/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
(cd /usr/src/gnu/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
(cd /usr/src/kerberosIV/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
(cd /usr/src/gnu/usr.bin/perl &amp;&amp;  make -f Makefile.bsd-wrapper config.sh &amp;&amp;  make
e -f Makefile.bsd-wrapper depend &amp;&amp;  make -f Makefile.bsd-wrapper perl.lib &amp;&amp;
make -f Makefile.bsd-wrapper install.lib)
make depend &amp;&amp; make &amp;&amp;  make install
</pre>

Para empezar desde donde se qued&oacute;, vuelva a invocar las
&oacute;rdenes desde el punto en donde se cort&oacute; la
compilaci&oacute;n.

<p>
Si tiene que realizar este procedimiento muchas veces, es posible que
le convenga crear un nuevo objetivo en su fichero makefile.
S&oacute;lo tiene que copiar la entrada para <i>build</i> (a
<i>build-noclean</i>, por ejemplo), y eliminar la referencia <i>make
cleandir</i>.

<p>
<a name="1.7"></a>
<h4>1.7: Me da errores durante la compilaci&oacute;n,
&iquest;qu&eacute; hago?</h4>

<p>
Si su 'make build' finaliza con un error, es muy posible que se deba a
que no elimin&oacute; sus ficheros objeto antiguos antes de recompilar.
Lea la <a href="#1.5">secci&oacute;n 1.5</a> para m&aacute;s detalles
sobre c&oacute;mo limpiar esos ficheros.

<p>
Si est&aacute; seguro de que su &aacute;rbol est&aacute; limpio de
viejos restos, y a&uacute;n as&iacute; recibe un error de
compilaci&oacute;n, es que ha ocurrido una de las siguientes tres
cosas:

<ol>
<li>Se ha encontrado con un problema de actualizaci&oacute;n conocido.
    Aseg&uacute;rese de haber leido la secci&oacute;n apropiada de este
    documento, y de haber seguido las instrucciones con cuidado.

<li>Se ha encontrado con un problema de actualizaci&oacute;n nuevo.
    Esto es lo que pasa cuando se vive peligrosamente.  Busque entre
    los mensajes m&aacute;s recientes a las listas 
    <a href="../../es/mail.html">misc@ y tech@</a> una posible
    soluci&oacute;n.

<li>Alguien ha &laquo;roto&raquo; temporalmente el &aacute;rbol de
    fuentes.  Esto es muy poco com&uacute;n, y por lo general se
    soluciona inmediatamente.  Espere unas pocas horas y vuelva a
    obtener el &aacute;rbol de fuentes.  Si no puede esperar, intente
    bajarse un &aacute;rbol con uno o dos d&iacute;as de
    antelaci&oacute;n.
</ol>

Si ya ha probado todas las alternativas anteriores y su problema
persiste durante m&aacute;s de un par de d&iacute;as, env&iacute;e un
informe sobre su problema a misc@openbsd.org.  Aseg&uacute;rese de
incluir los mensajes de error relevantes, as&iacute; como cualquier
peculiaridad de su configuraci&oacute;n.

<p>
<h3>2.0: Actualizar desde la Versi&oacute;n 2.3</h3>

<p>
<a name="2.1"></a>
<h4>2.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.3 a la 2.4?</h4>

<p>
<h4>Nuevo usuario: <i>named</i></h4>

<p>
Con posterioridad a la versi&oacute;n 2.3, el d&aelig;mon de DNS
<i>named</i> se cambi&oacute; a una jaula chroot.  Para hacer este
cambio posible, se cre&oacute; el usuario <i>named</i>.  Si
todav&iacute;a no lo tiene, necesitar&aacute; crearlo para estar seguro
de que todos los directorios se crean correctamente durante el proceso
de compilaci&oacute;n.

<p>
A&ntilde;ada la siguiente entrada a /etc/passwd, usando vipw:

<pre>
named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin
</pre>

A&ntilde;ada lo siguiente a /etc/group:

<pre>
named:*:70:
</pre>

<p>
<a name="2.2"></a>
<h4>2.2: He intentado compilar todo, pero falla cuando intento compilar
<i>ssleay</i>.</h4>

<p>
Probablemente le falte una entrada para el usuario <i>named</i> en el
fichero de la contrase&ntilde;a.

<p>
<b>Respuesta corta:</b>

<p>
Cree este usuario antes de la compilaci&oacute;n.

<p>
<b>Respuesta larga:</b>

<p>
El usuario <i>named</i> es necesario para configurar correctamente los
permisos.  Si este usuario faltara, parte del proceso de
compilaci&oacute;n fallar&iacute;a.  Si hiciera una captura de pantalla
de su compilaci&oacute;n de un fichero (por ejemplo, con <i>make build
&amp;&gt;/tmp/build.log</i>), notar&iacute;a el siguiente mensaje:

<pre>
(cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)
</pre>

Desafortunadamente para nosotros, la compilaci&oacute;n
continuar&iacute;a felizmente su camino, ignorando completamente el
hecho de que ha ocurrido un error.

<p>
Si el usuario <i>named</i> existiera, mtree funcionar&iacute;a
correctamente:

<pre>
missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

En este caso, la raz&oacute;n de que fallara ser&iacute;a que el
directorio <i>/usr/include/ssl</i> nunca fue creado.  Sin los ficheros
de cabeceras, la compilaci&oacute;n de <i>ssleay</i> fallar&iacute;a.

<p>
<b>Soluci&oacute;n:</b>

<p>
Cree el usuario y el grupo <i>named</i>.  Elimine
<i>/usr/include/ssl</i>, <i>/var/named</i>, y cualquier otro directorio
de la lista anterior que hubiera sido creado por error como un fichero
normal por 'make build'.

<p>
<a name="2.3"></a>
<h4>2.3: He intentado compilar todo, pero 'make' falla para
PowerPC.</h4>

<p>
Su &aacute;rbol del directorio es incompleto.  En concreto, falta el
directorio <i>/usr/share/man/cat4/powerpc</i>.

<p>
<b>Soluci&oacute;n r&aacute;pida:</b>

<p>
Cree este directorio y proceda con la compilaci&oacute;n.

<p>
<b>Soluci&oacute;n completa:</b>

<p>
Cree el &aacute;rbol del directorio completo:

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

Es probable que vea una salida como la siguiente:

<pre>
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

Note que <i>/usr/share/man/cat4/powerpc</i> es uno de los directorios
creados por este proceso.

<p>
<h3>3.0: Actualizar desde la Versi&oacute;n 2.4</h3>

<p>
<a name="3.1"></a>
<h4>3.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.4 a la 2.5?</h4>

<p>
<h4>cap_mkdb</h4>

<p>
La sintaxis para invocar <i>cap_mkdb</i> ha cambiado ligeramente.
Antes de hacer un 'make build', recompile <i>cap_mkdb</i> desde los
fuentes m&aacute;s recientes:

<pre>
# cd /usr/src/usr.bin/cap_mkdb
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

Y 'make build' deber&iacute;a seguir el proceso hasta que estuviera
completo.

<p>
<h4>Cambios en las p&aacute;ginas de manual (&quot;man
pages&quot;)</h4>

<p>
Varias p&aacute;ginas de manual se cambiaron desde la secci&oacute;n 1
a secciones posteriores.  Desafortunadamente, si las p&aacute;ginas de
manual viejas se dejan en la secci&oacute;n 1, los usuarios que no lo
sepan no podr&aacute;n ver las &uacute;ltimas versiones de las
p&aacute;ginas.

<p>
Las siguientes p&aacute;ginas se deber&iacute;an eliminar:

<pre>
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0
</pre>

<p>
<h4>Snake</h4>

<p>
Tiene que eliminar el contenido del directorio <i>obj/</i> antes de
actualizar <code>/usr/src/games/snake</code>.

<p>
<a name="3.2"></a>
<h4>3.2: He intentado compilar, pero falla en cap_mkdb.</h4>

<p>
<b>S&iacute;ntoma:</b>

<p>
'make build' da como resultado un error como &eacute;ste:

<pre>
cap_mkdb -i -f terminfo terminfo.src
cap_mkdb: illegal option -- i
usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
*** Error code 1
</pre>

<p>
<b>Soluci&oacute;n r&aacute;pida:</b>

<p>
Necesita compilar un nuevo <i>cap_mkdb</i>.  Mire en la 
<a href="#3.1">secci&oacute;n 3.1</a>.

<p>
<h3>4.0: Actualizar desde la Versi&oacute;n 2.5</h3>

<p>
<a name="4.1"></a>
<h4>4.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.5 a la 2.6?</h4>

<p>
<h5><i>perl</i> y <i>make</i></h5>

<p>
La &uacute;ltima versi&oacute;n de Perl (5.005_03) requiere una nueva
versi&oacute;n de <i>make</i> para compilar correctamente.  Debe
recompilar make antes de compilar el nuevo Perl.  Haga lo siguiente:

<pre>
# cd /usr/src/usr.bin/make
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Ahora contin&uacute;e y recompile el nuevo Perl.  Necesitar&aacute;
limpiar el directorio <code>obj</code> de Perl a mano antes de
compilar.

<p>
Los desarrolladores de Perl deber&iacute;an tomar nota de los
&uacute;ltimos cambios.

<p>
De millert@openbsd.org:

<pre>
La versi&oacute;n de perl en el &aacute;rbol de fuentes de OpenBSD (posterior
a 2.5) se ha actualizado a 5.005_03.  El m&eacute;todo de compilaci&oacute;n
ha cambiado algo, pero casi todo deber&iacute;a ser invisible.  Los cambios
importantes que afectan a los usuarios son los siguientes:

1) Los ficheros lib de perl han cambiado de /usr/lib/perl5 al m&aacute;s
correcto /usr/libdata/perl5
2) Los directorios site_perl por definici&oacute;n est&aacute;n ahora en
/usr/local.  O sea, si instala un m&oacute;dulo de perl, se ubicar&aacute; en
/usr/local/libdata/perl5/site_lib.  Esto facilita que pueda ver qu&eacute;
m&oacute;dulos no est&acute;ndar tiene.  Tambi&eacute;n significa que podemos
tener m&oacute;dulos de perl en el sistema de portes con facilidad.
3) Las p&aacute;ginas de manual de la biblioteca de perl est&aacute;n ahora
instaladas en /usr/share/man/cat3p.  Necesitar&aacute; actualizar el fichero
man.conf en base al directorio src/etc/man.conf para poder aprovecharlo.
Esto quiere decir que ahora puede hacer 'man 3p less' y obtener
informaci&oacute;n sobre el pragma de less, pero 'man less' le seguir&aacute;
mostrando la p&aacute;gina de manual del paginador less.

Si tiene m&oacute;dulos u otros ficheros de perl no est&aacute;ndar, lo mejor
que puede hacer es mover /usr/lib/perl5 a /usr/libdata/perl5 y a&ntilde;adir
un enlace de /usr/lib/perl5 a /usr/libdata/perl5.  Alternativamente,
podr&iacute;a editar el fichero instalado Config.pm y arreglar los caminos
desde ah&iacute;.
</pre>
</p>

<p>
<h5>Cambio del compilador: <i>egcs</i> reemplaza a <i>gcc</i></h5>

<p>
Este cambio es probablemente el m&aacute;s significativo que
encontrar&aacute;.  Para ver instrucciones detalladas, lea la 
<a href="#4.2">secci&oacute;n 4.2</a>.

<p>
<h5>Cambio en la estructura del n&uacute;cleo -<i>statfs</i></h5>

<p>
La estructura <tt>statfs</tt> ha cambiado desde el 31 de mayo.  Debe
recompilar el n&uacute;cleo de su sistema antes de intentar un 'make
build'.  Lea la <a href="#4.3">secci&oacute;n 4.3</a> para m&aacute;s
detalles.

<p>
<a name="4.2"></a>
<h4>4.2: &iquest;C&oacute;mo actualizo <i>gcc</i> a <i>egcs</i>?</h4>

<p>
El modo m&aacute;s seguro es actualizar a un <i>snapshot</i> reciente,
en cuanto haya uno disponible.  <b>&iexcl;Busque un <i>snapshot</i>
primero!</b>.  Arrancar el compilador nuevo desde el viejo
deber&iacute;a ser el <i>&uacute;ltimo recurso</i>.

<p>
Antes que nada, le avisamos que en algunas plataformas el mecanismo de
arranque todav&iacute;a no es perfecto.  Hasta la fecha, deber&iacute;a
funcionar en las siguientes, si lleva cuidado:

<ul>
<li><b>i386</b>
<li><b>sparc</b>
<li><b>m68k</b>
<li><b>alpha</b>
</ul>
Hay problemas con <b>mips</b> y <b>rs6000</b>.

<p>
Para probar si su plataforma puede arrancar desde el disco, instale
<i>egcs-snapshot</i>, que se encuentra disponible en la 
<a href="../../es/ports.html">colecci&oacute;n de portes</a>.  Si
funciona, la versi&oacute;n del &aacute;rbol tambi&eacute;n lo
har&aacute;.  &Eacute;ste es el m&eacute;todo <i>m&acute;s seguro</i>
para proceder.

<p>
Antes de continuar, aseg&uacute;rese de que las copias que tenga de
<i>binutils</i>, <i>gas</i>, y <i>ld</i> est&eacute;n actualizadas.
Recuerde que existen dos copias de <i>gas</i> y <i>ld</i> en el
&aacute;rbol.  En <b>i386</b> y <b>sparc</b>, no se usan las versiones
de <i>binutils</i>.  Debe usar en su lugar
<tt>/usr/src/gnu/usr.bin/gas</tt> y <tt>/usr/src/gnu/usr.bin/ld</tt>.

<p>
Las siguientes instrucciones se refieren al <i>snapshot</i> original de
egcs (egcs-990517).  Desde entonces existe en el &aacute;rbol un
segundo <i>snapshot</i> (egcs-990608).  Si viene de la versi&oacute;n
&quot;vainilla&quot; 2.5, es muy probable que no pueda compilar la
&uacute;ltima versi&oacute;n directamente.  En este caso tendr&aacute;
que arrancar con una versi&oacute;n intermedia siguiendo estas
instrucciones:

<p>
De espie@openbsd.org:

<blockquote>
<pre>
Hoy cambia el compilador.

Sale gcc 2.8.1, entra egcs ... o para ser m&aacute;s exactos, la
versi&oacute;n previa de gcc 2.95.

Probablemente esto suponga un duro cambio, pero no puedo calcular todos los
detalles para todas las arquitecturas yo solo.

Voy a empezar a importar partes *ahora*.  Enviar&eacute; un segundo mensaje a
tech@ una vez todo est&eacute; asentado...

Gracias a todos los que me ayudaron a ordenar las partes, de forma especial a
niklas, turan, y millert.

Porqu&eacute; del cambio
-----------------
como muchos ya sabr&aacute;n, egcs es ahora el compilador *oficial* soportado
por la FSF.  La futura versi&oacute;n de julio ha sido renombrada gcc 2.95.

Simplemente mirando a los mensajes se pueden ver muchas mejoras:
el soporte para nuevos procesadores es mejor, C++ se acerca m&aacute;s a las
normativas ANSI/ISO, Fortran 77 se encuentra m&aacute;s integrado.
Tambi&eacute;n hay una inmensa cantidad de errores solucionados y mejoras en
la generaci&oacute;n del c&oacute;digo.

Adem&aacute;s, el desarrollo es m&aacute;s abierto.  Hay un &aacute;rbol de 
cvs, varias listas de correo, y estamos cooperando m&aacute;s con el equipo
de egcs.  Para ser m&aacute;s exacto, he estado enviando parches al equipo de
egcs, para que las configuraciones de OpenBSD est&eacute;n soportadas
oficialmente.
Tambi&eacute;n, el equipo de desarrollo ha respondido con frecuencia a los
informes de errores, y los problemas se solucionan.

Tambi&eacute;n hay un fen&oacute;meno a tener en cuenta: todo el mundo
est&aacute; cambiando a egcs, lo que se traduce en montones de c&oacute;digo
para probar el compilador, y que podemos beneficiarnos de proyectos
relacionados.

Porqu&eacute; ahora
------------
egcs-1.1 no estaba preparado para algunos prop&oacute;sitos.  En concreto, el
tama&ntilde;o del c&oacute;digo en i386 era mayor que gcc 2.8.1, lo que
resultaba en problemas con los disquetes.
En el momento de &laquo;congelar&raquo; 2.5, el &uacute;nico c&oacute;digo
que se pod&iacute;a incluir era un snapshot algo inestable.  En
inter&eacute;s de la estabilidad, despu&eacute;s de considerarlo mucho, egcs
no fue incluido en 2.5.

Ahora, el proyecto egcs est&aacute; en un ciclo de lanzamiento que
acabar&aacute; en egcs 1.2.  Juzgando por su programa de tiempo en el 
proyecto, existe un amplio margen entre egcs 1.2 y el lanzamiento de la 
pr&oacute;xima versi&oacute;n de OpenBSD.  Adem&aacute;s, queremos empezar 
ahora para que podamos tener la oportunidad de enviar informes sobre 
problemas en arquitecturas de uso menos frecuente, y tenerlo todo solucionado 
para la versi&oacute;n 1.2.

La `congelaci&oacute;n de las funcionalidades' de egcs est&aacute; programada
para el 7 de mayo, y en el snapshot actual 19990502 parece s&oacute;lido.

Qu&eacute; funciona y qu&eacute; no
---------------------
egcs funciona en los sistemas OpenBSD para i386 sin problemas.  m68k
tambi&eacute;n funciona, con algunos arreglos relacionados con errores
extra&ntilde;os que ser&aacute;n solucionados.  sparc tambi&eacute;n parece
funcionar bien.  Hay alg&uacute;n problema con el enlazador en algunas otras
arquitecturas que necesita ser solucionado antes de nuestro pr&oacute;ximo
lanzamiento.

En este momento, los constructores a trav&eacute;s de bibliotecas
din&aacute;micas todav&iacute;a no est&aacute; preparados.

egcs ahora dispone de un cpp propio que va a ser mejor que la actual
soluci&oacute;n que usamos.  Esto significa unos pocos cambios en la interfaz
y probablemente avisos extra&ntilde;os.

&iquest;Mantener gcc 2.8.1?
--------------------
debido a restricciones de tama&ntilde;o, en cuanto se importe egcs, gcc
pasar&aacute; al &Aacute;tico del cvs.  Si no quiere tener egcs ahora,
deber&aacute; tener cuidado en sus actualizaciones de cvs.
Algunos ficheros Makefile est&aacute;n ligados al cambio: includes,
gnu/usr.bin, y gnu/lib.  xlint y cpp.sh tambi&eacute;n cambiar&aacute;n.

C&oacute;mo arrancar el compilador
---------------------------
el modo m&aacute;s simple es probablemente confiar en los varios mantenedores
de las arquitecturas y bajarse un snapshot.

Si quiere hacerlo del modo dif&iacute;cil, primero debe volver a compilar
directorios obj adecuados:

cd /usr/src
make obj

Si su arquitectura es i386, gas debe estar actualizado.
Si su arquitectura en sparc, ld debe estar actualizado.

y compile libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

y el compilador de C:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

recompile el compilador de C con la nueva versi&oacute;n:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

recompile los ficheros include:
cd /usr/src/include
make includes

compile todas la bibliotecas de egcs e inst&aacute;lelas:
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

instale el nuevo controlador de cpp:
cd /usr/src/usr.bin/cpp
make install

y ya est&aacute; preparado; un make build normal deber&iacute;a funcionar...
</pre>

[nota del autor: en realidad no funciona del todo.  xlint no
compilar&aacute;.  Sin embargo, la soluci&oacute;n es simple.  Ejecute
<code>make &amp;&amp; make install</code> en el directorio
<code>/usr/src/usr.bin/xlint/xlint</code> antes de ejecutar <code>make
build</code> y proceda.  Vea la <a href="#4.2.2">secci&oacute;n
4.2.2</a>.]

<pre>
Si no funciona es porque est&aacute; usando una arquitectura que no ha pasado
por make build todav&iacute;a.  Lo m&aacute;s l&oacute;gico es que sea un
&laquo;Error Interno del Compilador&raquo; (ICE, &quot;Internal Compiler
Error&quot;).

Primero intente ver si el ICE desaparece con -01 &oacute; -00.  En ese caso,
puede hacer un arreglo en el fichero Makefile hasta que sea solucionado (vea
/usr/src/lib/libm/Makefile para un ejemplo de c&oacute;mo hacer estos
arreglos en m68k).

Entonces debe enviar un informe sobre el error a la lista de correo de
egcs-bugs.

Como m&iacute;nimo, debe compilar los fuentes con la misma invocaci&oacute;n
que para el compilador, a&ntilde;adiendo -v -save-temps a las opciones.

-v muestra la secuencia exacta de &oacute;rdenes invocadas por gcc.
-save-temps le dar&aacute; un fichero preprocesado de C (.i) o de C++ (.ii)
que los desarrolladores de egcs pueden entender... no les pida que instalen
OpenBSD en sus m&aacute;quinas.

Si dispone de m&aacute;s tiempo, puede intentar recortar el fichero
preprocesado de C al m&iacute;nimo indispensable que haga saltar el error.
La dicotom&iacute;a funciona bien.
</pre>
</blockquote>

Si pas&oacute; este procedimiento y todav&iacute;a funciona todo,
felicidades.  Si no, busque consejo en las siguientes secciones.  Los
problemas que no aparezcan aqu&iacute; se deben enviar a
tech@openbsd.org.

<p>
<a name="4.2.1"></a>
<h5>4.2.1 - <tt>i386</tt> y <tt>sparc</tt> ya no usan
<tt>#define</tt></h5>

<p>
Esto es cierto.  <i>egcs</i> usa <tt>__i386__</tt> y <tt>__sparc__</tt>
que son de c&oacute;digo m&aacute;s limpio.  Si necesita compilar
c&oacute;digo que dependa en los viejos define, a&ntilde;ada
<tt>-Dsparc</tt> o <tt>-Di386</tt> a la ubicaci&oacute;n apropiada del
fichero Makefile.

<p>
<a name="4.2.2"></a>
<h5>4.2.2 - La compilaci&oacute;n falla en xlint</h5>

<p>
Esto se debe a diferencias sem&aacute;nticas en cpp.  La
soluci&oacute;n es f&aacute;cil y parecida al problema de
<i>cap_mkdb</i> descrito en la <a href="#3.1">secci&oacute;n 3.1</a>.

<p>
Haga lo siguiente:

<pre>
# cd /usr/src/usr.bin/xlint/xlint
# make &amp;&amp; make install
</pre>

ahora vuelva a ejecutar 'make', y la compilaci&oacute;n deber&iacute;a
continuar.

<p>
<a name="4.2.3"></a>
<h5>4.2.3 - &laquo;Volcado de Memoria&raquo; (&quot;Core Dump&quot;) en
<tt>uthread_autoinit.c</tt></h5>

Ha sido v&iacute;ctima de un error del enlazador.  He aqu&iacute; un
mensaje de relevancia:

<pre>
De: Marc Espie &lt;Marc.Espie@liafa.jussieu.fr&gt;
Asunto: egcs core-dumping on uthread_autoinit.c

Si le ocurre esto, es un conocido problema del enlazador... el cc1 que tiene
fue enlazado en un modo extra&ntilde;o.

Al principio hice un enlace cc1 contra /usr/lib/libiberty.a est&aacute;tico,
para evitar este problema;  pero esto s&oacute;lo era temporal y el error
reaparec&iacute;a, probablemente debido a cambios relacionados con libc u
otros...

El &aacute;rbol ha sido parcheado con un arreglo en

src/gnu/egcs/f/lang-options.h

aseg&uacute;rese de que tiene la versi&oacute;n parcheada de ese fichero (por
lo menos la revisi&oacute;n 1.2), recompile y reinstale cc1;  el problema
deber&iacute;a desaparecer.

Lo que ocurre es que el enlazador de 386 se equivoca debido a la cadena de
vectorial en toplev.c, y algo se desenlaza, de modo que 
void f(void) __attribute((constructor)) {}
mata cc1.

Como soluci&oacute;n temporal, he matado los textos de ayuda de las opciones
de Fortran, hasta que alguien encuentre d&oacute;nde comete el error el
enlazador.
</pre>

<p>
<a name="4.2.4"></a>
<h5>4.2.4 - <i>egcs</i> parece mucho m&aacute;s lento que
<i>gcc</i></h5>

<p>
Lo es, pero existe un motivo.  <i>egcs</i> act&uacute;a optimizando
m&aacute;s pases.  La alineaci&oacute;n de los datos y otras
funcionalidades semejantes mejorar&aacute;n el c&oacute;digo generado
por <i>egcs</i>.

<p>
<a name="4.2.5"></a>
<h5>4.2.5 - <i>egcs</i> genera c&oacute;digo de mayor tama&ntilde;o
<i>gcc</i></h5>

<p>
S&iacute;, lo hace.  Esto se nota especialmente con el viejo conmutador
<tt>-O2</tt> de <i>gcc</i>.  <i>egcs</i> introduce una nueva
opci&oacute;n, <tt>-Os</tt>, que optimiza el espacio.  Estos es
comparable a grandes rasgos con el viejo comportamiento <tt>-O2</tt>.

<p>
<a name="4.2.6"></a>
<h5>4.2.6 - Despu&eacute;s de instalar <i>egcs</i>, me queda muy poco
espacio en el disco</h5>

<p>
<i>egcs</i> se instala en un subdirectorio distinto al de gcc 2.8.1.
Una vez que egcs haya arrancado y funcione, puede eliminar <i>gcc</i>.
(a prop&oacute;posito de esto, los cambios en perl mencionados en la 
<a href="#4.1">secci&oacute;n 4.1</a> significan que puede eliminar el
directorio <tt>/usr/lib/perl5</tt>.  La nueva ubicaci&oacute;n para
estos datos es <tt>/usr/libdata/perl5</tt>).

<p>
<a name="4.2.7"></a>
<h5>4.2.7 - La compilaci&oacute;n falla al compilar libcurses</h5>

<p>
<i>libcurses</i> se apoya ahora en la &uacute;ltima versi&oacute;n de
<i>cpp</i>.  Obtenga la &uacute;ltima versi&oacute;n, recompile
<i>cpp</i>, y contin&uacute;e.  Por ejemplo:

<pre>
# cd /usr/src/usr.bin/cpp &amp;&amp; make install
</pre>

Y vuelva a intentar 'make build'.

<p>
<a name="4.2.8"></a>
<h5>4.2.8 - 'make obj' falla</h5>

<p>
Si <i>make obj</i> falla, nombrando errores en un Makefile, los include
de makefile es posible que est&eacute;n obsoletos.  Por ejemplo:

<pre>
===&gt; lib/libkvm
&quot;Makefile&quot;, line 30: Malformed conditional ((${UVM} == &quot;yes&quot;))
&quot;Makefile&quot;, line 30: Missing dependency operator
&quot;Makefile&quot;, line 32: if-less endif
&quot;Makefile&quot;, line 32: Need an operator
Fatal errors encountered -- cannot continue
</pre>

Esto se puede resolver recompilando los ficheros include de makefile:

<pre>
cd /usr/src/share/mk &amp;&amp; make install
</pre>

e intente compilar de nuevo.

<p>
<a name="4.3"></a>
<h4>4.3: <i>make build</i> muere con errores de tipo <i>unimplemented
syscall</i></h4>

<p>
<b>Respuesta corta:</b>

<p>
La estructura <tt>statfs</tt> del n&uacute;cleo ha cambiado.  Necesita
recompilar el n&uacute;cleo antes de intentar un <i>make build</i>.

<p>
<b>Respuesta larga:</b>

<p>
La estructura <tt>statfs</tt> del n&uacute;cleo ha cambiado.  La nueva
<tt>struct statfs</tt> tiene las siguientes funcionalidades:

<ul>
<li>Tiene un campo de indicadores <tt>u_int32_t</tt> (ahora softdep
    puede tener un indicador real).

<li>Usa <tt>u_int32_t</tt> en lugar de largos (mejor en alpha).
    Nota: la p&aacute;gina de manual ment&iacute;a sobre configurar
    campos inv&aacute;lidos o no usados a -1.  SunOS lo hace, pero
    nuestro c&oacute;digo nunca lo ha hecho.

<li>Se libera totalmente de <tt>f_type</tt>.
    No se ha usado desde NetBSD 0.9, y tenerlo ah&iacute; siempre crea
    confusi&oacute;n.  Es comprensible que esto pueda ser la causa de
    que alg&uacute;n viejo c&oacute;digo no compile, pero eso es mejor
    que fallar en silencio.

<li>A&ntilde;ade una uni&oacute;n <tt>mount_info</tt> que contiene la
    estructura <tt>FSTYPE_args</tt>.  Esto quiere decir que ahora
    <i>mount</i> le puede indicar todas las opciones que tenga un
    sistema de archivo montado.  Esto es especialmente bueno para NFS.
</ul>

Otros cambios:

<ul>
<li>La emulaci&oacute;n de statfs de Linux no convert&iacute;a entre
    nombres de sistema de archivo de BSD y n&uacute;meros
    <tt>f_type</tt> de Linux.  Ahora lo hace, ya que el n&uacute;mero
    <tt>f_type</tt> de BSD es in&uacute;til para las aplicaciones de
    Linux (y de todos modos ha sido eliminado).

<li>La estructura statfs de FreeBSD es diferencte de la nuestra (tanto
    la vieja como la nueva) y por lo tanto necesita conversi&oacute;n.
    Anteriormente, los syscalls de OpenBSD se usaban sin ninguna
    traducci&oacute;n real.

<li>Ahora <b>mount(8)</b> mostrar&aacute; informaci&oacute;n adicional
    cuando se invoque sin argumentos.  Sin embargo, para verlo
    <i>todo</i> necesitar&aacute; usar el indicador -v (verbosidad).
</ul>

<p>
<a name="4.4"></a>
<h4>4.4: Enlace al nuevo directorio 2.6</h4>

<p>
Cuando actualice a la versi&oacute;n 2.6 necesitar&aacute; crear un
enlace simb&oacute;lico para gcc.
</p>

<pre>
   cd /usr/lib/gcc-lib
   ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6
</pre>

<p>
<a name="4.5"></a>
<h4>4.5: Despu&eacute;s de <b>(U)</b>pgrade (actualizar), la
extracci&oacute;n de <i>base26.tar.gz</i> falla con un mensaje:</h4>

<p>
<i>tar: Unable to remove directory ./usr/include/machine &lt;Directory
not empty&gt;</i>
</p>

<p>
En la versi&oacute;n 2.5 <tt>/usr/include/machine</tt> era un
directorio, y <tt>/usr/include/i386</tt> era un enlace a ese
directorio.  En la versi&oacute;n 2.6 esta situaci&oacute;n se ha
revertido.
</p>

<p>
Para corregir el problema, escape a la shell, elimine el directorio
<tt>/usr/include/machine</tt>, y vuelva a intentar actualizar.
</p>

<p>
<a name="5.0"></a>
<h3>5.0 - Actualizar desde la Versi&oacute;n a 2.6</h3>
</p>

<p>
<a name="5.1"></a>
<h4>5.1: Las entradas de termcap son demasiado largas</h4>

<p>
Existe un nuevo fichero <tt>termcaps.master</tt>.  Necesitar&aacute;
regenerar los ficheros <tt>terminfo</tt> y <tt>termcaps</tt> con la
versi&oacute;n actual de tic(1).  Si est&aacute; actualizando a
trav&eacute;s de <i>make build</i>, se usar&aacute; la versi&oacute;n
correcta de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tic&apropos=0&sektion=1&manpath=OpenBSD+Current&format=html">tic(1)</a>
y regenerar&aacute; los ficheros por usted.  En caso contrario,
ver&aacute; el siguiente error:
</p>

<pre>
    terminfo.src is corrupt! You need to update /usr/bin/tic
</pre>

<p>
En tal caso, debe recompilar e instalar tic(1) (asegur&aacute;ndose de
utilizar la versi&oacute;n actual de <tt>libcurses</tt>), o simplemente
compilar la versi&oacute;n de tic(1) en su &aacute;rbol de fuentes.
</p>

<p>
<a name="5.2"></a>
<h4>5.2: El n&uacute;cleo del sistema ya no reconoce mi dispositivo
<i>pn</i> (o <i>mx</i>, <i>al</i>, <i>ax</i>)</h4>

<p>
(Nota: en algunas partes de esta secci&oacute;n se usa s&oacute;lo
<i>pn</i> para simplificar.  La informaci&oacute;n es igualmente
aplicable a <i>pn</i>, <i>mx</i>, <i>al</i>, o <i>ax</i>, seg&uacute;n
el caso)
</p>

<p>
Estos cuatro controladores han sido substituidos por el controlador
unificado <i>dc</i>.  Debe cambiar cualquier menci&oacute;n a
<i>pn*</i>, <i>mx</i>, <i>al</i>, o <i>ax</i> en sus ficheros de
configuraci&oacute;n.  Esto incluye:
</p>

<ul>
<li>Actualizar el/los fichero/s de configuraci&oacute;n del
    n&uacute;cleo (ayuda: empiece con un n&uacute;cleo GENERIC nuevo y
    modif&iacute;quelo).
<li>Mover <tt>/etc/hostname.pn*</tt> a <tt>/etc/hostname.dc*</tt>
<li>Actualizar su fichero <tt>/etc/ifaliases</tt>
<li>Realizar cambios en <tt>/etc/ipnat.rules</tt> y
    <tt>/etc/ipf.rules</tt> para que reflejen el nuevo nombre de la
    interfaz.
</ul>

<p>
Si no est&aacute; modificando un n&uacute;cleo personalizado,
aseg&uacute;rese de haber incluido el dispositivo <i>dcphy</i> en la
configuraci&oacute;n del n&uacute;cleo, de la siguiente forma:
</p>

<pre>
dcphy*  at mii? phy ?                   # PHYs Cl&oacute;nicos de Digital
</pre>

<p>
Mientras est&aacute; en ello, tambi&eacute;n puede a&ntilde;adir:
</p>

<pre>
ukphy*  at mii? phy ?                   # PHYs &quot;desconocidos&quot;
</pre>

<p>
<a name="5.3"></a>
<h4>5.3: Actualizar de gcc 2.95.1 a 2.95.2</h4>

<p>
<i>gcc</i> 2.95.2 se fusion&oacute; en el &aacute;rbol de fuentes de
OpenBSD alrededor del 19 de enero de 2.000.  Para que <i>gcc</i>
compile correctamente, se requiere una versi&oacute;n m&aacute;s
reciente de la biblioteca <i>libiberty</i> (post 2.6).  Para compilar
esta biblioteca, haga lo siguiente:
</p>

<pre>
	cd /usr/src/gnu/egcs/libiberty
	make -f Makefile.bsd-wrapper clean
	make -f Makefile.bsd-wrapper obj
	make -f Makefile.bsd-wrapper
	make -f Makefile.bsd-wrapper install
</pre>

NOTA:  En las arquitecturas basadas en mips, como pmax, debe llevar a
cabo un <i>ldconfig</i> expl&iacute;cito despu&eacute;s de compilar las
nuevas bibliotecas.

<p>
Una vez compilada <i>libiberty</i>, puede proceder con un arranque
t&iacute;pico de <i>gcc</i>:
</p>

<pre>
   cd /usr/src/gnu/egcs/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper 
   make -f Makefile.bsd-wrapper install
</pre>

<p>
<a name="5.4"></a>
<h4>5.4: Actualizar Kerberos</h4>

<p>
Para que Kerberos IV compile correctamente, necesita seguir estas
instrucciones:

<ul>
<li>Obtener y compilar la &uacute;ltima versi&oacute;n de
    <tt>usr.bin/compile_et</tt>.

<pre>
   # cd /usr/src/usr.bin/compile_et
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

<li>Obtener y compilar la &uacute;ltima versi&oacute;n de
    <tt>lib/libcom_err</tt>.

<pre>
   # cd /usr/src/lib/libcom_err
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

<li>Limpie y reinstale los ficheros cabecera de Kerberos:

<pre>
  # rm -r /usr/include/kerberosIV/*
  # cd /usr/src/kerberosIV
  # make includes
</pre>

<li>Ahora recompile los ficheros biblioteca de Kerberos:

<pre>
   # cd /usr/src/kerberosIV/lib
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

<li>Si no va a llevar a cabo un <kbd>make build</kbd> completo,
recompile Kerberos:

<pre>
   # cd /usr/src/kerberosIV
   # make cleandir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

<li>De otro modo, no tiene m&aacute;s que reiniciar 'make builld'.
</ul>
</p>

<p>
<a name="5.5"></a>
<h4>5.5: Actualizar M4</h4>

<p>
La versi&oacute;n de m4 incluida en OpenBSD 2.6 se engancha en un bucle
infinito mientras procesa los ficheros .mc de sendmail en ficheros .cf.
Debido a esto, necesitar&aacute; instalar la nueva versi&oacute;n de m4
<b>antes</b> de intentar un 'make build'.  En otras palabras:

<pre>
    # cd /usr/src/usr.bin/m4
    # make &amp;&amp; make install &amp;&amp; make cleandir
</pre>
</p>

<p>
<a name="5.6"></a>
<h4>5.6: Actualizar Sendmail</h4>

<p>
En sendmail 8.10.X, las ubicaciones (y nombres) de los ficheros de
configuraci&oacute;n de sendmail han cambiado.  Ahora todo, excepto el
fichero pid, se encuentra en /etc/mail.  Adem&aacute;s, varios ficheros
han cambiado de nombre.
</p>

<table border="0">
<tr>
  <td><b>VIEJO</b></td>
  <td><b>NUEVO</b></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cf</tt></td>
  <td><tt>/etc/mail/sendmail.cf</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cw</tt></td>
  <td><tt>/etc/mail/local-host-names</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.ct</tt></td>
  <td><tt>/etc/mail/trusted-users</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.oE</tt></td>
  <td><tt>/etc/mail/error-header</tt></td>
</tr>
<tr>
  <td><tt>/etc/aliases</tt></td>
  <td><tt>/etc/mail/aliases</tt></td>
</tr>
<tr>
  <td><tt>/etc/service.switch</tt></td>
  <td><tt>/etc/mail/service.switch</tt></td>
</tr>
<tr>
  <td><tt>/etc/userdb</tt></td>
  <td><tt>/etc/mail/userdb</tt></td>
</tr>
<tr>
  <td><tt>/usr/share/misc/sendmail.hf</tt></td>
  <td><tt>/etc/mail/helpfile</tt></td>
</tr>
</table>

<p>
Hay un par de maneras para convertir la vieja configuraci&oacute;n de
sendmail a la nueva, pero el primer paso es siempre el mismo.
</p>

<ol>
<li>Actualizar <tt>/etc/rc</tt> de modo que busque
    <tt>/etc/mail/sendmail.cf</tt> en lugar de
    <tt>/etc/sendmail.cf</tt>

<li><tt>mv /etc/sendmail.cf /etc/mail/sendmail.cf</tt><br>
    &Eacute;ste es el camino que ofrece menos resistencia y no
    tendr&aacute; que cambiar la ubicaci&oacute;n de ning&uacute;n otro
    fichero.

<li>O compilar un nuevo fichero .cf con su fichero de fuentes .mc.
    Note que ya no necesitar&aacute; especificar la l&iacute;nea:

    <pre>include(`../m4/cf.m4')</pre>

    ya que la habr&aacute; incluido 'make'.  Note tambi&eacute;n que, a
    partir de ahora, cuando a&ntilde;ada m&aacute;quinas a la clase w
    (mediante &quot;Cw nombredem&aacute;quina&quot;), tendr&aacute; que
    hacerlo en la secci&oacute;n LOCAL_CONFIG (vea como ejemplo
    <tt>openbsd-lists.mc</tt>).
</ol>

<p>
<a name="5.7"></a>
<h4>5.7: Despu&eacute;s de actualizar, los n&uacute;cleos que incluyen
soporte para 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html">apm(8)</a>
ya no arrancan</h4>

Necesita actualizar los &laquo;bloques de arranque&raquo;
(&quot;bootblocks&quot;).  Ver la 
<a href="faq14.html#14.8">secci&oacute;n 14.8</a> de las preguntas
frecuentes para m&aacute;s detalles.


<h3><a name="6.0">
6.0 - Actualizar desde la versi&oacute;n 2.7 a <i>-current</i></a></h3>

<h4><a name="6.1">
6.1: Actualizar gcc 2.95.2 a 2.95.3-pre (27 de mayo)</a></h4>

<p>
<code>gcc</code> se ha actualizado a la versi&oacute;n 2.95.3 pre-release.
Siga los <a href="#1.8">procedimientos normales</a> para actualizar a
una nueva versi&oacute;n de <code>gcc</code>


<p>
<font size="-1">
--
<br>
Originally [OpenBSD: upgrade-minifaq.html,v 1.38 2000/08/07 06:18:51 kjell Exp ]<br>
$Translation: upgrade-minifaq.html,v 1.6 2000/09/28 08:26:34 horacio Exp $<br>
$OpenBSD: upgrade-minifaq.html,v 1.6 2000/09/29 07:00:06 jufi Exp $

<br>
Copyright &copy; 1998-2000, Kjell Wooding. 
<br>
Por favor, env&iacute;e cualquier comentario, pregunta o sugerencia a
<a href="mailto:kwooding@codetalker.com">kwooding@codetalker.com</a>

</font>

</body>
</html>
