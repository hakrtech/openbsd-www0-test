<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <title>Gu&iacute;a de actualizaci&oacute;n de OpenBSD</title>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">


<h1>Gu&iacute;a de actualizaci&oacute;n de OpenBSD</h1>
<h2>&Uacute;ltima versi&oacute;n de OpenBSD - 3.0</h2>

<address>
<p>
Kjell Wooding 
&lt;<a href="mailto:kjell@openbsd.com">kjell@openbsd.org</a>&gt; <br />
Updated:
$OpenBSD: upgrade-minifaq.html,v 1.29 2002/01/19 09:12:50 jufi Exp $
</p>
</address>

<br />

<blockquote>
<p>
Si alguna vez ha intentado compilar el c&oacute;digo fuente de
la &laquo;versi&oacute;n de desarrollo&raquo;,
<em>-current</em>, de alguna versi&oacute;n de OpenBSD
antigua, se habr&aacute; dado cuenta de que el proceso no
siempre es f&aacute;cil.  En esta gu&iacute;a se intentan
solucionar los problemas m&aacute;s comunes que se encuentran
al actualizar entre versiones de OpenBSD, o desde las
&laquo;versiones finales&raquo;, <em>-release</em>, a
<em>-current</em>.
</p>
</blockquote>


<h2>1.0: Preguntas generales sobre la actualizaci&oacute;n</h2>

<p>
<a href="#1.1">
1.1: Terminolog&iacute;a.  &iquest;Qu&eacute; es
<em>-current</em>?  &iquest;Qu&eacute; son los
<em>snapshots</em>?  &iquest;Qu&eacute; es <em>-stable</em>?
</a> <br />

<a href="#1.2">
1.2: &iquest;Cu&aacute;l es la forma m&aacute;s f&aacute;cil
de actualizar a <em>-current</em>?
</a> <br />

<a href="#1.3">
1.3: No puedo encontrar ning&uacute;n <em>snapshot</em> en el
servidor de FTP.  &iquest;D&oacute;nde est&aacute;n?
</a> <br />

<a href="#1.4">
1.4: &iquest;C&oacute;mo obtengo el c&oacute;digo fuente
m&aacute;s reciente?
</a> <br />

<a href="#1.5">
1.5: Ya tengo el &aacute;rbol de fuentes, &iquest;c&oacute;mo
lo compilo?
</a> <br />

<a href="#1.6">
1.6: 'make build' par&oacute; en la mitad del proceso,
&iquest;tengo que compilarlo todo de nuevo?
</a> <br />

<a href="#1.7">
1.7: El proceso de compilaci&oacute;n produce errores,
&iquest;qu&eacute; puedo hacer?
</a> <br />

<a href="#1.8">
1.8: Estoy actualizando el compilador (<code>gcc</code>) a una
versi&oacute;n m&aacute;s nueva.
<br />
&iquest;Hay alg&uacute;n procedimiento para el sistema de
arranque?
</a> <br />

<a href="#1.9">
1.9: &iquest;Cu&aacute;l es la mejor forma de actualizar
<em>/etc</em>, <em>/var</em>, y <em>/dev</em>?
</a> <br />

<a href="#1.10">
1.10: &iquest;C&oacute;mo hago para eliminar todo lo sobrante
de la compilaci&oacute;n de mi &aacute;rbol de fuentes?
</a> <br />

<a href="#1.11">
1.11: &iquest;Es necesario ser el superusuario (<em>root</em>)
para hacer un 'make build'?
</a> <br />

<a href="#1.12">
1.12: &iquest;Por qu&eacute; no veo ning&uacute;n dispositivo
nuevo?
</a> <br />

<a href="#1.13">
1.13: &iquest;Hay alguna manera sencilla de llevar a cabo
todos los cambios en la jerarqu&iacute;a de archivos?
</a> <br />
</p>

<h2>2.0: C&oacute;mo actualizar desde la versi&oacute;n
2.3</h2>

<p>
<a href="#2.1">
2.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.3 a la 2.4?
</a> <br />

<a href="#2.2">
2.2: He intentado compilar todo, pero falla cuando intento
compilar <em>ssleay</em>.
</a> <br />

<a href="#2.3">
2.3: He intentado compilar todo para PowerPC, pero 'make'
falla.
</a> <br />
</p>


<h2>3.0: C&oacute;mo actualizar desde la versi&oacute;n
2.4</h2>

<p>
<a href="#3.1">
3.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.4 a la 2.5?
</a> <br />

<a href="#3.2">
3.2: He intentado compilar, pero falla en cap_mkdb.
</a> <br />
</p>


<h2>4.0: C&oacute;mo actualizar desde la versi&oacute;n 2.5</h2>

<p>
<a href="#4.1">
4.1: &iquest;Cu&aacute;les son los mayores problemas para actualizar
desde la 2.5 a la 2.6?
</a> <br />

<a href="#4.2">
4.2: &iquest;C&oacute;mo actualizo <em>gcc</em> a
<em>egcs</em>?
</a>
</p>

<blockquote>
<p>
<a href="#4.2.1">4.2.1 - i386 y sparc ya no usan
<code>#define</code></a><br />
<a href="#4.2.2">4.2.2 - La compilaci&oacute;n falla en
xlint</a><br />
<a href="#4.2.3">4.2.3 - &laquo;Volcado de memoria&raquo;
(<em>Core Dump</em>) en <code>uthread_autoinit.c</code></a><br
/>
<a href="#4.2.4">4.2.4 - egcs parece mucho m&aacute;s lento
que gcc</a><br />
<a href="#4.2.5">4.2.5 - egcs genera c&oacute;digo de mayor
tama&ntilde;o que gcc</a><br />
<a href="#4.2.6">4.2.6 - Despu&eacute;s de instalar egcs, me
queda muy poco espacio en el disco</a><br />
<a href="#4.2.7">4.2.7 - La compilaci&oacute;n falla al
compilar libcurses</a><br />
<a href="#4.2.8">4.2.8 - 'make obj' falla</a>
</p>
</blockquote>

<p>
<a href="#4.3">
4.3: <em>make build</em> muere con errores de tipo
<em>unimplemented syscall</em>.
</a> <br />

<a href="#4.4">
4.4: Enlace al nuevo directorio 2.6.
</a> <br />

<a href="#4.5">
4.5: Despu&eacute;s de <strong>(U)</strong>pgrade
(actualizar), la extracci&oacute;n de <em>base26.tar.gz</em>
falla con un mensaje.
</a>
</p>

<h2>5.0 - C&oacute;mo actualizar desde la versi&oacute;n
2.6</h2>

<p>
<a href="#5.1">
5.1: Las entradas de termcap son demasiado largas.
</a> <br />

<a href="#5.2">
5.2: El n&uacute;cleo del sistema ya no reconoce mi
dispositivo <em>pn</em> (o <em>mx</em>, <em>al</em>,
<em>ax</em>).
</a> <br />

<a href="#5.3">
5.3: Actualizaci&oacute;n de gcc 2.95.1 a 2.95.2
</a> <br />

<a href="#5.4">
5.4: Actualizaci&oacute;n de Kerberos.
</a> <br />

<a href="#5.5">
5.5: Actualizaci&oacute;n de M4.
</a> <br />

<a href="#5.6">
5.6: Actualizaci&oacute;n de sendmail.
</a> <br />

<a href="#5.7">
5.7: Despu&eacute;s de actualizar, los n&uacute;cleos que incluyen
<em>apm(8)</em> ya no arrancan.
</a>
</p>


<h2>6.0 - C&oacute;mo actualizar desde la versi&oacute;n
2.7</h2>

<p>
<a href="#6.1">
6.1: &iquest;Cu&aacute;les son los problemas principales para
actualizar desde la versi&oacute;n 2.7 a la 2.8?
</a>
</p>

<h2>7.0 - C&oacute;mo actualizar desde la versi&oacute;n
2.8</h2>

<p>
<a href="#7.1">
7.1: Nuevo grupo auth
</a> <br>

<a href="#7.2">
7.2: Nuevo sistema para consola wscons
</a> <br>

<a href="#7.3">
7.3: La compilaci&oacute;n del n&uacute;cleo falla con errores
de <em>Undefined symbol</em>
</a>
</p>

<h2>8.0 - C&oacute;mo actualizar desde la versi&oacute;n
2.9</h2>

<p>
<a href="#8.1">
8.1: Nuevos usuarios/grupos - <em>proxy</em>, <em>smmsp</em> y
<em>popa3d</em>
</a> <br />

<a href="#8.2">
8.2: Nuevo filtro de paquetes IP
</a> <br />

<a href="#8.3">
8.3: Cambios en <em>make</em>
</a> <br />

<a href="#8.4">
8.4: La compilaci&oacute;n falla debido a errores de KerberosV
</a> <br />

<a href="#8.5">
8.5: La nueva versi&oacute;n de sendmail
</a> <br />

<a href="#8.6">
8.6: Cambio en <em>/etc/primes</em>.
</a>
</p>


<h2>9.0 - Actualizaci&oacute;n desde la versi&oacute;n
3.0</h2>

<p>
<a href="#9.1">
9.1: Eliminaci&oacute;n de <em>libdl</em> en plataformas ELF
</a> <br />

<p>
<a href="#9.2">
9.2: Nuevo marco de regresi&oacute;n
</a>
</p>


&nbsp;<hr width="30%">


<a name="1.0"></a>
<h2>1.0: Preguntas generales sobre la
actualizaci&oacute;n</h2>


<a name="1.1"></a>
<h3>
1.1: Terminolog&iacute;a. &iquest;Qu&eacute; es
<em>-current</em>?  &iquest;Qu&eacute; son los
<em>snapshots</em>?  &iquest;Qu&eacute; es <em>-stable</em>?
</h3>

<p>
Con anterioridad a OpenBSD 2.7, el desarrollo de OpenBSD
ten&iacute;a lugar desde un s&oacute;lo &aacute;rbol de
fuentes sin ramificaciones.  A partir de la versi&oacute;n 2.7
se introdujo una ramificaci&oacute;n de parches.
</p>

<p>
Las &laquo;versiones finales&raquo; (<em>-release</em>) de
OpenBSD se producen con intervalos aproximados de seis meses.
&Eacute;stas se enumeran en un modo convencional (2.x, 3.x).
La versi&oacute;n final actual de OpenBSD se indica al
principio de este documento.
</p>

<p>
<em>-current</em> es la forma de abreviada de
<em>openbsd-current</em>, la &laquo;versi&oacute;nd de
desarrollo&raquo;, se refiere a la versi&oacute;n de
&uacute;ltima hora del &aacute;rbol de fuentes contenida en el
repositorio de CVS.  &Eacute;ste es el &aacute;rbol que usan
con m&aacute;s asiduidad los desarrolladores de OpenBSD.  El
&aacute;rbol de <em>-current</em> contiene todo el
c&oacute;digo que est&aacute; planeado para el lanzamiento de
la siguiente versi&oacute;n final.  De vez en cuando, algunos
valientes abandonan las versiones oficiales y utilizan la
versi&oacute;n de desarrollo, <em>-current</em>, generalmente
para aprovechar funcionalidades que todav&iacute;a no se han
implementado en las versiones finales.  Sin embargo, debido a
su naturaleza de incertidumbre, la actualizaci&oacute;n a
<em>-current</em> no es recomendable para usuarios no
t&eacute;cnicos.
</p>

<p>
Entre una versi&oacute;n final y otra, se ponen a
disposici&oacute;n unas revisiones llamadas 
<em><a href="ftp://ftp.openbsd.org/pub/OpenBSD/snapshots/">snapshots</a></em>.
&Eacute;stas son las &laquo;versiones preliminares&raquo; del
&aacute;rbol de fuentes de <em>-current</em>.  Debido a que
son un reflejo del estado actual de desarrollo, no se puede
garantizar que los <em>snapshots</em> funcionen
correctamente... ni siquiera que funcionen.  Las versiones
preliminares, <em>snapshots</em>, son bastante &uacute;tiles
cuando se est&aacute; actualizando desde una versi&oacute;n
final (o una versi&oacute;n de desarrollo m&aacute;s antigua)
a la del &aacute;rbol actual.
</p>

<p>
A partir de OpenBSD 2.7 se introdujo una 
<a href="../../es/stable.html">ramificaci&oacute;n de
parches</a> (llamada <strong>-stable</strong>).  Esta
ramificaci&oacute;n contiene la versi&oacute;n final
(<em>-release</em>) base y cualquier otro parche o
modificaci&oacute;n importante (se consideran importantes los
parches publicados en la p&aacute;gina de erratas,
adem&aacute;s de otros que son obvios y simples pero que no
merecen ser mencionados en dicha p&aacute;gina).
</p>

<p>
El <a href="../../es/ports.html">&aacute;rbol de portes</a> es
una parte integral del sistema.  Cada vez que se actualice el
sistema, tambi&eacute;n hay que actualizar los portes,
siguiendo las mismas reglas que existen para la
actualizaci&oacute;n del resto de las partes;  o sea, si el
sistema es <em>-stable</em> los portes tambi&eacute;n deben
ser <em>-stable</em>, y si el sistema es <em>-current</em> los
portes s&oacute;lo deben ser <em>-current</em>.
</p>

<a name="1.2"></a>
<h3>
1.2: &iquest;Cu&aacute;l es la forma m&aacute;s f&aacute;cil
de actualizar a <em>-current</em>?
</h3>

<p>
Debido a cambios en las bibliotecas de base, actualizar de una
versi&oacute;n final (<em>-release</em>) a otra de desarrollo
(<em>-current</em>) no siempre es f&aacute;cil.  La forma
m&aacute;s dif&iacute;cil de actualizar a <em>-current</em> es
actualizar primero a la revisi&oacute;n preliminar
(<em>snapshot</em>) m&aacute;s reciente (por lo general,
mediante una instalaci&oacute;n por FTP).  Una vez el
<em>snapshot</em> ha sido instalado, se pueden
<a href="#1.4">obtener</a> los fuentes m&aacute;s recientes y
<a href="#1.5">compilarlos</a>.  Este procedimiento
deber&iacute;a eliminar la mayor&iacute;a de problemas con las
bibliotecas y las herramientas necesarias.
</p>

<a name="1.3"></a>
<h3>
1.3: No puedo encontrar ning&uacute;n <em>snapshot</em> en el
servidor de FTP.  &iquest;D&oacute;nde est&aacute;n?
</h3>

<p>
Los <em>snapshot</em> se sol&iacute;an retirar de los
servidores de distribuci&oacute;n justo antes del lanzamiento
de una nueva versi&oacute;n oficial.  Esto ya no forma parte
de la pol&iacute;tica de OpenBSD.
</p>

<p>
Los <em>snapshot</em> se pueden retirar seg&uacute;n se vayan
anticuando (o seg&uacute;n dejen de ser relevantes).  Si no
hay ning&uacute;n <em>snapshot</em> disponible, entonces debe
actualizar a la versi&oacute;n m&aacute;s reciente y compilar
lo restante desde los fuentes.
</p>

<p>
<a name="1.4"></a>
<h3>
1.4: &iquest;C&oacute;mo obtengo los fuentes m&aacute;s
recientes?
</h3>

<p>
Respuesta corta:
<a href="../../es/anoncvs.html">http://www.openbsd.org/es/anoncvs.html</a>
</p>

<p>
Por ejemplo, para obtener el &aacute;rbol completo mediante
CVS (usando la shell ksh;  para otras, substituya
<em>export</em> por <em>setenv</em>):
</p>

<pre>
# export CVSROOT=anoncvs@anoncvs.ca.openbsd.org:/cvs
# export CVS_RSH=/usr/bin/ssh
# cd /usr
# cvs -q get -PA src
</pre>

<a name="1.5"></a>
<h3>
1.5: Ya tengo el &aacute;rbol, &iquest;c&oacute;mo lo compilo?
</h3>

<p>
Hay unas instrucciones b&aacute;sicas en
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/Makefile">
<tt>/usr/src/Makefile</tt></a>.
&Eacute;sta es una versi&oacute;n ligeramente extendida.
</p>

<ol>
<li>
<p>Limpie los ficheros objeto (<em>/usr/obj/</em>)
antiguos.</p>

<p>Si hab&iacute;a creado un directorio <em>/usr/obj</em>
separado, l&iacute;mpielo y reconstruya los enlaces
simb&oacute;licos:</p>

<pre>
# rm -rf /usr/obj
# mkdir /usr/obj
# cd /usr/src
# make obj
</pre>

<p>
Si se encuentra con que tiene que realizar este paso muchas veces,
puede encontrar mucho m&aacute;s r&aacute;pido poner <em>/usr/obj</em>
en su propia partici&oacute;n y usar <kbd>newfs</kbd> en lugar de
<kbd>rm</kbd>.  Por ejemplo, lo que yo hago es:
</p>

<pre>
# umount /dev/wd0h                 (la partici&oacute;n /usr/obj)
# newfs wd0h
# mount -a
# make obj
</pre>

<p>
Si est&aacute; preocupado porque pueda haber ficheros objeto en su
&aacute;rbol de fuentes, haga lo siguiente:
</p>

<pre>
# cd /usr/src
# find . -type l -name obj | xargs rm
# make cleandir
# rm -rf /usr/obj
# mkdir /usr/obj
# make obj
</pre>
</li>

<li>
<p>Lleve a cabo cualquier cambio de configuraci&oacute;n
espec&iacute;fico para la versi&oacute;n.  Por ejemplo, los
usuarios de la versi&oacute;n 2.3 deben a&ntilde;adir el
usuario y el grupo <strong>named</strong> antes de actualizar
a la versi&oacute;n 2.4 o posterior.  Lea la secci&oacute;n
espec&iacute;fica para su versi&oacute;n en este
documento.</p>
</li>

<li>
<p>Aseg&uacute;rese de que todos los directorios apropiados
hayan sido creados.  Esto es muy importante cuando se
actualiza desde versiones m&aacute;s antiguas, pero a veces
necesario en otros casos.  La forma m&aacute;s f&aacute;cil de
hacerlo es:</p>

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>
</li>

<li>
<p>Compile un nuevo n&uacute;cleo (<em>kernel</em>):</p>

<pre>
  # cd /usr/src/sys/arch/`machine`/conf
</pre>

La mayor&iacute;a de usuarios utilizar&aacute;n GENERIC:

<pre>
  # config GENERIC
  # cd ../compile/GENERIC
</pre>

<p><strong>NOTA:</strong> los usuarios a quienes les guste
sufrir pueden compilar un n&uacute;cleo personalizado en lugar
de usar el n&uacute;cleo GENERIC.  En este caso es mejor
empezar con GENERIC e ir modific&aacute;ndolo.  Para ello haga
lo siguiente:</p>

<pre>
# cp GENERIC MYKERNEL
# vi MYKERNEL
(edite MYKERNEL como le convenga)
# config MYKERNEL
# cd ../compile/MYKERNEL
</pre>

<p>Finalmente, para todos:</p>

<pre>
# make clean &amp;&amp; make depend &amp;&amp; make
(s&oacute;lo en la arquitectura arc) copie bsd.ecoff en su partici&oacute;n FAT
# cp /bsd /bsd.old &amp;&amp; cp bsd /bsd
# chown root.wheel /bsd (if you compiled as someone else)
(reinicie)
</pre>
</li>

<li>
<p>Compile el sistema:</p>

<pre>
# cd /usr/src
# make build
</pre>
</li>

<li>
<p>Actualice <em>/etc</em> y <em>/dev</em> a mano.
&Eacute;stos no se actualizan de forma autom&aacute;tica.
Escoja un directorio con espacio suficiente para <em>/</em>,
<em>/dev</em>, <em>/var</em>, y <em>/etc</em>.  En este
ejemplo usar&eacute; <em>/home/newroot</em> :</p>

<pre>
# mkdir /home/newroot          
# export DESTDIR=/home/newroot
# cd /usr/src/etc &amp;&amp; make distribution-etc-root-var
</pre>

<p>Ahora compare los ficheros en <em>/home/newroot</em> con
sus correspondientes ya instalados.  Reemplace o actualice los
ficheros seg&uacute;n sea necesario.</p>

<pre>
# rm -rf /home/newroot   (cuando haya acabado)
</pre>
</li>

<li>
<p>Reinicie para asegurarse de que los nuevos ficheros en
<em>/etc</em> sean los correctos.</p>
</li>
</ol>

<a name="1.6"></a>
<h3>
1.6: 'make build' se par&oacute; en la mitad del proceso,
&iquest;tengo que hacerlo todo de nuevo?
</h3>

<p>
Yo lo har&iacute;a, pero si realmente quiere retomarlo desde
el punto en que se qued&oacute;, haga lo siguiente:
</p>

<pre>
# cd /usr/src
# make -n build
</pre>

<p>
De este modo le mostrar&aacute; lo que 'make build' est&eacute;
haciendo.  Por ejemplo, el m&iacute;o dice:
</p>

<pre>
  (cd /usr/src/share/mk &amp;&amp;  make install)
  (cd /usr/src/include; make prereq;  make includes)
  make cleandir
  (cd /usr/src/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/gnu/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/kerberosIV/lib &amp;&amp; make depend &amp;&amp; make &amp;&amp;   make install)
  (cd /usr/src/gnu/usr.bin/perl &amp;&amp;  make -f Makefile.bsd-wrapper config.sh &amp;&amp;  mak
  e -f Makefile.bsd-wrapper depend &amp;&amp;  make -f Makefile.bsd-wrapper perl.lib &amp;&amp;
  make -f Makefile.bsd-wrapper install.lib)
  make depend &amp;&amp; make &amp;&amp;  make install
</pre>

<p>
Para empezar desde donde se qued&oacute;, vuelva a invocar las
&oacute;rdenes desde el punto en donde se cort&oacute; la
compilaci&oacute;n.
</p>

<p>
Si tiene que realizar este procedimiento muchas veces, es
posible que le convenga crear un nuevo objetivo en su fichero
makefile.  S&oacute;lo tiene que copiar la entrada para
<em>build</em> (a <em>build-noclean</em>, por ejemplo), y
eliminar la referencia <em>make cleandir</em>.
</p>

<a name="1.7"></a>
<h3>
1.7: El proceso de compilaci&oacute;n produce errores,
&iquest;qu&eacute; puedo hacer?
</h3>

<p>
Si 'make build' finaliza con un error, es muy posible que se
deba a que no elimin&oacute; sus ficheros objeto antiguos
antes de recompilar.  Lea la <a href="#1.5">secci&oacute;n
1.5</a> para m&aacute;s detalles sobre c&oacute;mo limpiar
esos ficheros.
</p>

<p>
Si est&aacute; seguro de que su &aacute;rbol est&aacute;
limpio de viejos restos, y a&uacute;n as&iacute; recibe un
error de compilaci&oacute;n, es que ha ocurrido una de las
siguientes tres cosas:
</p>

<ol>
<li>
Se ha encontrado con un problema de actualizaci&oacute;n
conocido.  Aseg&uacute;rese de haber leido la secci&oacute;n
apropiada de este documento, y de haber seguido las
instrucciones con cuidado.
</li>

<li>
Se ha encontrado con un problema de actualizaci&oacute;n
nuevo.  Esto es lo que pasa cuando se vive peligrosamente.
Busque entre los mensajes m&aacute;s recientes a las listas
<a href="../../es/mail.html">misc@ y tech@</a> una posible
soluci&oacute;n.
</li>

<li>
Alguien ha &laquo;roto&raquo; temporalmente el &aacute;rbol de
fuentes.  Esto es muy poco com&uacute;n, y por lo general se
soluciona inmediatamente.  Espere unas pocas horas y vuelva a
obtener el &aacute;rbol de fuentes.  Si no puede esperar,
intente bajarse un &aacute;rbol con uno o dos d&iacute;as de
antelaci&oacute;n.
</li>
</ol>

<p>
Si ya ha probado todas las alternativas anteriores y su
problema persiste durante m&aacute;s de un par de d&iacute;as,
env&iacute;e un informe sobre su problema a misc@openbsd.org.
Aseg&uacute;rese de incluir los mensajes de error relevantes,
as&iacute; como cualquier peculiaridad de su
configuraci&oacute;n.
</p>

<a name="1.8"></a>
<h3>
1.8: Estoy actualizando el compilador (<code>gcc</code>) a una
versi&oacute;n m&aacute;s nueva.  &iquest;Hay alg&uacute;n
procedimiento para el sistema de arranque?
</h3>

<p>
Debido a que la actualizaci&oacute;n de un compilador es como
&laquo;el problema del huevo y la gallina&raquo;, los cambios
al compilador original del &aacute;rbol requieren que se les
preste algo m&aacute;s de atenci&oacute;n.  Por regla general
se seguir&aacute; este procedimiento:
</p>

<p>
(... y s&iacute;, se compilar&aacute; dos veces)
</p>

<pre>
  $ rm -r /usr/obj/gnu/egcs/gcc/*
  $ cd /usr/src/gnu/egcs/gcc
  $ make -f Makefile.bsd-wrapper clean
  $ make -f Makefile.bsd-wrapper obj
  $ make -f Makefile.bsd-wrapper depend
  $ make -f Makefile.bsd-wrapper 
  $ sudo make -f Makefile.bsd-wrapper install
  $ make -f Makefile.bsd-wrapper clean
  $ make -f Makefile.bsd-wrapper depend
  $ make -f Makefile.bsd-wrapper 
  $ sudo make -f Makefile.bsd-wrapper install
</pre>

<p>
y a continuaci&oacute;n ejecute un <kbd>make build</kbd> normal.
</p>

<p>
Puede acelerar este proceso usando el procedimiento BOOTSTRAP:
</p>

<pre>
  $ cd /usr/src/gnu/egcs/gcc
  $ make -f Makefile.bsd-wrapper clean
  $ make -f Makefile.bsd-wrapper obj
  $ make -f Makefile.bsd-wrapper -DBOOTSTRAP
  $ sudo make -f Makefile.bsd-wrapper -DBOOTSTRAP install
  $ make -f Makefile.bsd-wrapper clean
  $ make -f Makefile.bsd-wrapper
  $ sudo make -f Makefile.bsd-wrapper install
</pre>

<a name="1.9"></a>
<h3>
1.9: &iquest;Cu&aacute;l es la mejor forma de actualizar
<em>/etc</em>, <em>/var</em>, y <em>/dev</em>?
</h3>

<p>
<strong>Respuesta corta</strong>: A mano.
</p>

<p>
<strong>Respuesta larga</strong>:
</p>

<p>
Como parte de la pol&iacute;tica de OpenBSD, el
<em>software</em> en el &aacute;rbol de cvs no modifica los
ficheros en <em>/etc</em> de forma autom&aacute;tica.  Esto
quiere decir que es <strong>siempre</strong> el administrador
quien debe llevar a cabo las modificaciones necesarias a los
ficheros de configuraci&oacute;n.  Las actualizaciones no
constituyen una excepci&oacute;n.  Para actualizar los
ficheros en estos directorios, primero determine qu&eacute;
cambios ha sufrido los ficheros b&aacute;sicos de la
distribuci&oacute;n, y a continuaci&oacute;n vuelva a aplicar
esos cambios manualmente.
</p>

<p>
Por ejemplo, para ver los ficheros que han cambiado m&aacute;s
recientemente en el &aacute;rbol, haga:
</p>

<pre>
  # cd /usr/src/etc
  # ls -lt |more
</pre>

<p>
Para ver todos los cambios en <em>/etc</em> entre versiones de
OpenBSD arbitrarias, puede usar
<a href="../../es/anoncvs.html">CVS</a>.  Por ejemplo, para
ver los cambios acontecidos entre 2.8 y 2.9, haga:
</p>

<pre>
  # cd /usr/src/etc
  # cvs diff -u -rOPENBSD_2_8 -rOPENBSD_2_9
</pre>

<p>
Una vez que haya identificado los cambios, vuelva a aplicarlos
a su &aacute;rbol local, conservando cualquier
configuraci&oacute;n a nivel local que haya hecho Vd.
anteriormente.
</p>

<a name="1.10"></a>
<h3>
1.10: &iquest;C&oacute;mo hago para eliminar todo lo sobrante
de la compilaci&oacute;n de mi &aacute;rbol de fuentes?
</h3>

<p>
Lo m&aacute;s importante que puede hacer es eliminar sus
directorios obj.  Una forma de actualizar el c&oacute;digo
fuente y eliminar cualquier resto de obj es:
</p>

<pre>
  # cd /usr/src
  # cvs -q -d anoncvs@some.anon.server:/cvs up -PAd
  # find . -type l -name obj | xargs rm
  # make -k cleandir
  # rm -rf /usr/obj/*
  # make obj
</pre>

<p>
Si todav&iacute;a tiene alg&uacute;n problema, puede
a&ntilde;adir las opciones <tt>-I ! -I CVS -I obj</tt> a sus
actualizaciones por CVS.  De este modo identificar&aacute;
cualquier resto adicional en su &aacute;rbol de fuentes.
</p>

<a name="1.11"></a>
<h3>
1.11: &iquest;Es necesario ser el superusuario para hacer un
<em>make build</em>?
</h3>

<p>
Aunque algunos pasos del proceso <em>make build</em> requieren
los privilegios del superusuario (<em>root</em>), el proceso
<em>build</em> incluye enlaces a la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;apropos=0&amp;sektion=8&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">sudo(8)</a>
que hacen que este proceso sea relativamente sencillo.
</p>

<p>
Si su fichero <em>/etc/sudoers</em> est&aacute; correctamente
configurado, puede usar los enlaces de sudo de la siguiente
forma:
</p>

<ul>
<li>
Ponga SUDO=/usr/bin/sudo en su fichero de entorno antes de
iniciar el proceso <em>build</em>, o
</li>
<li>
A&ntilde;ada la l&iacute;nea &quot;SUDO=/usr/bin/sudo&quot; a
su fichero <em>/etc/mk.conf</em>.
</li>
</ul>

<a name="1.12"></a>
<h3>
1.12: &iquest;Por qu&eacute; no veo ning&uacute;n dispositivo
nuevo?
</h3>

<p>
El gui&oacute;n <em>/dev/MAKEDEV</em> no es actualiza de forma
autom&aacute;tica como parte del proceso <kbd>make
build</kbd>.  Como regla general, es recomendable copiar este
gui&oacute;n desde su &aacute;rbol de fuentes cuando lleve a
cabo una actualizaci&oacute;n, y ejecutarlo a mano.
</p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

<a name="1.13"></a>
<h3>
1.13: &iquest;Hay alguna manera sencilla de llevar a cabo
todos los cambios en la jerarqu&iacute;a de archivos?
</h3>

<p>
De vez en cuando se a&ntilde;aden directorios y ficheros a, o
se eliminan de, la jerarqu&iacute;a de archivos.
Adem&aacute;s tambi&eacute;n puede cambiar la
informaci&oacute;n sobre permisos.  Una forma f&aacute;cil de
asegurarse de que la jerarqu&iacute;a de archivos est&eacute;
actualizada es usar la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>.
</p>

<p>
Primero obtenga el c&oacute;digo fuente m&aacute;s reciente, y
luego haga lo siguiente:
</p>

<pre>
  # cd /usr/src/etc/mtree
  # install -c -o root -g wheel -m 600 special /etc/mtree
  # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre>

<p>
Ahora su jerarqu&iacute;a de archivos estar&aacute;
actualizada.
</p>


<a name="2.0"></a>
<h2>
2.0: C&oacute;mo actualizar desde la Versi&oacute;n 2.3
</h2>

<a name="2.1"></a>
<h3>
2.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.3 a la 2.4?
</h3>

<h4>Nuevo usuario: <em>named</em></h4>

<p>
Con posterioridad a la versi&oacute;n 2.3, el d&aelig;mon de DNS
<em>named</em> se cambi&oacute; a una jaula chroot.  Para hacer este
cambio posible, se cre&oacute; el usuario <em>named</em>.  Si
todav&iacute;a no lo tiene, necesitar&aacute; crearlo para estar seguro
de que todos los directorios se crean correctamente durante el proceso
de compilaci&oacute;n.
</p>

<p>
A&ntilde;ada la siguiente entrada a <em>/etc/passwd</em>,
usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
</p>

<pre>
named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin
</pre>

<p>
A&ntilde;ada lo siguiente a <em>/etc/group</em>:
</p>

<pre>
named:*:70:
</pre>

<a name="2.2"></a>
<h3>
2.2: He intentado compilar todo, pero falla cuando intento
compilar <em>ssleay</em>.
</h3>

<p>
Probablemente le falte una entrada para el usuario
<em>named</em> en el fichero de la contrase&ntilde;a.
</p>

<p>
<strong>Respuesta corta:</strong>
</p>

<p>
Cree este usuario antes de la compilaci&oacute;n.
</p>

<p>
<strong>Respuesta larga:</strong>
</p>

<p>
El usuario <em>named</em> es necesario para configurar
correctamente los permisos.  Si este usuario faltara, parte
del proceso de compilaci&oacute;n fallar&iacute;a.  Si hiciera
una captura de pantalla de su compilaci&oacute;n de un fichero
(por ejemplo, con <em>make build &amp;&gt;/tmp/build.log</em>),
notar&iacute;a el siguiente mensaje:
</p>

<pre>
(cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)
</pre>

<p>
Desafortunadamente para nosotros, la compilaci&oacute;n
continuar&iacute;a felizmente su camino, ignorando
completamente el hecho de que ha ocurrido un error.
</p>

<p>
Si el usuario <em>named</em> existiera, mtree
funcionar&iacute;a correctamente:
</p>

<pre>
missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
En este caso, la raz&oacute;n de que fallara ser&iacute;a que
el directorio <em>/usr/include/ssl</em> nunca fue creado.  Sin
los ficheros de cabeceras, la compilaci&oacute;n de
<em>ssleay</em> fallar&iacute;a.
</p>

<p>
<strong>Soluci&oacute;n:</strong>
</p>

<p>
Cree el usuario y el grupo <em>named</em>.  Elimine
<em>/usr/include/ssl</em>, <em>/var/named</em>, y cualquier
otro directorio de la lista anterior que hubiera sido creado
por error como un fichero normal por 'make build'.
</p>

<a name="2.3"></a>
<h3>
2.3: He intentado compilar todo para PowerPC, pero 'make'
falla.
</h3>

<p>
Su &aacute;rbol del directorio est&aacute; incompleto.  En
concreto, falta el <em>/usr/share/man/cat4/powerpc</em>.
</p>

<p>
<strong>Soluci&oacute;n r&aacute;pida:</strong>
</p>

<p>
Cree este directorio y proceda con la compilaci&oacute;n.
</p>

<p>
<strong>Soluci&oacute;n completa:</strong>
</p>

<p>
Cree el &aacute;rbol del directorio completo:
</p>

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

<p>
Es probable que vea una salida como la siguiente:
</p>

<pre>
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
Not&eacute;se que <em>/usr/share/man/cat4/powerpc</em> es uno
de los directorios creados por este proceso.
</p>


<a name="3.0"></a>
<h2>
3.0: C&oacute;mo actualizar desde la Versi&oacute;n 2.4
</h2>

<a name="3.1"></a>
<h3>
3.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.4 a la 2.5?
</h3>

<h3>cap_mkdb</h3>

<p>
La sintaxis para invocar <em>cap_mkdb</em> ha cambiado
ligeramente.  Antes de hacer un 'make build', recompile
<em>cap_mkdb</em> desde los fuentes m&aacute;s recientes:
</p>

<pre>
# cd /usr/src/usr.bin/cap_mkdb
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Y 'make build' deber&iacute;a seguir el proceso hasta que
estuviera completo.
</p>

<h3>Cambios en las p&aacute;ginas del manual</h3>

<p>
Varias p&aacute;ginas del manual se cambiaron desde la
secci&oacute;n 1 a secciones posteriores.  Desafortunadamente,
si las p&aacute;ginas del manual viejas se dejan en la
secci&oacute;n 1, los usuarios que no lo sepan no
podr&aacute;n ver las &uacute;ltimas versiones de las
p&aacute;ginas.
</p>

<p>
Las siguientes p&aacute;ginas se deber&iacute;an eliminar:
</p>

<pre>
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0
</pre>

<h3>Snake</h3>

<p>
Tiene que eliminar el contenido del directorio <em>obj/</em>
antes de actualizar <code>/usr/src/games/snake</code>.
</p>

<p>
<a name="3.2"></a>
<h4>3.2: He intentado compilar, pero falla en cap_mkdb.</h4>

<p>
<strong>S&iacute;ntoma:</strong>

<p>
'make build' da como resultado un error como &eacute;ste:

<pre>
cap_mkdb -i -f terminfo terminfo.src
cap_mkdb: illegal option -- i
usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
*** Error code 1
</pre>

<p>
<strong>Soluci&oacute;n r&aacute;pida:</strong>

<p>
Necesita compilar un nuevo <em>cap_mkdb</em>.  Mire en la 
<a href="#3.1">secci&oacute;n 3.1</a>.


<a name="4.0"></a>
<h2>
4.0: C&oacute;mo actualizar desde la Versi&oacute;n 2.5
</h2>

<a name="4.1"></a>
<h3>
4.1: &iquest;Cu&aacute;les son los mayores problemas para
actualizar desde la 2.5 a la 2.6?
</h3>

<h5><em>perl</em> y <em>make</em></h5>

<p>
La &uacute;ltima versi&oacute;n de Perl (5.005_03) requiere
una nueva versi&oacute;n de <em>make</em> para compilar
correctamente.  Debe recompilar make antes de compilar el
nuevo Perl.  Haga lo siguiente:
</p>

<pre>
# cd /usr/src/usr.bin/make
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Ahora contin&uacute;e y recompile el nuevo Perl.
Necesitar&aacute; limpiar el directorio <code>obj</code> de
Perl a mano antes de compilar.
</p>

<p>
Los desarrolladores de Perl deber&iacute;an tomar nota de los
&uacute;ltimos cambios.
</p>

<p>
De millert@openbsd.org:
</p>

<pre>
La versi&oacute;n de perl en el &aacute;rbol de fuentes de OpenBSD (posterior
a 2.5) se ha actualizado a 5.005_03.  El m&eacute;todo de compilaci&oacute;n
ha cambiado algo, pero casi todo deber&iacute;a ser invisible.  Los cambios
importantes que afectan a los usuarios son los siguientes:

1) Los ficheros lib de perl han cambiado de /usr/lib/perl5 al m&aacute;s
correcto /usr/libdata/perl5
2) Los directorios site_perl por definici&oacute;n est&aacute;n ahora en
/usr/local.  O sea, si instala un m&oacute;dulo de perl, se ubicar&aacute; en
/usr/local/libdata/perl5/site_lib.  Esto facilita que pueda ver qu&eacute;
m&oacute;dulos no est&acute;ndar tiene.  Tambi&eacute;n significa que podemos
tener m&oacute;dulos de perl en el sistema de portes con facilidad.
3) Las p&aacute;ginas de manual de la biblioteca de perl est&aacute;n ahora
instaladas en /usr/share/man/cat3p.  Necesitar&aacute; actualizar el fichero
man.conf en base al directorio src/etc/man.conf para poder aprovecharlo.
Esto quiere decir que ahora puede hacer 'man 3p less' y obtener
informaci&oacute;n sobre el pragma de less, pero 'man less' le seguir&aacute;
mostrando la p&aacute;gina de manual del paginador less.

Si tiene m&oacute;dulos u otros ficheros de perl no est&aacute;ndar, lo mejor
que puede hacer es mover /usr/lib/perl5 a /usr/libdata/perl5 y a&ntilde;adir
un enlace de /usr/lib/perl5 a /usr/libdata/perl5.  Alternativamente,
podr&iacute;a editar el fichero instalado Config.pm y arreglar los caminos
desde ah&iacute;.
</pre>

<h5>Cambio de compilador: <em>egcs</em> reemplaza a
<em>gcc</em></h5>

<p>
Este cambio es probablemente el m&aacute;s significativo que
encontrar&aacute;.  Para ver instrucciones detalladas, lea la 
<a href="#4.2">secci&oacute;n 4.2</a>.
</p>

<h5>Cambio en la estructura del n&uacute;cleo
-<em>statfs</em></h5>

<p>
La estructura <tt>statfs</tt> ha cambiado desde el 31 de mayo.
Debe recompilar el n&uacute;cleo de su sistema antes de
intentar un 'make build'.  Lea la
<a href="#4.3">secci&oacute;n 4.3</a> para m&aacute;s
detalles.
</p>

<p>
<a name="4.2"></a>
<h3>
4.2: &iquest;C&oacute;mo actualizo <em>gcc</em> a
<em>egcs</em>?
</h3>

<p>
El modo m&aacute;s seguro es actualizar a un <em>snapshot</em>
reciente, en cuanto haya uno disponible.
<strong>&iexcl;Busque un <em>snapshot</em> primero!</strong>.
Arrancar el compilador nuevo desde el viejo deber&iacute;a ser
el <em>&uacute;ltimo recurso</em>.
</p>

<p>
Antes que nada, le avisamos que en algunas plataformas el
mecanismo de arranque todav&iacute;a no es perfecto.  Hasta la
fecha, deber&iacute;a funcionar en las siguientes, si lleva
cuidado:
</p>

<ul>
<li><strong>i386</strong></li>
<li><strong>sparc</strong></li>
<li><strong>m68k</strong></li>
<li><strong>alpha</strong></li>
</ul>

<p>
Hay problemas con <strong>mips</strong> y
<strong>rs6000</strong>.
</p>

<p>
Para probar si su plataforma puede arrancar desde el disco,
instale <em>egcs-snapshot</em>, que se encuentra disponible en
la <a href="../../es/ports.html">colecci&oacute;n de
portes</a>.  Si funciona, la versi&oacute;n del &aacute;rbol
tambi&eacute;n lo har&aacute;.  &Eacute;ste es el
m&eacute;todo <em>m&acute;s seguro</em> para proceder.
</p>

<p>
Antes de continuar, aseg&uacute;rese de que las copias que
tenga de <em>binutils</em>, <em>gas</em>, y <em>ld</em>
est&eacute;n actualizadas.  Recuerde que existen dos copias de
<em>gas</em> y <em>ld</em> en el &aacute;rbol.  En
<strong>i386</strong> y <strong>sparc</strong>, no se usan las
versiones de <em>binutils</em>.  Debe usar en su lugar
<tt>/usr/src/gnu/usr.bin/gas</tt> y
<tt>/usr/src/gnu/usr.bin/ld</tt>.
</p>

<p>
Las siguientes instrucciones se refieren al <em>snapshot</em>
original de egcs (egcs-990517).  Desde entonces existe en el
&aacute;rbol un segundo <em>snapshot</em> (egcs-990608).  Si
viene de la versi&oacute;n &quot;vainilla&quot; 2.5, es muy
probable que no pueda compilar la &uacute;ltima versi&oacute;n
directamente.  En este caso tendr&aacute; que arrancar con una
versi&oacute;n intermedia siguiendo estas instrucciones:
</p>

<p>
De espie@openbsd.org:
</p>

<blockquote>
<pre>
Hoy cambia el compilador.

Sale gcc 2.8.1, entra egcs ... o para ser m&aacute;s exactos, la
versi&oacute;n previa de gcc 2.95.

Probablemente esto suponga un duro cambio, pero no puedo calcular todos los
detalles para todas las arquitecturas yo solo.

Voy a empezar a importar partes *ahora*.  Enviar&eacute; un segundo mensaje a
tech@ una vez todo est&eacute; asentado...

Gracias a todos los que me ayudaron a ordenar las partes, de forma especial a
niklas, turan, y millert.

Porqu&eacute; del cambio
-----------------
como muchos ya sabr&aacute;n, egcs es ahora el compilador *oficial* soportado
por la FSF.  La futura versi&oacute;n de julio ha sido renombrada gcc 2.95.

Simplemente mirando a los mensajes se pueden ver muchas mejoras:
el soporte para nuevos procesadores es mejor, C++ se acerca m&aacute;s a las
normativas ANSI/ISO, Fortran 77 se encuentra m&aacute;s integrado.
Tambi&eacute;n hay una inmensa cantidad de errores solucionados y mejoras en
la generaci&oacute;n del c&oacute;digo.

Adem&aacute;s, el desarrollo es m&aacute;s abierto.  Hay un &aacute;rbol de 
cvs, varias listas de correo, y estamos cooperando m&aacute;s con el equipo
de egcs.  Para ser m&aacute;s exacto, he estado enviando parches al equipo de
egcs, para que las configuraciones de OpenBSD est&eacute;n soportadas
oficialmente.
Tambi&eacute;n, el equipo de desarrollo ha respondido con frecuencia a los
informes de errores, y los problemas se solucionan.

Tambi&eacute;n hay un fen&oacute;meno a tener en cuenta: todo el mundo
est&aacute; cambiando a egcs, lo que se traduce en montones de c&oacute;digo
para probar el compilador, y que podemos beneficiarnos de proyectos
relacionados.

Porqu&eacute; ahora
------------
egcs-1.1 no estaba preparado para algunos prop&oacute;sitos.  En concreto, el
tama&ntilde;o del c&oacute;digo en i386 era mayor que gcc 2.8.1, lo que
resultaba en problemas con los disquetes.
En el momento de &laquo;congelar&raquo; 2.5, el &uacute;nico c&oacute;digo
que se pod&iacute;a incluir era un snapshot algo inestable.  En
inter&eacute;s de la estabilidad, despu&eacute;s de considerarlo mucho, egcs
no fue incluido en 2.5.

Ahora, el proyecto egcs est&aacute; en un ciclo de lanzamiento que
acabar&aacute; en egcs 1.2.  Juzgando por su programa de tiempo en el 
proyecto, existe un amplio margen entre egcs 1.2 y el lanzamiento de la 
pr&oacute;xima versi&oacute;n de OpenBSD.  Adem&aacute;s, queremos empezar 
ahora para que podamos tener la oportunidad de enviar informes sobre 
problemas en arquitecturas de uso menos frecuente, y tenerlo todo solucionado 
para la versi&oacute;n 1.2.

La `congelaci&oacute;n de las funcionalidades' de egcs est&aacute; programada
para el 7 de mayo, y en el snapshot actual 19990502 parece s&oacute;lido.

Qu&eacute; funciona y qu&eacute; no
---------------------
egcs funciona en los sistemas OpenBSD para i386 sin problemas.  m68k
tambi&eacute;n funciona, con algunos arreglos relacionados con errores
extra&ntilde;os que ser&aacute;n solucionados.  sparc tambi&eacute;n parece
funcionar bien.  Hay alg&uacute;n problema con el enlazador en algunas otras
arquitecturas que necesita ser solucionado antes de nuestro pr&oacute;ximo
lanzamiento.

En este momento, los constructores a trav&eacute;s de bibliotecas
din&aacute;micas todav&iacute;a no est&aacute; preparados.

egcs ahora dispone de un cpp propio que va a ser mejor que la actual
soluci&oacute;n que usamos.  Esto significa unos pocos cambios en la interfaz
y probablemente avisos extra&ntilde;os.

&iquest;Mantener gcc 2.8.1?
--------------------
debido a restricciones de tama&ntilde;o, en cuanto se importe egcs, gcc
pasar&aacute; al &Aacute;tico del cvs.  Si no quiere tener egcs ahora,
deber&aacute; tener cuidado en sus actualizaciones de cvs.
Algunos ficheros Makefile est&aacute;n ligados al cambio: includes,
gnu/usr.bin, y gnu/lib.  xlint y cpp.sh tambi&eacute;n cambiar&aacute;n.

C&oacute;mo arrancar el compilador
---------------------------
el modo m&aacute;s simple es probablemente confiar en los varios mantenedores
de las arquitecturas y bajarse un snapshot.

Si quiere hacerlo del modo dif&iacute;cil, primero debe volver a compilar
directorios obj adecuados:

cd /usr/src
make obj

Si su arquitectura es i386, gas debe estar actualizado.
Si su arquitectura en sparc, ld debe estar actualizado.

y compile libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

y el compilador de C:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

recompile el compilador de C con la nueva versi&oacute;n:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

recompile los ficheros include:
cd /usr/src/include
make includes

compile todas la bibliotecas de egcs e inst&aacute;lelas:
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

instale el nuevo controlador de cpp:
cd /usr/src/usr.bin/cpp
make install

y ya est&aacute; preparado; un make build normal deber&iacute;a funcionar...
</pre>

<p>
[nota del autor: en realidad no funciona del todo.  xlint no
compilar&aacute;.  Sin embargo, la soluci&oacute;n es simple.
Ejecute <code>make &amp;&amp; make install</code> en el
directorio <code>/usr/src/usr.bin/xlint/xlint</code> antes de
ejecutar <code>make build</code> y proceda.  V&eacute;ase la
<a href="#4.2.2">secci&oacute;n 4.2.2</a>.]
</p>

<pre>
Si no funciona es porque est&aacute; usando una arquitectura que no ha pasado
por make build todav&iacute;a.  Lo m&aacute;s l&oacute;gico es que sea un
&laquo;Error Interno del Compilador&raquo; (ICE, &quot;Internal Compiler
Error&quot;).

Primero intente ver si el ICE desaparece con -01 &oacute; -00.  En ese caso,
puede hacer un arreglo en el fichero Makefile hasta que sea solucionado (vea
/usr/src/lib/libm/Makefile para un ejemplo de c&oacute;mo hacer estos
arreglos en m68k).

Entonces debe enviar un informe sobre el error a la lista de correo de
egcs-bugs.

Como m&iacute;nimo, debe compilar los fuentes con la misma invocaci&oacute;n
que para el compilador, a&ntilde;adiendo -v -save-temps a las opciones.

-v muestra la secuencia exacta de &oacute;rdenes invocadas por gcc.
-save-temps le dar&aacute; un fichero preprocesado de C (.i) o de C++ (.ii)
que los desarrolladores de egcs pueden entender... no les pida que instalen
OpenBSD en sus m&aacute;quinas.

Si dispone de m&aacute;s tiempo, puede intentar recortar el fichero
preprocesado de C al m&iacute;nimo indispensable que haga saltar el error.
La dicotom&iacute;a funciona bien.
</pre>
</blockquote>

<p>
Si pas&oacute; este procedimiento y todav&iacute;a funciona
todo, felicidades.  Si no, busque consejo en las siguientes
secciones.  Los problemas que no aparezcan aqu&iacute; se
deben enviar a tech@openbsd.org.
</p>

<a name="4.2.1"></a>
<h5>
4.2.1 - <tt>i386</tt> y <tt>sparc</tt> ya no usan
<tt>#define</tt>
</h5>

<p>
Esto es cierto.  <em>egcs</em> usa <tt>__i386__</tt> y
<tt>__sparc__</tt> que son de c&oacute;digo m&aacute;s limpio.
Si necesita compilar c&oacute;digo que dependa en los viejos
define, a&ntilde;ada <tt>-Dsparc</tt> o <tt>-Di386</tt> a la
ubicaci&oacute;n apropiada del fichero Makefile.
</p>

<a name="4.2.2"></a>
<h5>
4.2.2 - La compilaci&oacute;n falla en xlint
</h5>

<p>
Esto se debe a diferencias sem&aacute;nticas en cpp.  La
soluci&oacute;n es f&aacute;cil y parecida al problema de
<em>cap_mkdb</em> descrito en la <a href="#3.1">secci&oacute;n
3.1</a>.
</p>

<p>
Haga lo siguiente:
</p>

<pre>
# cd /usr/src/usr.bin/xlint/xlint
# make &amp;&amp; make install
</pre>

<p>
ahora vuelva a ejecutar 'make', y la compilaci&oacute;n
deber&iacute;a continuar.
</p>

<a name="4.2.3"></a>
<h5>
4.2.3 - &laquo;Volcado de Memoria&raquo; (&quot;Core
Dump&quot;) en <tt>uthread_autoinit.c</tt>
</h5>

<p>
Ha sido v&iacute;ctima de un error del enlazador.  He
aqu&iacute; un mensaje relevante en este caso:
</p>

<pre>
De: Marc Espie &lt;Marc.Espie@liafa.jussieu.fr&gt;
Asunto: egcs core-dumping on uthread_autoinit.c

Si le ocurre esto, es un conocido problema del enlazador... el cc1 que tiene
fue enlazado en un modo extra&ntilde;o.

Al principio hice un enlace cc1 contra /usr/lib/libiberty.a est&aacute;tico,
para evitar este problema;  pero esto s&oacute;lo era temporal y el error
reaparec&iacute;a, probablemente debido a cambios relacionados con libc u
otros...

El &aacute;rbol ha sido parcheado con un arreglo en

src/gnu/egcs/f/lang-options.h

aseg&uacute;rese de que tiene la versi&oacute;n parcheada de ese fichero (por
lo menos la revisi&oacute;n 1.2), recompile y reinstale cc1;  el problema
deber&iacute;a desaparecer.

Lo que ocurre es que el enlazador de 386 se equivoca debido a la cadena de
vectorial en toplev.c, y algo se desenlaza, de modo que 
void f(void) __attribute((constructor)) {}
mata cc1.

Como soluci&oacute;n temporal, he matado los textos de ayuda de las opciones
de Fortran, hasta que alguien encuentre d&oacute;nde comete el error el
enlazador.
</pre>

<a name="4.2.4"></a>
<h5>
4.2.4 - <i>egcs</i> parece mucho m&aacute;s lento que
<em>gcc</em>
</h5>

<p>
Lo es, pero existe un motivo.  <em>egcs</em> act&uacute;a
optimizando m&aacute;s pases.  La alineaci&oacute;n de los
datos y otras funcionalidades semejantes mejorar&aacute;n el
c&oacute;digo generado por <em>egcs</em>.
</p>

<a name="4.2.5"></a>
<h5>
4.2.5 - <em>egcs</em> genera c&oacute;digo de mayor
tama&ntilde;o <em>gcc</em>
</h5>

<p>
S&iacute;, lo hace.  Esto se nota especialmente con el viejo
conmutador <tt>-O2</tt> de <em>gcc</em>.  <em>egcs</em>
introduce una nueva opci&oacute;n, <tt>-Os</tt>, que optimiza
el espacio.  Estos es comparable a grandes rasgos con el viejo
comportamiento <tt>-O2</tt>.
</p>

<a name="4.2.6"></a>
<h5>
4.2.6 - Despu&eacute;s de instalar <em>egcs</em>, me queda muy
poco espacio en el disco
</h5>

<p>
<em>egcs</em> se instala en un subdirectorio distinto al de
gcc 2.8.1.  Una vez que egcs haya arrancado y funcione, puede
eliminar <em>gcc</em>.  A prop&oacute;posito de esto, los
cambios en perl mencionados en la <a href="#4.1">secci&oacute;n
4.1</a> significan que puede eliminar el directorio
<tt>/usr/lib/perl5</tt>.  La nueva ubicaci&oacute;n para estos
datos es <tt>/usr/libdata/perl5</tt>.
</p>

<a name="4.2.7"></a>
<h5>
4.2.7 - La compilaci&oacute;n falla al compilar libcurses
</h5>

<p>
<em>libcurses</em> se apoya ahora en la &uacute;ltima
versi&oacute;n de <em>cpp</em>.  Obtenga la &uacute;ltima
versi&oacute;n, recompile <em>cpp</em>, y contin&uacute;e.
Por ejemplo:
</p>

<pre>
# cd /usr/src/usr.bin/cpp &amp;&amp; make install
</pre>

<p>
Y vuelva a intentar 'make build'.
</p>

<a name="4.2.8"></a>
<h5>
4.2.8 - 'make obj' falla
</h5>

<p>
Si <em>make obj</em> falla, se&ntilde;alando errores de un
<em>Makefile</em>, es probable que los ficheros de
inclusi&oacute;n (indicados mediante la directiva
<em>#include</em> en el fichero <em>Makefile</em>)
est&eacute;n obsoletos.  Por ejemplo:
</p>

<pre>
===&gt; lib/libkvm
&quot;Makefile&quot;, line 30: Malformed conditional ((${UVM} == &quot;yes&quot;))
&quot;Makefile&quot;, line 30: Missing dependency operator
&quot;Makefile&quot;, line 32: if-less endif
&quot;Makefile&quot;, line 32: Need an operator
Fatal errors encountered -- cannot continue
</pre>

<p>
Esto se puede resolver recompilando los ficheros include de
makefile:
</p>

<pre>
cd /usr/src/share/mk &amp;&amp; make install
</pre>

<p>
e intente compilar de nuevo.
</p>


<a name="4.3"></a>
<h3>
4.3: <em>make build</em> muere con errores de tipo
<em>unimplemented syscall</em>
</h3>

<p>
<strong>Respuesta corta:</strong>
</p>

<p>
La estructura <tt>statfs</tt> del n&uacute;cleo ha cambiado.
Necesita recompilar el n&uacute;cleo antes de intentar un
<em>make build</em>.
</p>

<p>
<strong>Respuesta larga:</strong>
</p>

<p>
La estructura <tt>statfs</tt> del n&uacute;cleo ha cambiado.
La nueva <tt>struct statfs</tt> tiene las siguientes
funcionalidades:
</p>

<ul>
<li>
Tiene un campo de indicadores <tt>u_int32_t</tt> (ahora
softdep puede tener un indicador real).
</li>
<li>
Usa <tt>u_int32_t</tt> en lugar de largos (mejor en alpha).
Nota: la p&aacute;gina de manual ment&iacute;a sobre
configurar campos inv&aacute;lidos o no usados a -1.  SunOS lo
hace, pero nuestro c&oacute;digo nunca lo ha hecho.
</li>
<li>
Se libera totalmente de <tt>f_type</tt>.  No se ha usado desde
NetBSD 0.9, y tenerlo ah&iacute; siempre crea
confusi&oacute;n.  Es comprensible que esto pueda ser la causa
de que alg&uacute;n viejo c&oacute;digo no compile, pero eso
es mejor a que se rompa en silencio.
</li>
<li>
A&ntilde;ade una uni&oacute;n <tt>mount_info</tt> que contiene
la estructura <tt>FSTYPE_args</tt>.  Esto quiere decir que
ahora <em>mount</em> le puede indicar todas las opciones que
tenga un sistema de archivo montado.  Esto es especialmente
bueno para NFS.
</li>
</ul>

<p>
Otros cambios:
</p>

<ul>
<li>
La emulaci&oacute;n de statfs de Linux no convert&iacute;a
entre nombres de sistema de archivo de BSD y n&uacute;meros
<tt>f_type</tt> de Linux.  Ahora lo hace, ya que el
n&uacute;mero <tt>f_type</tt> de BSD es in&uacute;til para las
aplicaciones de Linux (y de todos modos ha sido eliminado).
</li>
<li>
La estructura statfs de FreeBSD es diferencte de la nuestra
(tanto la vieja como la nueva) y por lo tanto necesita
conversi&oacute;n.  Anteriormente, los syscalls de OpenBSD se
usaban sin ninguna traducci&oacute;n real.
</li>
<li>
Ahora, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;apropos=0&amp;sektion=8&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">mount(8)</a>
mostrar&aacute; informaci&oacute;n adicional cuando se invoque
sin argumentos.  Sin embargo, para verlo <em>todo</em>
necesitar&aacute; usar el indicador -v (verbosidad).
</li>
</ul>


<a name="4.4"></a>
<h3>
4.4: Enlace al nuevo directorio 2.6
</h3>

<p>
Cuando actualice a la versi&oacute;n 2.6 necesitar&aacute;
crear un enlace simb&oacute;lico para gcc.
</p>

<pre>
   cd /usr/lib/gcc-lib
   ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6
</pre>


<a name="4.5"></a>
<h3>
4.5: Despu&eacute;s de <strong>(U)</strong>pgrade
(actualizar), la extracci&oacute;n de <em>base26.tar.gz</em>
falla con un mensaje:
</h3>

<p>
<em>tar: Unable to remove directory ./usr/include/machine
&lt;Directory not empty&gt;</em>
</p>

<p>
En la versi&oacute;n 2.5 <em>/usr/include/machine</em> era un
directorio, y <em>/usr/include/i386</em> era un enlace a ese
directorio.  En la versi&oacute;n 2.6 esta situaci&oacute;n se
ha invertido.
</p>

<p>
Para corregir el problema, escape a la shell, elimine el
directorio <em>/usr/include/machine</em>, y vuelva a intentar
actualizar.
</p>


<a name="5.0"></a>
<h2>
5.0 - C&oacute;mo actualizar desde la versi&oacute;n 2.6
</h2>

<a name="5.1"></a>
<h3>
5.1: Las entradas de <em>termcap</em> son demasiado largas
</h3>

<p>
Existe un nuevo fichero <em>termcaps.master</em>.
Necesitar&aacute; regenerar los ficheros <em>terminfo</em> y
<em>termcaps</em> con la versi&oacute;n actual de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tic&amp;apropos=0&amp;sektion=1&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">tic(1)</a>.
Si est&aacute; actualizando a trav&eacute;s de <em>make
build</em>, se usar&aacute; la versi&oacute;n correcta de
tic(1) y regenerar&aacute; los ficheros por usted.  En caso
contrario, ver&aacute; el siguiente error:
</p>

<pre>
    terminfo.src is corrupt! You need to update /usr/bin/tic
</pre>

<p>
En tal caso, debe recompilar e instalar tic(1)
(asegur&aacute;ndose de utilizar la versi&oacute;n actual de
<em>libcurses</em>), o simplemente compilar la versi&oacute;n
de tic(1) en su &aacute;rbol de fuentes.
</p>

<a name="5.2"></a>
<h3>
5.2: El n&uacute;cleo del sistema ya no reconoce mi
dispositivo <em>pn</em> (o <em>mx</em>, <em>al</em>,
<em>ax</em>)
</h3>

<p>
Nota: en algunas partes de esta secci&oacute;n se usa
s&oacute;lo <em>pn</em> para simplificar.  La
informaci&oacute;n es igualmente aplicable a <em>pn</em>,
<em>mx</em>, <em>al</em>, o <em>ax</em>, seg&uacute;n el caso.
</p>

<p>
Estos cuatro controladores han sido substituidos por el
controlador unificado <em>dc</em>.  Debe cambiar cualquier
menci&oacute;n a <em>pn*</em>, <em>mx</em>, <em>al</em>, o
<em>ax</em> en sus ficheros de configuraci&oacute;n.  Esto
incluye:
</p>

<ul>
<li>
Actualizar el/los fichero/s de configuraci&oacute;n del
n&uacute;cleo (ayuda: empiece con un n&uacute;cleo GENERIC
nuevo y modif&iacute;quelo).
</li>
<li>
Cambiar <em>/etc/hostname.pn*</em> a
<em>/etc/hostname.dc*</em>
</li>
<li>
Actualizar su fichero <em>/etc/ifaliases</em>
</li>
<li>
Realizar cambios en <em>/etc/ipnat.rules</em> y
<em>/etc/ipf.rules</em> para que reflejen el nuevo nombre de
la interfaz.
</li>
</ul>

<p>
Si no est&aacute; modificando un n&uacute;cleo personalizado,
aseg&uacute;rese de haber incluido el dispositivo
<em>dcphy</em> en la configuraci&oacute;n del n&uacute;cleo,
de la siguiente forma:
</p>

<pre>
dcphy*  at mii? phy ?                   # PHYs cl&oacute;nicos de Digital
</pre>

<p>
Mientras est&aacute; en ello, tambi&eacute;n puede
a&ntilde;adir:
</p>

<pre>
ukphy*  at mii? phy ?                   # PHYs &laquo;desconocidos&raquo;
</pre>

<a name="5.3"></a>
<h3>
5.3: Actualizaci&oacute;n de gcc 2.95.1 a 2.95.2
</h3>

<p>
<em>gcc</em> 2.95.2 se fusion&oacute; en el &aacute;rbol de
fuentes de OpenBSD alrededor del 19 de enero de 2.000.  Para
que <em>gcc</em> compile correctamente, se requiere una
versi&oacute;n m&aacute;s reciente de la biblioteca
<em>libiberty</em> (post 2.6).  Para compilar esta biblioteca,
haga lo siguiente:
</p>

<pre>
	cd /usr/src/gnu/egcs/libiberty
	make -f Makefile.bsd-wrapper clean
	make -f Makefile.bsd-wrapper obj
	make -f Makefile.bsd-wrapper
	make -f Makefile.bsd-wrapper install
</pre>

<p>
NOTA:  En las arquitecturas basadas en mips, como pmax, debe
llevar a cabo un <em>ldconfig</em> expl&iacute;cito
despu&eacute;s de compilar las nuevas bibliotecas.
</p>

<p>
Una vez compilada <em>libiberty</em>, puede proceder con un
arranque t&iacute;pico de <em>gcc</em>:
</p>

<pre>
   cd /usr/src/gnu/egcs/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper 
   make -f Makefile.bsd-wrapper install
</pre>

<a name="5.4"></a>
<h3>5.4: Actualizaci&oacute;n de Kerberos</h3>

<p>
Para que Kerberos IV compile correctamente, necesita seguir
estas instrucciones:
</p>

<ul>
<li>
<p>Obtener y compilar la &uacute;ltima versi&oacute;n de
<em>usr.bin/compile_et</em>.</p>
<pre>
   # cd /usr/src/usr.bin/compile_et
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li>
<p>Obtener y compilar la &uacute;ltima versi&oacute;n de
<em>lib/libcom_err</em>.</p>
<pre>
   # cd /usr/src/lib/libcom_err
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li>
<p>Limpie y reinstale los ficheros cabecera de Kerberos:</p>
<pre>
  # rm -r /usr/include/kerberosIV/*
  # cd /usr/src/kerberosIV
  # make includes
</pre>
</li>
<li>
<p>Ahora recompile los ficheros biblioteca de Kerberos:</p>
<pre>
   # cd /usr/src/kerberosIV/lib
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li>
<p>Si no va a llevar a cabo un <kbd>make build</kbd> completo,
recompile Kerberos:</p>
<pre>
   # cd /usr/src/kerberosIV
   # make cleandir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li>De otro modo, no tiene m&aacute;s que volver a ejecutar
<kbd>make builld</kbd>.</li>
</ul>

<a name="5.5"></a>
<h3>
5.5: Actualizaci&oacute;n de M4
</h3>

<p>
La versi&oacute;n de m4 incluida en OpenBSD 2.6 se engancha en
un bucle infinito mientras procesa los ficheros .mc de
sendmail en ficheros .cf.  Debido a esto, necesitar&aacute;
instalar la nueva versi&oacute;n de m4 <strong>antes</strong>
de intentar un <kbd>make build</kbd>.  En otras palabras:
</p>

<pre>
    # cd /usr/src/usr.bin/m4
    # make &amp;&amp; make install &amp;&amp; make cleandir
</pre>

<a name="5.6"></a>
<h3>
5.6: Actualizaci&oacute;n de Sendmail
</h3>

<p>
En sendmail 8.10.X, las ubicaciones (y nombres) de los
ficheros de configuraci&oacute;n de sendmail han cambiado.
Ahora se encuentra todo, excepto el fichero pid, en
<em>/etc/mail</em>.  Adem&aacute;s, varios ficheros han
cambiado de nombre.
</p>

<table border="0">
<tr>
  <td><strong>VIEJO</strong></td>
  <td><strong>NUEVO</strong></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cf</tt></td>
  <td><tt>/etc/mail/sendmail.cf</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cw</tt></td>
  <td><tt>/etc/mail/local-host-names</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.ct</tt></td>
  <td><tt>/etc/mail/trusted-users</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.oE</tt></td>
  <td><tt>/etc/mail/error-header</tt></td>
</tr>
<tr>
  <td><tt>/etc/aliases</tt></td>
  <td><tt>/etc/mail/aliases</tt></td>
</tr>
<tr>
  <td><tt>/etc/service.switch</tt></td>
  <td><tt>/etc/mail/service.switch</tt></td>
</tr>
<tr>
  <td><tt>/etc/userdb</tt></td>
  <td><tt>/etc/mail/userdb</tt></td>
</tr>
<tr>
  <td><tt>/usr/share/misc/sendmail.hf</tt></td>
  <td><tt>/etc/mail/helpfile</tt></td>
</tr>
</table>

<p>
Hay un par de maneras para convertir la vieja
configuraci&oacute;n de sendmail a la nueva, pero el primer
paso es siempre el mismo.
</p>

<ol>
<li>
Actualizar <em>/etc/rc</em> de modo que busque
<em>/etc/mail/sendmail.cf</em> en lugar de
<em>/etc/sendmail.cf</em>
</li>
<li>
<kbd>mv /etc/sendmail.cf /etc/mail/sendmail.cf</kbd><br />
&Eacute;ste es el camino que ofrece menos resistencia y no
tendr&aacute; que cambiar la ubicaci&oacute;n de ning&uacute;n
otro fichero.
</li>
<li>
O compilar un nuevo fichero .cf con su fichero de fuentes .mc.
Note que ya no necesitar&aacute; especificar la l&iacute;nea:
    <pre>include(`../m4/cf.m4')</pre>
ya que la habr&aacute; incluido 'make'.  Note tambi&eacute;n
que, a partir de ahora, cuando a&ntilde;ada m&aacute;quinas a
la clase w (mediante &quot;Cw nombredem&aacute;quina&quot;),
tendr&aacute; que hacerlo en la secci&oacute;n LOCAL_CONFIG
(vea como ejemplo <em>openbsd-lists.mc</em>).
</li>
</ol>

<a name="5.7"></a>
<h3>
5.7: Despu&eacute;s de actualizar, los n&uacute;cleos que
incluyen soporte para 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;apropos=0&amp;sektion=8&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">apm(8)</a>
ya no arrancan
</h3>

<p>
Necesita actualizar los bloques de arranque
(<em>bootblocks</em>).  V&eacute;ase la 
<a href="faq14.html#14.8">secci&oacute;n 14.8</a> de las
preguntas frecuentes para m&aacute;s detalles.
</p>


<a name="6.0"></a>
<h2>
6.0 - C&oacute;mo actualizar desde la versi&oacute;n 2.7
</h2>

<a name="6.1"></a>
<h3>
6.1: &iquest;Cu&aacute;les son los problemas principales para
actualizar desde la versi&oacute;n 2.7 a la 2.8?
</h3>

<p>
Se produjo un cambio significativo en gcc gracias al cual es
muy f&aacute;cil generar bibliotecas <em>libc</em> de
auto-referencia.  Debido a este cambio, las actualizaciones
deben seguir el siguiente procedimiento al pie de la letra:
</p>

<ol>
<li><a href="#1.10">Eliminar restos de la
compilaci&oacute;n</a> del &aacute;rbol de fuentes, y bajarse
el c&oacute;digo de la versi&oacute;n 2.8.</li>
<li>
<p>Compilar e instalar un nuevo enlazador.  Esto
<strong>debe</strong> hacerse antes de una compilaci&oacute;n
de <em>gcc</em> completa.</p>
<pre>
  $ cd /usr/src/gnu/usr.bin/ld
  $ make clean &amp;&amp; make obj &amp;&amp; make
  $ sudo make install
</pre>
</li>
<li>Compilar e instalar el nuevo <em>gcc</em>.  Use el
procedimiento de <a href="#1.8">BOOTSTRAP</a> para acelerar el
proceso.</li>
<li>
<p>Compilar un nuevo n&uacute;cleo.  No lo instale
todav&iacute;a.</p>
<pre>
  $ cd /usr/src/sys/arch/`machine`/conf
  $ config GENERIC
  $ cd ../compile/GENERIC
  $ make clean &amp;&amp; make depend &amp;&amp; make
</pre>
</li>
<li>
<p>Debido a algunos cambios en libc, su m&aacute;quina puede
colgarse durante el inicio, a menos que el fichero
<em>/etc/resolv.conf</em> contenga la l&iacute;nea <tt>lookup
file bind</tt>.  A&ntilde;&aacute;dala si es necesario.</p>
<pre>
  # echo &quot;lookup file bind&quot; &gt;&gt; /etc/resolv.conf
</pre>
</li>
<li>
<p>Instale el nuevo n&uacute;cleo y reinicie</p>
<pre>
  # cd /usr/src/sys/arch/`machine`/compile/GENERIC
  # mv /bsd /bsd.old
  # mv bsd /bsd
  # chown root.wheel /bsd
  # shutdown -r now
</pre>
<p>
(si este paso fallara, puede recuperarlo arrancando con el
n&uacute;cleo viejo - bsd.old - desde el punto de pedido
<tt>boot&gt;</tt>)
</p>
<li>
<p>Compile e instale el nuevo make (y los archivos de
soporte).  No se salte el paso de <kbd>make depend</kbd>.</p>
<pre>
  $ cd /usr/src/usr.bin/make
  $ make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  $ sudo make install
  $ cd /usr/src/share/mk
  $ sudo make install
</pre>
</li>
<li>
<p>Instale la &uacute;ltima versi&oacute;n de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
y aseg&uacute;rese que exista la estructura necesaria en el
directorio.</p>
<pre>
  $ cd /usr/src/etc/mtree
  $ sudo install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  $ sudo mtree -qdef /etc/mtree/
</pre>
</li>
<li>
<p>Lleve a cabo la ejecuci&oacute;n de <kbd>make
build</kbd></p>
<pre>
  # cd /usr/src &amp;&amp; make build
</pre>
</li>
<li><a href="#1.9">Actualice <em>/etc</em>, <em>/var</em> y
<em>/dev/MAKEDEV</em></a> a mano.</li>
</ol>


<a name="7.0"></a>
<h2>
7.0 - C&oacute;mo actualizar desde la versi&oacute;n 2.8
</h2>

<a name="7.1"></a>
<h3>
7.1: El nuevo grupo auth
</h3>

<p>
Un nuevo grupo, <em>auth</em>, con gid 11, ha sido
a&ntilde;adido al sistema.  Incluya una l&iacute;nea como la
siguiente en su fichero <em>/etc/group</em>:
</p>

<pre>
  auth:*:11:
</pre>

<a name="7.2"></a>
<h3>
7.2: Nuevo sistema para consola wscons
</h3>

<p>
El controlador para consoola <em>pcvt</em> ha sido substituido
por el sistema para consola <em>wscons</em>.  Antes de poder
usar wscons debe crear los nuevos dispositivos relacionados
con wscons.  Aseg&uacute;rese de haber instalado el
&uacute;ltimo MAKEDEV y entonces compile todos los
dispositivos:
</p>

<pre>
 # cp /usr/src/etc/etc.i386/MAKEDEV /dev/MAKEDEV
 # cd /dev
 # ./MAKEDEV all
</pre>

<p>
Si va a usar X, cambie la secci&oacute;n &quot;Pointer&quot;
en su fichero de configuraci&oacute;n <em>XF86Config</em> de
modo que contenga lo siguiente:
</p>

<pre>
    Protocol    &quot;wsmouse&quot;
    Device      &quot;/dev/wsmouse&quot;
</pre>

<a name="7.3"></a>
<h3>
7.3: La compilaci&oacute;n del n&uacute;cleo falla con errores
de <em>Undefined symbol</em>
</h3>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;apropos=0&amp;sektion=8&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">config(8)</a>
ha sido actualizado.  Si compila con el <em>config</em>
antiguo le dar&aacute; errores como:
</p>

<pre>
  Undefined symbol `_pdevnames_size' referenced
  Undefined symbol `_pdevnames' referenced
</pre>

<p>
Para corregirlo, compile e instale el nuevo <em>config</em>:
</p>

<pre>
  $ cd /usr/src/usr.sbin/config
  $ make clean &amp;&amp; make depend &amp;&amp; make
  $ sudo make install
</pre>
 
<p>
Ahora recompile un nuevo n&uacute;cleo como hicimos antes.
</p>


<a name="8.0"></a>
<h2>
8.0 - Actualizaci&oacute;n desde 2.9
</h2>

<a name="8.1"></a>
<h3>
8.1: Nuevos usuarios/grupos - <em>proxy</em>, <em>smmsp</em> y
<em>popa3d</em>.
</h3>

<p>
Con la adici&oacute;n del nuevo paquete de filtros de IP
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">pf(4)</a>
y su suite
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8">ftp-proxy(8)</a>,
se a&ntilde;adieron un nuevo usuario y grupo <em>proxy</em> al
sistema.  Para el soporte de &eacute;ste debe a&ntilde;adir la
siguiente entrada de usuario usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
</p>

<pre>
proxy:*:71:71::0:0:Proxy Services:/nonexistent:/sbin/nologin
</pre>

<p>
Tambi&eacute;n a&ntilde;ada tambi&eacute;n el grupo
<em>proxy</em> a <em>/etc/group</em>:
</p>

<pre>
proxy:*:71:
</pre>

<p>
Adem&aacute;s, como parte de la actualizaci&oacute;n a
Sendmail 8.12, sendmail ya no tiene el <em>bit setuid
root</em>.  Un nuevo usuario y grupo, <em>smmsp</em>, han sido
a&ntilde;adidos al sistema.  A&ntilde;ada una l&iacute;nea
como la siguiente a <em>/etc/group</em>:
</p>

<pre>
smmsp:*:25:
</pre>

<p>
A continuaci&oacute;n ejecute
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>
y a&ntilde;ada la siguiente l&iacute;nea para el usuario
<em>smmsp</em>:
</p>

<pre>
smmsp:*:25:25::0:0:Sendmail Message Submission Program:/nonexistent:/sbin/nologin
</pre>

<p>
Aseg&uacute;rese de que esta l&iacute;nea aparezca antes de
cualquier otra l&iacute;nea de la configuraci&oacute;n sobre
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yp&amp;sektion=8">yp(8)</a>.
</p>

<p>
Para finalizar, tambi&eacute;n se a&ntilde;adieron un nuevo
usuario y grupo para el servidor popa3d de <em>Solar
Designer</em>, que ahora forma parte integral del sistema.
A&ntilde;adia la siguiente l&iacute;nea a <em>/etc/group</em>:
</p>
 
<pre>
popa3d:*:26:
</pre> 
 
<p>
y usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8" >vipw(8)</a>,
a&ntilde;ada
</p>

<pre>
popa3d:*:26:26::0:0:POP3 server:/var/empty:/sbin/nologin
</pre>

<a name="8.2"></a>
<h3>
8.2: Nuevo paquete de filtros: <em>pf</em>
</h3>

<p>
El paquete de cortafuegos IPF que hab&iacute;a formado parte
de las versiones anteriores de OpenBSD ha sido reemplazado por
una suite de cortafuegos completamente nueva, llamada
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">pf(4)</a>.
Como resultado, es necesario llevar a cabo unos cuantos
cambios.
</p>

<p>
Primero, <em>pf</em> depende de un nuevo fichero de
dispositivo.  Para asegurarse de que se crea este dispositivo
especial haga la siguiente:
</p>

<pre>
  $ cd /dev
  $ sudo cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  $ sudo ./MAKEDEV all
</pre>

<p>
Segundo, han acontecido algunos cambios en el sistema de
archivos.  Los siguientes binarios han sido reemplazados:
</p>

<pre>
ANTIGUOS (IPF):
/sbin/ipf /sbin/ipfstat /sbin/ipnat /usr/sbin/ipfs
/usr/sbin/ipftest /usr/sbin/ipmon /usr/sbin/ipresend
/usr/sbin/ipsend /usr/sbin/iptest
NUEVOS (PF):
/sbin/pfctl
/usr/libexec/ftp-proxy
</pre>

<p>
De igual modo, para los dispositivos:
</p>

<pre>
ANTIGUOS (IPF): /dev/ipl /dev/ipnat /dev/ipstate /dev/ipauth
NUEVOS (PF): /dev/pf
</pre>

<p>
Y finalmente los ficheros de configuraci&oacute;n del filtro:
</p>

<pre>
ANTIGUOS (IPF): /etc/ipf.rules /etc/ipnat.rules
NUEVOS (PF): /etc/pf.conf /etc/nat.conf
</pre>

<p>
Se ha a&ntilde;adido un mecanismo para activar <em>pf</em> de
forma segura a los ficheros <em>/etc/rc</em> y
<em>/etc/rc.conf</em>.  Es necesario actualizar estos ficheros
para que incluyan el nuevo mecanismo de enganche.  Si desea
activar <em>pf</em>, configure PF=YES en
<em>/etc/rc.conf</em>.
</p>


<a name="8.3"></a>
<h3>
8.3: Cambios en <em>make</em>
</h3>

<p>
Se han producido algunos cambios en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">make(1)</a>
y en sus ficheros de datos, que pueden originar dificultades
en el proceso de compilaci&oacute;n e instalaci&oacute;n.
Estos cambios suelen manifestarse con errores de
<em>bsd.own.mk</em> durante la compilaci&oacute;n e
instalaci&oacute;n.  Para evitarlo, actualice antes los
ficheros de datos: Antes que nada actualice los ficheros de
datos:
</p>

<pre>
  $ cd /usr/src/share/mk
  $ sudo make install
</pre>

<p>
y entonces compile e installe el nuevo <em>make</em>:
</p>

<pre>
  $ cd /usr/src/usr.bin/make
  $ make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  $ sudo make install
</pre>

<p>
Ahora siga actualizando.
</p>


<a name="8.4"></a>
<h3>
8.4: La compilaci&oacute;n falla debido a errores de KerberosV
</h3>

<p>
Antes de intentar compilar todo el sistema, debe compilar
KerberosV:
</p>

<p>
Primero, hay un nuevo directorio de configuraci&oacute;n de
KerberosV en <em>/etc</em>.  Si todav&iacute;a no lo ha hecho,
use el procedimiento de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
descrito en <a href="#1.13">section 1.13</a> para crearlo:
</p>
 
<p>
Ahora, compile KerberosV:
</p>

<pre>
  $ cd /usr/src/kerberosV
  $ sudo make obj
  $ cd lib/roken
  $ sudo make 
  $ cd ../../usr.bin/asn1_compile
  $ sudo make
  $ sudo make install
</pre>

<p>
Tambi&eacute;n puede ser necesario actualizar
<em>/etc/login.conf</em> para indicar que el nombre del
fichero <em>/usr/libexec/auth/login_krb-or-pwd</em> ahora es
<em>login_krb<strong>4</strong>-or-pwd</em>.
</p>

<a name="8.5"></a>
<h3>
8.5: Nueva versi&oacute;n de sendmail
</h3>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
ha sido actualizado a la versi&oacute;n 8.12.  Como a partir
de esta versi&oacute;n, sendmail ya no ejecuta <em>setuid
root</em>, existen algunos cambios muy significativos.
</p>

<ol>
<li>Un usuario y grupo nuevos, <em>smmsp</em>, han sido
a&ntilde;adidos.  Si todav&iacute;a no lo ha hecho, siga el
procedimiento que se describe en la
<a href="#8.1">secci&oacute;n 8.1</a> para crearlos.</li>
<li>Han tendio lugar varios cambios en la jerarqu&iacute;a de
archivos, incluido un nuevo directorio
<em>/var/spool/clienmqueue</em> y nuevos permisos para
<em>/var/spool/mqueue</em>.  Estos cambios se pueden efectuar
usando el procedimiento de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
que se describe en <a href="#1.13">la secci&oacute;n
1.13</a>.</li>
<li>
<p>A&ntilde;ada lo siguiente al fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a>
de root.  Esto es necesario dado que <em>sendmail</em> ya no
ejecuta <em>setuid root</em>, y necesitar&aacute; esta entrada
para hacer parte de su funci&oacute;n:</p>
<pre>
# sendmail clientmqueue runner
*/30    *       *       *       *       /usr/sbin/sendmail -L sm-msp-queue -Ac -q
</pre>
</li>
<li>
<p>Actualice sendmail:</p>
<pre>
  $ cd /usr/src/gnu/usr.sbin/sendmail
  $ make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; sudo make install
</pre>
<p>
<strong>Nota:</strong> los ficheros <em>submit.cf</em> y
<em>localhost.cf</em> se han instalado en su directorio
<em>/etc/mail</em>.  El primero de &eacute;stos,
<em>submit.cf</em> (al que la documentaci&oacute;n actual de
sendmail llama el fichero de configuraci&oacute;n del
&laquo;cliente&raquo;), lo utilizan los agentes de usuario de
correo que quieren enviar correo de forma local para su
reparto por medio de sendmail.  Debido a los cambios en los
permisos que se han descrito anteriormente, para esto no es
necesario disponer de privilegios de superusuario:  el
identificador de grupo del binario ejecutable de sendmail se
configura con <em>smmsp</em>.  El segundo fichero,
<em>localhost.cf</em>, es una particularidad de OpenBSD que
ejecuta sendmail s&oacute;lo para escuchar en la interfaz del
anfitri&oacute;n local para aceptar el correo que provenga del
anfitri&oacute;n sin aceptar conexiones provenientes de la red
(si utiliza, por ejemplo,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=smtpd&amp;sektion=8">smtpd(8)</a>
para escuchar por el puerto SMTP de su interfaz externa, es
casi seguro que le interesar&aacute; usar esta opci&oacute;n).
Puede conocer m&aacute;s detalles al respecto leyendo en
fichero <em>SECURITY</em> que encontrar&aacute; en
<em>/usr/src/gnu/usr.sbin/sendmail/sendmail</em>.
</p>
<p>
Es muy recomendable que regenere y actualice sus ficheros de
configuraci&oacute;n de sendmail en <em>/etc/mail</em>.  Puede
encontrar algunos ficheros de configuraci&oacute;n funcionales
en <em>/usr/share/sendmail/cf</em>.  N&oacute;tese que el
fichero <em>localhost.cf</em> se genera desde
<em>openbsd-localhost.mc</em>.
</p>
</li>
<li>
<p>Si utiliza sendmail sin la opci&oacute;n <kbd>-bd</kbd> en
<em>/etc/rc.conf</em>, que es como se usa en la
configuraci&oacute;n de la instalaci&oacute;n predeterminada,
tendr&aacute; que usar <em>localhost.cf</em>.  Edite el
fichero <em>rc.conf</em> para a&ntilde;adir lo siguiente:</p>
<pre>
# For normal use: &quot;-L sm-mta -bd -q30m&quot;
sendmail_flags=&quot;-L sm-mta -C/etc/mail/localhost.cf -bd -q30m&quot;
</pre>
</li>
<li>
<p>En cuanto est&eacute; preparado su fichero de
configuraci&oacute;n, use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a>
para acabar con el proceso existente de sendmail:</p>
<pre>
  kill `sed 1q /var/run/sendmail.pid`
</pre>
<p>y reinicie el nuevo sendmail con las opciones apropiadas,
como por ejemplo:</p>
<pre>
  /usr/sbin/sendmail -L sm-mta -bd -q30m
</pre>
<p>para una configuraci&oacute;n que acepte correo desde el
exterior, o:</p>
<pre>
  /usr/sbin/sendmail -L sm-mta -C/etc/mail/localhost.cf -bd -q30m
</pre>
<p>para una configuraci&oacute;n que s&oacute;lo acepte correo
interno.</p>
<p><strong>Nota:</strong> el indicador <kbd>-bd</kbd> es ahora
necesario en ambos casos.</p>
</li>
</ol>

<p>
El nuevo <em>sendmail</em> deber&iacute;a funcionar a partir
de este momento.
</p>

<a name="8.6"></a>
<h3>
8.6: Cambio en <em>/etc/primes</em>.
</h3>

<p>
El nombre del fichero <em>/etc/primes</em> es ahora
<em>/etc/moduli</em>.  S&oacute;lo tiene que copiarlo desde su
antigua ubicaci&oacute;n o desde <em>/usr/src/etc/</em>.
</p>


<a name="9.0"></a>
<h2>
9.0 - Actualizaci&oacute;n desde la versi&oacute;n 3.0
</h2>

<a name="9.1"></a>
<h3>
9.1: Eliminaci&oacute;n de <em>libdl</em> en plataformas ELF
</h3>

<p>
Las plataformas basadas en ELF (alpha, macppc y sparc64) ya no
usan <em>libdl</em>.  La actualizaci&oacute;n desde un sistema
libdl a otro no libdl se har&aacute; mejor siguiendo estos
pasos:<br>
</p>

<ul>
<li>
<p>Recompile su sistema:</p>
<pre>
$ cd /usr/src
$ make build
</pre>
</li>
<li>
<p>Si <kbd>make build</kbd> se complet&oacute; con
&eacute;xito, puede continuar y eliminar <em>libdl</em>.
N&oacute;tese que los paquetes que se hayan enlazado contra
<em>libdl</em> deber&iacute;an ser reinstalados depu&eacute;s
de eliminarlo.  Si no est&aacute; preparado para hacerlo,
puede saltarse este paso de momento.  Las versiones
preliminares (<em>snapshots</em>) traer&aacute;n paquetes
correctos.</p>
<pre>
# rm -f /usr/lib/libdl.* /usr/lib/libdl_pic.a
</pre>
</li>
<li>
<p>Una vez eliminado <em>libdl</em>, regenere el cach&eacute;
de sus bibliotecas compartidas:</p>
<pre>
# ldconfig -R
</pre>
</li>
</ul>

<a name="9.2"></a>
<h3>
9.2: Nuevo marco de regresi&oacute;n
</h3>

<p>
Se ha introducido una nueva infraestructura para pruebas de
regresi&oacute;n, y se ha a&ntilde;adido
<em>bsd.regress.mk</em>.  Tendr&aacute; que instalarlo antes
de ejecutar <kbd>make obj</kbd>.
</p>

<pre>
  $ cd /usr/src/share/mk
  $ sudo make install
</pre>

<p>
--
</p>
<br>
<address>
<p>
Originally [OpenBSD: upgrade-minifaq.html,v 1.85 2002/01/16 20:28:05 kjell Exp ]<br />
$Translation: upgrade-minifaq.html,v 1.33 2002/01/17 21:11:49 horacio Exp $<br />
$OpenBSD: upgrade-minifaq.html,v 1.29 2002/01/19 09:12:50 jufi Exp $<br />
Copyright &copy; 1998-2002, Kjell Wooding.<br />
Env&iacute;e cualquier comentario, pregunta o sugerencia
(s&oacute;lo en ingl&eacute;s, por favor) a
<a href="mailto:kjell@openbsd.org">kjell@openbsd.org</a>
</p>
</address>

</body>
</html>
