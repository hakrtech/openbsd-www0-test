<html>
<head>
<title>10.0 - Gesti&oacute;n del sistema</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Language" content="es">
<meta name="resource-type" content="documento">
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,faq,documentación">
<meta name="distribution"  content="global">
<meta name="copyright"     content="Este documento es copyright 1998-2002 de OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<h2><font color="#e00000">10.0 - Gesti&oacute;n del
sistema</font><hr></h2>
</p>

<p>
<ul><h3>Tabla de contenidos</h3>
<li><a href="#wheel">10.1 - Cuando un usuario intenta
convertirse en el superusuario <em>root</em> con
<kbd>su(1)</kbd>, le dice que est&aacute; en el grupo
err&oacute;neo.</a>
(&quot;wrong group&quot;).</li>
<li><a href="#DupFS">10.2 - &iquest;C&oacute;mo puedo duplicar
un sistema de archivos?</a></li>
<li><a href="#rc">10.3 - &iquest;C&oacute;mo inicio los
d&aelig;mons con el sistema?</a>
( <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html">rc(8)</a> ).</li>
<li><a href="#RelayingDenied">10.4 - &iquest;Por qu&eacute;
cuando los usuarios env&iacute;an correo a trav&eacute;s de mi
sistema OpenBSD se les niega el acceso de reenv&iacute;o?</a>
(&quot;relaying access denied&quot;).</li>
<li><a href="#POP">10.5 - He configurado POP, pero obtengo
errores cuando accedo a mi correo a trav&eacute;s de POP.
&iquest;Qu&eacute; puedo hacer?</a></li>
<li><a href="#HTTPS">10.6 - C&oacute;mo se configura un
servidor HTTP seguro usando SSL(8).</a></li>
<li><a href="#vipw">10.7 - He hecho cambios a /etc/passwd con
vi(1), pero los cambios no funcionan.  &iquest;Por
qu&eacute;?</a></li>
<li><a href="#AddDelUser">10.8 - &iquest;C&oacute;mo
a&ntilde;ado un usuario?  &iquest;C&oacute;mo elimino un
usuario?</a></li>
<li><a href="#FTPOnly">10.9 - &iquest;C&oacute;mo puedo crear
una cuenta s&oacute;lo FTP?</a></li>
<li><a href="#Quotas">10.10 - C&oacute;mo configurar cuotas
para limitar el uso del disco a los usuarios.</a> 
( <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">quota(1)</a> ).</li>
<li><a href="#Kerberos">10.11 - C&oacute;mo se configura un
cliente/servidor Kerberos.</a></li>
<li><a href="#AnonFTP">10.12 - C&oacute;mo se configura un
servidor de FTP an&oacute;nimo.</a></li>
<li><a href="#ftpchroot">10.13 - C&oacute;mo puedo confinar a
los usuarios a sus directorios de usuario (<em>/home</em>) en
ftpd(8).</a>
<li><a href="#Patches">10.14 - C&oacute;mo se aplican los
parches en OpenBSD.</a>
</ul>
</p> 
<hr>

<br>

<p>
<a name="wheel"></a>
<a name="10.1"></a>
<h2>10.1 - &iquest;Por qu&eacute; me dice que estoy en el
grupo err&oacute;neo cuando intento ingresar como usuario
<em>root</em> con <kbd>su(1)</kbd>?</h2>
</p>

<p>
Para que un usuario normal se pueda convertir en el
superusuario <em>root</em>, debe a&ntilde;adirlo al grupo
<kbd>wheel</kbd> a mano.  Esto se hace por motivos de
seguridad, y se recomienda tener cuidado con los usuarios a
los que se otorgue este acceso especial.  En OpenBSD, los
usuarios que pertenezcan al grupo <kbd>wheel</kbd>
podr&aacute;n usar el programa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html">su(1)</a>
en modo usuario (<em>userland program</em>) para convertirse
en el usuario <em>root</em>.  Los usuarios que no pertenezcan
al grupo <kbd>wheel</kbd> no podr&aacute;n usar su(1).  A
continuaci&oacute;n puede ver el ejemplo de una entrada en el
fichero <em>/etc/group</em> para asociar al usuario
<strong>ericj</strong> al grupo <kbd>wheel</kbd>.

<p>
Si va a crear un usuario nuevo con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&apropos=0&sektion=8&format=html">adduser(8)</a>,
puede asociarlo al grupo <kbd>wheel</kbd> desde el punto
<tt>Invite <em>user</em> into other groups:</tt>, simplemente
contestando <kbd>wheel</kbd>.  De este modo se
a&ntilde;adir&aacute; al usuario a la l&iacute;nea del grupo
<kbd>wheel</kbd>, en el fichero <em>/etc/group</em>, que
quedar&aacute; del siguiente modo:
</p>

<ul>
<pre>
wheel:*:0:root,ericj
</pre>
</ul>

<p>
Si lo que busca un modo de permitir a los usuarios acceso
limitado a los privilegios del superusuario, sin tener que
asociarlos al grupo <kbd>wheel</kbd>, use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html">sudo(8)</a>.
</p>

<p>
<a name="DupFS"></a>
<a name="10.2"></a>
<h2>10.2 - &iquest;C&oacute;mo puedo duplicar un sistema de
archivos?</h2>
</p>

<p>
Para duplicar su sistema de archivos use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>.
Por ejemplo, para duplicar todo el directorio <kbd>SRC</kbd>
al directorio <kbd>DST</kbd>, haga lo siguiente:
</p>

<ul>
<pre>
# <strong>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</strong>
</pre>
</ul>

<p>
<kbd>dump</kbd> est&aacute; dise&ntilde;ado para ofrecer una
gran variedad de posibilidades para copias de
respaldo/seguridad, y puede resultar excesivo si s&oacute;lo
quiere duplicar un &uacute;nico sistema de archivos o parte de
&eacute;l.  La orden
<a href"http://www.openbsd.org/cgi-bin/man.cgi?query=tar&sektion=1&format=html">tar(1)</a>
puede resultar m&aacute;s r&aacute;pida para una
operaci&oacute;n de este tipo.  El formato es muy parecido:

<ul>
<pre>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</pre>
</ul>
<br>

<p>
<a name="rc"></a>
<a name="10.3"></a>
<h2>10.3 - &iquest;C&oacute;mo inicio los d&aelig;mons con el sistema?
( <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">rc(8)</a> )</h2>
</p>

<p>
OpenBSD usa un inicio del estilo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">rc(8)</a>,
para lo que necesita unos cuantos ficheros claves para
iniciar.
</p>

<ul>
   <li>/etc/rc - Gui&oacute;n (<em>&quot;script&quot;</em>)
   principal.  No se debe editar.
   <li>/etc/rc.conf - Fichero de configuraci&oacute;n usado
   por <em>/etc/rc</em> para saber qu&eacute; d&aelig;mons
   deben iniciarse con el sistema.
   <li>/etc/netstart - Gui&oacute;n usado para iniciar la red.
   No se debe editar.
   <li>/etc/rc.local - Gui&oacute;n usado para tareas de
   administraci&oacute;n local.  Aqu&iacute; se debe almacenar
   informaci&oacute;n espec&iacute;fica de la m&aacute;quina
   anfitriona o de los d&aelig;mons.
   <li>/etc/rc.securelevel - Gui&oacute;n para ejecutar las
   &oacute;rdenes que deben ser invocadas antes de los cambios
   en el nivel de seguridad.  V&eacute;ase
   <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a>.
   <li>/etc/rc.shutdown - Gui&oacute;n invocado por 
   <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&sektion=8&apropos=0&manpath=OpenBSD+Current&format=html">shutdown(8)</a>.
   A&ntilde;ada en este fichero cualquier cosa que quiera
   hacer antes de cerrar el sistema.  V&eacute;ase
   <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&sektion=8&format=html">rc.shutdown(8)</a>.
</ul>

<h3>&iquest;C&oacute;mo funciona rc(8)?</h3>

<p>
Los ficheros m&aacute;s importantes para un administrador de
sitemas son <em>/etc/rc.conf</em>, <em>/etc/rc.local</em> y
<em>/etc/rc.shutdown</em>.  Para que se pueda hacer una idea
sobre c&oacute;mo funciona el procedimiento de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">rc(8)</a>, mire este flujo:
</p>

<ul>Despu&eacute;s de arrancar el n&uacute;cleo del sistema,
se inicia <em>/etc/rc</em>.
   <li>Se comprueban los sistemas de archivos
   (<em>&quot;filesystems&quot;</em>).  Este paso se
   omitir&aacute; en caso de que exista el fichero
   <em>/etc/fastboot</em>, pero no es conveniente hacerlo de
   este modo.
   <li>Se leen las variables de configuraci&oacute;n de
   <em>/etc/rc.conf</em>.
   <li>Se montan los sistemas de archivos.
   <li>Se limpia el sistema de archivos <em>/tmp</em> y se
   conserva cualquier fichero creado por el editor.
   <li>Se configura la red por medio de
   <em>/etc/netstart</em>:
   <ul>
      <li>Se configuran las interfaces.
      <li>Se configuran &quot;hostname&quot;,
      &quot;domainname&quot;, etc.
   </ul>
   <li>Se inician los &quot;d&aelig;mons&quot;.
   <li>Se llevan a cabo varias comprobaciones
   (&quot;quota&quot;, &quot;savecore&quot;, etc...).
   <li>Se invocan y ejecutan los &quot;d&aelig;mons&quot;
   locales, como en <em>/etc/rc.local</em>.
</ul>

<h3>Inicio de los d&aelig;mons y servicios predefinidos en
OpenBSD</h3>

<p>
La mayor&iacute;a de d&aelig;mons y servicios que vienen
predefinidos en OpenBSD pueden iniciarse durante el arranque,
editando el fichero de configuraci&oacute;n
<em>/etc/rc.conf</em>.  Un ejemplo lo puede encontrar en el
fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf">/etc/rc.conf</a>
que viene incluido con el sistema, en donde ver&aacute;
l&iacute;neas parecidas a la siguiente:

</p>

<ul>
<pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags=&quot;-D&quot;
</pre>
</ul>

<p>
Una l&iacute;nea como &eacute;sta nos indica que ftpd no se
inicia con el sistema (al menos no mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html">rc(8)</a>;
lea la <a href="#AnonFTP">secci&oacute;n sobre FTP
An&oacute;nimo</a> para m&aacute;s informaci&oacute;n al
respecto).  En cualquier caso, cada l&iacute;nea va
acompa&ntilde;ada por un comentario que le mostrar&aacute; los
indicadores para el uso <strong>NORMAL</strong> de ese
d&aelig;mon o servicio.  Esto no significa que debe invocar el
d&aelig;mon o servicio en cuesti&oacute;n con esos
indicadores.  Siempre se puede usar la documentaci&oacute;n de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=man&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">man(1)</a>
(las p&aacute;ginas del manual) para ver c&oacute;mo se puede
iniciar de cualquier otro modo que se prefiera ese d&aelig;mon
o servicio.  Por ejemplo, vea la l&iacute;nea predefinida para
la entrada de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">httpd(8)</a>:
</p>

<ul>
<pre>
httpd_flags=NO          # for normal use: &quot;&quot; (or &quot;-DSSL&quot; after reading ssl(8))
</pre>
</ul>

<p>
Aqu&iacute; puede verse con claridad que no es necesario
ning&uacute;n indicador para iniciar httpd.  Por lo tanto,
s&oacute;lo ser&aacute; necesaria una l&iacute;nea como la
siguiente:

<ul>
<pre>
<strong>httpd_flags=&quot;&quot;</strong>
</pre>
</ul>

Pero para iniciar httpd con ssl (v&eacute;ase la <a
href="#HTTPS">secci&oacute;n sobre SSL</a> o la p&aacute;gina
del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>),
necesitar&aacute; una l&iacute;nea como &eacute;sta:

<ul>
<pre>
httpd_flags=&quot;-DSSL&quot;
</pre>
</ul>
</p>

<h3>Inicio y configuraci&oacute;n de d&aelig;mons locales</h3>

<p>
Para instalar otros d&aelig;mons en el sistema, por medio de
los portes o cualquier otro medio, debe usar el fichero
<em>/etc/rc.local</em>.  Por ejemplo, supongamos que se ha
instalado un d&aelig;mon que se encuentra en
<em>/usr/local/sbin/daemonx</em>, y que se desea iniciar
durante el arranque del sistema.  Para ello pondr&iacute;a una
entrada como la siguiente en <em>/etc/rc.local</em>:
</p>

<ul>
<pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre>
</ul>

<p>
Desde este momento, el d&aelig;mon ser&aacute; invocado
durante el arranque.  Tambi&eacute;n podr&aacute; ver
cualquier error durante el arranque;  un arranque normal sin
errores s&oacute;lo mostrar&iacute;a una l&iacute;nea como
&eacute;sta:
</p>

<ul>
<pre>
Starting local daemons: daemonx.
</pre>
</ul>

<h3><em>rc.shutdown</em></h3>

<p>
<em>/etc/rc.shutdown</em> es un gui&oacute;n (<em>script</em>)
que se invoca al cerrar el sistema.  Cualquier cosa que quiera
hacer antes de que se cierre el sistema la debe a&ntilde;adir
a este fichero.  Si tiene apm tambi&eacute;n puede configurar
&quot;powerdown=YES&quot;, que le dar&aacute; un resultado
equivalente a <kbd>shutdown -p</kbd>.
</p>


<p>
<a name="RelayingDenied"></a>
<a name="10.4"></a>
<h2>10.4 - &iquest;Por qu&eacute; cuando los usuarios
env&iacute;an correo a trav&eacute;s de mi sistema OpenBSD se
les niega el acceso de reenv&iacute;o?</h2>
</p>

<p>
Pruebe lo siguiente:
</p>
<ul>
<pre>
# <strong>cat /etc/mail/sendmail.cf | grep relay-domains</strong>
</pre>
</ul>
<p>
La salida ser&aacute; parecida a &eacute;sta:
</p>
<ul>
<pre>
FR-o /etc/mail/relay-domains
</pre>
</ul>
<p>
Si este fichero no existe, debe crearlo.  Necesitar&aacute;
introducir los hu&eacute;spedes que est&eacute;n enviando
correo remoto;  para ello utilice la siguiente sintaxis:
</p>

<ul>
<pre>
.dominio.com    #Permitir el reenv&iacute;o desde/hacia
                #cualquier hu&eacute;sped en dominio.com
sub.dominio.com #Permitir el reenv&iacute;o desde/hacia
		#sub.dominio.com y cualquier hu&eacute;sped en
		#ese dominio
10.2            #Permitir el reenv&iacute;o desde todos los
	        #hu&eacute;spedes en la red IP 10.2.*.*
</pre>
</ul>

<p>
No olvide enviar una se&ntilde;al 'HangUP' a sendmail (una
se&ntilde;al que hace que la mayor&iacute;a de d&aelig;mons
vuelvan a leer sus ficheros de configuraci&oacute;n):
</p>
<ul>
<pre>
# <strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre>
</ul>
<p>

<h3>M&aacute;s informaci&oacute;n</h3>

<p>
<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.html">http://www.sendmail.org/tips/relaying.html</a>
<li><a href="http://www.sendmail.org/antispam.html">http://www.sendmail.org/antispam.html</a>
</ul>
</p>

<p>
<a name="POP"></a>
<a name="10.5"></a>
<h2>10.5 - He configurado POP, pero obtengo errores cuando
accedo a mi correo a trav&eacute;s de POP.  &iquest;Qu&eacute;
puedo hacer?</h2>
</p>

<p>
La mayor&iacute;a de problemas relacionados con POP tienen que
ver con ficheros temporales y ficheros de bloqueo.  Si su
servidor pop env&iacute;a un mensaje de error como el
siguiente,
</p>

<ul>
<pre>
-ERR Couldn't open temporary file, do you own it?
</pre>
</ul>

<p>
intente configurar sus permisos del siguiente modo:

<ul>
<pre>
permisos en /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permisos en /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre>
</ul>
</p>

<p>
Adem&aacute;s, tambi&eacute;n puede comprobar que el usuario
sea realmente el propietario de su propio fichero
<em>/var/mail</em>.  Por supuesto, esto deber&iacute;a ser
as&iacute; (por ejemplo, el propietario de
<em>/var/mail/joe</em> deber&iacute;a ser el usuario
<em>joe</em>), pero si no estuviera correctamente configurado
podr&iacute;a ser la causa del problema.
</p>

<p>
Dejar <em>/var/mail</em> con permiso de escritura para el
grupo <em>mail</em> crea algunos problemas de seguridad.  Es
probable que nunca tenga problemas con eso...  &iexcl;pero
podr&iacute;a tenerlos!  (especialmente si su sitio es de alto
rendimiento, como un ISP, ...) Pruebe a invocar 'cucipop' u
otro d&aelig;mon de la colecci&oacute;n de portes de OpenBSD.
O podr&iacute;a darse el caso que tuviera seleccionadas las
opciones err&oacute;neas para su d&aelig;mon 'pop' (como
&quot;<em>dot locking</em>&quot;).  O tambi&eacute;n es
posible que necesitara cambiar el directorio que bloquea
(aunque entonces, el bloqueo s&oacute;lo ser&iacute;a de valor
para el d&aelig;mon POP).
</p>

<p>
<strong>PD:</strong> N&oacute;tese que OpenBSD no tiene un
grupo con el nombre &quot;<em>mail</em>&quot;.  Debe crearlo
en su fichero <em>/etc/group</em> con una entrada como
&eacute;sta:

<ul>
<pre>
mail:*:6:
</pre>
</ul>
</p>


<p>
<a name="HTTPS"></a>
<a name="10.6"></a>
<h2>10.6 - C&oacute;mo se configura un servidor HTTP seguro
usando SSL(8)</h2>
</p>

<p>
Desde la versi&oacute;n 2.8, OpenBSD incluye httpd y RSA
preparados para las bibliotecas SSL.  Sin embargo, si
est&aacute; usando OpenBSD 2.6 &oacute; 2.7, debe instalar Vd
mismo los paquetes de SSL para que usen SSL.  Para m&aacute;s
informaci&oacute;n, <strong>man 8 ssl</strong>.
</p>

<p>
Para usarlas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>,
antes debe haber generado un certificado que se
guardar&aacute; en <em>/etc/ssl/private/</em>.  Los pasos que
aqu&iacute; se muestran est&aacute;n tomados, en parte, de la
p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.
Para m&aacute;s informaci&oacute;n, lea esta p&aacute;gina.
En estas preguntas frecuentes tan s&oacute;lo se explica
c&oacute;mo generar un certificado RSA para servidores de
<em>web</em>, no un certificado DSA para servidores.  Si desea
saber c&oacute;mo hacerlo, por favor lea la p&aacute;gina del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&sektion=8&format=html">ssl(8)</a>.
</p> 

<p>
Antes de empezar, necesita generar su clave de servidor y su
certificado.  Para poder usar las caracter&iacute;sticas de
RSA, antes debe actualizar <em>libssl</em>.  Despu&eacute;s de
ello ya puede generar su clave usando OpenSSL:
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
O, si lo desea, puede cifrar la clave con una
contrase&ntilde;a que tendr&aacute; que introducir cuando
inicie los servidores:
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
El pr&oacute;ximo paso es generar un <em>&quot;Certificate
Signing Request&quot;</em> (requerimiento para firmar el
certificado), que se usa para que una Autoridad Certificadora
(CA) firme su certificado.  Para ello use la orden:
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</pre>
</div>

<p>
El fichero <em>server.csr</em> se puede entregar a la
Autoridad Certificadora que firmar&aacute; la clave.  Una de
estas CA es <strong>Thawte Certification</strong>, y la puede
localizar en
<a href="http://www.thawte.com/">http://www.thawte.com/</a>.
Actualmente Thawte puede firmar sus claves RSA.  Est&aacute;
en marcha un procedimiento para poder firmar tambi&eacute;n
las claves DSA.
</p>

<p>
Si no se lo puede permitir, o si quiere firmar Vd. mismo el
certificado, puede usar lo siguiente:
</p>

<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</pre>
</div>

<p>
Con <em>/etc/ssl/server.crt</em> y
<em>/etc/ssl/private/server.key</em> en su sitio ya puede
iniciar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a>
con el indicador <strong>-DSSL</strong>, permitiendo
transacciones https con su m&aacute;quina por el puerto 443.
</p> 

<p>
<a name="vipw"></a>
<a name="10.7"></a>
<h2>10.7 - He hecho cambios a <em>/etc/passwd</em>, pero los
cambios no funcionan.  &iquest;Por qu&eacute;?</h2>
</p>

<p>
Si edita <em>/etc/passwd</em>, cualquier cambio que haga se
perder&aacute;.  OpenBSD genera el fichero
<em>/etc/passwd</em> de forma din&aacute;mica con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&sektion=8&apropos=0">pwd_mkdb(8)</a>.
El fichero principal de las contrase&ntilde;as en OpenBSD es
<em>/etc/master.passwd</em>.  De acuerdo con la p&aacute;gina
del manual de pwd_mkdb(8):

<ul>
<pre>
FILES
     /etc/master.passwd  fichero de contrase&ntilde;a actual
     /etc/passwd         fichero de contrase&ntilde; en formato Version 7
     /etc/pwd.db         fichero de base de datos de la contrase&ntilde;a
                         no seguro
     /etc/pwd.db.tmp     fichero temporal
     /etc/spwd.db        fichero de base de datos de la contrase&ntilde;a
                         seguro
     /etc/spwd.db.tmp    fichero temporal
</pre>
</ul>

<p>
En un fichero de contrase&ntilde;as tradicional de Unix, como
<em>/etc/passwd</em>, toda la informaci&oacute;n, incluida la
contrase&ntilde;a cifrada del usuario, est&aacute; disponible
para cualquiera que pueda acceder al sistema (y es el primer
objetivo para programas como <code>crack</code>).  4.4BSD
introdujo el fichero <em>master.passwd</em>, que tiene un
formato extendido (con opciones adicionales que van m&aacute;s
all&aacute; de las ofrecidas por <em>/etc/passwd</em>), y
s&oacute;lo puede ser le&iacute;do por el superusuario
<em>root</em>.  Para un acceso m&aacute;s r&aacute;pido a los
datos, las llamadas de las bibliotecas que acceden a estos
datos leen los ficheros <em>/etc/pwd.db</em> y
<em>/etc/spwd.db</em>.

<p>
OpenBSD incluye una herramienta,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html">vipw(8)</a>,
para la edici&oacute;n del fichero de contrase&ntilde;as.
<kbd>vipw</kbd> usa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vi&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">vi(1)</a>
(nuestro editor preferido, definido por $EDITOR) para editar el
fichero <em>/etc/master.passwd</em>.  Una vez que ha terminado
de editar, vuelve a crear los ficheros <em>/etc/passwd</em>,
<em>/etc/pwd.db</em>, y <em>/etc/spwd.db</em> conforme con los
cambios que haya llevado a cabo.  <kbd>vipw</kbd>
tambi&eacute;n se encarga de bloquear estos ficheros, de modo
que si alguna otra persona intentara cambiarlos al mismo
tiempo, no le permitir&iacute;a el acceso.
</p>

<p>
<a name="AddDelUser"></a>
<a name="10.8"></a>
<h2>10.8 - &iquest;C&oacute;mo a&ntilde;ado un usuario?
&iquest;C&oacute;mo elimino un usuario?</h2>
</p>

<p>
En OpenBSD 2.6, los usuarios dipon&iacute;an de la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>
para a&ntilde;adir usuarios.  A partir de OpenBSD 2.7, se
a&ntilde;adi&oacute; la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a>
para a&ntilde;adir y eliminar tanto usuarios como grupos.

<ul>
<li><a href="#adduser">adduser(8)</a>
<li><a href="#user">user(8)</a>
</ul>

<p>
<a name="adduser"></a>
En OpenBSD, la mejor manera para a&ntilde;adir un usuario es
usando el gui&oacute;n (<em>script</em>)
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>.
Puede configurarlo para que funcione como mejor le convenga,
editando el fichero <em>/etc/adduser.conf</em>.  Puede
a&ntilde;adir usuarios de forma manual, mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&sektion=8&format=html">vipw(8)</a>,
pero adduser(8) es el modo en que se recomienda hacerlo.  La
orden adduser(8) permite llevar a cabo comprobaciones de
consistencia sobre los ficheros <em>/etc/passwd</em> y
<em>/etc/group</em>, y sobre las bases de datos del
int&eacute;rprete (<em>shell</em>).  Tambi&eacute;n
generar&aacute; las entradas correspondientes y directorios
$HOME.  Incluso puede enviar un mensaje de bienvenida al
usuario.  Todo esto se puede modificar seg&uacute;n se desee.
He aqu&iacute; un ejemplo de c&oacute;mo un usuario ficticio,
<strong>testuser</strong>, es a&ntilde;adido a un sistema.  Su
directorio $HOME se ubicar&aacute; en <em>/home/testuser</em>,
se le a&ntilde;adir&aacute; al grupo <strong>guest</strong>, y
se le dar&aacute; el int&eacute;rprete (<em>shell</em>)
<em>/bin/ksh</em>:
</p>

<ul>
<pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>testuser</strong>
Enter full name []: <strong>Nombre Completo del Usuario</strong>
Enter shell csh ksh nologin sh [ksh]: <strong>ksh</strong>
Uid [1002]: <strong>&lt;Intro&gt;</strong>
Login group testuser [testuser]: <strong>guest</strong>
Login group is ``guest''. Invite testuser into other groups: guest no
[no]: <strong>no</strong>
Enter password []: <strike>introduzca una contrase&ntilde;a</strike>
Enter password again []: <strike>introduzca la contrase&ntilde;a otra vez</strike>

Name:     testuser
Password: ****
Fullname: Nombre Completo del Usuario
Uid:      1002
Gid:      31 (guest)
Groups:   guest
HOME:     /home/testuser
Shell:    /bin/ksh
OK? (y/n) [y]: <strong>y</strong>
Added user ``testuser''
Copy files from /usr/share/skel to /home/testuser
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre>
</ul>

<p>
Para eliminar usuarios debe usar la herramienta
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html">rmuser(8)</a>.
De esta forma se eliminar&aacute; todo vestigio de un usuario.
Se eliminar&aacute; cualquier entrada en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&sektion=1&format=html">crontab(1)</a>
relacionada con el usuario, su directorio $HOME (siempre que
el propietario de &eacute;ste sea el usuario en
cuesti&oacute;n), y su correo.  Tambi&eacute;n se
eliminar&aacute;n sus entradas en los ficheros
<em>/etc/passwd</em> y <em>/etc/group</em>.
</p>

<p>
A continuaci&oacute;n sigue un ejemplo sobre c&oacute;mo
eliminar el usuario que se ha a&ntilde;adido en el ejemplo
anterior.  Ver&aacute; que preguntar&aacute; por el nombre, y
si debe o no eliminar el directorio ra&iacute;z ($HOME) del
usuario.
</p>

<ul>
<pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry: <strike>introduzca la contrase&ntilde;a</strike>

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre>
</ul>

<a name="user"></a>
<h3>10.8.2 - C&oacute;mo a&ntilde;adir usuarios con
user(8)</h3>

<p>
A partir de la versi&oacute;n 2.7 de OpenBSD, se
a&ntilde;adieron muchas &oacute;rdenes para gestionar usuarios
y grupos.  Estas herramientas son menos interactivas que la
orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>,
que ayuda a facilitar el uso de &eacute;stas en un
gui&oacute;n (<em>script</em>).
</p>

<ul>
Una lista de las &oacute;rdenes a&ntilde;adidas:
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&sektion=8&format=html">group(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&sektion=8&format=html">groupadd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&sektion=8&format=html">groupdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&sektion=8&format=html">groupinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&sektion=8&format=html">groupmod(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&sektion=8&format=html">user(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&sektion=8&format=html">useradd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&sektion=8&format=html">userdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&sektion=8&format=html">userinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&sektion=8&format=html">usermod(8)</a>
</ul>

<h4>10.8.2.1 - C&oacute;mo a&ntilde;adir usuarios</h4>

<p>
Dado que user(8) no es interactivo, la forma m&aacute;s
f&aacute;cil para a&ntilde;adir usuarios de modo eficiente es
usar la orden adduser(8).  La orden <kbd>/usr/sbin/user</kbd>
es simplemente una interfaz para el resto de &oacute;rdenes
<kbd>/usr/sbin/user*</kbd>.  Por lo tanto, las siguientes
&oacute;rdenes pueden ser adheridas usando <kbd>user add</kbd>
o <kbd>useradd</kbd>;  el modo en que lo haga s&oacute;lo
depende de su elecci&oacute;n, y no altera en absoluto la
funci&oacute;n de la orden.
</p>

<p>
En este ejemplo estamos a&ntilde;adiendo el mismo usuario con
las mismas especificaciones que usamos para el nuevo usuario
de los <a href="#adduser">ejemplos anteriores</a>.  La orden
useradd(8) es m&aacute;s f&aacute;cil de usar si se sabe la
configuraci&oacute;n predeterminada antes de crear el usuario.
Estas configuraciones se encuentran en el fichero
<em>/etc/usermgmt.conf</em>, y se pueden ver del siguiente
modo:

<ul>
<pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre>
</ul>
</p>

<p>
Las configuraciones de arriba son las que se activar&aacute;n
de modo predeterminado a menos que se especifiquen otras
mediante opciones en la l&iacute;nea de &oacute;rdenes.  Por
ejemplo, en nuestro caso, queremos que el usuario pertenezca
al grupo <strong>guest</strong>, no al grupo
<strong>users</strong>.  Un peque&ntilde;o obst&aacute;culo
m&aacute;s al crear usuarios, es que las contrase&ntilde;as se
deben especificar desde la l&iacute;nea de &oacute;rdenes.
Las contrase&ntilde;as est&aacute;n cifradas, as&iacute; que
ser&aacute; necesario usar la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&sektion=1&format=html">encrypt(1)</a>
para crearla.  OpenBSD usa, de modo predeterminado, 6 veces el
algoritmo Blowfish para crear la contrase&ntilde;a.
</p>

<p>
He aqu&iacute; una l&iacute;nea que muestra c&oacute;mo crear
una contrase&ntilde;a para espicificarla en useradd(8).

<ul>
<pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre>
</ul>

<p>
Ahora que ya tenemos nuestra contrase&ntilde;a cifrada,
estamos preparados para a&ntilde;adirla al usuario:

<ul>
<pre>
# <strong>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</strong>
</pre>
</ul>
</p>

<p>
<strong>Nota:</strong>  Aseg&uacute;rese de usar comillas
simples (<strong>'</strong>) a ambos lados de la cadena de la
contrase&ntilde;a, y no comillas dobles
(<strong>&quot;</strong>) ya que &eacute;stas ser&iacute;an
interpretadas por el int&eacute;rprete de &oacute;rdenes
(<em>shell</em>) antes de enviar la cadena a user(8).
Adem&aacute;s de eso, aseg&uacute;rese de especificar la
opci&oacute;n <strong>-m</strong> si quiere que el directorio
ra&iacute;z del usuario sea creado y que los ficheros de
<em>/etc/skel</em> se copien a este directorio.
</p>

<p>
Para verificar que se ha creado el usuario correctamente
podemos usar muchas utilidades diferentes.  A
continuaci&oacute;n hay unas cuantas &oacute;rdenes que puede
usar para verificar r&aacute;pidamente que todo ha sido creado
correctamente.

<ul>
<pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Nombre Completo del Usuario
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre>
</ul>
</p>

<p>
Aparte de estas &oacute;rdenes, user(8) dispone de,
userinfo(8), su propia utilidad para mostrar las
caracter&iacute;sticas del usuario.

<ul>
<pre>
$ <strong>userinfo testuser</strong>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre>
</ul>
</p>

<h4>10.8.2.2 - C&oacute;mo eliminar usuarios</h4>

<p>
Para eliminar usuarios con la jerarqu&iacute;a de
&oacute;rdenes user(8), se debe usar userdel(8).  &Eacute;sta
es una orden muy simple, pero muy &uacute;til.  Para eliminar
el usuario creado en el ejemplo anterior, basta con ejecutar

<ul>
<pre>
# <strong>userdel -r testuser</strong>
</pre>
</ul>
</p>

<p>
N&oacute;tese que la opci&oacute;n <strong>-r</strong> se debe
especificar si se desea que el directorio ra&iacute;z del
usuario sea tambi&eacute;n eliminado.  De forma alternativa
puede especificar <strong>-p</strong> y no
<strong>-r</strong>, y as&iacute; se bloquear&aacute; la
cuenta del usuario pero no se eliminar&aacute; ninguna
informaci&oacute;n.
</p>

<p>
<a name="FTPOnly"></a>
<a name="10.9"></a>
<h2>10.9 - &iquest;C&oacute;mo puedo crear una cuenta s&oacute;lo FTP
(no FTP An&oacute;nimo)?</h2>
</p>

<p>
Existen varios modos de hacerlo, pero una manera muy com&uacute;n es
a&ntilde;adir <em>/usr/bin/false</em> en el fichero
<strong>/etc/shells</strong>.  As&iacute;, cuando cree el usuario,
configure su &laquo;int&eacute;rprete de &oacute;rdenes&raquo;
(<em>&quot;shell&quot;</em>) como <em>/usr/bin/false</em> y de este
modo no podr&aacute; ingresar de forma interactiva, pero podr&aacute;
usar ftp.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a> 
les dar&aacute; un directorio $HOME que ser&aacute;, por
definici&oacute;n, <em>/home/&lt;usuario&gt;</em>.
Si le parece bien de esta forma, no necesita cambiarlo;  sin embargo,
puede configurarlo a cualquier otro directorio que Vd. desee.  Puede
forzar que el usuario s&oacute;lo pueda ver los ficheros en su
directorio $HOME, a&ntilde;adiendo su nombre de usuario al fichero
<em>/etc/ftpchroot</em>.  Mediante el uso de la opci&oacute;n <strong>-A</strong>
para 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a>, 
puede restringir los ingresos (<em>login</em>) para que s&oacute;lo
sean posibles por ftpchroot.
</p>

<p>
<a name="Quotas"></a>
<a name="10.10"></a>
<h2>10.10 - Configuraci&oacute;n de cuotas</h2>
</p>

<p>
Las cuotas se usan para limitar el espacio del que disponen los
usuarios en sus discos.  Puede ser muy &uacute;til en situaciones en
las que Vd. disponga de recursos limitados.  Las cuotas se pueden
configurar de dos maneras diferentes:
</p>

<p>
<ul>
   <li>Cuotas de Usuario</li>
   <li>Cuotas de Grupo</li>
</ul>
</p>

<p>
El primer paso para configurar cuotas es asegurarse de que la
opci&oacute;n <code>QUOTA</code> se encuentra activada en la
configuraci&oacute;n del n&uacute;cleo de su sistema.  Esta
opci&oacute;n est&aacute; configurada en el n&uacute;cleo GENERIC.
Despu&eacute;s necesita marcar los sistemas de archivo para los que
vaya a configurar las cuotas en <em>/etc/fstab</em>.  Debe usar las
palabras clave <code>userquota</code> y <code>groupquota</code> para
marcar cada sistema de archivo en el que usará las cuotas.  Por
definici&oacute;n, los ficheros <code>quota.user</code> y
<code>quota.group</code> se crear&aacute;n en la ra&iacute;z de ese
sistema de archivo que tendr&aacute; la informaci&oacute;n sobre las
cuotas.  Esto se puede anular con la siguiente orden:
<code>userquota=/var/quotas/quota.user</code> ... o cualquier otro
fichero en el que quiera almacenar la informaci&oacute;n sobre cuotas.
He aqu&iacute; un ejemplo de <em>/etc/fstab</em> con un sistema de
archivo con cuotas de usuario activadas:
</p>

<ul>
<pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre>
</ul>

<p>
Ahora ya puede configurar las cuotas de usuario.
Para ello use la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html">edquota(8)</a>.
Una forma simple de usarlo es <strong>edquota &lt;usuario&gt;</strong>.
La orden edquota(8) usar&acute; vi(1) para editar las cuotas a menos
que la variable de entorno EDITOR indique un editor diferente.
Por ejemplo:
</p>

<ul>
<pre>
# <strong>edquota ericj</strong>
</pre>
</ul>

<p>
Esto dar&aacute; un resultado parecido al siguiente:
</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>
Para a&ntilde;adir l&iacute;mites, debe quedar algo como esto:
</p>

<ul>
<pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre>
</ul>

<p>
Aqu&iacute; el l&iacute;mite &quot;soft&quot; es de 1.000 bloques, y el
l&iacute;mite &quot;hard&quot; de 1.050 bloques.  El l&iacute;mite
&quot;soft&quot; es en el que el usuario s&oacute;lo recibe un aviso
cuando lo sobrepasa, y tiene hasta su periodo de gracia para rebajar su
uso del disco por debajo de su l&iacute;mite.  Los periodos de gracia
se pueden configurar usando la opci&oacute;n <strong>-t</strong> con la
orden edquota(8).  Despu&eacute;s de que el periodo de gracia haya
pasado, el l&iacute;mite &quot;soft&quot; se toma como l&iacute;mite
&quot;hard&quot;.  El resultado es un fallo de ubicaci&oacute;n
(&quot;allocation failure&quot;).
</p>

<p>
Una vez que las cuotas ya est&aacute;n configuradas, tiene que
activarlas.  Para ello use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html">quotaon(8)</a>.
Por ejemplo:
</p>

<ul>
<pre>
# <strong>quotaon -a</strong>
</pre>
</ul>

<p>
De este modo repasar&aacute; /etc/fstab para activar los sistemas de
archivo con opciones de cuota.  En cuanto las cuotas est&eacute;n
funcionando, puede verlas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html">quota(1)</a>.
Si usa la orden <strong>quota &lt;usuario&gt;</strong> obtendr&aacute;
la informaci&oacute;n sobre el usuario que especifique.  Al ser
invocada sin argumentos, la orden quota(8) le dar&aacute; sus
estad&iacute;sticas de cuotas.  Por ejemplo:
</p>

<ul>
<pre>
# <strong>quota ericj</strong>
</pre>
</ul>

<p>
Dar&aacute; como resultado algo como esto:
</p>

<ul>
<pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre>
</ul>

<p>
Las cuotas que est&eacute;n configuradas en <em>/etc/fstab</em>
iniciar&eacute;n durante el arranque por definici&oacute;n.  Para
desactivarlo use:

<ul>
<pre># <strong>quotaoff -a</strong>
</pre>
</ul>
</p>

<p>
<a name="Kerberos"></a>
<a name="10.11"></a>
<h2>10.11 - C&oacute;mo se configuran los clientes y
servidores Kerberos en OpenBSD</h2>
</p>

<p>
Como usuario o administrador de sistemas OpenBSD, tiene suerte de que
KerberosIV sea un componente preinstalado del sistema.  &Eacute;sta es
una gu&iacute;a para configurar el servidor Kerberos as&iacute; como el
cliente.
</p>

<p>
Un punto *IMPORTANT&Iacute;SIMO* a recordar es que los clientes y
servidores Kerberos deben tener sincronizados sus relojes del sistemas.
Si existe un lapsus de m&aacute;s de 5 minutos, recibir&aacute; errores
extra&ntilde;os que no le revelar&aacute;n que han sido causados por un
lapsus de tiempo, como:
</p>

<ul>
<pre>
kinit: Can't send request (send_to_kdc) 
</pre>
</ul>

Otro error m&aacute;s exacto es:

<ul>
<pre>
kauth: Time is out of bounds (krb_rd_req) 
</pre>
</ul>

<p>
Una forma f&aacute;cil para sincronizar los relojes del sistema es con
ntpd, disponible desde el &aacute;rbol de portes en
<em>/usr/ports/net/ntp/</em>.
</p>

Este documento asume que tiene unos conocimientos anterior de los
conceptos detr&aacute;s de Kerberos.  Para una buena referencia, simple
de entender, lea:

<ul>
<li><a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html">The FreeBSD handbook</a></li>
<li>Use la orden <strong>info kth-krb</strong></li>
<li><a href="http://web.mit.edu/kerberos/www/dialogue.html">Designing an Authentication System: a Dialogue in Four Scenes</a></li>
<li><a href="http://web.mit.edu/kerberos/www/papers.html#krb4">Papers and Documentation Describing KerberosIV</a></li>
</ul>O el libro<ul>
<li><a href="http://www.amazon.com/exec/obidos/ASIN/0130614661/qid%3D930594963/">Network Security Private Communication in a Public World [Kaufman, Perlman, Speciner, 1995]</a></li> 
</ul>

<h3>C&oacute;mo configurar el servidor y el campo de acci&oacute;n de
Kerberos IV</h3>

<p>
Configuraremos el campo de acci&oacute;n de CIARASYSTEMS.COM con
avalanche.ciarasystems.com como servidor principal.
</p>

<p>
Para empezar, tendremos que editar nuestros ficheros de
configuraci&oacute;n.  Estos ficheros est&aacute;n ubicados en
<em>/etc/kerberosIV/</em>.  Los dos ficheros que nos interesan son
<em>krb.realms</em> y <em>krb.conf</em>.  Empecemos con
<em>krb.conf</em>.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server
</pre>
</ul>

<p>
Como puede ver, esto indica a kerberos que el dominio es
CIARASYSTEMS.COM (o campo de acci&oacute;n l&oacute;gico) y que dentro
de ese dominio, avalanche es el servidor de administraci&oacute;n.  A
continuaci&oacute;n veremos <em>krb.realms</em>.  Para m&aacute;s
informaci&oacute;n lea la p&aacute;gina de manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.conf&sektion=5&format=html">krb.conf</a>.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>
krb.realms provee una traducci&oacute;n del nombre del hu&eacute;sped
al nombre del campo de acci&oacute;n de Kerberos para los servicios
provistos por ese hu&eacute;sped.  Cada l&iacute;nea del fichero de
traducci&oacute;n es de una de las siguientes formas (el nombre del
dominio deber&iacute;a ser del tipo .XXX.YYY).  As&iacute;, en este
ejemplo, avalanche es el nombre de hu&eacute;sped de una m&aacute;quina
en el campo de acci&oacute;n CIARASYSTEMS.COM, y .ciarasystems.com es
el nombre del dominio en el campo de acci&oacute;n CIARASYSTEMS.COM.
Para m&aacute;s informaci&oacute;n lea la p&aacute;gina de manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=krb.realms&sektion=5&format=html">krb.realms</a>.
</p>

<p>
A continuaci&oacute;n ejecutaremos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdb_init&sektion=8&format=html">kdb_init(8)</a>
para crear una base de datos inicial de Kerberos.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>kdb_init</strong>
Realm name [default  NO.DEFAULT.REALM ]: CIARASYSTEMS.COM
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.

Enter Kerberos master password: <strong>not shown</strong>
Verifying password -
Enter Kerberos master password:
</pre>
</ul>

<p>
Lo siguiente que tendremos que usar es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kstash&sektion=8&format=html">kstash(8)</a>,
que se utiliza para guardar clave maestra de la base de datos, del
centro de distribuci&oacute;n de claves (KDC), en el fichero de
cach&eacute; de la clave maestra.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>kstash</strong>
Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Wrote master key to /etc/kerberosIV/master_key
</pre>

De este modo se guarda la contrase&ntilde;a maestra cifrada en
<em>/etc/kerberosIV/master_key</em>.

<p>
A continuaci&oacute;n necesitaremos a&ntilde;adir a la base de datos
dos entradas &quot;principal&quot; por cada uno de los sistemas que
ser&aacute; asegurado con Kerberos.  Sus nombres son <em>kpasswd</em> y
<em>rcmd</em>.  Estas dos entradas &quot;principal&quot; se har&aacute;n
para cada sistema, siendo la entrada &quot;instance&quot; el nombre de
cada sistema.

Estos d&aelig;mons, <em>kpasswd</em> y <em>rcmd</em>, permiten que otros
sistemas cambien las contrase&ntilde;as de Kerberos y ejecuten
&oacute;rdenes como <em>rcp</em>, <em>rlogin</em> y <em>rsh</em>.

<pre>
# <strong>kdb_edit</strong>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!

Previous or default values are in [brackets] ,
enter return to leave the same, or new value.

Principal name: <strong>passwd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>

Principal: passwd, Instance: avalanche, kdc_key_ver: 1
New Password:            <strong>&lt;----- Use 'RANDOM' como contrase&ntilde;a</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.


Principal name: <strong>rcmd</strong>
Instance: <strong>avalanche</strong>

&lt;Not found&gt;, Create [y] ? <strong>y</strong>
Principal: rcmd, Instance: avalanche, kdc_key_ver: 1
New Password:            <strong>&lt;----- Use 'RANDOM' como contrase&ntilde;a</strong>
Verifying password -
New Password:

Random password [y] ? <strong>y</strong>

Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 1999-12-31 ] ? <strong>2002-12-31</strong>
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:       <strong>&lt;----- Pulse &lt;INTRO&gt; para acabar</strong>

</pre>
</ul>

<p>
Un fichero srvtab es un fichero de la clave de servicio.  Estas claves
deben extraerse de la base de datos del centro de distribuci&oacute;n
de claves de Kerberos para que los servicions autentiquen usando
Kerberos.  Por cada uno de los nombres de hu&eacute;sped
(&quot;hostname&quot;) especificados en la l&iacute;nea de
&oacute;rdenes,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ext_srvtab&sektion=8&format=html">ext_srvtab(8)</a>
genera el fichero de la clave de servicio hostname-new-srvtab, que
contiene todas las entradas en la base de datos con un campo
&quot;instance&quot; del nombre del hu&eacute;sped.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>ext_srvtab avalanche</strong>

Enter Kerberos master password:

Current Kerberos master key version is 1.

Master key entered.  BEWARE!
Generating 'avalanche-new-srvtab'....

[root@avalanche kerberosIV] <strong>mv avalanche-new-srvtab srvtab</strong>
[root@avalanche kerberosIV] <strong>chmod 600 srvtab</strong>
</pre>
</ul>

<p>
Ahora podemos a&ntilde;adir usuarios a nuestra base de datos.
</p>

<ul>
<pre>
[root@avalanche kerberosIV] <strong>kdb_edit</strong>
Opening database...
    
Enter Kerberos master key:
    
Current Kerberos master key version is 1.
    
Master key entered.  BEWARE!
Previous or default values are in [brackets] ,
enter return to leave the same, or new value.
    
Principal name: <strong>jeremie</strong>
Instance:
    
&lt;Not found&gt;, Create [y] ? <strong>y</strong>
    
Principal: jeremie, Instance: , kdc_key_ver: 1
New Password:                &lt;---- introduzca una contrase&ntilde;a segura aqu&iacute;
Verifying password
    
New Password:                &lt;---- vuelva a introducir la contrase&ntilde;a
Principal's new key version = 1
Expiration date (enter yyyy-mm-dd) [ 2000-01-01 ] ?
Max ticket lifetime (*5 minutes) [ 255 ] ?
Attributes [ 0 ] ?
Edit O.K.
Principal name:          &lt;---- una entrada vac&iacute;a aqu&iacute; causar&aacute; que abandone
</pre>
</ul>

<p>
Ahora ya est&aacute;n configurados todos los &quot;particular&quot;.
Todo lo que queda por hacer es activar la carga del servidor Kerberos
durante el arranque y activar los d&aelig;mons
&laquo;kerberizados&raquo;.
</p>

<p>
Escriba en <em>/etc/rc.conf</em>:

<ul>
<tt>kerberos_server=YES</tt>
</ul>

y en <em>/etc/inetd.conf</em> active las siguientes l&iacute;neas
(quitando el signo del comentario):

<ul>
<pre>
telnet       stream  tcp     nowait  root    /usr/libexec/telnetd    telnetd -k
klogin       stream  tcp     nowait  root    /usr/libexec/rlogind    rlogind -k
kshell       stream  tcp     nowait  root    /usr/libexec/rshd       rshd -k
kauth        stream  tcp     nowait  root    /usr/libexec/kauthd     kauthd
</pre>
</ul>

Y reinicie o:

<ul>
<pre>
[root@avalanche /] <strong>kill -HUP `cat /var/run/inetd.pid`</strong>
[root@avalanche /] <strong>/usr/libexec/kerberos &gt;&gt; /var/log/kerberos.log &amp;</strong>
[root@avalanche /] <strong>/usr/libexec/kadmind -n &gt;&gt; /var/log/kadmind.log &amp;</strong>
</pre>
</ul>
</p>

<p>
Nota: &eacute;sta es una configuraci&oacute;n del servidor bastante
simple.  Generalmente se configuran servidores redundantes (y
servidores esclavos) para que si un servidor cayera, todos los
servicios que dependen de Kerberos se mantuvieran.  Tambi&eacute;n
podemos a&ntilde;adir privilegios de 'su' a un &quot;principal&quot;
espec&iacute;fico;  vea el
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/kerberos.html#AEN9189">the FreeBSD Handbook</a>
para m&aacute;s informaci&oacute;n.
</p>

<h3>C&oacute;mo &laquo;kerberizar&raquo; una estaci&oacute;n de trabajo
cliente</h3>

<p>
Configuraremos la estaci&oacute;n de trabajo llamada <em>gatekeeper</em>
para que est&eacute; en el campo de acci&oacute;n de CIARASYSTEMS.COM,
con avalanche.ciarasystems.com como el servidor principal.
</p>

<p>
Para empezar, necesitamos configurar los ficheros <em>krb.conf</em> y
<em>krb.realms</em> como para la m&aacute;quina anterior.  Esto es para
que <em>gatekeeper</em> sepa qu&eacute; servidor es el KDC y en
qu&eacute; dominio se encuentra.  He aqu&iacute; el contenido de los
ficheros:
</p>

<ul>
<pre>
[root@gatekeeper kerberosIV] <strong>cat krb.conf</strong>
CIARASYSTEMS.COM
CIARASYSTEMS.COM avalanche.ciarasystems.com admin server

[root@gatekeeper kerberosIV] <strong>cat krb.realms</strong>
avalanche.ciarasystems.com      CIARASYSTEMS.COM
.ciarasystems.com               CIARASYSTEMS.COM
</pre>
</ul>

<p>
Eso ha sido la configuraci&oacute;n, ahora necesitamos iniciar
kerberos.  Para obtener un ticket usaremos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kinit&sektion=1&format=html">kinit(1)</a>.
</p>

<ul>
<pre>
xyz:jeremie% <strong>kinit</strong>
The OpenBSD Project (gatekeeper)
Kerberos Initialization
Kerberos name: <strong>jeremie</strong>
Password:
</pre>
</ul>

<p>
Ahora que nos hemos identificado, podemos ver una lista de nuestros
tickets con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=klist&sektion=1&format=html">klist(1)</a>.
</p>

<ul>
<pre>
xyz:jeremie$ <strong>klist</strong>
Ticket file:    /tmp/tkt1000
Principal:      jeremie@CIARASYSTEMS.COM

  Issued           Expires          Principal
Jun 28 01:03:25  Jun 28 11:03:25  krbtgt.CIARASYSTEMS.COM@CIARASYSTEMS.COM
</pre>
</ul>

<p>
Parece que ya est&aacute; todo.  Lo &uacute;nico que queda por hacer es
probarlo.  En los siguientes ejemplos lo probaremos con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rlogin&apropos=0&sektion=1&manpath=OpenBSD+Current&format=html">rlogin(1)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&apropos=0&sektion=1&manpath=OpenBSD+Current&format=html">telnet(1)</a>.
</p>

<ul>
<pre>
xyz:jeremie% <strong>telnet avalanche</strong>
Trying 192.168.0.38...
Connected to avalanche.
Escape character is '^]'.
[ Trying mutual KERBEROS4 ... ]
[ Kerberos V4 accepts you ]
[ Kerberos V4 challenge successful ]
Last login: Sun Jun 27 22:52:25 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
</pre>
</ul>

y 

<ul>
<pre>
xyz:jeremie% <strong>rlogin avalanche</strong>
Last login: Sun Jun 27 22:53:39 on ttyp1 from gatekeeper
Warning: no Kerberos tickets issued.
OpenBSD 2.5 (AVALANCHE) #5: Tue Apr  6 01:18:16 EDT 1999
</pre>
</ul>

<p>
Se ve claro que est&aacute; usando Kerberos para autenticar la
sesi&oacute;n de rlogin.  Para eliminar los tickets de la sesi&oacute;n
usaremos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kdestroy&sektion=1&format=html">kdestroy(1)</a>.
Por ejemplo:
</p>

<ul>
<pre>
xyz:jeremie% <strong>kdestroy</strong>
Tickets destroyed.
xyz:jeremie% <strong>rlogin avalanche</strong>
krcmd: No ticket file (tf_util)
rlogin: warning, using standard rlogin: can't provide Kerberos auth data.
avalanche: Connection refused
</pre>
</ul>

<p>
No se preocupe por el mensaje 'Warning: no Kerberos tickets issued'.
Esto es debido a que s&oacute;lo estamos haciendo autenticaci&oacute;n
con kerberos, no pases de tickets.  Si quiere pases de tickets, use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html">OpenSSH</a>
que tiene soporte para ello.  KerberosIV de serie tampoco tiene soporte
para pases tgt, s&oacute;lo la implementaci&oacute;n de krb4 de
kaserver AFS, ya que KerberosIV normal comprueba con kdc las
direcciones IP de los clientes en la lista del ticket.
</p>

<p>
<a name="AnonFTP"></a>
<a name="10.12"></a>
<h2>10.12 - Configuraci&oacute;n de servicios de FTP
An&oacute;nimo</h2>
</p>

<p>
FTP An&oacute;nimo permite a los usuarios que carecen de cuentas en el
sistema, acceder a ficheros en su m&aacute;quina mediante el
&laquo;Protocolo de Transferencia de Ficheros&raquo; (FTP, &quot;File
Transfer Protocol&quot;).  Esta secci&oacute;n ofrece un resumen sobre
c&oacute;mo configurar el servidor de ftp an&oacute;nimo, su ingreso,
etc...
</p>

<h3>Creaci&oacute;n de la cuenta de FTP</h3>

<p>
Para empezar, necesita tener una cuenta &quot;ftp&quot; en su sistema.
Esta cuenta no debe tener una contrase&ntilde;a utilizable.
Aqu&iacute; configuraremos el directorio de ingreso como
<em>/home/ftp</em>, pero puede ponerlos donde quiera.  Cuando use ftp
an&oacute;nimo, el d&aelig;mon de ftp ejecutar&aacute; chroot sobre
s&iacute; mismo para cambiar la directorio del usuario de ftp.  Puede
leer m&aacute;s sobre esto en las p&aacute;ginas de manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">chroot(2)</a>.
He aqu&iacute; un ejemplo sobre c&oacute;mo a&ntilde;adir el usuario
<em>ftp</em>.  Para ello usaremos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>.
Tambi&eacute;n necesitamos a&ntilde;adir /usr/bin/false a nuestro
fichero <em>/etc/shells</em>, que ser&aacute; la <em>shell</em> que
configuraremos para el usuario ftp.  As&iacute; no tendrán permiso para
ingresar, aunque les daremos una contrase&ntilde;a vac&iacute;a.  Para
ello puede hacer simplemente lo siguiente:

<pre>
echo /usr/bin/false &gt;&gt; /etc/shells
</pre>

Tambi&eacute;n, si quiere que esa shell se muestre durante las
preguntas de la orden adduser, necesita modificar
<em>/etc/adduser.conf</em>.
</p>

<ul>
<pre>
oshibana# <strong>adduser</strong>
Use option ``-silent'' if you don't want see all warnings &amp; questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username [a-z0-9_]: <strong>ftp</strong>
Enter full name []: <strong>anonymous ftp</strong>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <strong>false</strong>
Uid [1002]:
Login group ftp [ftp]:
Login group is ``ftp''. Invite ftp into other groups: guest no
[no]: <strong>no</strong>
Enter password []:
Set the password so that user cannot logon? (y/n) [n]: <strong>y</strong>

Name:     ftp
Password: ****
Fullname: anonymous ftp
Uid:      1002
Gid:      1002 (ftp)
Groups:   ftp
HOME:     /home/ftp
Shell:    /usr/bin/false
OK? (y/n) [y]: <strong>y</strong>
Added user ``ftp''
Copy files from /usr/share/skel to /home/ftp
Add another user? (y/n) [y]: <strong>n</strong>
Goodbye!
</pre>
</ul>

<h3>Configuraci&oacute;n del directorio</h3>

<p>
Adem&aacute;s del usuario, ha creado el directorio <em>/home/ftp</em>.
Es lo que queremos, pero hay algunos cambios que tendremos que hacer
para tenerlo preparado para ftp an&oacute;nimo.  Estos cambios se
explican en la p&aacute;gina de manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftp(8)</a>.
</p>

<ul>
<strong>No</strong> necesita crear un directorio <em>/home/ftp/usr</em> o
<em>/home/ftp/bin</em>.<br>

<li><em>/home/ftp</em> - Es el directorio principal.  Su propietario debe
    ser root, y los permisos deben ser 555.</li>
<li><em>/home/ftp/etc</em> - Es totalmente opcional y no se recomienda,
    ya que s&oacute;lo sirve para dar informaci&oacute;n sobre los
    usuarios existentes en un sistema.  Si quiere que parezca que su
    directorio de ftp an&oacute;nimo contiene usuarios reales adjuntos
    a sus ficheros, deber&iacute;a copiar <em>/etc/pwd.db</em> y
    <em>/etc/group</em> a este directorio.  Este directorio
    deber&iacute;a ser de modo 511, y los dos ficheros de modo 444.
    &Eacute;stos se usan para dar al propietario nombres en lugar de
    n&uacute;meros.  No existen contrase&ntilde;as almacenadas en
    <em>pwd.db</em>, ya que est&aacute;n todas en <em>spwd.db</em>,
    as&iacute; que no las copie ah&iacute;.</li>
<li><em>/home/ftp/pub</em> - &Eacute;ste es el directorio t&iacute;pico
    para ubicar los ficheros que quiera compartir.  Este directorio
    tambi&eacute;n debert&iacute; ser de modo 555.
</ul>

<p> 
Note que el propietario de todos estos directorios deber&iacute;a ser
``root''.  He aqu&iacute; una lista de c&oacute;mo deber&iacute;an ser
los directorios despu&eacute;s de ser creados:
</p>

<ul>
<pre>
oshibana# pwd 
/home
oshibana# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre>
</ul>

<h3>Inicio del servidor e ingreso</h3>

<p>
Con <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">ftpd(8)</a>
puede escoger entre invocarlo desde
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">inetd(8)</a> 
o lo pueden iniciar los guiones de configuraci&oacute;n de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">rc(8)</a>.
En estos ejemplos se ver&aacute; c&oacute;mo se inicia nuestro
d&aelig;mon desde
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">inetd.conf</a>.
Primero debemos familiarizarnos con algunas de las opciones de ftpd.
La l&iacute;nea por definici&oacute;n de <em>/etc/inetd.conf</em> es:
</p>

<ul>
<pre>
<strong>
ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US
</strong>
</pre>
</ul>

<p>
En este caso ftpd se invoca con <em>-US</em>.  As&iacute; se
grabar&aacute;n las conexiones an&oacute;nimas a <em>/var/log/ftpd</em>,
y las sesiones concurrentes a <em>/var/run/utmp</em>.  De este modo,
podremos ver estas sesiones con la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=who&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html">who(1)</a>.
Es posible que algunos s&oacute;lo quisieran tener un servidor
an&oacute;nimo, y desactivar ftp para usuarios.  Para ello debe invocar
ftpd con la opci&oacute;n <em>-A</em>.  He aqu&iacute; una l&iacute;nea
que inicia ftpd para conexiones an&oacute;nimas s&oacute;lo.
Tambi&eacute;n usa <em>-ll</em> para grabar cada conexi&oacute;n a
syslog, junto con las &oacute;rdenes de ftp 'get', 'retrieve', etc.
</p>

<ul>
<pre>
<strong>
ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA
</strong>
</pre>
</ul>

<p>
Nota:  Para aqu&eacute;llos que usen servidores de ftp de MUCHO
tr&aacute;fico, es conveniente que no invoquen ftpd desde
<em>inetd.conf</em>.  La mejor opci&oacute;n es comentar la l&iacute;nea
de ftpd de <em>inetd.conf</em> e iniciar ftpd desde <em>rc.conf</em> junto
con la opci&oacute;n <em>-D</em>.  De este modo iniciar&aacute;n ftpd
como un d&aelig;mon, y ser&aacute; m&aacute;s simple que iniciarlo
desde inetd.  A continuaci&oacute;n viene un ejemplo de c&oacute;mo
iniciarlo desde <em>rc.conf</em>:
</p>

<ul>
<pre>
ftpd_flags=&quot;-DllUSA&quot;           # for non-inetd use: ftpd_flags=&quot;-D&quot;
</pre>
</ul>

<p>
Esto s&oacute;lo funcionar&aacute; si ha desactivado ftpd en
<em>/etc/inetd.conf</em>.
</p>

<h3>Otros ficheros de importancia</h3>

<p>
<ul>
   <li><em>/etc/ftpwelcome</em> - Contiene el mensaje de bienvenida que
       ver&aacute;n al conectar con su servidor ftp.</li>
   <li><em>/etc/motd</em> - Contiene el mensaje que ver&aacute;n
       despu&eacute;s de haber ingresado en su servidor ftp.</li>
   <li><em>.message</em> - Este fichero se puede ubicar en cualquier
       directorio, y cuando alguien entre en ese directorio,
       ver&aacute; el mensaje que contiene.</li>
</ul>


<p>
<a name="ftpchroot"></a>
<a name="10.13"></a>
<h2>10.13 - C&oacute;mo se confinan a los usuarios a sus
directorios de usuario (&quot;home&quot;) en ftpd(8)</h2>
</p>

<p>
En OpenBSD,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8&format=html">ftpd(8)</a>
est&aacute; configurado por definici&oacute;n para poder gestionar esto
de modo muy f&aacute;cil.  Se hace por medio del fichero
<strong>/etc/ftpchroot</strong>.  Como los usuarios no son siempre
fiables, puede ser necesario restringir su entrada en otros directorios
que no sean el propio.  Esto NO est&aacute; activado por
definici&oacute;n.  He aqu&iacute; un ejemplo de c&oacute;mo responde
por definici&oacute;n:
</p>

<ul>
<pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 2.6 (GENERIC) #690: Fri Oct 29 16:32:17 MDT 1999
230- 
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230- 
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230- 
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre>
</ul>

<p>
Como puede ver, el acceso est&aacute; permitido para todo el servidor.
En un mundo perfecto esto deber&iacute;a ser as&iacute;,
deber&iacute;amos poder fiarnos de todos los usuarios, pero no es
as&iacute;.  Para limitar un usuario, a&ntilde;ada su nombre al fichero
<em>/etc/ftpchroot</em>.  He aqu&iacute; un ejemplo que muestra
c&oacute;mo restringir al usuario &quot;ericj&quot;:
</p>

<ul>
<pre>
$ <strong>cat /etc/ftpchroot</strong>
#       $OpenBSD: faq10.html,v 1.23 2002/05/01 08:53:29 jufi Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj
</pre>
</ul>

<p>
Esto es suficiente para evitar que el usuario &quot;ericj&quot; se
escape de su propio directorio.  Como puede ver en el siguiente
ejemplo, el directorio <em>/</em> ha cambiado de repente a su directorio
de usuario.
</p>

<ul>
<pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre>
</ul>

<p>
<a name="Patches"></a>
<a name="10.14"></a>
<h2>10.14 - C&oacute;mo se aplican parches en OpenBSD</h2>
</p>

<p>
El &aacute;rbol de fuentes de OpenBSD experimenta cambios y mejoras
continuamente, y al mismo tiempo se ponen a disponibilidad
p&uacute;blica parches para problemas comunes con bastante frecuencia.
Estos parches aparecen en la p&aacute;gina web de erratas, que puede
encontrar en
<a href="../../es/errata.html">http://www.openbsd.org/es/errata.html</a>,
y se encuentran separados por categor&iacute;as.  Estas
categor&iacute;as corresponden a los parches que se deber&iacute;an
aplicar a las diferentes arquitecturas, o a parches independientes de
la arquitectura.
</p>

<p>
Sin embargo, no se producen parches para las nuevas funcionalidades
a&ntilde;adidas al sistema, y s&oacute;lo se producen para solucionar
problemas de fiabilidad o de seguridad que deban ser atajados
inmediatamente, aunque la &uacute;ltima palabra sobre si se deben
aplicar o no la tiene siempre el administrador del sistema.
</p>

<p>
A modo de ejemplo parchear&eacute;
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=talkd&sektion=8">talkd(8)</a> 
con un parche de seguridad obtenido de
<a href="../../es/errata.html">errata.html</a>.
</p>

<h3>&iquest;En qu&eacute; se diferencian estos parches de los que se
pueden encontrar en el &aacute;rbol de fuentes?</h3>

<p>
Todos los parches que se env&iacute;an a
<a href="../../es/errata.html">http://www.openbsd.org/es/errata.html</a>
son parches que se aplican directamente al &aacute;rbol de fuentes de
la versi&oacute;n oficial m&aacute;s reciente.  Los parches que se
aplican al &aacute;rbol de CVS m&aacute;s reciente tambi&eacute;n
incluyen otros cambios que no son deseables en un sistema con la
versi&oacute;n oficial.
</p>

<h3>Preparaci&oacute;n del sistema para la aplicaci&oacute;n
de parches</h3>

<p>
Los parches para el Sistema Operativo OpenBSD se distribuyen como
ficheros <tt>diff</tt>, que son ficheros de texto en los que se
encuentran las diferencias con el c&oacute;digo fuente original.
<strong>NO</strong> se distribuyen en formato binario.  Esto quiere
decir que para aplicar un parche al sistema, antes es necesario
disponer del c&oacute;digo fuente de la versi&oacute;n final
(<em>-release</em>) de OpenBSD.  Esto no significa que debe
disponer de TODO el c&oacute;digo fuente del sistema operativo, sino
que debe tener todo el c&oacute;digo para el programa al que vaya a
aplicar el parche.  Por ejemplo, si va a aplicar un parche al
n&uacute;cleo del sistema, debe tener a mano todo el c&oacute;digo
fuente para el n&uacute;cleo.
</p>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a>
es una herramienta muy &uacute;til que puede usar para obtener el
c&oacute;digo fuente que necesite por medio de los servidores
an&oacute;nimos de cvs ubicados alrededor del mundo.  Puede ver un
listado de estos servidores en
<a href="../../es/anoncvs.html">http://www.openbsd.org/es/anoncvs.html</a>.
</p>

<p>
Para obtener obtener el c&oacute;digo fuente de la versi&oacute;n
2.7 usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1">cvs(1)</a>,
debe hacer lo siguiente:
</p>

<div style="margin-left: 2em">
<pre>
$ <strong>cvs -danoncvs@anoncvs5.usa.openbsd.org:/cvs co -rOPENBSD_3_0_BASE src/libexec/talkd/</strong>
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h
</pre>
</div>

<p>
Para encontrar en el CVS el camino hasta el c&oacute;digo que necesita,
puede verlo en la l&iacute;nea <em>Index:</em> del parche.  En este
caso el camino en el CVS era <em>src/libexec/talkd/</em>.  Compruebe
siempre el n&uacute;mero de revisi&oacute;n de
OPENBSD_version_number_BASE.  Sin &quot;_BASE&quot; obtendr&aacute; el
c&oacute;digo de la rama estable, y &eacute;sta puede contener otros
cambios que sin duda interferir&aacute;n.  Si ya est&aacute; siguiendo
la rama de parches, los parches ya deber&iacute;an estar en ese
c&oacute;digo fuente, pero por si acaso deber&iacute;a comprobarlo y
asegurarse.  Siempre puede mirar en
<a href="../../es/plus.html">http://www.openbsd.org/es/plus.html</a>
para ver qu&eacute; parches se han aplicado a la rama de parches.  Si
los parches todav&iacute;a no han sido aplicados, tendr&aacute; que
obtener el c&oacute;digo fuente de la &uacute;ltima versi&oacute;n
usando la orden anterior.
</p>

<p>
Los usuarios que hayan adquirido los CDs oficiales de OpenBSD pueden
obtener el c&oacute;digo fuente directamente desde el CD.  Mire en la
car&aacute;tula del CD para saber c&oacute;mo extraer el c&oacute;digo
fuente desde el mismo.  En este caso no ser&aacute; necesaria la
obtenci&oacute;n del c&oacute;digo fuente por medio de anoncvs.
</p>

<ul><pre>
Aplicar del siguiente modo:
        cd /usr/src
        patch -p0 &lt; 026_talkd.patch
        cd libexec/talkd
        make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install

Index: libexec/talkd/announce.c <strong>&lt;------ Camino a los fuentes </strong>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@ -160,6 +160,6 @@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre></ul>

<p>
Una vez que haya obtenido el c&oacute;digo fuente correcto, puede
obtener el parche y ponerlo en <em>src/</em>.
</p>

<h3>Aplicaci&oacute;n de los parches</h3>

<p>
<div style="margin-left: 2em">
<pre>
$ <strong>cd /usr/src</strong>
$ <strong>patch -p0&lt;/path/to/026_talkd.patch</strong>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Aplicar del siguiente modo:
|       cd /usr/src
|       patch -p0 &lt; 026_talkd.patch
|       cd libexec/talkd
|       make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <strong>&lt;------------ Parche con &eacute;xito</strong>
done
$ <strong>cd /usr/src/libexec/talkd/</strong>
$ <strong>ls</strong>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <strong>make obj &amp;&amp; make depend &amp;&amp; make</strong>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/src/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c /home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 &gt; talkd.cat8
$ <strong>sudo make install</strong>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -&gt; /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>
Una vez hecho esto, reinicie ese servicio.
</p>

<p>
<font color="#0000e0">
<a href="index.html">[Volver al &iacute;ndice principal]</a>
<a href="faq9.html">[Secci&oacute;n 9.0 - Consejos para usuarios de Linux]</a>
<a href="faq11.html">[Secci&oacute;n 11.0 - Afinar el rendimiento]</a>
</font>
</p>
<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[&iacute;ndice]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq10.html,v 1.65 2002/04/30 13:02:47 nick Exp ]<br>
$Translation: faq10.html,v 1.23 2002/04/30 22:01:16 horacio Exp $<br>
$OpenBSD: faq10.html,v 1.23 2002/05/01 08:53:29 jufi Exp $
</small>
</p>
</body>
</html>
