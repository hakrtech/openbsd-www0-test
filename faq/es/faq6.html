<html>
<head>
<title>6.0 - Redes</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta name="resource-type" content="documento">
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,faq,documentación">
<meta name="distribution"  content="global">
<meta name="copyright"     content="Este documento es copyright 1998-2002 de OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<h2><font color="#e00000">6.0 - Redes</font><hr></h2>
</p>

<p>
<ul><h3>Tabla de contenidos</h3>
<li><a href="#Intro">6.0.1 - Introducci&oacute;n</a>
<li><a href="#Setup">6.1 - Configuraci&oacute;n inicial de la
red</a>
<li><a href="#PF">6.2 - Filtro de paquetes IP (PF)</a>
<li><a href="#NAT">6.3 - Traducci&oacute;n de direcciones de
red (NAT)</a>
<li><a href="#DHCP">6.4 - Protocolo de configuraci&oacute;n
para anfitriones din&aacute;micos (DHCP)</a>
<li><a href="#PPP">6.5 - Protocolo Punto a Punto (PPP)</a>
<li><a href="#Tuning">6.6 - C&oacute;mo afinar los
par&aacute;metros de red</a>
<li><a href="#NFS">6.7 - C&oacute;mo usar NFS</a>
<li><a href= "#DNS">6.8 - Servicio de Nombres de Dominio  -
DNS, BIND, y named</a>
<li><a href="#PPTP">6.9 - Configuraci&oacute;n de una
conexi&oacute;n PPTP en OpenBSD</a>
</ul>
</p>
<hr>

<br>
<p>
<a name="Intro"></a>
<a name="6.0.1"></a>
<h2>6.0.1 - Introducci&oacute;n</h2>
</p>

<p>
Para la comprensi&oacute;n de la mayor parte de este documento
ser&aacute; de gran ayuda que haya leido y, por lo menos,
asimilado en parte el cap&iacute;tulo
<a href="faq5.html">&laquo;Configuraci&oacute;n del
N&uacute;cleo&raquo;</a> 
de las Preguntas Frecuentes, y las p&aacute;ginas de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html">netstat(1)</a>.

<p>
Si es Vd. un administrador de redes y est&aacute; configurando
protocolos de enrutamiento, si est&aacute; usando su sistema
OpenBSD como un enrutador, si necesita conocer m&aacute;s a
fondo los protocolos de redes IP, entonces es realmente
necesario que lea
<a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">Understanding IP addressing</a>.
&iexcl;&Eacute;ste es un excelente documento que contiene
conocimientos fundamentales sobre redes de IP!

<p>
Si est&aacute; trabajando con aplicaciones como servidores de
http, servidores de ftp, y servidores de correo, se puede
beneficiar en gran medida de la lectura de los
<a href="http://the.rfceditor.org/rfc.html">RFC</a>.

<p>
<em>(Nota: existe un proyecto de traducci&oacute;n de
documentos RFC al castellano,
<a href="http://www.rfc-es.org/">RFC-ES</a>)</em>

<p>
Lo m&aacute;s seguro es que no los pueda leer todos.  Seleccione
algunos temas que le interesen, o que use en su entorno de red.
L&eacute;alos y averig&uuml;e c&oacute;mo deber&iacute;an funcionar.
Los RFC definen much&iacute;simas (miles) de las normas para protocolos
en internet y c&oacute;mo se supone que deben funcionar.

<p>
<a name="Setup"></a>
<a name="6.1"></a>
<h2>6.1 - Configuraci&oacute;n inicial de la red</h2>
</p>

<p>
<a name="Setup.1"></a>
<a name="6.1.1"></a>
<h3>6.1.1 - Idenficaci&oacute;n y configuraci&oacute;n de la
interfaces de red</h3>
</p>

<p>
Lo primero que debe hacer para empezar es identificar su
interfaz de red.  En OpenBSD las interfaces se designan por el
tipo de tarjeta, no por el tipo de conexi&oacute;n.  Puede ver
su tarjeta de red iniciar durante el arranque, o
despu&eacute;s del arranque usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a>.
Tambi&eacute;n puede ver su interfaz de red usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
Por ejemplo, vea a continuaci&oacute;n la salida originada por
dmesg para una tarjeta de red Intel Fast Ethernet, que usa el
nombre de dispositivo fxp.
</p>

<ul>
<pre>
fxp0 at pci0 dev 10 function 0 &quot;Intel 82557&quot; rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre>
</ul>

<p>
Si no sabe cu&aacute;l es el nombre de su dispositivo,
b&uacute;squelo en la <a href="../plat.html">lista de hardware
con soporte</a> de la plataforma correspondiente.
Encontrar&aacute; una lista de muchos nombres de tarjetas
comunes y sus nombres de dispositivo en OpenBSD.  Combine el
nombre abreviado alfab&eacute;tico (como fxp) con un
n&uacute;mero asignado por el n&uacute;cleo del sistema y
obtendr&aacute; el nombre de la interfaz (como fxp0).
tiene una lista de tarjetas comunes con sus nombres de dispositivo.
</p>

<p>
Nota sobre actualizaci&oacute;n desde versiones antiguas de
OpenBSD:  Los controladores de Ethernet antiguos son, en
ocasiones, reemplazadospor otros m&aacute;s nuevos, y es
probable que el nombre de la interfaz cambie al mismo tiempo.
Por ejemplo, despu&eacute;s de OpenBSD 2.6, los controladores
<em>mx</em>, <em>al</em>, <em>ax</em> y <em>pn</em> fueron
substituidos por el controlador <em>dc</em>.  En consecuencia,
cualquier referencia en <em>/etc/dhcpd.interfaces</em>, en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a> o en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a>,
debe cambiarse con el nuevo nombre de la interfaz.
Adem&aacute;s, se debe cambiar el nombre de cualquier fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">/etc/hostname.xxx</a>
en consecuencia (<em>xxx</em> representa el nombre y
n&uacute;mero de la interfaz).
</p>

<p>
Puede averiguar qu&eacute; interfaces de red han sido
identificadas usando la utilidad 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
La orden siguiente mostrar&aacute; todas las interfaces de red
en un sistema.  Esta salida muestra s&oacute;lo una interfaz
f&iacute;sica de ethernet, la
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&sektion=4">fxp(4)</a>.
</p>

<ul>
<pre>
$ <strong>ifconfig -a</strong>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000 
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::202:b3ff:fe2b:10f7%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
vlan1: flags=0&lt;&gt; mtu 1500
gre0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre>
</ul>

<p>
Como habr&aacute; podido comprobar, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
muestra mucha m&aacute;s informaci&oacute;n de la que necesitamos en
este momento.  Pero lo importante aqu&iacute; es que nos permite ver
nuestra interfaz.  En el ejemplo anterior, la tarjeta de la interfaz ya
est&aacute; configurada.  Esto es obvio porque ya hay una red
IP configurada en fxp0, y de aqu&iacute; los valores
&quot;inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;.
Adem&aacute;s, los indicadores <strong>UP</strong> y
<strong>RUNNING</strong> est&aacute;n activados.
</p>

<p>
Finalmente, notar&aacute; que otras cuantas interfaces se
encuentran activadas de forma predeterminada.  &Eacute;stas
son interfaces virtuales que tienen varias funciones.  Las
siguientes p&aacute;ginas del manual las describen:
</p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion=4">lo</a> - Interfaz de circuito cerrado (<em>loopback</em>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&sektion=4">pflog</a> - Interfaz de registro del paquete de filtros (<em>PF</em>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4">sl</a> - Interfaz de red SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=4">ppp</a> - Protocolo punto a punto (PPP)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4">tun</a> - Interfaz de red por t&uacute;nel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc</a> - Interfaz de encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">bridge</a> - Interfaz de puente Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&sektion=4">vlan</a> - Interfaz de encapsulaci&oacute;n IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre</a> - Interfaz de encapsulaci&oacute;n GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&sektion=4">gif</a> - Interfaz de t&uacute;nel IPv4/IPv6 gen&eacute;rica
</ul>

<p>
Si su interfaz no ha sido configurada, el primer paso
ser&aacute; crear el fichero
<strong>/etc/hostname.xxx</strong>, donde el nombre de su
interfaz substituir&aacute; xxx.  De acuerdo con la
informaci&oacute;n de los ejemplos anteriores, el nombre
ser&iacute;a <strong>/etc/hostname.fxp0</strong>.  La
composici&oacute;n de este fichero es as&iacute; de
sencilla:<br>
</p>

<ul>
<pre>
address_family address netmask broadcast [other options]
</pre>
</ul>

<p>
(Para leer m&aacute;s sobre el formato de este fichero, tome
como referencia la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html">hostname.if(5)</a>)
</p>

<p>
El fichero de configuraci&oacute;n de una interfaz
t&iacute;pica, configurada para una direcci&oacute;n de IPv4,
ser&iacute;a como el siguiente:
</p>

<ul>
<pre>
$ <strong>cat /etc/hostname.fxp0</strong>
inet 10.0.0.38 255.255.255.0 NONE
</pre>
</ul>

<p>
Tambi&eacute;n podr&iacute;a especificar tipos de media para
Ethernet, por ejemplo, si quisiera forza el modo 100baseTX
full-duplex.
</p>

<ul><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX media-opt full-duplex
</pre></ul>

<p>
Aunque nunca debe forzar el modo <em>full duplex</em> a menos
que ambas partes de la conexi&oacute;n est&eacute;n
configuradas para hacerlo.  A menos que sea necesario por
alg&uacute;n motivo especial, la configuraci&oacute;n del tipo
de media se debe excluir.
</p>

<p>
O puede que quiera usar indicadores especiales para
especificar una cierta interfaz.  &iexcl;El formato del
fichero <em>hostname</em> no cambia mucho!
</p>

<ul><pre>
$ <strong>cat /etc/hostname.vlan0</strong>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></ul>

<p>
El siguiente paso ser&aacute; la configuraci&oacute;n de su
pasarela.  Para ello basta con que ponga el IP de su pasarela
en el fichero <strong>/etc/mygate</strong>.  Esto
permitir&aacute; que su pasarela se active en el momento del
arranque.  A continuaci&oacute;n deber&aacute; configurar sus
nombres de servidores (<em>nameservers</em>) y su fichero
<strong>/etc/hosts</strong> (mire la p&aacute;gina del manual
de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>).
Para configurar sus nombres de servidores debe crear un
fichero con el nombre <strong>/etc/resolv.conf</strong>.
Puede leer m&aacute;s sobre el formato de este fichero en la
p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>.
El siguiente ejemplo es para un uso t&iacute;pico.  En este
ejemplo sus servidores de dominio son 125.2.3.4 y 125.2.3.5.
Tambi&eacute;n pertenece al dominio
&laquo;sudominio.dom&raquo;.
</p>

<ul>
<pre>
$ <strong>cat /etc/resolv.conf</strong>
search sudominio.dom
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre>
</ul>

<p>
Desde este punto ya puede reiniciar o bien ejecutar el
gui&oacute;n de configuraci&oacute;n
<strong>/etc/netstart</strong>.  Puede hacerlo ejecutando
(como root):
</p>

<ul>
<pre>
# <strong>sh /etc/netstart</strong>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre>
</ul>

<p>
F&iacute;jese en que se produce un peque&ntilde;o
n&uacute;mero de errores.  Pero al ejecutar este gui&oacute;n
(<em>script</em>), reconfingurar&aacute; cosas que ya
hab&iacute;a configurado anteriormente.  De hecho, algunas
rutas ya existen en la tabla de enrutamiento del n&uacute;cleo
del sistema.  Desde aqu&iacute; el sistema deber&iacute;a
funcionar con normalidad.  Puede hacer una comprobaci&oacute;n
con <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
para asegurarse de que su interfaz se configur&oacute;
correctamente.  Tambi&eacute;n puede comprobar sus rutas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&sektion=1">netstat(1)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>.
A continuaci&oacute;n puede ver un ejemplo de c&oacute;mo ver
sus tablas de rutas usando ambas herramientas.
</p>

<ul>
<pre>
$ <strong>netstat -rn</strong>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <strong>route show</strong>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre>
</ul>

<p>
<a name="Setup.2"></a>
<a name="6.1.2"></a>
<h3>6.1.2 - Configuraci&oacute;n del sistema OpenBSD como
pasarela (<em>gateway</em>)</h3>
</p>

<p>
&Eacute;sta es la informaci&oacute;n b&aacute;sica que
necesita para configurar su sistema OpenBSD como una pasarela
(tambi&eacute;n llamada &laquo;enrutador&raquo; o
&laquo;encaminador&raquo;).  Si piensa usar OpenBSD como un
enrutador en Internet, le sugerimos que lea tambi&eacute;n la
secci&oacute;n con las instrucciones sobre la
configuraci&oacute;n de Filtros de paquetes IP (PF), para
bloquear tr&aacute;fico potencialmente malicioso.
Adem&aacute;s, debido a la escasa disponibilidad de
direcciones <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&sektion=4">IPv4</a> en los proveedores de servicios de redes y
registros regionales, es conveniente leer la secci&oacute;n
sobre traducci&oacute;n de direcciones de red (NAT) para
informaci&oacute;n sobre c&oacute;mo conservar su espacio de
direcci&oacute;n IP.
</p>

<p>
El n&uacute;cleo GENERIC posee la capacidad de permitir IP
Forwarding, pero debe ser activado.  Para ello debe usar la
utilidad <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
Para que los cambios sean permanentes, debe editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a>
para activar IP Forwarding.  Esto lo puede llevar a cabo
a&ntilde;adiendo la siguiente l&iacute;nea en ese fichero de
configuraci&oacute;n.
</p>

<ul>
<pre>
net.inet.ip.forwarding=1
</pre>
</ul>

<p>
Para que este cambio surja efecto sin tener que reiniciar el
sistema, use directamente la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
Recuerde que este cambio todav&iacute;a no existir&aacute;
despu&eacute;s de reiniciar, y que necesitar&aacute; ser
ejecutado como root.
</p>

<ul>
<pre>
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
net.inet.ip.forwarding: 0 -&gt; 1
</pre>
</ul>

<p>
A continuaci&oacute;n modifique las rutas en los otros
anfitriones de ambos lados.  OpenBSD ofrece muchas
posibilidades de uso como enrutador, usando software como 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, 
<a href="http://www.mrtd.net">mrtd</a> y 
<a href="http://www.zebra.org">zebra</a>.
OpenBSD dispone de soporte para zebra, gated y mrtd en la
colecci&oacute;n de portes.  OpenBSD incluye soporte para
varias interfaces T1, HSSI, ATM, FDDI, Ethernet, e interfaces
de serie (PPP/SLIP).
</p>

<p>
<a name="Setup.3"></a>
<a name="6.1.3"></a>
<h3>6.1.3 - Configuraci&oacute;n de alias en una interfaz.</h3>
</p>

<strong>&iexcl;Desde la versi&oacute;n 2.8, ya <em>/etc/ifaliases</em>
no se usa!</strong>

<p>
OpenBSD dispone de un simple mecanismo para configurar los
alias de ip en una interfaz.  Para ellos s&oacute;lo tiene que
editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5"><em>/etc/hostname.&lt;if&gt;</em></a>.
El gui&oacute;n
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a>,
que forma parte de la
<a href="faq10.html#rc">jerarqu&iacute;a de inicio rc</a>,
leer&aacute; este fichero durante el proceso de inicio del
sistema.  Por ejemplo, supongamos que el usuario tiene una
interfaz <strong>dc0</strong> y pertenece a la red
192.168.0.0.  Otra informaci&oacute;n de importancia:
</p>

<ul>
<li>IP para dc0 es 192.168.0.2
<li>NETMASK es 255.255.255.0
</ul>

<p>
Unas notas sobre los alias:  en OpenBSD s&oacute;lo se usa el nombre de
la interfaz; no existen diferencias entre el primer alias y el segundo,
por lo tanto, a diferencia de otros sistemas operativos, en OpenBSD no
hay que referirse a ellos como dc0:0 y dc0:1.  Si hace referencia a una
direcci&oacute; de IP alias espec&iacute;fica con ifconfig, o si
est&aacute; a&ntilde;adiendo un alias, aseg&uacute;rese de decir
'<kbd>ifconfig int alias</kbd>' en lugar de '<kbd>ifconfig int</kbd>'
en la l&iacute;nea de &oacute;rdenes.  Puede eliminar los alias con
'<kbd>ifconfig int delete</kbd>'.
</p>

<p>
Asumiendo que est&eacute; usando direcciones de IP m&uacute;ltiples que
est&eacute;n en la misma subred IP con alias, la configuraci&oacute;n
de su enmascaramiento de red (&quot;netmask&quot;) para cada alias pasa
a ser 255.255.255.255.  No necesitan seguir el netmask del primer IP
ligado a la interfaz.  En el siguiente <em>/etc/hostname.dc0</em> de
ejemplo, se a&ntilde;aden dos alias al dispositivo
<strong>dc0</strong>, el cual, por cierto, se configur&oacute; como
192.168.0.2 netmask 255.255.255.0.
</p>

<ul>
<pre>
# <strong>cat /etc/hostname.dc0</strong>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre>
</ul>

<p>
Una vez que haya configurado este fichero ser&aacute; necesario
reiniciar para que los cambios funcionen.  Sin embargo, puede hacer
efectivos los alias a mano, usando la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
Para hacer efectivo el primer alias use la orden:
</p>

<ul>
<pre>
# <strong>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</strong>
</pre>
</ul>

<p>
Para ver estos alias debe usar la orden:
</p>

<ul>
<pre>
$ <strong>ifconfig -A</strong>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre>
</ul>


<p>
<a name="PF"></a>
<a name="6.2"></a>
<a name="PacketFilter"></a>
<h2>6.2 - Filtro de paquetes IP (PF)</h2>
</p>

<p>
<h5>Nota: &quot;<em>Packet Filter</em>&quot; (&laquo;filtro de
paquetes IP&raquo;) es el sistema de filtrado para OpenBSD 3.0
y versiones posteriores.  Si busca las preguntas frecuents
sobre IPF/IPNAT para OpenBSD 2.9 y versiones anteriores, pulse
sobre <a href="faqipf.html">enlace</a>.</h5>
</p>
<p>
El subsistema de Filtro de paquetes IP fue creado con el fin
de gestionar dos tareas:  tratar con los permisos de
reenv&iacute;o a nivel de paquetes IP, y asignar
anfitriones/subredes a un rango de direcciones externas.  Los
ficheros de configuraci&oacute;n para estos dos servicios son
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a></em> y
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a></em>.
</p>

<p>
Para iniciar estos servicios con su sistema, antes debe editar
el fichero <em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></em>
y activar las siguientes l&iacute;neas:
</p>

<ul>
<pre>
pf=YES
</pre>
</ul>

<p>
Si no va a usar NAT, es probable que tambi&eacute;n tenga que
configurar el valor de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>,
<tt>net.inet.ip.forwarding</tt>, a 1.  Para ello debe activar
las l&iacute;neas relevantes en
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a></em>
y reiniciar su m&aacute;quina.
</p>

<p>
Si tiene PF compilado en su n&uacute;cleo pero no lo ha
activado en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a>,
lo puede activar f&aacute;cilmente con la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a>:
</p>

<ul>
<pre>
# <strong>pfctl -R /etc/pf.conf</strong>
# <strong>pfctl -N /etc/nat.conf</strong>
# <strong>pfctl -e</strong>
</pre>
</ul>

<p>
La primera l&iacute;nea configura el filtrado usando
<em>/etc/pf.conf</em>, y la segunda configura la
traducci&oacute;n de direcciones usando <em>/etc/nat.conf</em>
(m&aacute;s informaci&oacute;n sobre la traducci&oacute;n de
direcciones IP en <a href="#NAT">secci&oacute;n 6.3
(NAT)</a>), y finalmente, la &uacute;ltima l&iacute;nea activa
PF.
</p>

Esto tambi&eacute;n se puece combinar en una sola l&iacute;nea
de &oacute;rdenes:

<ul>
<pre>
# <strong>pfctl -R /etc/pf.conf -N /etc/nat.conf -e</strong>
</pre>
</ul>

<p>
Si hace alg&uacute;n cambio en <em>/etc/pf.conf</em>
despu&eacute;s de haber iniciado PF, puede volver a cargar sus
reglas recargando el fichero apropiado:
</p>

<ul>
<pre>
# <strong>pfctl -R /etc/pf.conf</strong>
</pre>
</ul>

<p>
A partir de aqu&iacute; este documento cubrir&aacute; algunos aspectos
b&aacute;sicos de configuraciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf(5)</a>.
Puede ver el ejemplo de <a href="#sample_pf.conf">juego de
reglas resultante</a> que incluye todos los cambios que se
explican a continuaci&oacute;n en detalle.  Tambi&eacute;n
puede encontrar m&aacute;s informaci&oacute;n sobre el filtro
de paquetes PF en las
<a href="http://www.benzedrine.cx/pf.html">p&aacute;ginas de
PF</a> y en el documento
<a href="http://www.inebriated.demon.nl/pf-howto/">Packet
Filter HOWTO</a>.
</p>

<p>
<h3>Filtro de paquetes IP (PF)</h3>
</p>

<p>
Para activar PF en el momento del inicio del sistema, necesita
modificar <em>/etc/rc.conf</em> de modo que lea
<tt>pf=YES</tt>.  El filtro de paquetes IP (PF) est&aacute;
controlado por el fichero <em>/etc/pf.conf</em>, que se
leer&aacute; durante el inicio.  Para una explicaci&oacute;n
m&aacute;s detallada lea la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>. 
En los siguientes ejemplos, <em>fxp0</em> representa la
interfaz externa a Internet.  En su caso puede ser diferente,
dependiendo del adaptador de ethernet de que disponga en su
m&aacute;quina.  En estas reglas se asumir&aacute; que existe
una conexi&oacute;n permanente a Internet, del mismo tipo que
la de un servidor de <em>web</em>.
</p>

<p>
Las reglas de PF se procesan de modo secuencial desde el
principio hasta el final, siendo de ayuda para visualizar cada
paquete que tenga que atravesar cada regla antes de alcanzar
su destino.
</p>

<p>
Por ejemplo, el grupo de reglas predefinido permite que entren
y salgan todos los paquetes:

<ul>
<pre>
pass out all 
pass in all
</pre>
</ul>
 
que es la forma abreviada de:

<ul>
<pre>
pass in from any to any
pass out from any to any
</pre>
</ul>

y que se puede leer como &laquo;dejar pasar los paquetes
entrantes procedentes de cualquier parte y con cualquier
destino&raquo;, y que implica &laquo;en cualquier interfaz
(siempre impl&iacute;cito si no se especifica una interfaz) de
cualquier familia de direcciones, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&sektion=4">inet (v4)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&sektion=4">inet6 (v6)</a>&quot;.
</p>

<p>
L&oacute;gicamente, estas reglas no representan un buen
ejemplo de filtro.  Un filtrado m&aacute;s &uacute;til
estar&aacute; basado en la familia de direcciones (IPv4
&oacute; IPv6), los protocolos y los puertos usados por los
servicios que desea filtrar.  Se puede especificar cualquiera
de los protocolos que aparecen en la lista de
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&sektion=5">/etc/protocols(5)</a></em>,
bien por su nombre o su n&uacute;mero, pero nosotros
s&oacute;lo abordaremos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&sektion=4">tcp(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&sektion=4">udp(4)</a> e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&sektion=4">icmp(4)</a>.
</p>

<p>
Supongamos ahora que no queremos permitir ninguna
conexi&oacute;n IPv4 entrante por el puerto TCP 3306 (MySQL)
porque la base de datos s&oacute;lo deber&iacute;a permitir la
conexi&oacute;n de forma local.  En este caso el grupo de
reglas ser&iacute;a as&iacute;:


<ul>
<pre>
pass out all
pass in all
block in on fxp0 inet proto tcp from any to any port = 3306
</pre>
</ul>

Que traducido viene a decir lo siguiente: &laquo;bloquear
todos los paquetes IPv4 entrantes procedentes cualquier sitio
y con destino a cualquier sitio, por el puerto tcp
3306&raquo;.  N&oacute;tese que se debe especificar un
protocolo con cada filtro basado en puertos, y se recomienda
que se indique al familia de direcciones a la que pertenece.
Para los servicios definidos en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a>,
tambi&eacute;n se puede usar los nombres del servicio, como
por ejemplo <em>www</em> o <em>mysql</em>.  Un paquete con
destino al puerto tcp 3306 en una interfaz <em>fxp0</em>,
pasar&aacute; la primer regla &quot;pass in&quot;, y a
continuaci&oacute;n ser&aacute; bloqueado por la regla
&quot;block in port = 3306&quot;.  Si invirtiera el orden de
sus reglas entrantes (recuerde que el orden es importante):

<ul>
<pre>
pass out all
block in on fxp0 inet proto tcp from any to any port = 3306
pass in all
</pre>
</ul>

los paquetes con destino al puerto tcp 3306 pasar&iacute;an
debido a que la &uacute;ltima regla en el grupo permite que
pasen todos los paquetes.  Cuando est&eacute; escribiendo
reglas para el filtrado de paquetes es importante que tenga en
cuenta lo siguiente: <strong>La &uacute;ltima regla que
concuerde tendr&aacute; precedencia</strong>.
</p>

<p>
Por supuesto que existen excepciones para toda regla.  La
opci&oacute;n <em>quick</em> filtra el paquete en la primera
regla que concuerde.  Veamos el defectuoso ejemplo anterior,
a&ntilde;adi&eacute;ndole la opci&oacute;n <em>quick</em> a la
regla &quot;block in&quot;:

<ul>
<pre>
pass out all
block in quick on fxp0 inet proto tcp from any to any port = 3306
pass in all
</pre>
</ul>

<p>
Un paquete destinado para el puerto tcp 3306 ser&aacute;
filtrado por la regla &quot;block in quick&quot; y bloqueado
inmediatamente.  Todos los paquetes destinados a otros puertos
no encontrar&aacute;n una concordancia en las reglas hasta
llegar a la regla &quot;pass in&quot; que permite que pasen
todos los paquetes.
</p>

<strong>Denegaci&oacute;n predefinida</strong>

<p>
La pol&iacute;tica de filtrado de p&aacute;quetes m&aacute;s
segura es la de &laquo;denegaci&oacute;n por
definici&oacute;n&raquo;.  Esta pol&iacute;tica es mucho
m&aacute;s segura que la denegaci&oacute;n expl&iacute;cita de
cada servicio protegido, permite grupos de reglas m&aacute;s
breves, y puede proteger de un servicio que haya sido mal
configurado de modo accidental y que haya quedado expuesto.
</p>

<p>
Veamos ahora otro ejemplo de grupo de reglas real, seguido de
una explicaci&oacute;n l&iacute;nea por l&iacute;nea.  El
siguiente ejemplo es para un servidor de web con una
pol&iacute;tica de denegaci&oacute;n predefinida que
s&oacute;lo permite conexiones ssh (para
administraci&oacute;n), y conexiones http (puerto 80) y https
(puerto 443).
</p>

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from any to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
</pre>
</ul>

<p>
Esto permitir&aacute; las conexiones desde cualquier sitio a
los puertos tcp 22 (ssh), 80 (http) y 443 (https).  Cualquier
otro intento de conexi&oacute;n distinto ser&aacute;
bloqueado, y permitir&aacute; todas las conexiones salientes.
Este grupo de reglas es muy estricto.  Pero, &iquest;y si Vd.
s&oacute;lo quisiera permitir la conexi&oacute;n a ssh a
anfitriones internos en su bloque de direcciones 1.1.1.0, y al
mismo tiempo permitir conexiones externas a http y https?
</p>

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
</pre>
</ul>

De acuerdo, pero, &iquest;y si s&oacute;lo quisiera permitir
la administraci&oacute;n remota de su servidor de web a una
sola m&aacute;quina (1.1.1.1)?  En tal caso cambiar&iacute;a
esta regla:

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
</pre>
</ul>

por esta otra:

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
</pre>
</ul>
</p>

<strong>Ejemplos de reglas</strong>

<p>
He aqu&iacute; algunas ejemplos de reglas que pueden ser de
utilidad para todos (en las que se asume que <em>fxp0</em> es
la interfaz externa conectada a Internet).  Primero
configuraremos un filtro simple para la protecci&oacute;n de
falsificaci&oacute;n de direcciones IP (<em>ip address
spoofing</em>).  Estas direcciones, por lo general, no
deber&iacute;an vagar por Internet, y si lo hacen, lo que es
bastante raro, las bloqueamos:

<ul><pre>
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \ 
172.16.0.0/12, 10.0.0.0/8 }
</pre></ul>

Nuestro grupo de reglas est&aacute; mejorando;  cuando lo
ponemos todo junto obtenemos esto:

<ul><pre>
# no permitir a nadie falsificar direcciones que no se
# puedan enrutar
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# permitir la conexi&oacute;n por ssh s&oacute;lo a nuestra
# m&aacute;quina de administraci&oacute;n

pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22

# permitir que otros usen http y https

pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443

# finalmente, cerrar el resto con una denegaci&oacute;n
# predeterminada
block in quick on fxp0 from any to any

# y dejar pasar todo el tr&aacute;fico saliente
pass out on fxp0 from any to any
</pre>
</ul>
</p>

<strong>Registro de paquetes</strong>

<p>
De momento va bastante bien, pero podr&iacute;a ir mejor.
&iquest;Qué har&iacute;amos si quisi&eacute;ramos obtener un
registro de cualquier intento de conexi&oacute;n al puerto 22
(ssh) que fuera por nuestro cortafuegos?  Ser&iacute;a fácil,
PF puede gestionar este caso con la opci&oacute;n clave
<em>log</em>:

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 inet proto tcp from any to any port = 22
</pre>
</ul>

Esta regla permitir&aacute; la conexi&oacute;n remota por el
puerto 22 a nuestra m&aacute;quina de administraci&oacute;n,
pero denegar&aacute; y registrar&aacute; cualquier otro
intento de conexi&oacute;n al puerto 22.
</p>

<p>
Los paquetes registrados se env&iacute;an a la interfaz
pflog0, que es monitorizada por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a>,
que suele volcar los paquetes a <em>/var/log/pflog</em> en
formato binario de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>.
Si pf se encuentra activado en
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></em>,
pflogd(8) se inicia de modo predefinido desde
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a></em>.
Puede leer estos ficheros de registro usando la siguiente
orden:

<ul>
<pre>
# <strong>tcpdump -n -e -ttt -r /var/log/pflog</strong>
</pre>
</ul>
</p>

<p>
Hay que tener en cuenta que la utilizaci&oacute;n de tcpdump
para monitorizar el fichero <em>pflog</em> NO ofrece
informaci&oacute;n a tiempo real.  Si quiere ver la
informaci&oacute;n a tiempo real, puede usar la siguiente
orden:

<ul>
<pre>
# <strong>tcpdump -i pflog0</strong>
</pre>
</ul>

Tambi&eacute;n es posible usar tcpdump para estrechar el
objetivo y facilitar as&iacute; el depurado:

<ul>
<pre>
# <strong>tcpdump -e -i pflog0 port 80</strong>
</pre>
</ul>

Esta orden NO altera los datos que se incluyen en el fichero
<em>/var/log/pflog</em>.
</p>

<p>
Cuando se examinan los registros propios, es aconsejable tener
mucho cuidado con la descodificaci&oacute;n del protocolo (la
verbosidad en los mensajes se activa a&ntilde;adiendo la
opci&oacute;n <em>-v</em> a la orden).  Los descodificadores
de protocolo de tcpdump no tienen un historial impecable.  En
teor&iacute;a ser&iacute;a posible un ataque retrasado a
trav&eacute;s de paquetes parciales de carga &uacute;til
(<em>partial packet payload</em>) registrados por el
dispositivo de ingreso.
</p>

<p>
Es preciso tener un cuidado especial con el acceso a los
registros.  pflogd captura 96 bytes del paquete y los
registrar&aacute;.  El acceso a los registros podr&iacute;a
proveer acceso parcial a paquetes de carga &uacute;til de
car&aacute;cter reservado (como registros de ingreso de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&sektion=1">telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a>).
</p>

<p>
<strong>Protocolos m&uacute;ltiples</strong>
</p>

<p>
&iquest;Qu&eacute; ocurrir&iacute;a si necesit&aacute;ramos
permitir las conexiones a un servicio que funcionara sobre
m&uacute;ltiples protocolos (como bind, que usa TCP y UDP)?
PF le permite agrupar opciones (m&aacute;s adelante volveremos
a este tema):

<ul>
<pre>
# Permitir el tr&aacute;fico de DNS para BIND
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
</pre>
</ul>

N&oacute;ntese los espacios a ambos lados de los caracteres
'{ }'.  Esta forma es m&aacute;s elegante que la alternativa
que tendr&iacute;a que usar:

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from any to any port = 53
pass in quick on fxp0 inet proto udp from any to any port = 53
</pre>
</ul>
</p>

<p>
<a name="normalization"></a>
<strong>Normalizaci&oacute;n de paquetes</strong>
</p>

<p> 
Como hay algunos sistemas operativos y aplicaciones que tienen
problemas con paquetes fragmentados o an&oacute;malos, a veces
es beneficioso normalizar los paquetes antes de que pasen a su
destino final.  Esto se hace mediante la directiva
<strong>scrub</strong>, que se usa como sigue:

<ul>
<pre>
scrub in all
</pre>
</ul>

Pero como esto a&ntilde;ade una carga adicional en el sistema,
no es recomendable usar esta orden a menos que este sistema se
encuentre protegiendo a un dispositivo con una pobre
implementaci&oacute;n de TCP/IP.
</p>

<p>
<strong>IP Options</strong>
</p>

<p>
En su comportamiento predeterminado, PF bloquea los paquetes
que tienen las opciones de IP activadas.  Esto puede
dificultar a&uacute;n m&aacute;s la tarea a las utilidades de
detecci&oacute;n de sistemas como nmap.  Si tiene una
aplicaci&oacute;n que requiera el paso de estos paquetes, como
puede ser IGMP, puede usar la directiva
<strong>allow-opts</strong>:

<ul>
<pre>
pass in quick on fxp0 allow-opts
</pre>
</ul>
</p>

<p>
<strong>Indicadores TCP, conexiones establecidas, y
mantenimiento del estado</strong>
</p>

<p>
PF tambi&eacute;n puede filtrar los paquetes bas&aacute;ndose
en los indicadores de TCP, y mantener las conexiones
establecidas y el estado de la conexi&oacute;n.  Se recomienda
que todos los usuarios que deseen filtrar paquetes
bas&aacute;ndose en los indicadores TCP entiendan antes el
papel que desempe&ntilde;a cada indicador.  Por ejemplo, si un
usuario quisiera denegar la conexi&oacute;n a todos los
paquetes con los indicadores FIN, URG, y PSH activados (como
por ejemplo en un intento de obtener identificar a un sistema
operativo mediante nmap), podr&iacute;a usar una regla como la
siguiente:

<ul>
<pre>
block in quick on fxp0 inet proto tcp from any to any flags FUP/FUP
</pre>
</ul>

(Gracias a <a href=mailto:halogen@nol.net>Kyle Hargraves</a> por esta
regla)
</p>

<p>
El pr&oacute;ximo truco de PF es su capacidad para
&laquo;mantener el estado&raquo; (<em>&quot;keep
state&quot;</em>).  &laquo;Mantener el estado&raquo; ha sido
definido como &laquo;no hablar hasta que no le hablen&raquo;
o, en otras palabras, una vez que se ha establecido una
conexi&oacute;n, los paquetes ya no tienen que atravesar
grupos de reglas.  &Eacute;sta es una potente funcionalidad
que permite escribir unas reglas mucho m&aacute;s sencillas y
seguras.
</p>

<p>
Por ejemplo, veamos c&oacute;mo se puede aplicar este estado
al ejemplo del grupo de reglas anterior.
&iquest;Todav&iacute;a est&aacute; confundido?.
Revis&eacute;moslo: estamos permitiendo el acceso para la
gesti&oacute;n del sistema desde nuestra m&aacute;quina de
clase C al puerto 22 (ssh), y el acceso <em>web</em> a todo el
tr&aacute;fico entrante a los puertos 80 (http) y 443 (https).
Y estamos bloqueando el resto del tr&aacute;fico;  pero,
&iquest;y si quisiera conectar a trav&eacute;s de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a>
fuera del servidor de <em>web</em>? o, &iquest;y si necesitara
usar <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a>
para buscar algo en las p&aacute;ginas de Preguntas
Frecuentes?  No podr&iacute;a, ya que habr&iacute;a bloqueado
todas las conexiones entrantes que no estuvieran dirigidas a
los puertos especificados.  Aunque &eacute;sta es la ruta
m&aacute;s segura, puede ser muy poco conveniente.  Al
a&ntilde;adir las opciones clave <em>keep state</em> a la
regla &quot;pass out&quot;, puede permitir el paso de
conexiones entrantes que sean respuestas a conexiones que Vd.
haya iniciado previamente, como por ejemplo al navegar por la
web.  Recuerde que es necesario especificar para qu&eacute;
protocolo estamos manteniendo el estado.
</p>

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 inet proto tcp from any to any keep state
</pre>
</ul>

<p>
Este peque&ntilde;o cambio supondr&aacute; un dram&aacute;tico
incremento en la flexibilidad y seguridad de su grupo de
reglas:  por ejemplo, en el grupo de reglas anterior, estamos
permitiendo el paso a todo el tr&aacute;fico tcp a los puertos
80 y 443.  A&uacute;n puede hacerlo un poco m&aacute;s
estricto.  Para establecer una conexi&oacute;n tcp s&oacute;lo
necesita permitir que tenga lugar el saludo inicial
(<em>handshake</em>); una vez que esto ocurra, puede bloquear
el tr&aacute;fico a ese puerto y permitir a la regla
&quot;keep state&quot; que gestione la conexi&oacute;n.  Para
que se complete el saludo inicial, s&oacute;lo es necesario
que los paquetes tengan SYNACK activado.  Dejando pasar
s&oacute;lo paquetes con SYN activado se puede prevenir muchas
formas de barridos de puertos (<em>port scanning</em>), como
puede ser el barrido de FIN.  Los indicadores S/SA del
indicador S (SYN) y el indicador A (ACK) indican que
s&oacute;lo se puede activar SYN.  No se investiga sobre otros
paquetes.  Ahora, las reglas est&aacute;n de este modo:

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
block in quick on fxp0 from any to any
pass out on fxp0 proto tcp from any to any keep state
</pre>
</ul>
</p>

<p>
Empecemos a poner un poco de orden poniendo todas las reglas
que tenemos hasta ahora juntas.  Este grupo de reglas
tendr&aacute; soporte para IPv4, una pol&iacute;tica de
denegaci&oacute;n predefinida, permitir&aacute; conexiones
para la gesti&oacute;n del sistema s&oacute;lo si provienen de
una red interna (a trav&eacute;s de ssh), y permitir&aacute;
el paso del tr&aacute;fico entrante a los puertos 80 (http) y
443 (https).  Adem&aacute;s, proteger&aacute; contra
direcciones de ip falsificadas no enrutables, y
bloquear&aacute; todos los paquetes que est&eacute;n tan
fragmentados que no puedan ser inspeccionados.  Una
configuraci&oacute;n bastante completa para un servidor de
<em>web</em> p&uacute;blico.  He aqu&iacute; c&oacute;mo
quedar&iacute;a <em>/etc/pf.conf</em>:

<ul>
<pre>
# limpiar paquetes fragmentados y an&oacute;malos
scrub in all

# no permitir a nadie que falsee direcciones no enrutables
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# permitir la conexi&oacute;n por ssh s&oacute;lo las
# m&aacute;quinas en la red interna
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22

# permitir que otros usen http y https
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA

# finalmente, bloquear el resto con una denegaci&oacute;n por
# definici&oacute;n
block in quick on fxp0 from any to any

# y dejar pasar todo el tr&aacute;fico saliente y mantener el
# estado en conexiones establecidas
pass out on fxp0 from any to any keep state
</pre>
</ul>
</p>

<p>
Aunque esto pueda parecer suficiente, hay algunas cosas que PF
le permitir&aacute; llevar a cabo para que su fichero
<em>pf.conf</em> sea m&aacute;s claro y m&aacute;s
f&aacute;cil de mantener.
</p>

<p>
<strong><em>Sets</em> (agrupaciones)</strong>
</p>

<p>
Las agrupaciones son abreviaciones que sirven para escribir
reglas m&aacute;s simples y claras en PF.  Por ejemplo,
&iquest;qu&eacute; har&iacute;amos si quisi&eacute;ramos
permitir conexiones a un servicio que funcionase sobre
m&uacute;ltiples protocolos (como BIND, que usa TCP y UDP?

<ul>
<pre>
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
</pre>
</ul>

N&oacute;ntese los espacios a ambos lados de los caracteres '{ }'.
</p>

<p>
Los grupos de IP relacionadas se pueden reagrupar en
&laquo;agrupaciones&raquo; (<em>sets</em>), que se pueden
utilizar en cualquier parte en la que se pueda usar una IP.
Por ejemplo, tomando como partida nuestras reglas contra la
falsificaci&oacute;n de IP anteriores:

<ul>
<pre>
# no permitir que nadie pueda falsificar las
# direcciones no enrutables
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
</pre>
</ul>
</p>

<p>
<strong>Variables de expansi&oacute;n</strong>
</p>

<p>
Un problema con el ejemplo del fichero <em>pf.conf</em>
anterior es que, si necesit&aacute;ramos cambiar nuestro NIC,
o cambiar una direcci&oacute;n IP, tendr&iacute;amos que
cambiar muchas l&iacute;neas.  Para suavizarlo podemos definir
variables de expansi&oacute;n:

<ul>
<pre>
NoRouteIPs=&quot;{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot;
ExtIF=&quot;fxp0&quot;
block in quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs
</pre>
</ul>
</p>

<p>
<a name="sample_pf.conf"></a>
<strong>Todo junto</strong>
</p>

<p>
Pongamos todo lo que hemos visto hasta ahora en un fichero y
veremos la elegancia de &eacute;ste:

<ul>
<pre>
# definir algunas variables
ExtIF=&quot;fxp0&quot;              # la interfaz externa
IntNet=&quot;1.1.1.0/24&quot;       # nuestra red interna
NoRouteIPs=&quot;{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot;
Services=&quot;{ www, https }&quot;

# eliminar los paquetes fragmentados y an&oacute;malos
scrub in all

# no permitir que alguien pueda falsificar
# las direcciones no enrutables
block in quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs

# permitir s&oacute;lo a nuestras m&aacute;quinas la
# conexi&oacute;n por ssh
pass in quick on $ExtIF inet proto tcp from $IntNet to any port = 22

# permitir a otros el uso de http y https
pass in quick on $ExtIF inet proto tcp from any to any port $Services flags S/SA

# finalmente, bloquear el resto con
# una denegaci&oacute;n predefinida
block in quick on $ExtIF from any to any
 
# y dejar salir al tr&aacute;fico saliente, y mantener el
# estado en las conexiones establecidas
pass out on $ExtIF from any to any keep state
</pre>
</ul>
</p>

<p>
Si experimenta problemas, puede activar el registro en reglas
individuales con la clave <em>log</em> para facilitar la
resoluci&oacute;n de problemas, o sea:

<ul>
<pre>
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22
</pre>
</ul>

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a> escribir&aacute; las entradas del registro ip a
<em>/var/log/pflog</em>.  Recuerde que <em>/var/log/pflog</em>
es un fichero binario que debe ser leido por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>, y NO directamente por humanos.
</p>

<p>
&iexcl;Cuando modifique el fichero sde configuraci&oacute;n
para el registro de paquetes, no se olvide de ejecutar
<kbd>pfctl -R /etc/pf.conf</kbd> para que los cambios tengan
lugar!
</p>

<p>
<h3>Diferencias entre PF e IPF</h3>
</p>

<p>
El Filtro de Paquetes IP (PF), ha sido dise&ntilde;ado para
ser muy compatible con el fichero de reglas <em>ipf.rules</em>
de IPF.  Sin embargo, PF no es un simple substituto para IPF.
Las diferencial sint&acute;cticas principales de la reglas de
filtrado (<em>pf.conf</em>) son las siguientes:
</p>

<ul>
<li><strong><em>group</em> y <em>head</em>:</strong>
Estas opciones ya no se utilizan, debido a que las reglas de
filtrado se optimizan al vuelo.  Si est&aacute; migrando desde
sus viejas reglas de IPF debe eliminar cualquier
definici&oacute;n de <em>group</em> o <em>head</em> y
reordenar sus reglas de forma manual, asegur&aacute;ndose de
que la sem&aacute;ntica no haya cambiado.</li>
<li><strong><em>level:</em></strong>
Cuando se efect&uacute;an registros, PF no acepta la
opci&oacute;n <em>level</em> como clave de registro, ya que el
registro se lleva a cabo mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8">syslogd(8)</a>,
pero mediante un d&aelig;mon de registro separado.  Para
examinar un tipo de tr&aacute;fico particular, como se
hac&iacute;a con la opci&oacute;n <em>level</em>, use
cualquiera de las opciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>
disponibles a este efecto.</li>
<li><strong><em>keep frags</em>:</strong>
Ha sido substituido por la normalizaci&oacute;n que lleva a
cabo <a href="#normalization">scrub</a>.</li>
<li><strong>Reglas <em>@n</em>:</strong>
En PF no existe soporte para prefijar reglas con <em>@n</em>
para introducirlas en ciertos puntos en la lista de la regla,
como en IPF.  Para ver los n&uacute;meros de regla que ha
asignado PF, use la orden <kbd>pfctl -sr</kbd>.</li>
</ul>

<p>
<a name="6.3"></a>
<a name="NAT"></a>
<h2>6.3 - NAT</h2>
</p>

<p>
<h5>Nota: PF es el sistema de filtrado en OpenBSD 3.0 y
versiones posteriores.  Si est&aacute; buscando las preguntas
frecuentes de IPF/IPNAT para OpenBSD 2.9 y versiones
anteriores, pulse <a href="faqipf.html">aqu&iacute;</a>.</h5>
</p>

<p>
<a name="nat1.0"></a>
<h3><u>6.3.1 Introducci&oacute;n a NAT</u></h3>

<a name="nat1.1"></a>

<p>
Basado en la especificaci&oacute;n
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC
1631</a>, NAT provee de un modo f&aacute;cil para asignar
redes internas a una sola direcci&oacute;n de Internet
enrutable (&laquo;real&raquo;).  Es de gran utilidad si no
dispone de direcciones asignadas oficialmente para cada
anfitri&oacute;n en su red interna.  Cuando configure redes
privadas/internas puede aprovechar los bloques de
direcci&oacute;n reservados (asignados en la
especificaci&oacute;n
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC
1918</a>), como:
</p>

<p>
10.0.0.0/8 (10.0.0.0 - 10.255.255.255)<br>
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)<br>
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)<br>
</p>

<p>
Se asume que el usuario ya tiene configurado un sistema
OpenBSD con dos tarjetas de red (una conectada a Internet y la
otra a la red local).
</p>

<br>
<a name="nat1.3"></a>
<strong>Detalles de configuraci&oacute;n</strong>

<p>
Usaremos el sistema que se describe a continuaci&oacute;n como
ejemplo.  Como su configuraci&oacute;n ser&aacute;, con casi
toda seguridad, distinta a &eacute;sta, tenga mucho cuidado
con no copiar lo que vea literalmente en su sistema y
esperando que funcione correctamente.
</p>

<ul>
<strong>NICs: </strong>
<ul>
Intel EtherExpress Pro/100 <strong>fxp0</strong><br>
Conectada a la LAN EXTERNA (o WAN)<br>
<strong>IP Address: </strong>24.5.0.5<br>
<strong>Netmask: </strong>255.255.255.0<br>
<br>
Compaq Netelligent 10/100Mb <strong>tl0</strong><br>
Conectada a la LAN INTERNA<br>
<strong>IP Address: </strong>192.168.1.1<br>
<strong>Netmask: </strong>255.255.255.0<br>
</ul>
<br>
<strong>IP enrutable por Internet, externo (en este ejemplo, una
conexi&oacute;n por m&oacute;dem anal&oacute;gico provista por un
Proveedor de Servicios de Internet)</strong><br>
<ul>
<strong>IP Address: </strong>24.5.0.5<br>
<strong>Netmask: </strong>255.255.255.0<br>
<strong>Gateway: </strong>24.5.0.1<br>
</ul>
<br>
<strong>Red de &Aacute;rea Local (LAN)</strong><br>
<ul>
En este entorno de ejemplo, las m&aacute;quinas de la LAN usan
el esquema de direcciones IP 192.168.1.xxx (donde xxx es un
n&uacute;mero &uacute;nico).  Existe una gran variedad de
sistemas operativos diferentes en la red interna, incluidos
Windows 98, Windows NT, OpenBSD y Linux, pero el sistema
operativo cliente no es un problema para NAT.  Cada
m&aacute;quina est&aacute; conectada a un concentrador
(<em>hub</em>) designado para uso interno.  Para este
documento y sus ejemplos, se asumir&aacute; que el cliente en
la red interna tiene una direcci&oacute;n IP 192.168.1.40
</ul>
<br>
<strong>Diagrama de configuraci&oacute;n</strong>
<ul><pre>

+-----+              +---------+          +----------+
| Hub |--------- tl0 |   NAT   | fxp0 ----| Internet |
+-----+              +---------+          +----------+
| |
| +-- Cliente A
+---- M&aacute;s clientes

		      +--------------------------+
		      |          LEYENDA         |
		      +--------------------------+
		      |  NIC fxp0 - 24.5.0.5     |
		      |  NIC tl0  - 192.168.1.1  |
		      | Cliente A - 192.168.1.35 |
		      +--------------------------+

</pre></ul>
</ul>

<br>
<a name="nat2.0"></a>
<h3><u>6.3.2 Traducci&oacute;n de direcciones de red</u></h3>
<br>

<a name="nat2.1"></a>
<strong>Introducci&oacute;n a NAT</strong>

<p>
Cada nodo en Interner requiere una direcci&oacute;n IP
&uacute;nica.  Con IPv4 hay un n&uacute;mero finito de
direcciones IP diferentes disponibles, y como resultado no son
gratuitas.  La mayor&iacute;a de proveedores de Internet de
&laquo;bajos costes&raquo; limitan un sitio a cualquier parte
desde 1 a 30 direcciones, y mientras organizaciones con
presupuestos m&aacute;s grandes pueden permitirse un bloque
mayor, en la mayor&iacute;a de los casos, existen pocos
beneficios y demasiados riesgos al tener cada m&aacute;quina
con una direcci&oacute;n individual en Internet.
</p>

<p>
NAT, &laquo;Traducci&oacute;n de Direcciones de Red&raquo;
(tambi&eacute;n conocido como &laquo;Enmascaramiento de
IP&raquo; en Linux), permite que varias m&aacute;quinas se
encuentren <em>detr&aacute;s</em> de una direcci&oacute;n IP
(o de unas cuantas).  Cada m&aacute;quina en la red interna
tiene una direcci&oacute;n IP no registrada que se asigna de
forma interna (de acuerdo con las especificaciones de
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC
1918</a>), y todas utilizan la misma direcci&oacute;n IP
externa de forma simult&aacute;nea.
</p>

<p>
El modo en que funciona NAT es bastante simple.  Cuando un
cliente dentro de la LAN quiere conectar a la m&aacute;quina
en Internet, le env&iacute;a un paquete TCP con un
requerimiento de conexi&oacute;n.  Dentro de la cabecera del
paquete TCP se encuentra la direcci&oacute;n IP del cliente
(por ejemplo, 192.168.1.40) y la direcci&oacute;n IP del
anfitri&oacute;n requerido (por ejemplo, 123.45.67.89).  La
m&aacute;quina en la que est&aacute; funcionando NAT
intercepta este paquete TCP y cambia la direcci&oacute;n IP
del cliente de 192.168.1.40 a la direcci&oacute;n IP de la
m&aacute;quina conectada a Internet (por ejemplo, 24.5.0.5).
De este modo enga&ntilde;a a la m&aacute;quina anfitriona,
haci&eacute;ndole pensar que la conexi&oacute;n requerida
proviene de la m&aacute;quina con NAT, no de la m&aacute;quina
cliente.  Entonces el anfitri&oacute;n env&iacute;a de vuelta
respuestas a la m&aacute;quina NAT como si &eacute;sta fuera
la que se estuviera conectando.  Cuando la m&aacute;quina NAT
recibe las respuestas, las traduce r&aacute;pidamente y
env&iacute;a el paquete al cliente.  Generalmente, el cliente
no tiene ni la m&aacute;s remota idea de lo que est&aacute;
ocurriendo y la supuesta conexi&oacute;n a Internet es
transparente al usuario y a las aplicaciones del usuario.
</p>

<p>
El ejemplo siguiente muestra NAT de un modo m&aacute;s claro:
</p>

<ul><pre>
Cliente ---------------- tl0 [ NAT ] fxp0 ---------- Internet Host
192.168.1.35 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

Paquete TCP SALIENTE                             Paquete TCP SALIENTE
Desde: 192.168.1.35  &gt;&gt;=== NAT ===&gt;&gt; Hacia: 24.5.0.5
Hacia: 123.45.67.89                              Hacia: 123.45.67.89

Paquete TCP ENTRANTE				 Paquete TCP ENTRANTE
Desde: 123.45.67.89 				 Desde: 123.45.67.89
Hacia: 192.168.1.40  &lt;&lt;=== NAT ===&lt;&lt; Hacia: 24.5.0.5
</pre></ul>

<br>
<a name="nat2.2"></a>
<strong>&iquest;Por qu&eacute; usar NAT?</strong>

<p>
Una vez que ya hab&iacute;a conseguido un m&oacute;dem cable
en mi nuevo apartamento me d&iacute; cuenta de que
ten&iacute;a un peque&ntilde;o problema.  &iquest;C&oacute;mo
podr&iacute;a conseguir acceso a Internet para mis
compa&ntilde;eros de apartamento si el m&oacute;dem estaba en
mi habitaci&oacute;n?  S&oacute;lo hab&iacute;a unas pocas
opciones que pod&iacute;an ayudarme, y que iban desde obtener
direcciones IP extras, pasando por instalar un servidor proxy,
hasta instalar NAT (no permita que el ejemplo casero del
m&oacute;dem cable le enga&ntilde;e, NAT es lo suficientemente
potente como para enmascarar un gran red con cientos o incluso
miles de m&aacute;quinas).
</p>

<p>
Existen varias razones por las que decid&iacute; instalar NAT,
la primera de ellas la de ahorrar costes.  En la casa
viv&iacute;an dos compa&ntilde;eros de piso, y compartir
gastos es una buena idea.  Adem&aacute;s, cada uno
ten&iacute;a su propio PC y yo ten&iacute;a tres;
ten&iacute;amos cinco m&aacute;quinas que conectar, pero mi
ISP s&oacute;lo permit&iacute;a tres direcciones IP por casa,
lo que significaba que no hab&iacute;an direcciones IP
suficientes para que cada m&aacute;quina pudiera acceder a
Internet de forma simult&aacute;nea.
</p>

<p>
Usando NAT cada m&aacute;quina tendr&iacute;a una
direcci&oacute;n IP interna &uacute;nica,  pero
compartir&iacute;an la &uacute;nica direcci&oacute;n IP que mi
ISP me dio.  El coste se redujo.
</p>

<br>
<a name="nat2.4"></a>
<strong>Preconfiguraci&oacute;n</strong>

<p>
Para activar NAT en su m&aacute;quina OpenBSD,
necesitar&aacute; configurar PF.  Esto se puede llevar a cabo
de una manera f&aacute;cil editando los ficheros que aparecen
en la siguiente lista (haga los cambios al fichero de modo que
aparezcan como las opciones que siguen a continuaci&oacute;n):
</p>

<p>
<strong>/etc/rc.conf</strong> (este fichero se usa para
iniciar servicios durante el arranque)
</p>

<ul><pre>
pf=YES<br>
</pre></ul>

<p>
<strong>/etc/sysctl.conf</strong>
</p>

<ul><pre>
net.inet.ip.forwarding=1
</pre></ul>

<p>
Despu&iacute;s de haber hecho estos cambios, la m&aacute;quina
estar&aacute; lista para la configuraci&oacute;n de NAT.
</p>

<br>
<a name="nat2.5"></a>
<strong>Configuraci&oacute;n</strong>

<p>
El primer paso es configurar el fichero de reglas de PF
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf</a></em>).
Para el prop&oacute;sito que persigue este documento,
dejaremos que el tr&aacute;fico pase a trav&eacute;s de este
cortafuegos sin que haya interferencias.  El fichero
ser&aacute; como sigue:
</p>

<ul>
<pre>
pass in all
pass out all
</pre>
</ul>

<p>
Para m&aacute;s informaci&oacute;n puede leer la
secci&oacute;n sobre <a href="#PF">PF, el paquete de filtros
IP</a> de OpenBSD.
</p>

<p>
La sintaxis del fichero de configuraci&oacute;n de NAT
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf</a></em>)
es bastante simple.  De acuerdo con el ejemplo de
configuraci&oacute;n anterior, el fichero de
configuraci&oacute;n de NAT contendr&aacute; las siguientes
entradas:
</p>

<ul>
<pre>
nat on fxp0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
</pre>
</ul>

<p>
He aqu&iacute; lo que significan estas l&iacute;neas.
</p>

<ul>
<strong>&quot;nat&quot;</strong>
<p>
Indica que la orden que se est&aacute; dando es una regla de
NAT.
</p>
</ul>

<ul>
<strong>&quot;fxp0&quot;</strong>
<p>
&Eacute;sta es la interfaz de red que est&aacute; conectada a
Internet.
</p>
</ul>

<ul>
<strong>&quot;192.168.1.0/24&quot;</strong>
<p>
La direcci&oacute;n IP y de enmascaramiento de red
(<em>netmask</em>, cuyo formato es CIDR).  La
combinaci&oacute;n de ambas indica que &laquo;cualquier
direcci&oacute;n IP con un valor desde 192.168.1.1 hasta
192.168.1.254 debe ser asignado&raquo;.
</p>
</ul>

<ul>
<strong>&quot;24.5.0.5&quot;</strong>
<p>
&Eacute;sta es la direcci&oacute;n IP external que se
asignar&aacute; a la direcci&oacute;n IP interna.
</p>
</ul>


<a name="nat2.6"></a>
<strong>Funcionamiento</strong>

<p>
Una vez que haya acabado de configurarlo, hay dos formas de
activar NAT.  La primera forma, y la mejor si fuera posible,
es reiniciando su sistema OpenBSD.  Para ello basta que use la
orden <kbd>reboot</kbd>.
</p>

<p>
Si quiere ejecutar NAT desde la l&iacute;nea de
&oacute;rdenes, use las siguiente &oacute;rdenes:
</p>

<ul>
<pre>
# <strong>pfctl -N /etc/nat.conf</strong>
# <strong>pfctl -e</strong>
</pre>
</ul>

<p>
La primera l&iacute;nea es para cargar un grupo de reglas de
NAT en PF (y eliminar cualquier regla anterior), y la segunda
para activar PF.  Despu&eacute;s de esto, la mejor manera de
asegurarse que todo iniciar&aacute; como se espera, es
reiniciar el sistema.
</p>

<p>
<strong>Nota:</strong> para volver a cargar las
configuraciones de NAT (en el caso en que las cambiara y no
quisiera reiniciar) ejecute la primera orden de nuevo.  Las
configuraciones ser&aacute;n descargadas y cargadas de nuevo.
</p>

<br>
<a name="nat3.0"></a>
<h3><u>6.3.3 Base de conocimientos de NAT</u></h3>

<br>
<a name="nat3.1"></a>
<strong>Verificaci&oacute;n del estado de NAT</strong>

<p>
Para averiguar c&oacute;mo est&aacute; funcionando NAT o
asegurarse de que las configuraciones hayan hecho efecto, use
la opci&oacute;n &quot;-ss&quot;.  Esta opci&oacute;n le
mostrar&aacute; un listado de todas las sesiones que NAT
est&eacute; usando actualmente:
</p>

<ul>
<pre>
# pfctl -ss
TCP  192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22       TIME_WAIT:TIME_WAIT
TCP  192.168.1.35:2492 -&gt; 24.5.0.5:55011 -&gt; 65.42.33.245:22       ESTABLISHED:ESTABLISHED
UDP  192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53       2:1
</pre>
</ul>

<p>
A continuaci&oacute;n puede ver una explicaci&oacute;n sobre
lo que significa la primera l&iacute;nea (las otras son
similares):
</p>

<ul>
<strong>&quot;192.168.1.35:2132&quot;</strong>
<p>
Le indica la direcci&oacute;n IP de la m&aacute;quina que
est&eacute; usando NAT (192.168.1.35) en la LAN.  El
n&uacute;mero del puerto que se use para realizar la
conexi&oacute;n (2132) se mostrar&aacute; a
continuaci&oacute;n.
</p>
</ul>

<ul>
<strong>&quot;24.5.0.5:53136&quot;</strong>
<p>
Indica que la conexi&oacute;n se dirige hacia Internet a
trav&eacute;s de la direcci&oacute;n 24.5.0.5 usando el puerto
53136.
</p>
</ul>

<ul>
<strong>&quot;65.42.33.245:22&quot;</strong>
<p>
La direcci&oacute;n IP y el puerto al que se conecta.
</p>
</ul>

<ul>
<strong>&quot;TIME_WAIT:TIME_WAIT&quot;</strong>
<p>
Indica el estado en que PF cree que se encuentra la
conexi&oacute;n TCP.
</p>
</ul>

<a name="nat3.2"></a>
<strong>Consideraciones sobre FTP y NAT</strong>

<p>
Existen unas cuantas limitaciones de NAT a tener en cuenta, de
las cuales la m&aacute;s com&uacute;n es con FTP.  Puede usar
FTP de dos maneras:  pasivo y activo;  de &eacute;stas, FTP
pasivo est&aacute; considerado como el m&aacute;s seguro en la
mayor&iacute;a de los casos.
</p>

<p>
Con FTP activo, cuando un usuario conecta a un servidor de FTP
remoto y pide un fichero o informaci&oacute;n, el cliente de
FTP env&iacute;a al servidor un n&uacute;mero aleatorio de
puerto en el que el servidor establecer&aacute; una
conexi&oacute;n para el cliente y por el que tranmitir&aacute;
la informaci&oacute;n requerida.  Esto supone un problema para
los usuarios que intenten acceder a servidores de FTP desde
dentro de la misma red interna.  Cuando el servidor de FTP
env&iacute;a su informaci&oacute;n, la env&iacute;a al NIC
externo y a un puerto aleatorio.  La m&aacute;quina de NAT la
recibe, pero debido a que no tiene asignaciones para el
paquete desconocido ni para este puerto, bloquea el paquete y
no lo entrega.
</p>

<p>
Con el modo pasivo de FTP (el predeterminado en el cliente de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a> en OpenBSD),
el cliente hace una petici&oacute;n para que el servidor
escoja un puerto aleatorio, y se mantiene a la escucha por ese
puerto esperando los datos de conexi&oacute;n.  El servidor
informa al cliente del puerto que ha elegido, y el cliente se
conecta a ese puerto para tranferir los datos.  Esto,
desafortunadamente, no siempre es posible ni deseable.  ftp(1)
usa este modo de forma predeterminada;  para forzar el uso del
modo activo de FTP, use el indicador <em>-A</em> con la orden
de <kbd>ftp</kbd>, o desactive el modo pasivo mediante la orden
<dl><dt>
<pre>
passive off
</pre>
</dt></dl>
desde el punto de pedido <em>ftp&gt;</em>.
</p>

<p>
PF dispone de otra soluci&oacute;n para este caso,
redireccionando el tr&aacute;fico de FTP a trav&eacute;s de un
servidor <em>proxy</em> de FTP, un proceso que
&laquo;gu&iacute;a&raquo; su tr&aacute;fico de FTP a
trav&eacute;s de los filtros.  El <em>proxy</em> de FTP
utilizado por OpenBSD y PF es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8">ftp-proxy(8)</a>.
Para activarlo, a&ntilde;ada a su fichero
<em>/etc/nat.conf</em> algo parecido a esto:

<ul>
<pre>
rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8081
</pre>
</ul>

En pocas palabras, esta l&iacute;nea significa que el
&laquo;tr&aacute;fico en la interfaz interna se redirecciona
al servidor de proxy que hay funcionando en esta
m&aacute;quina y que est&aacute; a la escucha por el puerto
8081&raquo;.
</p>

<p>
Con suerte, es f&aacute;cil ver que el servidor de proxy debe
ser iniciado y ejecutado en la m&aacute;quina OpenBSD, lo que
se hace introduciendo la siguiente l&iacute;nea en el fichero
<em>/etc/inetd.conf</em>:

<ul>
<pre>
8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre>
</ul>

y reiniciando el sistema of enviando una se&ntilde;al 'HUP' a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>.
Una forma de enviar esta se&ntilde;al 'HUP' es mediante la
orden:

<ul>
<pre>
kill -HUP `cat /var/run/inetd.pid`
</pre>
</ul>

Notar&aacute;a que ftp-proxy estar&aacute; a la escucha por el
puerto 8081, el mismo puerto al que rdr estaba enviando el
tr&aacute;fico de FTP.  Hemos escogido el puerto 8081 de forma
arbitraria, aunque 8081 es una buena elecci&oacute;n ya que no
est&aacute; asignado para ninguna otra aplicaci&oacute;n.
</p>

<br>
<a name="nat3.3"></a>
<strong>Redireccionamiento del tr&aacute;fico</strong>

<p>
Con algunas aplicaciones es probable que tenga que
redireccionar el tr&aacute;fico entrante o saliente para un
cierto protocolo y/o puerto, hacia una cierta m&aacute;quina
que se encuentre detr&aacute;s del sistema de filtros.  Un
ejemplo de esto podr&iacute;a ser el caso de una
m&aacute;quina que se encontrara dentro de la red local y que
tuviera un servidor de <em>web</em> que tuviera que ser
accedido desde fuera (o, por supuesto, el ya consabido
ftp-proxy(8)).  Las conexiones entrantes a us IP v&aacute;lida
de Internet se encontrar&aacute;n con que, a menos que la
m&aacute;quina de NAT tambi&eacute;n tenga un servidor de
<em>web</em>, no pondr&aacute;n conectarse.  Para ello
usaremos la directiva 'rdr' de NAT en el fichero de reglas, a
fin de dar las instrucciones sobre d&oacute;nde se debe
redireccionar una conexi&oacute;n concreta.
</p>

<p>
Para nuestro ejemplo, supongamos que un servidor de web reside
en la LAN y que su direcci&oacute;n IP es 192.168.1.80.  El
fichero de reglas de NAT necesita una nueva directiva para
gestionar esto.  A&ntilde;ada una l&iacute;nea parecida a la
siguiente al fichero <em>/etc/nat.conf</em>:
</p>

<ul>
<pre>
rdr on fxp0 from any to any port 80 -&gt; 192.168.1.80 port 80
</pre>
</ul>

<p>
Desglosando esta l&iacute;nea para ver qu&eacute; signfica cada
componente de ella:
</p>

<ul>
<strong>&quot;rdr&quot;</strong>
<p>
Es la orden que le est&aacute; pasando a NAT.  Indica a NAT
que lo que viene a continuaci&oacute;n es una entrada para
redireccionar una conexi&oacute;n.
</p>
</ul>


<ul>
<strong>&quot;on fxp0&quot;</strong>
<p>
Es la interfaz de red que est&aacute; conectada a Internet.
</p>
</ul>

<ul>
<strong>&quot;from any to any&quot;</strong>
 <p>
Indica cu&aacute;l es la direcci&oacute;n IP que hay que
redireccionar (cualquiera de las que entren en fxp0, como se
indica anteriormente, con cualquier IP como destino).
</p>
</ul>

<ul>
<strong>&quot;port 80&quot;</strong>
<p>
&Eacute;ste es el puerto (80) entrante que debe ser
redireccionado.  El n&uacute;mero &laquo;80&raquo; no es
estrictamente necesario, tambi&eacute;n podr&iacute;a usar
&laquo;port www&raquo; para especificar una redirecci&oacute;n
del puerto 80.  Si desea usar un nombre en lugar de un
n&uacute;mero, el nombre del servicio y el puerto
correspondiente deben existir en el fichero
<em>/etc/services</em>.
</p>
</ul>

<ul>
<strong>&quot;192.168.1.80 port 80&quot;</strong>
<p>
La direcci&oacute;n IP de la m&aacute;quina LAN a la que son
redireccionados los paquetes.  N&oacute;tese que el puerto de
destino NO tiene porqu&eacute; coincidir con el puerto
entrante.  Por ejemplo, lo siguiente es v&aacute;lido e
incluso puede ser &uacute;til:
<pre>
rdr on fxp0 from any to any port 8080 -&gt; 192.168.1.35 port 80
</pre>
Esta l&iacute;nea redireccionar&iacute;a el tr&aacute;fico
entrante en el puerto 8080 a un servidor de <em>web</em> de
una m&aacute;quina en la red interna, en el puerto 80.
</p>
</ul>

<p>
Cuando haya terminado de a&ntilde;adir todos los datos, recargue las
reglas de NAT y el redireccionamiento comezar&aacute; de inmediato.
</p>

<p>
<strong>Denegaci&oacute;n</strong>
</p>

<p>
En ocasiones es necesario aplicar excepciones a una regla de
redireccionamiento de NAT.  Un ejemplo de esto ser&iacute;a
<em>AOL Instant Messenger</em>, que suele escabullirse de los
cortafuegos a trav&eacute;s de cualquier puerto disponible.
Es posible que ftp-proxy interfiera con AIM cuando decide
salir por el puerto remoto 21.  Si cree que esto puede ser
malo (muchas personas pierden bastante tiempo intentando
bloquear AIM), puede excluir las direcciones IP usadas por los
servidores AIM del tr&aacute;fico redireccionado por nuestra
l&iacute;nea de ftp-proxy anterior.  Para ello, use la
siguiente regla:

<ul>
<pre>
rdr on tl0 from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8081
</pre>
</ul>

Interpretaci&oacute;n: redireccionar el tr&aacute;fico que
entra en tl0 con direcci&oacute;n al puerto 21, pero NO por
64.12.163.199 (con el que los usuarios del servidor de AIM
ten&iacute;an problemas) al puerto 8081 del anfitri&oacute;n
local (en donde se supone que estar&aacute; esperando
ftp-proxy).  Pero le avisamos que existen muchos servidores de
AIM;  si le interesa esta aplicaci&oacute;n, es probable que
tenga que jugar con estas direcciones IP (64.12.0.0/16 puede
ser m&aacute; productiva, aunque es probable que
tambi&eacute;n interfiera con algunos sitios que no sean de
AOL).
</p>

<p>
<a name="nat3.4"></a>
<strong>NAT frente a proxy</strong>
</p>

<p>
La diferencia entre NAT y una aplicaci&oacute;n basada en
<em>proxy</em> es que el software de <em>proxy</em>
act&uacute;a como un intermediario entre Internet y las
m&aacute;quinas conectadas a la LAN.  En prinicipio esto no
presenta ning&uacute;n problema, sin embargo cada
aplicaci&oacute;n que quiera ejecutar en su m&aacute;quina y
conectarla a Internet a trav&eacute;s del servidor de
<em>proxy</em>, DEBE reconocer el <em>proxy</em> (ser capaz de
usarlo).  No todas las aplicaciones con capaces de esto (en
especial los juegos).  A&uacute;n m&aacute;s, no existen
aplicaciones para servidores de <em>proxy</em> para todos los
servicios de Internet.  NAT asigna su red interna de un modo
transparente, para que pueda conectar a Internet.  La
&uacute;nica ventaja de seguridad que proxy tiene sobre NAT es
que el software de <em>proxy</em> puede haber sido programado
para funciones de seguridad, y puede filtrar seg&uacute;n el
contenido con el fin de evitar que una macro de virus se
interne en su m&aacute;quina Windows, o proteger sus programas
contra desbordamientos de la memoria intermedia (<em>buffer
overflows</em>), y otros peligros.  El mantenimiento de estos
filtros es a menudo un trabajo muy pesado.
</p>

<p>
<a name="nat4.0"></a>
<strong>6.3.4 Enlaces y referencias</strong>
</p>

<p>
Ficheros de OpenBSD:
<ul>
<li><em>/etc/nat.conf</em> - fichero de reglas de NAT
<li><em>/etc/rc.conf</em> - fichero de configuraci&oacute;n
general de inicio del sistema que hay que editar para iniciar
NAT y PF durante el arranque del sistema
<li><em>/etc/sysctl.conf</em> - fichero para activar el
reenv&iacute;o de IP (<em>IP forwarding</em>)
</ul>
</p>

<p>
Enlaces de NAT en Internet:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">p&aacute;gina del manual de nat.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">p&aacute;gina del manual de pfctl</a>
<li><a href="http://www.geektools.com/rfc/rfc1631.txt">http://www.geektools.com/rfc/rfc1631.txt</a>
</ul>
</p>

<br>

<p> 
<a name="DHCP"></a>
<a name="6.4"></a>
<h2>6.4 - DHCP</h2>
</p>

<h3>6.4.1 Cliente DHCP</h3>

<p>
Para usar el cliente de DHCP que se incluye en OpenBSD, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&sektion=8">dhclient(8)</a>,
edite el fichero <em>/etc/hostname.xl0</em> (suponiendo que su interfaz
principal de ethernet sea xl0;  la suya podr&iacute;a ser ep0, o fxp0,
o cualquier otra).  Todo lo que necesita a&ntilde;adir a este fichero
es 'dhcp'.

<pre>
# <strong>echo dhcp &gt;/etc/hostname.xl0</strong>
</pre>

Esto har&aacute; que OpenBSD inicie el cliente DHCP
autom&aacute;ticamente durante el arranque.  OpenBSD obtendr&aacute; la
informaci&oacute;n sobre su direcci&oacute;n IP, pasarela, y servidores
de DNS desde el servidor de DHCP.

<p>
Si quiere iniciar un cliente dhcp desde la l&iacute;nea de
&oacute;rdenes, aseg&uacute;rese de que el fichero
<em>/etc/dhclient</em> existe, y entonces escriba:

<pre>
# <strong>dhclient fxp0</strong>
</pre>

en donde fxp0 es la interfaz en la que quiere recibir dhcp.

<p>
Sea cual fuere el modo en que inicie dhclient, puede
<strong>evitar</strong> que se actualice su DNS de acuerdo con
la idea que tenga el servidor dhcp sobre la DNS, comentando
las l&iacute;neas precedidas por 'request' (son ejemplos de la
configuraci&oacute;n predefinida, pero necesita activarlos
para anular la configuraci&oacute;n predefinida de dhclient)

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

y a continuaci&oacute;n <strong>eliminar</strong>
domain-name-servers.  Tambi&eacute;n es posible que
tambi&eacute;n desee anular hostname u otras configuraciones.

<p>
<h3>6.4.2 Servidor DHCP</h3>

Si quiere usar OpenBSD como servidor DHCP con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&sektion=8">dhcpd(8)</a>,
edite el fichero <em>/etc/rc.conf</em>.  Config&uacute;relo poniendo
dhcp_flags=&quot;-q&quot; en lugar de dhcp_flags=NO.  A&ntilde;ada en
<em>/etc/dhcp.interfaces</em> las interfaces en las que quiera que dhcp
est&eacute; <strong>a la escucha</strong>.

<pre>
# <strong>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</strong>
</pre>

y edite <em>/etc/dhcpd.conf</em>.  Las opciones son bastante claras:

<pre>
        option  domain-name &quot;xyz.mil&quot;;
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Con esto indicar&aacute; a sus clientes dhcp que el dominio
que deben a&ntilde;adir a sus requerimientos de DNS es xyz.mil
(as&iacute;, si un usuario escribiera 'telnet joe', los
enviar&iacute;a a joe.xyz.mil).  Les dirigir&aacute; a los
servidores de DNS 192.168.1.3 y 192.168.1.5.  Para los
anfitriones que se encuentren en la misma red que una interfaz
de ethernet en la m&aacute;quina de OpenBSD, que est&aacute;
en el rango 192.168.1.0/24, les asignar&aacute; una
direcci&oacute;n de IP entre 192.168.1.32 y 192.168.1.127,
configurando su pasarela por definici&oacute;n como
192.168.1.1.

<p>
Si quiere iniciar dhcpd desde la l&iacute;nea de &oacute;rdenes,
despu&eacute;s de editar <em>/etc/dhcpd.conf</em> intente lo siguiente:

<pre>
# <strong>dhcpd -q fxp0</strong>
</pre>

En donde fxp0 es la interfaz que Vd. desea que empiece a servir dhcp.
El indicador -q fuerza dhcpd en silencio, de otro modo es muy ruidoso.

<p>
Si est&aacute; actuando como servidor de DHCP para una m&aacute;quina
Windows, es posible que quiera que dhcp ofrezca al cliente una
direcci&oacute;n de servidor 'WINS'.  Para ello a&ntilde;ada la
siguiente l&iacute;nea al fichero <em>/etc/dhcpd.conf</em>:

<pre>
option	netbios-name-servers	192.168.92.55;
</pre>

En donde 192.168.92.55 es el IP de su servidor de Windows o Samba.
Para ver m&aacute;s opciones que puedan aceptar sus clientes DHCP, lea
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&sektion=5">dhcp-options(5)</a>.

<p>
<a name="PPP"></a>
<a name="6.5"></a>
<h2>6.5 - PPP </h2>
</p>

El &laquo;Protocolo Punto a Punto&raquo; es el que se suele usar para
crear una conexi&oacute;n con su ISP a trav&eacute;s de un
m&oacute;dem.  OpenBSD puede hacer esto de dos maneras:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<em>kernel</em>) del sistema.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> - Es el d&aelig;mon ppp del modo usuario.</li>
</ul>

<p>
Primero trataremos el d&aelig;mon del modo de usuario.  Para empezar
necesitar&aacute; algo de informaci&oacute;n sobre su isp.  He
aqu&iacute; una lista de la informaci&oacute;n que necesitar&aacute;:
</p>

<ul>
   <li>El n&uacute;mero de tel&eacute;fono de conexi&oacute;n de su
       proveedor (ISP)
   <li>Su <em>nameserver</em> (nombre del servidor) 
   <li>Su nombre de usuario y contrase&ntilde;a
   <li>Su pasarela (<em>gateway</em>)
</ul>

<p>
Parte de esta informaci&oacute;n no es estrictamente necesaria, pero
ser&aacute; de gran ayuda para configurar ppp.  El d&aelig;mon PPP de
modo usuario utiliza el fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
como fichero de configuraci&oacute;n.  Existen muchos ficheros en
<em>/etc/ppp</em> de gran utilidad, que pueden contener diferentes
ejemplos de configuraci&oacute;n para situaciones distintas.  Le
aconsejamos que mire en ese directorio.
</p>

<p>
En caso de no estar usando un n&uacute;cleo GENERIC, aseg&uacute;rese
de que tiene la siguiente l&iacute;nea en su fichero de
configuraci&oacute;n:
</p>

<ul><pre><strong>
pseudo-device   tun             2
</strong></pre></ul>


<h3>Configuraci&oacute;n inicial para PPP(8)</h3>

<p>
La configuraci&oacute;n inicial del d&aelig;mon PPP de modo usuario
consiste en editar su fichero <em>/etc/ppp/ppp.conf</em>.  Este fichero
no existe y debe ser creado, pero puede tomar el fichero
<em>/etc/ppp/ppp.conf.sample</em>, editarlo, y crear su propio fichero
<em>ppp.conf</em> a partir de ah&iacute;.  Aqu&iacute; empezar&eacute;
con la m&aacute;s simple, y probablemente m&aacute;s utilizada,
configuraci&oacute;n.  A continuaci&oacute;n puede ver un
peque&ntilde;o fichero <em>ppp.conf</em> que llevar&aacute; a cabo la
conexi&oacute;n con su ISP y usar&aacute; sus rutas predefinidas y su
<em>nameserver</em>.  Para este fichero, toda la informaci&oacute;n que
necesitar&aacute; ser&aacute; el n&uacute;mero de tel&eacute;fono de su
ISP, su nombre de usuario, y su contrase&ntilde;a.
</p>

<ul>
<pre>
default:
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</ul>

<p>
<strong>AVISO</strong> - En OpenBSD 2.6, el sistema se
lanz&oacute; con un fichero <em>/etc/ppp/ppp.conf.example</em>
que conten&iacute;a una configuraci&oacute;n err&oacute;nea
para el dispositivo.  El dispositivo era <strong>&quot;set
device /dev/cuaa0&quot;</strong> cuando en realidad
deb&iacute;a ser <em>/dev/cua00</em>, que corresponde al
dispositivo para el puerto de comunicaciones 1 (COM1).  Su
dispositivo podr&iacute;a no estar en COM1, a&uacute;n
as&iacute; este esquema era err&oacute;neo.
</p>

<p>
La secci&oacute;n en la opci&oacute;n
<strong>default:</strong> ser&aacute; ejecutada cada vez.  En
ella se configura toda la informaci&oacute;n cr&iacute;tica.
Con &quot;set log&quot; se configuran los niveles de ingreso.
Esto se puede cambiar;  para m&aacute;s informaci&oacute;n
sobre c&oacute;mo configurar los niveles de ingreso lea la
p&aacute;gina del manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>.
El dispositivo se configura con &quot;set device&quot;.
&Eacute;ste es el dispositivo en el que se encuentra el modem.
En este ejemplo el modem est&aacute; en el puerto de
comunicaciones 2 (COM2), mientras que el puerto de
comunicaciones 1 corresponder&iacute;a a <em>/dev/cua00</em>.
Con &quot;set speed&quot; se configura la velocidad de la
conexi&oacute;n por llamada, y con &quot;set dial&quot; se
configura los par&aacute;metros de la llamada.  Con esto se
puede cambiar el tiempo muerto, etc...  Es conveniente dejar
esta l&iacute;nea m&aacute;s o menos como est&aacute;.
</p>

<p>
A continuaci&oacute;n puede pasar a configurar la
informaci&oacute;n espec&iacute;fica para su ISP.  Para ello
debe a&ntilde;adir otra opci&oacute;n en la secci&oacute;n
<strong>default:</strong>.  Puede dar cualquier nombre a esta
etiqueta, pero lo m&aacute;s f&aacute;cil es darle el nombre
de su ISP.  En el ejemplo usaremos <strong>myisp:</strong>
para la opci&oacute;n que har&aacute; referencia a nuestro
ISP.  He aqu&iacute; una configuraci&oacute;n simple que
incorpora todo lo necesario para conectar:
<p>

<ul>
<pre>
myisp:
set phone 1234567   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
</pre>
</ul>

<p>
Aqu&iacute; hemos configurado informaci&oacute;n esencial para un ISP
espec&iacute;fico.  La primera opci&oacute;n, &quot;set phone&quot;, es
para configurar el n&uacute;mero de tel&eacute;fono para la
conexi&oacute;n de su ISP.  La opci&oacute;n &quot;set login&quot; es
para configurar sus opciones de ingreso.  En el ejemplo hemos puesto un
tiempo muerto de espera de 5, lo que significa que terminar&aacute;
nuestro intento de ingreso despu&eacute;s de 5 segundos su no hay
transportador.  De lo contrario esperar&aacute; hasta recibir un
&quot;login&quot; para enviar su nombre de usuario y contrase&ntilde;a.
En el ejemplo, tanto el nombre de usuario como la contraseña son
&quot;ppp&quot;.  Estos valores hay que substituirlos por otros reales.
La opci&oacute;n &quot;set timeout&quot; es para configurar el tiempo
de espera para todo el proceso de ingreso.  La opci&oacute;n &quot;set
ifaddr&quot; es algo complicada.  He aqu&iacute; una explicaci&oacute;n
m&aacute;s extensa sobre ella:
</p>

<ul><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></ul>

<p>
Hemos configurado la l&iacute;nea anterior con el formato
&quot;<strong>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeradr]]]]</strong>&quot;.  De este modo el primer IP que
se especifique es el que querremos como nuestro IP.  Sin tiene
una direcci&oacute;n IP est&aacute;tica, escr&iacute;bala
aqu&iacute;.  En el ejemplo hemos usado /0, que indica que no
es necesario que concuerde ning&uacute;n bit de esta
direcci&oacute;n ip, y que se puede substituir todo.  El
segundo IP que se especifique es el que esperamos como el IP
de nuestro ISP.  Si lo sabe lo puede especificar aqu&iacute;,
pero en la l&iacute;nea no sabemos cu&aacute;l se
asignar&aacute;, as&iacute; que dejaremos que nos lo digan.
Esto es muy &uacute;til al negociar con algunas
implementaciones PPP que no asignan un n&uacute;mero IP a
menos que su conexi&oacute;n les requiera ``0.0.0.0''.
</p>

<p>
La siguiente opci&oacute;n &quot;add default HISADDR&quot; es para
configurar la ruta predefinida a su IP.  Si su IP cambiara, la ruta se
actualizar&iacute;a de forma autom&aacute;tica.  Con &quot;enable
dns&quot; indicamos a nuestro ISP que autentifique nuestras direcciones
<em>nameservers</em>.  No haga esto si est&aacute; usando una DNS
local, ya que ppp circunvalar&aacute; su uso introduciendo algunas
l&iacute;neas en <em>/etc/resolv.conf</em>.
</p>

<h3>C&oacute;mo usar PPP(8)</h3>

<p>
Ahora que ya tenemos el fichero <em>ppp.conf</em> configurado, podemos
intentar una conexi&oacute;n con nuestro ISP.  A continuaci&oacute;n se
dar&aacute;n algunos detalles sobre argumentos de uso com&uacute;n con
ppp.
</p>

<ul>
   <li><em>ppp -auto myisp</em> 
       - Inicia ppp, configura sus interfaces, le conecta con su isp, y
       a continuaci&oacute;n pasa a un plano de fondo.
   <li><em>ppp -ddial myisp</em> 
       - Parecido a -auto, pero si su conexi&oacute;n cayera
       volver&iacute;a a conectar.
</ul>

<p>
Si usa <em>/usr/sbin/ppp</em> sin pasarle ninguna opci&oacute;n, le
pasar&aacute; al modo interactivo, desde donde podr&aacute;
interaccionar directamente con el m&oacute;dem.  De este modo puede
depurar problemas en su fichero <em>ppp.conf</em>.
</p>

<h3>Acciones adicionales con ppp(8)</h3>

<p>
Si necesitara ejecutar &oacute;rdenes al tiempo que conecta o
desconecta, puede hacerlo creando dos ficheros adicionales.
<em>/etc/ppp/ppp.linkup</em> y <em>/etc/ppp/ppp.linkdown</em>.
Puede ver ejemplos de configuraci&oacute;n para estos ficheros en:
</p>

<ul>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Puede encontrar m&aacute;s informaci&oacute;n en el
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <em>userppp</em> de la Gu&ieacute;a de FreeBSD</a>.
</p>

<p>
<a name="Tuning"></a>
<a name="6.6"></a>
<h2>6.6 - C&oacute;mo afinar par&aacute;metros de red</h2>
</p>

<h3>6.6.1 - &iquest;C&oacute;mo puedo forzar al n&uacute;cleo del
sistema para obtener un mayor n&uacute;mero de reintentos y tiempos de
espera mayores en las sesiones TCP?</h3>

Para problemas de conexi&oacute;n o enrutamiento puede usar lo
siguiente.  Tenga en cuenta que para que sea más efectivo, ambos lados
de la conexi&oacute;n deben usar valores similares.

<p>
Para forzarlo use <tt>sysctl</tt> e incremente los valores de:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

Si usa sysctl -a podr&aacute; ver los valores actuales de estos y
muchos otros par&aacute;metros.  Para cambiar cualquiera de ellos, use
<tt>sysctl -w</tt>, como por ejemplo en
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.

<h3>6.6.2 - &iquest;C&oacute;mo puedo activar emisiones dirigidas?</h3>

Por regla general no es aconsejable hacer esto, ya que si su sistema
OpenBSD es un enrutador, permite que puedan enviar tr&aacute;fico a la
direcci&oacute;n o direcciones de emisi&oacute;n de sus redes.

<p>
En algunos casos, como en redes cerradas, puede tener cierta utilidad,
en particular cuando est&eacute; usando implementaciones antiguas del
protocolo NetBIOS.  Se puede activar con <tt>sysctl -w
net.inet.ip.directed-broadcast=1</tt>.  Para saber porqu&eacute; se
encuentra desactivado por definici&oacute;n, inf&oacute;rmese sobre
<a href="http://www.netscan.org">ataques <em>&quot;smurf&quot;</em></a>.

<h3>6.6.3 - No quiero que el n&uacute;cleo haga asignaciones
din&aacute;micas de ciertos puertos</h3>

Tambi&eacute;n existe un sysctl para esto.  De la p&aacute;gina del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>:

<pre>
A&ntilde;ada la lista de puertos TCP que no deber&iacute;an ser
asignados din&aacute;micamente por el n&uacute;cleo.  Esto se puede
usar para evitar que algunos d&aelig;mons se apropien de un puerto
espec&iacute;fico que sea necesario para el funcionamiento de otro
programa.  La lista de elementos puede ir separada por comas y/o
espacios en blanco.

   sysctl -w net.inet.tcp.baddynamic=749,750,751,760,761,871

Tambi&eacute;n se pueden a&ntilde;adir o eliminar puertos de la lista
actual.

   sysctl -w net.inet.tcp.baddynamic=+748
   sysctl -w net.inet.tcp.baddynamic=-871
</pre>

<p>
<a name="NFS"></a>
<a name="6.7"></a>
<h2>6.7 - Uso simple de NFS</h2>
</p>

<p>
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <em>Network
File System</em>) se usa para compartir un sistema de archivos
en una red.  Algunas p&aacute;ginas de manual que
deber&iacute;a leer antes de que intente configurar un
servidor de NFS son:
</p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>
</ul>

<p>
En esta secci&oacute;n se detallar&aacute;n los pasos para una
configuraci&oacute;n simple de NFS.  El ejemplo ofrece detalles sobre
un servidor en una LAN, con clientes que tengan acceso NFS en la LAN.
En esta secci&oacute;n no se tratar&aacute; sobre la seguridad de NFS.
Asumiremos que Vd. ya ha configurado su paquete de filtros, u otra
protecci&oacute;n como cortafuegos, para prevenir el acceso desde el
exterior.  Si su configuraci&oacute;n permite el acceso desde el
exterior a su servidor de NFS, y si tiene alg&uacute;n tipo de datos
confidenciales o importantes, le recomendamos encarecidamente que haga
uso de <a href="faq13.html">IPsec</a>.  De otro modo existe la
posibilidad de que extra&ntilde;os puedan ver su tr&aacute;fico NFS.
Tambi&eacute;n ser&iacute;a posible que alguien pretendiera estar en la
direcci&oacute;n IP que tenga autorizada la entrada en su servidor NFS.
Existen varios tipos de ataques efectivos en este aspecto.  Cuando
IPsec est&aacute; correctamente configurado, protege contra todos estos
tipos de ataques.
</p>

<p>
Otra nota importante sobre seguridad.  No se limite a
a&ntilde;adir un sistema de archivos a <em>/etc/exports</em>
sin alg&uacute;n tipo de lista de anfitriones autorizados.
Sin una lista de anfitriones que puedan montar un directorio
particular, cualquiera que pueda llegar a su
anfitrionesodr&aacute; montar sus directorios de NFS en
<em>exports</em>.
</p>

<p>
La configuraci&oacute;n consiste en un servidor con el ip
<strong>10.0.0.1</strong>, que servir&aacute; NFS s&oacute;lo
a clientes dentro de esa red.  El primer paso para configurar
NFS es configurar su fichero <em>/etc/exports</em>.  Este
fichero se compone de una lista con los sistemas de archivo
que quiera que se encuentren accesibles por medio de NFS, y
define qui&eacute;n puede acceder a cada uno de ellos.
Existen muchas opciones que puede usar en su fichero
<em>/etc/exports</em>, y es conveniente leer la p&aacute;gina
del manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>.
En este ejemplo empezaremos con un fichero
<em>/etc/exports</em> como el siguiente:
</p>

<ul>
<pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre>
</ul>

<p>
Esto quiere decir que el sistema de archivo local
<em>/work</em> estar&aacute; disponible por medio de NFS.
<strong>-alldirs</strong> indica que los clientes
podr&aacute;n montar en cualquier parte del punto de montaje
<em>/work</em>.  <strong>-ro</strong> indica que s&oacute;lo
se permitir&aacute; montarlo en modo de s&oacute;lo lectura.
Los dos &uacute;ltimos argumentos indican que s&oacute;lo los
clientes dentro de la red 10.0.0.0 que usen una m&aacute;scara
de red 255.255.255.0, estar&aacute;n autorizados a montar este
sistema de archivo.  Esto es importante en algunos servidores
accesibles desde diferentes redes.
</p>

<p>
Una vez que su fichero <em>/etc/exports</em> haya sido
configurado, puede seguir adelante y configurar su servidor
NFS.  Primero deber&iacute;a asegurarse de que las opciones
NFSSERVER y NFSCLIENT se encuentren en la configuraci&oacute;n
del n&uacute;cleo de su sistema (el n&uacute;cleo GENERIC
incluye estas opciones).  A continuaci&oacute;n debe
configurar <strong>nfs_server=YES</strong> en el fichero
<em>/etc/rc.conf</em>.  De este modo, cuando reinicie el
sistema, se activar&aacute;n nfsd(8) y mountd(8).  Ahora ya
puede continuar e iniciar los d&aelig;mons Vd. mismo.  Estos
d&aelig;mons deben ser iniciados por root, y debe asegurarse
de que portmap(8) se encuentre funcionando en su sistema.  El
ejemplo que sigue sobre c&oacute;mo iniciar nfsd(8) sirve
tanto para TCP como para UDP usando 4 d&aelig;mons.  Para
gestionar el m&aacute;ximo n&uacute;mero de requerimientos de
clientes concurrentes a los que quiera dar servicio, debe
activar un n&uacute;mero apropiado de d&aelig;mons del
servidor NFS.

<p>

<ul>
<pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre>
</ul>

<p>
No s&oacute;lo debe iniciar el servidor nfsd(8), sino que
tambi&eacute;n necesita iniciar mountd(8).  &Eacute;ste es el
d&aelig;mon que da servicio a los requerimientos para montar en NFS.
Para iniciar mountd(8), aseg&uacute;rese de que exista un
fichero vac&iacute;o <em>mountdtab</em> e invoque el
d&aelig;mon:
<p>

<ul>
<pre>
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
</pre>
</ul>

<p>
Si hace alg&uacute;n cambio al fichero <em>/etc/exports</em> mientras
NFS est&eacute; funcionando, tendr&aacute; que avisar a mountd sobre el
cambio pas&aacute;ndole una se&ntilde;al &quot;HUP&quot;:

<ul>
<pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre>
</ul>

<p>

<h3>Comprobaci&oacute;n de estad&iacute;sticas en NFS</h3>

<p>
Puede llevar a cabo comprobaciones para asegurarse de que estos
d&aelig;mons est&eacute;n funcionando y registrados con RPC.  Para ello
use rcpinfo(8).

<p>

<ul>
<pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre>
</ul>

<p>
Durante su uso normal, existen unas pocas utilidades más que le
permitir&aacute;n ver lo que est&aacute; ocurriendo con NFS.  Una de
ellas es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8">showmount(8)</a>
que le permite ver qu&eacute; se encuentra montado y qui&eacute;n lo
est&aacute; montando.  Tambi&eacute;n est&aacute; nfsstat(8), que
muestra una informaci&oacute;n de las estad&iacute;sticas mucho
m&aacute;s amplia.  Para usar showmount(8) escriba
<strong>/usr/bin/showmount -a host</strong>.  Por ejemplo:

<p>

<ul>
<pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre>
</ul>

<h3>C&oacute;mo montar sistemas de archivo NFS</h3>

<p>
Los sistemas de archivo NFS se deben montar mediante mount(8),
o m&aacute;s exactamente mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8">mount_nfs(8)</a>.
Para montar un sistema de archivo <em>/work</em> del
anfitri&oacute;n 10.0.0.1 en un sistema de archivo local
<em>/mnt</em>, haga lo siguiente (no necesita usar una
direcci&oacute;n IP, mount se encargar&aacute; de la
resoluci&oacute;n de nombres):
<p>

<ul>
<pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre>
</ul>

<P>
Para que el sistema se monte al iniciar, a&ntilde;ada una algo como lo
que ve a continuaci&oacute;n en su fichero <em>/etc/fstab</em>:

<p>

<ul>
<pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre>
</ul>

<p>
&iexcl;&iexcl;Es importante que use <tt>0 0</tt> al final de esta
l&iacute;nea para que su m&aacute;quina no intente ejecutar fsck sobre
el sistema de archivo NFS durante el inicio del sistema!!  El resto de
opciones de seguridad t&iacute;picas como noexec, nodev, y nosuid,
tambi&eacute;n deber&iacute;an usarse donde sean posibles, como en:

<p>

<ul>
<pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre>
</ul>

<p>
De este modo ning&uacute;n dispositivo o programa setuid en el servidor
NFS podr&aacute; traspasar las medidas de seguridad en el cliente NFS.
Si no est&aacute; montando programas para ejecutarlos en el cliente
NFS, a&ntilde;ada noexec a esta lista.


<p>
<a name="DNS"></a>
<a name="6.8"></a>
<h2>6.8 - Servicio de Nombres de Dominio  - DNS, BIND, y
named</h2>
</p>

<h3>6.8.1 &iquest;Qu&eacute; es DNS?</h3>

<p>
El &laquo;Servicio de Nombres de Dominio&raquo; (DNS, &quot;Domain Name
Service&quot;) es una facilidad de red que permite a los dominios de
redes IP proveer resoluciones de direcciones nombre-a-IP y resoluciones
direcci&oacute;n-a-nombre en respuesta a un requerimiento.  Su
instalaci&oacute;n de OpenBSD est&aacute; configurada por
definici&oacute;n como un cliente de DNS, pero no como un servidor de
DNS.  O sea, su instalaci&oacute;n de OpenBSD puede llevar a cabo un
requerimiento de DNS para la direcci&oacute;n de una m&aacute;quina 
contra un servidor de nombres de dominio, pero no puede responder a uno
de esos requerimientos de DNS de por s&iacute; a menos que la configure
para ello.

<p>
Mi m&aacute;quina con OpenBSD est&aacute; conectada
actualmente a Internet a trav&eacute;s de mi proveedor (ISP,
<em>Internet Service Provider</em>), y por lo tanto puedo usar
la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a>
para ejecutar el requerimiento de DNS:

</p>

<ul>
<pre>
$ <strong>nslookup www.openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre>
</ul>

<p>
<strong>165.87.201.244</strong> es el nombre del servidor que
ha contestado, porque es el &laquo;nombre de servidor&raquo;
(<em>nameserver</em>) que mi ISP me dijo que usara con mi
cuenta, y cuyo n&uacute;mero se introduce en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>.
Pero la respuesta no fue autorizada.  Para una respuesta
autorizada, investiguemos cu&aacute;l es el servidor de DNS
autorizado para el dominio <em>openbsd.org</em>, y
pregunt&eacute;mosle por la direcci&oacute;n de
<em>www.openbsd.org</em>:
</p>

<ul>
<pre>
# Identificar el nombre de los servidores de openbsd.org
# con la ayuda del nombre del servidor de mi ISP.
$ <strong>nslookup -type=NS openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# Usar la informaci&oacute;n conseguida para requerir una
# resoluci&oacute;n autorizada:
# requerir la autorizaci&oacute;n zeus.theos.com.
$ <strong>nslookup www.openbsd.org zeus.theos.com</strong>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre>
</ul>

<p>
<em>zeus.theos.com</em> es, como puede suponer, una m&aacute;quina que
funciona con OpenBSD y que est&aacute; correctamente configurada para
ser un servidor de DNS para el dominio <em>openbsd.org</em>.
</p>

<a name="DNS.1.1"></a>
<h3>6.8.1.1 &iquest;D&oacute;nde puedo aprender todo sobre DNS y su
implementaci&oacute;n en OpenBSD?</h3>

<ul>
<li>Lea los RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, y <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> 
para m&aacute;s informaci&oacute;n sobre el sistema de nombres de
dominio en Internet.</li>
<li>Lea el libro de O'Reilly Associates<em><a href="../../es/books.html#6">DNS and BIND</a></em>.</li>
<li>Lea las <a href="http://www.openbsd.org/cgi-bin/man.cgi">p&aacute;ginas de manual de OpenBSD</a>,
en especial las p&aacute;ginas de</li>
   <ul>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3&format=html">gethostbyname(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8&format=html">named(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3&format=html">resolver(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5&format=html">resolver(5)</a>
   </ul>
</ul>

<p>
La orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
es epecialmente &uacute;til porque puede requerir un dominio y devolver
la informaci&oacute;n pr&aacute;cticamente en el mismo formato
requerido por los ficheros de configuraci&oacute;n de BIND.  Puede usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
para examinar nombres de servidores que sepa que est&aacute;n operando
correctamente para comparar su configuraci&oacute;n con la de ellos.
</p>

<h3>6.8.2 &iquest;Necesita mi m&aacute;quina ser un servidor de nombres
de dominio?</h3>

<p>
Si no est&aacute; seguro de si necesita que su m&aacute;quina haga el
papel de servidor de DNS, no la configure de ese modo.  La
instalaci&oacute;n de OpenBSD no activa su m&aacute;quina como servidor
de nombres de dominio por definici&oacute;n, aunque todos los ficheros
necesarios se encuentran instalados.  Para la mayor&iacute;a de
estaciones de trabajo, es suficiente con los ficheros
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a>
para indicar las direcciones IP de la m&aacute;quinas locales y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>
para indicar qu&eacute; servidores de DNS le har&aacute;n el servicio
en la intranet o internet.
</p>

<p>
Por otra parte, podr&iacute;a necesitar configurar su m&aacute;quina
como un servidor de nombres de dominio:

<ul>
<li>Si tiene una LAN IP en la que no quiere replicar los
ficheros &quot;hosts&quot; de direcciones locales en cada
m&aacute;quina, puede configurar su m&aacute;quina con OpenBSD
como servidor de DNS y servir los requerimientos de otras
m&aacute;quinas de su LAN.</li>

<ul>
<li><strong>Nota:</strong> No existen restricciones en la
pr&aacute;ctica al n&uacute;mero de servidores de DNS en una
LAN.  Cualquier m&aacute;quina o todas las de la LAN puede
ofrecer el servicio de DNS si se configuran para ello.  Que
uno de estos servidores se considere autorizado desde fuera de
su LAN (o incluso conocido desde fuera de la LAN), es un
factor de configuraci&oacute;n que suele estar controlado por
el nivel superior inmediato de su LAn en la jerarqu&iacute;a
de dominios.</li>
</ul>

<li>Si tiene una LAN IP en la que residen m&aacute;quinas que
quiera que sean localizables a trav&eacute;s de requerimientos
de DNS por m&aacute;quinas en otra LAN o WAN.</li>

<li>Si tiene dificultades en resolver el nombre de dominio
local a una direcci&oacute;n IP, o resolver cualquier otro
nombre local a direcciones IP aunque tenga los ficheros
<em>/etc/hosts</em> y <em>/etc/resolv.conf</em> correctamente
(v.g., en OpenBSD, Netscape a veces se comporta de este modo
porque implementa su propia herramienta de resoluci&oacute;n,
en lugar de usar <em>gethostbyname(3)</em> para la
b&uacute;squeda de direcciones).</li>
</ul>

<p>
Algo m&aacute;s a tener en cuenta es el velocidad de ejecuci&oacute;n.
Como la resoluci&oacute;n de nombres es un proceso repititivo, en el
que el servidor de nombres lleva a cabo repetidos requerimientos de
direcciones en dominios remotos a otros servidores de nombres, la
resoluci&oacute;n de nombres puede tardar algo m&aacute;s si tiene una
conexi&oacute;n por m&oacute;dem a Internet y est&aacute; requiriendo
direcciones remotas a su propio servidor de DNS (que har&aacute;
continuos requerimientos a servidores de nombres remotos a
trav&eacute;s del m&oacute;dem) que si est&aacute; requiriendo el
servidor de nombres de su ISP (que probablemente tenga una
conexi&oacute;n m&aacute;s r&aacute;pida a los servidores de nombres
remotos).
</p>

<h3>6.8.3 &iquest;Cu&aacute;les son los componentes de software del
servidor de DNS?</h3>

<ul>
<li>named <em>(``d&aelig;mon de name'')</em></li>
<li>Los ficheros de configuraci&oacute;n en el directorio bajo la
    jerarqu&iacute;a de <em>/var/named/</em></li>
</ul>

<h4>6.8.3.1 &iquest;Qu&eacute; nivel de BIND tiene soporte?</h4>

<p>
BIND es el nombre de la especificaci&oacute;n del comportamiento de un
servidor de nombres de dominio.  Los componentes de DNS existen para
implementar BIND de forma colectiva.
</p>

<p>
Existen tres especificaciones BIND diferentes:

<ol>
<li>BIND 4</li>
<li>BIND 8</li>
<li>BIND 9</li>
</ol>

<p>
Tal y como queda instalado, OpenBSD <strong>named</strong>
tiene soporte para BIND 4.x.

<h4>6.8.3.2 &iquest;Cu&aacute;les son algunas de las alternativas a
proveer DNS a trav&eacute;s de la implementaci&oacute;n predefinida de
BIND 4.x?</h4>

<ul>
<li>La implementaci&oacute;n de BIND 9.x en
<em>/usr/ports/net/bind9</em> (v&eacute;ase la p&aacute;gina
sobre <a href="../../es/ports.html">portes</a>).</li>
</ul>

<h5>6.8.3.2.1 Nota de <u>Seguridad</u></h5>

<p>
Si usa estas implementaciones alternativas del DNS, estar&aacute;
ofreciendo un servicio de red cr&iacute;tico mediante el uso de unos
programas que pueden no haber sido sometidos al mismo nivel de
escrutinio que el d&aelig;mon de <code>name</code> en la
instalaci&oacute;n base, <strong><code>named</code></strong>, el cual
ha pasado una <a href="../../es/security.html">auditor&iacute;a de
seguridad</a>.  Esta es una consideraci&oacute;n a tener muy en cuenta,
ya que si un servidor de nombres de dominio es puesto en peligro, los
resolucionadores que usen ese servidor de DNS pueden ser
redireccionados al sitio de un impostor.
</p>

<h3>6.8.4 &iquest;Cu&aacute;nto tengo que instalar?</h3>

<p>
Si la configuraci&oacute;n predefinida de la red se instal&oacute;
correctamente durante la instalaci&oacute;n de OpenBSD, tendr&aacute;
todo ya instalado.  S&oacute;lo tiene que configurar el d&aelig;mon de
name (&quot;named&quot;).
</p>

<h3>6.8.5 &iquest;C&oacute;mo configuro DNS?</h3>

<p>
Para configurar DNS en OpenBSD, edite y/o cree los ficheros que
controlan el d&aelig;mon de <code>name</code>, <strong>named</strong>.
La ubicaci&oacute;n por definici&oacute;n de estos ficheros es el
directorio <em>/var/named</em> y sus subdirectorios, en especial el
fichero <em>/var/named/named.boot</em> que es el fichero de
inicializaci&oacute;n para <strong>named</strong>.  Tambi&eacute;n hay
un par m&aacute;s de pasos para la configuraci&oacute;n que se deben
llevar a cabo en <em>/etc</em>.
</p>

<p>
En este documento configuraremos el d&aelig;mon de name en
<em>nemo.yewtopia.com</em> como el nombre nombre primario del servidor
para el dominio (&iexcl;muy peque&ntilde;o!) <em>yewtopia.com</em>.  La
direcci&oacute;n de <em>nemo.yewtopia.com</em> es <em>192.168.1.9</em>.
Otras dos m&aacute;quinas en esa subrred son
<em>crater.yewtopia.com</em> en 192.168.1.1 y
<em>earhart.yewtopia.com</em> en 192.168.1.2.
</p>

<h4>6.8.5.1 Configuraci&oacute;n en <em>/var/named</em></h4>

<h5>6.8.5.1.1 <em>/var/named/named.boot</em></h5>

<ul>
<pre>
; tell what subdir has the lookup database files
directory       /namedb

; type    domain   source host/file backup file
cache     .	   root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; example primary server config:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
</pre>
</ul>

<p>
Esto indica al proceso de inicializaci&oacute;n en qu&eacute;
subdirectorio y bajo qu&eacute; nombres encontrar&aacute; los ficheros
de configuraci&oacute;n de <em>yewtopia.com</em>.

<h5>6.8.5.1.2 <em>/var/named/namedb/localhost.rev</em></h5>

<ul>
<pre>
; Reverse lookup for localhost interface
@       IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
</pre>
</ul>

<h5>6.8.5.1.3 <em>/var/named/namedb/yewtopia</em></h5>

<ul>
<pre>
; yewtopia.com domain database
yewtopia.com.        IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Addresses
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre>
</ul>

<h5>6.8.5.1.4 <em>/var/named/namedb/yewtopia.rev</em></h5>

<ul>
<pre>
; yewtopia domain reverse lookup database
1.168.192.in-addr.arpa. IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Addresses
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre>
</ul>

<h4>6.8.5.2 Configuraci&oacute;n en <em>/etc</em></h4>

<h5>6.8.5.2.1 <em>/etc/resolv.conf</em></h5>

<p>
Aseg&uacute;rese de que <em>/etc/resolv.conf</em> ahora se&ntilde;ale
al dominio de la m&aacute;quina local (en vez de, por ejemplo, el
nombre del servidor de su ISP), de modo que la resoluci&oacute;n del
nombre en requerimientos sea enviada al
<strong>named</strong> que haya configurado.
</p>

<ul>
<pre>
domain yewtopia.com
lookup file bind
</pre>
</ul>

<h4>6.8.5.2.2 <em>/etc/hosts</em></h4>

<p>
Si anteriormente hubiera a&ntilde;adido las direcciones de varias
m&aacute;quinas al fichero <em>/etc/hosts</em>, puede que le interese
acortar su fichero <em>/etc/hosts</em> al estado en que se encontraba
por definic&oacute;n
</p>

<ul>
<pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre>
</ul>

<p>
de modo que <strong>named</strong> no sea circunvalado en favor de
direcciones (probablemente caducadas) en el fichero
<em>/etc/hosts</em>.  &iexcl;<u>Aseg&uacute;rese de que tiene al menos
la entrada predefinida de <em>localhost</em></u>, o su red no
iniciar&aacute; correctamente!  Note tambi&eacute;n que <em>nemo</em>
debe aparecer en su propio fichero hosts, o de lo contrario ver&aacute;
un mensaje de error (no da&ntilde;ino) durante el arranque cuando
<em>/etc/netstart</em> invoque
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>
para a&ntilde;adir <em>nemo</em> (cuyo nombre aparece en
<em>/etc/myname</em>).
</p>

<h4>6.8.5.3 C&oacute;mo usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
para examinar los resultados.</h4>

<ul>
<pre>
$ <strong>dig @nemo.yewtopia yewtopia any any</strong>

; &lt;&lt;&gt;&gt; DiG 2.2 &lt;&lt;&gt;&gt; @nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia, type = ANY, class = ANY

;; ANSWERS:
yewtopia.        3600   SOA     nemo.yewtopia.
your_id.nemo.yewtopia. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.        3600   NS      nemo.yewtopia.

;; ADDITIONAL RECORDS:
nemo.yewtopia.   3600   A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre>
</ul>

<h3>6.8.6 &iquest;C&oacute;mo y cu&aacute;ndo inicio y paro DNS?</h3>

<h4>6.8.6.1 C&oacute;mo iniciar DNS</h4>

<p>
El d&aelig;mon de name <strong>named</strong> se lanza durante el
inicio del sistema desde
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a>
si la l&iacute;nea instalada por definici&oacute;n en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a>.
</p>

<ul>
<pre>
named_flags=NO          # para uso normal: &quot;&quot;
</pre>
</ul>

<p>
se cambia a
</p>

<ul>
<pre>
named_flags=&quot;&quot;          # para uso normal: &quot;&quot;
</pre>
</ul>

<p>
Examine tambi&eacute;n estas l&iacute;neas en <em>/etc/rc.conf</em>:
</p>

<ul>
<pre>
named_user=named                # named no deber&iacute;a ejecutarse como root a menos que fuera necesario
named_chroot=/var/named         # D&oacute;nde chroot named si no est&aacute; vac&iacute;o
</pre>
</ul>

<p>
Estos valores predefinidos ser&aacute;n v&aacute;lidos para casi todas
las configuraciones.
</p>

<p>
Para iniciar <strong>named</strong> de forma manual, use la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>
Por ejemplo:
</p>

<ul>
<pre>
# <strong>ndc start</strong>
          o
# <strong>ndc restart</strong>
</pre>
</ul>

<h4>6.8.6.2 C&oacute;mo parar DNS</h4>

<p>
El mejor modo de parar el d&aelig;mon de <code>name</code> es usando la
orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.
Por ejemplo:
</p>

<ul>
<pre>
# <strong>ndc stop</strong>
</pre>
</ul>

<p>
Si no funcionara, encuentre el id del proceso de <strong>named</strong>
y use la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1">kill(1)</a>
para finalizar el proceso.  El PID para <strong>named</strong> mientras
est&eacute; funcionando se encontrar&aacute; como la primera
l&iacute;nea del fichero <em>/var/named/named.pid</em>.
</p>

<ul>
<pre>
# <strong>cat /var/named/named.pid</strong>
4608
named -t /var/named -u named
# <strong>kill -KILL 4608</strong>
</pre>
</ul>

<h4>6.8.6.3 C&oacute;mo reiniciar DNS con una
configuraci&oacute;n alterada</h4>

<p>
Para hacer que un proceso en funcionamiento del d&aelig;mon de name se
reinicie recargando su configuraci&oacute;n despu&eacute;s de haberle
hecho cambios, env&iacute;e una se&ntilde;al <em>hangup</em>:
</p>

<ul>
<pre>
# <strong>kill -HUP 4608</strong> 
</pre>
</ul>

<p>
o use la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.
Por ejemplo:
</p>

<ul>
<pre>
# <strong>ndc reload</strong>
</pre>
</ul>

<h3>6.8.7 &iquest;C&oacute;mo bloqueo los requerimientos AXFR?</h3>

<p>
ejemplo:

<ul>
<pre>
garden:/home/jeremy$<strong>  host -l openssh.com</strong>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre>
</ul>

<p>
Esta informaci&oacute;n es &uacute;til para depurar DNS, pero en
algunos casos puede que no le interese que esta informaci&oacute;n se
haga p&uacute;blica.  Si est&aacute; usando in-addr(rfc2317) sin clase
para inverso, &iexcl; 'host -' podr&iacute;a informar sobre todos los
dominios hospedados en su sistema!  Esto se puede solucionar
f&aacute;cilmente con la cl&aacute;usula 'allow-transfer' en su fichero
<em>zone</em>.
<br><br>
Si usa Bind8 necesitar&aacute; especificar los anfitriones a los
que quiere permitir la transferencia de zonas en su(s) fichero(s)
individual zone:

<ul>
<pre>
zone "foo.com" in {
        type master;
        file "directory/zonefile";
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre>
</ul>

Tambi&eacute;n puede bloquear las transferencias para todos los
dominios editando <em>/var/named.conf</em> y a&ntilde;adi&eacute;ndo el
par&aacute;metro 'allow-transfer' a la secci&oacute;n 'options' del
fichero de configuraci&oacute;n:

<ul>
<pre>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre>
</ul>

El m&eacute;todo para Bind8 tambi&eacute;n funciona para Bind9.<br>
Si est&aacute; usando Bind 4 (predefinido en OpenBSD), puede editar
<em>/var/named/named.boot</em> y usar la opci&oacute;n 'xfrnets'.<br>

<ul>
<pre>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre>
</ul>

Bind 4 permite transferencias desde clases enteras, por lo que no es
tan exacto.  Generalmente, los &uacute;nicos anfitriones que
necesitan llevar a cabo transferencias son los esclavos y
anfitriones de DNS desde los que quiera depurar (127.0.0.1 es
normalmente un buen anfitri&oacute;n desde donde permitir
transferencias).  El bloqueo de requerimientos AXFR a&ntilde;ade un
nivel adicional de privacidad, pero puede entorpecer el &uacute;til
depurado de DNS (gracias a 
<a href="mailto:ntang@nachtwache.org">Nicholas Tang</a> por este
consejo).
</p>


<h3>6.8.7 &iquest;Qu&eacute; ha quedado en el tintero sobre la
configuraci&oacute;n de DNS?</h3>

<p>
Hay muchas cosas de las que no hemos hablado, como por ejemplo,
c&oacute;mo configurar DNS para que los requerimientos para dominios de
intranet que no sean visibles desde la ra&iacute;z de la
jerarqu&iacute;a del dominio dependan de servidores dentro de su
empresa.  Lea los <a href="#DNS.1.1">documentos que le recomendamos</a>
para m&aacute;s informaci&oacute;n sobre DNS.
</p>

<p>
<a name="PPTP"></a>
<a name="6.9"></a>
<h2>6.9 - Configuraci&oacute;n de una conexi&oacute;n PPTP en
OpenBSD</h2>
</p>

<p>
<strong>NOTA:</strong> Esta informaci&oacute;n no es v&aacute;lida para
<strong>TODOS</strong> los proveedores de conexiones ADSL, pero mucha
de la informaci&oacute;n que encontrar&aacute; aqu&iacute; se puede
usar como base.  Esta informaci&oacute;n s&oacute;lo se ha comprobado
con <a href="http://www.inode.at">Inode</a>, un proveedor de ADSL en
Austria.
</p>

<p>
Antes que nada debe instalar pptp.  Existe un porte de pptp en
el &aacute;rbol de portes de OpenBSD que fue a&ntilde;adido A
PARTIR de la versi&oacute;n 2.8 de OpenBSD, y que se instala y
funciona bien desde el mismo &aacute;rbol.  Lo puede encontrar
en <em>/usr/ports/net/pptp</em>.  Para m&aacute;s
informaci&oacute;n sobre el &aacute;rbol de portes de OpenBSD,
lea la secci&oacute;n sobre los <a href="faq8.html#Ports">portes
del cap&iacute;tulo 8</a>.
</p>

<p>
Debido a un conflicto entre el soporte integrado en el n&uacute;cleo de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre(4)</a>
y pptp, tendr&aacute; que recompilar el n&uacute;cleo del sistema,
eliminando el soporte de gre(4).
</p>

<ul>Parche para eliminar el soporte de GRE(4).
<pre>
Index: sys/conf/GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.66
diff -u -r1.66 GENERIC
--- sys/conf/GENERIC    2000/10/13 04:21:14     1.66
+++ sys/conf/GENERIC    2000/12/26 19:55:31
@@ -97,6 +97,6 @@
 pseudo-device  ksyms   1	# kernel symbols device
 pseudo-device  bridge  2	# network bridging support
 #pseudo-device vlan    2	# IEEE 802.1Q VLAN
-pseudo-device  gre     1	# GRE encapsulation interface
+#pseudo-device gre     1	# GRE encapsulation interface

 option		BOOT_CONFIG     # add support for boot -c
</pre>
</ul>

<p>
Para recompilar el n&uacute;cleo, obtenga antes la
distribuci&oacute;n 2.8-stable de OpenBSD mediante cvs (lea la
p&aacute;gina de <a href="../../es/stable.html">OpenBSD
Stable</a> para m&aacute;s informaci&oacute;n), aplicar el
parche anterior al fichero de configuraci&oacute;n del
n&uacute;cleo, <em>GENERIC</em>, y recompilar el n&uacute;cleo
tal y como se describe en la secci&oacute;n sobre la
<a href="faq5.html#Building">compilaci&oacute;n de
n&uacute;cleos</a> del cap&iacute;tulo 5.
</p>

<p>
Una vez que ya tenga instalado el paquete
<strong>pptp</strong> y el nuevo n&uacute;cleo, deber&aacute;
editar unos cuantos ficheros para configurar su
conexi&oacute;n.  Este paquete utiliza el programa de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>
nativo de OpenBSD;  si est&aacute; familiarizado con ppp(8),
gran parte de la configuraci&oacute;n es id&eacute;ntica.  Lea
tambi&eacute;n la secci&oacute;n sobre <a href="#PPP">PPP</a>
de este documento.
</p>

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Para el fichero <em>/etc/ppp/options</em>, una configuraci&oacute;n
como la siguiente ser&aacute; probablemente todo lo que necesite:
</p>

<ul>
<pre>
# <strong>cat /etc/ppp/options</strong>
name &quot;LOGINNAME&quot;
noauth
noipdefault
defaultroute
debug
</pre>
</ul>

<p>
Debe substituir <tt>LOGINNAME</tt> con su identificador de usuario.
</p>

<p>
Para el fichero <em>/etc/ppp/pap-secrets</em> necesitar&aacute; una
l&iacute;nea como &eacute;sta:

<ul>
<pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre>
</ul>

<p>
En donde LOGINNAME es su identificador de usuario y PASSWORD su
contrase&ntilde;a.  10.0.0.138 es la direcci&oacute;n IP asignada a su
modem en caso de que use ADSL, etc.  Aseg&uacute;rese de que este
fichero sea de &laquo;s&oacute;lo lectura&raquo; para el usuario
&quot;root&quot; (modo 600).
</p>

<h3>6.9.1 - Asignaci&oacute;n de una direcci&oacute;n a su interfaz de
red</h3>

<p>
En el ejemplo anterior, el modem ven&iacute;a con una interfaz
10.0.0.38 preconfigurada.  Pero ahora necesitaremos asignar
una direcci&oacute;n a NUESTRA interfaz.  Lo mejor es escoger
una direcci&oacute;n IP cercana a la asignada para el MODEM, o
usar la direcci&oacute;n IP est&aacute;tica que nos hayan
asignado.  Puede leer m&aacute;s sobre c&oacute;mo configurar
interfaces en la secci&oacute;n sobre
<a href="#Setup">configuraci&oacute;n</a> en este documento.
</p>

<p>
Una vez que haya configurado su interfaz, deber&iacute;a poder
establecer una conexi&oacute;n pptp con la orden:

<ul>
<pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre>
</ul>

<p>
Como ya hemos dicho, usar&aacute; el ppp(8) nativo de OpenBSD, e
iniciar&aacute; dos procesos;  en consecuencia, podr&aacute; matar pptp
matando estos dos procesos:
</p>

<ul>
<pre>
# <strong>kill -9 [pid de pppd]</strong>
% <strong>kill -9 [pid de pptp]</strong>
</pre>
</ul>

Es recomendable abrir <tt>/var/log/messages</tt> en una ventana de
terminal aparte, para poder reconoce cualquier posible problema.

<ul>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre>
</ul>
</p>

<p>
Tambi&eacute;n le sugerimos que ponga la orden de inicio en
<em>/etc/rc.local</em> para que conecte de forma autom&aacute;tica
cuando reinicie el sistema.
</p>


<p>
<p>
<font color="#0000e0">
<a href="index.html">[Volver al &iacute;ndice principal]</a>
<a href="faq5.html">[Secci&oacute;n 5.0 - Configuraci&oacute;n del n&uacute;cleo y del disco]</a>
<a href="faq7.html">[Secci&oacute;n 7.0 - Controles del teclado]</a>
</font>
</p>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../back.gif" border="0" alt="[&iacute;ndice]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq6.html,v 1.125 2002/01/26 00:17:54 horacio Exp ]<br>
$Translation: faq6.html,v 1.49 2002/01/26 00:23:56 horacio Exp $<br>
$OpenBSD: faq6.html,v 1.38 2002/01/26 11:46:29 jufi Exp $
</small>
</p>
</body>
</html>
