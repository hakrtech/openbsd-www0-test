<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>6 - Redes</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta http-equiv="Content-Language" content="es">
<meta name="resource-type" content="documento">
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,faq,documentación">
<meta name="distribution"  content="global">
<meta name="copyright"     content="Este documento es copyright 1998-2003 de OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- máx. 72 caracteres por línea -->

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq5.html">[Secci&oacute;n 5 - Compilaci&oacute;n del sistema
con el c&oacute;digo fuente]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles de teclado y
pantalla]</a>
</font>

<h1><font color="#e00000">6 - Redes</font></h1>

<hr>

<p>
<h3>&Iacute;ndice de contenidos</h3>
<ul>
<li><a href="#Intro">6.0.1 - Introducci&oacute;n</a>
<li><a href="#Setup">6.1 - Configuraci&oacute;n inicial de la red</a>
<li><a href="#PF">6.2 - El subsistema de Filtro de Paquetes IP (PF)</a>
<li><a href="#DHCP">6.4 - El Protocolo de Configuraci&oacute;n para
Anfitriones Din&aacute;micos (DHCP)</a>
<li><a href="#PPP">6.5 - Protocolo Punto a Punto (PPP)</a>
<li><a href="#Tuning">6.6 - Ajuste de par&aacute;metros de red</a>
<li><a href="#NFS">6.7 - C&oacute;mo usar el Sistema de Archivos de Red
(NFS)</a>
<li><a href="#DNS">6.8 - El Servicio de Nombres de Dominio  - DNS,
BIND, y named</a>
<li><a href="#PPTP">6.9 - Configuraci&oacute;n de una conexi&oacute;n
PPTP en OpenBSD</a>
<li><a href="#Bridge">6.10 - Configuraci&oacute;n de un &laquo;puente de
red&raquo; (<i>bridge</i>) con OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<a name="6.0.1"></a>
<h2>6.0.1 - Introducci&oacute;n</h2>

<p>
Para la comprensi&oacute;n de la mayor parte de este documento
ser&aacute; de gran ayuda haber le&iacute;do antes, y por lo menos haber
asimilado en parte, el cap&iacute;tulo 5 sobre la
<a href="faq5.html">&laquo;Configuraci&oacute;n del
N&uacute;cleo&raquo;</a> de estos documentos, as&iacute; como las
p&aacute;ginas del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
y de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>.

<p>
Tanto si se es un administrador de redes que est&aacute; configurando
protocolos de enrutamiento, como si se est&aacute; usando el sistema
OpenBSD como un enrutador, como si se necesita conocer m&aacute;s a
fondo los protocolos de redes IP, es realmente necesario leer
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">
Understanding IP addressing</a>
&iexcl;Es un documento excelente que contiene conocimientos
b&aacute;sicos fundamentales sobre redes IP!

<p>
Si se est&aacute; trabajando con aplicaciones como servidores de http,
servidores de ftp y servidores de correo, ser&aacute; muy beneficioso
leer los <a href="http://the.rfceditor.org/rfc.html">RFC</a>.

<p>
<i>(Nota: existe un proyecto de traducci&oacute;n de documentos RFC al
castellano, <a href="http://www.rfc-es.org/">RFC-ES</a>)</i>

<p>
Pero lo m&aacute;s seguro es que no se puedan leer todos, y por ello lo
m&aacute;s pr&aacute;ctico es seleccionar algunos temas de
inter&eacute;s o aquellos que se usen en el entorno de red del que se
disponga.  Es aconsejable leerlos al mismo tiempo que se intenta
averiguar su funcionamiento.  Los RFC definen much&iacute;simas (miles)
de las normas para protocolos en Internet y c&oacute;mo se supone que
deben funcionar estos protocolos.

<p>
<a name="Setup"></a>
<a name="6.1"></a>
<h2>6.1 - Configuraci&oacute;n inicial de la red</h2>

<p>
<a name="Setup.1"></a>
<a name="6.1.1"></a>
<h3>6.1.1 - Identificaci&oacute;n y configuraci&oacute;n de las
interfaces de red</h3>

<p>
Para empezar a configurar una red, lo primero que se debe hacer es
identificar la interfaz de red.  En OpenBSD las interfaces se designan
por el tipo de tarjeta, no por el tipo de conexi&oacute;n.  Se puede ver
la tarjeta de red durante el arranque, mientras se inicia el sistema, o
despu&eacute;s del arranque, usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>.
Tambi&eacute;n se puede ver la interfaz de red usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Por ejemplo, v&eacute;ase a continuaci&oacute;n la salida originada por
dmesg para una tarjeta de red Intel Fast Ethernet, que usa el nombre de
dispositivo fxp.

<blockquote>
<pre>
fxp0 at pci0 dev 10 function 0 &quot;Intel 82557&quot; rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre>
</blockquote>

<p>
Si se desconoce es el nombre del dispositivo, se puede buscar en la
<a href="../../es/plat.html">lista de hardware con soporte</a> de la
plataforma correspondiente.  En esa p&aacute;gina hay un listado con
muchos nombres de tarjetas comunes y sus correspondientes nombres de
dispositivo en OpenBSD.  Combinando el nombre abreviado
alfab&eacute;tico (como fxp) con un n&uacute;mero asignado por el
n&uacute;cleo del sistema se obtendr&aacute; el nombre de la interfaz
(como fxp0).

<p>
Se puede averiguar qu&eacute; interfaces de red han sido identificadas
usando la utilidad 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
La orden siguiente mostrar&aacute; todas las interfaces de red que
existan en un sistema.  Esta salida muestra s&oacute;lo una interfaz
f&iacute;sica de ethernet, la
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>.

<blockquote>
<pre>
$ <b>ifconfig -a</b>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre>
</blockquote>

<p>
Como se puede comprobar, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
muestra mucha m&aacute;s informaci&oacute;n de la que necesitamos en
este momento.  Pero aqu&iacute; lo importante es que nos permite ver
nuestra interfaz.  En el ejemplo anterior, la tarjeta de la interfaz ya
est&aacute; configurada.  Esto es obvio porque ya hay una red IP
configurada en fxp0, y de aqu&iacute; los valores &quot;inet 10.0.0.38
netmask 0xffffff00 broadcast 10.0.0.255&quot;.  Adem&aacute;s, los
indicadores <b>UP</b> y <b>RUNNING</b> se encuentran activados.

<p>
Finalmente, n&oacute;tese que hay otras interfaces que tambi&eacute;n se
encuentran activadas de modo predeterminado.  &Eacute;stas son
interfaces virtuales que tienen varias funciones.  Las siguientes
p&aacute;ginas del manual las describen:

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a> - Interfaz de circuito cerrado (<i>loopback</i>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog</a> - Interfaz de registros del Filtro de Paquetes (<i>PF</i>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a> - Interfaz de red SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a> - Protocolo punto a punto (PPP)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a> - Interfaz de red por t&uacute;nel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a> - Interfaz de encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a> - Interfaz de puente Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a> - Interfaz de encapsulaci&oacute;n IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a> - Interfaz de encapsulaci&oacute;n GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a> - Interfaz de t&uacute;nel IPv4/IPv6 gen&eacute;rica
</ul>

<p>
Si la interfaz no se ha configurado, el primer paso ser&aacute; crear el
fichero <tt>/etc/hostname.xxx</tt>, donde se debe sustituir <tt>xxx</tt>
por el nombre de la interfaz.  De acuerdo con la informaci&oacute;n de
los ejemplos anteriores, el nombre ser&iacute;a
<tt>/etc/hostname.fxp0</tt>.  La composici&oacute;n de este fichero es
as&iacute; de sencilla:<br>

<blockquote>
<pre>
address_family address netmask broadcast [other options]
</pre>
</blockquote>

<p>
(Puede verse m&aacute;s informaci&oacute;n sobre el formato de este
fichero en la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>)

<p>
El fichero de configuraci&oacute;n de una interfaz t&iacute;pica,
configurada para una direcci&oacute;n de IPv4, ser&iacute;a parecido a
lo siguiente:

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
inet 10.0.0.38 255.255.255.0 NONE
</pre>
</blockquote>

<p>
Tambi&eacute;n se podr&iacute;a especificar tipos de media para
Ethernet, por ejemplo, si se quisiera forzar el modo 100baseTX
full-duplex:

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
Aunque nunca se debe forzar el modo <i>full duplex</i> a menos que ambas
partes de la conexi&oacute;n est&eacute;n configuradas para hacerlo.  A
menos que sea necesario por alg&uacute;n motivo especial, la
configuraci&oacute;n del tipo de media se debe excluir.

<p>
O puede que se prefiera usar indicadores especiales para especificar una
cierta interfaz.  &iexcl;El formato del fichero <i>hostname</i> no
cambiar&aacute; mucho!

<blockquote><pre>
$ <b>cat /etc/hostname.vlan0</b>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
El siguiente paso ser&aacute; la configuraci&oacute;n de la pasarela
(<i>gateway</i>) predeterminada.  Para ello basta con poner la
direcci&oacute;n IP de la pasarela en el fichero <tt>/etc/mygate</tt>.
Esto permitir&aacute; que la pasarela se active en el momento del
arranque.  A continuaci&oacute;n hay que configurar los nombres de
servidores (<i>nameservers</i>) y el fichero <tt>/etc/hosts</tt>
(v&eacute;ase la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>).
Para configurar los nombres de servidores, antes se debe crear un
fichero con el nombre <tt>/etc/resolv.conf</tt>.  Puede verse m&aacute;s
informaci&oacute;n sobre el formato de este fichero en la p&aacute;gina
del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a>.
El siguiente ejemplo es para un uso t&iacute;pico.  En este ejemplo los
servidores de dominio son 125.2.3.4 y 125.2.3.5.  Tambi&eacute;n
pertenece al dominio &laquo;example.com&raquo;.

<blockquote>
<pre>
$ <b>cat /etc/resolv.conf</b>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre>
</blockquote>

<p>
Desde este punto ya se puede reiniciar o bien ejecutar el gui&oacute;n
de configuraci&oacute;n (<i>script</i>) <b>/etc/netstart</b>.  Este
gui&oacute;n de configuraci&oacute;n se ejecuta como superusuario
(<i>root</i>) del siguiente modo:

<blockquote>
<pre>
# <b>sh /etc/netstart</b>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre>
</blockquote>

<p>
N&oacute;tese que se produce un peque&ntilde;o n&uacute;mero de errores.
Pero al ejecutar este gui&oacute;n, se reconfingurar&aacute;n cosas que
ya se hab&iacute;an configurado anteriormente.  De hecho, algunas rutas
ya existen en la tabla de enrutamiento del n&uacute;cleo del sistema.
Desde aqu&iacute;, el sistema deber&iacute;a funcionar con normalidad.
Se puede realizar una comprobaci&oacute;n con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
para asegurarse de que la interfaz se ha configurado correctamente.
Tambi&eacute;n es posible comprobar las rutas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Si tenemos problemas con el enrutamiento, podemos usar el indicador
<tt>-n</tt> para la orden route(8), que muestra las direcciones de IP en
lugar de realizar una b&uacute;squeda de DNS y mostrar el
<i>hostname</i>.  He aqu&iacute; un ejemplo en el que se ven las tablas
de enrutamiento usando ambos programas.

<blockquote>
<pre>
$ <b>netstat -rn</b>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <b>route show</b>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre>
</blockquote>

<p>
<a name="Setup.2"></a>
<a name="6.1.2"></a>
<h3>6.1.2 - Configuraci&oacute;n del sistema OpenBSD como pasarela
(<i>gateway</i>)</h3>

<p>
&Eacute;sta es la informaci&oacute;n b&aacute;sica necesaria para
configurar el sistema OpenBSD como una pasarela (tambi&eacute;n conocida
como &laquo;enrutador&raquo; o &laquo;encaminador&raquo;).  Si se va a
usar OpenBSD como un enrutador en Internet, sugerimos la lectura de la
secci&oacute;n que contiene las instrucciones sobre la
configuraci&oacute;n del Filtro de Paquetes IP (PF), para poder bloquear
tr&aacute;fico que sea potencialmente malicioso.  Adem&aacute;s, debido
a la escasa disponibilidad de direcciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">
IPv4</a> en los proveedores de servicios de redes y registros
regionales, es conveniente leer la secci&oacute;n sobre la
Traducci&oacute;n de Direcciones de Red (NAT), que contiene
informaci&oacute;n sobre c&oacute;mo conservar el espacio de
direcci&oacute;n IP.

<p>
El n&uacute;cleo GENERIC posee la capacidad de permitir el
reenv&iacute;o de IP (<i>IP Forwarding</i>), pero debe ser activado.
Para activarlo hay que usar la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Para que los cambios sean permanentes, hay que editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a>
y activar <i>IP Forwarding</i> en &eacute;ste.  Esto se puede hacer
a&ntilde;adiendo la siguiente l&iacute;nea a ese fichero de
configuraci&oacute;n.

<blockquote>
<pre>
net.inet.ip.forwarding=1
</pre>
</blockquote>

<p>
Para que este cambio surja efecto sin que haya que reiniciar el sistema,
hay que usar directamente la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Recu&eacute;rdese que este cambio todav&iacute;a no existir&aacute;
despu&eacute;s de reiniciar, y que habr&aacute; que ejecutarlo como
superusuario.

<blockquote>
<pre>
# <b>sysctl -w net.inet.ip.forwarding=1</b>
net.inet.ip.forwarding: 0 -&gt; 1
</pre>
</blockquote>

<p>
A continuaci&oacute;n se debe modificar las rutas en los otros
anfitriones en ambos extremos.  OpenBSD ofrece muchas posibilidades de
uso como enrutador, usando <i>software</i> como 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a> y <a href="http://www.zebra.org">zebra</a>.
OpenBSD dispone de soporte para zebra, gated y mrtd en la
colecci&oacute;n de portes, e incluye soporte para varias interfaces T1,
HSSI, ATM, FDDI, Ethernet, e interfaces de serie (PPP/SLIP).

<p>
<a name="Setup.3"></a>
<a name="6.1.3"></a>
<h3>6.1.3 - Configuraci&oacute;n de un alias en una interfaz</h3>

<p>
OpenBSD dispone de un simple mecanismo para la configuraci&oacute;n de
los alias de IP en una interfaz.  Para configurarlos s&oacute;lo hay que
editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><tt>/etc/hostname.&lt;if&gt;</tt></a>.
El gui&oacute;n
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a>,
que forma parte de la <a href="faq10.html#rc">jerarqu&iacute;a de inicio
rc</a>, leer&aacute; este fichero durante el proceso de inicio del
sistema.  Por ejemplo, supongamos que el usuario tiene una interfaz
<b>dc0</b> y pertenece a la red 192.168.0.0.  Otra informaci&oacute;n de
importancia es:

<ul>
<li>IP para dc0 es 192.168.0.2
<li>NETMASK es 255.255.255.0
</ul>

<p>
Unas notas sobre los alias:  en OpenBSD s&oacute;lo se usa el nombre de
la interfaz y no existen diferencias entre el primer alias y el segundo;
por lo tanto, y a diferencia de otros sistemas operativos, en OpenBSD no
hay que referirse a ellos como dc0:0 y dc0:1.  Si hacemos referencia a
una direcci&oacute;n de IP alias espec&iacute;fica con ifconfig, o si
estamos a&ntilde;adiendo un alias, debemos asegurarse de escribir
'<kbd>ifconfig int alias</kbd>' en lugar de '<kbd>ifconfig int</kbd>' en
la l&iacute;nea de &oacute;rdenes.  Se puede eliminar los alias con la
orden '<kbd>ifconfig int delete</kbd>'.

<p>
Asumiendo que se est&eacute;n usando direcciones de IP m&uacute;ltiples
que se encuentran en la misma subred IP con alias, la
configuraci&oacute;n del enmascaramiento de red (<i>netmask</i>) para
cada alias pasa a ser 255.255.255.255.  No necesitan seguir el
<i>netmask</i> del primer IP vinculado a la interfaz.  En el siguiente
<tt>/etc/hostname.dc0</tt> de ejemplo, se a&ntilde;aden dos alias al
dispositivo <b>dc0</b>, el cual, por cierto, se configur&oacute; como
192.168.0.2 netmask 255.255.255.0.

<blockquote>
<pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre>
</blockquote>

<p>
Una vez que se haya configurado este fichero, ser&aacute; necesario
reiniciar para que los cambios funcionen.  Aunque tambi&eacute;n es
posible hacer efectivos los alias a mano, usando la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Para hacer efectivo el primer alias se usar&iacute;a la orden:

<blockquote>
<pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre>
</blockquote>

<p>
Para ver estos alias se usar&iacute;a la orden:

<blockquote>
<pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre>
</blockquote>


<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.2 - El subsistema de Filtro de Paquetes IP (PF)</h2>

<p>
El Filtro de Paquetes (a partir de aqu&iacute; PF) es el sistema de
OpenBSD para filtrar el tr&aacute;fico TCP/IP y realizar las tareas de
Traducci&oacute;n de Direcciones de Red (NAT).  PF tambi&eacute;n puede
normalizar y acondicionar el tr&aacute;fico TCP/IP y proveer control del
ancho de banda y priorizaci&oacute;n de paquetes.  PF ha sido parte
integral del n&uacute;cleo GENERIC del sistema OpenBSD desde OpenBSD
3.0.  Su configuraci&oacute;n y funcionamiento se describe en la nueva
<a href="../pf/es/index.html"><b>Gu&iacute;a del Usuario de PF</b></a>.

<p>
El viejo documento sobre PF todav&iacute;a se encuentra disponible
<a href="faq6pf.html">aqu&iacute;</a>.


<p>
<a name="DHCP"></a>
<a name="6.4"></a>
<h2>6.4 - DHCP</h2>

<p>
<h3>6.4.1 Cliente DHCP</h3>

<p>
Para usar el cliente de DHCP que se incluye en OpenBSD, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>,
hay que editar el fichero <tt>/etc/hostname.xl0</tt> (suponiendo que la
interfaz principal de ethernet sea xl0) para modificarlo;  la interfaz
podr&iacute;a ser ep0, o fxp0, o cualquier otra).  La &uacute;nica
modificaci&oacute;n necesaria en este fichero es a&ntilde;adir 'dhcp'.

<pre>
# <b>echo dhcp &gt;/etc/hostname.xl0</b>
</pre>

<p>
Esto har&aacute; que OpenBSD inicie el cliente DHCP
autom&aacute;ticamente durante el arranque.  OpenBSD obtendr&aacute; la
informaci&oacute;n sobre nuestra direcci&oacute;n IP, pasarela, y
servidores de DNS desde el servidor de DHCP.

<p>
Si se quiere iniciar un cliente dhcp desde la l&iacute;nea de
&oacute;rdenes, hay que asegurarse de que el fichero
<tt>/etc/dhclient</tt> exista, y entonces usar la orden:

<pre>
# <b>dhclient fxp0</b>
</pre>

<p>
en donde fxp0 es la interfaz en la que se desea recibir dhcp.

<p>
Sea cual fuere el modo en que se inicie dhclient, se puede editar el
fichero <tt>/etc/dhclient</tt> para <b>evitar</b> que se actualice la
DNS de acuerdo con la idea que tenga el servidor de dhcp sobre la DNS,
comentando las l&iacute;neas precedidas por 'request' (son ejemplos de
la configuraci&oacute;n predefinida, pero es necesario activarlos para
anular la configuraci&oacute;n predefinida de dhclient).

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
y a continuaci&oacute;n <b>eliminar</b> domain-name-servers.
Tambi&eacute;n es posible que se quiera anular hostname u otras
configuraciones.

<p>
<h3>6.4.2 Servidor DHCP</h3>

<p>
Si se quiere usar OpenBSD como servidor DHCP con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>,
hay que editar el fichero <tt>/etc/rc.conf</tt>, y configurarlo
a&ntilde;adiendo dhcp_flags=&quot;-q&quot; en lugar de dhcp_flags=NO.
Tambi&eacute;n hay que a&ntilde;adir en <tt>/etc/dhcp.interfaces</tt>
las interfaces en las que se quiera que dhcp est&eacute; <b>a la
escucha</b>:

<pre>
# <b>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
y editar <tt>/etc/dhcpd.conf</tt>.  Las opciones son bastante claras:

<pre>
        option  domain-name &quot;example.com&quot;;
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Con esto indicaremos a los clientes de DHCP que el dominio que deben
a&ntilde;adir a sus requerimientos de DNS es example.com (as&iacute;, si
un usuario escribiera 'telnet joe', los enviar&iacute;a a
joe.example.com).  Les dirigir&aacute; a los servidores de DNS
192.168.1.3 y 192.168.1.5.  Para los anfitriones que se encuentren en la
misma red que una interfaz de ethernet en la m&aacute;quina de OpenBSD,
que est&aacute; en el rango 192.168.1.0/24, les asignar&aacute; una
direcci&oacute;n de IP entre 192.168.1.32 y 192.168.1.127, con una
configuraci&oacute;n predeterminada de la pasarela como 192.168.1.1.

<p>
Si se quiere iniciar dhcpd(8) desde la l&iacute;nea de &oacute;rdenes,
hay que intentar lo siguiente despu&eacute;s de editar
<tt>/etc/dhcpd.conf</tt>:

<pre>
# <b>dhcpd -q fxp0</b>
</pre>

<p>
En donde <tt>fxp0</tt> es la interfaz que se quiere que empiece a servir
dhcp.  El indicador <tt>-q</tt> fuerza una salida silenciosa de dhcpd,
ya que de otro modo es muy ruidoso.

<p>
Si se est&aacute; actuando como servidor de DHCP para una m&aacute;quina
Windows, es posible que se desee que dhcpd(8) ofrezca al cliente una
direcci&oacute;n de servidor 'WINS'.  Para ello se debe a&ntilde;adir la
siguiente l&iacute;nea al fichero <tt>/etc/dhcpd.conf</tt>:

<pre>
     option    netbios-name-servers    192.168.92.55;
</pre>

<p>
En donde <tt>192.168.92.55</tt> es el IP del servidor de Windows o
Samba.  Para ver m&aacute;s opciones que puedan aceptar sus clientes
DHCP, v&eacute;se
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a>.

<p>
<a name="PPP"></a>
<a name="6.5"></a>
<h2>6.5 - PPP </h2>

<p>
El &laquo;Protocolo Punto a Punto&raquo;, PPP, es el que se suele usar
para crear una conexi&oacute;n con su ISP a trav&eacute;s de un
m&oacute;dem.  OpenBSD puede hacer esto de dos maneras:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<i>kernel</i>) del sistema.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a> - Es el d&aelig;mon ppp del modo de usuario.
</ul>

<p>
Primero trataremos el d&aelig;mon del modo de usuario.  Para empezar
necesitaremos algo de informaci&oacute;n sobre nuestro proveedor.  He
aqu&iacute; una lista de la informaci&oacute;n que ser&aacute;
necesaria:

<ul>
   <li>El n&uacute;mero de tel&eacute;fono de conexi&oacute;n de.
   proveedor (ISP)
   <li>Nuestro <i>nameserver</i> (nombre del servidor) 
   <li>Nuestro nombre de usuario y contrase&ntilde;a
   <li>Nuestra pasarela (<i>gateway</i>)
</ul>

<p>
Parte de esta informaci&oacute;n no es estrictamente necesaria, pero
ser&aacute; de gran ayuda para configurar ppp.  El d&aelig;mon PPP del
modo de usuario utiliza el fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
como fichero de configuraci&oacute;n.  Existen muchos ficheros en
<tt>/etc/ppp</tt> de gran utilidad, que pueden contener diferentes
ejemplos de configuraci&oacute;n para situaciones distintas.  Es
aconsejable mirar en ese directorio.

<p>
En caso de no estar usando un n&uacute;cleo GENERIC, debemos asegurarnos
de que tenemos la siguiente l&iacute;nea en nuestro fichero de
configuraci&oacute;n:

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Configuraci&oacute;n inicial para PPP(8)</h3>

<p>
La configuraci&oacute;n inicial del d&aelig;mon PPP del modo de usuario
consiste en editar su fichero <tt>/etc/ppp/ppp.conf</tt>.  Este fichero
no existe y se debe crear, pero se puede tomar el fichero
<tt>/etc/ppp/ppp.conf.sample</tt>, editarlo, y crear un fichero
<tt>ppp.conf</tt> propio a partir de ah&iacute;.  Aqu&iacute;
empezaremos con la m&aacute;s simple, y probablemente m&aacute;s
utilizada, configuraci&oacute;n.  A continuaci&oacute;n puede verse un
peque&ntilde;o fichero <tt>ppp.conf</tt> que realizar&aacute; la
conexi&oacute;n con el ISP y usar&aacute; nuestras rutas predefinidas y
nuestro <i>nameserver</i>.  Para este fichero, toda la
informaci&oacute;n que necesitaremos ser&aacute; el n&uacute;mero de
tel&eacute;fono de nuestro ISP, nuestro nombre de usuario, y nuestro
contrase&ntilde;a.

<blockquote><pre>
default:
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre></blockquote>

<p>
La secci&oacute;n bajo la opci&oacute;n <tt>default:</tt> se ejecutada
cada vez que se requiera una conexi&oacute;n.  En ella se configura toda
la informaci&oacute;n cr&iacute;tica.  Con &quot;set log&quot; se
configuran los niveles de ingreso.  Esto se puede cambiar; para
m&aacute;s informaci&oacute;n sobre c&oacute;mo configurar los niveles
de ingreso v&eacute;ase la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">
ppp(8)</a>.  El dispositivo se configura con &quot;set device&quot;.
&Eacute;ste es el dispositivo en el que se encuentra el m&oacute;dem.
En este ejemplo el m&oacute;dem est&aacute; en el puerto de
comunicaciones 2 (COM2), mientras que el puerto de comunicaciones 1
corresponder&iacute;a a <tt>/dev/cua00</tt>.  Con &quot;set speed&quot;
se configura la velocidad de la conexi&oacute;n por llamada, y con
&quot;set dial&quot; se configuran los par&aacute;metros de la llamada.
Con esto se puede cambiar el tiempo muerto, etc...  Es conveniente dejar
esta l&iacute;nea m&aacute;s o menos como est&aacute;.

<p>
A continuaci&oacute;n podemos pasar a configurar la informaci&oacute;n
espec&iacute;fica para nuestro ISP.  Para ello debemos a&ntilde;adir
otra opci&oacute;n en la secci&oacute;n <b>default:</b>.  Se puede dar
cualquier nombre a esta etiqueta, pero lo m&aacute;s f&aacute;cil es
darle el nombre del ISP.  En el ejemplo usaremos <b>myisp:</b> para la
opci&oacute;n que har&aacute; referencia a nuestro ISP.  He aqu&iacute;
una configuraci&oacute;n simple que incorpora todo lo necesario para
conectar:

<blockquote><pre>
myisp:
set phone 1234567   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
</pre></blockquote>

<p>
Aqu&iacute; hemos configurado informaci&oacute;n esencial para un ISP
espec&iacute;fico.  La primera opci&oacute;n, &quot;set phone&quot;, es
para configurar el n&uacute;mero de tel&eacute;fono para la
conexi&oacute;n con el ISP.  La opci&oacute;n &quot;set login&quot; es
para configurar nuestras opciones de ingreso.  En el ejemplo hemos
puesto un tiempo muerto de espera de 5, lo que significa que nuestro
intento de ingreso terminar&aacute; despu&eacute;s de 5 segundos si no
hay transportador.  De lo contrario esperar&aacute; hasta recibir un
&quot;login&quot; para enviar nuestro nombre de usuario y
contrase&ntilde;a.  En el ejemplo, tanto el nombre de usuario como la
contraseña son &quot;ppp&quot;.  Estos valores hay que sustituirlos por
otros reales.  La opci&oacute;n &quot;set timeout&quot; es para
configurar el tiempo de espera para todo el proceso de ingreso.  La
opci&oacute;n &quot;set ifaddr&quot; es algo complicada.  He aqu&iacute;
una explicaci&oacute;n m&aacute;s extensa sobre ella:

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
Hemos configurado la l&iacute;nea anterior con el formato &quot;<b>set
ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeradr]]]]</b>&quot;.
De este modo el primer IP que se especifique es el que querremos como
nuestro IP.  Si se tiene una direcci&oacute;n IP est&aacute;tica, se
debe a&ntilde;adir aqu&iacute;.  En el ejemplo hemos usado /0, que
indica que no es necesario que concuerde ning&uacute;n bit de esta
direcci&oacute;n ip, y que se puede sustituir todo.  El segundo IP que
se especifique es el que esperamos como el IP de nuestro ISP.  Si lo
conocemos lo podemos especificar aqu&iacute;, pero en la l&iacute;nea no
sabemos cu&aacute;l se asignar&aacute;, as&iacute; que dejaremos que nos
lo digan.  Esto es muy &uacute;til al negociar con algunas
implementaciones PPP que no asignan un n&uacute;mero IP a menos que la
conexi&oacute;n les requiera ``0.0.0.0''.

<p>
La siguiente opci&oacute;n &quot;add default HISADDR&quot; es para
configurar la ruta predefinida hasta nuestra IP.  Si nuestra IP
cambiara, la ruta se actualizar&iacute;a de forma autom&aacute;tica.
Con &quot;enable dns&quot; indicamos a nuestro ISP que autentifique
nuestras direcciones <i>nameservers</i>.  Esto no debe hacerse si se
est&aacute; usando una DNS local, ya que ppp circunvalar&aacute; su uso
introduciendo algunas l&iacute;neas en <tt>/etc/resolv.conf</tt>.

<p>
<h3>C&oacute;mo usar PPP(8)</h3>

<p>
Ahora que ya tenemos el fichero <i>ppp.conf</i> configurado, podemos
intentar una conexi&oacute;n con nuestro ISP.  A continuaci&oacute;n se
dar&aacute;n algunos detalles sobre argumentos de uso com&uacute;n con
ppp.

<ul>
   <li><tt>ppp -auto myisp</tt> - Inicia ppp, configura las interfaces,
   conecta con el ISP, y a continuaci&oacute;n pasa a un plano de fondo.
   <li><tt>ppp -ddial myisp</tt> - Parecido a -auto, pero si la
   conexi&oacute;n cayera volver&iacute;a a conectar.
</ul>

<p>
Si se usa <tt>/usr/sbin/ppp</tt> sin pasarle ninguna opci&oacute;n,
pasar&aacute; al modo interactivo, desde donde se podr&aacute;
interaccionar directamente con el m&oacute;dem.  De este modo se pueden
depurar problemas en el fichero <tt>ppp.conf</tt>.

<p>
<h3>Acciones adicionales con ppp(8)</h3>

<p>
Si se necesitara ejecutar &oacute;rdenes al tiempo que se conecta o
desconecta, puede hacerse creando dos ficheros adicionales,
<tt>/etc/ppp/ppp.linkup</tt> y <tt>/etc/ppp/ppp.linkdown</tt>.  Pueden
verse ejemplos de configuraci&oacute;n para estos ficheros en:

<ul>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Se puede obtener m&aacute;s informaci&oacute;n en el
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <i>userppp</i> de la Gu&iacute;a de FreeBSD</a>.

<p>
<a name="Tuning"></a>
<a name="6.6"></a>
<h2>6.6 - Ajuste de par&aacute;metros de red</h2>
<!-- XXXrelease -->
<p>
<h3>6.6.1 - &iquest;C&oacute;mo se puede forzar al n&uacute;cleo del
sistema para obtener un mayor n&uacute;mero de reintentos y tiempos de
espera mayores en las sesiones de TCP?</h3>

<p>
Para problemas de conexi&oacute;n o enrutamiento se puede usar lo
siguiente (hay que tener en cuenta que para que sea más efectivo, ambos
lados de la conexi&oacute;n deben usar valores similares):

<p>
Para forzarlo hay que usar <tt>sysctl</tt> e incrementar los valores de:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Si se usa sysctl -a se podr&aacute;n ver los valores actuales de estos y
muchos otros par&aacute;metros.  Para cambiar cualquiera de ellos, hay
que usar <tt>sysctl -w</tt>; como por ejemplo en
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - &iquest;C&oacute;mo se pueden activar emisiones
dirigidas?</h3>

<p>
Por lo general, no es aconsejable hacerlo, ya que si el sistema OpenBSD
es un enrutador, permite que se pueda enviar tr&aacute;fico a la
direcci&oacute;n o direcciones de emisi&oacute;n de nuestras redes.

<p>
En algunos casos, como en el de las redes cerradas, puede tener cierta
utilidad, en particular cuando se est&eacute;n usando implementaciones
antiguas del protocolo NetBIOS.  Se puede activar con
<tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>.  Es convienente
informarse sobre los <a href="http://www.netscan.org">ataques
<i>&quot;smurf&quot;</i></a> para saber por qu&eacute; se encuentra
desactivado por definici&oacute;n.

<p>
<h3>6.6.3 - No quiero que el n&uacute;cleo haga asignaciones
din&aacute;micas de ciertos puertos</h3>

<p>
Tambi&eacute;n existe un sysctl para esto.  De la p&aacute;gina del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>:

<pre>
A&ntilde;ada la lista de puertos TCP que no deber&iacute;an ser
asignados de forma din&aacute;mica por el n&uacute;cleo.  Esto puede
utilizarse para evitar que algunos d&aelig;mons se apropien de un cierto
puerto que sea necesario para el funcionamiento de otro programa.  La
lista de elementos puede ir separada por comas y/o espacios en blanco.

 #  <b>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</b>

Tambi&eacute;n se pueden a&ntilde;adir o eliminar puertos de la lista
actual.

 #  <b>sysctl -w net.inet.tcp.baddynamic=+748</b>
 #  <b>sysctl -w net.inet.tcp.baddynamic=-871</b>
</pre>

<p>
<a name="NFS"></a>
<a name="6.7"></a>
<h2>6.7 - Uso simple de NFS</h2>

<p>
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <i>Network File
System</i>) se usa para compartir un sistema de archivos en una red.
Algunas p&aacute;ginas del manual que se deber&iacute;an leer antes de
intentar configurar un servidor de NFS son:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
</ul>

<p>
En esta secci&oacute;n se detallar&aacute;n los pasos para una
configuraci&oacute;n simple de NFS.  El ejemplo ofrece detalles sobre un
servidor en una LAN, con clientes que tengan acceso NFS en la LAN.  En
esta secci&oacute;n no se tratar&aacute; sobre la seguridad de NFS.
Asumiremos que ya se ha configurado el paquete de filtros, u otra
protecci&oacute;n como cortafuegos, para prevenir el acceso desde el
exterior.  Si nuestra configuraci&oacute;n permite el acceso desde el
exterior a nuestro servidor de NFS, y si tenemos alg&uacute;n tipo de
datos confidenciales o importantes, es muy recomendable usar
<a href="faq13.html">IPsec</a>.  De otro modo existe la posibilidad de
que extra&ntilde;os puedan ver nuestro tr&aacute;fico de NFS.
Tambi&eacute;n ser&iacute;a posible que alguien pretendiera estar en la
direcci&oacute;n IP a la que hayamos autorizado la entrada en el
servidor de NFS.  Existen varios tipos de ataques efectivos en este
aspecto.  Cuando IPsec est&aacute; correctamente configurado, protege
contra todos estos tipos de ataques.

<p>
Otra nota importante sobre seguridad.  No se debe a&ntilde;adir un
sistema de archivos a <tt>/etc/exports</tt> sin alg&uacute;n tipo de
lista de anfitriones autorizados.  Sin una lista de anfitriones que
puedan montar un directorio particular, cualquiera que pueda llegar al
anfitri&oacute;n podr&aacute; montar los directorios de NFS en
<tt>exports</tt>.

<p>
NFS depende de que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
se encuentre en ejecuci&oacute;n antes de poder operar.  Portmap(8),
desde la versi&oacute;n 3.2 de OpenBSD, se encuentra desactivado en el
modo predeterminado, y por lo tanto hay que activarlo en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
cambiando la l&iacute;nea de <tt>portmap</tt> as&iacute;:

<blockquote><pre>
portmap=YES
</pre></blockquote>

<p>
y reiniciar para que el cambio sea efectivo.

<p>
La configuraci&oacute;n consiste en un servidor con el ip
<b>10.0.0.1</b>, que servir&aacute; NFS s&oacute;lo a clientes dentro de
esa red.  El primer paso para configurar NFS es configurar el fichero
<tt>/etc/exports</tt>.  Este fichero se compone de una lista con los
sistemas de archivos que se quiera que sean accesibles por medio de NFS,
y define qui&eacute;n puede acceder a cada uno de ellos.  Existen muchas
opciones que puede usar en su fichero <tt>/etc/exports</tt>, y es
conveniente leer la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>.
En este ejemplo empezaremos con un fichero <tt>/etc/exports</tt> como el
siguiente:

<blockquote><pre>
#
# Base de datos de NFS exports
# V&eacute;ase exports(5) para m&aacute;s informaci&oacute;n.  Vaya con
# cuidado, una mala configuraci&oacute;n puede hacer que
# sus sistemas de archivos sean legibles por todo el mundo.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
Esto quiere decir que el sistema de archivos local <tt>/work</tt>
estar&aacute; disponible a trav&eacute;s de NFS.  <tt>-alldirs</tt>
indica que los clientes podr&aacute;n montar en cualquier parte bajo el
punto de montaje <tt>/work</tt>.  <tt>-ro</tt> indica que
&uacute;nicamente se permitir&aacute; montarlo en modo de s&oacute;lo
lectura.  Los dos &uacute;ltimos argumentos indican que s&oacute;lo los
clientes dentro de la red 10.0.0.0 que usen una m&aacute;scara de red
255.255.255.0, estar&aacute;n autorizados a montar este sistema de
archivos.  Esto es importante en algunos servidores accesibles desde
diferentes redes.

<p>
Una vez que se haya configurado el fichero <tt>/etc/exports</tt>, se puede
continuar y pasar a configurar el servidor de NFS.  Primero hay que
asegurarse de que las opciones NFSSERVER y NFSCLIENT se encuentren en la
configuraci&oacute;n del n&uacute;cleo del sistema (el n&uacute;cleo
GENERIC incluye estas opciones).  A continuaci&oacute;n hay que
configurar <tt>nfs_server=YES</tt> en el fichero <tt>/etc/rc.conf</tt>.
De este modo, cuando se reinicie el sistema, se activar&aacute;n nfsd(8)
y mountd(8).  Ahora ya se pueden iniciar los d&aelig;mons.  Estos
d&aelig;mons deben ser iniciados por el superusuario, <i>root</i>, y es
necesario asegurarse de que portmap(8) est&eacute; en funcionamiento en
el sistema.  El ejemplo que sigue sobre c&oacute;mo iniciar nfsd(8)
sirve tanto para TCP como para UDP usando 4 d&aelig;mons.  Para
gestionar el m&aacute;ximo n&uacute;mero de requerimientos de clientes
concurrentes a los que se quiera dar servicio, hay que activar un
n&uacute;mero apropiado de d&aelig;mons del servidor de NFS.

<blockquote><pre>
# <b>/sbin/nfsd -tun 4</b>
</pre></blockquote>

<p>
No s&oacute;lo se debe iniciar el servidor de nfsd(8), sino que
tambi&eacute;n es necesario iniciar mountd(8).  &Eacute;ste es el
d&aelig;mon que da servicio a los requerimientos para montar en NFS.
Para iniciar mountd(8), hay que asegurarse de que existe un fichero
vac&iacute;o <tt>mountdtab</tt> e invocar el d&aelig;mon:

<blockquote><pre>
# <b>echo -n &gt;/var/db/mountdtab</b>
# <b>/sbin/mountd</b>
</pre></blockquote>

<p>
Si se hace alg&uacute;n cambio en el fichero <tt>/etc/exports</tt>
mientras NFS est&eacute; funcionando, se tendr&aacute; que avisar a
mountd sobre el cambio pas&aacute;ndole una se&ntilde;al
&quot;HUP&quot;:

<blockquote><pre>
# <b>kill -HUP `cat /var/run/mountd.pid`</b>
</pre></blockquote>

<p>
<h3>Comprobaci&oacute;n de estad&iacute;sticas en NFS</h3>

<p>
Se pueden realizar comprobaciones para asegurarse de que estos
d&aelig;mons est&eacute;n funcionando y registrados con RPC.  Para ello
se usa rcpinfo(8).

<blockquote><pre>
$ <b>rpcinfo -p 10.0.0.1</b>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
Durante su uso normal, existen unas pocas utilidades más que nos
permitir&aacute;n ver lo que est&aacute; ocurriendo con NFS.  Una de
ellas es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>
que nos permite ver qu&eacute; se encuentra montado y qui&eacute;n lo
est&aacute; montando.  Tambi&eacute;n est&aacute; nfsstat(8), que
muestra una informaci&oacute;n de las estad&iacute;sticas mucho
m&aacute;s amplia.  Para usar showmount(8), basta con escribir
<tt>/usr/bin/showmount -a host</tt>.  Por ejemplo:

<blockquote><pre>
$ <b>/usr/bin/showmount -a 10.0.0.1</b>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>C&oacute;mo montar Sistemas de Archivos de Red (NFS)</h3>

<p>
Los sistemas de archivos NFS se deben montar mediante mount(8) o,
m&aacute;s exactamente, mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
Para montar el sistema de archivos <tt>/work</tt> del anfitri&oacute;n
10.0.0.1 en un sistema de archivo local <tt>/mnt</tt>, se debe hacer lo
siguiente (no es necesario usar una direcci&oacute;n IP, mount se
encargar&aacute; de la resoluci&oacute;n de nombres):

<blockquote><pre>
# <b>mount -t nfs 10.0.0.1:/work /mnt</b>
</pre></blockquote>

<p>
Para que el sistema se monte al iniciar, hay que a&ntilde;adir algo como
lo que viene a continuaci&oacute;n en el fichero <tt>/etc/fstab</tt>:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
&iexcl;&iexcl;Es importante usar <tt>0 0</tt> al final de esta
l&iacute;nea para que la m&aacute;quina no intente ejecutar fsck sobre
el sistema de archivo NFS durante el inicio del sistema!!  El resto de
opciones de seguridad t&iacute;picas, como noexec, nodev y nosuid,
tambi&eacute;n deber&iacute;an usarse donde sean posibles, como en:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
De este modo ning&uacute;n dispositivo o programa setuid en el servidor
de NFS podr&aacute; traspasar las medidas de seguridad en el cliente de
NFS.  Si los programas que se monten no deben ser ejecutados por el
cliente de NFS, se debe a&ntilde;adir noexec a esta lista.

<p>
<a name="DNS"></a>
<a name="6.8"></a>
<h2>6.8 - Servicio de Nombres de Dominio  - DNS, BIND, y named</h2>

<p>
<i>Nota: La siguiente secci&oacute;n ha sido escrita para OpenBSD 3.2 y
versiones anteriores, que inclu&iacute;an BIND4.  OpenBSD 3.3 ahora
incluye BIND9, que est&aacute; mejor documentado en libros y en Internet
de lo que estaba la versi&oacute;n anterior, BIND4.</i>

<p>
<i>Al igual que suced&iacute;a con BIND4 en OpenBSD, BIND9 en OpenBSD se
ejecuta en un entorno chroot(2), y tiene una cantidad de mejoras de
seguridad sobre la versi&oacute;n est&aacute;ndar de BIND9:</i>

<ul>
<li><i>soporte para arc4random() (integrado en 9.3.0-snapshot)</i>
<li><i>llama tzset antes que chroot</i>
<li><i>abre /dev/null antes que chroot</i>
<li><i>vuelve al dispositivo aleatorio predeterminado del sistema cuando
se est&aacute; ejecutando en chroot</i>
<li><i>a&ntilde;ade la implementaci&oacute;n LCG (Linear Congruential
Generator) a libisc</i>
<li><i>usa LCG en lugar de LFSR para generaci&oacute;n de ID hasta que
se pruebe que LFSR es fiable</i>
<li><i>selecci&oacute;n de transporte de requerimiento IPv{4,6} para
dig(1)</i>
<li><i>reparaci&oacute;n de sha1.c para circunvalar un error de
optimizaci&oacute;n de gcc (sparc64)</i>
<li><i>chroot a <tt>/var/named</tt> predeterminado</i>
<li><i>setuid al usuario <tt>named</tt> predeterminado</i>
<li><i>write pid-file antes que chroot</i>
</ul>
<i>Los usuarios de OpenBSD 3.3 pueden mirar la siguiente
documentaci&oacute;n:</i>
<ul>
<li><i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a></i>
<li><i><a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/usr.sbin/bind/doc/arm/Bv9ARM.html">BIND 9 Administrator Reference Manual</a>
(estas p&aacute;ginas tambi&eacute;n est&aacute;n disponibles en el
directorio <tt>/usr/share/doc/html/bind/</tt> del sistema)</i>
</ul>

<h3>6.8.1 &iquest;Qu&eacute; es DNS?</h3>

<p>
El &laquo;Servicio de Nombres de Dominio&raquo; (DNS, <i>Domain Name
Service</i>) es una facilidad de red que permite a los dominios de
redes IP proveer resoluciones de direcciones nombre-a-IP y resoluciones
direcci&oacute;n-a-nombre en respuesta a un requerimiento.  La
instalaci&oacute;n t&iacute;pica de OpenBSD est&aacute; configurada por
definici&oacute;n como un cliente de DNS, pero no como un servidor de
DNS.  O sea, la instalaci&oacute;n predeterminada de OpenBSD puede
llevar a cabo un requerimiento de DNS para la direcci&oacute;n de una
m&aacute;quina contra un servidor de nombres de dominio, pero no puede
responder a uno de esos requerimientos de DNS de por s&iacute; a menos
que se configure con ese fin.

<p>
Mi m&aacute;quina con OpenBSD est&aacute; conectada actualmente a
Internet a trav&eacute;s de mi proveedor, y por lo tanto puedo usar la
utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
para ejecutar el requerimiento de DNS:

<blockquote>
<pre>
$ <b>nslookup www.openbsd.org</b>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre>
</blockquote>

<p>
<b>165.87.201.244</b> es el nombre del servidor que ha contestado,
porque es el &laquo;nombre de servidor&raquo; (<i>nameserver</i>) que
mi proveedor me dijo que usara con mi cuenta, y cuyo n&uacute;mero se
debe introducir en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>.
Pero la respuesta no fue autorizada.  Para una respuesta autorizada,
investiguemos cu&aacute;l es el servidor de DNS autorizado para el
dominio <i>openbsd.org</i>, y pregunt&eacute;mosle por la
direcci&oacute;n de <i>www.openbsd.org</i>:

<blockquote>
<pre>
# Identificar el nombre de los servidores de openbsd.org
# con la ayuda del nombre del servidor de mi ISP.
$ <b>nslookup -type=NS openbsd.org</b>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# Usar la informaci&oacute;n obtenida para requerir una
# resoluci&oacute;n autorizada:
# requerir la autorizaci&oacute;n zeus.theos.com.
$ <b>nslookup www.openbsd.org zeus.theos.com</b>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre>
</blockquote>

<p>
<i>zeus.theos.com</i> es, como es de suponer, una m&aacute;quina que
funciona con OpenBSD y que est&aacute; correctamente configurada para
ser un servidor de DNS para el dominio <i>openbsd.org</i>.

<p>
<a name="DNS.1.1"></a>
<a name="6.8.1.1"></a>
<h3>6.8.1.1 &iquest;D&oacute;nde se puede aprender todo sobre DNS y su
implementaci&oacute;n en OpenBSD?</h3>

<ul>
<li>En los RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, y <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> 
se puede encontrar m&aacute;s informaci&oacute;n sobre el sistema de
nombres de dominio en Internet.
<li>En el libro de O'Reilly Associates
<i><a href="../../es/books.html#6">DNS and BIND</a></i>.
<li>En las
<a href="http://www.openbsd.org/cgi-bin/man.cgi">p&aacute;ginas del
manual de OpenBSD</a>, en especial las p&aacute;ginas de
   <ul>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3">gethostbyname(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=3">resolver(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=5">resolver(5)</a>
   </ul>
</ul>

<p>
La orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
es epecialmente &uacute;til porque puede requerir un dominio y devolver
la informaci&oacute;n pr&aacute;cticamente en el mismo formato requerido
por los ficheros de configuraci&oacute;n de BIND.  Se puede usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
para examinar nombres de servidores que se sepa que est&aacute;n
operando correctamente para comparar la configuraci&oacute;n con la de
ellos.

<p>
<h3>6.8.2 &iquest;Es necesario que mi m&aacute;quina sea un servidor de
nombres de dominio?</h3>

<p>
No se debe configurar como servidor de nombres de dominio a menos que se
est&eacute; seguro que se necesita que funcione como un servidor de DNS.
La instalaci&oacute;n predeterminada de OpenBSD no activa la
m&aacute;quina como servidor de nombres de dominio, aunque todos los
ficheros necesarios se encuentran instalados y listos para la
activaci&oacute;n.  Para la mayor&iacute;a de estaciones de trabajo, es
suficiente con los ficheros
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">/etc/hosts</a>
para indicar las direcciones de IP de las m&aacute;quinas locales y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>
para indicar qu&eacute; servidores de DNS har&aacute;n el servicio en la
intranet o Internet.

<p>
Por otra parte, alguien podr&iacute;a necesitar que la m&aacute;quina
estuviera configurada como un servidor de nombres de dominio si:

<ul>
<li>se tiene una LAN IP en la que no se quieren replicar los ficheros
<tt>hosts</tt> de direcciones locales en cada m&aacute;quina; en este
caso se puede configurar la m&aacute;quina con OpenBSD como servidor de
DNS para que d&eacute; servicio a los requerimientos de otras
m&aacute;quinas de la LAN.

<ul>
<li><b>Nota:</b> No existen restricciones en la pr&aacute;ctica al
n&uacute;mero de servidores de DNS en una LAN.  Cualquier m&aacute;quina
o todas las de la LAN puede ofrecer el servicio de DNS si se configuran
para ello.  Que uno de estos servidores se considere autorizado desde
fuera de la LAN (o incluso conocido desde fuera de la LAN), es un factor
de configuraci&oacute;n que suele estar controlado por el nivel superior
inmediato de la LAN en la jerarqu&iacute;a de dominios.
</ul>

<li>se tiene una LAN IP en la que residan m&aacute;quinas que se quiera
que sean localizables a trav&eacute;s de requerimientos de DNS por
m&aacute;quinas en otra LAN o WAN.

<li>se tiene dificultades al resolver el nombre de dominio local a una
direcci&oacute;n IP, o al resolver cualquier otro nombre local a
direcciones IP aunque los ficheros <tt>/etc/hosts</tt> y
<tt>/etc/resolv.conf</tt> est&eacute;n correctamente configrados (por
ejemplo, en OpenBSD, Netscape a veces se comporta de este modo porque
implementa su propia herramienta de resoluci&oacute;n, en lugar de usar
gethostbyname(3) para la b&uacute;squeda de direcciones).
</ul>

<p>
Algo m&aacute;s a tener en cuenta es la velocidad de ejecuci&oacute;n.
Como la resoluci&oacute;n de nombres es un proceso repititivo en el que
el servidor de nombres realiza repetidos requerimientos sobre
direcciones en dominios remotos a otros servidores de nombres, la
resoluci&oacute;n de nombres puede tardar algo m&aacute;s si se tiene
una conexi&oacute;n por m&oacute;dem a Internet y se est&aacute;n
requiriendo direcciones remotas al servidor propio de DNS (que a su vez
har&aacute; continuos requerimientos a servidores de nombres remotos a
trav&eacute;s del m&oacute;dem) que si se est&aacute; requiriendo el
servidor de nombres del ISP (que probablemente tenga una conexi&oacute;n
m&aacute;s r&aacute;pida a los servidores de nombres remotos).

<p>
<h3>6.8.3 &iquest;Cu&aacute;les son los componentes de software del
servidor de DNS?</h3>

<ul>
<li>named <i>(``d&aelig;mon de name'')</i>
<li>Los ficheros de configuraci&oacute;n en el directorio bajo la
jerarqu&iacute;a de <tt>/var/named/</tt>
</ul>

<p>
<h4>6.8.3.1 &iquest;Qu&eacute; nivel de BIND tiene soporte?</h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
BIND es el nombre de la especificaci&oacute;n sobre la forma en que
act&uacute;a un servidor de nombres de dominio.  Los componentes de DNS
existen para implementar BIND de forma colectiva.

<p>
Existen tres especificaciones de BIND diferentes:

<ol>
<li>BIND 4
<li>BIND 8
<li>BIND 9
</ol>

<p>
En la instalaci&oacute;n predeterminada de OpenBSD, <b>named</b> tiene
soporte para BIND 4.x.

<p>
<h4>6.8.3.2 &iquest;Cu&aacute;les son algunas de las alternativas a
proveer DNS a trav&eacute;s de la implementaci&oacute;n predeterminada
de BIND 4.x?</h4>
<!-- XXXexpires - goes away when 3.2 becomes unsupported -->
<ul>
<li>La implementaci&oacute;n de BIND 9.x, que se encuentra en
<tt>/usr/ports/net/bind9</tt> (v&eacute;ase la p&aacute;gina sobre los
<a href="../../es/ports.html">portes</a>).
</ul>

<p>
<h5>6.8.3.2.1 Nota de <u>Seguridad</u></h5>

<p>
Si se usan estas implementaciones alternativas de DNS, se estar&aacute;
ofreciendo un servicio de red cr&iacute;tico mediante la
utilizaci&oacute;n de unos programas que pueden no haber sido sometidos
al mismo nivel de escrutinio que el d&aelig;mon de <code>name</code> en
la instalaci&oacute;n base, <b><code>named</code></b>, el cual ha pasado
una <a href="../../es/security.html">auditor&iacute;a de seguridad</a>.
&Eacute;sta es una consideraci&oacute;n a tener muy en cuenta, ya que si
se pone en peligro un servidor de nombres de dominio, los
resolucionadores que usen ese servidor de DNS pueden ser redireccionados
al sitio de un impostor.

<p>
<h3>6.8.4 &iquest;Cu&aacute;nto hay que instalar?</h3>

<p>
Si la configuraci&oacute;n predefinida de la red se instal&oacute;
correctamente durante la instalaci&oacute;n de OpenBSD, ya estar&aacute;
todo instalado.  S&oacute;lo ser&aacute; necesario configurar el
d&aelig;mon de <code>name</code> (<b>named</b>).

<p>
<h3>6.8.5 &iquest;C&oacute;mo se configura DNS?</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
Para configurar DNS en OpenBSD, se debe editar y/o crear los ficheros
que controlan el d&aelig;mon de <code>name</code>, <b>named</b>.  La
ubicaci&oacute;n predeterminada de estos ficheros es el directorio
<tt>/var/named</tt> y sus subdirectorios, y en especial el fichero
<tt>/var/named/named.boot</tt> que es el fichero de
inicializaci&oacute;n para <b>named</b>.  Tambi&eacute;n hay un par
pasoso m&aacute;s para la configuraci&oacute;n que deben realizarse en
<tt>/etc</tt>.

<p>
En este documento configuraremos el d&aelig;mon de <code>name</code> en
<i>nemo.yewtopia.com</i> como el nombre nombre primario del servidor
para el dominio (&iexcl;muy peque&ntilde;o!) <i>yewtopia.com</i>.  La
direcci&oacute;n de <i>nemo.yewtopia.com</i> es <i>192.168.1.9</i>.
Otras dos m&aacute;quinas en esa subrred son <i>crater.yewtopia.com</i>
en 192.168.1.1 y <i>earhart.yewtopia.com</i> en 192.168.1.2.

<p>
<h4>6.8.5.1 Configuraci&oacute;n en <tt>/var/named</tt></h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
<h5>6.8.5.1.1 <tt>/var/named/named.boot</tt></h5>

<blockquote>
<pre>
; qu&eacute; subdirectorio contiene los ficheros de
; la base de datos de lookup
directory       /namedb

; type    domain   source host/file backup file
; tipo    dominio  file/host origen fichero respaldo
cache     .	   root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; ejemplo de configuraci&oacute;n de servidor primario:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
</pre>
</blockquote>

<p>
Esto indica al proceso de inicializaci&oacute;n en qu&eacute;
subdirectorio y bajo qu&eacute; nombres encontrar&aacute; los ficheros
de configuraci&oacute;n de <tt>yewtopia.com</tt>.

<p>
<h5>6.8.5.1.2 <tt>/var/named/namedb/localhost.rev</tt></h5>

<blockquote>
<pre>
; lookup inversa para interfaz local
@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
</pre>
</blockquote>

<p>
<h5>6.8.5.1.3 <tt>/var/named/namedb/yewtopia</tt></h5>

<blockquote>
<pre>
; Base de datos del dominio yewtopia.com
@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Direcciones
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre>
</blockquote>

<p>
<h5>6.8.5.1.4 <tt>/var/named/namedb/yewtopia.rev</tt></h5>

<blockquote>
<pre>
; Base de datos de lookup inversa del dominio yewtopia
@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Direcciones
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre>
</blockquote>

<p>
<h4>6.8.5.2 Configuraci&oacute;n en <tt>/etc</tt></h4>

<p>
<h5>6.8.5.2.1 <tt>/etc/resolv.conf</tt></h5>

<p>
Hay que asegurarse de que <tt>/etc/resolv.conf</tt> apunte al dominio de
la m&aacute;quina local (en vez de, por ejemplo, al nombre del servidor
del ISP), de modo que la resoluci&oacute;n del nombre en requerimientos
sea enviada al <b>named</b> que se haya configurado.

<blockquote><pre>
domain yewtopia.com
lookup file bind
</pre></blockquote>

<p>
<h4>6.8.5.2.2 <tt>/etc/hosts</tt></h4>

<p>
Si anteriormente se han a&ntilde;adido las direcciones de varias
m&aacute;quinas al fichero <tt>/etc/hosts</tt>, puede ser conveniente
acortar el fichero <tt>/etc/hosts</tt> al estado en que se encontraba
por definic&oacute;n:

<blockquote><pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre></blockquote>

<p>
de modo que <b>named</b> no sea circunvalado en favor de direcciones
(probablemente caducadas) en el fichero <tt>/etc/hosts</tt>.
&iexcl;<u>Es necesario asegurarse de que se tiene como m&iacute;nimo la
entrada predefinida de <i>localhost</i></u>, o la red no se
iniciar&aacute; correctamente!  N&oacute;tese tambi&eacute;n que
<i>nemo</i> debe aparecer en el propio fichero hosts, o de lo contrario
se producir&aacute; un mensaje de error (no da&ntilde;ino) durante el
arranque cuando <tt>/etc/netstart</tt> se invoque
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>
para a&ntilde;adir <i>nemo</i> (cuyo nombre aparece en
<tt>/etc/myname</tt>).

<p>
<h4>6.8.5.3 C&oacute;mo usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
para examinar los resultados.</h4>

<blockquote>
<pre>
$ <b>dig @nemo.yewtopia.com yewtopia.com any any</b>

; &lt;&lt;&gt;&gt; DiG 2.2 &lt;&lt;&gt;&gt; @nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia.com, type = ANY, class = ANY

;; ANSWERS:
yewtopia.com.   3600    SOA    nemo.yewtopia.com.  your_id.nemo.yewtopia.com. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.com.   3600    NS      nemo.yewtopia.com.

;; ADDITIONAL RECORDS:
nemo.yewtopia.com.  3600    A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.com  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre>
</blockquote>

<p>
<h3>6.8.6 &iquest;C&oacute;mo y cu&aacute;ndo se inicia y se para
DNS?</h3>

<p>
<h4>6.8.6.1 C&oacute;mo iniciar DNS</h4>

<p>
El d&aelig;mon de name <b>named</b> se lanza durante el inicio del
sistema desde
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc</a>
si la l&iacute;nea instalada por definici&oacute;n en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a>,

<blockquote><pre>
named_flags=NO          # para uso normal: &quot;&quot;
</pre></blockquote>

<p>
se cambia a

<blockquote><pre>
named_flags=&quot;&quot;          # para uso normal: &quot;&quot;
</pre></blockquote>

<p>
Tambi&eacute;n se deben examinar las siguientes l&iacute;neas en
<tt>/etc/rc.conf</tt>:

<blockquote><pre>
named_user=named                # named no deber&iacute;a ejecutarse como root a menos que fuera necesario
named_chroot=/var/named         # D&oacute;nde chroot named si no est&aacute; vac&iacute;o
</pre></blockquote>

<p>
Estos valores predefinidos ser&aacute;n v&aacute;lidos para casi todas
las configuraciones.

<p>
Para iniciar <b>named</b> de forma manual, se usa la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>
Por ejemplo:

<blockquote><pre>
# <b>ndc start</b>
          o
# <b>ndc restart</b>
</pre></blockquote>

<p>
<h4>6.8.6.2 C&oacute;mo parar DNS</h4>

<p>
El mejor modo de parar el d&aelig;mon de <code>name</code> es usando la
orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Por ejemplo:

<blockquote><pre>
# <b>ndc stop</b>
</pre></blockquote>

<p>
Si no funciona, hay que encontrar el PID (identificador del proceso) de
<b>named</b> y usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a>
para finalizar el proceso.  El PID de <b>named</b> mientras est&eacute;
funcionando se encontrar&aacute; en la primera l&iacute;nea del fichero
<tt>/var/named/named.pid</tt>:

<blockquote><pre>
# <b>cat /var/named/named.pid</b>
4608
named -t /var/named -u named
# <b>kill -KILL 4608</b>
</pre></blockquote>

<p>
<h4>6.8.6.3 C&oacute;mo reiniciar DNS con una configuraci&oacute;n
alterada</h4>

<p>
Para hacer que un proceso en funcionamiento del d&aelig;mon de name se
reinicie recargando su configuraci&oacute;n despu&eacute;s de haberle
hecho cambios, se debe enviar una se&ntilde;al HUP:

<blockquote><pre>
# <b>kill -HUP 4608</b> 
</pre></blockquote>

<p>
o usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Por ejemplo:

<blockquote><pre>
# <b>ndc reload</b>
</pre></blockquote>

<p>
<h3>6.8.7 &iquest;C&oacute;mo bloqueo los requerimientos AXFR?</h3>

<p>
ejemplo:

<blockquote><pre>
garden:/home/jeremy$<b>  host -l openssh.com</b>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre></blockquote>

<p>
Esta informaci&oacute;n es &uacute;til para depurar DNS, pero en algunos
casos puede que no interese que esta informaci&oacute;n se haga
p&uacute;blica.  Si se est&aacute; usando in-addr(rfc2317) sin clase
para inverso, &iexcl; 'host -' podr&iacute;a dar informaci&oacute;n
sobre todos los dominios hospedados en el sistema!  Esto se puede
solucionar f&aacute;cilmente con la cl&aacute;usula 'allow-transfer' en
el fichero <tt>zone</tt>.
<br><br>
Si se usa Bind8 ser&aacute; necesario especificar los anfitriones a los
que se quiere permitir la transferencia de zonas en el fichero (o
ficheros) individual de zona:

<blockquote><pre>
zone &quot;foo.com&quot; in {
        type master;
        file &quot;directory/zonefile&quot;;
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre></blockquote>

<p>
Tambi&eacute;n se pueden bloquear las transferencias para todos los
dominios editando <tt>/var/named.conf</tt> y a&ntilde;adi&eacute;ndo el
par&aacute;metro 'allow-transfer' a la secci&oacute;n 'options' del
fichero de configuraci&oacute;n:

<blockquote><pre>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre></blockquote>

<p>
El m&eacute;todo para Bind8 tambi&eacute;n funciona para Bind9.<br>
Si se est&aacute; usando Bind 4 (predeterminado en OpenBSD), se puede
editar <tt>/var/named/named.boot</tt> y usar la opci&oacute;n
'xfrnets'.<br>

<blockquote><pre>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre></blockquote>

<p>
Bind 4 permite transferencias desde clases enteras, por lo que no es tan
exacto.  Generalmente, los &uacute;nicos anfitriones que necesitan
efectuar transferencias son los esclavos y los anfitriones de DNS desde
los que se quiera depurar (127.0.0.1 es normalmente un buen
anfitri&oacute;n desde donde permitir transferencias).  El bloqueo de
requerimientos AXFR a&ntilde;ade un nivel adicional de privacidad, pero
puede entorpecer el &uacute;til depurado de DNS (gracias a 
<a href="mailto:ntang@nachtwache.org">Nicholas Tang</a> por este
consejo).

<p>
<h3>6.8.7 &iquest;Qu&eacute; queda por ver sobre la configuraci&oacute;n
de DNS?</h3>

<p>
Hay muchas cosas de las que no hemos hablado, como por ejemplo
c&oacute;mo configurar DNS para que los requerimientos para dominios de
intranet que no sean visibles desde la ra&iacute;z de la
jerarqu&iacute;a del dominio, dependan de servidores dentro de la
empresa.  Se puede obtener m&aacute;s informaci&oacute;n sobre DNS en
los <a href="#DNS.1.1">documentos que recomendamos</a>.

<p>
<a name="PPTP"></a>
<a name="6.9"></a>
<h2>6.9 - Configuraci&oacute;n de una conexi&oacute;n PPTP en
OpenBSD</h2>

<p>
<strong>NOTA:</strong> Esta informaci&oacute;n no es v&aacute;lida para
<strong>TODOS</strong> los proveedores de conexiones ADSL, pero mucha de
la informaci&oacute;n que aqu&iacute; se encuentra se puede usar como
base.  Esta informaci&oacute;n s&oacute;lo se ha verificado con
<a href="http://www.inode.at">Inode</a>, un proveedor de ADSL en
Austria.

<p>
Antes que nada hay que instalar <i>pptp</i>.  El porte de <i>pptp</i> se
encuentra en <tt>/usr/ports/net/pptp</tt>.  Se puede encontrar
m&aacute;s informaci&oacute;n sobre el &aacute;rbol de portes de OpenBSD
en la secci&oacute;n sobre los
<a href="faq8.html#Ports"><tt>Portes</tt></a> del cap&iacute;tulo 8 de
estos documentos.

<p>
Debido a un conflicto entre el soporte integrado en el n&uacute;cleo de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a>
y pptp, es preciso recompilar el n&uacute;cleo del sistema, eliminando
el soporte para gre(4).

<blockquote>Parche para eliminar el soporte para GRE(4).
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@ -87,7 +87,7 @@
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre>
</blockquote>

<p>
Para recompilar el n&uacute;cleo, antes hay que obtener el c&oacute;digo
fuente de OpenBSD mediante cvs (v&eacute;ase la p&aacute;gina de
<a href="../../es/anoncvs.html">AnonCVS</a> para m&aacute;s
informaci&oacute;n), aplicar el parche anterior, y recompilar el
n&uacute;cleo tal y como se indica en la secci&oacute;n sobre la
<a href="faq5.html#Building"><tt>compilaci&oacute;n del
n&uacute;cleo</tt></a> del cap&iacute;tulo 5 de estos documentos.

<p>
Una vez que ya se haya instalado el paquete <b>pptp</b> y el nuevo
n&uacute;cleo, hay que editar unos cuantos ficheros para configurar la
conexi&oacute;n.  Este paquete utiliza el programa de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
nativo de OpenBSD;  si se est&aacute; familiarizado con ppp(8), gran
parte de la configuraci&oacute;n es id&eacute;ntica.  V&eacute;se
tambi&eacute;n la secci&oacute;n sobre <a href="#PPP">PPP</a> de este
documento.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Para el fichero <tt>/etc/ppp/options</tt>, una configuraci&oacute;n como
la siguiente ser&aacute; probablemente todo lo que se necesite:

<blockquote><pre>
# <b>cat /etc/ppp/options</b>
name &quot;LOGINNAME&quot;
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
Se debe sustituir <tt>LOGINNAME</tt> con el identificador de usuario.

<p>
Para el fichero <tt>/etc/ppp/pap-secrets</tt> se necesitar&aacute; una
l&iacute;nea como &eacute;sta:

<blockquote><pre>
# <b>cat /etc/ppp/pap-secrets</b>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
en donde LOGINNAME es el identificador de usuario y PASSWORD la
contrase&ntilde;a.  10.0.0.138 es la direcci&oacute;n IP asignada al
m&oacute;dem en caso de que se use ADSL, etc.  Hay que asegurarse de que
este fichero s&oacute;lo pueda ser le&iacute;do por es superusuario
<i>root</i> (modo 600).

<p>
<h3>6.9.1 - Asignaci&oacute;n de una direcci&oacute;n a la interfaz de
red</h3>

<p>
En el ejemplo anterior, el m&oacute;dem ten&iacute;a una interfaz
10.0.0.38 preconfigurada.  Pero ahora necesitaremos asignar
una direcci&oacute;n a NUESTRA interfaz.  Lo mejor es escoger
una direcci&oacute;n de IP cercana a la asignada para el MODEM, o
usar la direcci&oacute;n de IP est&aacute;tica que nos hayan
asignado.  La secci&oacute;n sobre
<a href="#Setup"><tt>Configuraci&oacute;n inicial de la red</tt></a> de
este documento contiene m&aacute;s informaci&oacute;n sobre la
configuraci&oacute;n de interfaces.

<p>
Una vez que hayamos configurado la interfaz, deber&iacute;amos estar en
disposici&oacute;n de establecer una conexi&oacute;n pptp con la orden:

<blockquote><pre>
# <b>/usr/local/sbin/pptp 10.0.0.138 &amp;</b>
</pre></blockquote>

<p>
Como ya hemos dicho, se usar&aacute; el ppp(8) nativo de OpenBSD, y se
iniciar&aacute;n dos procesos;  en consecuencia, para matar pptp
ser&aacute; necesario matar estos dos procesos:

<blockquote><pre>
# <b>kill -9 [pid de pppd]</b>
$ <b>kill -9 [pid de pptp]</b>
</pre></blockquote>

<p>
Es recomendable abrir <tt>/var/log/messages</tt> en una ventana de
terminal aparte, para poder reconocer cualquier posible problema.

<blockquote><pre>
# <b>tail -f /var/log/messages</b>
</pre></blockquote>

<p>
Tambi&eacute;n es aconsejable poner la orden de inicio en
<tt>/etc/rc.local</tt> para que se conecte de forma autom&aacute;tica
cuando se reinicie el sistema.


<p>
<a name="Bridge"></a>
<h2>6.10 - Configuraci&oacute;n de un &laquo;puente de red&raquo; en
OpenBSD</h2>

<p>
Un puente o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
es un enlace entre dos o m&aacute;s redes separadas entre s&iacute;.  A
diferencia de los enrutadores, la transferencia de paquetes a
trav&eacute;s de un puente es &laquo;invisible&raquo;;
l&oacute;gicamente, los dos segmentos de red aparecen como un solo
segmento a los nodos de cada extremo del puente.  El puente s&oacute;lo
reenv&iacute;a aquellos paquetes que deban pasar desde un segmento hacia
el otro, por lo que, entre otras cosas, ofrecen una forma f&aacute;cil
para reducir el tr&aacute;fico en una red compleja, y a&uacute;n
as&iacute;, permiten que cualquier nodo pueda acceder a otro nodo
cualquiera siempre que esto sea preciso.

<p>
N&oacute;tese que, debido a esta &laquo;naturaleza invisible&raquo;, una
interfaz en un puente puede o no tener una direcci&oacute;n IP propia.
Si la tiene, la interfaz tendr&aacute; dos modos de operaci&oacute;n,
uno que ser&aacute; parte de un puente y el otro un NIC normal
independiente.  Si ninguna de las interfaces tiene una direcci&oacute;n
IP, entonces el puente pasar&aacute; los datos de red, pero no se
podr&aacute; mantener externamente (esto se puede considerar una
funcionalidad).

<p>
<h3>Ejemplo de una aplicaci&oacute;n de puente</h3>

<p>
Uno de mis bastidores tiene unos cuantos sistemas ya viejos, y ninguno
de &eacute;stos tiene un NIC 10BASE-TX integrado.  Aunque todos tienen
un conector AUI o AAUI, mis transportadores se limitan al cable coaxial.
Una de las m&aacute;quinas en este bastidor es un servidor de OpenBSD
que siempre est&aacute; conectado a la red de alta velocidad.
A&ntilde;adi&eacute;ndole un segundo NIC con puerto coaxial puedo usar
esta m&aacute;quina como un puente hacia la red coaxial.

<p>
Ahora este sistema tiene dos NIC, una tarjeta Intel EtherExpress/100
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
y otra tarjeta 3c590-Combo
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
para el puerto coaxial.  <tt>fxp0</tt> es el enlace con el resto de mi
red, y por lo tanto tendr&aacute; una direcci&oacute;n IP;  <tt>ep0</tt>
s&oacute;lo se va a usar para el puente, y por lo tanto no tendr&aacute;
ninguna direcci&oacute;n IP.  Las m&aacute;quinas conectadas al segmento
coaxial se comunican como si estuvieran en el resto de la red...
&iquest;c&oacute;mo se hace esto?

<p>
El fichero <tt>hostname.fxp0</tt> contiene la informaci&oacute;n de
configuraci&oacute;n de la tarjeta <tt>fxp0</tt>.  Esta m&aacute;quina
est&aacute; configurada mediante DCHP, por lo que el fichero es como
sigue:

<blockquote><pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre></blockquote>

<p>
Hasta aqu&iacute; sin sorpresas.

<p>
La tarjeta <tt>ep0</tt> es, l&oacute;gicamente, algo diferente:

<blockquote><pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre></blockquote>

<p>
Aqu&iacute; pasamos al sistema la instrucci&oacute;n de activar esta
interfaz usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>,
y de configurarla como 10BASE-2 (coaxial).  No es necesario especificar
ninguna direcci&oacute;n IP ni informaci&oacute;n parecida para esta
interfaz.  Las opciones que acepta la tarjeta <tt>ep</tt> se pueden
encontrar en la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">
ep(4)</a>.

<p>
Ahora necesitamos configurar el puente.  Los puentes se inician siempre
que exista un fichero que se llame algo como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5"><tt>nombre_puente.bridge0</tt></a>.
He aqu&iacute; un ejemplo de mi situaci&oacute;n:

<blockquote><pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre></blockquote>

<p>
Lo que dice es que se configure un puente que consista de dos NIC, fxp0
y ep0, y que se active.  No importa el orden en que aparezcan las
tarjetas, recu&eacute;rdese que un puente es muy sim&eacute;trico, los
paquetes pasan en ambas direcciones.

<p>
&iexcl;Eso es todo!  Despu&eacute;s de reiniciar ya tendremos un puente
totalmente funcional.

<p>
<h3>Filtros de paquetes en un puente (<i>bridge</i>)</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
Aunque existen varios usos para un puente simple como &eacute;ste, es
muy probable que quiera hacer algo con los paquetes mientras pasan a
trav&eacute;s del puente.  Se puede usar <a href="#PF">PF</a> para
restringir el tr&aacute;fico que pasar&aacute; a trav&eacute;s del
puente.

<p>
Hay que tener en cuenta que, por la naturaleza del puente, los mismos
datos pasar&aacute;n a trav&eacute;s de ambas interfaces, por lo que
s&oacute;lo ser&aacute; necesario filtrar en una sola interfaz.  Las
reglas &quot;Pass all&quot; pueden quedar as&iacute;:

<blockquote><pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre></blockquote>

<p>
Supongamos ahora que quiero filtrar el tr&aacute;fico que llegue a estas
viejas m&aacute;quinas, y que s&oacute;lo quiero que pase el
tr&aacute;fico de <i>web</i> y SSH por ellas.  En este caso dejaremos
salir y entrar todo el tr&aacute;fico de la interfaz ep0, y filtraremos
el de la interfaz fxp0, usando &quot;keep state&quot; para manejar la
respuesta de datos:

<blockquote><pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre></blockquote>

<p>
N&oacute;tese que este grupo de reglas evitar&aacute; que llegue
cualquier tr&aacute;fico a la m&aacute;quina puente o a cualquier otro
nodo &laquo;detr&aacute;s&raquo; de ella, excepto el tr&aacute;fico
entrante de HTTP y SSH.  Es posible obtener otros resultado filtrando la
otra interfaz.

<p>
Para monitorizar y controlar el puente, se puede usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>,
que tambi&eacute;n puede ser usada para crear un puente despu&eacute;s
del arranque.

<p>
<h3>Consejos</h3>

<ul>
<li>Es MUY recomendable filtrar en una sola interfaz.  Aunque se puede
filtrar en ambas, para ello hay que saber muy bien lo que se est&aacute;
haciendo.

<li>Usando la opci&oacute;n <i>blocknonip</i> de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
o en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
se puede evitar que se cuele tr&aacute;fico no IP (como IPX o NETBEUI)
por los filtros.  Hay que tener en cuenta que los puentes funcionan para
todo tipo de tr&aacute;fico, no s&oacute;lo para IP.

<li>Un puente requiere que los NIC est&eacute;n en &laquo;modo
prom&iacute;scuo&raquo; (que est&eacute;n a la escucha para TODO el
tr&aacute;fico de red, no s&oacute;lo para el de la interfaz
redireccionada).  Esto implica una mayor carga en el procesador y el bus
de la esperada.  Algunos NIC no funcionan correctamente en este modo; el
<i>chip</i> TI ThunderLAN
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
es un ejemplo de un <i>chip</i> que no funciona como parte de un puente.
</ul>


<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq5.html">[Secci&oacute;n 5 - Compilaci&oacute;n del sistema
con el c&oacute;digo fuente]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles de teclado y
pantalla]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../back.gif" border="0" alt="[&iacute;ndice]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq6.html,v 1.173 2003/05/30 15:16:59 nick Exp ]<br>
$Translation: faq6.html,v 1.91 2003/06/01 16:38:55 horacio Exp $<br>
$OpenBSD: faq6.html,v 1.76 2003/06/02 11:29:04 jufi Exp $
</small>
</body>
</html>
