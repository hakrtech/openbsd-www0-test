<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Tabele</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="macros.html">Wstecz: Listy i makra</a>]
[<a href="index.html">Spis tre¶ci</a>]
[<a href="options.html">Dalej: Opcje</a>]

<p>
<h1><font color="#e00000">PF: Tabele</font></h1>

<hr>

<h3>Spis tre¶ci</h3>
<ul>
<li><a href="#intro">Wprowadzenie</a>
<li><a href="#config">Konfiguracja</a>
<li><a href="#manip">Manipulacje za pomoc± <tt>pfctl</tt></a>
<li><a href="#addr">Specyfikowanie adresów</a>
<li><a href="#match">Dopasowywanie adresu</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Wprowadzenie</h2>
Tabele s± wykorzystywane do przechowywania grup adresów IPv4 i/lub IPv6.
Wyszukiwania w tabelach s± bardzo szybkie oraz zu¿ywaj± mniej pamiêci i czasu
procesora ni¿ <a href="macros.html#lists">listy</a>. Z tego powodu, tabela
jest idealna do przechowywania du¿ej grupy adresów, albowiem czas wyszukiwania
w tabeli z 50,000 adresów jest tylko nieznacznie wiêkszy ni¿ w tabeli z 50
adresami. Tabele mog± byæ u¿ywane dla pul adresów ¼ród³owych i docelowych
w regu³ach <a href="filter.html">filtruj±cych</a>, 
<a href="scrub.html"><tt>scrub</tt></a>,
<a href="nat.html"><tt>nat</tt></a>, 
i <a href="rdr.html">przekierowuj±cych</a>,
lecz nie mog± byæ stosowane przy przekierowywaniu adresów w regu³ach
<tt>nat</tt> oraz przy opcjach wyznaczania tras (<tt>route-to</tt>, <tt>reply-to</tt>,
<tt>dup-to</tt>) regu³ filtrowania. Tabele s± tworzone albo w
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
><tt>/etc/pf.conf</tt></a> albo przy pomocy
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a>.

<a name="config"></a>
<h2>Konfiguracja</h2>
W <tt>pf.conf</tt> tabele s± tworzone przy pomocy dyrektywy <tt>table</tt>.
Nastêpuj±ce atrybuty mog± byæ podawane dla ka¿dej tabeli:
<ul>
<li><tt>const</tt> - zawarto¶æ tabeli nie mo¿e byæ zmieniona po jej utworzeniu.
Je¶li ten atrybut nie jest podany, narzêdzie
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a> mo¿e byæ wykorzystane do dodania lub usuniêcia adresów
z tabeli w dowolnym momencie, nawet podczas pracy w
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securelevel&amp;sektion=7&amp;manpath=OpenBSD+3.3">
securelevel(7)</a> równym dwa lub wy¿szym.
<li><tt>persist</tt> - zmusza j±dro do przechowywania tabeli nawet, je¶li
¿adne regu³y nie odnosz± siê do niej. Bez tego atrybutu, j±dro automatycznie
usunie tabelê wraz z opró¿nieniem ostatniej regu³y odnosz±cej siê do tej tabeli.
</ul>

<p>
Przyk³ad:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24 }<br>
table &lt;rfc1918&gt; const { 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }<br>
table &lt;spammers&gt; persist<br>
<br>
block in on fxp0 from { &lt;rfc1918&gt;, &lt;spammers&gt; } to any<br>
pass&nbsp; in on fxp0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Adresy mog± byæ tak¿e podawane z u¿yciem modyfikatora negacji (lub "not")
jak np:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24, !192.0.2.5 }
</tt>
</blockquote>

<p>
Tabela <tt>goodguys</tt> bêdzie teraz pasowa³a do wszystkich adresów w sieci
192.0.2.0/24 poza adresem 192.0.2.5.

<p>
Zwróæ uwagê, ¿e nazwy tabel zawsze otoczone s± nawiasami trójk±tnymi
(<tt>&lt; &gt;</tt>). 

<p>
Tabele mog± byæ tak¿e zainicjowane na podstawie plików tekstowych zawieraj±cych
listy adresów IP i sieci:
<blockquote>
<tt>
table &lt;spammers&gt; persist file "/etc/spammers"<br>
<br>
block in on fxp0 from &lt;spammers&gt; to any<br>
</tt>
</blockquote>

<p>
Plik <tt>/etc/spammers</tt> zwiera listê adresów IP -
jeden adres w jednej linii. Ka¿da linia zaczynaj±ca siê od <tt>#</tt> jest
traktowana jako komentarz i ignorowana.

<a name="manip"></a>
<h2>Manipulacje za pomoc± <tt>pfctl</tt></h2>
Tabelami mo¿na manipulowaæ rêcznie poprzez program
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a>. Dla przyk³adu, aby dodaæ wpisy do utworzonej wy¿ej
tabeli &lt;spammers&gt; mo¿na u¿yæ:
<blockquote>
<tt># pfctl -t spammers -Tadd 218.70.0.0/16</tt>
</blockquote>

<p>
Komenda ta utworzy tabelê &lt;spammers&gt;, je¶li jeszcze nie istnieje.
Aby wy¶wietliæ adresy z tabeli stosuje siê:
<blockquote>
<tt># pfctl -t spammers -Tshow</tt>
</blockquote>
Argument <tt>-v</tt> mo¿e tak¿e byæ u¿yty wraz z <tt>-Tshow</tt>, aby
wy¶wietliæ statystyki dla ka¿dego z wpisów. Aby usun±æ adres z tabeli
korzysta siê z:
<blockquote>
<tt>
# pfctl -t spammers -Tdelete 218.70.0.0/16
</tt>
</blockquote>

<p>
Wiêcej informacji o manipulowaniu tabelami przy pomocy <tt>pfctl</tt>
dostêpnych jest w manualu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a>.

<a name="addr"></a>
<h2>Specyfikowanie adresów</h2>
Host mo¿e byæ zdefiniowany nie tylko przy pomocy adresu IP ale tak¿e przez
podanie jego nazwy. Kiedy nazwa hosta rozwijana jest do adresu IP, wszystkie
otrzymywane w ten sposób adresy IPv4 i IPv6 s± wstawiane do tabeli.
Adresy IP mog± byæ tak¿e wprowadzane do tabeli poprzez podanie odpowiedniej
nazwy interfejsu sieciowego lub s³owa kluczowego <tt>self</tt>. W takim
wypadku, wszystkie adresy przypisane do tego interfejsu(ów) bêd± dodane do
tabeli.

<a name="match"></a>
<h2>Dopasowywanie adresu</h2>
Wyszukanie adresu w tabeli zwróci najlepiej pasuj±cy wpis.
Pozwala to na tworzenie takich tabel jak ta:
<blockquote>
<tt>
table &lt;goodguys&gt; { 172.16.0.0/16, !172.16.1.0/24, 172.16.1.100 }<br>
<br>
block in on dc0 all<br>
pass &nbsp;in on dc0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Adres ka¿dego pakietu przychodz±cego na interfejsie dc0 bêdzie porównywany z
tabel± 
<tt>&lt;goodguys&gt;</tt>:
<ul>
<li>172.16.50.5 - najbardziej trafny jest 172.16.0.0/16; pakiet pasuje do
tabeli i zostanie przepuszczony
<li>172.16.1.25 - najbardziej trafny jest !172.16.1.0/24; pakiet pasuje do
wpisu w tabeli, ale wpis ten jest zanegowany (u¿ywa modyfikatora "!");
pakiet nie pasuje do tabeli i bêdzie zablokowany
<li>172.16.1.100 - jest to dok³adnie 172.16.1.100; pakiet pasuje do
tabeli i zostanie przepuszczony
<li>10.1.4.55 - pakiet nie pasuje do tabeli i bêdzie zablokowany
</ul>

<p>
[<a href="macros.html">Wstecz: Listy i makra</a>]
[<a href="index.html">Spis tre¶ci</a>]
[<a href="options.html">Dalej: Opcje</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[wstecz]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: tables.html,v 1.6 ]<br>
$Translation: tables.html,v 1.2 2003/09/28 14:46:48 pl-team Exp $<br>
$OpenBSD: tables.html,v 1.2 2003/09/28 22:28:56 horacio Exp $
</small>
</body>
</html> 
