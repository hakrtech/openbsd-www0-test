<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Scrub</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="options.html">前に戻る: オプション</a>]
[<a href="index.html">目次</a>]
[<a href="queueing.html">次に進む: キューイング</a>]

<p>
<h1><font color="#e00000">PF: Scrub</font></h1>
<hr>

<h3>目次</h3>
<ul>
<li><a href="#intro">はじめに</a>
<li><a href="#options">オプション</a>
</ul>

<hr>

<a name="intro"></a>
<h2>はじめに</h2>
「スクラブ (scrub)」とは、パケットの通常化を行うことですので、
パケットの最終目的地における (用語の) 解釈に一切の不明確さはありません。
scrub ディレクティブはまた、フラグメント (分断) 化されたパケットの再構成を行い、
ある種の形態の攻撃からいくつかのオペレーティングシステムを保護し、正しくない
<a href="filter.html#tcpflags">フラグ</a>の組み合わせを持つ TCP
パケットを廃棄します。scrub ディレクティブの単純な形式は次のとおりです。
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
これはすべてのインターフェイス上の着信パケットに対してスクラブを行います。

<p>
あるインターフェイスに対してスクラブを行わないひとつの理由に、それが PF を通じて NFS を通すかどうか、
というのがあります。ある種の、OpenBSD ではないプラットフォームは、"フラグメント禁止" ビットをセットしているのに、
フラグメント化されているという、奇妙なパケットを送信 (そしてそれを期待) しますが、このパケットは
<tt>scrub</tt> によって、(適正に) 拒絶されます。これは、<tt>no-df</tt> オプションを使用することで
解決することができます。もうひとつの理由としては、いくつかの複数プレイヤー用ゲームを、<tt>scrub</tt>
が有効化された PF を通じてわたされると、接続上の問題が生ずる、というものです。
このような、あまり普通とは言えないような場合を除いて、すべてのパケットに対してスクラブを行うことは
<i>強く推奨される</i>行為です。

<p>
<tt>scrub</tt> ディレクティブのシンタクスは、<a href="filter.html">フィルタリング</a>
のシンタクスに非常によく似ており、このため、ある種のパケットに対して選択的にスクラブを行い、
他のパケットに対しては行わないようにしたりすることを簡単に実施することができます。

<p>
スクラブの原理や考え方についてのより詳しいことは、
<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html</a> を参照してください。

<a name="options"></a>
<h2>オプション</h2>
<tt>scrub</tt> には以下のようなオプションがあります。
<dl>
<dt><tt>no-df</tt> 
<dd><i>フラグメント禁止</i>ビットを IP パケットのヘッダから除去します。
ある種のオペレーティングシステムは、<i>フラグメント禁止</i>ビットをセットしているにも関わらず、
フラグメント化したパケットを生成することが知られています。これは、特に NFS 
で真になります。<tt>scrub</tt> は、このようなパケットを <tt>no-df</tt> オプションが
指定されていない限り廃棄します。いくつかのオペレーティングシステムは IP
識別ヘッダフィールドのない、<i>フラグメント禁止</i>パケットを生成するので、
<tt>no-df</tt> を <tt>random-id</tt> とともに使用することを
推奨します。

<dt><tt>random-id</tt> 
<dd>IP 識別フィールドに予測可能な値を使用するオペレーティングシステムのために、
送出パケットの IP 識別フィールドの値をランダムな値で置換します。
このオプションは、オプショナルなパケットの再構成後の
フラグメント化されていない送出パケットに対してのみ適用されます。

<dt><tt>min-ttl <i>num</i></tt> 
<dd>IP パケットヘッダ中の Time To Live (TTL) の値として
最小値を強制適用します。

<dt><tt>max-mss <i>num</i></tt> 
<dd>TCP パケットヘッダ中の Maximum Segment Size (MSS) の値として
最大値を強制適用します。

<dt><tt>fragment reassemble</tt> 
<dd>フラグメント化された着信パケットをバッファリングし、そしてそれを
フィルタエンジンにわたす前に完全なパケットに再構成するためにバッファリングします。
この優位性は、完全なパケットを扱わなければならないフィルタルールだけを使用したり、
フラグメントを無視したりできることです。また、この不利な点は、フラグメント化された
パケットをバッファリングするのに必要なメモリ量が増加してしまうということです。
これは、<tt>fragment</tt> オプションが指定されていない場合にはデフォルトの挙動となります。
これはまた、NAT で <tt>fragment</tt> オプションだけが指定されている場合も同様です。

<dt><tt>fragment crop</tt> 
<dd>二重のフラグメントを廃棄したり、いかなる重複部分も除去したりします。
<tt>fragment reassemble</tt> とは異なり、フラグメントはバッファリング 
されることなく、着信後、直ちにわたされます。

<dt><tt>fragment drop-ovl</tt> 
<dd>すべての二重、あるいは重複フラグメントは、
その後に着信する関連フラグメントも含めて廃棄されるということを除いて、
<tt>fragment crop</tt> と同様です。
</dl>

<p>
例:
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400
</tt>
</blockquote>

<p>
[<a href="options.html">前に戻る: オプション</a>]
[<a href="index.html">目次</a>]
[<a href="queueing.html">次に進む: キューイング</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: scrub.html,v 1.6 ]
<br>
$Translation: scrub.html,v 1.8 2003/09/24 04:31:39 toshi Exp $
<br>
$OpenBSD: scrub.html,v 1.6 2003/09/26 13:21:47 horacio Exp $
</small>

</body>
</html> 
