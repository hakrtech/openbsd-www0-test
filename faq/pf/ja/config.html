<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: 設定</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html"; charset="iso-2022-jp">
<meta name="resource-type" content="document">
<meta name="description"   content="OpenBSD FAQ ページ">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="index.html">目次</a>]
[<a href="macros.html">次に進む: リストとマクロ</a>]

<p>
<h1><font color="#e00000">PF: 設定</font></h1>

<hr>

<h3>目次</h3>
<ul>
<li><a href="#activate">有効化</a>
<li><a href="#config">設定</a>
<li><a href="#control">制御</a>
</ul>

<hr>

<a name="activate"></a>
<h2>有効化</h2>
PF を有効にし、起動時に設定ファイルを読み込ませるためには、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>/etc/rc.conf</tt></a> ファイルの PF 行を以下のように編集します。

<blockquote>
<tt>
pf=YES
</tt>
</blockquote>

<p>
そして再起動すれば変更の効果を得ることができます。

<p>
PF の有効化・無効化には
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pfctl(8)</a> プログラムを使用することもできます。

<blockquote>
<tt>
# pfctl -e<br>
# pfctl -d
</tt>
</blockquote>

<p>
上から、有効時と無効時の例です。
これは、単に PF を有効化あるいは無効化するだけであり、実際にルールセットを
ロードするわけではないことに注意してください。ルールセットは PF の有効化の
前か後に、別途ロードしなければなりません。


<a name="config"></a>
<h2>設定</h2>
<p>
PF はシステム起動時に、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>rc スクリプト</a>から呼び出されて、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
><tt>/etc/pf.conf</tt></a> から設定を読み込みます。
注意すべき点は、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
><tt>/etc/pf.conf</tt></a> はシステムの rc スクリプトから呼び出される際の
デフォルト・ファイル名であり、単なるテキストファイルに過ぎないということです。
結局のところ、それは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pfctl(8)</a> に読み込まれ、逐次解釈された上で、
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.3"
>pf(4)</a> に挿入されます。いくつかのアプリケーションのためには、起動後に他のルール
セットが、他のファイルから読み込まれる方が良いかも知れません。良く設計された
Unix アプリケーションに対しては、PF は多大な柔軟性を提供するのです。

<p>
<tt>pf.conf</tt> ファイルは 7 つの部分に分かれています。
<ul>
<li><b><a href="macros.html">マクロ:</a></b> IP アドレスやインターフェイス名など、
ユーザ定義の変数を保持することができます。
<li><b><a href="tables.html">テーブル:</a></b> IP アドレスのリストを
保持するための構造体です。
<li><b><a href="options.html">オプション:</a></b> PF の動作をコントロールするための
さまざまなオプションです。
<li><b><a href="scrub.html">スクラブ (scrub):</a></b> パケットを通常化およびデフラグメント
(非分断化) するための再処理行程です。
<li><b><a href="queueing.html">キューイング:</a></b> 帯域制御と
パケットの優先付けを提供します。
<li><b><a href="nat.html">変換:</a></b> ネットワークアドレス変換 (NAT) と
<a href="rdr.html">パケットリダイレクション</a>
を制御します。
<li><b><a href="filter.html">フィルタルール:</a></b> あらゆる
インターフェイスを通過するパケットの選択的フィルタリングと
ブロッキングを許可します。
</ul>

<p>
マクロとテーブルの例外はありますが、各セクションは
この順番で設定ファイルに記述されなければなりません。とは言え、おのおのの
アプリケーションについてすべてのセクションが必要なわけではありません。

<p>
空行は無視され、また、<tt>#</tt> で始まる行はコメントとして
取り扱われます。

<a name="control"></a>
<h2>制御</h2>
起動後は、PF の操作は
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pfctl(8)</a> プログラムで行うことができます。このような感じです。

<pre>
     # pfctl -f /etc/pf.conf     <i>pf.conf ファイルを読み込みます</i>
     # pfctl -nf /etc/pf.conf    <i>ファイルを解析しますが、読み込みません</i>
     # pfctl -Nf /etc/pf.conf    <i>ファイルから NAT ルールだけを読み込みます</i>
     # pfctl -Rf /etc/pf.conf    <i>ファイルからフィルタルールだけを読み込みます</i>

     # pfctl -sn                 <i>現在の NAT ルールを表示します</i>
     # pfctl -sr                 <i>現在のフィルタルールを表示します</i>
     # pfctl -ss                 <i>現在の状態テーブルを表示します</i>
     # pfctl -si                 <i>フィルタの状態と計数を表示します</i>
     # pfctl -sa                 <i>現在表示できるすべてのものを表示します</i>
</pre>

<p>
コマンドの完全なリストは
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pfctl(8) man ページ</a>をご覧ください。

<p>
[<a href="index.html">目次</a>]
[<a href="macros.html">次に進む: リストとマクロ</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: config.html,v 1.7 ]
<br>
$Translation: config.html,v 1.8 2003/09/24 04:31:39 toshi Exp $
<br>
$OpenBSD: config.html,v 1.7 2003/09/26 13:21:46 horacio Exp $
</small>

</body>
</html>
