<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Lists and Macros</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="config.html">前に戻る: はじめに</a>]
[<a href="index.html">目次</a>]
[<a href="tables.html">次に進む: テーブル</a>]

<h1><font color="#e00000">PF: リストとマクロ</font></h1>
<hr>

<h3>目次</h3>
<ul>
<li><a href="#lists">リスト</a>
<li><a href="#macros">マクロ</a>
</ul>

<hr>

<a name="lists"></a>
<h2>リスト</h2>
リストは、ルールの中に同様の判断基準を複数記述することを許しています。
たとえば、複数のプロトコル、ポート番号、アドレスなどです。
ですので、ブロックする必要のある各 IP アドレス用にそれぞれ
フィルタルールを書く代わりに、リスト中に複数の IP アドレスを
指定することで、ひとつのルールを書くことができます。リストは、
その要素を <tt>{ }</tt> の中に記述することで定義されます。

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a> がルールセットをロード中にリストを見つけると、
これをひとつひとつがリストのそれぞれの要素に対応する、
複数のルールに展開します。たとえば、
<blockquote>
<tt>
block out on fxp0 from { 192.168.0.1, 10.5.32.6 } to any
</tt>
</blockquote>

<p>
は次のように展開されます。
<blockquote>
<tt>
block out on fxp0 from 192.168.0.1 to any<br>
block out on fxp0 from 10.5.32.6 to any
</tt>
</blockquote>

<p>
ルール中に複数のリストを指定することが可能で、
また、以下の例のようにフィルタルールだけに限定されません。
<blockquote>
<tt>
rdr on fxp0 proto tcp from any to any port { 22 80 } -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.0.6<br>
block out on fxp0 proto { tcp udp } from { 192.168.0.1, \<br> 
&nbsp;&nbsp;&nbsp;10.5.32.6 } to any port { ssh telnet }
</tt>
</blockquote>

<p>
リストの要素の間のカンマはオプショナルであることに注意してください。

<a name="macros"></a>
<h2>マクロ</h2>
マクロは、IP アドレス、ポート番号、インターフェイス名などを保持する、
ユーザ定義の変数です。マクロは PF のルール集合の複雑さを軽減し、
ルールセットをより簡単にメンテナンスすることができるようにしてくれるものです。

<p>
マクロ名は英文字から始まり、英数字とアンダースコアを含み得るものです。
マクロ名には <tt>pass</tt>、<tt>out</tt> や <tt>queue</tt> のような
予約語を使用することはできません。
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block in on $ext_if from any to any<br>
</tt>
</blockquote>

<p>
上記は、<tt>ext_if</tt> という名前のマクロを生成します。マクロがその生成後に
参照されると、その名前の先頭に <tt>$</tt> 文字が付与されます。

<p>
マクロは以下のようなリストに展開することもできます。
<blockquote>
<tt>
friends = "{ 192.168.1.1, 10.0.2.5, 192.168.43.53 }"
</tt>
</blockquote>

<p>
マクロは再帰的に定義することができます。クウォートで囲まれたマクロは
展開されませんので、次のようなシンタクスを使用する必要があります。
<blockquote>
<tt>
host1      = "192.168.1.1"<br>
host2      = "192.168.1.2"<br>
all_hosts  = "{" $host1 $host2 "}"<br>
</tt>
</blockquote>

<p>
このマクロ <tt>$all_hosts</tt> 場合、192.168.1.1、192.168.1.2 に展開されます。

<p>
[<a href="config.html">前に戻る: はじめに</a>]
[<a href="index.html">目次</a>]
[<a href="tables.html">次に進む: テーブル</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: macros.html,v 1.9 ]
<br>
$Translation: macros.html,v 1.7 2004/01/03 05:24:39 toshi Exp $
<br>
$OpenBSD: macros.html,v 1.8 2004/01/04 22:47:55 horacio Exp $
</small>

</body>
</html> 
