<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Listas e Macros</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq,pf">
<meta name="distribution" content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="config.html">Anterior: Come&ccedil;ando</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="tables.html">Pr&oacute;ximo: Tabelas</a>]

<h1><font color="#e00000">PF: Listas e Macros</font></h1>
<hr>

<h3>Conte&uacute;do</h3>
<ul>
<li><a href="#lists">Listas</a>
<li><a href="#macros">Macros</a>
</ul>

<hr>

<a name="lists"></a>
<h2>Listas</h2>
Uma lista permite a especifica&ccedil;&atilde;o de m&uacute;ltiplas informa&ccedil;&otilde;es 
similares numa regra.  Por exemplo, v&aacute;rios protocolos, n&uacute;meros de portas, 
endere&ccedil;os, etc.
Portando, ao inv&eacute;s de escrever uma regra de filtragem para cada endere&ccedil;o
IP a ser bloqueado, pode-se escrever apenas uma regra especificando 
uma lista de endere&ccedil;os IP. Listas s&atilde;o definidas colocando seus itens entre 
chaves <tt>{ }</tt>.

<p>
Quando o 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>pfctl(8)</a> encontra uma lista ao carregar as regras, ele
cria v&aacute;rias regras, uma para cada item na lista. Por exemplo:
<blockquote>
<tt>
block out on fxp0 from { 192.168.0.1, 10.5.32.6 } to any
</tt>
</blockquote>

<p>
&eacute; expandida para:
<blockquote>
<tt>
block out on fxp0 from 192.168.0.1 to any<br>
block out on fxp0 from 10.5.32.6 to any
</tt>
</blockquote>

<p>
V&aacute;rias listas podem ser especificadas numa regra e n&atilde;o est&atilde;o limitadas 
apenas &agrave;s regras de filtragem:
<blockquote>
<tt>
rdr on fxp0 proto tcp from any to any port { 22 80 } -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.0.6<br>
block out on fxp0 proto { tcp udp } from { 192.168.0.1, \<br> 
&nbsp;&nbsp;&nbsp;10.5.32.6 } to any port { ssh telnet }
</tt>
</blockquote>

<p>
Perceba que as v&iacute;rgulas entre elementos da lista &eacute; opcional.

<p>
Tome cuidado com constru&ccedil;&otilde;es do tipo "lista negada",  
um erro comum &eacute;:
<blockquote>
<tt>
pass in on fxp0 from { 10.0.0.0/8, !10.1.2.3 }
</tt>
</blockquote>

<p>
Enquanto a inten&ccedil;&atilde;o geralmente &eacute; casar com 
"qualquer endere&ccedil;o em 10.0.0.0/8, exceto 10.1.2.3",
na verdade a regra expande para:
<blockquote>
<tt>
pass in on fxp0 from 10.0.0.0/8<br>
pass in on fxp0 from !10.1.2.3
</tt>
</blockquote>

<p>
que casa com qualquer endere&ccedil;o poss&iacute;vel. Neste caso, uma 
<a href="tables.html">tabela</a> deve ser usada.

<a name="macros"></a>
<h2>Macros</h2>
Macros s&atilde;o var&iacute;aveis definidas pelo usu&aacute;rio e podem conter endere&ccedil;os 
IP, n&uacute;meros de portas, nomes de interfaces, etc. O uso de macros pode 
reduzir em muito a complexidade de um arquivo de regras PF al&eacute;m de 
facilitar bastante sua manuten&ccedil;&atilde;o.

<p>
Nomes de macro devem come&ccedil;ar com uma letra e pode conter letras, d&iacute;gitos, e
underscore. N&atilde;o se pode utilizar palavras reservadas como <tt>pass</tt>, 
<tt>out</tt> ou <tt>queue</tt> como nomes de macros.
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block in on $ext_if from any to any<br>
</tt>
</blockquote>

<p>
Isto cria a macro nomeada <tt>ext_if</tt>. Quando a macro &eacute; referenciada ap&oacute;s 
sua cria&ccedil;&atilde;o, seu nome deve ser precedido pelo caracter <tt>$</tt>.

<p>
Macros tamb&eacute;m podem expandir em listas como:
<blockquote>
<tt>
friends = "{ 192.168.1.1, 10.0.2.5, 192.168.43.53 }"
</tt>
</blockquote>

<p>
Macros podem ser definias recursivamente. Como macros n&atilde;o s&atilde;o expandidas 
entre aspas, a seguinte sintaxe deve ser usada:
<blockquote>
<tt>
host1      = "192.168.1.1"<br>
host2      = "192.168.1.2"<br>
all_hosts  = "{" $host1 $host2 "}"<br>
</tt>
</blockquote>

<p>
A macro <tt>$all_hosts</tt> agora expande para 192.168.1.1, 192.168.1.2.

<p>
[<a href="config.html">Anterior: Come&ccedil;ando</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="tables.html">Pr&oacute;ximo: Tabelas</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: macros.html,v 1.16 ]<br>
$Translation: macros.html,v 1.2 2005/05/27 15:11:33 dsantos Exp $<br>
$OpenBSD: macros.html,v 1.2 2005/05/30 13:52:07 saad Exp $ 
</small>

</body>
</html>
