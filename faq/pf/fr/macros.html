<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Listes et Macros</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="config.html">Pr&eacute;c&eacute;dent : Principes de Base</a>]
[<a href="index.html">Index</a>]
[<a href="../tables.html">Suivant : Tables</a>]

<h1><font color="#e00000">PF : Listes et Macros</font></h1>
<hr>

<h3>Table des Mati&egrave;res</h3>
<ul>
<li><a href="#lists">Listes</a>
<li><a href="#macros">Macros</a>
</ul>

<hr>

<a name="lists"></a>
<h2>Listes</h2>
Une liste permet d'utiliser plusieurs crit&egrave;res similaires dans
une m&ecirc;me r&egrave;gle PF. Par exemple, plusieurs protocoles,
plusieurs num&eacute;ros de ports, plusieurs adresses IP, etc. Ainsi, au
lieu d'&eacute;crire une r&egrave;gle de filtrage pour chaque adresse IP
qui doit &ecirc;tre bloqu&eacute;e, une seule r&egrave;gle peut
&ecirc;tre &eacute;crite en cr&eacute;ant une liste avec les adresses IP
&agrave; bloquer. Les listes sont d&eacute;finies en mettant des
&eacute;l&eacute;ments entre accolades <tt>{ }</tt>.

<p>
Quand
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5">pfctl(8)</a>
rencontre une liste durant le chargement de la base de r&egrave;gles, il
cr&eacute;e de multiples r&egrave;gles : une r&egrave;gle pour chaque
&eacute;l&eacute;ment de la liste. Par exemple :
<blockquote>
<tt>
block out on fxp0 from { 192.168.0.1, 10.5.32.6 } to any
</tt>
</blockquote>

<p>
devient :
<blockquote>
<tt>
block out on fxp0 from 192.168.0.1 to any<br>
block out on fxp0 from 10.5.32.6 to any
</tt>
</blockquote>

<p>
Plusieurs listes peuvent &ecirc;tre utilis&eacute;es dans une m&ecirc;me
r&egrave;gle. Elles ne sont pas uniquement limit&eacute;es aux
r&egrave;gles de filtrage :
<blockquote>
<tt>
rdr on fxp0 proto tcp from any to any port { 22 80 } -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.0.6<br>
block out on fxp0 proto { tcp udp } from { 192.168.0.1, \<br> 
&nbsp;&nbsp;&nbsp;10.5.32.6 } to any port { ssh telnet }
</tt>
</blockquote>

<p>
Les virgules entre les &eacute;l&eacute;ments d'une m&ecirc;me liste sont
optionnelles.

<a name="macros"></a>
<h2>Macros</h2>
Les macros sont des variables d&eacute;finies par l'utilisateur et
pouvant contenir des adresses IP, des num&eacute;ros de ports, des noms
d'interfaces, etc. Les macros peuvent r&eacute;duire la
complexit&eacute; d'une base de r&egrave;gles PF et facilitent la
maintenance d'une base de r&egrave;gles.

<p>
Les noms de macros doivent commencer par une lettre et peuvent contenir
des lettres, des chiffres, et des barres de soulignement "_". Les noms
des macros ne doivent pas &ecirc;tre des noms r&eacute;serv&eacute;s
tels que <tt>pass</tt>, <tt>out</tt>, ou <tt>queue</tt>.
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block in on $ext_if from any to any<br>
</tt>
</blockquote>

<p>
L'exemple pr&eacute;c&eacute;dent montre comment cr&eacute;er une macro
nomm&eacute;e <tt>ext_if</tt>. Quand une macro est appel&eacute;e
apr&egrave;s avoir &eacute;t&eacute; cr&eacute;&eacute;e, son nom est
pr&eacute;c&eacute;d&eacute; d'un caract&egrave;re <tt>$</tt>.

<p>
Les macros peuvent aussi repr&eacute;senter des listes tel que le montre
l'exemple suivant :
<blockquote>
<tt>
friends = "{ 192.168.1.1, 10.0.2.5, 192.168.43.53 }"
</tt>
</blockquote>

<p>
Elles peuvent &ecirc;tre d&eacute;finies de mani&egrave;re
r&eacute;cursive. Vu qu'elles ne sont pas traduites dans des quotes
<tt>""</tt>, la syntaxe suivante doit &ecirc;tre employ&eacute;e :
<blockquote>
<tt>
host1      = "192.168.1.1"<br>
host2      = "192.168.1.2"<br>
all_hosts  = "{" $host1 $host2 "}"<br>
</tt>
</blockquote>

<p>
La macro <tt>$all_hosts</tt> correspond maintenant &agrave; la liste
d'adresses IP {192.168.1.1 192.168.1.2}.

<p>
[<a href="config.html">Pr&eacute;c&eacute;dent : Principes de Base</a>]
[<a href="index.html">Index</a>]
[<a href="../tables.html">Suivant : Tables</a>]

<p>
<hr>
<a href="index.html"><img alt="[back]" border="0" height="24" src="../../../images/back.gif" width="24"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: macros.html,v 1.10 ]<br>
$Translation: macros.html,v 1.4 2004/05/02 21:04:14 saad Exp $<br>
$OpenBSD: macros.html,v 1.4 2004/05/06 21:34:05 saad Exp $
</small>

</body>
</html> 
