<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Listes et Macros</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="config.html">Précédent : Principes de Base</a>]
[<a href="index.html">Index</a>]
[<a href="../tables.html">Suivant : Tables</a>]

<h1><font color="#e00000">PF : Listes et Macros</font></h1>
<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#lists">Listes</a>
<li><a href="#macros">Macros</a>
</ul>

<hr>

<a name="lists"></a>
<h2>Listes</h2>
Une liste permet de spécifier plusieurs critères similaires dans une même règle.
Par exemple, plusieurs protocoles, plusieurs numéros de ports, plusieurs
adresses IP, etc. Ainsi, au lieu d'écrire une règle de filtrage pour chaque
adresse IP qui doit être bloquée, une seule règle peut être écrite en spécifiant
toutes les adresses IP à bloquer dans une liste. Les listes sont définies en
mettant des éléments entre accolades <tt>{ }</tt>.  

<p>
Quand
<a
  href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">pfctl(8)</a>
rencontre une liste durant le chargement du jeu de règles, il crée de multiples
règles : une règle pour chaque élément de la liste. Par exemple :
<blockquote>
<tt>
block out on fxp0 from { 192.168.0.1, 10.5.32.6 } to any
</tt>
</blockquote>

<p>
devient :
<blockquote>
<tt>
block out on fxp0 from 192.168.0.1 to any<br>
block out on fxp0 from 10.5.32.6 to any
</tt>
</blockquote>

<p>
Plusieurs listes peuvent être spécifiées dans une même règle. Elles ne sont pas
uniquement limitées aux règles de filtrage :
<blockquote>
<tt>
rdr on fxp0 proto tcp from any to any port { 22 80 } -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.0.6<br>
block out on fxp0 proto { tcp udp } from { 192.168.0.1, \<br> 
&nbsp;&nbsp;&nbsp;10.5.32.6 } to any port { ssh telnet }
</tt>
</blockquote>

<p>
Il est à noter que les virgules entre les éléments d'une même liste sont
optionnelles.

<a name="macros"></a>
<h2>Macros</h2>
Les macros sont des variables définies par l'utilisateur et pouvant contenir des
adresses IP, des numéros de ports, des noms d'interfaces, etc. Les macros
peuvent réduire la complexité d'un jeu de règles PF et rendent la maintenance
d'un jeu de règles beaucoup plus facile.

<p>
Les noms de macros doivent commencer par une lettre et peuvent contenir des
lettres, des chiffres, et des barres de soulignement "_". Les noms des macros ne
doivent pas être des noms réservés tels que  <tt>pass</tt>, 
<tt>out</tt>, ou <tt>queue</tt>.
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block in on $ext_if from any to any<br>
</tt>
</blockquote>

<p>
L'exemple précédent montre comment créer une macro nommée <tt>ext_if</tt>. Quand
une macro est appelée après avoir été créée, son nom est précédé d'un caractère
<tt>$</tt>. 

<p>
Macros peuvent aussi représenter des listes tel que le montre l'exemple suivant
:
<blockquote>
<tt>
friends = "{ 192.168.1.1, 10.0.2.5, 192.168.43.53 }"
</tt>
</blockquote>

<p>
Les macros peuvent être définies de manière récursive. Vu que les macros ne sont
pas traduites dans des quotes <tt>""</tt>, la syntaxe suivante doit être employée :
<blockquote>
<tt>
host1      = "192.168.1.1"<br>
host2      = "192.168.1.2"<br>
all_hosts  = "{" $host1 $host2 "}"<br>
</tt>
</blockquote>

<p>
La macro <tt>$all_hosts</tt> correspond maintenant à 192.168.1.1, 192.168.1.2. 

<p>
[<a href="config.html">Précédent : Principes de Base</a>]
[<a href="index.html">Index</a>]
[<a href="../tables.html">Suivant : Tables</a>]

<p>
<hr>
<a href="index.html"><img alt="[back]" border="0" height="24" src="../../../images/back.gif" width="24"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: macros.html,v 1.8 ]<br>
$Translation: macros.html,v 1.1 2003/12/15 21:04:13 saad Exp $<br>
$OpenBSD: macros.html,v 1.1 2003/12/16 11:02:51 horacio Exp $
</small>

</body>
</html> 
