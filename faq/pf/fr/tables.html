<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Tables</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="macros.html">Pr&eacute;c&eacute;dent : Listes et Macros</a>]
[<a href="index.html">Index</a>]
[<a href="../filter.html">Suivant : R&egrave;gles de Filtrage</a>]

<p>
<h1><font color="#e00000">PF : Tables</font></h1>

<hr>

<h3>Table des Mati&egrave;res</h3>
<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#config">Configuration</a>
<li><a href="#manip">Manipulation des Tables avec <tt>pfctl</tt></a>
<li><a href="#addr">Sp&eacute;cification des Adresses</a>
<li><a href="#match">Recherche des Adresses Correspondantes</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introduction</h2>
Une table est une structure utilis&eacute;e pour regrouper un ensemble
d'adresses IPv4 et/ou IPv6. Chercher une adresse IP dans une table est
une op&eacute;ration tr&egrave;s rapide qui consomme moins de
m&eacute;moire et de temps processeur qu'une recherche dans une
<a href="macros.html#lists">liste</a>. C'est pourquoi une table est
id&eacute;ale pour contenir un grand ensemble d'adresses IP vu que le
temps n&eacute;cessaire pour consulter le contenu d'une table de 50 000
adresses prend un tout petit peu plus de temps que la consultation d'une
table de 50 adresses. Les tables peuvent &ecirc;tre utilis&eacute;es
d'une des mani&egrave;res suivantes :
<ul>
<li>adresse source et/ou destination dans les r&egrave;gles
<a href="../filter.html">de filtrage</a>, <a href="scrub.html">scrub</a>,
<a href="../nat.html">NAT</a>, et <a href="../rdr.html">redirection</a>.
<li>adresse de traduction dans les r&egrave;gles <a href="../nat.html">NAT</a>.
<li>adresse de redirection dans les r&egrave;gles de
    <a href="../rdr.html">redirection</a>.
<li>adresse de destination dans les options des r&egrave;gles de
    filtrage <tt>route-to</tt>, <tt>reply-to</tt>, et <tt>dup-to</tt>.
</ul>

<p>
Une table peut &ecirc;tre cr&eacute;&eacute;e dans 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"><tt>pf.conf</tt></a>
ou en utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">pfctl(8)</a>.

<a name="config"></a>
<h2>Configuration</h2>
Dans <tt>pf.conf</tt>, les tables sont cr&eacute;&eacute;es en utilisant
la directive <tt>table</tt>. Les attributs suivants peuvent &ecirc;tre
sp&eacute;cifi&eacute;s pour chaque table :
<ul>
<li><tt>const</tt> - le contenu de la table ne peut &ecirc;tre
    modifi&eacute; une fois la table cr&eacute;&eacute;e. Lorsque cet
    attribut n'est pas sp&eacute;cifi&eacute;,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">pfctl(8)</a>
peut &ecirc;tre utilis&eacute; pour ajouter ou supprimer des adresses de
la table &agrave; n'importe quel moment, m&ecirc;me lorsque le
syst&egrave;me utilise un
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securelevel&amp;sektion=7&amp;manpath=OpenBSD+3.4">securelevel(7)</a>
de deux ou sup&eacute;rieur.
<li><tt>persist</tt> - conduit le noyau &agrave; garder la table en
    m&eacute;moire m&ecirc;me lorsqu'aucune r&egrave;gle ne s'y
    r&eacute;f&egrave;re. Sans cet attribut, le noyau supprimera
    automatiquement la table lorsque la derni&egrave;re r&egrave;gle s'y
    r&eacute;f&eacute;rant est supprim&eacute;e.
</ul>

<p>
Exemple :
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24 }<br>
table &lt;rfc1918&gt; const { 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }<br>
table &lt;spammers&gt; persist<br>
<br>
block in on fxp0 from { &lt;rfc1918&gt;, &lt;spammers&gt; } to any<br>
pass&nbsp; in on fxp0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Les adresses peuvent aussi &ecirc;tre sp&eacute;cifi&eacute;es en
utilisant l'op&eacute;rateur de n&eacute;gation (ou "not"). Voici un
exemple :
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24, !192.0.2.5 }
</tt>
</blockquote>

<p>
La table <tt>goodguys</tt> contient alors toutes les adresses dans le
r&eacute;seau 192.0.2.0/24 except&eacute; 192.0.2.5.

<p>
Notez que les noms de tables sont toujours entour&eacute;es des
caract&egrave;res &lt; et &gt;.

<p>
Les tables peuvent aussi &ecirc;tre peupl&eacute;es &agrave; partir de
fichiers texte contenant une liste d'adresses et de r&eacute;seaux IP :
<blockquote>
<tt>
table &lt;spammers&gt; persist file "/etc/spammers"<br>
<br>
block in on fxp0 from &lt;spammers&gt; to any<br>
</tt>
</blockquote>

<p>
Le fichier <tt>/etc/spammers</tt> doit contenir une liste d'adresses IP
et/ou des blocs r&eacute;seau en notation
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>, une
entr&eacute;e par ligne. Toute ligne commen&ccedil;ant par <tt>#</tt>
est trait&eacute;e comme un commentaire. Elle est donc ignor&eacute;e.

<a name="manip"></a>
<h2>Manipulation des Tables avec <tt>pfctl</tt></h2>
Les tables peuvent &ecirc;tre manipul&eacute;es &agrave; la vol&eacute;e
en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">pfctl(8)</a>.
Par exemple, pour ajouter des entr&eacute;es &agrave; la table
&lt;spammers&gt; pr&eacute;c&eacute;demment cr&eacute;&eacute;e :
<blockquote>
<tt># pfctl -t spammers -Tadd 218.70.0.0/16</tt>
</blockquote>

<p>
Ceci aura aussi pour effet de cr&eacute;er la table &lt;spammers&gt; si
elle n'existe pas encore. Pour afficher le contenu d'une table :
<blockquote>
<tt># pfctl -t spammers -Tshow</tt>
</blockquote>
L'argument <tt>-v</tt> peut aussi &ecirc;tre utilis&eacute; avec <tt>-
Tshow</tt> pour afficher des statistiques pour chaque entr&eacute;e de
la table. Pour supprimer des adresses de la table :
<blockquote>
<tt>
# pfctl -t spammers -Tdelete 218.70.0.0/16
</tt>
</blockquote>

<p>
Pour plus d'informations concernant la manipulation des tables avec
<tt>pfctl</tt>, veuillez consulter
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">pfctl(8)</a>.

<a name="addr"></a>
<h2>Sp&eacute;cification des Adresses</h2>
Les h&ocirc;tes peuvent &ecirc;tre sp&eacute;cifi&eacute;s par adresse
IP ou par nom. Lorsque le nom est r&eacute;solu en adresse IP, toutes
les adresses IPv6 et IPv4 r&eacute;sultantes sont plac&eacute;es dans la
table. Les adresses IP peuvent aussi &ecirc;tre saisies dans la table en
sp&eacute;cifiant le nom d'une interface valide ou le mot-cl&eacute;
<tt>self</tt> dans quel cas toutes les adresses IP assign&eacute;es
&agrave; l'interface ou aux interfaces configur&eacute;es sur le pare-
feu (si le mot-cl&eacute; <tt>self</tt> est utilis&eacute;) seront
ins&eacute;r&eacute;es dans la table.

<a name="match"></a>
<h2>Recherche des Adresses Correspondantes</h2>
La recherche d'une adresse dans une table retournera l'entr&eacute;e la
plus proche de cette adresse. Ceci permet la cr&eacute;ation de tables
telles que :
<blockquote>
<tt>
table &lt;goodguys&gt; { 172.16.0.0/16, !172.16.1.0/24, 172.16.1.100 }<br>
<br>
block in on dc0 all<br>
pass &nbsp;in on dc0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Tout paquet arrivant vers <tt>dc0</tt> verra son adresse source
recherch&eacute;e dans la table <tt>&lt;goodguys&gt;</tt>:
<ul>
<li>172.16.50.5 - l'entr&eacute;e la plus proche est 172.16.0.0/16; le
    paquet a une entr&eacute;e correspondante dans la table donc il
    passe
<li>172.16.1.25 - l'entr&eacute;e la plus proche est !172.16.1.0/24; le
    paquet a une entr&eacute;e correspondante mais celle-ci est en
    n&eacute;gation (l'op&eacute;rateur "!" est utilis&eacute;); le
    paquet n'a donc aucune entr&eacute;e correspondante et sera
    bloqu&eacute;
<li>172.16.1.100 - l'entr&eacute;e la plus proche est 172.16.1.100; le
    paquet a une entr&eacute;e correspondante dans la table donc il
    passe
<li>10.1.4.55 - n'a aucune adresse correspondante dans la table. Il sera
    bloqu&eacute;
</ul>

<p>
[<a href="macros.html">Pr&eacute;c&eacute;dent : Listes et Macros</a>]
[<a href="index.html">Index</a>]
[<a href="../filter.html">Suivant : Filtrage de Paquets</a>]

<p>
<hr>
<a href="index.html"><img alt="[back]" border="0" height="24" src="../../../images/back.gif" width="24"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: tables.html,v 1.9 ]<br>
$Translation: tables.html,v 1.4 2004/02/19 20:31:29 saad Exp $<br>
$OpenBSD: tables.html,v 1.4 2004/02/20 06:33:11 jufi Exp $
</small>

</body>
</html> 
