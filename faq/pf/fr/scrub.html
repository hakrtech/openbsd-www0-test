<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Scrub (Normalisation de Paquets)</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004, Nick Holland <nick@openbsd.org>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="options.html">Pr&eacute;c&eacute;dent : Options de
Fonctionnement</a>]
[<a href="index.html">Index</a>]
[<a href="../anchors.html">Suivant : Ancres et Bases de R&egrave;gles
Nomm&eacute;es (Sub)</a>]

<p>
<h1><font color="#e00000">PF : Scrub (Normalisation de Paquets)</font></h1>
<hr>

<h3>Table des Mati&egrave;res</h3>
<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#options">Options</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introduction</h2>
Le "scrubbing" est la normalisation de paquets utilis&eacute;e pour
supprimer toute ambigu&iuml;t&eacute; dans l'interpr&eacute;tation d'un
paquet qui sera effectu&eacute;e par la destination finale de ce
dernier. La directive <tt>scrub</tt> r&eacute;assemble aussi des paquets
fragment&eacute;s, afin de prot&eacute;ger certains syst&egrave;mes
d'exploitation de quelques types d'attaques. Cette directive rejette
aussi les paquets TCP contenants des combinaisons invalides de 
<a href="../filter.html#tcpflags">drapeaux</a>. Voici un exemple simple
d'utilisation de la directive scrub :
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
Ceci aura pour effet d'appliquer le "scrub" sur tous les paquets en
entr&eacute;e de chaque interface.

<p>
Il existe des cas o&ugrave; il ne faut pas appliquer le "scrub". Par
exemple, une interface qui v&eacute;hicule du trafic NFS &agrave;
travers PF. Certaines plates-formes non bas&eacute;es sur OpenBSD
envoient (et s'attendent &agrave; recevoir) des paquets &eacute;tranges
-- des paquets fragment&eacute;s avec le bit "do not fragment" (ne pas
fragmenter) positionn&eacute;, qui sont rejet&eacute;s (comportement
normal) par <tt>scrub</tt>. On peut r&eacute;soudre ce probl&egrave;me
en utilisant l'option <tt>no-df</tt>. Un autre exemple est l'utilisation
de jeux multi-joueurs qui ont des probl&egrave;mes de connexion &agrave;
travers PF lorsque <tt>scrub</tt> est activ&eacute;. Mis &agrave; part
ces cas quelque peu inhabituels, la normalisation de paquets "scrub" est
une pratique <i>hautement recommand&eacute;e</i>.

<p>
La syntaxe de la directive <tt>scrub</tt> est tr&egrave;s similaire
&agrave; la syntaxe de <a href="../filter.html">filtrage</a> ce qui rend
ais&eacute; la normalisation de certains paquets et pas les autres.

<p>
Vous pouvez trouver plus d'informations concernant le principe et les
concepts de la normalisation de paquets dans l'article
<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>Network Intrusion Detection: Evasion, Traffic Normalization, and
End-to-End Protocol Semantics</a>.

<a name="options"></a>
<h2>Options</h2>
Les options de <tt>scrub</tt> sont les suivantes :
<dl>
<dt><tt>no-df</tt> 
<dd>Supprime le bit <i>don't fragment</i> de l'en-t&ecirc;te du paquet
    IP. Quelques syst&egrave;mes d'exploitation sont connus pour
    g&eacute;n&eacute;rer des paquets fragment&eacute;s avec le bit
    <i>don't fragment</i> positionn&eacute;. Ceci est
    particuli&egrave;rement vrai dans le cas de NFS. <tt>scrub</tt> va
    bloquer tous les paquets qui sont dans ce cas sauf si l'option
    <tt>no-df</tt> est sp&eacute;cifi&eacute;e. Vu que certains
    syst&egrave;mes d'exploitation g&eacute;n&egrave;rent des paquets
    <i>don't fragment</i> avec un champ d'identification &agrave;
    z&eacute;eo au niveau de l'en-t&ecirc;te IP, il est
    recommand&eacute; d'utiliser <tt>no-df</tt> conjointement avec
    l'option <tt>random-id</tt>.

<dt><tt>random-id</tt> 
<dd>Remplace le champ d'identification IP des paquets sortants avec des
    valeurs al&eacute;atoires pour contourner les valeurs
    pr&eacute;visibles utilis&eacute;es par certains syst&egrave;mes
    d'exploitation. Cette option s'applique uniquement pour les paquets
    sortants qui ne sont pas fragment&eacute;s apr&egrave;s le
    r&eacute;assemblage optionnel des paquets.

<dt><tt>min-ttl <i>num</i></tt> 
<dd>S'assure que le Time To Live (TTL) est au moins &eacute;gal &agrave;
    la valeur donn&eacute;e en argument dans les en-t&ecirc;tes des
    paquets IP.

<dt><tt>max-mss <i>num</i></tt> 
<dd>S'assure que le Maximum Segment Size (MSS) est au plus &eacute;gal
    &agrave; la valeur donn&eacute;e en argument dans les en-t&ecirc;tes
    des paquets TCP.

<dt><tt>fragment reassemble</tt> 
<dd>Met dans une m&eacute;moire tampon les fragments de paquets et les
    r&eacute;assemble en paquet complet avant de les transmettre au
    moteur de filtrage. Les r&egrave;gles de filtrage peuvent ainsi se
    charger de filtrer le paquet complet sans se soucier des fragments.
    L'inconv&eacute;nient est la m&eacute;moire additionnelle
    n&eacute;cessaire pour le tampon contenant les fragments de paquets.
    C'est le comportement par d&eacute;faut lorsqu'aucune option
    <tt>fragment</tt> n'est sp&eacute;cifi&eacute;e. C'est aussi la
    seule option <tt>fragment</tt> qui fonctionne avec la NAT.

<dt><tt>fragment crop</tt> 
<dd>Supprime les fragments dupliqu&eacute;s et tout chevauchement entre
    fragment. Contrairement &agrave; <tt>fragment reassemble</tt>, les
    fragments ne sont pas gard&eacute;s en m&eacute;moire tampon mais
    sont transmis d&egrave;s leur arriv&eacute;e.

<dt><tt>fragment drop-ovl</tt> 
<dd>Assez similaire &agrave; <tt>fragment crop</tt>. Tous les paquets
    fragments de paquets dupliqu&eacute;s et se chevauchant sont
    supprim&eacute;s ainsi que tous les fragments suivants qui
    correspondent &agrave; ces fragments.

<dt><tt>reassemble tcp</tt>
<dd>Normalise de mani&egrave;re "stateful" les connexions TCP. Lorsque
    <tt>scrub reassemble tcp</tt> est utilis&eacute;e, une direction
    (in/out) peut ne pas &ecirc;tre sp&eacute;cifi&eacute;e. Les
    normalisations suivantes sont effectu&eacute;es :
        <ul>
        <li>Aucune extr&ecirc;mit&eacute; de la connexion n'est
            autoris&eacute;e &agrave; r&eacute;duire le TTL IP. Cette
            normalisation est appliqu&eacute;e pour assurer une
            protection contre un attaquant qui envoie un paquet de telle
            fa&ccedil;on &agrave; ce que ce dernier atteigne le
            pare-feu, affecte les informations d'&eacute;tat
            m&eacute;moris&eacute;es pour cette connexion, et expire
            avant d'atteindre sa destination finale. Le TTL de tous les
            paquets est positionn&eacute; &agrave; la valeur la plus
            haute observ&eacute;e pour la connexion.
        <li>Module les "timestamps" RFC 1323 dans l'en-t&ecirc;te des
            paquets TCP avec un nombre al&eacute;atoire. Ceci peut
            emp&ecirc;cher un observateur de d&eacute;duire le "uptime"
            d'un h&ocirc;te ou de deviner combien de h&ocirc;tes sont
            derri&egrave;re une passerelle NAT.
        </ul>
</dl>

<p>
Exemples :
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400<br>
scrub in on fxp0 all no-df<br>
scrub &nbsp;&nbsp; on fxp0 all reassemble tcp
</tt>
</blockquote>

<p>
[<a href="options.html">Pr&eacute;c&eacute;dent : Options de
Fonctionnement</a>]
[<a href="index.html">Index</a>]
[<a href="../anchors.html">Suivant : Ancres et Bases de R&egrave;gles
Nomm&eacute;es (Sub)</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: scrub.html,v 1.9 ]<br>
$Translation: scrub.html,v 1.4 2004/05/12 20:21:45 saad Exp $<br>
$OpenBSD: scrub.html,v 1.4 2004/05/12 20:51:36 saad Exp $
</small>

</body>
</html> 
