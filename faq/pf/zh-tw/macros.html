<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Lists and Macros</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="config.html">上一頁: 開始使用</a>]
[<a href="index.html">內容</a>]
[<a href="../tables.html">下一頁: 表格</a>]

<h1><font color="#e00000">PF: 列表與巨集</font></h1>
<hr>

<h3>目錄</h3>
<ul>
<li><a href="#lists">列表</a>
<li><a href="#macros">巨集</a>
</ul>

<hr>

<a name="lists"></a>
<h2>列表</h2>
列表可以在單一規則中指定多個類似條件。例如多種協定、多個埠號、多個位址等。
因此你不需要為每個要阻擋的 IP 位址各寫一條過濾規則，你可以在單一規則中
指定多個 IP 位址。列表的定義是將指定項目放在  <tt>{ }</tt> 括弧中。

<p>
當 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
>pfctl(8)</a> 在載入規則中遇到列表時，pfctl 會為列表中每一項目各建立一條規則。
例如:
<blockquote>
<tt>
block out on fxp0 from { 192.168.0.1, 10.5.32.6 } to any
</tt>
</blockquote>

<p>
會被擴展成:
<blockquote>
<tt>
block out on fxp0 from 192.168.0.1 to any<br>
block out on fxp0 from 10.5.32.6 to any
</tt>
</blockquote>

<p>
單一規則可以指定多個列表，你也可以在非過濾規則使用列表:
<blockquote>
<tt>
rdr on fxp0 proto tcp from any to any port { 22 80 } -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.0.6<br>
block out on fxp0 proto { tcp udp } from { 192.168.0.1, \<br> 
&nbsp;&nbsp;&nbsp;10.5.32.6 } to any port { ssh telnet }
</tt>
</blockquote>

<p>
注意列表中的逗號是可以省略的。

<a name="macros"></a>
<h2>巨集</h2>
巨集是使用者自定變數，其中可包含 IP 位址、埠號、介面名稱等。巨集可以降低
PF 規則的複雜度，讓你更容易維護規則。

<p>
巨集名稱必須以字母為起始，之後可以是字母、數字、底線。巨集名稱不可取為
<tt>pass</tt>、<tt>out</tt>、<tt>queue</tt> 等保留字。
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block in on $ext_if from any to any<br>
</tt>
</blockquote>

<p>
這會建立一個名為 <tt>ext_if</tt> 的巨集。之後需要使用這個巨集時，必須在
巨集名稱前加上 <tt>$</tt> 字元。

<p>
巨集也可以擴展為列表，例如:
<blockquote>
<tt>
friends = "{ 192.168.1.1, 10.0.2.5, 192.168.43.53 }"
</tt>
</blockquote>

<p>
巨集可以進行遞迴(巢狀)定義。由於巨集無法在引號中擴展，你必須使用以下語法:
<blockquote>
<tt>
host1      = "192.168.1.1"<br>
host2      = "192.168.1.2"<br>
all_hosts  = "{" $host1 $host2 "}"<br>
</tt>
</blockquote>

<p>
巨集 <tt>$all_hosts</tt> 現在擴展為 192.168.1.1, 192.168.1.2。

<p>
[<a href="config.html">上一頁: 開始使用</a>]
[<a href="index.html">內容</a>]
[<a href="../tables.html">下一頁: 表格</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: macros.html,v 1.11 ]<br>
$Translation: macros.html,v 1.1 2004/09/17 14:34:47 sjhuang Exp $<br>
$OpenBSD: macros.html,v 1.1 2004/09/17 15:04:47 jufi Exp $
</small>

</body>
</html> 
