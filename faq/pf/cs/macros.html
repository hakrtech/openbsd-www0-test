<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Seznamy a Makra</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../cs/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="config.html">Předchozí: Začínáme</a>]
[<a href="index.html">Obsah</a>]
[<a href="tables.html">Další: Tabulky</a>]

<h1><font color="#e00000">PF: Seznamy a Makra</font></h1>
<hr>

<h3>Obsah</h3>
<ul>
<li><a href="#lists">Seznamy</a>
<li><a href="#macros">Makra</a>
</ul>

<hr>

<a name="lists"></a>
<h2>Seznamy</h2>
Seznam umožňuje specifikaci několika podobných kritérií za pomoci jediného
pravidla. Například několik protokolů, čísel portů, adres, atp. Takže místo
psaní filtrovacího pravidla pro každou IP adresu, kterou je třeba blokovat
stačí toto pravidlo napsat za pomocí specifikace IP adres v seznamu. Seznamy
jsou definovány pomocí specifikace položek ve složených <tt>{ }</tt>
závorkách.

<p>
Když
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pfctl(8)</a> narazí na seznam během nahrávání pravidel, tak vytvoří
několikanásobné pravidlo, jedno pro každou položku v seznamu. Například:
<blockquote>
<tt>
block out on fxp0 from { 192.168.0.1, 10.5.32.6 } to any
</tt>
</blockquote>

<p>
se rozšíří na:
<blockquote>
<tt>
block out on fxp0 from 192.168.0.1 to any<br>
block out on fxp0 from 10.5.32.6 to any
</tt>
</blockquote>

<p>
Vícenásobné seznamy mohou být specifikovány uvnitř pravidla:
<blockquote>
<tt>
match in on fxp0 proto tcp to port { 22 80 } rdr-to 192.168.0.6<br>
block out on fxp0 proto { tcp udp } from { 192.168.0.1, \<br> 
&nbsp;&nbsp;&nbsp;10.5.32.6 } to any port { ssh telnet }
</tt>
</blockquote>

<p>
Všimněte si, že čárky mezi položkama nejsou povinné.

<p>
Seznamy také mohou obsahovat vnořené seznamy:

<blockquote>
<tt>
trusted = "{ 192.168.1.2 192.168.5.36 }"<br>
pass in inet proto tcp from { 10.10.0.0/24 $trusted } to port 22
</tt>
</blockquote>

<p>

Vyhněte se konstrukcím jako je ta následující, "negované seznamy"
, které jsou běžnou chybou:
<blockquote>
<tt>
pass in on fxp0 from { 10.0.0.0/8, !10.1.2.3 }
</tt>
</blockquote>

<p>
Zamýšleným výsledkem je obvykle tato aplikace
"jakákoliv adresa v rozsahu 10.0.0.0/8, mimo 10.1.2.3",
ale pravidlo se rozšíří na:
<blockquote>
<tt>
pass in on fxp0 from 10.0.0.0/8<br>
pass in on fxp0 from !10.1.2.3
</tt>
</blockquote>

<p>
které je platné pro jakoukoliv adresu. Je tedy lépe použít
<a href="tables.html">tabulku</a> místo výše uvedeného.

<a name="macros"></a>
<h2>Makra</h2>
Makra jsou uživatelem definované proměnné, které mohou obsahovat IP adresy,
čísla portů, jména síťových rozhraní, atp. Makra mohou snížit komplexnost
PF pravidel a také umožňují mnohem lehčí správu pravidel.

<p>
Jména maker musí začínat písmenem a mohou obsahovat písmena, číslice a
podtržítko. Jména maker nemohou být rezervovaná slova jako <tt>pass</tt>, 
<tt>out</tt> nebo <tt>queue</tt>.
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block in on $ext_if from any to any<br>
</tt>
</blockquote>

<p>
Toto vytvoří makro pojmenované <tt>ext_if</tt>. Když se pak na makro
po jeho vytvoření odkazuje, tak se před jeho jméno přidá znak <tt>$</tt>.

<p>
Makra se také mohou rozšiřovat do seznamů, jako např.
<blockquote>
<tt>
friends = "{ 192.168.1.1, 10.0.2.5, 192.168.43.53 }"
</tt>
</blockquote>

<p>
Makra mohou být definovaná rekurzivně. Protože makra nejsou v uvozovkách
expandovaná, tak musí být použita následující syntaxe:
<blockquote>
<tt>
host1      = "192.168.1.1"<br>
host2      = "192.168.1.2"<br>
all_hosts  = "{" $host1 $host2 "}"<br>
</tt>
</blockquote>

<p>
Makro <tt>$all_hosts</tt> se nyní expanduje do 192.168.1.1, 192.168.1.2.

<p>
[<a href="config.html">Předchozí: Začínáme</a>]
[<a href="index.html">Obsah</a>]
[<a href="tables.html">Další: Tabulky</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: macros.html,v 1.27 ]<br>
$Translation: macros.html,v 1.6 2010/11/04 15:26:12 bodie Exp $<br>
-->
$OpenBSD: macros.html,v 1.6 2010/11/06 00:17:30 ajacoutot Exp $
</small>

</body>
</html> 
