<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Scrub</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="options.html">Pøedchozí: Mo¾nosti (options)</a>]
[<a href="index.html">Obsah</a>]
[<a href="queueing.html">Dále: Queueing</a>]

<p>
<h1><font color="#e00000">PF: Scrub</font></h1>
<hr>

<h3>Obsah</h3>
<ul>
<li><a href="#intro">Úvod</a>
<li><a href="#options">Mo¾nosti</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Úvod</h2>
"Scrubbing" je normalizace paketù tak, aby se odstranili
nejednoznaènosti v interpretaci na cílové destinaci paketu.
Direktiva scrub zároveò znovu spojí fragmentované pakety, èím¾ ochrání
nìkteré operaèní systémy od nìkterých zpùsobù útoku a zahodí TCP pakety,
které mají neplatnou kombinaci <a href="filter.html#tcpflags">flagù</a>.
Jednoduchá forma direktivy scrub:
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
To provede scrub na v¹echny pøijázející pakety na v¹ech rozhraních.

<p>
Jedním z dùvodù, proè nepou¾ívat scrub na rozhraní mù¾e být, ¾e
propou¹títe NFS skrz PF. Nìkteré ne-OpenBSD systémy posílají (a
oèekávají) zvlá¹tní pakety -- fragmentované pakety s nastaveným bitem
"do no fragment", které jsou (oprávnìnì) odmítnuté <tt>scrub</tt>em.
Vyøe¹it to mù¾ete pou¾itím volby <tt>no-df</tt>. Dal¹ím dùvodem mohou
být nìkteré multi-player hry, které mají problémy se spojením skrz PF se
zapnutým <tt>scrub</tt>. Nepoèítaje tyto víceménì neobvyklé pøípady je
"scrubbing" v¹ech paketù <i>velmi doporuèenou</i> zásadou.

<p>
Syntaxe direktivy <tt>scrub</tt> je velmi podobná syntaxi
<a href="filter.html">filtrování</a>, co¾ umo¾òuje snadno scrubovat
nìkteré pakety a jiné nikoliv. 

<p>
Více informací o principech a koncepci scrubbingu najdete zde:
<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html</a>

<a name="options"></a>
<h2>Mo¾nosti</h2>
<tt>Scrub</tt> má následující mo¾nosti:
<dl>
<dt><tt>no-df</tt> 
<dd>Ma¾e <i>don't fragment</i> bit IP hlavièky paketu.
O nìkterých operaèních systémech je známo, ¾e generují fragmentované
pakety s nastaveným bitem <i>don't fragment</i>. To platí zejména o NFS.
<tt>Scrub</tt> zahodí takové pakety pokud není specifikována volba
<tt>no-df</tt>. Proto¾e nìkteré operaèní systémy generují <i>don't
fragment</i> pakety s nulovou polo¾kou identifikace v IP hlavièce,
doporuèujeme pou¾ívat <tt>no-df</tt> spolu s <tt>random-id</tt>.

<dt><tt>random-id</tt> 
<dd>Nahrazuje polo¾ku IP identifikace odchozích paketù náhodnou
hodnotou, aby se kompenzovalo, ¾e nìkteré operaèní systémy pou¾ívají
pøedvídatelnou hodnotu. Tato volba se vztahuje pouze na odchozí pakety,
které nejsou fragmentované po volitelném opìtovném spojení paketù.

<dt><tt>min-ttl <i>num</i></tt> 
<dd>Vynucuje minimální Time To Live (TTL)
v IP hlavièce.

<dt><tt>max-mss <i>num</i></tt> 
<dd>Vynucuje maximální Maximum Segment
Size (MSS) v TCP hlavièce paketu.

<dt><tt>fragment reassemble</tt> 
<dd>Ukládá pøíchozí fragmenty paketù do bufferù a kompletuje paket pøed
pøedáním filtrovacímu mechanismu. Výhodou je, ¾e filtrovací pravidla se
musí zabývat pouze kompletními pakety a mohou ignorovat fragmenty.
Nevýhodou jsou zvý¹ené pamì»ové nároky na bufferování fragmentù paketù.
Toto je defaultní chování, pokud není specifikována ¾ádná
<tt>fragment</tt> volba. Je to také jediné nastavení <tt>fragment</tt>,
které funguje s NAT.

<dt><tt>fragment crop</tt> 
<dd>Zpùsobuje, ¾e duplikátní fragmenty budou zahozeny a pøekrývající se
èásti oøíznuty. Narozdíl od <tt>fragment reassemble</tt> nejsou
fragmenty bufferovány, ale jsou pu¹tìny okam¾itì kdy¾ pøicházejí.

<dt><tt>fragment drop-ovl</tt> 
<dd>Podobné <tt>fragment crop</tt>
s výjimkou, ¾e v¹echny duplikované a pøekrývající se fragmenty budou
zahozeny, stejnì jako v¹echny dals¹í související fragmenty.
</dl>

<p>
Pøíklad:
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400
</tt>
</blockquote>

<p>
[<a href="options.html">Pøedchozí: Mo¾nosti (options)</a>]
[<a href="index.html">Obsah</a>]
[<a href="queueing.html">Dále: Queueing</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: scrub.html,v 1.6 ]
<br>
$Translation: scrub.html,v 1.1 2003/11/02 21:53:47 certik Exp $
<br>
$OpenBSD: scrub.html,v 1.1 2003/11/03 14:24:05 horacio Exp $
</small>

</body>
</html> 
