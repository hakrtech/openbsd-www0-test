<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Tabulky</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
<p>
[<a href="macros.html">Pøedchozí: Seznamy a makra</a>]
[<a href="index.html">Obsah</a>]
[<a href="options.html">Dále: Options</a>]

<p>
<h1><font color="#e00000">PF: Tabulky</font></h1>

<hr>

<h3>Obsah</h3>
<ul>
<li><a href="#intro">Úvod</a>
<li><a href="#config">Konfigurace</a>
<li><a href="#manip">Manipulace pomocí <tt>pfctl</tt></a>
<li><a href="#addr">Specifikování adres</a>
<li><a href="#match">Address Matching</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introduction</h2>
Tabulky jsou pou¾ívány k ulo¾ení skupiny IPv4 a/nebo IPv6 adres.
Vyhledávání v tabulkách je velmi rychlé a potøebuje ménì pamìti a
procesorového èasu ne¾ <a href="macros.html#lists">seznamy</a>.
Z tohoto dùvodu je tabulka ideální pro ulo¾ení velké skupiny adres,
proto¾e vyhledání v tabulce obsahující 50.000 adres je jen o málo
pomalej¹í ne¾ v tabulce s 50 adresami. Tabulky mohou být pou¾ity namísto
zdrojových a cílových adres v pravidlech
<a href="filter.html">filter</a>, 
<a href="scrub.html"><tt>scrub</tt></a>,
<a href="nat.html"><tt>nat</tt></a>, 
a <a href="rdr.html">redirection</a>,
ale nemohou být pou¾ity jako cílové adresy v pravidlech <tt>nat</tt>
nebo v routovacích volbách (<tt>route-to</tt>, <tt>reply-to</tt>,
<tt>dup-to</tt>) filtrovacích pravidel. Tabulky se vytváøejí v souboru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
><tt>/etc/pf.conf</tt></a> nebo pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a>.

<a name="config"></a>
<h2>Konfigurace</h2>
V souboru <tt>pf.conf</tt> se tabulky vytváøejí direktivou
<tt>table</tt>. Pro ka¾dou tabulku mohou být specifikovány následující
vlastnosti:
<ul>
<li><tt>const</tt> - obsah této tabulky nemù¾e být zmìnìn poté, co je
vytvoøena. Pokud tento atribut není specifikován,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a> mù¾e být kdykoliv pou¾it k pøidání nebo odebrání
adresy z tabulky, i pøi bìhu v úrovni
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securelevel&amp;sektion=7&amp;manpath=OpenBSD+3.3"
>securelevel(7)</a> dva nebo vy¹¹í.
<li><tt>persist</tt> - zpùsobí, ¾e jádro ponechá tabulku v pamìti i kdy¾
ji nepou¾ívá ¾ádné pravidlo. Bez této volby jádro automaticky odstraní
tabulku pøi odstraòovaní posledního pravidla na ní odkazujícího.
</ul>

<p>
Pøíklad:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24 }<br>
table &lt;rfc1918&gt; const { 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }<br>
table &lt;spammers&gt; persist<br>
<br>
block in on fxp0 from { &lt;rfc1918&gt;, &lt;spammers&gt; } to any<br>
pass&nbsp; in on fxp0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Adresy mohou být také specifikovány pomocí negaèního modifikátoru (nebo
"not"), napø.:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24, !192.0.2.5 }
</tt>
</blockquote>

<p>
Tabulka <tt>goodguys</tt> nyní odpovídá v¹em adresám v síti 192.0.2.0/24
s výjimkou 192.0.2.5.

<p>
V¹imnìte si, ¾e názvy tabulek jsou v¾dy uzavøeny mezi &lt; &gt;.

<p>
Tabulky také mohou být naèteny z textového souboru obsahujícího seznam
IP adres a sítí:
<blockquote>
<tt>
table &lt;spammers&gt; persist file "/etc/spammers"<br>
<br>
block in on fxp0 from &lt;spammers&gt; to any<br>
</tt>
</blockquote>

<p>
Soubor <tt>/etc/spammers</tt> y obsahoval seznam IP adres, na ka¾dém
øádku jednu. Ka¾dá øádka zaèínající <tt>#</tt> je pova¾ována za komentáø
a je ignorována.

<a name="manip"></a>
<h2>Manipulace pomocí <tt>pfctl</tt></h2>
Tabulky mohou být mìnìny za bìhu pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a>.
Napøíklad pøidání polo¾ky do tabulky &lt;spammers&gt; vytvoøené vý¹e:
<blockquote>
<tt># pfctl -t spammers -Tadd 218.70.0.0/16</tt>
</blockquote>

<p>
Tím bude také vytvoøena tabulka &lt;spammers&gt;, pokud je¹tì
neexistovala. Pro vypsání adres v tabulce:
<blockquote>
<tt># pfctl -t spammers -Tshow</tt>
</blockquote>
Volba <tt>-v</tt> mù¾e být také pou¾ita spolu s <tt>-Tshow</tt> k
vypsání statistik pro ka¾dou polo¾ku tabulky. Odstranìní adresy z
tabulky:
<blockquote>
<tt>
# pfctl -t spammers -Tdelete 218.70.0.0/16
</tt>
</blockquote>

<p>
Dal¹í informace o manipulování s tabulkami pomocí <tt>pfctl</tt>
naleznete v
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
><tt>pfctl(8)</tt></a>.

<a name="addr"></a>
<h2>Specifikování adres</h2>
Kromì specifikování IP adresou mù¾e být poèítaè také urèen svým
hostname. kdy¾ je jméno pøevedeno na IP adresu, v¹echny výsledné IPv4 a
IPv6 adresy jsou pøidány do tabulky. IP adresy mohou být také zadány
urèením platného názvu rozhraní nebo klíèovým slovem <tt>self</tt>,
které zpùsobí pøidání v¹ech adres asociovaných s rozhraním(i) do
tabulky.

<a name="match"></a>
<h2>Address Matching</h2>
Vyhledání adresy v tabulce vrátí nejpøesnìji odpovídající polo¾ku. To
umo¾òuje vutvoøení tabulky jako tøeba:
<blockquote>
<tt>
table &lt;goodguys&gt; { 172.16.0.0/16, !172.16.1.0/24, 172.16.1.100 }<br>
<br>
block in on dc0 all<br>
pass &nbsp;in on dc0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
Zdrojová adresa ka¾dého paketu procházejícího rozhraním dc0 bude
porovnána s tabulkou <tt>&lt;goodguys&gt;</tt>:
<ul>
<li>172.16.50.5 - nejpøesnìjsí shoda je 172.16.0.0/16; paket odpovídí
tabulce a bude pu¹tìn
<li>172.16.1.25 - nejpøesnìj¹í shoda je !172.16.1.0/24; paket odpovídá
polo¾ce tabulku, ale tato polo¾ko je negovaná (pou¾ívá modifikátor "!");
paket neodpovídá tabulce a bude zablokován
<li>172.16.1.100 - pøesnì odpovídá 172.16.1.100; paket odpovídá tabulce
a bude pu¹tìn
<li>10.1.4.55 - neodpovídá tabulce a bude zablokován
</ul>

<p>
[<a href="macros.html">Pøedchozí: Seznamy a makra</a>]
[<a href="index.html">Obsah</a>]
[<a href="options.html">Dále: Options</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: tables.html,v 1.6 ]
<br>
$Translation: tables.html,v 1.3 2003/11/10 13:34:59 horacio Exp $
<br>
$OpenBSD: tables.html,v 1.3 2003/11/10 14:42:48 horacio Exp $
</small>

</body>
</html> 
