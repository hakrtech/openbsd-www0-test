<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Scrub (Normalización de Paquetes)</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--

Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003-2005, Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../es/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="options.html">Anterior: Opciones en tiempo de
ejecución</a>]
[<a href="index.html">Contenidos</a>]
[<a href="anchors.html">Siguiente: Anclajes</a>]

<p>
<h1><font color="#e00000">PF: Scrub:  Normalización de
paquetes</font></h1>
<hr>

<h3>&Iacute;ndice de Contenidos</h3>
<ul>
<li><a href="#intro">Introducción</a>
<li><a href="#options">Opciones</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introducción</h2>
<p>
<i>Scrubbing</i> es la normalización de paquetes con
el objetivo de que no existan ambig&uuml;edades de interpretación
en el destino final del paquete.  La directiva <i>scrub</i>
también realiza el reensamblaje de paquetes fragmentados,
protegiendo a algunos sistemas operativos de ciertos tipos de ataques y
bloqueando los paquetes TCP que lleven una combinación no
válida del indicador de TCP (véase
<a href="filter.html#tcpflags">flag</a>).  Una forma simple de la
directiva <i>scrub</i> sería:
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
Con este ejemplo de <i>scrub</i> se normalizarían todos los
paquetes entrantes en todas las interfaces.

<p>
Un motivo para no usar <i>scrub</i> en una interfaz sería que se
estuviera pasando tráfico de NFS a través de PF.  Algunas
plataformas no OpenBSD envían (y esperan recibir) paquetes
extraños, paquetes fragmentados con el <i>bit</i> <i>&quot;do not
fragment&quot;</i> activado, y éstos son rechazados con motivo
por <tt>scrub</tt>.  Este problema se puede solucionar usando la
opción <tt>no-df</tt>.  Otro motivo para no usar <i>scrub</i> es
que algunos juegos de jugadores múltiples tienen problemas de
conexión al pasar a través de PF con la directiva
<tt>scrub</tt> activada.  A parte de estos casos poco usuales, el uso de
<i>scrub</i> en todos los paquetes es una práctica <i>muy
recomendable</i>.

<p>
La sintaxis de la directiva <tt>scrub</tt> es muy parecida a la sintaxis
del <a href="filter.html">filtro de paquetes</a>, lo que facilita el uso
de <i>scrub</i> en cierto paquetes y no en otros.

<p>
Puede verse más información sobre los principios y
conceptos de <i>scrub</i> en el artículo académico
<i><a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>Network Intrusion Detection: Evasion, Traffic Normalization, and
End-to-End Protocol Semantics</a></i>.

<a name="options"></a>
<h2>Opciones</h2>
La directiva <tt>scrub</tt> acepta las siguientes opciones:
<dl>
<dt><tt>no-df</tt> 
<dd>Elimina el <i>bit</i> &quot;<i>don't fragment</i>&quot; de la
cabecera del paquete de IP.  Se sabe que algunos sistemas operativos
generan paquetes fragmentados con <i>don't fragment</i> activado.  En
concreto, esto es lo que ocurre con NFS.  <i>Scrub</i> bloquea esos
paquetes a menos que se especifique la opción <tt>no-df</tt>.
Debido a que algunos sistemas operativos generan paquetes <i>don't
fragment</i> con un campo de cabecera de identificación de IP
nulo, se recomienda usar <tt>no-df</tt> junto con <tt>random-ip</tt>.

<dt><tt>random-id</tt> 
<dd>Sustituye el campo de identificación de IP de los paquetes
con valores aleatorios, para compensar la existencia de
sistemas operativos que usan valores predecibles.  Esta opción
sólo se aplica a los paquetes que no estén
fragmentados después del reensamblaje opcional de paquetes.

<dt><tt>min-ttl <i>num</i></tt> 
<dd>Impone un <i>Time To Live</i> (TTL, un tiempo de vida) mínimo
en cabeceras de paquetes IP.

<dt><tt>max-mss <i>num</i></tt> 
<dd>Impone un <i>Maximum Segment Size</i> (MSS, un tamaño
máximo de segmento) máximo en cabeceras de paquetes TCP.

<dt><tt>fragment reassemble</tt> 
<dd>Almacena en memoria fragmentos de paquetes entrantes y los
reensambla en un paquete completo antes de pasarlos a la maquinaria de
filtrado.  La ventaja de esto es que las reglas de filtrado sólo
tienen que tratar con paquetes completos y pueden ignorar los
fragmentos.  La desventaja es que necesita más memoria para
almacenar temporalmente los fragmentos de los paquetes.  Cuando no se
especifica la opción <tt>fragment</tt>, este funcionamiento es el
predeterminado.  También es la única opción de
<tt>fragment</tt> que funciona con NAT.

<dt><tt>fragment crop</tt> 
<dd>Provoca que se rechacen los fragmentos duplicados y que se recorten
los que coincidan en parte.  A diferencia de
<tt>fragment&nbsp;reassemble</tt>, los fragmentos no se almacenan
temporalmente en la memoria, sino que que se pasan en cuanto llegan.

<dt><tt>fragment drop-ovl</tt> 
<dd>Parecido a <tt>fragment crop</tt>, con la diferencia de que todos
los fragmentos duplicados o que coincidan, así como cualquier
fragmento correspondiente a continuación, son rechazados.

<dt><tt>reassemble tcp</tt>
<dd>Normaliza las conexiones TCP manteniendo el estado.
Cuando se usa <tt>scrub reassemble tcp</tt>, no se puede especificar una
dirección (entrante/saliente).  Lleva a cabo las siguientes
normalizaciones en el paquete:
	<ul>
	<li>A ninguna parte de la conexión se le permite reducir su
	IP TTL.  Esto es así para proteger contra la posibilidad de
	que un atacante que envíe un paquete que alcance el
	cortafuegos, afecte la información de estado mantenida para
	la conexión, y que ésta caduque antes de alcanzar el
	anfitrión de destino.  El TTL de todos los paquetes se eleva
	al máximo valor visto para la conexión.
	<li>Modulación de las marcas de tiempo
	<a href="http://www.geektools.com/rfc/rfc1323.txt">RFC1323</a>
	en las cabeceras de paquetes TCP con un número aleatorio.
	Esto puede evitar que un observador deduzca el tiempo de actividad
	(<i>uptime</i>) del anfitrión, o que pueda adivinar
	cuántos anfitriones se encuentran detrás de la
	pasarela de NAT.
	</ul>
</dl>

<p>
Ejemplos:
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400<br>
scrub in on fxp0 all no-df<br>
scrub &nbsp;&nbsp; on fxp0 all reassemble tcp
</tt>
</blockquote>

<p>
[<a href="options.html">Anterior: Opciones en tiempo de
ejecución</a>]
[<a href="index.html">Contenidos</a>]
[<a href="anchors.html">Siguiente: Anclajes</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: scrub.html,v 1.15 ]<br>
$Translation: scrub.html,v 1.11 2011/02/17 12:24:10 mvidal Exp $<br>
-->
$OpenBSD: scrub.html,v 1.10 2011/02/17 23:28:45 ajacoutot Exp $
</small>

</body>
</html> 
