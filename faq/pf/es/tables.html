<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Tablas</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../es/index.html">
<img alt="[OpenBSD]" height="30" width="141" 
src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="macros.html">Anterior: Listas y macros</a>]
[<a href="index.html">Contenidos</a>]
[<a href="filter.html">Siguiente: Filtrado de paquetes</a>]

<p>
<h1><font color="#e00000">PF: Tablas</font></h1>

<hr>

<h3>Índice de contenidos</h3>
<ul>
<li><a href="#intro">Introducción</a>
<li><a href="#config">Configuración</a>
<li><a href="#manip">Manipulación de tablas con <tt>pfctl</tt></a>
<li><a href="#addr">Especificación de direcciones</a>
<li><a href="#match">Concordancia de direcciones</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introducción</h2>
<p>
Una tabla se usa para contener un grupo de direcciones de IPv4 y/o IPv6.
Las búsquedas (<i>lookups</i>) en una tabla son muy
rápidas y consumen menos memoria y recursos del procesador que
las <a href="macros.html#lists">listas</a>.  Por ello, una tabla es
ideal para contener un grupo grande de direcciones, ya que el tiempo que
tarda una búsqueda en una tabla con 50.000 direcciones es poco
más que el tiempo que se tarda para otra con 50 direcciones.  Las
tablas se pueden usar de las siguientes formas:
<ul>
<li>dirección de origen y/o destino en las reglas.
<li>opciones de reglas <tt>nat-to</tt> and <tt>rdr-to</tt> 
en las direcciones de traducción y de redirección, respectivamente.
<li>dirección de destino en las opciones de las reglas  
<tt>route-to</tt>, <tt>reply-to</tt> y <tt>dup-to</tt>.
</ul>

<p>
Las tablas se crean bien en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.8"
><tt>pf.conf</tt></a>
o bien mediante la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pfctl(8)</a>.

<a name="config"></a>
<h2>Configuración</h2>
<p>
En <tt>pf.conf</tt>, las tablas se crean usando la directiva
<tt>table</tt>.  Se pueden especificar los siguientes atributos para
cada tabla:
<ul>
<li><tt>const</tt> - no se puede cambiar el contenido de una tabla una
vez que se haya creado la tabla.  Si no se especifica este atributo, se
puede usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pfctl(8)</a>
para añadir o eliminar direcciones de la tabla en cualquier
momento, incluso cuando se esté ejecutando un nivel de seguridad
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=securelevel&amp;sektion=7"
>securelevel(7)</a>)
de nivel dos o mayor.
<li><tt>persist</tt> - hace que el núcleo del sistema conserve la
tabla en la memoria aun cuando ninguna regla haga referencia a la tabla.
Sin este atributo, el núcleo eliminará la tabla
automáticamente cuando se haya liberado (<i>flush</i>) la
última regla que haga referencia a la tabla.
</ul>

<p>
Ejemplo:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24 }<br>
table &lt;rfc1918&gt; const { 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }<br>
table &lt;spammers&gt; persist<br>
<br>
block in on fxp0 from { &lt;rfc1918&gt;, &lt;spammers&gt; } to any<br>
pass&nbsp; in on fxp0 from &lt;goodguys&gt; to any<br>
</tt>
</blockquote>

<p>
También se pueden especificar direcciones usando el modificador
de negación, &quot;!&quot; (o &quot;not&quot;), como:
<blockquote>
<tt>
table &lt;goodguys&gt; { 192.0.2.0/24, !192.0.2.5 }
</tt>
</blockquote>

<p>
Ahora, en la tabla <tt>goodguys</tt> concordarán todas las
direcciones en la red 192.0.2.0/24 excepto la dirección
192.0.2.5.

<p>
Nótese que los nombres de las tablas siempre van entre &lt; &gt;.

<p>
En las tablas también se pueden incluir ficheros de texto que
contengan una lista de direcciones IP y redes:
<blockquote>
<tt>
table &lt;spammers&gt; persist file "/etc/spammers"<br>
<br>
block in on fxp0 from &lt;spammers&gt; to any<br>
</tt>
</blockquote>

<p>
El fichero <tt>/etc/spammers</tt> contendría una lista de
direcciones IP y/o de bloques de red
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>, una/o
por línea.  Cualquier línea que empiece con un
carácter <tt>#</tt> se tratará como un comentario y no se
procesará.

<a name="manip"></a>
<h2>Manipulación de tablas con <tt>pfctl</tt></h2>
<p>
Las tablas se pueden manipular al vuelo usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pfctl(8)</a>.
Por ejemplo, para añadir entradas a la tabla &lt;spammers&gt; que
se ha creado antes:
<blockquote>
<tt># pfctl -t spammers -T add 218.70.0.0/16</tt>
</blockquote>

<p>
Esto también creará la tabla &lt;spammers&gt; si no
existía anteriormente.  Para ver un listado de las direcciones en
una tabla:
<blockquote>
<tt># pfctl -t spammers -T show</tt>
</blockquote>
<p>
El argumento <tt>-v</tt> también se puede usar con
<tt>-Tshow</tt> para mostrar estadísticas por cada entrada de la
tabla.  Para eliminar direcciones de una tabla:
<blockquote>
<tt>
# pfctl -t spammers -T delete 218.70.0.0/16
</tt>
</blockquote>

<p>
Para más información sobre la manipulación de
tablas con <tt>pfctl</tt>, por favor lea la página del manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pfctl(8)</a>.

<a name="addr"></a>
<h2>Especificación de direcciones</h2>
<p>
Además de especificarse por la dirección IP, los
anfitriones (<i>hosts</i>) también se pueden especificar por su
nombre de anfitrión (<i>hostname</i>).  Cuando el nombre de
anfitrión se resuelve en una dirección IP, todas las
direcciones IPv4 y IPv6 resultantes se introducen en la tabla.  Las
direcciones IP también se pueden introducir en una tabla
especificando un nombre de interfaz válido o la clave
<tt>self</tt>.  La tabla contendrá todas las direcciones IP
asignadas a esa interfaz o grupo, o a la máquina 
(incluyendo direcciones de <i>loopback</i>), respectivamente.<br>
<br>
Una limitación al especificar direcciones es que 
<tt>0.0.0.0/0</tt> y <tt>0/0</tt> no funcionan en tablas. La
alternativa consiste en escribir esa dirección manualmente o 
usar una <a href="macros.html#macros">macro</a>.

<a name="match"></a>
<h2>Concordancia de direcciones</h2>
<p>
La búsqueda de una dirección en una tabla
devolverá la entrada que concuerde con más
precisión.  Esto permite la creación de tablas como:
<blockquote>
<tt>
table &lt;goodguys&gt; { 172.16.0.0/16, !172.16.1.0/24, 172.16.1.100 }<br>
<br>
block in on dc0<br>
pass &nbsp;in on dc0 from &lt;goodguys&gt;<br>
</tt>
</blockquote>

<p>
La dirección de origen de cualquier paquete que entre a
través de <tt>dc0</tt> tendrá una concordancia en la tabla
<tt>&lt;goodguys&gt;</tt>:
<ul>
<li>172.16.50.5 - la concordancia más precisa es 172.16.0.0/16;
el paquete concuerda con una entrada en la tabla y se le
permitirá pasar
<li>172.16.1.25 - la concordancia más precisa es !172.16.1.0/24;
el paquete concuerda con una entrada en la tabla, pero esa entrada es
una negación (usa el modificador &quot;!&quot;);  el paquete 
no concuerda con ninguna entrada en la tabla y será bloqueado
<li>172.16.1.100 - concuerda exactamente con 172.16.1.100; el paquete
concuerda con una entrada en la tabla y se le permitirá pasar
<li>10.1.4.55 - no concuerda con ninguna entrada en la tabla y
será bloqueado
</ul>

<p>
[<a href="macros.html">Anterior: Listas y macros</a>]
[<a href="index.html">Contenidos</a>]
[<a href="filter.html">Siguiente: Filtrado de paquetes</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: tables.html,v 1.28 ]<br>
$Translation: tables.html,v 1.10 2011/02/18 13:44:12 mvidal Exp $<br>
-->
$OpenBSD: tables.html,v 1.9 2011/02/20 10:08:24 ajacoutot Exp $
</small>

</body>
</html> 
