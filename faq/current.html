<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2005-2013 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>

<p>

<h1><font color="#e00000">Following <i>-current</i></font></h1>
<hr>

<h3>Table of Contents</h3>
<p>
<ul>
<li><a href="#Intro">Introduction</a>
<!-- Oldest on top... -->
<li><a href="#20130310">2013/03/10 - fontconfig update</a>
<li><a href="#20130311">2013/03/11 - pf translation counter added</a>
<li><a href="#20130325">2013/03/25 - Perl update</a>
<li><a href="#20130404">2013/04/04 - com(4) devices on amd64 and i386</a>
<li><a href="#20130415">2013/04/15 - struct statfs change</a>
<li><a href="#20130416">2013/04/16 - Ports: mail/roundcubemail update</a>
<li><a href="#20130419">2013/04/19 - struct swdevt change</a>
<li><a href="#20130429">2013/04/29 - rc.conf(8) pre-rc.d(8) backward compatibility removed</a>
<li><a href="#20130501">2013/05/01 - Packages: sysutils/cfengine update</a>
<li><a href="#20130601">2013/06/01 - Directories in /usr/share/locale to delete</a>
<li><a href="#20130601b">2013/06/01 - Removed /usr/include/spinlock.h header</a>
<li><a href="#20130602">2013/06/02 - bgplg(8) and slowcgi(8) sockets moved to /var/www/run</a>
<li><a href="#20130602b">2013/06/02 - some mg(1) dired commands renamed</a>
<li><a href="#20130604">2013/06/04 - Manpages to delete</a>
<li><a href="#20130607">2013/06/07 - X server modules to delete</a>
<li><a href="#20130607b">2013/06/07 - inteldrm(4) ABI break</a>
<li><a href="#20130617">2013/06/17 - KerberosV update needs build tools to be compiled first</a>
<li><a href="#20130618">2013/06/18 - Removed /usr/include/pcap-int.h header</a>
<li><a href="#20130621">2013/06/21 - Several files are not needed after the KerberosV update</h3>
<li><a href="#20130705">2013/07/05 - vax port switches to ELF</a>
<!-- New additions go on the bottom, please -->
</ul>

<hr>

<a name="Intro"></a>
<!-- XXXversion -->
<h2>Introduction</h2>
This document is for people who wish to follow <i>-current</i>.
It contains information about changes from 5.3-release to <i>-current</i>,
and should NOT be used by anyone upgrading from 5.2 or earlier, or people
wishing to follow <a href="../stable.html"><i>-stable</i></a>.

<p>
If you wish to update to 5.3-release or 5.3-stable from previous
versions, see the <a href="upgrade53.html">upgrade guide</a>.

<p>
Make sure you have read and understood
<a href="faq5.html">FAQ 5 - Building the System from Source</a>
before using -current and the instructions below.

<p>
You should ALWAYS use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
Most of these changes will have to be performed as root.

<p>
<a name="20130310"></a>
<h3>2013/03/10 - fontconfig update</h3>
Fontconfig in xenocara has been updated to version 2.10.91 and has
switched to a BSD make build system.
This new version of fontconfig deprecates the use of
<tt>~/.fonts.conf</tt> for local configuration. Make sure the users
who have created this file move it to its new location:
<blockquote><pre><b>
    mkdir -p ~/.config/fontconfig
    mv ~/.fonts.conf ~/.config/fontconfig/fonts.conf
</b></pre></blockquote>
Until all ports have been updated to use the new fontconfig, expect
some (mostly harmless) warnings about syntax of some of the new files
in <tt>/etc/fonts/conf.d</tt>.

<p>
<a name="20130311"></a>
<h3>2013/03/11 - pf translation counter added</h3>
A separate "translation" counter was added to identify when NAT has failed
due to a lack of ports in the range configured in the rule.
Packages using PFIOCGETSTATUS (e.g. symon and pfstat) need to be updated
to current versions (and as usual kernel and userland must be in sync).
Package version numbers have been bumped so pkg_add -u will update them
when new packages are available.

<p>
<a name="20130325"></a>
<h3>2013/03/25 - Perl update</h3>
Perl has been updated to 5.16.3. Please note that any packages using
XS modules will need to be updated. If you are updating close to the time
of this being committed and rely on such packages, you might like to wait
for updated packages to become available to save the trouble of building
them yourself.

<p>
<a name="20130404"></a>
<h3>2013/04/04 - com(4) devices on amd64 and i386</h3>

Device configuration lines for all four standard
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isa&sektion=4">isa(4)</a>
serial ports have been added to the GENERIC kernel configuration on
these platforms.  As a result the numbering of
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=com&sektion=4">com(4)</a>
devices may change on your system.  Serial ports provided by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=puc&sektion=4">puc(4)</a>
or other multi-port serial cards will now start at com4.  If you are
using any of these devices as serial console or in a console server
setup, please review the appropriate configuration files.

<p>
<a name="20130415"></a>
<h3>2013/04/15 - struct statfs change</h3>

In order to complete the support for DUIDs,
<q>struct statfs</q> and the system calls that use it have changed.
To upgrade across this change, you must either
<ul>
<li>Upgrade with a snapshot (recommended), OR
<li>Configure and build a kernel with the compatibility support
</ul>
The support is enabled by default, but you <b>MUST</b> run config(8)
and build a clean kernel for it to be enabled.
The manual upgrade steps are:
<ul>
<li>Update entire source tree using cvs
<li>configure and build a new kernel:
<blockquote><pre><b>   cd /usr/src/sys/arch/`uname -m`/conf
   config GENERIC		# or GENERIC.MP or whatever config you use
   cd ../compile/GENERIC	# or GENERIC.MP or ...
   make clean
   make
</b></pre></blockquote>
<li>Install the new kernel
<li>Reboot to the new kernel
<li><a href="faq5.html#BldUserland">Build userland</a>
</ul>
Failure to do so may result in a system that cannot boot.

<p>
<a name="20130416"></a>
<h3>2013/04/16 - Ports: mail/roundcubemail update</h3>
Roundcube now uses PDO for database access. Be sure to follow the
update instructions in /usr/local/share/doc/pkg-readmes/roundcubemail*.

<p>
<a name="20130419"></a>
<h3>2013/04/19 - struct swdevt change</h3>

Cleanup of
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=diskless&sektion=8">
diskless(8)</a> code in the kernel moved <q>sw_vp</q> from <q>struct swdevt</q>
to <q>struct nfs_diskless</q>.
<br>
An up to date
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8">
config(8)</a> is needed to build ramdisk kernels.
Following
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&sektion=8">
release(8)</a> takes care of this.

<p>
<a name="20130429"></a>
<h3>2013/04/29 - rc.conf(8) pre-rc.d(8) backward compatibility removed</h3>
As of today, rc.conf.local(8) only supports rc.d(8) variables to control
daemons startup.<br><br>
The following variables have been renamed to their _flags counterpart:
<i>amd</i> <i>inetd</i> <i>portmap</i> <i>rwhod</i>.
<br>
<pre>
    <b>amd=YES</b> becomes <b>amd_flags=</b>
    <b>inetd=YES</b> becomes <b>inetd_flags=</b>
    <b>portmap=YES</b> becomes <b>portmap_flags=</b>
    <b>rwhod=YES</b> becomes <b>rwhod_flags=</b>
</pre>
The <i>lockd</i> variable has been removed. Similar functionality can be
achieved by setting:
<pre>
    <b>lockd_flags=</b>
    <b>statd_flags=</b>
</pre>

The <i>aucat_flags</i> variable has been renamed to <i>sndiod_flags</i>.
<pre>
    <b>aucat_flags=NO</b> becomes <b>sndiod_flags=NO</b>
</pre>

<p>
<a name="20130501"></a>
<h3>2013/05/01 - Packages: sysutils/cfengine update</h3>
CFEngine has been updated to version 3.4; this is a major upgrade and
is not a drop-in replacement for CFEngine 2.
Existing users should see upstream's
<a href="https://cfengine.com/manuals/cf3-upgrade">upgrade documentation</a>
for further information.

<p>
<a name="20130601"></a>
<h3>2013/06/01 - Directories in /usr/share/locale to delete</h3>
After upgrading, obsolete directories can be deleted from /usr/share/locale.
Any directory that has a dot in its name is obsolete.
The de_AT directory is obsolete as well.
<blockquote><pre>
rm -rf /usr/share/locale/*.*
rm -rf /usr/share/locale/de_AT
</pre></blockquote>

<p>
<a name="20130601b"></a>
<h3>2013/06/01 - Removed /usr/include/spinlock.h header</h3>
After upgrading, the obsolete file /usr/include/spinlock.h can be deleted.
<blockquote><pre>
rm -f /usr/include/spinlock.h
rm -f /usr/libdata/perl5/site_perl/*/spinlock.ph
</pre></blockquote>

<p>
<a name="20130602"></a>
<h3>2013/06/02 - bgplg(8) and slowcgi(8) sockets moved to /var/www/run</h3>
When running a bgp looking glass or using bgplgsh(8) the restricted socket in
<i>/etc/bgpd.conf</i> needs to be changed:
<blockquote><pre>
socket "/var/www/run/bgpd.rsock" restricted
</pre></blockquote>
Early adopters of slowcgi(8) need to update <i>/etc/nginx/nginx.conf</i>.

<p>
<a name="20130602b"></a>
<h3>2013/06/02 - mg(1) dired commands</h3>
Some of the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mg&sektion=1">
mg(1)</a> editor's dired commands changed to be more in line with
GNU Emacs dired commands.
<p>
<table border=1><tr><td>
OLD
</td><td>
&nbsp;
</td><td>
NEW
</td></tr><tr><td>
dired-backup-unflag
</td><td>
->
</td><td>
dired-unmark-backward
</td></tr>
<tr><td>
dired-copy-file
</td><td>
->
</td><td>
dired-do-copy
</td></tr>
<tr><td>
dired-do-deletions
</td><td>
->
</td><td>
dired-do-flagged-deletions
</td></tr>
<tr><td>
dired-flag-file-deleted
</td><td>
->
</td><td>
dired-flag-file-deletion
</td></tr>
<tr><td>
dired-rename-file
</td><td>
->
</td><td>
dired-do-rename
</td></tr>
<tr><td>
dired-unflag
</td><td>
->
</td><td>
dired-unmark
</td></tr></table>

<p>
<a name="20130604"></a>
<h3>2013/06/04 - Manpages to delete</h3>
A number of files should be deleted from your system.
Note that these may not exist on all systems; that's ok.
Copy and paste the following line:
<blockquote><pre>
rm -f /usr/share/man/man{9/{re,}lookup.9,/_Exit.3}
</pre></blockquote>

<p>
<a name="20130607"></a>
<h3>2013/06/07 - X server modules to delete</h3>
After the update to X server 1.14, a number of modules have been
obsoleted or merged in the main server. Older versions sould be
deleted:
<blockquote><pre>
cd /usr/X11R6/include/xorg
rm -f mibstore.h synaptics.h xaa.h xaalocal.h
cd /usr/X11R6/lib/modules
rm -f extensions/lib{dbe,dri,dri2,extmod,record}.{la,so}
rm -f libxaa.{la,so}
</pre></blockquote>

<p>
<a name="20130607b"></a>
<h3>2013/06/07 - inteldrm(4) ABI break</h3>
Some of the GEM ioctls were changed to be more compatible with Linux.
After updating your kernel, you should update libdrm as well:
<blockquote><pre>
cd /usr/xenocara/lib/libdrm
make obj
make build
</pre></blockquote>

<p>
<a name="20130617"></a>
<h3>2013/06/17 - KerberosV update needs build tools to be compiled first</h3>
Some of the build tools required by kerberosV need to be compiled and installed
before kerberosV itself or a release can be built.
To compile and install the required build tools (asn1_compile, compile_et, slc)
please do the following:
<blockquote><pre>
cd /usr/src/kerberosV/tools
make obj
make
make install
</pre></blockquote>

<p>
<a name="20130618"></a>
<h3>2013/06/18 - Removed /usr/include/pcap-int.h header</h3>
After upgrading, the /usr/include/pcap-int.h header must be deleted.
<blockquote><pre>
rm -f /usr/include/pcap-int.h
rm -f /usr/libdata/perl5/site_perl/*/pcap-int.ph
</pre></blockquote>

<p>
<a name="20130621"></a>
<h3>2013/06/21 - Several files must be deleted after the KerberosV update</h3>
After upgrading, the following files must be deleted:
<blockquote><pre>
rm -f /usr/bin/{afslog,hxtool,kauth,kadmin,ksu,pagsh,kswitch}
rm -f /usr/lib/lib{heimntlm.*,heimntlm_p.*,hx509.*,hx509_p.*,kafs.*,kafs_p.*}
rm -f /usr/libdata/perl5/site_perl/*-openbsd/com_err.ph
rm -f /usr/libdata/perl5/site_perl/*-openbsd/kerberosV/{crmf_asn1,heimntlm-protos,heimntlm,hx509-private,hdb-private}.ph
rm -f /usr/libdata/perl5/site_perl/*-openbsd/kerberosV/{hx509-protos,hx509,hx509_err,kx509_asn1,ntlm_err,ocsp_asn1,pkcs10_asn1}.ph
rm -f /usr/libdata/perl5/site_perl/*-openbsd/kerberosV/{pkcs12_asn1,pkcs8_asn1,pkcs9_asn1,pkinit_asn1,gssapi/gssapi_spnego,spnego_asn1}.ph
rm -f /usr/libexec/{digest-service,kimpersonate,kdigest,kcm}
rm -f /usr/include/com_err.h
rm -f /usr/include/kerberosV/{crmf_asn1,hdb-private,heimntlm-protos,heimntlm,hx509-private}.h
rm -f /usr/include/kerberosV/{hx509-protos,hx509,hx509_err,kx509_asn1,ntlm_err,ocsp_asn1,pkcs10_asn1,pkcs12_asn1}.h
rm -f /usr/include/kerberosV/{pkcs8_asn1,pkcs9_asn1,pkinit_asn1,spnego_asn1,gssapi/gssapi_spnego}.h
rm -f /usr/sbin/kdigest
</pre></blockquote>

<p>
<a name="20130705"></a>
<h3>2013/07/05 - vax port switches to ELF</h3>
OpenBSD/vax now uses ELF instead of a.out as its native binary file format.
Upgrading with a recent snapshot is recommended; however, for reference, the
manual upgrade steps are:
<ul>
<li>Get the buildsystem aware vax is becoming ELF:
<blockquote><pre><b>
  cd /usr/src/share/mk
  make install
</b></pre></blockquote>
<li>Build, but do not install, binutils:
<blockquote><pre><b>
  cd /usr/src/gnu/usr.bin/binutils
  make -f Makefile.bsd-wrapper obj
  make -f Makefile.bsd-wrapper -DBOOTSTRAP depend
  make -f Makefile.bsd-wrapper -DBOOTSTRAP
</b></pre></blockquote>
<li>Build the C compiler:
<blockquote><pre><b>
  cd /usr/src/gnu/egcs/gcc
  make -f Makefile.bsd-wrapper obj
  make -f Makefile.bsd-wrapper -DBOOTSTRAP depend
  make -f Makefile.bsd-wrapper -DBOOTSTRAP
</b></pre></blockquote>
<li>The compiler build fails when building libgcc.a. This is normal at this point.
  It needs the new binutils binaries you had been building, so now is the time
  to install them:
<blockquote><pre><b>
  cd /usr/src/gnu/usr.bin/binutils
  make -f Makefile.bsd-wrapper install
</b></pre></blockquote>
<li>Now resume compiler build, and install it:
<blockquote><pre><b>
  cd /usr/src/gnu/egcs/gcc
  make -f Makefile.bsd-wrapper -DBOOTSTRAP
  make -f Makefile.bsd-wrapper -DBOOTSTRAP install
</b></pre></blockquote>
<li>Update machine-dependent includes, or you won't be able to build libc:
<blockquote><pre><b>
  cd /usr/src/sys/arch/vax/include
  install -m 444 -o root -g bin *.h /usr/include/vax
</b></pre></blockquote>
<li>Build and install a few core libraries:
<blockquote><pre><b>
  cd /usr/src/lib/csu
  make obj
  make depend
  make NOMAN=
  make install
  cd /usr/src/lib/libc
  make obj
  make depend
  make NOMAN= NOPROFILE=
  make install
  cd /usr/src/lib/libm
  make obj
  make depend
  make NOMAN= NOPROFILE=
  make install
  cd /usr/src/lib/libutil
  make obj
  make depend
  make NOMAN= NOPROFILE=
  make install
  cd /usr/src/gnu/lib/libiberty
  make -f Makefile.bsd-wrapper obj
  make -f Makefile.bsd-wrapper depend
  make -f Makefile.bsd-wrapper
  make -f Makefile.bsd-wrapper install
</b></pre></blockquote>
<li>Now rebuild the complete compiler suite:
<blockquote><pre><b>
  cd /usr/src/gnu/egcs/gcc
  make -f Makefile.bsd-wrapper -DBOOTSTRAP clean
  make -f Makefile.bsd-wrapper depend
  make -f Makefile.bsd-wrapper
  make -f Makefile.bsd-wrapper install
</b></pre></blockquote>
<li>You can now proceed with a regular `make build'
</ul>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: current.html,v 1.405 2013/07/06 18:03:15 miod Exp $</small>

</body>
</html>
