<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2005-2012 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>

<p>

<h1><font color="#e00000">Following <i>-current</i></font></h1>
<hr>

<h3>Table of Contents</h3>
<p>
<ul>
<li><a href="#Intro">Introduction</a>
<!-- Oldest on top... -->
<li><a href="#20120808">2012/08/08 - xf86-video-ati 6.14.6 is now selected by default</a>
<li><a href="#20120821">2012/08/21 - IPv6 SLAAC defaults to privacy addresses</a>
<li><a href="#20120823">2012/08/23 - New toolchain behavior</a>
<li><a href="#20120830">2012/08/30 - pmdb(1) removed</a>
<li><a href="#20120831">2012/08/31 - gcc(1) now uses __guard_local instead of __guard on ELF/GCC4 architectures</a>
<li><a href="#20120831a">2012/08/31 - amd64, sgi, loongson and sparc64 are now PIE</a>
<li><a href="#20120901">2012/09/01 - alpha is now PIE</a>
<li><a href="#20120902">2012/09/02 - hppa is now PIE</a>
<li><a href="#20120912">2012/09/12 - landisk is now PIE</a>
<li><a href="#20120920">2012/09/20 - pf enforces 'frags' limit</a>
<li><a href="#20120923">2012/09/23 - imake moved to ports</a>
<li><a href="#20120924">2012/09/24 - [ports] Major PostgreSQL update</a>
<li><a href="#20121011">2012/10/11 - smtpd.conf syntax change</a>
<li><a href="#20121123">2012/11/23 - sndiod(1) options changes</a>
<li><a href="#20121201">2012/12/01 - m88k ports switch to gcc 3</a>

<!-- New additions go on the bottom, please -->
</ul>

<hr>

<a name="Intro"></a>
<!-- XXXversion -->
<h2>Introduction</h2>
This document is for people who wish to follow <i>-current</i>.
It contains information about changes from 5.2-release to <i>-current</i>,
and should NOT be used by anyone upgrading from 5.1 or earlier, or people
wishing to follow <a href="../stable.html"><i>-stable</i></a>.

<p>
If you wish to update to 5.2-release or 5.2-stable from previous
versions, see the <a href="upgrade52.html">upgrade guide</a>.

<p>
Make sure you have read and understood
<a href="faq5.html">FAQ 5 - Building the System from Source</a>
before using -current and the instructions below.

<p>
You should ALWAYS use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
Most of these changes will have to be performed as root.

<p>
<a name="20120808"></a>
<h3>2012/08/08 - xf86-video-ati 6.14.6 is now selected by default</h3>
The
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=radeon&sektion=4">radeon(4)</a>
X.Org driver has been updated to version 6.14.6 and is now selected by
default when running without an <tt>xorg.conf</tt> file.<br>
To force the use of the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=radeonold&sektion=4">radeonold(4)</a>
driver, add the following to <tt>/etc/X11/xorg.conf</tt>:
<pre>
Section "Device"
    Identifier "Old Radeon Card"
    Driver "radeonold"
EndSection
</pre>

<p>
<a name="20120821"></a>
<h3>2012/08/21 - IPv6 SLAAC defaults to privacy addresses</h3>
IPv6 stateless automatic address configuration (as used when you
configure an interface's address using "rtsol") now defaults to using
RFC4941 privacy addresses.<p>
This means that when making outgoing connections, predictable addresses
based on the MAC address are no longer used as a source address, instead
temporary addresses are generated periodically and used (see
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>'s
description of "autoconfprivacy" for more information).<p>
Incoming connections aren't affected by this; the IPv6 address based on
the MAC address is still configured on the interface and can be used for
incoming connections.
However if connections to other machines are restricted based on source
IPv6 addresses or reverse DNS lookups, you may need to make configuration
changes and either disable privacy addresses (e.g. <tt>echo
"up -autoconfprivacy" &gt;&gt; /etc/hostname.em0</tt>) or configure
addresses manually instead.

<p>
<a name="20120823"></a>
<h3>2012/08/23 - New toolchain behavior</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ld&sektion=1">ld(1)</a>'s
linker scripts now recognizes .openbsd.randomdata sections, which libc has
also been updated to make use of.  Normally ld(1) is not built until after libc,
so to explicitly build it first use:
<blockquote><pre>
<b>cd /usr/src/gnu/usr.bin/binutils
make -f Makefile.bsd-wrapper obj
make -f Makefile.bsd-wrapper
make -f Makefile.bsd-wrapper install
</b></pre></blockquote>
You can verify that ld(1) is up to date by checking the output from
ld --verbose:
<blockquote><pre>
$ <b>ld --verbose | grep randomdata</b>
  .openbsd.randomdata     :
    PROVIDE_HIDDEN (__openbsd_randomdata_start = .);
    *(.openbsd.randomdata .openbsd.randomdata.*)
    PROVIDE_HIDDEN (__openbsd_randomdata_end = .);
</pre></blockquote>

<p>
<a name="20120830"></a>
<h3>2012/08/30 - pmdb(1) removed</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pmdb&sektion=1">pmdb(1)</a>
was removed from base. The binary and it's manual page can be removed:
<blockquote><pre>
<b>rm /usr/bin/pmdb /usr/share/man/man1/pmdb.1
</b></pre></blockquote>

<p>
<a name="20120831"></a>
<h3>2012/08/31 - gcc(1) now uses __guard_local instead of __guard on ELF/GCC4 architectures</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc&sektion=1">gcc(1)</a>
now emits stack-smashing protection code that references __guard_local instead
__guard on ELF/GCC4 architectures.  Because GCC is built at the end of a normal
"make build", it's necessary to either do two full builds, or you can short-cut
the first build by updating just the C runtime files and compiler:
<blockquote><pre>
<b>cd /usr/src/lib/csu
make depend && make && sudo make install
cd /usr/src/gnu/usr.bin/cc
make depend && make && sudo make install
</b></pre></blockquote>
You can then proceed with a normal "make build" as per
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&sektion=8">release(8)</a>.

<p>
<a name="20120831a"></a>
<h3>2012/08/31 - amd64, sgi, loongson and sparc64 are now PIE</h3>
The amd64, sgi, loongson and sparc64 platforms have been switched to
PIE (position-independent executables) by default.
Everyone is encouraged to update via snapshots (dated after 2012/08/31); if you
want to upgrade via sources, follow these instructions:
<p>
First, install the new system Makefiles with the change to PIE_ARCH in
bsd.own.mk:
<blockquote><pre>
<b>cd /usr/src/share/mk && sudo make install
</b></pre></blockquote>
Then, recompile and install gcc and binutils.
<blockquote><pre>
<b>cd /usr/src/gnu/usr.bin/binutils
make -f Makefile.bsd-wrapper clean && make -f Makefile.bsd-wrapper obj && \
	make -f Makefile.bsd-wrapper depend && make -f Makefile.bsd-wrapper
cd /usr/src/gnu/usr.bin/cc
make clean && make obj && make depend && make && sudo make install
cd /usr/src/gnu/usr.bin/binutils && sudo make -f Makefile.bsd-wrapper install
</b></pre></blockquote>
Finally, recompile your system by following the procedure outlined in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&sektion=8">release(8)</a>.

<p>
<a name="20120901"></a>
<h3>2012/08/31 - alpha is now PIE</h3>
The alpha platform has been switched to PIE (position-independent executables)
by default.
Everyone is encouraged to update via snapshots (dated after 2012/09/01).
To do this conversion yourself, see the
<a href="#20120831a">instructions for PIE conversion</a> on other architectures.

<p>
<a name="20120902"></a>
<h3>2012/09/02 - hppa is now PIE</h3>
The hppa platform has been switched to PIE (position-independent executables)
by default.
Everyone is encouraged to update via snapshots (dated after 2012/09/02).
To do this conversion yourself, see the
<a href="#20120831a">instructions for PIE conversion</a> on other architectures.

<p>
<a name="20120912"></a>
<h3>2012/09/12 - landisk is now PIE</h3>
The landisk platform has been switched to PIE (position-independent executables)
by default.
Everyone is encouraged to update via snapshots (dated after 2012/09/12).
To do this conversion yourself, see the
<a href="#20120831a">instructions for PIE conversion</a> on other architectures.

<p>
<a name="20120920"></a>
<h3>2012/09/20 - pf enforces 'frags' limit</h3>
pfctl will abort if the 'frags' limit in pf.conf is higher than
the kern.maxclusters sysctl.
This is to guard against allowing a system to run out of mbuf clusters.
If it is not set, the new default is 25% of kern.maxclusters.

<p>
<a name="20120923"></a>
<h3>2012/09/23 - imake moved to ports</h3>
Imake, the old X build system has been moved to ports, as none of the packages in xenocara uses it anymore. The version installed in <tt>/usr/X11R6</tt> need to be manually removed:
<blockquote><pre><b>
sudo rm -rf /usr/X11R6/lib/X11/config
sudo rm -f /usr/X11R6/bin/{ccmakedep,cleanlinks,imake,makeg,mergelib,mkdirhier,mkhtmlindex,revpath,xmkmf}
sudo rm -f /usr/X11R6/man/man1/{ccmakedep,cleanlinks,imake,makeg,mergelib,mkdirhier,mkhtmlindex,revpath,xmkmf}.1
</b></pre></blockquote>

<p>
<a name="20120924"></a>
<h3>2012/09/24 - [ports] Major PostgreSQL update</h3>
Major update to 9.2.1. A dump/restore is required.

<p>
<a name="20121011"></a>
<h3>2012/10/11 - smtpd.conf syntax change</h3>
The <tt>"all"</tt> keyword becomes <tt>"any"</tt>. You need to update your config. Be careful to really rewrite rules like:
<pre>	accept from all [...]</pre>
to
<pre>	accept from any [...]</pre>
because the former syntax is still valid, but it behaves completely differently now and it would break your ruleset.

<p>
<a name="20121123"></a>
<h3>2012/11/23 - sndiod(1) options changes</h3>
The rate (-r) and the encoding (-e) become per-device settings and as
such must precede the device they apply to (-f). Example, rewrite:
<blockquote><pre><b>sndiod -frsnd/1 -r44100</b></pre></blockquote>
by
<blockquote><pre><b>sndiod -r44100 -frsnd/1</b></pre></blockquote>
MIDI thru boxes are created dynamically so -M options must be removed.
MIDI ports (-q) cannot be connected to the sndiod control port,
so an external program must be used for that (eg. aucat(1) or the
audio/midish port). For instance, to make rmidi/5 control snd/0 do:
<blockquote><pre><b>aucat -M -mmidi -qrmidi/5 -qsnd/0</b></pre></blockquote>

<p>
<a name="20121201"></a>
<h3>2012/12/01 - m88k ports switch to gcc 3</h3>
OpenBSD/luna88k and OpenBSD/mvme88k now use gcc 3.3.6 as their system compiler.
Upgrading with a recent snapshot is recommended; however, for reference, the
manual upgrade steps are:
<ul>
<li>Build and install a new assembler:
<pre>
   cd /usr/src/gnu/usr.bin/gas
   make clean
   make obj
   make depend
   make
   make install
</pre>
<li>Build the new C compiler with the existing compiler:
<pre>
   cd /usr/src/gnu/usr.bin/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP depend
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP includes
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
</pre>
<li>Let the rest of the system know the platform now runs gcc 3:
<pre>
   cd /usr/src/share/mk
   make install
</pre>
<li>Build and install an up-to-date preprocessor:
<pre>
   cd /usr/src/usr.bin/cpp
   make clean
   make obj
   make depend
   make
   make install
</pre>
<li>Rebuild libc and libiberty with the new C compiler:
<pre>
   cd /usr/src/lib/libc
   make clean
   make obj
   make NOMAN= NOPROFILE= depend
   make NOMAN= NOPROFILE=
   make NOMAN= NOPROFILE= install

   cd /usr/src/gnu/lib/libiberty
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper NOMAN= NOPROFILE= depend
   make -f Makefile.bsd-wrapper NOMAN= NOPROFILE=
   make -f Makefile.bsd-wrapper NOMAN= NOPROFILE= install
</pre>
<li>Now rebuild the compiler set again:
<pre>
   cd /usr/src/gnu/usr.bin/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper depend
   make -f Makefile.bsd-wrapper
   make -f Makefile.bsd-wrapper install
</pre>
<li>The system is now ready to be rebuild with gcc3:
<pre>
   cd /usr/src
   rm -fR /usr/include/g++
   make obj
   make build
</pre>
</ul>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: current.html,v 1.358 2012/12/01 21:11:37 miod Exp $</small>

</body>
</html>
