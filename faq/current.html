<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2006 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">    
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>

<p>

<h1><font color="#e00000">Following <i>-current</i></font></h1>
<hr>

<h3>Table of Contents</h3>
<p>
<ul>
<li><a href="#Intro">Introduction</a>
<!-- Oldest on top... -->
<li><a href="#20060926">2006/09/26 - Switch to gcc3 (alpha)</a>
<li><a href="#20061006">2006/10/06 - 'flags S/SA keep state' implicit in pf.conf(5)</a>
<li><a href="#20061011">2006/10/11 - disklabel not in FreeBSD or NetBSD partitions</a>
<li><a href="#20061012">2006/10/12 - don't boot from NetBSD partitions</a>
<li><a href="#20061029">2006/10/29 - new user for ripd(8)</a>
<li><a href="#20061227">2006/12/27 - ARM (zaurus/armish) Flag day</a>
<li><a href="#20070131">2007/01/31 - new user for hoststated(8)</a>
<li><a href="#20070202">2007/02/02 - new way to enable/disable system
accounting on boot</a>
<li><a href="#20070226">2007/02/26 - spamd: greylisting on by
default; config files moved to /etc/mail</a>
<li><a href="#20070326">2007/03/26 - Xenocara replaces XF4 in <i>-current</i></a>
<li><a href="#20070327">2007/03/27 - updated ahci(4) may cause device
name change for SATA disks</a>
<!-- New additions go on the bottom, please -->
</ul>
    
<hr>

<a name="Intro"></a>
<!-- XXXversion -->
<h2>Introduction</h2>
This document is for people who wish to follow <i>-current</i>.
It contains information about changes from 4.0-release to <i>-current</i>,
and should NOT be used by anyone upgrading from 3.9 or earlier, or people
wishing to follow <a href="../stable.html"><i>-stable</i></a>.

<p>
If you wish to update to 4.0-release or 4.0-stable from previous
versions, see the <a href="upgrade40.html">upgrade guide</a>.

<p>
Make sure you have read and understood
<a href="faq5.html">FAQ 5 - Building the System from Source</a>
before using -current and the instructions below.

<p>
You should ALWAYS use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
If you wish to see upgrade information for earlier versions of OpenBSD,
see <a href= "upgrade-old.html">upgrade-old.html</a>.
This is provided as a historical record -- it should NOT be used as
an upgrade procedure guide.

<p>


<a name="20060926"></a>
<h3>2006/09/26 - Switch to gcc3 (alpha)</h3>
OpenBSD/alpha has converted to gcc3.
To upgrade,
<pre>
    # rm -rf /usr/include/g++
    # cp /usr/src/share/mk/bsd.own.mk /usr/share/mk/
</pre>
Now, <a href="faq5.html#NewCompiler">build gcc3</a>, (using the gcc3
directory) then build new ld.so:
<pre>
    cd /usr/src/libexec/ld.so
    make clean
    make obj
    make depend
    make
    make install
</pre>

Now, build the kernel and system as <a href="faq5.html#Bld">usual</a>.
<p>

<a name="20061006"></a>
<h3>2006/10/06 - 'flags S/SA keep state' implicit in pf.conf(5)</h3>
<i>flags S/SA keep state</i> is now the default for pass rules in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5">pf.conf(5)</a>,
and new <i>no state</i> and <i>flags any</i> options have been added to
override these defaults.  Current rulesets will continue to load, but the
behaviour may be slightly changed as these defaults are more restrictive.
Rulesets with stateless filtering (<i>no state</i>) or a requirement to
create states on intermediate packets (<i>flags any</i>) should be updated
to explicitly request the desired behaviour.
<p>
In particular care should be taken with the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc0</a>
interface, as floating states are a potential problem for filtering IPsec
traffic: states need to be interface bound, to avoid permitting unencrypted
traffic should
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&amp;sektion=8">isakmpd(8)</a>
exit. Therefore all rules on the enc0 interface should explicitly set
<i>keep state (if-bound)</i>.
<p>

<a name="20061011"></a>
<h3>2006/10/11 - disklabel not in FreeBSD or NetBSD partitions</h3>
<i>FreeBSD and NetBSD DOS MBR partitions</i> are no longer used to store
disklabels, and are no longer searched for a disklabel. As a result disks with
only FreeBSD or NetBSD DOS MBR partitions will no longer have an 'a' partition
created in the spoofed disklabel. The disklabel on such disks will be stored
and loaded from sector 1, and this could find an old accidental disklabel. Use
fdisk(8) to change the partition type to OpenBSD ('A6') to use the existing
disklabel.
<p>
 
<a name="20061012"></a>
<h3>2006/10/12 - don't boot from NetBSD partitions</h3>
<i>amd64, i386, macppc, and mvmeppc</i> no longer try to boot from the first
NetBSD partition when no OpenBSD partition is found.
<p>

<a name="20061029"></a>
<h3>2006/10/29 - new user for ripd(8)</h3>
<i>A new RIP daemon has been imported</i> in order to use this daemon, a new
user and group are required.

As <i>root</i>, add the following user and group, using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u88 -g=uid -c"RIP Daemon" -d/var/empty -s/sbin/nologin _ripd
</pre></blockquote>

This step will add both the new user and its corresponding group.
Your environment may allow you to copy/paste those commands.
<p>

<a name="20061227"></a>
<h3>2006/12/27 - ARM (zaurus/armish) Flag day</h3>
<i>The syscall mechanism for arm has changed</i> which will cause binaries
and shared libraries from before Nov 7 to no longer work. It is necessary to
update from snapshot to get past this ABI change.
<p>

<a name="20070131"></a>
<h3>2007/01/31 - new user for hoststated(8)</h3>
<i>A HostState daemon has been imported</i> in order to use this daemon, a new
user and group are required.

As <i>root</i>, add the following user and group, using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u89 -g=uid -c"HostState Daemon" -d/var/empty -s/sbin/nologin _hoststated
</pre></blockquote>

This step will add both the new user and its corresponding group.
Your environment may allow you to copy/paste those commands.
<p>

<a name="20070202"></a>
<h3>2007/02/02 - new way to enable/disable system accounting on boot</h3>
In order to enable accounting on boot you need to set the new rc.conf
variable "accounting=YES". The presence of the /var/account/acct file
does not make it start automatically anymore.
<p>

<a name="20070226"></a>
<h3>2007/02/26 - spamd: greylisting on by default; config files moved
to /etc/mail</h3>
<p>
Greylisting is now the default runtime mode for spamd(8); the
<tt>-g</tt> flag is obsolete.
To disable greylisting and run in blacklist-only mode, use the
<tt>-b</tt> flag.
In order to control which address spamd binds to, use the new
<tt>-l</tt> flag.

<p>
spamd-setup(8) can also be told to run in blacklist-only mode by passing
the new <tt>-b</tt> flag.

<p>
The spamd.conf(5) file has moved from <tt>/etc</tt> to <tt>/etc/mail</tt>.

<p>
Refer to the manpages for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8">spamd(8)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd-setup&amp;sektion=8">spamd-setup(8)</a>
for all the details.
 

<a name="20070326"></a>
<h3>2007/03/26 - Xenocara replaces XF4 in <i>-current</i></h3>
The <a href="http://www.xenocara.org/">xenocara</a> tree is to be used
now instead of the XF4 tree to build X for OpenBSD.
More details can be found on
<a href="http://undeadly.org/cgi?action=article&sid=20070328153001">undeadly.org</a>.

<p>
If you really wish to build Xenocara from source (don't, use snapshots!)
<a href="http://www.openbsd.org/cgi-bin/cvsweb.cgi/xenocara/README?rev=HEAD&content-type=text/x-cvsweb-markup"
>xenocara/README</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>


<a name="20070327"></a>
<h3>2007/03/27 - updated ahci(4) may cause device name change for SATA disks</h3>
<p>
Recent changes to the <tt>ahci(4)</tt> subsystem can cause SATA disks
which were formerly recognized as wd* (e.g <tt>wd0</tt>) devices to turn
up as sd* (e.g <tt>sd0</tt>) devices instead.

<p>
This is a potential problem if you upgrade from an earlier snapshot.
Watch the <tt>dmesg</tt> output at boot.
A drive which turned up earlier as:

<p>
<blockquote><tt>
pciide1 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: DMA, channel 0 wired to native-PCI, channel 1 wired to native-PCI<br>
pciide1: using apic 2 int 11 (irq 11) for native-PCI interrupt<br>
wd0 at pciide1 channel 0 drive 0: &lt;FUJITSU MHV2080BH&gt;<br>
wd0: 16-sector PIO, LBA48, 76319MB, 156301488 sectors<br>
wd0(pciide1:0:0): using PIO mode 4, Ultra-DMA mode 5
</tt></blockquote>

now instead turns up as

<p>
<blockquote><tt>
ahci0 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: AHCI 1.1: apic 2 int 16 (irq 11)<br>
scsibus1 at ahci0: 32 targets<br>
sd0 at scsibus1 targ 0 lun 0: &lt;ATA, FUJITSU MHV2080B, 0084&gt; SCSI2 0/direct fixed<br>
sd0: 76319MB, 76319 cyl, 64 head, 32 sec, 512 bytes/sec, 156301488 sec total
</tt></blockquote>

<p>
The recommended workaround is to edit your <tt>/etc/fstab</tt> file,
changing the relevant <tt>/dev/wd</tt> entries to refer to
<tt>/dev/sd</tt> devices and partitions instead.

<p>
The other option is to disable <tt>ahci</tt> using <tt>config(8)</tt> or
<tt>boot -c</tt>.

<p>
Refer to the manpages for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ahci&amp;sektion=4">ahci(4)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
for all the details.

<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>
<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: current.html,v 1.63 2007/04/01 01:42:40 nick Exp $</small>

</body>
</html>
