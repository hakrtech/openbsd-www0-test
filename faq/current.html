<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2006 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">    
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>

<p>

<h1><font color="#e00000">Following <i>-current</i></font></h1>
<hr>

<h3>Table of Contents</h3>
<p>
<ul>
<li><a href="#Intro">Introduction</a>
<!-- Oldest on top... -->
<li><a href="#20050927">2005/09/27 - build requires new xargs feature</a>
<li><a href="#20051006">2005/10/06 - Changes to MAKEDEV(8) and ksh(1)</a>
<li><a href="#20051116">2005/11/16 - New version of ftp-proxy(8)</a>
<li><a href="#20051216">2005/12/16 - libresolv removed</a>
<li><a href="#20060104">2006/01/04 - mac68k switch to wscons(4)</a>
<li><a href="#20060113">2006/01/13 - types changes</a>
<li><a href="#20060131">2006/01/31 - XKB configuration updates</a>
<!-- New additions go on the bottom, please -->
</ul>
    
<hr>

<a name="Intro"></a>
<XXXversion>
<h2>Introduction</h2>
This document is for people who wish to follow <i>-current</i>.
It contains information about changes from 3.8-release to <i>-current</i>,
and should NOT be used by anyone upgrading from 3.7 or earlier, or people
wishing to follow <a href="../stable.html"><i>-stable</i></a>.

<p>
If you wish to update to 3.8-release or 3.8-stable from previous
versions, see the <a href="upgrade38.html">upgrade guide</a>.

<p>
Make sure you have read and understood
<a href="faq5.html">FAQ 5 - Building the System from Source</a>
before using -current and the instructions below.

<p>
You should ALWAYS use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
If you wish to see upgrade information for earlier versions of OpenBSD,
see <a href= "upgrade-old.html">upgrade-old.html</a>.
This is provided as a historical record -- it should NOT be used as
an upgrade procedure guide.

<p>
<a name="20050927"></a>
<h3>2005/09/27 - build requires new xargs feature</h3>

Build and install xargs(1).
<pre>
     # cd /usr/src/usr.bin/xargs && make obj && make && make install
</pre>
Then run make build.

<p>
<a name="20051006"></a>
<h3>2005/10/06 - Changes to MAKEDEV(8)</h3>

Changes were done to MAKEDEV to greatly increase its speed.
These changes depend on changes made to ksh earlier.
Therefore install media built prior to this date can not be used.
<br>

<p>
<a name="20051116"></a>
<h3>2005/11/16 - New version of ftp-proxy(8)</h3>

ftp-proxy was replaced by what was previously called pftpx.
The new ftp-proxy runs stand-alone and not from inetd.conf as it used to.
<p>
Upgrade instructions are as follows:
<p>
Stop the old ftp-proxy by installing a new /etc/inetd.conf or just disable
its entry in /etc/inetd.conf manually.

<pre>
cp /usr/src/etc/inetd.conf /etc/inetd.conf
</pre>

Then send inetd a HUP signal via kill:
<p>
<pre>
kill -HUP `cat /var/run/inetd.pid`
</pre>

Start the new ftp-proxy by installing new
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8"><i>/etc/rc</i></a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8"><i>/etc/rc.conf</i></a>
and setting ftpproxy_flags="" in /etc/rc.conf.local.

<pre>
cp /usr/src/etc/{rc,rc.conf} /etc
echo 'ftpproxy_flags=""' >> /etc/rc.conf.local
</pre>

Alternatively, it can be started by simply calling
/usr/sbin/ftp-proxy from /etc/rc.local
<p>

The new proxy uses <a href="pf/anchors.html"><i>anchors</i></a> to allow
data connections which means that
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5"><i>/etc/pf.conf</i></a>
must be adapted.  In the NAT section you need:
<p>

<pre>
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
</pre>

They are mandatory, even if you don't use NAT otherwise.
The following rule, that is probably already there for the old ftp-proxy,       
must stay: 
<pre>
rdr pass on $int_if proto tcp from $lan to any port 21 -> \
    127.0.0.1 port 8021
</pre>

In the rule section this is needed:

<pre>
anchor "ftp-proxy/*"
</pre>

Rules that allow the proxy to make FTP control connections
(destination port 21/tcp) must stay. 
Rules that allow FTP data connections are no longer needed.
Those rules may contain "user proxy" or "to port > 49151".

Care has been taken to keep the commandline switches similar, but some
may differ.
See the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8">ftp-proxy</a>
man page.
<p>

One case warrants special mention: if you have old clients that rely on
active mode data connections which use 20/tcp as a source port, you need the
'-r' switch.  (for this you had to run the old proxy with "-u root").
<p>
Run ftp-proxy with "-d -D7" if you run into trouble and want to diagnose
what's happening.

<p>
<a name="20051216"></a>
<h3>2005/12/16 - libresolv removed</h3>

You need to remove libresolv from your machine as it is no
longer installed.
<pre>
     # rm /usr/lib/libresolv*
</pre>

<p>
<a name="20060104"></a>
<h3>2006/01/04 - mac68k switch to wscons(4)</h3>
Before rebooting the new kernel, system files have to be updated for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wscons&amp;sektion=4">wscons(4)</a>.
</p>

<pre>
     # cp /usr/src/etc/etc.mac68k/MAKEDEV /dev
     # cd /dev &amp;&amp; sh ./MAKEDEV wscons
</pre>

<p>
In <tt>/etc/ttys</tt>, change the getty on <em>ttye0</em> to <em>ttyC0</em>
and reboot into the new kernel.
</p>

<p>
<a name="20060113"></a>
<h3>2006/01/13 - types changes</h3>
Before doing a "make build", the compiler needs to be built and installed.
Otherwise, you will be unable to build libstdc++.

<p>
Follow the instructions in <a href="faq5.html#NewCompiler">FAQ 5 -
How do I bootstrap a newer version of the compiler</a> for details.

<a name="20060131"</a>
<h3>2006/01/31 - xkb configuration updates</h3>
After merging of X.Org 6.9, some XKB configuration has changed, 
requiring changes in /etc/X11/xorg.conf. The most noticeable changes are:
<ul>
<li><b>us_intl</b> layout replaced by the <b>alt-intl</b> variant 
of the <b>us</b> layout.
Update your configuration file to use: 
<pre>
      Option "XkbLayout" "us"
      Option "XkbVariant" "alt-intl"
</pre>
<li><b>de_CH</b> and <b>fr_CH</b> layouts have been replaced by the
<b>ch</b> layout with <b>de</b> and <b>fr</b> variants:
<pre>
      Option "XkbLayout" "ch"
      Option "XkbVariant" "de"
</pre>
</ul>
<p>

<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>
<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: current.html,v 1.31 2006/02/14 18:24:40 steven Exp $</small>

</body>
</html>
