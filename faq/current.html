<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2005-2013 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>

<p>

<h1><font color="#e00000">Following <i>-current</i></font></h1>
<hr>

<h3>Table of Contents</h3>
<p>
<ul>
<li><a href="#Intro">Introduction</a>
<!-- Oldest on top... -->
<li><a href="#20130806">2013/08/06 - vax port switches to gcc 3</a>
<li><a href="#20130812">2013/08/12 - kernel modesetting in radeondrm(4)</a>
<li><a href="#20130813">2013/08/13 - system ABI break: time_t and others changed</a>
<li><a href="#20130813b">2013/08/13 - new identd(8) implementation</a>
<li><a href="#20130816">2013/08/16 - vlan(4) and pppoe(4) ABI breaks</a>
<li><a href="#20130823">2013/08/23 - [ports] php 5.4</a>
<li><a href="#20130914">2013/09/14 - [ports] dspam 3.10.2</a>
<li><a href="#20130919">2013/09/19 - [ports] wordpress 3.6.1</a>
<li><a href="#20131010">2013/10/10 - [ports] Apache Subversion 1.8.3</a>
<li><a href="#20131012">2013/10/12 - pf queue changes</a>
<li><a href="#20131014">2013/10/14 - [ports] PostgreSQL 9.3.0</a>
<li><a href="#20131019">2013/10/17 - [ports] Lout 3.40</a>
<li><a href="#20131031">2013/10/31 - new routing message version</a>
<li><a href="#20131103">2013/11/03 - [ports] ngircd 21</a>
<!-- New additions go on the bottom, please -->
</ul>

<hr>

<a name="Intro"></a>
<!-- XXXversion -->
<h2>Introduction</h2>
This document is for people who wish to follow <i>-current</i>.
It contains information about changes from 5.4-release to <i>-current</i>,
and should NOT be used by anyone upgrading from 5.3 or earlier, or people
wishing to follow <a href="../stable.html"><i>-stable</i></a>.

<p>
If you wish to update to 5.4-release or 5.4-stable from previous
versions, see the <a href="upgrade54.html">upgrade guide</a>.

<p>
Make sure you have read and understood
<a href="faq5.html">FAQ 5 - Building the System from Source</a>
before using -current and the instructions below.

<p>
You should ALWAYS use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
Most of these changes will have to be performed as root.

<p>
<a name="20130806"></a>
<h3>2013/08/06 - vax port switches to gcc 3</h3>
The vax port now uses gcc 3.3.6 as its system compiler. Upgrading with a recent
snapshot is recommended; however, for reference, the manual upgrade steps are:
<br>
<ul>
<li>Build the new C compiler with the existing compiler:
<pre>
   cd /usr/src/gnu/usr.bin/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP depend
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP includes
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
</pre>
<li>Let the rest of the system know the platform now runs gcc 3:
<pre>
   cd /usr/src/share/mk
   make install
</pre>
<li>Build and install an up-to-date preprocessor:
<pre>
   cd /usr/src/usr.bin/cpp
   make clean
   make obj
   make depend
   make
   make install
</pre>
<li>Build and install the C runtime startup files:
<pre>
   cd /usr/src/lib/csu
   make clean
   make depend
   make
   make install
</pre>
<li>Now rebuild the compiler set again:
<pre>
   cd /usr/src/gnu/usr.bin/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper depend
   make -f Makefile.bsd-wrapper
   make -f Makefile.bsd-wrapper install
</pre>
<li>The system is now ready to be rebuild with gcc3:
<pre>
   cd /usr/src
   rm -fR /usr/include/g++
   make obj
   make build
</pre>
</ul>

<p>
<a name="20130812"></a>
<h3>2013/08/12 - kernel modesetting in radeondrm(4)</h3>
radeondrm(4) now uses kernel modesetting, either install the firmware and wait
for a snapshot or follow the steps below:
<ul>
<li>Install the Radeon firmware:
<pre>
    pkg_add http://firmware.openbsd.org/firmware/snapshots/radeondrm-firmware-20130808.tgz
</pre>
<li>Build xenocara as usual
<li>Build and install a kernel as usual
<li>Reboot
</ul>

<p>
<a name="20130813"></a>
<h3>2013/08/13 - system ABI break: time_t and others changed</h3>
The system ABI has been changed to expand time_t, ino_t, and
clock_t and the <i>ident</i> and <i>data</i> members of struct
kevent to 64bit types.  A GENERIC kernel with this change will not
run old binaries and the /etc/{pwd,spwd}.db files must be regenerated
after updating the system binaries.  Rolling back to stock
5.4 will require reinstalling.
<br>
To update across this change you must now use a snapshot.
The recommended steps for updating are:
<ol>
<li>Save a record of what packages you had installed, manually and
automatically:
<pre>
    pkg_info -mq >/root/pkg_list_manual
    pkg_info -q >/root/pkg_list_full
</pre>
</li>
<li>Review the "package notes" below for information about known problems with
packages during the changeover. Some will need additional steps taking before the
update.
</li>
<li>While their uninstall programs can still execute, remove all packages
(except firmware packages):
<pre>
    pkg_delete -X /var/db/pkg/*-firmware-[0-9]*
</pre>
</li>
<li>Install/upgrade to the new snapshot.
If you upgrade instead of doing a fresh install,
then <b>BEFORE</b> rebooting, run
<pre>
    cp /dev/null /mnt/var/log/lastlog
    cp /dev/null /mnt/var/log/wtmp
</pre>
</li>
<li>Now that the base and X are updated, install new packages:
<pre>
    pkg_add -z -l /root/pkg_list_manual
    pkg_add -za -l /root/pkg_list_full
</pre>
</li>
</ol>

<h3>Package notes</h3>

<ul>
<li>Reminder: if you rely on anything from packages for management
access to the system (for example: shells, VPN software, routing daemons,
etc), arrange alternative access before removing packages.
<li>Various packages use non-portable data formats in cache files etc.
If you run into problems it may be necessary to remove these.
<li>If using the <b>rrdtool</b> package, note that the binary RRD database file
format on 32-bit architectures will not be compatible.
Export any RRD files to XML format before updating:
<pre>
    # Single file:
    rrdtool dump filename.rrd filename.xml

    # To convert a batch:
    for i in *.rrd; do rrdtool dump $i ${i%.rrd}.xml; done
</pre>
After updating, restore them as follows:
<pre>
    # Single file:
    rrdtool restore filename.xml filename.rrd

    # To convert a batch:
    for i in *.xml; do rrdtool restore $i ${i%.xml}.rrd; done
</pre>
This is not necessary on 64-bit architectures (amd64, sparc64, etc).
<li>If using the <b>postgresql</b> package, this has had a major version update
which requires the usual dump+restore cycle as described in the update notes
(see /usr/local/share/doc/pkg-readmes/postgresql*).
<b>The old database must be dumped *before* upgrading OpenBSD.</b>
Also note that because all old packages are removed, the normal warning
from pkg_add at update time is not triggered.
</ul>

<p>
<a name="20130813b"></a>
<h3>2013/08/13 - new identd(8) implementation</h3>
/usr/libexec/identd has been replaced by a new libevent-based daemon,
/usr/sbin/identd.
You should remove the old version:
<pre>
   rm -f /usr/libexec/identd
</pre>
If you are currently using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=identd&sektion=8">identd(8)</a>
as a standalone daemon (identd_flags is set in /etc/rc.conf.local),
check the manual to confirm that the flags are still valid.<p>
If you are currently using it from
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>,
remove the "ident" entries from /etc/inetd.conf, set identd_flags instead,
reload inetd and start identd:
<pre>
   $EDITOR /etc/inetd.conf
   $EDITOR /etc/rc.conf.local
   /etc/rc.d/inetd reload
   /etc/rc.d/identd start
</pre>
Note that if you have not yet run sysmerge, "/etc/rc.d/identd start" will
report a failure.

<p>
<a name="20130816"></a>
<h3>2013/08/16 - vlan(4) and pppoe(4) ABI breaks</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&sektion=4">vlan(4)</a> and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&sektion=4">pppoe(4)</a>
now use their own set of dedicated ioctls. So make sure to compile and install
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a> against the new headers if you are building your kernel from source.
<p>
This specially applies to people relying on these interfaces and willing to cross
the <a href="#20130813">time_t ABI break</a> by updating with source.

<p>
<a name="20130823"></a>
<h3>2013/08/23 - [ports] php 5.4</h3>
The primary PHP version used in ports has switched to 5.4.
This change means that if you run PHP applications packaged in ports,
you will need to switch your webserver config to use the newer version
of PHP.
Check /etc/php-5.3.ini for changes from the default configuration:
<pre>   diff /usr/local/share/examples/php-5.3/php.ini-production /etc/php-5.4.ini</pre>
and carry them across to /etc/php-5.4.ini.
You will also need to check for links to any active PHP extension modules
in /etc/php-5.3 and re-create them in /etc/php-5.4, e.g.
<pre>   cd /etc/php-5.4
   ls -l ../php-5.4.sample
   ln -s ../php-5.4.sample/pdo_mysql.ini .
   # (etc)
</pre>
If you are currently using PHP with Apache in base, you will also need to
adjust your Apache configuration:
<pre>   cd /var/www/conf/modules
   ln -fs /var/www/conf/modules.sample/php-5.4.conf /var/www/conf/modules/php.conf</pre>

<p>
<a name="20130914"></a>
<h3>2013/09/14 - [ports] dspam 3.10.2</h3>
If you were using one of the mysql or pgsql FLAVORS of the <b>dspam</b> package
you will have to manually install the corresponding driver subpackage after the
update to the 3.10.2 version.
If you were using dspam with the PostgreSQL driver:
<pre>
   pkg_add dspam-pgsql
</pre>
If you were using dspam with the MySQL driver:
<pre>
   pkg_add dspam-mysql
</pre>

<p>
<a name="20130919"></a>
<h3>2013/09/19 - [ports] wordpress 3.6.1</h3>
The twentyeleven theme from wordpress 3.5.x is no longer included with
wordpress 3.6.x. If you are using this theme, back it up before updating:
<pre>
   cd /var/www/wordpress/wp-content/themes &&
   cp -Rp twentyeleven twentyeleven.bak
</pre>
and restore it after wordpress update:
<pre>
   cd /var/www/wordpress/wp-content/themes &&
   mv twentyeleven.bak twentyeleven
</pre>

<p>
<a name="20131010"></a>
<h3>2013/10/10 - [ports] Apache Subversion 1.8.3</h3>
Apache Subversion has been upgraded to version 1.8.3.
This release of Subversion updates the working copy format (client-side).
Existing working copies need to be upgraded using <tt>svn upgrade</tt>
because Subversion 1.8 cannot operate with older working copy formats.
See the <a href="http://subversion.apache.org/docs/release-notes/1.8.html#wc-upgrade"
>section about working copy upgrades</a> in Subversion's release notes for details.
The server is fully backwards compatible and will serve existing repositories just fine.
However, to take advantage of new FSFS repository features a repository upgrade is necessary.
See the <a href="http://subversion.apache.org/docs/release-notes/1.8.html#fsfs-enhancements"
>section about FSFS enhancements</a> for details.

<p>
<a name="20131012"></a>
<h3>2013/10/12 - pf queue changes</h3>
PF has a new implementation of packet queueing - the configuration syntax
is different to that used by altq.
During a transition period, the old mechanism is still available by
replacing "queue" keywords in /etc/pf.conf with "oldqueue".
If instead you wish to switch to the new implementation, review the
documentation in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>.

<p>
<a name="20131014"></a>
<h3>2013/10/14 - [ports] PostgreSQL 9.3.0</h3>
Major update to 9.3.0. A dump/restore is required.

<p>
<a name="20131019"></a>
<h3>2013/10/17 - [ports] Lout 3.40</h3>
Lout packages were merged and require removal before upgrade: 
<pre>
   pkg_delete lout lout-doc
   pkg_add lout
</pre>

<p>
<a name="20131031"></a>
<h3>2013/10/31 - new routing message version</h3>
To convert the route expire time to 64 bit, it was necessary to
change the routing message structure.
Make sure that you boot a new kernel before replacing the user land
programs.
<br>
A small compatibility layer allows to configure addresses with old
ifconfig and new kernel.
Old route get also works in this setup.
Old dhclient with new kernel assigns the address but hangs.
Make sure to reboot your machine sucessfully during transition.

<p>
<a name="20131103"></a>
<h3>2013/11/03 - [ports] ngircd 21</h3>
ngircd's configuration directory has changed; if updating from a previous
version, you will need to move your old configuration file into place:
<pre>
   mv /etc/ngircd.conf /etc/ngircd/ngircd.conf
</pre>
Additional steps may be needed if you have configured it to use a motd file,
ssl or chroot.

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: current.html,v 1.434 2013/11/04 01:27:25 fgsch Exp $</small>

</body>
</html>
