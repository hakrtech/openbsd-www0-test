<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 2005-2014 by OpenBSD">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
</font>

<p>

<h1><font color="#e00000">Following <i>-current</i></font></h1>
<hr>

<h3>Table of Contents</h3>
<p>
<ul>
<li><a href="#Intro">Introduction</a>
<!-- Oldest on top... -->
<!-- New additions go on the bottom, please -->
<li><a href="#20140312b">2014/03/12 - smtpd becomes default MTA</a>
<li><a href="#20140312c">2014/03/12 - spray removed</a>
<li><a href="#20140313">2014/03/13 - _smtpq user added</a>
<li><a href="#20140313b">2014/03/13 - httpd(8) removed</a>
<li><a href="#20140316">2014/03/16 - [ports] unbound(8) moved to base, updated</a>
<li><a href="#20140317">2014/03/17 - ftpd(8) disallows uid &lt; 1000 by default</a>
<li><a href="#20140317b">2014/03/17 - userland agp(4) interfaces removed</a>
<li><a href="#20140317c">2014/03/17 - userland ppp(8) and pppoe(8) implementations removed</a>
<li><a href="#20140319">2014/03/19 - rcp(1) removed</a>
<li><a href="#20140323">2014/03/23 - powerpc is now PIE</a>
<li><a href="#20140323b">2014/03/23 - librt removed</a>
<li><a href="#20140323c">2014/03/23 - Miscellaneous functions removed</a>
<li><a href="#20140323d">2014/03/23 - mount(2) changes for NFS, mfs, msdosfs, and ntfs</a>
<li><a href="#20140324">2014/03/24 - tcpwrappers removed</a>
<li><a href="#20140326">2014/03/26 - rmail(8) and uucpd(8) moved to ports, updated</a>
<li><a href="#20140329">2014/03/29 - pflow(4) pflowproto 9 removed</a>
<li><a href="#20140414">2014/04/14 - snmpd(8), snmpctl(8), and relayd(8) now communicate via AgentX protocol</a>
<li><a href="#20140419">2014/04/19 - altq removed</a>
<li><a href="#20140420">2014/04/20 - [ports] roundcubemail update needs config changes</a>
<li><a href="#20140421">2014/04/21 - lpd(8): hosts.equiv removed</a>
<li><a href="#20140422">2014/04/22 - kerberosV removed</a>
</ul>

<hr>

<a name="Intro"></a>
<!-- XXXversion -->
<h2>Introduction</h2>
This document is for people who wish to follow <i>-current</i>.
It contains information about changes from 5.5-release to <i>-current</i>,
and should NOT be used by anyone upgrading from 5.4 or earlier, or people
wishing to follow <a href="../stable.html"><i>-stable</i></a>.

<p>
If you wish to upgrade to 5.5-release or 5.5-stable from previous
versions, see the <a href="upgrade55.html">upgrade guide</a>.

<p>
Make sure you have read and understood
<a href="faq5.html">FAQ 5 - Building the System from Source</a>
before using -current and the instructions below.

<p>
You should ALWAYS use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
Most of these changes will have to be performed as root.

<p>

<a name="20140312b"></a>
<h3>2014/03/12 - smtpd becomes default MTA</h3>
The default system MTA is now smtpd. If you are running sendmail with anything
other than the default configuration, please exercise caution and care
when upgrading. The sendmail cronjob should be disabled, /etc/mailer.conf
and /etc/rc.conf{,local} should be checked to verify one and only one MTA is
enabled, and newaliases run.
<pre>
    crontab -e
    vi /etc/mailer.conf
    vi /etc/rc.conf
    vi /etc/rc.conf.local
    newaliases
</pre>

<a name="20140312c"></a>
<h3>2014/03/12 - spray removed</h3>
/usr/sbin/spray and the associated rpc daemon have been removed.
<pre>
    rm -f /usr/sbin/spray
    rm -f /usr/libexec/rpc.sprayd
    rm -f /usr/share/man/man8/{,rpc.}spray{,d}.8
    vi /etc/inetd.conf
</pre>

<a name="20140313"></a>
<h3>2014/03/13 - _smtpq user added</h3>
A new <em>_smtpq</em> user and group have been added to support privilege
separation in smtpd. Add the following passwd line using vipw.
<pre>
    _smtpq:*:103:103::0:0:SMTP Daemon:/var/empty:/sbin/nologin
</pre>
Add the following line to /etc/group.
<pre>
    _smtpq:*:103:
</pre>
If you have previously started smtpd, you will need to change the owner of
the queue subdirectories.
<pre>
    cd /var/spool/smtpd
    chown -R _smtpq corrupt incoming purge queue temporary
</pre>

<a name="20140313b"></a>
<h3>2014/03/13 - httpd(8) removed</h3>
/usr/sbin/httpd and the associated tools and files have been removed.
Consider using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nginx&sektion=8">nginx(8)</a>
for your http serving needs, but note that nginx is not a drop-in replacement.
If you need the old httpd(8) or tools (e.g. logresolve, htdigest,
etc) and cannot switch at this time, see the port www/apache-httpd-openbsd.
Packages are not yet available due to release engineering, but will follow.
All users need to remove the following files and directories:
<pre>
    rm -rf /usr/lib/apache
    rm -rf /usr/share/doc/html/httpd
    rm -f /usr/bin/{dbmmanage,htdigest}
    rm -f /usr/sbin/{apachectl,apxs,httpd,logresolve,rotatelogs,suexec}
    rm -f /usr/share/man/man1/{dbmmanage.1,htdigest.1}
    rm -f /usr/share/man/man8/{apachectl.8,apxs.8,httpd.8,logresolve.8}
    rm -f /usr/share/man/man8/{rotatelogs.8,suexec.8}
    rm -f /etc/rc.d/httpd
</pre>

The following files are associated with httpd(8) and can be deleted in some
cases, but may have been replaced with user content or configuration.
<b>Warning: On systems which currently or have previously used any http daemon,
care must be taken and files analyzed case by case to avoid accidental deletion
of user content or important configuration files.</b>
In particular, users moving to apache-httpd-openbsd will want to keep many
of these files.
<pre>
    rm -rf /var/www/icons
    rmdir /var/www/conf/{modules,modules.sample}
    rmdir /var/www/users
    rm -f /var/www/cgi-bin/{printenv,test-cgi}
    rm -f /var/www/conf/{httpd.conf,magic,mime.types}
    rm -f /var/www/htdocs/{apache_pb.gif,blowfish.jpg,bsd_small.gif,index.html}
    rm -f /var/www/htdocs/{lock.gif,logo23.jpg,logo24.jpg,mod_ssl_sb.gif}
    rm -f /var/www/htdocs/{openbsd_pb.gif,openbsdpower.gif,openssl_ics.gif}
    rm -f /var/www/htdocs/smalltitle.gif
</pre>
Many PHP applications will work under nginx with few or minimal changes;
in most cases php-fpm is the preferred method of running PHP under nginx.

<a name="20140316"></a>
<h3>2014/03/16 - [ports] unbound(8) moved to base</h3>
Unbound has moved to the base OS.<p>

If the package is installed, remove it before upgrading to avoid a
conflict in /etc/rc.d/unbound, and edit rc.conf.local to remove "unbound"
from "pkg_scripts=..." lines, and add "unbound_flags=" instead.

<pre>
    pkg_delete unbound
    vi /etc/rc.conf.local
</pre>

The following applies only to those updating from source, or updating from a
snapshot without using sysmerge: The _unbound user should be added using vipw
(or the UID should be modified if you were previously using Unbound from
ports).
<pre>
    _unbound:*:53:53::0:0:Unbound Daemon:/var/unbound:/sbin/nologin
</pre>

And _unbound group.

<pre>
    _unbound:*:53:
</pre>

On or before March 19, sysmerge(8) was unable to do the /etc/group
crossing automatically if updating from source.  Manual intervention will
be required in those situations.

<a name="20140317"></a>
<h3>2014/03/17 - ftpd(8) disallows uid &lt; 1000 by default</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&sektion=8">ftpd(8)</a>
now defaults to denying access to user accounts with uid below 1000.
See the -m option if you need to change this.

<a name="20140317b"></a>
<h3>2014/03/17 - userland agp(4) interfaces removed</h3>
With the introduction of KMS, userland access to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=agp&sektion=4">agp(4)</a>
is no longer needed.  Since these interfaces provided low-level access
to the hardware, they have been removed.  You should remove the associated header file:
<pre>
    rm -f /usr/include/sys/agpio.h
</pre>

<a name="20140317c"></a>
<h3>2014/03/17 - userland ppp(8) and pppoe(8) implementations removed</h3>
The userland <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&manpath=OpenBSD+5.4">ppp(8)</a>
daemon and its associated PPPoE helper,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&sektion=8&manpath=OpenBSD+5.4">pppoe(8)</a>,
have been removed.
As a result, the old binaries and manual pages should be removed:
<pre>
    rm -f /etc/ppp/ppp.{conf,linkdown,linkup,secret}.sample
    rm -f /usr/sbin/ppp /usr/share/man/man8/ppp.8
    rm -f /usr/sbin/pppctl /usr/share/man/man8/pppctl.8
    rm -f /usr/sbin/pppoe /usr/share/man/man8/pppoe.8
</pre> 
Many users will be able to migrate to the kernel implementations:
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&sektion=4">pppoe(4)</a>
(for PPPoE),
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=4">ppp(4)</a>
and its associated control program
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8">pppd(8)</a>
(for modems, mobile data, and some use with userland programs via a pipe).<p>
Another option for some users is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=npppd&sektion=8">npppd(8)</a>
which supports L2TP, PPTP and PPPoE (currently server-side, IPv4 only).

<a name="20140319"></a>
<h3>2014/03/19 - rcp(1) removed</h3>
rcp(1) has been removed.
As a result, the binary and manual page should be removed:
<pre>
    rm -f /bin/rcp /usr/share/man/man1/rcp.1
</pre>

<a name="20140323"></a>
<h3>2014/03/23 - powerpc is now PIE</h3>
The powerpc platform has been switched to
PIE (position-independent executables) by default.
Everyone is encouraged to update via snapshots (dated after 2014/03/23); if you
want to upgrade via sources, follow these instructions:
<p>
First, make sure you are running an up-to-date kernel.
Second, install the new system Makefiles with the change to PIE_ARCH in
bsd.own.mk:
<blockquote><pre>
    cd /usr/src/share/mk && make install
</pre></blockquote>
Then, recompile and install gcc and binutils.
<blockquote><pre>
    cd /usr/src/gnu/usr.bin/binutils
    make -f Makefile.bsd-wrapper clean && make -f Makefile.bsd-wrapper obj && \
        make -f Makefile.bsd-wrapper depend && make -f Makefile.bsd-wrapper
    cd /usr/src/gnu/usr.bin/cc
    make clean && make obj && make depend && make && make install
    cd /usr/src/gnu/usr.bin/binutils && make -f Makefile.bsd-wrapper install
</pre></blockquote>
Finally, recompile your system by following the procedure outlined in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&sektion=8">release(8)</a>.

<a name="20140323b"></a>
<h3>2014/03/23 - librt removed</h3>
The librt static stub library has been removed. The leftover files must be deleted.

<pre>
    rm -f /usr/lib/librt{,_p}.a
</pre>

<a name="20140323c"></a>
<h3>2014/03/23 - Miscellaneous functions removed</h3>
Miscellaneous functions have been removed from libc.
The corresponding header files must be deleted.

<pre>
    rm -f /usr/include/bm.h
    rm -f /usr/include/md4.h
</pre>


<a name="20140323d"></a>
<h3>2014/03/23 - mount(2) changes for NFS, mfs, msdosfs, and ntfs</h3>

Changes to the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&sektion=2">mount(2)</a>
API/ABI means that NFS servers must rebuild
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8">mountd(8)</a>
against the updated headers and restart it after rebooting to the
new kernel.
<br>
Similarly, the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_mfs&sektion=8">mount_mfs(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_msdos&sektion=8">mount_msdos(8)</a>, and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_ntfs&sektion=8">mount_ntfs(8)</a>
must be recompiled and reinstalled.
Installing a new snapshot is&mdash;as always&mdash;recommended.

<a name="20140324"></a>
<h3>2014/03/24 - tcpwrappers removed</h3>
libwrap and tcpd have been removed. The leftover remnants must be purged.
The entries in /etc/host.{allow,deny} can be converted into filtering 
rules in /etc/pf.conf.

<pre>
    rm -f /usr/lib/libwrap{,_p}.*
    rm -f /usr/libexec/tcpd
    rm -f /usr/include/tcpd.h
    rm -f /usr/sbin/tcpd{chk,match}
    rm -f /usr/share/man/man3/hosts_access.3
    rm -f /usr/share/man/man5/hosts.{allow,deny}.5
    rm -f /usr/share/man/man5/hosts_{access,options}.5
    rm -f /usr/share/man/man8/tcpd{,chk,match}.8
    rm -f /etc/hosts.{allow,deny}
</pre>

<a name="20140326"></a>
<h3>2014/03/26 - rmail(8) and uucpd(8) moved to ports</h3>
/bin/rmail and uucpd(8) have been removed from the base system and added
to the ports tree.
As a result, the old binaries and manual pages should be removed:
<pre>
    rm -f /bin/rmail
    rm -f /usr/share/man/man8/rmail.8
    rm -f /usr/libexec/uucpd
    rm -f /usr/share/man/man8/uucpd.8
</pre>
Users of these programs should install the rmail and uucpd packages instead.

<a name="20140329"></a>
<h3>2014/03/29 - pflow(4) pflowproto 9 removed</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflow&sektion=4">pflow(4)'s</a> pflowproto 9 has been removed. Consider using pflowproto 10.

<a name="20140414"></a>
<h3>2014/04/14 - snmpd(8), snmpctl(8), and relayd(8) now communicate via AgentX protocol</h3>
The communications channel over which snmpd(8) accepts trap requests has been
converted to the AgentX protocol.
Users who have configured relayd(8) to send traps on host status changes will have to
modify their configurations for both snmpd(8) and relayd(8):<br>
snmpd.conf(5):<br>
<pre>
    # listen for AgentX connections
    socket "/var/run/agentx.sock" agentx
</pre>
relayd.conf(5) syntax has changed, from &quot;send trap&quot; to &quot;snmp trap&quot;:
<pre>
    # used to be "send trap"
    snmp trap "/var/run/agentx.sock"
</pre>

<a name="20140419"></a>
<h3>2014/04/19 - altq removed</h3>
The old queueing subsystem, altq, has been removed.
If any <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>
rules mentioning "altq" or "oldqueue" are still present, loading the ruleset
will now fail, so must be removed or migrated to the new queue configuration.
Old headers should also be removed:

<pre>
    rm -rf /usr/include/altq
</pre>

<a name="20140420"></a>
<h3>2014/04/20 - [ports] roundcubemail update needs config changes</h3>

Roundcube configuration files have been rearranged, if upgrading an
existing system you will need to migrate your settings from old config
files (db.inc.php and main.inc.php) to the new file (config.inc.php).

<a name="20140421"></a>
<h3>2014/04/21 - lpd(8): hosts.equiv removed</h3>

hosts.equiv usage has been deprecated and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lpd&sektion=8">lpd(8)</a>
does not use it anymore for access control.
Users of this file should migrate to use <u>/etc/hosts.lpd</u>.

<a name="20140422"></a>
<h3>2014/04/22 - kerberosV removed</h3>

kerberosV has been removed. The login methods &quot;krb5&quot; and
&quot;krb5-or-pwd&quot; are not supported anymore and should be
removed from
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&sektion=5">login.conf(5)</a>.
Many dependencies and packages have to be updated.
The libraries, headers and other related files should be removed from
the system.

<pre>
	rm -rf /etc/kerberosV/
	rm -f /etc/rc.d/{kadmind,kdc,kpasswdd,ipropd_master,ipropd_slave}
	rm -f /usr/bin/asn1_compile
	rm -f /usr/bin/compile_et
	rm -f /usr/bin/kcc
	rm -f /usr/bin/kdestroy
	rm -f /usr/bin/kf
	rm -f /usr/bin/kgetcred
	rm -f /usr/bin/kinit
	rm -f /usr/bin/klist
	rm -f /usr/bin/krb5-config
	rm -f /usr/bin/slc
	rm -f /usr/bin/string2key
	rm -f /usr/bin/verify_krb5_conf
	rm -rf /usr/include/kerberosV/
	rm -f /usr/lib/libasn1{,_p}.*
	rm -f /usr/lib/libcom_err{,_p}.*
	rm -f /usr/lib/libgssapi{,_p}.*
	rm -f /usr/lib/libhdb{,_p}.*
	rm -f /usr/lib/libheimbase{,_p}.*
	rm -f /usr/lib/libkadm5clnt{,_p}.*
	rm -f /usr/lib/libkadm5srv{,_p}.*
	rm -f /usr/lib/libkafs{,_p}.*
	rm -f /usr/lib/libkdc{,_p}.*
	rm -f /usr/lib/libkrb5{,_p}.*
	rm -f /usr/lib/libroken{,_p}.*
	rm -f /usr/lib/libwind{,_p}.*
	rm -rf /usr/libdata/perl5/site_perl/*-openbsd/kerberosV/
	rm -f /usr/libexec/auth/login_krb5{,-or-pwd}
	rm -f /usr/libexec/hprop{,d}
	rm -f /usr/libexec/ipropd-{master,slave}
	rm -f /usr/libexec/kadmind
	rm -f /usr/libexec/kdc
	rm -f /usr/libexec/kfd
	rm -f /usr/libexec/kpasswdd
	rm -f /usr/sbin/iprop-log
	rm -f /usr/sbin/kadmin
	rm -f /usr/sbin/kimpersonate
	rm -f /usr/sbin/kstash
	rm -f /usr/sbin/ktutil
	rm -f /usr/share/info/heimdal.info
	rm -f /usr/share/man/man1/kdestroy.1
	rm -f /usr/share/man/man1/kf.1
	rm -f /usr/share/man/man1/kgetcred.1
	rm -f /usr/share/man/man1/kinit.1
	rm -f /usr/share/man/man1/klist.1
	rm -f /usr/share/man/man1/krb5-config.1
	rm -f /usr/share/man/man1/kswitch.1
	rm -f /usr/share/man/man3/ecalloc.3
	rm -f /usr/share/man/man3/getarg.3
	rm -f /usr/share/man/man3/{gss,krb5,krb}_*.3
	rm -f /usr/share/man/man3/gssapi.3
	rm -f /usr/share/man/man3/gsskrb5_extract_authz_data_from_sec_context.3
	rm -f /usr/share/man/man3/gsskrb5_register_acceptor_identity.3
	rm -f /usr/share/man/man3/k_afs_cell_of_file.3
	rm -f /usr/share/man/man3/k_hasafs.3
	rm -f /usr/share/man/man3/k_hasafs_recheck.3
	rm -f /usr/share/man/man3/k_pioctl.3
	rm -f /usr/share/man/man3/k_setpag.3
	rm -f /usr/share/man/man3/k_unlog.3
	rm -f /usr/share/man/man3/kadm5_pwcheck.3
	rm -f /usr/share/man/man3/kafs*.3
	rm -f /usr/share/man/man3/krb524_*.3
	rm -f /usr/share/man/man3/parse_time.3
	rm -f /usr/share/man/man3/rtbl.3
	rm -f /usr/share/man/man5/krb5.conf.5
	rm -f /usr/share/man/man5/mech.5
	rm -f /usr/share/man/man8/hprop{,d}.8
	rm -f /usr/share/man/man8/iprop{,-log}.8
	rm -f /usr/share/man/man8/ipropd-{master,slave}.8
	rm -f /usr/share/man/man8/kadmin{,d}.8
	rm -f /usr/share/man/man8/kdc.8
	rm -f /usr/share/man/man8/kerberos.8
	rm -f /usr/share/man/man8/kfd.8
	rm -f /usr/share/man/man8/kimpersonate.8
	rm -f /usr/share/man/man8/kpasswdd.8
	rm -f /usr/share/man/man8/kstash.8
	rm -f /usr/share/man/man8/ktutil.8
	rm -f /usr/share/man/man8/login_krb5{,-or-pwd}.8
	rm -f /usr/share/man/man8/string2key.8
	rm -f /usr/share/man/man8/verify_krb5_conf.8
</pre>

Remaining users of kerberosV should download and install the software
manually or use the kerberos packages when they become available.

<hr>
<br>
<small>$OpenBSD: current.html,v 1.506 2014/05/01 15:02:29 nick Exp $</small>

</body>
</html>
