<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>6 - Jaringan</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "halaman FAQ OpenBSD">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- passes validator.w3.org, please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[Indeks FAQ]</a>
<a href="faq5.html">[Ke Bagian 5 - Membangun Sistem dari Kode Sumber</a>
<a href="faq7.html">[Ke Bagian 7 - Kendali Keyboard dan Tampilan]</a>
</font>

<h1><font color="#e00000">6 - Jaringan</font></h1>
<hr>

<p>
<h3>Daftar Isi</h3>
<ul>
<li><a href= "#Intro" >6.1 - Sebelum kita lanjut lebih dalam</a>
<li><a href= "#Setup" >6.2 - Inisialiasi pengaturan jaringan</a>
<li><a href= "#PF"    >6.3 - Bagaimana saya membatasi dan firewall dengan OpenBSD?</a>
<li><a href= "#DHCP"  >6.4 - Dynamic Host Configuration Protocol</a>
<li><a href= "#PPP"   >6.5 - Point to Point Protocol</a>
<li><a href= "#Tuning">6.6 - Tuning parameter jaringan</a>
<li><a href= "#NFS"   >6.7 - Menggunakan NFS</a>
<li><a href= "#PPTP"  >6.8 - Menjalankan sebuah koneksi PPTP dengan OpenBSD</a>
<li><a href= "#Bridge">6.9 - MEnjalankan sebuah bridge dengan OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>6.1 - Sebelum berlanjut lebih jauh</h2>

<p>
Pada sebagian besar dokumen ini akan membantu jika anda telah membaca dan
paling tidak sedikit memahami bagian <a href="faq5.html">Pengaturan dan 
Konfigurasi Kernel</a> dari FAQ, dan
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">
ifconfig(8)</a> dan halaman manual
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">
netstat(1)</a>.

<p>
Jika anda seorang administrator jaringan, dan anda mengatur protokol
routing, jika anda menggunakan OpenBSD anda sebagai router, jika anda perlu 
kejelasan tentang jaringan IP, anda sangat perlu membaca
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">Pemahaman 
Pengalamatan IP(Understanding IP Addressing)</a>.
Dokumen ini sangat bagus. "Understanding IP Addressing" berisi
pengetahuan dasar untuk membangun jaringan IP,
khususnya ketika anda berurusan atau bertanggung jawab pada lebih dari satu
jaringan.

<p>
Jika anda bekerja dengan aplikasi seperti server web, server ftp,
dan server mail, anda akan sangat diuntungkan dengan 
<a href="http://www.rfc-editor.org/rfc.html">membaca RFC</a>.
Kebanyakan sepertinya, anda tidak membaca seluruhnya. Ambil beberapa bahasan yang
menarik bagi anda, atau yang adna gunakan dalam lingkungan jaringan anda. Cermati
, temukan bagimana sesuatu dinginkan berjalan seperti apa. RFC menentukan banyak
(ribuan) standar untuk protokol pada Internet dan bagaimana protokol-protokol 
tersebut harus berjalan.

<p>
<a name="Setup"></a>
<h2>6.2 - Inisialisasi Pengaturan Jaringan</h2>

<p>
<a name="Setup.1"></a>
<h3>6.2.1 - Mengenali dan Mengatur Kartu Jaringan Anda</h3>

<p>
Untuk permulaan, anda harus mengenali kartu jaringan anda. Dalam 
OpenBSD, dinamai berdasar jenis kartu, bukan jenis
koneksitas. Bisa anda lihat kartu jaringan anda dikenali sewaktu
proses booting, atau setelah proses booting menggunakan perintah 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>
.  Bisa pula anda punyai kesempatan untuk mengenali kartu jaringan anda menggunakan perintah
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Misal, di sini diberikan keluaran dmesg kartu jaringan Intel Fast Ethernet, 
yang menggunakan nama divais fxp.

<blockquote><pre>
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre></blockquote>

<p>
Jika anda tidak tahu penamaan kartu jaringan, mohon lihat 
<a href="../../id/plat.html">daftar peranti keras terdukung</a> untuk platform anda.
Akan anda jumpai sebuah daftar untuk banyak kartu yang umum dan nama divaisnya
pada OpenBSD disebutkan di sini. Gabungan nama divais alfabet pendek (seperti fxp) 
dengan sebuah angka yang diberikan oleh kernel dan anda akan mempunyai sebuah nama
(seperti fxp0).

<p>
Dapat anda lihat bahwa kartu jaringan telah dikenali dengan menggunakan utilitas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
. Perintah berikut ini akan menunjukkan seluruh antarmuka jaringan pada sebuah 
sistem. Contoh keluaran memperlihatkan pada kita hanya ada satu antarmuka fisik ethernet,
dan itu adalah  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>.

<blockquote><pre>
$ <strong>ifconfig -a</strong>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre></blockquote>

<p>
Seperti anda lihat,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> 
memberi kita banyak keterngan daripada yang kita butuhkan disini. Tetapi, 
masih bisa kita lihat antarmuka jaringan kita. Pada contoh di atas, 
kartu jaringan kita telah dikonfigurasi . Sangat jelas karena sebuah 
jaringan IP telah dikonfigurasi pada fxp0, yaitu nilai &quot;inet 
10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;. Juga, 
penanda <strong>UP</strong> and <strong>RUNNING</strong> telah aktif.

<p>
Pada akhirnya, anda akan diberitahu beberapa antarmuka lainnya yang diaktifkan
dari bawaan sistem. Itu adalah antarmuka virtual yang melayani berbagai fungsi.
Halaman manual berikut menjelaskannya:

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
 - Antarmuka Loopback
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4">pflog</a>
 - Antarmuka Packet Filter Logging
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
 - Antarmuka Jaringan SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
 - Point to Point Protocol
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
 - Antarmuka Jaringan Tunnel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
 - Antarmuka Encapsulating
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
 - Antarmuka Bridge Ethernet Bridge
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
 - Antarmuka Encapsulation IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
 - Antarmuka Encapsulation GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
 - Antarmuka IPv4/IPv6 Generik
</ul>

<p>
Jika kartu jaringan anda tidak terkonfigurasi, langkah pertama adalah membuat
berkas <i>/etc/hostname.xxx</i>, dengan nama divais anda akan menggantikan
xxx. Dari keterangan contoh di atas, 
nama berkas akan manjadi <i>/etc/hostname.fxp0</i>. Layout berkas ini 
sederhana:<br>

<blockquote><pre>
address_family address netmask broadcast [other options]
</pre></blockquote>

(Lebih rinci tentang format berkas ini dapat ditemukan pada halaman manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>
.)

<p>
Berkas konfigurasi yang umum, untuk konfigurasi alamat IPv4,
terlihat seperti berikut:

<blockquote><pre>
$ <strong>cat /etc/hostname.fxp0</strong>
inet 10.0.0.38 255.255.255.0 NONE
</pre></blockquote>

<p>
Bisa juga anda tentukan jenis media untuk Ethernet, katakan, jika anda ingin
memaksa menggunakan modus 100baseTX full-duplex.

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
(Tentu saja, anda seharusnya jangan pernah memaksakan modus full duplex kecuali kedua sisi
koneksi telah diatur untuk hal ini! Pada kebutuhan yang umum,
pengaturan media seharusnya diabaikan.)

<p>
Atau, mungkin anda ingin menggunakan penanda khusus untuk beberapa antarmuka.
Format berkas hostname tidak berubah banyak!

<blockquote><pre>
$ <strong>cat /etc/hostname.vlan0</strong>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
Langkah selanjutnya dari sini adalah mengatur gateway default anda. Untuk hal ini,
mudahnya letakkan IP gateway anda pada berkas <i>/etc/mygate</i>. Akan
membuat gateway anda dikonfigurasi setelah boot. DAri isni anda seharusnya
mengatur nameserver anda, dan berkas <i>/etc/hosts</i> anda (lihat halaman manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>
). Untuk mengkonfigurasi nameserver anda, anda perlu membuat sebuah berkas bernama 
<i>/etc/resolv.conf</i>. Bisa anda baca lebih lanjut tentang format berkas ini pada halaman manual 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a>
. tetapi untuk penggunaan standar, berikut ini ada contohnya. Pada contoh ini
server domain anda adalah 125.2.3.4 dan 125.2.3.5. Anda juga mempunyai 
domain &quot;example.com&quot;.

<blockquote><pre>
$ <strong>cat /etc/resolv.conf</strong>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre></blockquote>

<p>
Dari sini, bisa anda reboot maupun menjalankan
skrip <strong>/etc/netstart</strong>. Anda lakukan ini dengan mudahnya mengetikkan
(sebagai root):

<blockquote><pre>
# <strong>sh /etc/netstart</strong>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre></blockquote>

<p>
Perhatikan bahwa sedikit kesalahan telah terjadi. Dengan menjalankan skrip ini, anda 
mengkonfigurasi ulang sesuatu yang telah terkonfigurasi. Seperti, beberapa route 
telah dialokasikan pada tabel routing kernel. Dari sini sistem anda seharusnya
siap dan berjalan untuk koneksi jaringan. Sekali lagi, bisa anda periksa untuk memastikan 
kartu jaringan telah di konfigurasi dengan tepat menggunakan
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Bisa juga anda periksa route anda dengan
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>
atau <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Jika anda mempunyai masalah routing, mungkin anda ingin menggunakan penanda -n pada
route(8) yang akan mencetak alamat IP daripada melakukan pencarian DNS 
dan menampilkan nama host.  Berikut ini contoh menampilkan tabel routing
menggunakan kedua program tersebut.

<blockquote><pre>
$ <strong>netstat -rn</strong>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <strong>route show</strong>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre></blockquote>

<p>
<a name="Setup.2"></a>
<h3>6.2.2 - Mengatur boks OpenBSD anda sebagai sebuah Gateway</h3>

<p>
Ini adalah keterangan dasar yang anda perlukan untuk membuat boks OpenBSD anda sebagai
sebuah gateway (juga disebut sebuah router). Jika anda gunakan OpenBSD sebagai router dengan
koneksi Internet, kami sarankan anda baca juga petunjuk pengaturan Packet Filter 
di bawah ini untuk menutup lalulintas yang berpotensial buruk. Juga, karena 
rendahnya ketersediaan alamat
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a>
dari jaringan penyedia layanan Internet dan registri regional, anda 
mungkin ingin melihat pada Network Address Translation untuk keterangan pada
penghematan ruang alamat IP anda.

<p>
Kernel GENERIC selalu mempunyai kemampuan membolehkan Forwarding IP, tetapi 
perlu untuk diaktifkan. Anda seharusnya melakukan ini dengan utilitas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
. Untuk mengubah secara menetap harus anda suntung berkas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf</a>
agar bisa untuk Forwarding IP. Untuk hal ini juga tambahkan baris berikut pada
berkas konfigurasi.

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Untuk membuat perubahan ini tanpa melakukan reboot anda gunakan utilitas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
secara langsung. Ingatlah ini meski perubahan tidak akan berpengaruh 
setelah reboot, dan perlu dijalankan sebagai root.

<blockquote><pre>
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
net.inet.ip.forwarding: 0 -&gt; 1
</pre></blockquote>

<p>
Sekarang kita modifikasi route pada host lain pada kedua sisi. Ada banyak
kemungkinan penggunaan OpenBSD sebagai router, menggunakan software semisal
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a>,
dan <a href="http://www.zebra.org">zebra</a>.  OpenBSD mempunyai dukungan pada
koleksi port untuk zebra, gated dan mrtd. OpenBSD mendukung
beberapa antarmuka T1, HSSI, ATM, FDDI, Ethernet, dan serial (PPP/SLIP).

<p>
<a name="Setup.3"></a>
<h3>6.2.3 - Membuat alias pada sebuah antarmuka jaringan</h3>

<p>
OpenBSD mempunyai tatacara sederhana untuk membuat alias pada sebuah
antarmuka. Untuk hal ini mudahnya sunting berkas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a>.
Berkas ini dibaca setelah booting oleh skrip
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a>
, yang merupakan bagian dari <a href="../faq10.html#rc">hierarki pemulaan
rc</a>.  Sebagai contoh, kita anggap pengguna mempunyai sebuah
antarmuka <b>dc0</b> dan pada jaringan 192.168.0.0. Keterangan penting 
lainnya:

<ul>
<li>IP untuk dc0 adalah 192.168.0.2
<li>NETMASK 255.255.255.0
</ul>

<p>
Sedikit catatan tambahan tentang alias. Dalam OpenBSD anda gunakan hanya nama
antarmuka. Tidak ada perbedaan antara alias pertama dan alias 
kedua. Tidak seperti sistem operasi lainnya, OpenBSD tidak merujuk alias
sebagai dc0:0, dc0:1. Jika anda merujuk pada sebuah alamat IP alias 
dengan ifconfig, atau menambahkan alias, pastikan untuk menyatakan "<tt>ifconfig 
int alias</tt>" daripada hanya "<tt>ifconfig int</tt>" pada baris
perintah. Bisa anda hapus alias dengan "<tt>ifconfig int delete</tt>".

<p>
Anggap anda menggunakan beberapa alamat IP yang berada pada subnet IP
yang sama untuk alias, pengaturan netmask anda untuk tiap alias menjadi 
255.255.255.255. IP alias tidak perlu mengikuti netmask dari IP pertama 
yang dipasang pada kartu jaringan. Pada contoh ini, <i>/etc/hostname.dc0</i>, dua 
alias ditambahkan pada divais dc0, yang, kita lihat, telah terkonfigurasi 
sebagai 192.168.0.2 netmask 255.255.255.0.

<blockquote><pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre></blockquote>

<p>
Setelah anda membuat berkas ini, ini hanya butuh untuk reboot agar 
berpengaruh. Bagaimanapun anda bisa menagtifkan alias secara manual dengan utilitas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
. Untuk mengaktifkan alias pertama anda gunakan perintah:

<blockquote><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></blockquote>

<p>
Untuk melihat alias ini harus anda gunakan perintah:

<blockquote><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></blockquote>


<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.3 - Bagaimana saya membatasi dan membuat firewall dengan OpenBSD?</h2>
Packet Filter (mulai dari sini sebut saja PF) adalah sistem OpenBSD untuk
menyaring lalulintas TCP/IP dan melakukan Network Address Translation. PF  
juga mampu menormalisasi dan mengkondisikan lalulintas TCP/IP dan 
menyediakan kendali lebar jalur data(bandwidth) dan melakukan prioritas paket, dan bisa digunakan
untuk menciptakan firewall yang tangguh dan fleksibel.
Hal ini dijelaskan pada <a href="../pf/id/index.html"><b>Panduan Penggunaan 
PF</b></a>.


<p> 
<a name= "DHCP"></a>
<h2>6.4 - DHCP</h2> 

<p>
<h3>6.4.1 Klien DHCP</h3>

<p>
Untuk menggunakan klien DHCP
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>
yang disertakan dalam OpenBSD, sunting <tt>/etc/hostname.xl0</tt> (dianggap kartu 
jaringan utama anda adalah xl0. Milik anda mungkin juga ep0 atau fxp0 atau 
lainnya!). Yang  anda perlukan adalah meletakkannya pada berkas nama host adalah '<tt>dhcp</tt>'

<pre>
# <strong>echo dhcp &gt;/etc/hostname.xl0</strong>
</pre>

<p>
INi akan membuat OpenBSD sevara langsung memulai klien DHCP sewaktu boot.
OpenBSD akan mengumpulkan alamat-alamat IP, gateway default, dan server DNS 
dari server DHCP.

<p>
Jika anda ingin menjalankan klien dhcp dari bari perintah, pastikan 
berkas /etc/dhclient.conf telah ada, lalu coba:

<pre>
# <strong>dhclient fxp0</strong>
</pre>

<p>
Dengan fxp0 adalah kartu jaringan yang anda inginkan menerima koneksi dhcp.

<p>
Tidak peduli bagaimana anda menjalankan dhclient, dapat anda sunting 
berkas /etc/dhclient.conf untuk <b>tidak</b> membarui DNS anda berdasar pada 
gagasan server dhcp tentang DNS dengan pertama-tama membuka baris 'request' pada
nya (itu adalah contoh untuk konfigurasi standar bawaan, tetapi anda perlu membuka
baris tersebut untuk menimpa konfigurasi dhclient bawaan.)

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
dan lalu <b>hapus</b> domain-name-servers.  Tentu saja, mungkin anda ingin untuk
mengahpus nama host, atau konfigurasi lainnya juga.

<p>
<h3>6.4.2 Server DHCP</h3>

<p>
Jika anda ingin menggunakan OpenBSD sebagai sebuah server DHCP 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>,
sunting <tt>/etc/rc.conf</tt>.  Aturlah sehingga menjadi <tt>dhcpd_flags="-q"</tt> 
daripada <tt>dhcpd_flags=NO</tt>. Letakkan antarmuka yang anda inginkan untuk
tempat dhcpd <b>berjalan(listen)</b> pada <tt>/etc/dhcpd.interfaces</tt>. 

<pre>
     # <b>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
Lalu, sunting <tt>/etc/dhcpd.conf</tt>.
Pilihan opsi pada berkas tersebut telah menjelaskan sendiri dengan terang dan bagus.

<pre>
        option  domain-name "example.com";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Hal ini akan memberitahu klien DHCP anda doamin yang di masukkan pada permintaan
DNS adalah exmaple.com (sehingga, jika user menulis 'telnet joe' maka ini 
akan dikirim sebagai joe.example.com). Akan mengrahakan permintaan DNS ke server DNS 
192.168.1.3 dan 192.168.1.5. Untuk host-host yang berada pada jaringan yang sama dengan
antarmuka jaringan pada mesin OpenBSD, yang berada dalam
daerah 192.168.1.0/24, akan diberikan sebuah alamat IP untuk klien antara 
192.168.1.32 dan 192.168.1.127. Akan diatur gateway default di 
192.168.1.1.

<p>
Jika anda ingin menjalankan dhcpd(8) dari baris perintah, setelah menyunting 
/etc/dhcpd.conf, coba:

<pre>
     # <b>dhcpd -q fxp0</b>
</pre>

<p>
Dengan <tt>fxp0</tt> adalah sebuah antarmuka untuk menjalankan layanan DHCP
Penanda <tt>-q</tt> membuat dhcpd(8) tenang; jika tidak akan sangat banyak 
memberi pesan keluaran.

<p>
Jika anda melayani DHCP pada sebuah boks Windows, mungkin anda ingin agar dhcpd(8) memberi 
klien tersebut sebuah alamat server 'WINS'. Untuk membuat hal ini, hanya tambahkan
baris berikut ke <tt>/etc/dhcpd.conf</tt> anda:

<pre>
     option    netbios-name-servers    192.168.92.55;
</pre>

<p>
(dengan <tt>192.168.92.55</tt> adalah IP Windows atau server Samba anda
.) Lihat
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a>
untuk pilihan opsi yang mungkin akan dipakai klien DHCP anda.


<p>
<a name="PPP"></a>
<h2>6.5 - PPP </h2>

<p>
Point-to-Protocol secara umum adalah apa yang digunakan untuk membuat hubungan dengan 
ISP anda melalui sebuah modem. OpenBSD mempunyai 2 cara untuk hal ini.

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a>
 - Merupakan daemon kernel ppp.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
 - Merupakan daemon userland ppp. 
</ul>

<p>
Hal paling pertama akan kami bahas adalah daemon userland PPP. Sebagai 
persiapan anda perlu beberapa keterangan singkast tentang ISP anda. Berikut ini 
adalah daftar keterangan berguna yang akan anda perlukan.

<ul>
<li>Nomor dialup ISP anda
<li>Nameserver anda 
<li>Username dan password anda
<li>Gateway anda
</ul>

<p>
Beberapa ada yang tidak harus dipakai, tetapi akan sangat membantu dalam mengatur 
ppp anda. Daemon PPP userland menggunakan berkas
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
sebagai berkas konfigurasinya.  Terdapat banyak berkas bermanfaat pada
<i>/etc/ppp</i> yang mempunyai pengaturan berbeda-beda untuk banyak keadaan 
berbeda. Anda seharusnya memeriksa direktori tersebut.

<p>
Juga, pastikan, jika anda tidak menggunakan kernel GENERIC, anda 
mempunyai baris ini dalam berkas konfigurasi anda:

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Inisialisasi Pengaturan - untuk PPP(8)</h3>

<p>
Inisialisasi Pengaturan untuk daemon userland PPP terdiri dari menyunting
berkas <i>/etc/ppp/ppp.conf</i> anda. Berkas ini tidak ada dari bawaan sistem, tetapi
ada berkas <i>/etc/ppp/ppp.conf.sample</i> yang mudahnya bisa anda sunting 
untuk membuat berkas <i>ppp.conf</i> anda sendiri. Di sini penulis akan menjalankan dengan
pengaturan termudah dan mungkin paling banyk digunakan. Ini adalah sebuah berkas 
<i>ppp.conf</i> yang ringkas yang mudahnya akan menghubungkan ke ISP anda dan mengatur 
route default dan nameserver anda . Dengan berkas ini seluruh keterangan 
yang anda perlukan adalah nomor telepon ISP anda dan username beserta password anda.

<blockquote>
<pre>
default:
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</blockquote>

<p>
bagian di bawah penanda <tt>default:</tt> akan dijalankan setiap kali.
Di sini kita konfigurasi seluruh keterangan penting kita. Dengan &quot;set 
log&quot; kita atur tingkat logging kita. Ini bisa diubah; merujuk pada
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
untuk lebih jelas tentang mengatur tingkat logging. Divais kita di atur dengan
&quot;set device&quot;. Ini adalah divais tempat modem berjalan. Pada 
contoh ini modem berjalan pada port com 2. Karenanya port com 1 akan menjadi 
<i>/dev/cua00</i>. Dengan &quot;set speed&quot; kita atur kecepatan koneksi 
dialup kita dan dengan &quot;set dial&quot; kita atur parameter 
dialup kita. Dengan hal ini bisa kita atur waktu tunggu koneksi(timeout) kita, dll. Baris ini
seharusnya tetap seperti tersebut adanya.

<p>
Sekarang kita berlanjut dan mengatur keterangan khusus kita ke ISP kita. Kita 
lakukan ini dengan menambahkan penanda lain dibawah bagian <b>default:</b> kita. Penanda ini 
dapat dinamai sesuka anda, termudah gunakan nama 
ISP anda. Disini saya akan menggunakan <b>myisp:</b> sebagai penanda kita merujuk pada ISP kita.
Berikut ini adalah contoh konfigurasi terkait dengan semua yang kita perlukan 
agar kita terhubung ke ISP.

<blockquote>
<pre>
myisp:
set phone 1234567   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
</pre>
</blockquote>

<p>
Di sini kita harus mengatur keterangan dasar untuk ISP tertentu. Pilihan 
pertama &quot;set phone&quot; menentukan nomor dialup ISP anda. 
&quot;set login&quot; mengatur pilihan login kita. Di sini kita punya 
waktu tunggu ditentukan ke 5; artinya kita akan membatalkan percobaan login 
setelah 5 detik jika tidak ada hubungan. Jika tidak, akan menunggu &quot;login:&quot; 
terkirim dan mengirimkan username serta password anda. Pada contoh ini 
Username = ppp dan Password = ppp. Nilai variable ini perlu anda sesuaikan.
baris &quot;set timeout&quot; menentukan waktu tunggu diam(idle timeout) untuk 
keseluruhan waktu koneksi menjadi 120 detik. &quot;set ifaddr&quot; baris tersebut 
agak bersifat trik. Berikut ini sebuah penjelasan lebih lanjut.

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
Pada baris diatas, telah kita atur dalam format &quot;<b>set ifaddr 
[alamat_aku[/nn] [alamat_isp[/nn] [netmask [triggeraddr]]]]</b>&quot;. Sehingga 
IP pertama yang ditentukan adalah IP yang kita pakai. Jika anda punya IP statis 
, anda tentukan di sini. Pada contoh kita kita gunakan /0 yang menunjukkan bahwa tidak 
perlun alamat ip ini bersesuaian dan keseluruhan selanjutnya lalu dapat 
terubah. IP kedua yang ditentukan adalah IP isp. Jika anda 
mengetahuinya bisa anda tentukan. Sekali lagi pada baris kita tidak kita ketahui 
IP yang akan diberikan, sehingga biarkan isp mengaturnya. Pilihan ketiga adalah netmask kita,
disni diatur pada 255.255.255.0. Jika triggeraddr ditentukan, ini digunakan 
untuk mengganti alamat_aku pada inisialisasi  negosiasi IPCP. Namun, hanya sebuah 
alamat pada daerah alamat_aku akan diterima. Ini berguna ketika 
negosiasi dengan beberapa implementasi PPP yang tidak memberikan sebuah 
IP kecuali peer nya meminta ``0.0.0.0''.

<p>
Berikutnya digunakan &quot;add default HISADDR&quot; menentukan route 
default kita ke IP isp. Ini saling terkait, artinya jika IP isp 
nerubah, route kita akan secara langsung disesuaikan. Dengan &quot;enable 
dns&quot; kita meminta ISP kita untuk mengotentikasi alamat nameserver 
kita. JANGAN melakukan hal ini jika anda menjalankan DNS lokal, karena ppp akan
langsung menggunakan beberapa baris nameserver pada
<i>/etc/resolv.conf</i>.

<p>
<h3>Menggunakan PPP(8)</h3>

<p>
Sekarang telah kita punyai berkas <i>ppp.conf</i> kita dapat mulai mencoba 
membuat sebuah hubungan ke ISP kita. Akan dijelaskan beberapa argumen yang umum 
dipakai pada ppp.

<ul>
<li><tt>ppp -auto myisp</tt> - This will run ppp, configure your
interfaces and connect to your ISP and then go into the background.
<li><tt>ppp -ddial myisp</tt> - This is similar to -auto, but if your
connection is dropped it will try and reconnect.
</ul>

<p>
By using <i>/usr/sbin/ppp</i> with no options will put you into
interactive mode. From here you can interact directly with the modem, it
is great for debugging problems in your <i>ppp.conf</i> file.

<p>
<h3>ppp(8) extras</h3>

<p>
In some situations you might want commands executed as your connection
is made or dropped. There are two files you can create for just these
situations. <i>/etc/ppp/ppp.linkup</i> and <i>/etc/ppp/ppp.linkdown</i>.
Sample configurations can be viewed here:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Extended information can be found at
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">FreeBSD 
Handbook entry on User PPP</a>. 


<p>
<a name="Tuning"></a>
<h2>6.6 - Tuning networking parameters</h2>
<!-- XXXrelease -->

<p>
<h3>6.6.1 - How can I tweak the kernel so that there are a higher number
of retries and longer timeouts for TCP sessions?</h3>

<p>
You would normally use this to allow for routing or connection problems.
Of course, for it to be most effective, both sides of the connection
need to use similar values.

<p>
To tweak this, use <tt>sysctl</tt> and increase the values of:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Using sysctl -a, you can see the current values of these (and many
other) parameters.  To change one, use <tt>sysctl -w</tt>, as in
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - How can I turn on directed broadcasts?</h3>

<p>
Normally, you don't want to do this.  This allows someone to send
traffic to the broadcast address(es) of your connected network(s) if you
are using your OpenBSD box as a router.

<p>
There are some instances, in closed networks, where this may be useful,
particularly when using older implementations of the NetBIOS protocol.
This is another sysctl.
<tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> turns this on.  Read
about <a href="http://www.netscan.org">smurf attacks</a> if you want to
know why it is off by default.

<p>
<h3>6.6.3 - I don't want the kernel to dynamically allocate a certain
port</h3>

<p>
There is a sysctl for this also.  From
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>:

<pre>
Set the list of reserved TCP ports that should not be allocated by the
kernel dynamically.  This can be used to keep daemons from stealing a
specific port that another program needs to function.  List elements may
be separated by commas and/or whitespace.

 #  <strong>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>

It is also possible to add or remove ports from the current list.

 #  <strong>sysctl -w net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl -w net.inet.tcp.baddynamic=-871</strong>
</pre>


<p>
<a name="NFS"></a>
<h2>6.7 - Simple NFS usage</h2>

<p>
NFS, or Network File System, is used to share a filesystem over the
network. A few choice man pages to read before trying to setup a NFS
server are:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
</ul>

<p>
This section will go through the steps for a simple setup of NFS. This
example details a server on a LAN, with clients accessing NFS on the
LAN. It does not talk about securing NFS. We presume you have already
setup packet filtering or other firewalling protection, to prevent
outside access.  If you are allowing outside access to your NFS server,
and you have any kind of sensitive data stored on it, we strongly
recommend that you employ IPsec.  Otherwise, people can potentially see
your NFS traffic.  Someone could also pretend to be the IP address which
you are allowing into your NFS server.  There are several attacks that
can result.  When properly configured, IPsec protects against these
types of attacks.

<p>
Another important security note.  Don't just add a filesystem to
<i>/etc/exports</i> without some kind of list of allowed host(s).
Without a list of hosts which can mount a particular directory, anyone
on who can reach your host will be able to mount your NFS exports.

<p>
NFS depends upon
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
to be running before it will operate.  Portmap(8) is now off by
default on OpenBSD 3.2 and later, so you must enable it in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
by changing the <tt>portmap</tt> line to read:

<blockquote><pre>
portmap=YES
</pre></blockquote>
and reboot to make it take effect. 

<p>
The setup consists of a server with the ip <b>10.0.0.1</b>. This server
will be serving NFS only to clients within that network. The first step
to setting up NFS is to setup your <i>/etc/exports</i> file. This file
lists which filesystems you wish to have accessible via NFS and defines
who is able to access them. There are many options that you can use in
your <i>/etc/exports</i> file, and it is best that you read the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
man page. For this example we have an <i>/etc/exports</i> that looks
like this:

<blockquote><pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
This means that the local filesystem <tt>/work</tt> will be made
available via NFS. <tt>-alldirs</tt> specifies that clients will be able
to mount at any point under the <tt>/work</tt> mount point. <tt>-ro</tt>
specifies that it will only be allowed to be mounted read-only. The last
two arguments specify that only clients within the 10.0.0.0 network
using a netmask of 255.255.255.0 will be authorized to mount this
filesystem. This is important for some servers that are accessible by
different networks.

<p>
Once your <i>/etc/exports</i> file is setup, you can go ahead and setup
your NFS server. You should first make sure that options NFSSERVER &amp;
NFSCLIENT are in your kernel configuration. (GENERIC kernel has these
options included.) Next, you should set <tt>nfs_server=YES</tt> in
<i>/etc/rc.conf</i>. This will bring up both nfsd(8) and mountd(8) when
you reboot. Now, you can go ahead and start the daemons yourself. These
daemons need to be started as root, and you need to make sure that
portmap(8) is running on your system. Here is an example of starting
nfsd(8) which serves on both TCP and UDP using 4 daemons.  You should
set an appropriate number of NFS server daemons to handle the maximum
number of concurrent client requests that you want to service.

<blockquote><pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre></blockquote>

<p>
Not only do you have to start the nfsd(8) server, but you need to start
mountd(8). This is the daemon that actually services the mount requests
on NFS. To start mountd(8), make sure an empty mountdtab file exists,
and run the daemon:

<blockquote><pre>
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
</pre></blockquote>

<p>
If you make changes to /etc/exports while NFS is already running, you
need to make mountd aware of this!  Just HUP it:

<blockquote><pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre></blockquote>

<p>
<h3>Checking Stats on NFS</h3>

<p>
From here, you can check to make sure that all these daemons are up and
registered with RPC. To do this, use rpcinfo(8).

<blockquote><pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
During normal usage, there are a few other utilities that allow you to
see what is happening with NFS. One is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>, 
which allows you to view what is currently mounted and who is mounting
it. There is also nfsstat(8) which shows much more verbose statistics.
To use showmount(8), try <tt>/usr/bin/showmount -a host</tt>. For
example:

<blockquote><pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>Mounting NFS Filesystems</h3>

<p>
NFS filesystems should be mounted via mount(8), or more specifically,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
To mount a filesystem <i>/work</i> on host 10.0.0.1 to local filesystem
<i>/mnt</i>, do this (note that you don't need to use an IP address;
mount will resolve host names):

<blockquote><pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre></blockquote>

<p>
To have your system mount upon boot,
add something like this to your <i>/etc/fstab</i>:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
It is important that you use <tt>0 0</tt> at the end of this line so
that your computer does not try to fsck the NFS filesystem on boot!!!!
The other standard security options, such as noexec, nodev, and nosuid,
should also be used where applicable.  Such as:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
This way, no devices or setuid programs on the NFS server can subvert
security measures on the NFS client.  If you are not mounting programs
which you expect to run on the NFS client, add noexec to this list.

<p>
<a name="PPTP"></a>
<h2>6.8 - Setting up a PPTP connection in OpenBSD</h2>

<p>
<strong>NOTE:</strong> This does not apply to <strong>ALL</strong> ADSL
providers, but much information can be gleaned from the setup here. This
is known to work for <a href="http://www.inode.at">Inode</a>, an ADSL
provider in Austria.

<p>
To start off, you need to install pptp. The port is located at 
<i>/usr/ports/net/pptp</i>. Read <a href="faq8.html#Ports">FAQ 8, 
Ports</a> for more information on the OpenBSD ports tree.

<p>
Because of a conflict between the In-Kernel 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a>
support and pptp, you will need to re-compile your kernel, removing
support for gre(4).

<blockquote>Patch to remove GRE(4) support.
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@ -87,7 +87,7 @@
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre></blockquote>

<p>
To recompile your kernel, check out OpenBSD source via cvs (refer to <a
href="../anoncvs.html">AnonCVS</a> web page for more information), apply
the following patch, and rebuild your kernel as per <a
href="faq5.html#Building">FAQ 5, Building a kernel</a>.

<p>
After you have the <b>pptp</b> package installed and a new kernel, you
need to edit a few files to setup for your connection. This packages
uses the in-house OpenBSD
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>,
so if you are familiar with ppp(8), much of the setup is the same. Also,
refer to <a href="#PPP">FAQ 6, PPP</a>.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
For the <i>/etc/ppp/options</i> file, a setup like below will most likely
do all that you need:

<blockquote><pre>
# <strong>cat /etc/ppp/options</strong>
name "LOGINNAME"
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
<tt>LOGINNAME</tt> should be replaced with your User-ID.

<p>
The <i>/etc/ppp/pap-secrets</i> a line like:

<blockquote><pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
Where LOGINNAME is your User-ID and PASSWORD is your password.
10.0.0.138 is the IP assigned to your MODEM in the case that you are
using ADSL, etc. Make sure this file stays readonly by root (mode 600).

<p>
<h3>6.9.1 - Assigning an address to your Network Interface</h3>

<p>
In the above example, our modem came with a preconfigured interface of
10.0.0.138. We now need to assign an address to OUR interface. It's best
to pick an IP close to the one given by your MODEM, or use the static IP
assigned to you. Read more about setting up interfaces in 
<a href="#Setup">FAQ 6, Setup</a>.

<p>
Once your interface is setup, you should be able to create a pptp
connection with the command:

<blockquote><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre></blockquote>

<p>
Since this uses the in-house OpenBSD ppp(8), two processes are started.
You can kill pptp by killing both these processes:

<blockquote><pre>
# <strong>kill -9 [pid of pppd]</strong>
$ <strong>kill -9 [pid of pptp]</strong>
</pre></blockquote>

<p>
It is recommended to open <tt>/var/log/messages</tt> in a extra terminal
window, to recognize possible problems.

<blockquote>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre></blockquote>

<p>
We also suggest that you put the startup command in <i>/etc/rc.local</i>
so that you automatically connect on reboot.


<a name="Bridge"></a>
<h2>6.9 - Setting up a network bridge in OpenBSD</h2>

<p>
A <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
is a link between two or more separate networks.  Unlike a router, 
packets transfer through the bridge "invisibly" -- logically, the two
network segments appear to be one segment to nodes on either side of the
bridge.  The bridge will only forward packets that have to pass from one
segment to the other, so among other things, they provide an easy way to
reduce traffic in a complex network and yet allow any node to access any
other node when needed.

<p>
Note that because of this "invisible" nature, an interface in a  bridge
may or may not have an IP address of its own.  If it does, the interface
has effectively two modes of operation, one as part of a bridge, the
other as a normal, stand-alone NIC.  If neither interface has an IP
address, the bridge will pass network data, but will not be externally
maintainable (which can be a feature).

<p>
<h3>An example of a bridge application</h3>

<p>
One of my computer racks has a number of older systems, none of which
have a built-in 10BASE-TX NIC.  While they all have an AUI or AAUI
connector, my supply of transceivers is limited to coax.  One of the
machines on this rack is an OpenBSD-based terminal server which always
on and connected to the high-speed network.  Adding a second NIC with a
coax port will allow me to use this machine as a bridge to the coax
network.

<p>
This system has two NICs in it now, an Intel EtherExpress/100
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
and a 3c590-Combo card 
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
for the coax port.  <tt>fxp0</tt> is the link to the
rest of my network and will thus have an IP address, <tt>ep0</tt> is
going to be for bridging only and will have no IP address.
Machines attached to the coax segment will communicate as if they
were on the rest of my network.  So, how do we make this happen?

<p>
The file <tt>hostname.fxp0</tt> contains the configuration info for
the <tt>fxp0</tt> card.  This machine is set up using DHCP, so its file
looks like this:

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre>
</blockquote>

<p>
No surprises here.

<p>
The <tt>ep0</tt> card is a bit different, as you might guess:

<blockquote>
<pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre>
</blockquote>

<p>
Here, we are instructing the system to activate this interface using 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
and set it to 10BASE-2 (coax).  No IP address or similar information
needs to be specified for this interface.  The options the <tt>ep</tt>
card accepts are detailed in its
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">man page</a>.

<p>
Now, we need to set up the bridge.  Bridges are initialized by the
existence of a file named something like 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5"><tt>bridgename.bridge0</tt></a>. 
Here is an example for my situation here:

<blockquote>
<pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre>
</blockquote>

<p>
This is saying set up a bridge consisting of the two NICs, fxp0 and ep0,
and activate it.  Does it matter which order the cards are listed?  No,
remember a bridge is very symmetrical -- packets flow in and out in both
directions.

<p>
That's it!  Reboot, and you now have a functioning bridge.

<p>
<h3>Filtering on a bridge</h3>

While there are certainly uses for a simple bridge like this, it is
likely you might want to DO something with the packets as they go
through your bridge.  As you might expect, <a href="#PF">Packet
Filter</a> can be used to restrict what traffic goes through your
bridge.

<p>
Keep in mind, by the nature of a bridge, the same data flows through
both interfaces, so you only need to filter on one interface.  Your
default "Pass all" statements would look something like this:

<blockquote>
<pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre>
</blockquote>

<p>
Now, let's say I wish to filter traffic hitting these old machines, I
want only Web and SSH traffic to reach them.  In this case, we are going
to let all traffic in and out of the ep0 interface, but filter on the
fxp0 interface, using keep state to handle the reply data:

<blockquote>
<pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre>
</blockquote>

<p>
Note that this rule set will prevent anything but incoming HTTP and SSH
traffic  from reaching either the bridge machine or any of the other
nodes "behind" it.  Other results could be had by filtering the other
interface.

<p>
To monitor and control the bridge you have created, use the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
command, which can also be used to create a bridge after boot.

<p>
<h3>Tips on bridging</h3>

<ul>
<li>It is HIGHLY recommended that you filter on only one interface.
While it is possible to filter on both, you really need to understand
this very well to do it right.

<li>By using the <i>blocknonip</i> option of 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
or in 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
you can prevent non-IP traffic (such as IPX or NETBEUI) from slipping
around your filters.  This may be important in some situations, but you
should be aware that bridges work for all kinds of traffic, not just IP.

<li>Bridging requires that the NICs be in a "Promiscuous mode" -- they
listen to ALL network traffic, not just that directed at the interface.
This will put a higher load on the processor and bus than one might
expect.  Some NICs don't work properly in this mode, the TI ThunderLAN
chip
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
is an example of a chip that won't work as part of a bridge. 
</ul>


<p>
<font color="#0000e0">
<a href="index.html">[Indeks FAQ]</a>
<a href="faq5.html">[Ke Bagian 5 - Membangun Sistem dari Kode Sumber</a>
<a href="faq7.html">[Ke Bagian 7 - Kendali Keyboard dan Tampilan]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq6.html,v 1.180 ]<br>
$Translation: faq6.html,v 1.2 2005/06/28 01:58:11 ferywu Exp $<br>
-->
$OpenBSD: faq6.html,v 1.2 2005/06/28 07:32:51 saad Exp $</small>

</body>
</html>
