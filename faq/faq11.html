<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>11 - Performance Tuning</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2006 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<a href="../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">    
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
<a href= "faq10.html">[To Section 10 - System Management]</a>
<a href= "faq12.html">[To Section 12 - Platform-Specific Questions]</a>
</font>

<h1><font color="#e00000">11 - Performance Tuning</font></h1>
<hr>

<p>
<h3>Table of Contents</h3>
<ul>
<li><a href="#XF86"   >11.4 - Tuning your monitor resolution under
X</a>
</ul>

<hr>

<p>
<a name= "XF86"></a>
<h2>11.4 - Tuning your monitor resolution under X</h2>

<i>Note: Most users do NOT need to worry about manually creating a 
ModeLine in modern versions of X.
HOWEVER, sometimes it is needed for unusual situations.</i>

<p>
Getting an X server working at an acceptable resolution with many multi-sync
monitors is possible.  If anyone has tried to do this with the standard
xorgconfig or XF86Setup utilities, they probably didn't get the best possible
results.  One of the more painful aspects is simply getting your monitor running
with your preferred resolution,
and then
getting the vertical scan rate set to at least 72-75 Hz,
a rate where the screen flicker is much less visible to humans.  
Conversely, what if you are trying to set the vertical scan rate so it is very low?
You can set it at 50 Hz so that it can be captured on to video without flicker,
but the methods to do this are non-obvious with the standard X tools and
documentation.

<p>
Finally, at the resolutions many people normally use with inexpensive VGA monitors
(800x600, 1024x768, 1152x900,
1280x1024), it is possible (at least on newer monitors) to use vertical scan rates of
85Hz and above, to achieve an extremely clean, palatable picture.
The X server has a mechanism which allows you to describe in detail the video
mode you want to use, this is the ModeLine.  A ModeLine has four sections, a single number for the pixel clock,
four numbers for horizontal timings, four numbers for vertical timings,
and an optional section with a list of flags specifying other characteristics
of the mode (such as Interlace, DoubleScan, and more... see the
xorg.conf(5) manual page for more ModeLine details).

<p>
Generating a ModeLine is a black art... Luckily, there are several scripts
which can do this for you.  One is <a href="http://www-sop.inria.fr/cgi-bin/koala/nph-colas-modelines">
Colas XFree86 ModeLine Generator</a>.  Another is
<a href="http://xtiming.sourceforge.net/">The XFree86 Modeline Generator</a>
hosted at SourceForge, and there are several others available on
<a href="http://freshmeat.net/search/?q=modeline">Freshmeat</a>.
Before you can use these ModeLine generators, you need to figure
out the vertical
and horizontal sync limits for your monitor.  This is often documented
in the manual, or on the manufacturer's web site.  If you can't find
either of those, simply search the web for the monitor make and model,
several people have been kind enough to compile lists with this information.

<p>
For example, say you have a Dell D1226H monitor.  You searched in agony
at Dell's web site to find that it has a 30-95 kHz horizontal scan range,
and a 50-160 Hz vertical scan range.  Visit the ModeLine generator page,
enter this information.  Next, you need to enter the minimum
vertical scan rate you want.  Any rate at or above 72 Hz should generally have low
visible flicker.  As you go higher, the clearer and crisper your screen
image becomes.  

<p>
With all of these bits of information, the script will generate a ModeLine
for every possible 4x3 resolution which your monitor can support, above
the minimum vertical scan rate which you enter.  If someone enters the Dell specs above
and a 75 Hz vertical scan minimum, the script gives out something like the
following:

<pre>
ModeLine "320x240" 20.07 320 336 416 448 240 242 254 280 #160Hz
ModeLine "328x246" 20.86 328 344 424 456 246 248 260 286 #160Hz
...
ModeLine "816x612" 107.39 816 856 1056 1136 612 614 626 652 #145Hz
ModeLine "824x618" 108.39 824 864 1064 1144 618 620 632 658 #144Hz
ModeLine "832x624" 109.38 832 872 1072 1152 624 626 638 664 #143Hz
...
ModeLine "840x630" 109.58 840 880 1080 1160 630 632 644 670 #141Hz
ModeLine "848x636" 110.54 848 888 1088 1168 636 638 650 676 #140Hz
...
ModeLine "1048x786" 136.02 1048 1096 1336 1432 786 788 800 826 #115Hz
ModeLine "1056x792" 136.58 1056 1104 1344 1440 792 794 806 832 #114Hz
ModeLine "1064x798" 137.11 1064 1112 1352 1448 798 800 812 838 #113Hz
...
ModeLine "1432x1074" 184.07 1432 1496 1816 1944 1074 1076 1088 1114 #85Hz
ModeLine "1576x1182" 199.86 1576 1648 2008 2152 1182 1184 1196 1222 #76Hz
ModeLine "1584x1188" 198.93 1584 1656 2016 2160 1188 1190 1202 1228 #75Hz
</pre>

<p>
Now, this monitor claims to do 1600x1200 @ 75 Hz, but the script does not
say this is within 75 Hz.  So, if you really want exactly 1600x1200, 
go down a notch with your minimum vertical rate... (Here, we go down
to 70 Hz)

<pre>
ModeLine "1592x1194" 197.97 1592 1664 2024 2168 1194 1196 1208 1234 #74Hz
ModeLine "1600x1200" 199.67 1600 1672 2032 2176 1200 1202 1214 1240 #74Hz
ModeLine "1608x1206" 198.65 1608 1680 2040 2184 1206 1208 1220 1246 #73Hz
ModeLine "1616x1212" 197.59 1616 1688 2048 2192 1212 1214 1226 1252 #72Hz
ModeLine "1624x1218" 199.26 1624 1696 2056 2200 1218 1220 1232 1258 #72Hz
ModeLine "1632x1224" 198.15 1632 1704 2064 2208 1224 1226 1238 1264 #71Hz
ModeLine "1640x1230" 199.81 1640 1712 2072 2216 1230 1232 1244 1270 #71Hz
ModeLine "1648x1236" 198.64 1648 1720 2080 2224 1236 1238 1250 1276 #70Hz
</pre>

<p>
Here, we see the monitor really does 1600x1200 @ 74 Hz when the dot clock
(bandwidth) is limited to 200MHz.  Set the bandwidth according to the
limits defined by the monitor.

<p>
Once you have your ModeLines, put them into your /etc/X11/xorg.conf file. 
Comment out the old ModeLines, so that you can use them again if the new ones
don't work.
Next, choose what resolution you actually want to run at.   First,
figure out if X is running in accelerated mode (which it does with most video
cards), so you know which <tt>"Screen"</tt> section of the xorg.conf to modify.
Or, just modify all of the Screen sections.

<pre>
Section "Screen"
   Driver          "Accel"
   Device          "Primary Card"
   Monitor         "Primary Monitor"
   DefaultColorDepth 32
   SubSection "Display"
      Depth        32
      Modes        "1280x1024" "1024x768"
   EndSubSection
</pre>

<p>
The first resolution you see after the "Modes" keyword is the resolution that
X is going to start in.  By pressing CTRL-ALT-KEYPAD MINUS, or CTRL-ALT-KEYPAD
PLUS, you can switch between any resolutions that you list here.  According
to the section above, X will try to start in 32-bit color mode (via
the DefaultColorDepth directive, without it X will start in 8-bit color mode.)
The first resolution it will try to use is 1280x1024 (it follows the order
of the Modes line.)  Note that "1280x1024" is just a label for the values in
the ModeLine.

<p>
Note that the ModeLine generator script has options to relax its timings for older
or smaller monitors, and also has the ability to provide ModeLines for
specific resolutions.  Depending on the type of hardware you have, it
may not be very easy to use with the default options.  If the picture is
too tall, too wide, or too small, or is shifted horizontally or vertically,
and the controls of the monitor aren't enough to correct its appearance,
one can use xvidtune(1) to adjust the ModeLine to better fit with the
monitor's timings.

<p>
On most modern monitors, there is no fixed limit on the bandwidth, thus
they are often not listed anymore in the specs. What happens is that the
more you go up in bandwidth, the fuzzier the screen image becomes.
So you may want to put in the bandwidth of your card (also named
"dotclock") to test (you cannot damage your monitor this way), and go
progressively down in bandwidth until you have a nice crisp image.

<p>
If this seems needlessly complex, that's because it is.  X.org addresses
this, and makes this process much easier since it has several built-in
modes and is capable of reading back capabilities from "plug and play" monitors
through DDC and DDC2.

<p>
You can download the Colas XFree86 ModeLine Generator script at:
<a href="http://koala.ilog.fr/ftp/pub/Klone/">http://koala.ilog.fr/ftp/pub/Klone/</a>.
You need to grab the Klone interpreter, and compile it.  It is in the
ports as <tt>lang/klone</tt>.  The scripts
exist under the scripts directory in the Klone distribution.  (The
port installs them to /usr/local/lib/klone/scripts.)

<p>
There are two versions of the script included, the first is a CGI version identical
to the web page above.  The second is a non-CGI version
which will take your complete xorg.conf file, decode the monitor specs that
you entered into xorgconfig/XF86Setup (Now, think, did you actually
enter the specs for your monitor or just choose generic ones?),
and fix the existing ModeLines accordingly. 

<p>
<font color= "#0000e0">
<a href= "index.html">[FAQ Index]</a>
<a href= "faq10.html">[To Section 10 - System Management]</a>
<a href= "faq12.html">[To Section 12 - Platform-Specific Questions]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq11.html,v 1.60 2006/02/26 22:21:16 nick Exp $</small>
</body>
</html>
