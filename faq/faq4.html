<html>
<head>
<title>4.0 - Installation and Disk Setup</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-1999 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq3.html">[To Section 3.0 - Obtaining OpenBSD]</a>
<a href= "faq5.html">[To Section 5.0 - Kernel configuration and Disk Setup]</a>
</font>
</p>



<p>
<a name= "4.1"></a>
<h2>4.1 - Installing from the OpenBSD CD</h2>
</p>

<p>
Installing from a CD is definatly the BEST choice, but first you must have purchased a cd.
You can obtain a cd from 
<a href= "http://www.openbsd.org/orders.html">
          http://www.openbsd.org/orders.html</a>.
If you are using either the i386, SPARC or Alpha platforms you can boot
directly off the CD. If not, you will have to create a bootdisk. You can get the
boot disk from
<kbd>ftp://ftp.openbsd.org/pub/OpenBSD/2.4/$ARCH/floppy24.fs</kbd>
</p>

<p>
To create this boot disk, use either the unix tool 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&format=html">
dd(1)</a> or MSDOS rawrite from the tools directory on the cd.
</p>

<p>
After that is completed, boot from your media of choice, (cdrom or bootdisk)
and answer the questions accordingly. Here is an example installation.
</p>

<p>
<a href= "log24.txt">Example Install</a>
</p>

<br>

<p>
<a name= "4.2"></a>
<h2>4.2 - Installation via FTP</h2>
</p>

<p>
The ftp installation is almost the same as the normal installation. The same
bootdisk will be used.
</p>

<p>
<strong>floppy24.fs</strong>
</p>

<p>
Just like the CD install you will set up your disk, then when you specify
install media you choose (f)tp. You must take care to give the proper settings
when you are asked to configure your network. Have handy, your ipaddress
(see below for dhcp), netmask, nameserver addresses, and default route.
Once your network is configured correctly, you must choose the (f)tp
installation option. You will be asked a few simple questions about proxys
and passive or active transfers, and the you will be presented with a list of
ftp servers.  Select the one closest to you, and your on your way.
</p>

<p>
Consult the <a href= "log24.txt">install</a> text for help.
</p>

<br>

<p>
<a name= "4.3"></a>
<h2>4.3 - Installation via DHCP</h2> 
</p>

<p>
Installation via DHCP is the same as ftp, except your system will use DHCP
to configure your network.  When you arrive at the network config option,
choose DHCP and your network will be setup accordingly.  The all you have
to do is follow the remainder of the directions from ftp install above
and you will be set.
</p>

<p>
Consult the <a href= "log24.txt">install</a> text for help.
</p>

<br>

<p>
<a name= "4.4"></a>
<h2>4.4 - What files are needed for Installation?</h2>
</p>

<p>
There are many packages containing the OpenBSD binaries, but which ones do
you need to get your system up and running? Here is an overview of each
package.
</p>

<p>
<ul>
    <li><strong>base24.tar.gz</strong> - Has the BASE OpenBSD system 
                                         *NEEDED*</li>
    <li><strong>etc24.tar.gz</strong> - Has all the files in /etc *NEEDED*</li>
    <li><strong>comp24.tar.gz</strong> - Has the compiler and its tools, libs.
                                         *STRONGLY SUGGESTED*</li>
    <li><strong>man24.tar.gz</strong> - Holds man pages *STRONGLY 
                                        SUGGESTED*</li>
    <li><strong>misc24.tar.gz</strong> - Holds misc info, setup docs</li>
    <li><strong>text24.tar.gz</strong> - Holds more text files, and setup
                                         documentation</li>
    <li><strong>game24.tar.gz</strong> - Has the Games for OpenBSD *FUN*</li>
    <li><strong>xbase24.tar.gz</strong> - Has the base install for X11</li>
    <li><strong>xfont24.tar.gz</strong> - Holds X11's font server and fonts</li>
    <li><strong>xlink24.tar.gz</strong> - Has the X servers link kit</li>
    <li><strong>xserv24.tar.gz</strong> - Has X11's X servers</li>
    <li><strong>xshare24.tar.gz</strong> - Has manpages, locale settings,
                                           includes, etc  for X</li>
</ul>
<p>

<br>

<p>
<a name= "4.5"></a>
<h2>4.5 - Using the OpenBSD disklabel</h2>
</p>

<p>
Sorry, this section is not yet completed. Check back soon!
</p>

<br>

<p>
<a name= "4.6"></a>
<h2>4.6 - Using fdisk</h2>
</p>

<p>
Sorry, this section is not yet completed. Check back soon!
</p>

<br>

<p>
<a name= "4.7"></a>
<h2>4.7 - Adding new disks in OpenBSD</h2>
</p>

<p>
Well once you get your disk installed <strong>PROPERLY</strong> you need to use
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&format=html">
fdisk(8)</a> and 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&format=html">
disklabel(8)</a> to set up your disk in OpenBSD. Making sure that the partition
ID is 'A6'. Once you have done this, OpenBSD will be able to recognize the new
disk, and you need to create the filesystem on that disk using 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&format=html">
newfs(8)</a>.
</p>

<p>
<kbd>bsd# newfs wd1a </kbd>
</p>

<p>
or so on using OpenBSD's disk numbering scheme
<pre>
  wd0
  wd1
  wd2
</pre>
</p>

<p>
Edit fstab to mount the new disk at a mount point of your choice, and reboot.
</p>

<p>
If you need to migrate an existing directory like /usr/bin. You should mount 
the new drive in /mnt and use cpio -pdum to copy /usr/bin to the /mnt directory.
Edit the /etc/fstab file to show that /usr/bin will be mounted on the new drive.
example:
</p>

<p>
<strong>/dev/wd1a /usr/bin ffs rw 1 1</strong>
</p>

<p>
Reboot into single user mode..<strong>boot -s</strong> Move the existing
/usr/bin to /usr/bin-backup and create an empty /usr/bin. Then reboot the
system, and whala!! the files are there!
</p>

<br>

<p>
<a name= "4.8"></a>
<h2>4.8 - How do i swap to a file?</h2>
</p>

<p>
First make a kernel with vnd0c as swap. If you have wd0a as root filesystem,
wd0b is the previous swap, use this line in the kernel configuration file
(refer to compiling a new kernel if in doubt):
</p>

<p>
<pre>
config          bsd     root on wd0a swap on wd0b and vnd0c dumps on wd0b
</pre>
</p>

<p>
Second make the file for swap. If you want a 32MB swapfile named /newswap do:
</p>

<p>
<strong># dd if=/dev/zero of=/newswap bs=1k count=32768</strong>
</p>

<p>
Add a line to your /etc/fstab file to indicate where the new swap will be.
</p>

<p>
<strong>/dev/vnd0c none sw 0 0</strong>
</p>

<p>
Now boot with the new kernel. Then create the vnd0 device to use that file
as a device:
</p>

<p>
<strong># vnconfig -c -v vnd0 /newswap</strong>
</p>

<p>
And add it now to swap:
</p>

<p>
<strong># swapon /dev/vnd0c</strong>
</p>

<p>
You can now see if it is working with:
</p>

<p>
<strong># pstat -s</strong>
</p>

<br>

<p>
<a name= "4.9"></a>
<h2>4.9 - Softupdates</h2>
<p>
<strong>
Softupdates are experimental and are NOT recomended for regular users.
</strong>
</p>

<p>
Please read <a href= "../softupdate.html">
                     http://www.openbsd.org/softupdate.html</a>
</p>

<p>
To enable Softupdates your kernel must have option
</p>

<p>
<strong>option FFS_SOFTUPDATES</strong>
</p>

<p>
then you need to boot into single-user mode:
</p>

<p>
<pre>
boot>boot -s
[snip]
bsd# tunefs -s enable &lt;raw device&gt;
bsd# reboot -n
</pre>
</p>

<p>
GOOD LUCK. you just might need it.
</p>

<br>

<p>
<a name= "4.10"></a>
<h2> 4.10 - How much space do i need for an OpenBSD installation?</h2>
</p>

<p>
The following are suggested sub-tree sizes for a full system install.  The
numbers include enough extra space to permit you to run a typical home
system that is connected to the internet:
<p>
<pre>
SYSTEM          /       /usr    /var    /usr/X11R6
alpha           50M     433M    20M     160MB
amiga           27M     173M    20M      64M
arc             47M     268M    20M      60M
hp300           26M     120M    20M      50M
i386            30M     172M    20M      85M
mac68k          26M     172M    20M      75M
mvme68k         26M     173M    20M      60MB (no Xserver)
pmax            44M     267M    20M      60M
sparc           35M     194M    20M      50M
</pre>
</p>

<p>
When you are in the disklabel editor, you may choose to make your entire
system have just an 'a' and 'b' partition.  The 'a' partition you set up
in disklabel will become your root partition, which should be the sum of
all the 3 main values above (/, /usr, and /var) plus some space for /tmp.
The 'b' partition you set up automatically becomes your system swap
partition -- we recommend a minimum of 32MB but if you have disk to spare
make it at least 64MB.
</p>

<p>
However, we recommend you use many seperate partitions so that users
cannot fill up your important partitions as easily, thus causing nasty denial
of service problems.  If you are extra cautious, you will make at least the
following seperate partitions: / swap /usr /var /tmp /var/tmp /home.
</p>

<br>

<p>
<a name= "4.11"></a>
<h2>4.11 - How do i get rid of "partition 3 id 0" error on boot?</h2>
</p>

<p>
The solution to this is problem is using a bootloader. The OpenBSD cd
has the os-bs bootloader included in the tools directory. If you didnt
purchase a CD-ROM, you can download os-bs from any of the OpenBSD ftp
sites.
</p>

<p>
<kbd>pub/OpenBSD/2.4/tools/osbs135.exe</kbd>
</p>

<p>
and take some time to look through the web pages at
<a href= "http://www.prz.tu-berlin.de/~wolf/os-bs.html">
          http://www.prz.tu-berlin.de/~wolf/os-bs.html</a>
</p>

<p>
There are also other commercial bootloaders or lilo that you can use for
multi-booting.
</p>

<br>

<p>
<a name= "4.12"></a>
<h2>4.12 - Installing at a partition 4GB or higher</h2>
</p>

<p>
The 2.4 cd's shipped with a problem in installboot. A patch can be obtained 
here <a href= "../errata.html#installboot">
              http://www.openbsd.org/errata.html</a>.
This is fixed in -current.
</p>

<p>
To place the partition boot record, installboot used a 32 bit multiplication
for the sectors times the sectorsize which is larger than 2^32 -1 (i.e.
multiplication overflow) when the partition starts at 4 GB or higher. This
means the pbr is installed in the reall partition address modulo 4GB. It's
still possible to install at >= 4GB with some effort:
</p>

<p>
You have 2 Options for doing so with OpenBSD 2.4. If you have Linux or any
other unix like OS, you should back up the sectors first before trying anything.
</p>

<p> 
<ul>
    <li>Suppose the partition starts at cylinder 611, and the drive has
        255 heads, 63 sectors: offset for the obsd partition is 611*255*63 =
        9815715 sectors. multiply this by 512 and you get: 5025646080. 
        5025646080 mod 2^32 = 730678784
        <p>
        (You can just subtract 2^32 on a hand calculator...) dividing by 512
        gives sector 1427107.
        </p>

        <p>
        Ok, suppose were now in linux (where cylinder numbers are 1 higher   
        btw..) and that the obsd partition is DOS partition 4:
        </p>

        <p>
        <strong>
        dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
        </strong>
        </p>

        <p>
        will backup the data that installboot will nuke ..
        </p>

        <p>
        Now install OpenBSD. Return to Linux.
        </p>

        <p>
        Now we're going to copy the partition boot record to the right place.
        </p>

        <p>
        <strong>
        dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
        <br>        
        dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
        </strong>
        </p>

        <p>
        (adding obsd to lilo should now work)
        </p>

        <p>
        Now write back the nuked sector:
        </p>

        <p>
        <strong>
        dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
        </strong>
        </p>

        <p>
        Caveat: make sure that whatever gets nuked by installboot isn't
        essential to running dd (and starting the other OS). Backing up the
        affected partition is recommended.
        </p>

    <li>Use a correct version of installboot (compiled for you by another 
        OBSD'er ..):

        <p>
        put it on another partition, e.g. a DOS partition. Suppose wd0j is the
        DOS partition (see disklabel wd0, this is in case of IDE disks), and
        installboot is named installb there.
        </p>

        <p>
        After booting from floppy/CD, press ^C to get into the shell:
        <strong>
        <ul>
            <li> mkdir dos<br>
            <li> mount /dev/wd0j dos<br>
            <li> cp dos/tmp/installb /usr/mdec/installboot<br>
        </ul>
        </strong>
        </p>
</ul>
</p>

<p>
Now enter 'install' and the installation procedure should use the new
installboot.
</p>

<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq3.html">[To Section 3.0 - Obtaining OpenBSD]</a>
<a href= "faq5.html">[To Section 5.0 - Kernel configuration and Disk Setup]</a>
</font>
</p>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt= "[back]"></a> 
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq4.html,v 1.16 1999/02/28 04:59:19 ericj Exp $</small>
</p>
</body>
</html>
