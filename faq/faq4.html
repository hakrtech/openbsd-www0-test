<html>
<head>
<title> 4.0 - Installation and Disk Setup </title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="the main OpenBSD page">
<meta name="keywords" content="openbsd,main">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1998 by OpenBSD.">

</head>
<body bgcolor="#ffffff" text="#000000" link="#23238E">
<a name="4.1"></a>
<h2> 4.1 - Installing from the OpenBSD CD </h2>
<p>
Installing from a CD is definatly the BEST choice. But first you must have a cd
on hand. You can obtain one of those from <a href="http://www.openbsd.org/orders
.html">http://www.openbsd.org/orders.html</a>. If you are using either the i386,
 sparc or alpha platforms you can boot directly off the CD. Else you will have t
o create a bootdisk. You can get the boot disk from ftp://ftp.openbsd.org/pub/Op
enBSD/2.4/<arch>/floppy24.fs<p>
To create this boot disk, use either the unix tool <a href="http://www.openbsd.o
rg/cgi-bin/man.cgi?query=dd&apropos=0&sektion=1&manpath=OpenBSD+2.4&format=html"
>dd(1)</a> or rawrite from the tools directory on the cd.
<p>
After that is completed boot from your media of choice, (cdrom or
bootdisk) and answer the questions accordingly. Here is an example
installation.<p>
<a href="log24.txt">Example Install</a>
<p>
<a name="4.4"></a>
<h2> 4.4 - What files are needed for Installation?</h2>
<p>
There are many packages containing the OpenBSD binaries, but which ones do
you need to get your system up and running? Here is an overview of each
package.<p>
<ul>
<li><strong>base24.tar.gz</strong> - Has the BASE OpenBSD system. *NEEDED*
<li><strong>etc24.tar.gz</strong> - Has all the files in /etc *NEEDED*
<li><strong>comp24.tar.gz</strong> - Has the compiler and its tools, libs.
*STRONGLY SUGGESTED*
<li><strong>man24.tar.gz</strong> - Holds man pages *STRONGLY SUGGESTED*
<li><strong>misc24.tar.gz</strong> - Holds misc info, setup docs.
<li><strong>text24.tar.gz</strong> - Holds more text files, and setup
documentation.
<li><strong>game24.tar.gz</strong> - Has the Games for OpenBSD. *FUN*
<li><strong>xbase24.tar.gz</strong> - Has the base install for X11 
<li><strong>xfont24.tar.gz</strong> - Holds X11's font server and fonts.
<li><strong>xlink24.tar.gz</strong> - Has the X servers link kit. 
<li><strong>xserv24.tar.gz</strong> - Has X11's X servers
<li><strong>xshare24.tar.gz</strong> - Has manpages, locale settings,
includes, etc  for X
</ul>
<p>
 <a name="4.7"></a>
<h2>4.7 - Adding new disks in OpenBSD</h2>
<p>
Well once you get your disk installed <strong>PROPERLY</strong> you need to use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fdisk&apropos=0&sektion=8&
manpath=OpenBSD+2.4&format=html">fdisk(8)</a> and <a href="http://www.openbsd.or
g/cgi-bin/man.cgi?query=disklabel&apropos=0&sektion=8&
manpath=OpenBSD+2.4&format=html">disklabel(8)</a> to set up your disk in OpenBSD
. Making sure that the
partition ID is 'A6'. Once you have done this, OpenBSD will be able to
recognize the new disk, and you need to create the filesystem on that
disk using <a href="http://www.openbsd.or
g/cgi-bin/man.cgi?query=newfs&apropos=0&sektion=8&
manpath=OpenBSD+2.4&format=html">newfs(8)</a>.
<p>
<strong>bsd# newfs wd1a </strong>
<p>
or so on using OpenBSD's disk numbering scheme<br>
wd0
<br>
wd1<br>
wd2<br>
<p>
edit fstab to mount the new disk at a mount point of your choice.
and reboot.
<p>
If you need to migrate an existing directory like /usr/bin.
You should mount the new drive in /mnt and use cpio -pdum to copy
/usr/bin to the /mnt directory. Edit the /etc/fstab file to show
that /usr/bin will be mounted on the new drive. <br>
example:<br>
<p>
<strong>/dev/wd1a /usr/bin ffs rw 1 1

</strong>
<p>
Reboot into single user mode..<strong>boot -s</strong> Move the existing /usr/bi
n to
/usr/bin-backup and create an empty /usr/bin. Then reboot the system, and
whala!! the files are there! <p>
<a name="4.8"></a>
<h2>4.8 - How do i swap to a file? </h2>
<p>
First make a kernel with vnd0c as swap. If you have wd0a as root
filesystem, wd0
b is the previous swap, use this line in the kernel configuration file
(refer to
 compiling a new kernel if in doubt):<br>
<p>
<strong>config          bsd     root on wd0a swap on wd0b and vnd0c dumps
on wd0b </strong><p>
Second make the file for swap. If you want a 32MB swapfile named /newswap
do:
<p>
<strong># dd if=/dev/zero of=/newswap bs=1k count=32768</strong>
<p>
Add a line to your /etc/fstab file to indicate where the new swap will
be.<br>
<strong>/dev/vnd0c none sw 0 0</strong>
<p>
Now boot with the new kernel. Then create the vnd0 device to use that file
as a 
device:<p>
<strong># vnconfig -c -v vnd0 /newswap
</strong>
<p>
And add it now to swap:
<p>
<strong># swapon /dev/vnd0c</strong>
<p>
You can now see if it is working with:<p>
<strong># pstat -s</strong>
<p>
<a name="4.9"></a>
<h2>4.9 - Softupdates</h2>
<p>
<strong>Softupdates are experimental and are NOT recomended for regular users.</strong>
<p>
Please read <a href="../softupdate.html">http://www.openbsd.org/softupdate.html</a>
<p>
To enable Softupdates your kernel must have option<br>
<p>
<strong>option FFS_SOFTUPDATES</strong><p>
then you need to boot into single-user mode:<P>
<strong>boot -s<br>
bsd# tunefs -s enable &lt;raw device&gt;<br>
bsd# reboot -n
</strong>
<p>
GOOD LUCK. you just might need it.
<p>
<a name="4.10"></a>
<h2> 4.10 - How much space do i need for an OpenBSD installation?</h2>
<p>
The following are suggested sub-tree sizes for a full system install.  The
numbers include enough extra space to permit you to run a typical home
system that is connected to the internet:
<p>
<pre>
SYSTEM          /       /usr    /var    /usr/X11R6<br>
alpha           50M     433M    20M     160MB<br>
amiga           27M     173M    20M      64M<br>
arc             47M     268M    20M      60M<br>
hp300           26M     120M    20M      50M<br>
i386            30M     172M    20M      85M<br>
mac68k          26M     172M    20M      75M<br>
mvme68k         26M     173M    20M      60MB (no Xserver)<br>
pmax            44M     267M    20M      60M<br>
sparc           35M     194M    20M      50M<br>
<p>
</pre>
When you are in the disklabel editor, you may choose to make your entire
system have just an 'a' and 'b' partition.  The 'a' partition you set up
in disklabel will become your root partition, which should be the sum of
all the 3 main values above (/, /usr, and /var) plus some space for /tmp.
The 'b' partition you set up automatically becomes your system swap
partition -- we recommend a minimum of 32MB but if you have disk to spare
make it at least 64MB.<p>

However, we recommend you use many seperate partitions so that users
cannot
fill up your important partitions as easily, thus causing nasty denial of
service problems.  If you are extra cautious, you will make at least the
following seperate partitions: / swap /usr /var /tmp /var/tmp /home.<p>

<a name="4.11"></a>
<h2> 4.11 - How do i get rid of "partition 3 id 0" error on boot?</h2>
<p>
The solution to this is problem is using a bootloader. The OpenBSD cd
has the os-bs bootloader included in the tools directory. If you didnt
purchase a CD-ROM, you can download os-bs from any of the OpenBSD ftp
sites.
 <p>
pub/OpenBSD/2.4/tools/osbs135.exe<br>
and take some time to look thru the web pages at<br>
<a
href="http://www.prz.tu-berlin.de/~wolf/os-bs.html">http://www.prz.tu-berlin.de/~wolf/os-bs.html</a>
<p>
There are also other commercial bootloaders or lilo that you can use for
multi-booting.
<p>
<a name="4.12"></a>
<h2>4.12 - Installing at a partition 4GB or higher</h2>
The 2.4 cd's shipped with a problem in installboot. A patch can be
obtained here <a
href="../errata.html#installboot">www.openbsd.org/errata.html</a>. So this
is fixed in -current.
<p>
To place the partition boot record, installboot used a 32 bit
multiplication for the sectors times the sectorsize which is larger than
2^32 -1 (i.e. multiplication overflow) when the partition starts at 4 GB
or higher. This means the pbr is installed in the reall partition
address modulo 4GB It's still possible to install at >= 4GB with some
effort:<p>
You have 2 Options for doing so with OpenBSD 2.4. If you have linux or any
other unix like OS, you should back up the sectors first before trying
anything.
 <p> 
<ul>
<li>Suppose the partition starts at cylinder 611, and the drive has
255 heads, 63 sectors: offset for the obsd partition is 611*255*63 =
9815715 sectors. multiply this by 512 and you get: 5025646080. 5025646080
mod 2^32 = 730678784 <br>
(You can just subtract 2^32 on a hand
calculator...)
        dividing by 512 gives sector 1427107.
<br>
Ok, suppose were now in linux (where cylinder numbers are 1 higher   
btw..) and that the obsd partition is DOS partition 4:
<p><strong>
        dd if=/dev/hda of=backup.txt skip=1427107 bs=512 count=1
</strong><p>
will backup the data that installboot will nuke ..

<br>Now install OpenBSD.
Return to linux.
<br>
Now we're going to copy the partition boot record to the right place.
<p><strong>
        dd if=/dev/hda of=pbr.txt skip=1427107 bs=512 count=1
<br>        
dd if=/pbr.txt of=/dev/hda4 bs=512 count=1
<p></strong>
(adding obsd to lilo should now work)
<br>
Now write back the nuked sector:
<p>
<strong>
        dd if=/backup.txt of=/dev/hda seek=1427107 bs=512 count=1
<p></strong>
Caveat: make sure that whatever gets nuked by installboot isn't
essential to running dd (and starting the other OS). Backing up the
affected partition is recommended.
<p>
<li>Use a correct version of installboot (compiled for you by another    
OBSD'er ..):<br>
 put it on another partition, e.g. a DOS partition.
Suppose wd0j is the DOS partition (see disklabel wd0, this is in case of
IDE disks), and installboot is named installb there.
<br>
After booting from floppy/CD, press ^C to get into the shell:
<ul><strong>
       <li> mkdir dos<br>
       <li> mount /dev/wd0j dos<br>
       <li> cp dos/tmp/installb /usr/mdec/installboot<br>
</ul></strong>
<p>
Now enter 'install' and the installation procedure should use the new
installboot.
<p>
Wouter
 <hr>
<a href=index.html><img height=24 width=24 src=../back.gif border=0 alt=OpenBSD></a> 
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br><small>$OpenBSD: faq4.html,v 1.10 1999/01/03 00:38:01 ericj Exp $</small>
</body>
</html>
