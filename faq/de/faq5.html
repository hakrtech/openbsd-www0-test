<html>
<head>
<title>5.0 - Kernelkonfiguration</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2000 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<h2><font color=#e00000>5.0 - Kernelkonfiguration</font><hr></h2>
</p>

<p>
<ul><h3>Inhaltsverzeichnis</h3>
<li><a href= "faq5.html#5.1">5.1 - Warum brauche ich einen eigenkompilierten Kernel?</a></li>
<li><a href= "faq5.html#5.2">5.2 - Kernelkonfigurationsoptionen</a></li>
<li><a href= "faq5.html#5.3">5.3 - Einen eigenen Kernel kompilieren</a></li>
<li><a href= "faq5.html#5.4">5.4 - Boot-time Konfiguration</a></li>
<li><a href= "faq5.html#5.5">5.5 - Mehr Lognachrichten während des Startens</a></li>
<li><a href= "faq5.html#5.6">5.6 - Mittels config(8) deine Kernelbinärdatei verändern</a>
</ul>
</p>
<hr>
<br>

<p>
<a name= "5.1"></a>
<h2>5.1 - Warum brauche ich einen eigenkompilierten Kernel?</h2>
</p>

<p>
Es gibt dafür mehrere Gründe, obwohl das Kompilieren eines eigenen Kernels
eher für erfahrenere Benutzer geeignet ist, die bereits ein gutes 
Allgemeinverständnis vom System besitzen. 

<ul>
    <li>Dein Computer hat sehr wenig Hauptspeicher, den du so gut wie 
möglich ausnützen willst, indem du nicht benötigte Gerätetreiber 
entfernst. 
    <li>Standardoptionen entfernen oder Optionen hinzufügen, die
nicht standardmäßig aktiviert sind. 
    <li>Experimentelle Optionen (wie TCP_SACK, TCP_FACK, FFS_SOFTUPDATES) hinzufügen. 
</ul>
</p>
<p>
In den meisten Fällen wirst du keinen eigenen Kernel kompilieren müssen.  
Ein GENERIC Kernel wird normalerweise alles beinhalten, das du brauchst. Es gibt sogar mehrere Gründe, warum du keinen eigenen Kernel kreieren willst. 
Der Hauptgrund ist, daß man zwar logisch aussehende Änderungen an der
Kernelkonfiguration auf einfache Weise durchführen kann, aber dein
Kernel funktioniert dann nicht. 
Dies soll dein Warnsignal sein. Wenn etwas nicht zu funktionieren 
scheint, dann probiere bitte vorher einen 
GENERIC Kernel zu starten, bevor du einen Fehlerbericht einschickst. 
</p>

<p>
<a name= "5.2"></a>
<h2>5.2 - Kernelkonfigurationsoptionen</h2>
</p>

<p>
Kernelkonfigurationsoptionen bieten dir die Möglichkeit, zusätzliche 
Unterstützung zu deinem Kernel hinzuzufügen. Dies erlaubt dir, nur 
die von dir gewünschten Geräte zu unterstützen. Es gibt eine Vielzahl 
von Möglichkeiten, deinen Kernel auf deine Wünsche abzustimmen. 
Hier werden wir nur auf einige der am häufigsten benutzten 
Möglichkeiten eingehen. 
Siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>
für eine komplette Liste der Optionen. Es stehen auch Beispielkonfigurationsdateien für deine Architektur bereit. 
</p>

<P>
Nicht alle Kerneloptionen sind auf Kompatibilität mit allen anderen 
Optionen getestet worden. Daher solltest du keine Option in deinem 
Kernel setzen, wenn du nicht einen trifftigen Grund dafür hast! 
Am meisten wird der GENERIC Kernel getestet. Dies ist normalerweise 
die Kombination der Optionen in /usr/src/sys/arch/&lt;deine Arch&gt;/conf/GENERIC 
und /usr/src/sys/conf/GENERIC. 
</P>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Alpha Kernel Konfgurationsdateien </a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">i386 Kernel Konfigurationsdateien</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/">mac68k Kernel Konfigurationsdateien</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/">pmax Kernel Konfigurationsdateien</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">sparc Kernel Konfigurationsdateien</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Andere Architekturen</a></li>
</ul>
</p>

<p>
Wenn du diese Dateien genauer betrachtest, dann wird dir eine Zeile 
wie diese auffallen:<br>
<strong>include "../../../conf/GENERIC"</strong><br>
Dies bedeutet, daß ein Verweis auf eine andere Konfigurationsdatei 
<i>vorhanden</i> ist. 
Diese Datei beinhält architekturunabhängige Optionen. Wenn du also 
deinen eigenen Kernel konfigurieren willst, dann mußt du auch 
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a> 
beachten. Dort SIND Optionen enthalten, die BENÖTIGT werden. 
</p>

<p>
Alle nachfolgend aufgelisteten Optionen sollten in deiner Kernelkonfigurationsdatei im Format von:<br>
<strong>option      OPTION</strong><br>
angeführt sein. Um die Option debug im Kernel zu plazieren, füge eine
Zeile wie diese ein:<br>
<strong>option	    DEBUG</strong><br>
Die Optionen im OpenBSD Kernel werden in Compiler Präprozessor Optionen übersetzt, daher würde eine Option wie DEBUG den Quelltext mit der Option -DDEBUG kompilieren, was einem #define DEBUG im Kernel entspricht.
</p>

<p>
OpenBSD hat viele Kompatibilitätsmöglichkeiten, die dir erlauben, 
Binärdateien von anderen Betriebsystemen zu benützen. 
Nicht alle Optionen sind auf jeder Architektur vorhanden, daher lies 
die entsprechende Manual Seite, ob die Architektur unterstützt wird.
</p>
<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SVR4(8)</a> - Kompatibilität mit SVR4 Binärdateien.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_BSDOS(8)</a> - Kompatibilität mit BSD/OS Binärdateien.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_LINUX(8)</a> - Kompatibilität mit Linux Binärdateien.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SUNOS(8)</a> - Kompatibilität mit SunOS Binärdateien.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_ULTRIX(8)</a> - Kompatibilität mit Ultrix Binärdateien.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_FREEBSD(8)</a> - Kompatibilität mit FreeBSD Binärdateien.</li>
<li>COMPAT_HPUX - Kompatibilität mit HP-UX Binärdateien. Nur auf einigen m68k Architekturen.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_IBCS2(8)</a> - Kompatibilität mit ibcs2 Binärdateien.</li>
<li>COMPAT_OSF1 - Für Digital Unix Binärdateien. Nur auf Alpha Plattform.</li>
<li>COMPAT_43 - Kompatibilität mit 4.3BSD. Von dessen Gebrauch wird zwar abgeraten, aber wird für unseren Navigator port benötigt. </li>
<li>COMPAT_11 - Kompatibilität mit NetBSD 1.1</li>
<li>COMPAT_NOMID - Kompatibilität mit a.out executables ohne machine id.
</ul>
</p>

<p>
Es ist immer hilfreich, Probleme mit dem Kernel debuggen zu können. 
Aber viele wollen diese Optionen nicht in ihren Kernel setzen, weil 
diese Optionen den Kernel sehr vergrößern. Sie sind aber extrem 
hilfreich im Falle eines Fehlers.
Ein Entwickler wird die Quelle deiner Probleme viel schneller finden 
können. 
Hier eine Liste der debug Optionen: 
</p>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html">DDB</a> - Kernelinterner Debugger. Nicht auf allen Plattformen. Daher konsultiere die Manual Seite.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html">KGDB</a> - Kompiliert einen `remote kernel debugger` mittels `remote target` Option von gdb.</li>
<li>makeoptions  DEBUG="-g" - Erzeugt bsd.gdb gemeinsam mit bsd. Dies ist nützlich, um crash dumps mit gdb zu debuggen. NOTE: Diese Option aktiviert auch <strong>option DEBUG</strong>.</li>
<li>DEBUG - Diverse debugging Optionen im Kernel, die im Quelltext definiert wurden.</li>
<li>KTRACE - Fügt "hooks" für "system call tracing facility" ein. Dies erlaubt den Benutzern: <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html">ktrace(1)</a>.</li>
<li>DIAGNOSTIC - Fügt Code im Kernel für interne Konsistenzüberprüfungen ein.</li>
<li>GPROF - Fügt Code im Kernel für Kernelprofilierung mit <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html">kgmon(8)</a> ein.</li>
<li>makeoptions PROF="-pg" - Die -pg Option dient zur Unterstützung von "profiling" im Kernel. Die Option GPROF wird dafür benötigt.</li>
</ul>
</p>

<p>
<strong>Dateisystemoptionen.</strong>
<ul>
<li>FFS - Berkeley Fast Filesystem. <strong>ANMERKUNG:</strong> Diese Option wird benötigt.</li>
<li>EXT2FS - Second Extended File System, benötigt für das Lesen von Linux Partitionen.</li>
<li>MFS - Memory File System, speichern von Dateien in swap - Speicher.</li>
<li>NFS - Network File System, benötigt für NFS.</li>
<li>CD9660 - Das iso9660 + rockridge Dateisystem; zum Lesen von CDs.</li>
<li>MSDOSFS - Benötigt, um MS-DOS FAT Dateisysteme zu lesen; bietet Unterstützung für Windows 95 (lange Dateinamen + Groß-/Kleinschreibungerweiterungen).</li>
<li>FDESC - Beinhält Code für ein Dateisystem, das auf /dev/fd gemountet werden kann.</li>
<li>KERNFS - Beinhält Code für das Mounten eines speziellen Dateisystemes (normalerweise auf /kern), in dem sich Dateien befinden, die spezielle Kernelvariablen und -parameter repräsentieren.<li>
<li>NULLFS - Code für ein loopback Dateisystem. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html">mount_null(8)</a> has more information</li>
<li>PROCFS - Beinhält Code für ein spezielles Dateisystem (normalerweise auf /proc)</li>
<li>PORTAL - Beinhält das (experimentelle) portal Dateisystem.  Dies erlaubt interessante Tricks wie TCP sockets durch das Öffnen von Dateien im Dateisystem zu öffnen.</li>
<li>UMAPFS - Beinhält ein loopback Dateisystem, in dem Benutzer- und Gruppenids umgelegt werden dürfen -- nützlich, wenn man fremde Dateisysteme mit anderen uids und gids als das lokale System mounten will (zB.: NFS).</li>
<li>UNION - Beinhält Code für das union Dateisystem, welches das Mounten von Verzeichnissen übereinander erlaubt, so daß beide Dateisysteme sichtbar bleiben. Dieser Code ist noch nicht sehr stabil.</li>
<li>XFS - Fügt "hooks" für ein Dateisystem ein, das kompatibel mit dem AFS Dateisystem ist. Derzeit vom Arla/AFS Code benutzt.</li>
<li>LFS - Log Structured Filesystem.</li>
<li>FFS_SOFTUPDATES - Erlaubt den Gebrauch von softupdates. Hier mehr dazu: <a href="../faq14.html#14.5">Softupdates FAQ</a>.
<li>NFSSERVER - Serverseitiger NFS Code im Kernel.</li>
<li>NFSCLIENT - Klientseitiger NFS Code im Kernel.</li>
<li>FIFO - Unterstützung für FIFO's.. EMPFOHLEN.</li>
<li>NVNODE=integer - Wobei integer eine Ganzzahl ist, die der Größe des Caches bei name-to-inode Übersetzungsroutinen entspricht (dh. der namei() Cache, obwohl er auch von vielen anderen Funktionen im Kernelquelltext aufgerufen wird).</li>
<li>QUOTA - Unterstützung für Quoten im Dateisystem. Hier mehr dazu: <a href="../faq10.html#10.10">FAQ 10</a>.</li>
</ul>
</p>

<p>
<strong>Diverse Optionen</strong>
<ul>
<li>PCIVERBOSE - Mehr Details während des Startprozesses von PCI Geräten.</li>
<li>EISAVERBOSE - Mehr Details während des Startprozesses von EISA Geräten.</li>
<li>PCMCIAVERBOSE - Mehr Details während des Startprozesses von PCMCIA Geräten.</li>
<li>APERTURE - Liefert kernelinterne Unterstützung für VGA Bildzwischenspeicher durch Umlegen von Benutzerprozessen. Benötigt für X.</li>
<li>XSERVER - Unterstützung für die X Server Konsolentreiber. Benötigt für X.</li>
<li>LKM - Unterstützung für Loadable Kernel Modules (ladbare Kernelmodule). Nicht auf allen Architekturen. Siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html">lkm(4)</a> für weitere Informationen.</li>
<li>INSECURE - Setzt das Kernelsicherheitsniveau auf -1. Siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a> für weitere Informationen bezüglich der Kernelsicherheitseinstellungen.</li>
<li>MACHINE_NONCONTIG - Ändert Teile des VM/pmap Interfaces, um "non-contiguous memory" zu erlauben.</li>
<li>RAM_DISK_HOOKS - Erlaubt den Aufruf von rechnerabhängigen Funktionen, wenn der Ramdisktreiber konfiguriert ist.</li>
<li>RAM_DISK_IS_ROOT - Zwingt die Ramdisk, root zu sein.</li>
<li>CCDNBUF=integer - Setzt die Anzahl des "component buffers" von CCD(4). Standard ist 8. Für mehr über CCD siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html">CCD(4)</a> oder das <a href="../faq11.html#11.2">Performancetuning FAQ Kapitel.</a></li>
<li>KMEMSTATS - Damit unterhält malloc(9) (kernel memory allocator) Statistiken über seinen Gebrauch. Wenn die Option DEBUG benutzt wird, wird diese Option automatisch von config deaktiviert. </li>
<li>BOOT_CONFIG - Fügt die Unterstützung für die -c boot Option ein.</li>
</ul>
</p>

<p>
<strong>Netzwerkoptionen</strong><br>
Siehe auch das <a href="../faq6.html">Netzwerk FAQ</a> oder das <a href="../faq11.html#11.1">Netzworking Performancetuning FAQ</a>.
<ul>
<li>GATEWAY - Ermöglich IPFORWARDING und erhöht (auf den meisten Plattformen) die Größe der NMBCLUSTERS.</li>
<li>NMBCLUSTERS=integer - Steuert die Größe der mbuf cluster map. </li>
<li>IPFORWARDING - Ermöglich IP routing Verhalten.  Wenn diese Option aktiviert ist, wird der Rechner IP Datagramme zwischen seinen Netzwerkkarten weiterleiten, die für andere Rechner bestimmt sind.</li>
<li>MROUTING - Beinhält Unterstützung für IP multicast Router.</li>
<li>INET - Beinhält Unterstützung für den TCP/IP protocol stack. Diese Option wird BENÖTIGT.</li>
<li>MCLSHIFT=Wert - Diese Option ist der Logarithmus zur Basis 2 der Größe des mbuf clusters. Siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a> für mehr Information über diese Option.</li>
<li>NS - Inkludiere Unterstützung für den Xerox XNS protocol stack.  Siehe <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current">ns(4)</a>.</li>
<li>ISO,TPIP - Inkludiere Unterstützung für den allgegenwärtigen OSI protocolstack. Siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html">iso(4)</a> für mehr Information.</li>
<li>EON - Inkludiere Unterstützung für OSI tunneling über IP.</li>
<li>CCITT,LLC,HDLC - Inkludiere Unterstützung für den X.25 protocol stack.</li>
<li>IPX, IPXIP - Inkludiere Unterstützung für: Internetwork Packet Exchange protocol, das von Novell NetWare verwendet wird.</li>
<li>NETATALK - Inkludiere Kernelunterstützung für die AppleTalk Protokolfamilie.</li>
<li>TCP_COMPAT_42 - Vom Gebrauch dieser Option wird sehr abgeraten, daher sollte sie auch nicht aktiviert werden: TCP Fehlerkompatibilität mit 4.2BSD. In 4.2BSD waren die TCP Sequenzzahlen 32-bit signierte Werte.  Moderne Implementationen des TCP verwenden unsignierte Werte.</li>
<li>TCP_NEWRENO - Aktiviert "NewReno fast recovery phase", welche die Wiederherstellung eines verlorenen Segmentes pro Rücklaufzeit erlaubt.</li>
<li>TCP_SACK - Aktiviert selektive Bestätigungen.</li>
<li>TCP_FACK - Aktiviert weiterleitende Bestätigungen, die präzisere Schätzungen über noch ausstehende Daten während der "fast recovery phase" mittels SACK Informationen erlauben. Diese Option kann gemeinsam mit TCP_SACK benutzt werden.</li>
<li>IPFILTER - Diese Option aktiviert IP Filterung auf Paketebene mit ip-filter.</li>
<li>IPFILTER_LOG - Diese Option (zusammen mit IPFILTER) aktiviert das Loggen von IP Paketen mittels ip-filter.</li>
<li>IPFILTER_DEFAULT_BLOCK - Diese Option setzt die Standardrichtlinie von ip-filter. Wenn diese gesetzt ist, dann wird ip-filter standardmäßig Pakete blockieren.</li>
<li>PPP_FILTER - Diese Option aktiviert auf <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html">pcap(3)</a> basierende Filterung für PPP Verbindungen.</li>
<li>PPP_BSDCOMP - PPP BSD Kompression.</li>
<li>PPP_DEFLATE - Wird gemeinsam mit PPP_BSDCOMP verwendet.
<li>IPSEC - Diese Option ermöglicht die Unterstützung des IP security protocol. Siehe <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a> für mehr Details. Dies impliziert nun die Option KEY, welche Unterstützung für PFKEYv2 bietet.</li> 
<li>ENCDEBUG - Diese Option ermöglicht, daß Debuginformationen aufgezeichnet werden, wenn IPSEC Fehler bemerkt.</li>
<li>TCP_SIGNATURE - TCP MD5 Signaturen, für BGP routing sessions.</li>
</ul>
</p>

<p>
<strong>PCVT Optionen</strong> (<i>nur gültig auf i386 Architektur</i>)
<ul>
<li>PCVT_NSCREENS=integer - Anzahl an pcvt Bildschirmen. Standard: 8.</li>
<li>PCVT_VT220KEYB - Wenn aktiviert, dann wird ein Keyboard Layout generiert, daß ein DEC VT200 (TM) darstellt.</li>
<li>PCVT_SCREENSAVER - Aktiviert den eingebauten Screensaver. Standard: on (ein).</li>
<li>PCVT_PRETTYSCRNS - Wenn aktiviert, dann wird ein Bildschirmschoner mit leuchtenden Sternen benutzt. Standard: off (aus).</li>
<li>PCVT_CTRL_ALT_DEL - Wenn aktiviert, dann löst die Tastenkombination &lt;Ctrl&gt; &lt;Alt&gt; &lt;Del&gt; einen CPU Reset aus. Standard: off (aus).</li>
<li>PCVT_USEKBDSEC - Übergehe NICHT die Sicherheitssperre für die Tastatur. Standard: on (ein).</li>
<li>PCVT_24LINESDEF - Wenn aktiviert, dann werden die 25-Zeilen modi (VT Emulation mit 25 Zeilen und HP Emulation mit 28 Zeilen) nur mit 24 Zeilen dargestellt, um bessere Kompatibilität mit dem originalen DEV VT220 (TM) zu gewährleisten.</li>
<li>PCVT_EMU_MOUSE - Emuliere eine drei-Tastenmaus via Keypad. Nützlich für Notebooks mit XFree86. Standard: off (aus).</li>
<li>PCVT_META_ESC - Wenn aktiviert, dann wird eine Sequenz aus &lt;esc&gt; gefolgt von einem normalen Tastencode so interpretiert, als wäre die Taste mit der &lt;Alt&gt; Taste gedrückt worden. Wenn deaktiviert, dann wird der normale Tastencode plus dem Wert 0x80 geschickt. Standard: off (aus).</li>
</ul>
</p>

<p>
<strong>SCSI Subsystemoptionen</strong>
<ul>
<li>SCSITERSE - Knappere SCSI Fehlermeldungen.  Dies läßt die Tabelle, um ASC/ASCQ Informationen zu dekodieren, aus, was etwa 8 Bytes einspart.</li>
<li>SCSIDEBUG - Druckt zusätzliche Debuginformationen für das SCSI Subsystem auf die Konsole.</li>
</ul>
</p>


<p> <a name= "5.3"></a>
<h2>5.3 - Einen eigenen Kernel kompilieren</h2>
</p>

<p>
Vollständige Instruktionen zum Kreieren deines eigenen Kernels findest du hier: 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html">
afterboot(8)</a>.
</p>

<p>
Um deinen eigenen Kernel von Cdrom zu kompilieren, mußt du zunächst den Quelltext haben. 
Dafür benötigst du nur den Kernelquelltext, den du auf der CD findest. 
So kopierst du den Quelltext von CD (CD1 ist hier im Beispiel unter /mnt gemountet.): 
</p>

<ul>
<pre>
# <strong>mkdir -p /usr/src/sys</strong>
# <strong>cd /mnt/sys</strong>
# <strong>tar cf - . | ( cd /usr/src/sys; tar xvf - )</strong>
</pre>
</ul>

<p>
Am einfachsten ist es, mit einem GENERIC 
Kernel zu beginnen. Dieser befindet sich unter <i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>,
wobei ${arch} deine Architektur ist. In diesem Verzeichnis befinden sich auch weitere 
Beispielskonfigurationen. 
Hier zwei Beispiele fürs Kompilieren deines Kernels.
Das erste Beispiel behandelt das Kompilieren von einem 
Quelltextbaum, der nur Leseberechtigung hat. Das zweite Beispiel zeigt, wie es auf einem 
Quelltextbaum mit Schreibberechtigung funktioniert.
</p>

<ul> 
<pre>
# <strong>cd /irgendwo</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/IRGENDEINEDATEI .</strong>
# <strong>vi IRGENDEINEDATEI</strong> (um deine gewünschten Änderung durchzuführen)
# <strong>config -s /usr/src/sys -b . IRGENDEINEDATEI</strong>
<ul>
# <strong>make depend</strong> 
<ul>
(Der obige Schritt ist notwendig, wenn du irgendwelche Änderungen [inkl. Updates 
und Patches] an deinem Kernelquelltextbaum durchgeführt hast.  Dieser Schritt kann 
ignoriert werden, wenn du dem nächsten Schritt folgst.)
</ul>
<font size="+1">
<b><i>ODER</i></b>
</font>
# <strong>make clean</strong>
<ul>
(Der obige Schritt ist notwendig, wenn du irgendwelche Änderungen an 
Kernelkonfigurationsoptionen durchführst und er ist auch empfohlen, wenn du 
größere Updates an deinem Quelltextbaum vornimmst. Ansonsten kann du diesen 
Schritt überspringen und 'make depend' eingeben.)
</ul>
</ul>
# <strong>make</strong>
</pre>
</ul>

<p>
Um einen Kernel von einem Quelltextbaum mit Schreibberechtigung zu bauen, tue folgendes:
</p>

<ul>
<pre>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi IRGENDEINEDATEI</strong> (um deine gewünschten Änderung durchzuführen)
# <strong>config IRGENDEINEDATEI</strong> (hier mehr darüber : <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html">config(8)</a>)
# <strong>cd ../compile/IRGENDEINEDATEI</strong>
# <strong>make</strong> 
</pre>
</ul>

<p>
Wobei $ARCH für die von dir benutzte Architektur ist (z.B. i386). Du kannst auch 
ein <strong>make depend</strong> durchführen, um die Abhängigkeiten fürs nächste
Kernelkompilieren zu schaffen. 
</p>

<p>
Jetzt muß der Kernel noch an den richtigen Platz.
</p>

<ul>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/IRGENDEINEDATEI/bsd /bsd</strong>
</pre>
</ul>

<p>
Um deinen alten Kernel zu starten, mußt du nur 
</p>

<ul>
<pre>
boot> <strong>bsd.old</strong>
</pre>
</ul>

<p>
beim Starten eingeben, und dein alter Kernel wird anstelle von /bsd geladen.
</p>

<p>
Manchmal wirst du auch neue Bootblöcke installieren müssen, wenn du einen Kernel 
gebaut hast. Um dies zu tun, siehe <a href="../faq14.html#14.8">
FAQ 14.8 Über den OpenBSD's Bootloader</a>. Dies wird dir eine Übersicht vom Gebrauch 
des OpenBSD Bootloaders geben.
</p>

<p>
<a name="5.4"></a> 
<h2>5.4 - Boot-Time Konfiguration </h2>
</p>

<p>
Manchmal findet der Kernel beim Booten dein Gerät, aber eventuell den falschen
IRQ. Und vielleicht brauchst du dieses Gerät sofort. Nun, ohne den Kernel neu zu 
bauen, kannst du mit der OpenBSD eigenen Boot-Time Konfiguration dieses Problem 
lösen. Dies wird aber dein Problem nur einmal lösen. Wenn du rebootest, dann 
mußt du diese Prozedur wiederholen. Daher ist dies nur als vorübergehende Lösung 
gedacht, und du solltest das Problem durch das Neukompilieren deines eigenen 
Kernels lösen. 
Dein Kernel wird die <strong>option BOOT_CONFIG</strong> benötigen, die GENERIC 
bereits beinhält.
</p>

<p>
Den Großteil dieses Dokumentes kannst du in der Manual Seite 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html">boot_config(8)</a> finden.
</p>

Um in die Benutzerkernelkonfiguration (User Kernel Config) oder UKC zu gelangen, mußt 
du beim Starten die -c Option verwenden.

<ul><pre>
boot> <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

<p>
Oder welchen Kernel du auch immer laden willst. So kommst du in die 
UKC. Hier kannst du Befehle ausführen, die kernelspezifische Geräte 
ändern oder deaktivieren.
</p>

<p>
Hier eine Liste der gängigen Befehle in der UKC.
</p>

<p>
<CODE>add <strong>device</strong> - Füge ein Gerät durch Kopieren eines anderen hinzu 
</p>

<p>
change <strong>devno | device </strong> - Ändere ein oder mehrere Geräte
</p>

<p>
disable <strong>devno | device </strong> - Deaktiviere ein oder mehrere Geräte 
</p>

<p>
enable <strong>devno | device </strong> - Aktiviere ein oder mehrere Geräte 
</p>

<p>
find <strong>devno | device </strong> - Suche ein oder mehrere Geräte
</p>

<p>
help - Kurze Zusammenfassung dieser Befehle
</p>

<p>
list - Liste ALLE bekannten Geräte auf
</p>

<p>
exit/quit - Setze Starten fort
</p>

<p>
show <strong>[attr [val]]</strong> - Zeige alle Geräte mit Eigenschaft (attribute) und optional mit einem spezifierten Wert (value)
</p></CODE>

<p>
Wenn du einmal dein Gerät konfiguriert hast, dann steige mit quit oder exit aus UKC aus 
und setze das Starten fort.
Nun solltest du deine Kernelkonfiguration korrigieren und einen eigenen Kernel 
kompilieren. 
Siehe <a href="faq5.html#5.3">Einen eigenen Kernel kompilieren
</a> für weitere Hilfe.
</p>

<a name="5.5"></a>
<h2>5.5 - Mehr Lognachrichten während des Startens</h2>


<p>
Mehr Lognachrichten während des Startens zu bekommen kann sehr hilfreich sein, wenn man 
Bootprobleme lösen will. Wenn du ein Problem hast und du zuwenig Informationen beim 
Starten erhältst, dann gib beim Starten bei "boot>" wieder "-c" ein, um zur UKC zu gelangen, dann:


<ul><pre>
UKC> <strong>verbose</strong>
autoconf verbose enabled
UKC> <strong>quit</strong>
</ul></pre>

<p>
Nun wirst du extrem ausführliche Meldungen beim Booten erhalten.
</p>

<a name="5.6"></a>
<h2>5.6 - Mittels config(8) deine Kernelbinärdatei verändern</h2>

<p>
Mit der Version 2.6 kamen die Optionen <b>-e</b> und <b>-u</b> zu 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>.
Diese Optionen können extrem hilfreich sein und Zeit einsparen, die du sonst zum 
Kernelkompilieren benötigst. 
Die <b>-e</b> Option erlaubt dir die UKC auf einem laufenden System zu 
benutzen. Die Änderungen werden dann beim nächsten Reboot wirksam. 
Die <b>-u</b> Option testet, ob irgendwelche Änderungen am laufenden Kernel während 
des Bootens gemacht wurden. 
D.h., ob du mittels <b>boot -c</b> die UKC beim Starten benutzt hast.
</p>

<p>
Das folgende Beispiel zeigt das Deaktivieren des ep* Gerätes aus dem 
Kernel. Zur Sicherheit mußt du die 
<b>-o</b> Option benutzen, die Änderung in die angegebene Datei schreibt. 
Z.B.: <strong>config -e -o bsd.new /bsd</strong> wird die Änderungen 
in bsd.new schreiben. Das folgende Beispiel verwendet die <b>-o</b> Option nicht,
daher werden die Änderungen einfach ignoriert und nicht in eine Kernelbinärdatei geschrieben. 
Für weitere Informationen über Fehler- und Warnmeldungen siehe 
die <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>
Manual Seite.
</p>

<ul><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' für information
ukc> <strong>?</strong>
        help                            Command help list
        add     dev                     Add a device
        base    8|10|16                 Base on large numbers
        change  devno|dev               Change device
        disable attr val|devno|dev      Disable device
        enable  attr val|devno|dev      Enable device
        find    devno|dev               Find device
        list                            List configuration
        lines   count                   # of lines per page
        show    [attr [val]]            Show attribute
        exit                            Exit, mitout saving changes
        quit                            Quit, saving current changes
ukc> <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
  1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
  2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
 10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|ncr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
 11 cd* at scsibus* target -1 lun -1
 12 ch* at scsibus* target -1 lun -1
 13 sd* at scsibus* target -1 lun -1
 14 st* at scsibus* target -1 lun -1
 15 ss* at scsibus* target -1 lun -1
 16 uk* at scsibus* target -1 lun -1
 17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
--- more ---   
[snip]
ukc> <strong>disable ep</strong>
 31 ep0 disabled
 32 ep* disabled
 33 ep* disabled
 87 ep0 disabled
 88 ep0 disabled
 89 ep* disabled
 90 ep* disabled
136 ep* disabled
ukc> <strong>quit</strong>
not forced
</ul></pre>

<p>
Im obigen Beispiel werden alle ep* Geräte aus dem Kernel entfernt und werden 
auch nicht abgefragt. In einigen Situationen, in denen du die UKC beim 
Booten mittels <b>boot -c</b> benutzt hast, willst du diese Änderungen dauerhaft 
niederschreiben. Dafür brauchst du die <b>-u</b> Option.
Im folgenden Beispiel wurde die UKC gestartet und das 
wi(4) Gerät deaktiviert. Da diese Änderung mit boot -c NICHT dauerhaft sind, 
müssen die Änderungen erst geschrieben werden. Dieses Beispiel schreibt die 
Änderung in boot -c in eine neue kernelbinärdatei namens bsd.new.
</p>

<ul><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
151 wi* disabled
Enter 'help' for information
ukc> <strong>quit</strong>
</ul></pre>


<p>
<font color= "#0000e0">
<a href= "index.html">[Zurück zum Hauptindex]</a>
<a href= "faq4.html">[Zu Kapitel 4.0 - Installationsleitfaden]</a>
<a href= "../faq6.html">[Zu Kapitel 6.0 - Netzwerk Einstellungen]</a>
</font>
</p>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zurück]"></a> 
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq5.html,v 1.43 ]
<br>
$Translation: faq5.html,v 1.2 2000/04/20 13:25:57 wim Exp $
<br>
$OpenBSD: faq5.html,v 1.1 2000/04/20 13:28:09 wvdputte Exp $
</small>
</p>
</body>
</html>
