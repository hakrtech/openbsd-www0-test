<html>
<head>
<title>OpenBSD FAQ: 10.0 - System Administration</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998,1999 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">
<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq9.html">[To Section 9.0 - Migrating from Linux]</a>
<a href= "faq24.html">[To Section 11.0 - OpenBSD 2.4 Specific Information]</a>
</font>
</p>

<p>
<h1>10.0 - System Administration</h1>
<hr>
</p>

<p>
<a name= "10.1">
<h2>10.1 - Why does it say that I'm in the wrong group when I su to root?</h2>
</a>
</p>

<p>
With OpenBSD's <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>
utility does not allow for you to add any users to the <kbd>&quot;wheel&quot;</kbd> group. This means that they must be added to
the <kbd>&quot;wheel&quot;</kbd> group by hand. This is done for security reasons, and you should be cautious with whom you give
access to. On OpenBSD, users who are in the <kbd>"wheel"</kbd> group are allowed to use the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&apropos=0&sektion=1&format=html">
su(1)</a> userland program to become root. Users who are not in <kbd>&quot;wheel&quot;</kbd> cannot use su(1). Here is
an example of a <kbd>/etc/group</kbd> entry to place the user <strong>ericj</strong> into the
<kbd>&quot;wheel&quot;</kbd> group.
</p>

<ul>
<pre>
<strong>wheel:*:0:root,ericj</strong>
</pre>
</ul>

<p>
If you are looking for a way to allow users limited access to superuser privliges, without putting them in the
<kbd>&quot;wheel&quot;</kbd> group, use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&sektion=8&format=html">sudo(8)</a>.
</p>

<p>
<a name= "10.2">
<h2>10.2 - How do I duplicate a filesystem?</h2>
</a>
</p>

<p>
To duplicate your filesystem use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&sektion=8&format=html">dump(8)</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&sektion=8&format=html">restore(8)</a>. For example. To duplicate
everything under directory <kbd>SRC</kbd> to directory <kbd>DST</kbd>, do a:
</p>

<ul>
<strong>
<pre>
# cd /SRC; dump 0f - . | (cd /DST; restore -rf - )
</pre>
</strong>
</ul>

<p>
<a name="10.3">
<h2>10.3 - How do I get httpd, sendmail, etc to startup with the
system?</h2>
</a>
</p>

<p>
OpenBSD uses rc-style startup to control starting applications with the
system. For common daemons you can simply edit 
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf?rev=1.35">/etc/rc.conf</a>.
<br>
For example: To have ftpd started on boot change - 


<ul>
<strong>
<pre>
ftpd_flags=NO -- > ftpd_flags="-D"
</pre>
</strong>
</ul>
</p>


<p>
You can add any flags that you wish ftpd to start with.
</p>

<p>
If you have your own daemon's that you want to be started, here is a
simple entry that you can put into /etc/rc.local.

<ul>
<strong>
<pre>
if [ -x /usr/local/sbin/mydaemon ]; then
        echo -n ' mydaemon';       /usr/local/sbin/mydaemon
fi
</pre>
</strong>
</ul>

Once in there, it will come up with the system each time.
</p>

<p>
<a name="10.4">
<h2>10.4 - Why do users get relaying access denied when they are remotely sending mail through my OpenBSD system?</h2>
</a>
</p>

<p>
Try this:
</p>

<pre>
cat /etc/sendmail.cf | grep relay-domains
</pre>
<p>
The output may look something like this:
</p>

<pre>
FR-o /etc/mail/relay-domains
</pre>

<p>
If this file doesn't exist, create it.  You will need to enter the users
who are sending mail remotely with the following syntax:
</p>

<pre>
.domain.com    #if it is dynamic
sub.domain.com #if static
</pre>

<p>
Don't forget to:
</p>
<pre>
kill -1 `cat /var/run/sendmail.pid`
</pre>
<br>


<p>
<a name="10.5">
<h2>10.5 - I've set up POP, but users have trouble accessing mail thru POP. What can i do?</h2>
</a>
</p>

<p>
Most issues dealing with pop are accessing files, mainly temp files.
Some clients give errors such as:
</p>
<pre>
-ERR Couldn't open temporary file, do you own it?K
</pre>
<p>
Try setting up your permissions as such:
</p>
<pre>
permission in  /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permissions in  /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre>
<p>
Double check that the user owns his file in /var/mail , this should be
done by default.
</p>

<p>
<a name="10.6">
<h2>10.6 - Setting up a Secure HTTP server with SSL(8)</h2>
</p>

<p>
This will take you through all the steps it takes to set up your own
Secure HTTP server. Since the OpenBSD 2.5 release, OpenBSD has shipped
with ssleay. Because of copyrighted RSA algorigthms, these cannot be
shipped with OpenBSD. libssl includes support for SSL version 2, SSL
version 3, and TLS version 1. So for now, because of copyright
restictions, OpenBSD must ship without a fully-functional libssl. But it
is still completely useable. If you are able to use the RSA patented
library's you can easily upgrade your libssl with a command like this.
</p>
<p>
<kbd>#pkg_add ftp://ftp.openbsd.org/pub/OpenBSD/${ver}/packages/${arch}/libssl-1.1.tgz </kbd>
<br>
Where ${ver} is the OpenBSD version number, and ${arch} is your
architecture.
</p>

<p>
The steps shown here are taken pretty much from the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&apropos=0&sektion=8&format=html">ssl(8)</a>
man page. So you can refer to that for further information. Also, this faq
will only go over creating a RSA certificate for web servers, not a DSA
server certificate. To find out how to do so, please refer to the ssl(8)
man page.
</p>

<p>
I will no show how to create your key and certificate. These will go to
<strong>/etc/ssl/private/</strong>. This means that you will have to have
upgraded your libssl. Now we can create our key. You can do so with a line
like such:
</p>

<ul>
<strong># ssleay genrsa -out /etc/ssl/private/server.key 1024</strong>
</ul>

<p>
This will create a key of 1024 bits. Next you need to create a
<strong>Certificate Signing Request</strong> which is used to get a
<strong>CA</strong> or <strong>Certificate Authority</strong> to sign your
key. Here is the command to do so.
</p>

<ul>
<strong># ssleay req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</ul>

<p>
You would now give /etc/ssl/private/server.csr to the <strong>CA</strong>
to get it signed. Or you could also sign the certificate for yourself.
Here is how you would do this.
</p>

<ul>
<strong># ssleay x509 -req -days 365 -in /etc/ssl/private/server.csr -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</ul>

<p>
This will sign your key, and it will be valid for up to 365 days. With
this done you can now start the httpd server. To start httpd(8) with ssl
you must start the daemon with the -DSSL flag. You can start this on boot
in <strong>/etc/rc.conf</strong> by changing the httpd line to look like
so:
</p>

<ul>
<pre>
httpd_flags="-DSSL"
</pre>
</ul>

<p>
This server will run on port 443.
</p>

<p>
<a name="10.7">
<h2>10.7 - I edited /etc/passwd with vi(1), but the changes didn't seem to take place. Why?</h2>
</p>

<p>
Changes will not be made right away because OpenBSD has a user database
which needs updated when changes are made in <strong>/etc/passwd</strong>.
Tools are made to do this immediatly for you though. You should use
vipw(8) to edit the passwd file by hand. This will allow for checking of
the passwd file before entering it into the database and after the check
is done it will automatically execute pwd_mkdb(8). If you have made
changes, without using a tool such as vipw, you can run pwd_mkdb(8) by
hand.
</p>

<p>
<a name="10.8">
<h2>10.8 - What is the best way to add users? and delete them?</h2>
</p>

<p>
The best way to add a user in OpenBSD is to use the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&sektion=8&format=html">adduser(8)</a>
script. You can configure this to work however you like by editing
<strong>/etc/adduser.conf</strong>. You can add users by hand, but this is
the recommended way to addusers. adduser(8) allows for consistancy checks
on <strong>/etc/passwd</strong>, <strong>/etc/group</strong>, and shell
databases. It will create then entries for you, and HOME directory, and
even send a message to the user welcoming them. This can be changed to
meet your needs. For further instructions on adding users read the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser_proc&sektion=8&format=html">adduser_proc(8)</a>
man page.
</p>

<p>
To delete users you should use the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&sektion=8&format=html">rmuser(8)</a>
utility. This will remove all existance of a user. It will remove any
crontab(1) entries, their HOME dir (if it is owned by the user). Along
with their <strong>/etc/passwd</strong> and <strong>/etc/group</strong>
entries.
</p>

<p>
<a name="10.9">
<h2>10.9 - How do i create an ftp-only account?</h2>
</p>
<p>
<p>
There are a few ways to do this, but a very common way to do such is to
add /usr/bin/false into <strong>/etc/shells</strong>. Then when you create
the user set his shell to /usr/bin/false, this they he will not be able to
get a shell but will be able to keep their ftp capabilities. adduser(8)
will give them a home dir by default of /home/foo. If this is what you
desire it doesn't need to be changed, however you can set this to whatever
directory you wish.
</p>

<p>
<a name="10.10">
<h2>10.10 - Setting up Quota's</h2>
</p>

<p>
Quota's are used to limit users space that they have available to them on
your drives. It can be very helpfull in situations of limited resources.
quota's can be set in two different ways. 
</p>

<p>
<ul>
<li>1 - User Quota's</li>
<li>2 - Group Quota's</li>
</ul>
</p>

<p>
The first step to setting up quota's is to make sure that <strong>option
QUOTA</strong> is in your Kernel Configuration. This option is in the
GENERIC kernel. After this you need to mark in <strong>/etc/fstab</strong>
the filesystems which will have quota's enabled. The keywords
<strong>userquota</strong> and <strong>groupquota</strong> should be used
to mark each fs that you will be using quota's on. By default the files
<strong>quota.user</strong> and <strong>quota.group</strong> will be
created at the root of that filesystem to hold the quota information. This
default can be overwritten by doing, userquota=/var/quotas/quota.user. Or
whatever file you want to use for holding quota information. Here is an
example /etc/fstab that has one filesystem with userquota's enabled.
</p>

<ul>
<pre>
<strong>/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1</strong>
</pre>
</ul>

<p>
Now it's time to set the users quota's. To do so you use the utility
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&sektion=8&format=html">edquota(8)</a>
. A simple use is just <strong>edquota &lt user &gt</strong>. edquota(8)
will use vi(1) to edit the quota's unless the environmental variable
EDITOR is set to a different editor. For example:
</p>

<ul>
</pre>
<strong># edquota ericj</strong>
</pre>
</ul>

<p>
This will give you output similar to this:
</p>

<ul>
<pre>
<strong>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</strong>
</pre>
</ul>

<p>
To add limits, edit it to something similar to this:
</p>

<ul>
<pre>
<strong>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
	inodes in use: 25, limits (soft = 0, hard = 0)
</strong>
</pre>
</ul>

<p>
In this the softlimit is set to 1000 blocks and the hardlimit is set to
1050 blocks. A softlimit is a limit where the user is just warned when
they cross it and have until their grace period is up to get their disk
usage below their limit. Grace period's can be set by using the
<strong>-t</strong> option on edquota(8). After the grace period is over
the softlimit is handled as a hardlimit. This usually results in an
allocation failure.
</p>

<p>
Now that the quota's are set you, you need to turn the quota's on. To do
this use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&sektion=8&format=html">quotaon(8)</a>.
For example:
</p>

<ul>
<pre>
<strong>
# quotaon -a
</strong>
</pre>
</ul>

<p>
This will go thru /etc/fstab to turn on the filesystems with quota
options. Now that quota's are up and running, you can view them by
the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&sektion=1&format=html">quota(1)</a>.
Using a command of <strong>quota &lt user &gt</strong> will give that users
info. quota with no arguments will give your quota statistics. For
example:
</p>

<ul>
<pre>
<strong>
# quota ericj
</strong>
</pre>
</ul>

<p>
Will result in output similar to this:
</p>

<ul>
<strong>
<pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre>
</strong>
</ul>

<p>
By default quota's set in /etc/fstab will be started on boot. To turn them
of use <strong>quotaoff -a</strong>
</p>

<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq9.html">[To Section 9.0 - Migrating from Linux]</a>
<a href= "faq24.html">[To Section 11.0 - OpenBSD 2.4 Specific Information]</a>
</font>
</p>
<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq10.html,v 1.17 1999/06/25 18:41:16 ericj Exp $</small>
</p>
</body>
</html>

