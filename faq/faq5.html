<html>
<head>
<title>5.0 - Kernel configuration and Disk Setup</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="the main OpenBSD page">
<meta name="keywords" content="openbsd,main">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1998 by OpenBSD.">

</head>
<body bgcolor="#ffffff" text="#000000" link="#23238E">
<h1>5.0 - Kernel Configuration and Disk Setup</h1>
<p>
<a name="5.1"></a>
<h2>5.1 - Why would I want to create my own custom kernel?</h2>
<p>
	Its a joyous occasion when you as a user get to configure and
build your own custom kernel.  Why would you want to do this though? 
<p>
<ul>
<li>You can define which drivers your computer has support for.
<li>You can get rid of uneeded drivers in the GENERIC kernel
<li>Speed up boot times     
<li>Remove default options or add options which may not have been enabled by default
</ul>
<p>
<a name="5.2"></a>
<h2>5.2 - Kernel Configuration Options</h2>
<p>
Here are a list of most commonly used options in the kernel.
<p>
<strong>option COMPAT_SVR4</strong><br>
This options enables compatibilty with binaries created for AT&T
SYSV.4 UNIX on the same architecture.  The i386 and sparc are supported.
See the compat_svr4(8) manual page for more details.<p>
<strong>option COMPAT_BSDOS</strong><br>
This options enables compatibilty with BSD/OS binaries.  The
i386 architecture is supported. This also requires options COMPAT_43.  See
the compat_bsdos(8) manual page for more information.<p>
<strong>option COMPAT_43</strong>
<br>
This option enables compatibilty with 4.3BSD.  Use of this option
is discouraged because when invoked it adds old syscalls and ioctls,modifies the return values for getpid, getuid, and getgid as well as
enabling support for some older pre 4.4BSD socket calls. See the
options(4) manual page for more detailed information.<p>
<strong>option COMPAT_LINUX</strong><br>
This option enables compatibilty with Linux a.out and ELF
binaries.  The i386 architecture is supported. See the compat_linux(8)
manaul page for more details.
<p>
<strong>Debugging options</strong>
<p>
<strong>option DDB</strong>
<br>
This option will compile in a kernel debugger for diagnosing
kernel problems.  This option is not available for all architecutres.  See
the ddb(4) manual page for more details.<p>
<strong>option KTRACE</strong><br>
This option will add hooks for the system call tracing facility, which
will allow users to watch the system call invocation behavior or
processes. See ktrace(1) manual page for more details.<p>

<a name="5.3"></a>
<h2>5.3 - Building your own kernel </h2>
<p>
Full instructions for creating your own custom kernel are in the <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&manpath=OpenBSD+2.4&format=html">
afterboot(8)</a> man page. But for those who didnt install the man pages
the information will be included here. 
<p>
To compile your kernel from the cdrom do the following. <p>
<strong>
#cd /somewhere<br>
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE . <br>
#vi SOMEFILE </strong>(to make the changes you want)<br>
<strong>
#config -s /usr/src/sys -b . SOMEFILE <br>
#make <br>
<p>
To compile a kernel inside a writeable source tree do the following. <p>
<strong>
#cd /sys/arch/$ARCH/conf <br>
#vi SOMEFILE </strong>(to make any changes you want)<br>
<strong>
#config SOMEFILE</strong> (read more about it here : <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&manpath=OpenBSD+2.4&format=html">config(8)</a>)
<br>
<strong>
#cd ../compile/SOMEFILE<br>
#make 
</strong>
<p>
Where $ARCH is the architecture you are using (e.g. i386). You can also do
a <strong>make depend</strong> to make the dependencies for the next time
you compile your kernel.<p>
To move your kernel into place. <p>
<strong>
#cp /bsd /bsd.old<br>
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd
<strong>
<p>
To revert to your old kernel at boot you need to just <br>
<strong>
boot>bsd.old
</strong>
<br>
and your old kernel will be loaded instead of /bsd.
 <hr>
<a href=index.html><img height=24 width=24 src=../back.gif border=0 alt=OpenBSD></a> 
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br><small>$OpenBSD: faq5.html,v 1.6 1999/01/03 00:24:10 ericj Exp $</small>
</body>
</html>
