<html>
<head>
<title>5.0 - Kernel configuration and Disk Setup</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-1999 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq4.html">[To Section 4.0 - Installation and Disk Setup]</a>
<a href= "faq6.html">[To Section 6.0 - Networking]</a>
</font>
</p>

<p>
<h1>5.0 - Kernel Configuration and Disk Setup</h1>
</p>

<p>
<a name= "5.1"></a>
<h2>5.1 - Why would I want to create my own custom kernel?</h2>
</p>

<p>
Its a joyous occasion when you as a user get to configure and build your own
custom kernel. Why would you want to do this though? 
</p>

<p>
<ul>
    <li>You can define which drivers your computer has support for.</li>
    <li>You can get rid of uneeded drivers in the GENERIC kernel</li>
    <li>Speed up boot times</li>
    <li>Remove default options or add options which may not have been enabled
        by default</li>
</ul>
</p>

<p>
<a name= "5.2"></a>
<h2>5.2 - Kernel Configuration Options</h2>
</p>

<p>
Here are a list of most commonly used options in the kernel.
</p>

<p>
<strong>option COMPAT_SVR4</strong>
This options enables compatibilty with binaries created for AT&T SYSV.4 UNIX
on the same architecture.  The i386 and sparc are supported. See the
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&apropos=0&sektion=8&format=html">
compat_svr4(8)</a> manual page for more details.
</p>

<p>
<strong>option COMPAT_BSDOS</strong>
This options enables compatibilty with BSD/OS binaries. The i386 architecture
is supported. This also requires options COMPAT_43. See the
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&apropos=0&sektion=8&format=html">
compat_bsdos(8)</a> manual page for more information.
</p>

<p>
<strong>option COMPAT_43</strong>
This option enables compatibilty with 4.3BSD.  Use of this option is 
discouraged because when invoked it adds old syscalls and ioctls,modifies the
return values for getpid, getuid, and getgid as well as enabling support for
some older pre 4.4BSD socket calls. See the 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">
options(4)</a> manual page for more detailed information.
</p>

<p>
<strong>option COMPAT_LINUX</strong>
This option enables compatibilty with Linux a.out and ELF binaries. The i386
architecture is supported. See the
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&apropos=0&sektion=8&format=html">
compat_linux(8)</a> manaul page for more
details.
</p>

<p>
<strong>Debugging options:</strong>
</p>

<p>
<strong>option DDB</strong>
This option will compile in a kernel debugger for diagnosing kernel problems.
This option is not available for all architecutres. See the
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&apropos=0&sektion=4&format=html">
ddb(4)</a> manual page for more details.
</p>

<p>
<strong>option KTRACE</strong>
This option will add hooks for the system call tracing facility, which will 
allow users to watch the system call invocation behavior or processes. See
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&apropos=0&sektion=1&format=html">
ktrace(1)</a> manual page for more details.
</p>

<br>

<p>
<a name= "5.3"></a>
<h2>5.3 - Building your own kernel</h2>
</p>

<p>
Full instructions for creating your own custom kernel are in the
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html">
afterboot(8)</a> man page.
</p>

<p>
To compile your kernel from the cdrom do the following:
</p>

<p>
<pre>
#cd /somewhere
#cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .
#vi SOMEFILE (to make the changes you want)
#config -s /usr/src/sys -b . SOMEFILE
#make 
</pre>
</p>

<p>
To compile a kernel inside a writeable source tree do the following:
</p>

<p>
<pre>
#cd /sys/arch/$ARCH/conf
#vi SOMEFILE (to make any changes you want)
#config SOMEFILE (read more about it here : <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html">config(8)</a>)
#cd ../compile/SOMEFILE
#make 
</pre>
</p>

<p>
Where $ARCH is the architecture you are using (e.g. i386). You can also do
a <strong>make depend</strong> to make the dependencies for the next time
you compile your kernel.
</p>

<p>
To move your kernel into place.
</p>

<p>
<pre>
#cp /bsd /bsd.old
#cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd
</pre>
</p>

<p>
To revert to your old kernel at boot you need to just
</p>

<p>
<pre>
boot>bsd.old
</pre>
</p>

<p>
and your old kernel will be loaded instead of /bsd.
</p>

<p>
<a name="5.4"></a> 
<h2>5.4 - Boot Time Configuration </h2>
</p>

<p>
Sometimes when booting your system you might notice that the kernel finds
your device but maybe at the wrong IRQ. And maybe you need to use this
device right away. Well, without rebuilding the kernel you can use
OpenBSD's boot time kernel configuration. This will only correct your
problem for one time. If you reboot, you will have to repeat this
procedure. So, this is only meant as a temporary fix, and you should
correct the problem by fixing and recompiling your kernel.
</p>

<p>
Most of this document can be found in the man page
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html">boot_config(8)</a>
</p>

To boot into the User Kernel Config, or UKC, at boot time us the -c
option.

<p><pre>
Boot> boot wd0a:/bsd -c
</pre></p>

<p>
Or whichever kernel it is you want to boot. Doing this will bring up a
UKC prompt. From here you can issue commands directly to the kernel
specifying devices you want to change or disable or even enable.
</p>

<p>
Here is a list of common commands in the UKC.
</p>

<p>
<CODE>add <strong>device</strong> - Add a device through copying another
</p>

<p>
change <strong>devno | device </strong> - Modify one or more devices
</p>

<p>
disable <strong>devno | device </strong> - Disable one or more devices 
</p>

<p>
enable <strong>devno | device </strong> - Enable one or more devices 
</p>

<p>
find <strong>devno | device </strong> - Find one or more devices
</p>

<p>
help - Short summary of these commands
</p>

<p>
list - List ALL known devices
</p>

<p>
exit/quit - Continue Booting
</p>

<p>
show <strong>[attr [val]]</strong> - Show devices with an attribute and optional with a specified value
</p></CODE>

<p>
Once you get your device configured, use quit or exit and continue
booting. After so you should correct your Kernel configuration and Compile
a new kernel. Refer to <a href="faq5.html#5.3">Building your own
kernel</a> for help.
</p>

<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq4.html">[To Section 4.0 - Installation and Disk Setup]</a>
<a href= "faq6.html">[To Section 6.0 - Networking]</a>
</font>
</p>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt= "[back]"></a> 
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq5.html,v 1.11 1999/03/14 19:19:19 ericj Exp $</small>
</p>
</body>
</html>
