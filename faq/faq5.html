<html>
<head>
<title>5.0 - Kernel configuration</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2000 by OpenBSD.">
</head>

<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">

<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif">
<p>
<h2><font color=#e00000>5.0 - Kernel configuration</font><hr></h2>
</p>

<p>
<ul><h3>Table of Contents</h3>
<li><a href= "faq5.html#5.1">5.1 - Why do I need a custom kernel?</a></li>
<li><a href= "faq5.html#5.2">5.2 - Kernel configuration Options</a></li>
<li><a href= "faq5.html#5.3">5.3 - Building your own kernel</a></li>
<li><a href= "faq5.html#5.4">5.4 - Boot-time configuration</a></li>
<li><a href= "faq5.html#5.5">5.5 - Getting more verbose output during boot</a></li>
<li><a href= "faq5.html#5.6">5.6 - Using config(8) to change your kernel binary</a>
</ul>
</p>
<hr>
<br>

<p>
<a name= "5.1"></a>
<h2>5.1 - Why would I want to create my own custom kernel?</h2>
</p>

<p>
Several reasons, although this practice is generally geared towards
knowledgeable users who have a good overall understanding of the system.

<ul>
    <li>Your computer has a very small amount of RAM and you want to preserve 
        as much as possible by removing device drivers you don't use
    <li>Remove default options or add options which may not have been enabled
        by default
    <li>Enable experimental options
    
</ul>
</p>
<p>
Under most circumstances you will NOT need to compile your own kernel. The
GENERIC kernel will usually be all that you need.  In fact, there are several reasons
why you do not want to create your own kernel.  The main reason is that it is
very easy to make
changes to the kernel configuration which look logical, but do not work.
This is your danger sign.  If something does not appear to work properly,
please try the GENERIC kernel before sending in a bug report.  
</p>

<p>
<a name= "5.2"></a>
<h2>5.2 - Kernel Configuration Options</h2>
</p>

<p>
Kernel Configuration Options are options that you add to your kernel
configuration that place certain features into your kernel. This allows
you to have exactly the support you want, without having support for
unneeded devices. There are multitudes of options that allow you to
customize your kernel. Here we will go over only some of them, those that
are most commonly used. Check the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=4&format=html">options(4)</a>
man page for a more complete list of options. You can also check the
example configuration files that are available for your architecture.
</p>

<P>
Not all kernel options have been tested for compatibility with
all other options.  Don't put an option in your kernel unless you
actually have a reason to do so!  The one kernel configuration which
gets the most testing is the GENERIC kernel.  This is usually a
combination of the options in /usr/src/sys/arch/&lt;your arch&gt;/conf/GENERIC
and /usr/src/sys/conf/GENERIC. 
</P>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Alpha Kernel Conf Files </a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">i386 Kernel Configuration files</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/mac68k/conf/">mac68k Kernel Configuration files</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/pmax/conf/">pmax Kernel Configuration Files</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">sparc Kernel Configuration Files</a></li>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Other Arch's</a></li>
</ul>
</p>

<p>
Look closely at these files and you will notice a line like:<br>
<strong>include "../../../conf/GENERIC"</strong><br>
This means that it is referencing yet another configuration file. This
file stores non arch-dependent options. So when creating your Kernel
Config be sure to look through <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">/sys/conf/GENERIC</a> 
and see what you want. There ARE options in there that are NEEDED.
</p>

<p>
All of the options listed below should be placed in your kernel configuration file in the format of:<br>
<strong>option      OPTION</strong><br>
for example. To place option debug in the kernel, add a line like this:<br>
<strong>option	    DEBUG</strong><br>
Options in the OpenBSD kernel are translated into compiler preprocessor options, therefore an option like DEBUG would have the
source compiled with option -DDEBUG. Which is equivalent to doing a #define DEBUG throughout the kernel.
</p>

<p>
OpenBSD has a great many compatibility options which allow you to use binaries from other OS's.
Not all are availably on every architecture, so be sure to read the man pages for each option to 
see if your arch is supported.
</p>
<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_svr4&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SVR4(8)</a> - Compatibility with SVR4 binaries.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_bsdos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_BSDOS(8)</a> - Compatibility with BSD/OS binaries.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_linux&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_LINUX(8)</a> - Compatibility with Linux binaries.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_sunos&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_SUNOS(8)</a> - Compatibility with SunOS binaries.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ultrix&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_ULTRIX(8)</a> - Compatibility with Ultrix binaries.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_freebsd&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_FREEBSD(8)</a> - Compatibility with FreeBSD binaries.</li>
<li>COMPAT_HPUX - Compatibility with HP-UX binaries. Only available on some m68k arch's.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=compat_ibcs2&sektion=8&apropos=0&manpath=OpenBSD+Current">COMPAT_IBCS2(8)</a> - Compatibility to run ibcs2 binaries.</li>
<li>COMPAT_OSF1 - Run Digital Unix binaries. Available only on Alpha platform.</li>
<li>COMPAT_43 - Compatibility with 4.3BSD. Use of this is certainly discouraged, But it is needed for our Navigator port</li>
<li>COMPAT_11 - Compatibility with NetBSD 1.1</li>
<li>COMPAT_NOMID - Compatibility with a.out executables that lack a machine id.
</ul>
</p>

<p>
It is always helpful to be able to debug problems with the kernel. But many choose not to put these options in their kernel
because these options add considerable size to the kernel. They are however extremely helpful in a case where a bug might be
present. This well help the developers discover the source of your problems much quicker. Here is a list of popular
debugging options that can be added to your kernel.
</p>

<p>
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ddb&sektion=4&format=html">DDB</a> - This compiles in the in-kernel debugger. This isn't available on all platforms. So be sure to read before adding it.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gdb&sektion=1&format=html">KGDB</a> - Compiles a remote kernel debugger using gdb's `remote target` feature.</li>
<li>makeoptions  DEBUG="-g" - Makes bsd.gdb along with bsd. This is useful for debugging crash dumps with gdb. </li>
<li>DEBUG - Used to put various debugging options in the kernel, where the source has defined them.</li>
<li>KTRACE - Adds hooks for the system call tracing facility. Which allows users to use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ktrace&sektion=1&format=html">ktrace(1)</a>.</li>
<li>DIAGNOSTIC - Adds code to the kernel that does internal consistency checks.</li>
<li>GPROF - adds code to the kernel for kernel profiling with <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kgmon&sektion=8&format=html">kgmon(8)</a>.</li>
<li>makeoptions PROF="-pg" - The -pg flag causes the kernel to be compiled with support for profiling. Option GPROF is required to use this option.</li>
</ul>
</p>

<p>
<strong>Filesystem Options.</strong>
<ul>
<li>FFS - Berkeley Fast Filesystem <strong>NOTE:</strong> This option is required</li>
<li>EXT2FS - Second Extended File System, This is needed for those of you who want to read Linux partitions.</li>
<li>MFS - Memory File System that stores files in swapable memory.</li>
<li>NFS - Network File System, This is needed if you will be using NFS.</li>
<li>CD9660 - This is iso9660 + rockridge filesystem. This is required to read from cd's</li>
<li>MSDOSFS - Needed to read MS-DOS FAT filesystems. Also has support for Windows 95 long name + mixed case extensions.</li>
<li>FDESC - Includes code for a file system which can be mounted on /dev/fd</li>
<li>KERNFS - Includes code which permits the mounting of a special file system (normally mounted on /kern) in which files representing various kernel variables and parameters may be found.</li>
<li>NULLFS - Code to have a loopback filesystem. <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_null&sektion=8&format=html">mount_null(8)</a> has more information</li>
<li>PROCFS - Includes code for a special file system (conventionally mounted on /proc)</li>
<li>PORTAL - Includes the (experimental) portal filesystem.  This permits interesting tricks like opening TCP sockets by opening files in the file system.</li>
<li>UMAPFS - Includes a loopback file system in which user and group ids may be remapped -- this can be useful when mounting alien file systems with different uids and gids than the local system (eg, remote NFS).</li>
<li>UNION - Includes code for the union file system, which permits directories to be mounted on top of each other in such a way that both file systems remain visible. This code isn't quite stable yet.</li>
<li>XFS - Add hooks for using a filesystem that is compatible with the AFS filesystem. Currently used by the Arla/AFS code.  </li>
<li>LFS - Log Structured Filesystem.</li>
<li>FFS_SOFTUPDATES - Allows for the use of softupdates. To read up on softupdates more read the <a href="faq14.html#14.5">Softupdates FAQ</a> section.
<li>NFSSERVER - Allow for the server-side NFS code to be included in the kernel.</li>
<li>NFSCLIENT - Allow for the client-side NFS code to be included in the kernel.</li>
<li>FIFO - Support for FIFO's.. RECOMMENDED.</li>
<li>NVNODE=integer - Where integer is the size of the cache used by the name-to-inode translation routines, (a.k.a. the namei() cache, though called by many other names in the kernel source).</li>
<li>EXT2FS_SYSTEM_FLAG - This option changes the behavior of the APPEND and IMMUTABLE flags for a file on an EXT2FS filesystem. Read <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a> for more details.</li>
<li>QUOTA - Support for Filesystem Quota's. To read up on using quotas read <a href="faq10.html#10.10">FAQ 10</a></li>
</ul>
</p>

<p>
<strong>Misc. Options</strong>
<ul>
<li>PCIVERBOSE - Make the boot process more verbose for PCI peripherals.</li>
<li>EISAVERBOSE - Make the boot process more verbose for EISA peripherals.</li>
<li>PCMCIAVERBOSE - Make the boot process more verbose for PCMCIA peripherals.</li>
<li>APERTURE - Provide in-kernel support for VGA framebuffer mapping by user processes. Needed to run X.</li>
<li>XSERVER - Support for the X server console driver. Needed for X.</li>
<li>LKM - Support for Loadable Kernel Modules. Not available on all arch's. Read <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lkm&sektion=4&format=html">lkm(4)</a> for more information.</li>
<li>INSECURE - Hardwires the kernel security level to -1. Read <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&sektion=8&format=html">init(8)</a> for more information on kernel security levels.</li>
<li>MACHINE_NONCONTIG - Changes part of the VM/pmap interface, to allow for non-contiguous memory.</li>
<li>RAM_DISK_HOOKS - Allows for machine dependent functions to be called when the ramdisk driver is configured.</li>
<li>RAM_DISK_IS_ROOT - Forces the ramdisk to be root.</li>
<li>CCDNBUF=integer - Set number of component buffers used by CCD(4). Default is 8. For more on CCD read the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ccd&sektion=4&format=html">CCD(4)</a> man page, or the <a href="faq11.html#11.2">Performance Tuning FAQ section.</a></li>
<li>KMEMSTATS - This makes malloc(9), the kernel memory allocator keep statistics on its use. If option DEBUG is used, this option is automatically turned on by config. </li>
<li>BOOT_CONFIG - Adds support of the -c boot option.</li>
</ul>
</p>

<p>
<strong>Networking Options</strong><br>
Also check the <a href="faq6.html">Networking FAQ</a> or the <a href="faq11.html#11.1">Networking Performance Tuning FAQ</a>.
<ul>
<li>GATEWAY - Enables IPFORWARDING and (on most ports) increases the size of NMBCLUSTERS.</li>
<li>NMBCLUSTERS=integer - Controls the size mbuf cluster map. </li>
<li>IPFORWARDING - Enables IP routing behavior.  With this option enabled, the machine will forward IP datagrams between its interfaces that are destined for other machines.</li>
<li>MROUTING - Includes support for IP multicast routers.</li>
<li>INET - Includes support for the TCP/IP protocol stack. This option is REQUIRED</li>
<li>MCLSHIFT=value - This option is the base-2 logarithm of the size of mbuf clusters. Read <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4&format=html">options(4)</a> for more information on this option.</li>
<li>NS - Include support for the Xerox XNS protocol stack.  See <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ns&sektion=4&apropos=0&manpath=OpenBSD+Current">ns(4)</a></li>
<li>ISO,TPIP - Include support for the ubiquitous OSI protocol stack. See <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=iso&sektion=4&format=html">iso(4)</a> for more information.</li>
<li>EON - Include support for OSI tunneling over IP.</li>
<li>CCITT,LLC,HDLC - Include support for the X.25 protocol stack.</li>
<li>IPX, IPXIP - Include support for Internetwork Packet Exchange protocol commonly in use by Novell NetWare.</li>
<li>NETATALK - Include kernel support for the AppleTalk family of protocols.</li>
<li>TCP_COMPAT_42 - Use of this option is extremely discouraged, so it should not be enabled. TCP bug compatibility with 4.2BSD. In 4.2BSD, TCP sequence numbers were 32-bit signed values.  Modern implementations of TCP use unsigned values.</li>
<li>TCP_NEWRENO - Turns on NewReno fast recovery phase, which allows one lost segment to be recovered per round trip time.</li>
<li>TCP_SACK - Turns on selective acknowledgements.</li>
<li>TCP_FACK - Turns on forward acknowledgements allowing a more precise estimate of outstanding data during the fast recovery phase by using SACK information. This option can be used together with TCP_SACK.</li>
<li>IPFILTER - This option enables the IP filtering on the packet level using the ipfilter package.</li>
<li>IPFILTER_LOG - This option, in conjunction with IPFILTER, enables logging of IP packets using ip-filter.</li>
<li>IPFILTER_DEFAULT_BLOCK - This option sets the default policy of ip-filter. If it is set, ip-filter will block packets by default.</li>
<li>PPP_FILTER - This option turns on <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pcap&sektion=3&format=html">pcap(3)</a> based filtering for ppp connections.</li>
<li>PPP_BSDCOMP - PPP BSD compression.</li>
<li>PPP_DEFLATE - Used in conjunction with PPP_BSDCOMP.
<li>IPSEC - This option enables IP security protocol support. See <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&sektion=4&format=html">ipsec(4)</a> for more details. This now implies option KEY, which gives support for PFKEYv2.</li> 
<li>ENCDEBUG - This option enables debugging information to be conditionally logged in case IPSEC encounters errors.</li>
<li>TCP_SIGNATURE - TCP MD5 Signatures, for BGP routing sessions</li>
</ul>
</p>

<p>
<strong>PCVT Options</strong> (<i>only valid on i386 architecture</i>)
<ul>
<li>PCVT_NSCREENS=integer - Number of pcvt screens. Defaults to 8.</li>
<li>PCVT_VT220KEYB - If activated, a keyboard layout resembling a DEC VT200 (TM) is generated.</li>
<li>PCVT_SCREENSAVER - Enables the builtin screensaver feature. Defaults to on.</li>
<li>PCVT_PRETTYSCRNS - If enabled, a blinking-star screensaver is used. Default is off.</li>
<li>PCVT_CTRL_ALT_DEL - If enabled, the key combination &lt;Ctrl&gt; &lt;Alt&gt; &lt;Del&gt; invokes a CPU reset. Default is off.</li>
<li>PCVT_USEKBDSEC - Do NOT override a security lock for the keyboard. Default is on.</li>
<li>PCVT_24LINESDEF - If enabled, the 25-line mode (VT emulation with 25 lines, and HP emulation with 28 lines) default to 24 lines only to provide a better compatibility to the original DEC VT220 (TM).</li>
<li>PCVT_EMU_MOUSE - Emulate a three-button mouse via the keypad. Useful for notebooks when running XFree86. Defaults to off</li>
<li>PCVT_META_ESC - If enabled, a sequence composed of &lt;esc&gt;, followed by the normal key code is emitted if a key is pressed with the &lt;Alt&gt; key modifier. If disabled, then normal key code with the value 0x80 added is sent. Defaults to off.</li>
</ul>
</p>

<p>
<strong>SCSI Subsystem Options</strong>
<ul>
<li>SCSITERSE - Terser SCSI error messages.  This omits the table for decoding ASC/ASCQ info, saving about 8 bytes or so.</li>
<li>SCSIDEBUG - Prints extra debugging info for the SCSI subsystem to the console.</li>
</ul>
</p>


<p> <a name= "5.3"></a>
<h2>5.3 - Building your own kernel</h2>
</p>

<p>
Full instructions for creating your own custom kernel are in the
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&apropos=0&sektion=8&format=html">
afterboot(8)</a> man page.
</p>

<p>
To compile your kernel from the cdrom you need to first have the source
code available. You just need the kernel source to be able to compile the
kernel, and this source code is available on the cd. Here is how to copy
the sources from the cd. This example assumes that CD1 is mounted on /mnt.
</p>

<ul>
<pre>
# <strong>mkdir -p /usr/src/sys</strong>
# <strong>cd /mnt/sys</strong>
# <strong>tar cf - . | ( cd /usr/src/sys; tar xvf - )</strong>
</pre>
</ul>

<p>
Now to create your custom kernel it is easiest to start with the GENERIC
kernel. This is located at <i>/usr/src/sys/arch/${arch}/conf/GENERIC</i>,
where ${arch} is your architecture. There are other sample configurations
available in that directory as well. Here are two examples for compiling
your kernel. The first example is compiling your kernel on a read-only
source tree. The second on a writable source tree.
</p>

<ul> 
<pre>
# <strong>cd /somewhere</strong>
# <strong>cp /usr/src/sys/arch/$ARCH/conf/SOMEFILE .</strong>
# <strong>vi SOMEFILE</strong> (to make the changes you want)
# <strong>config -s /usr/src/sys -b . SOMEFILE</strong>
<ul>
# <strong>make depend</strong> 
<ul>
(The above step is necessary when you have made any changes [including updates
and patches] to your kernel source tree.  This step can be ignored
if you follow the next step.)
</ul>
<font size="+1">
<b><i>OR</i></b>
</font>
# <strong>make clean</strong>
<ul>
(The above step is necessary if you make changes to your kernel configuration
options, and is also recommended if you make major updates to your source tree.
You can ignore this step otherwise, and just use 'make depend'.)
</ul>
</ul>
# <strong>make</strong>
</pre>
</ul>

<p>
To compile a kernel inside a writable source tree do the following:
</p>

<ul>
<pre>
# <strong>cd /sys/arch/$ARCH/conf</strong>
# <strong>vi SOMEFILE</strong> (to make any changes you want)
# <strong>config SOMEFILE</strong> (read more about it here : <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=8&format=html">config(8)</a>)
# <strong>cd ../compile/SOMEFILE</strong>
# <strong>make</strong> 
</pre>
</ul>

<p>
Where $ARCH is the architecture you are using (e.g. i386). You can also do
a <strong>make depend</strong> to make the dependencies for the next time
you compile your kernel.
</p>

<p>
To move your kernel into place.
</p>

<ul>
<pre>
# <strong>cp /bsd /bsd.old</strong>
# <strong>cp /sys/arch/$ARCH/compile/SOMEFILE/bsd /bsd</strong>
</pre>
</ul>

<p>
To revert to your old kernel at boot you need to just
</p>

<ul>
<pre>
boot> <strong>bsd.old</strong>
</pre>
</ul>

<p>
and your old kernel will be loaded instead of /bsd.
</p>

<p>
Sometimes when you build a new kernel you will be required to install new bootblocks. To do so, read <a href="faq14.html#14.8">
faq14.8 on OpenBSD's Bootloader</a>. Which will give you an overview on using OpenBSD's Bootloader
</p>

<p>
<a name="5.4"></a> 
<h2>5.4 - Boot Time Configuration </h2>
</p>

<p>
Sometimes when booting your system you might notice that the kernel finds
your device but maybe at the wrong IRQ. And maybe you need to use this
device right away. Well, without rebuilding the kernel you can use
OpenBSD's boot time kernel configuration. This will only correct your
problem for one time. If you reboot, you will have to repeat this
procedure. So, this is only meant as a temporary fix, and you should
correct the problem by fixing and recompiling your kernel. Your kernel
does however need <strong>option BOOT_CONFIG</strong> in the kernel, which 
GENERIC does have.
</p>

<p>
Most of this document can be found in the man page
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&apropos=0&sektion=8&format=html">boot_config(8)</a>
</p>

To boot into the User Kernel Config, or UKC, at boot time us the -c
option.

<ul><pre>
boot> <strong>boot wd0a:/bsd -c</strong>
</pre></ul>

<p>
Or whichever kernel it is you want to boot. Doing this will bring up a
UKC prompt. From here you can issue commands directly to the kernel
specifying devices you want to change or disable or even enable.
</p>

<p>
Here is a list of common commands in the UKC.
</p>

<CODE>
<p>
add <strong>device</strong> - Add a device through copying another
</p>

<p>
change <strong>devno | device </strong> - Modify one or more devices
</p>

<p>
disable <strong>devno | device </strong> - Disable one or more devices 
</p>

<p>
enable <strong>devno | device </strong> - Enable one or more devices 
</p>

<p>
find <strong>devno | device </strong> - Find one or more devices
</p>

<p>
help - Short summary of these commands
</p>

<p>
list - List ALL known devices
</p>

<p>
exit/quit - Continue Booting
</p>

<p>
show <strong>[attr [val]]</strong> - Show devices with an attribute and optional with a specified value
</p></CODE>

<p>
Once you get your device configured, use quit or exit and continue
booting. After doing so you should correct your Kernel configuration and Compile
a new kernel. Refer to <a href="faq5.html#5.3">Building your own
kernel</a> for help.
</p>

<a name="5.5"></a>
<h2>5.5 - Getting more verbose output during boot</h2>


<p>
Getting more verbose output can be very helpful when trying to debug problems when booting.
If you have a problem wherein your boot floppy won't boot and need to get more information, 
simply reboot. When you get to the &quot;boot>&quot; prompt, boot with boot -c. This will bring you into the
UKC>, then do:
</p>


<ul><pre>
UKC> <strong>verbose</strong>
autoconf verbose enabled
UKC> <strong>quit</strong>
</pre></ul>

<p>
Now you will be given extremely verbose output upon boot.
</p>

<a name="5.6"></a>
<h2>5.6 - Using config(8) to change your kernel</h2>

<p>
With 2.6 came the introduction of the <b>-e</b> and <b>-u</b> options with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>.
These options can be extremely helpful and save wasted time compiling your
kernel. The <b>-e</b> flag allows you to enter the UKC or User Kernel
Config on a running system. These changes will then take place on your
next reboot. The <b>-u</b> flag tests to see if any changes were made to
the running kernel during boot. Meaning you used <b>boot -c</b> to enter
the UKC while booting your system.
</p>

<p>
The following example shows the disabling of the ep* devices from the
kernel. For safety's sake you must use the
<b>-o</b> option which writes the changes out to the file specified. For
example : <strong>config -e -o bsd.new /bsd</strong> will write the
changes to bsd.new. The example doesn't use the <b>-o</b> option,
therefore changes are just ignored, and not written back to the kernel
binary. For more information pertaining to error and warning messages read
the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&sektion=8&format=html">config(8)</a>
man page.
</p>

<ul><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc> <strong>?</strong>
        help                            Command help list
        add     dev                     Add a device
        base    8|10|16                 Base on large numbers
        change  devno|dev               Change device
        disable attr val|devno|dev      Disable device
        enable  attr val|devno|dev      Enable device
        find    devno|dev               Find device
        list                            List configuration
        lines   count                   # of lines per page
        show    [attr [val]]            Show attribute
        exit                            Exit, without saving changes
        quit                            Quit, saving current changes
ukc> <strong>list</strong>
  0 audio* at sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|eso*|sv*
  1 midi* at sb0|sb*|opl*|opl*|opl*|ym*|mpu*
  2 nsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  3 inphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  4 iophy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  5 exphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  6 rlphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  7 icsphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  8 sqphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
  9 ukphy* at xe*|ef*|sf*|xl*|tl*|rl*|fxp* phy -1
 10 scsibus* at bt0|bt1|bt2|aha0|aha1|aha*|ahb*|ahc0|ahc*|ahc*|isp*|aic0|aic*|ncr*|adv*|adw*|sea0|uha0|uha1|uha*|wds0|atapiscsi*
 11 cd* at scsibus* target -1 lun -1
 12 ch* at scsibus* target -1 lun -1
 13 sd* at scsibus* target -1 lun -1
 14 st* at scsibus* target -1 lun -1
 15 ss* at scsibus* target -1 lun -1
 16 uk* at scsibus* target -1 lun -1
 17 atapiscsi* at wdc0|wdc1|wdc*|wdc*|pciide* channel -1
--- more ---   
[snip]
ukc> <strong>disable ep</strong>
 31 ep0 disabled
 32 ep* disabled
 33 ep* disabled
 87 ep0 disabled
 88 ep0 disabled
 89 ep* disabled
 90 ep* disabled
136 ep* disabled
ukc> <strong>quit</strong>
not forced
</pre></ul>

<p>
In the above example, all ep* devices are removed from the kernel and will
not be probed. In some situations where you have used the UKC during boot,
via <b>boot -c</b>, you will need these changes to be written out
permanently. To do this you need to use the <b>-u</b> option.
In the following example, the computer was booted into the UKC and the
wi(4) device was disabled. Since changes made with boot -c are NOT
permanent, these changes must be written out. This example writes the
changes made from boot -c into a new kernel binary bsd.new.
</p>

<ul><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 2.6 (GENERIC) #1: Tue Nov 16 21:25:10 EST 1999
    ericj@oshibana:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
151 wi* disabled
Enter 'help' for information
ukc> <strong>quit</strong>
</pre></ul>


<p>
<font color= "#0000e0">
<a href= "index.html">[Back to Main Index]</a>
<a href= "faq4.html">[To Section 4.0 - Installation Guide]</a>
<a href= "faq6.html">[To Section 6.0 - Networking]</a>
</font>
</p>

<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../images/back.gif" border= "0" alt= "[back]"></a> 
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>$OpenBSD: faq5.html,v 1.47 2001/03/26 17:14:10 todd Exp $</small>
</body>
</html>
