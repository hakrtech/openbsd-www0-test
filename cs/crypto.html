<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict Level 2//EN//2.0">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>Kryptografie v OpenBSD</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="Kryptografie OpenBSD">
<meta name="keywords" content="openbsd,cryptography,openssh,openssl,kerberos">
<meta name="keywords" content="ipsec,photuris,isakmp,ike,blowfish,des,rsa,dsa">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1997 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">
<img align=left alt="[OpenBSD]" height=166 width=197 SRC="../images//blowfish-notext.jpg">
<br>
<br>
<br>
"Mantrou ka¾dého dobrého odborníka na poèítaèovou bezpeènost je úsloví:
"Bezpeènost není produkt, ale proces." Bezpeènost je toti¾ více ne¾ jen implementace silné kryptografie do systému. Bezpeènost znamená návrhnout celý systém tak, aby v¹echny jeho èásti vèetnì kryptografie pracovaly dohromady."<br>
<br>
-- Bruce Schneier, autor knihy "Aplikovaná Kryptografie".
<br clear=all>
<h2><font color=#e00000>Kryptografie</font><hr></h2>

<strong>Obsah</strong><br>
<a href=#why>Proè dodáváme kryptografii?</a>.<br> 
<a href=#ssh>OpenSSH</a>.<br> 
<a href=#prng>Generátor pseudonáhodných èísel</a> (PRNG): ARC4, ...<br>
<a href=#hash>Kryptografické hashovací funkce</a>: MD5, SHA1, ...<br>
<a href=#trans>Kryptografické algoritmy</a>: DES, Blowfish, ...<br>
<a href=#hardware>Podpora kryptografického hardware</a><br>
<a href=#people>Sháníme mezinárodní kryptoanalytiky</a><br>
<a href=#papers>Dal¹í zdroje</a><br>
<p>
<hr>

<a name=why></a>
<h3><font color=#e00000>Proè dodáváme kryptografii?</font></h3><p>

Dvìma slovy:  <strong>proto¾e mù¾eme</strong>.<p>

Projekt OpenBSD je vyvíjen v Kanadì.<p>

<a href=../ECL.html>Seznam exportních omezení v Kanadì</a> nijak výraznì neomezuje export kryptografie a dokonce výslovnì povoluje volný export kryptograckého software. Marc Plumb zpracoval toto téma na <a href=http://insight.mcmaster.ca/org/efc/pages/doc/crypto-export.html>své stránce</a>.
<p>

Z tohoto dùvodu je kryptografie zahrnuta do mnoha èástí opraèního systému. Kryptografický software, který pou¾íváme je <a href=policy.html>volnì dostupný a distribuovaný pod pøijatelnými licensemi</a>. Nepou¾íváme kryptografii, na ní¾ se vztahují patenty. Zároveò pou¾íváme software ze zemí, dovolujích export kryptografie, abychom neporu¹ovali exportní zákony. Jednotlivé èásti kryptografického software byly napsány v Argentinì, Austrálii, Kanadì, Nìmecku, Øecku, Norsku a ©védsku.
<p>

Kdy¾ vydáváme release nebo snapshot OpenBSD, v¾dy jej vytváøíme v zemi, její¾ zákony umo¾òují kryptografický export, abychom na¹im u¾ivatelùm umo¾nili volný pøístup ke zdrojovým kódùm a binárkám. V minulosti byl pøeklad release proveden v Kanadì, ©védsku a Nìmecku.<p>

OpenBSD je dodáváno se systémem Kerberos IV. Zdrojový kód, který pou¾íváme je exportní verze KTH ze ©védska. Zdrojový kód na¹ich X11 byl také roz¹íøen o podporu Kerberos IV.  Podpora Kerberos V by se mìla objevit nìkdy v roce 2000 (jak vidno, zatím se neobjevila - pozn. pøekl.), proto¾e zatím jeho volnì ¹iøitelná verze neexistuje.<p>


<img align=right src="../images/vpnc-test-partner.gif">
OpenBSD bylo prvním operaèním systémem, dodávaným s IPSEC stackem. Podpora IPSEC je v OpenBSD ji¾ od verze 2.1, vydané v roce 1997. IPSEC podporuje hardwarovou akceleraci, poskytovanou sí»ovými kartami a ná¹ ISAKMP daemon je pou¾íván pro jeden z testovacích strojù <a href="http://www.vpnc.org">VPNC</a>.
<br clear=all>
<p>

V souèasnosti má kryptografie znaèný vliv na zvý¹ení <a
href=security.html>bezpeènosti</a> operaèního systému. Jednotlivé prvky kryptografické podpory v OpenBSD jsou popsány ní¾e.<p>

<a name=ssh></a>
<h3><font color=#e00000>OpenSSH</font></h3><p>

Co je prvním krokem vìt¹iny lidí po instalaci OpenBSD? Instalace Secure Shellu
(<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ssh>ssh</a>) ze stromu portù nebo balíku z FTP. Tedy a¾ doteï.<p>

Od verze 2.6 obsahuje OpenBSD <a href="http://www.openssh.com/">OpenSSH</a>, absolutnì bezplatnou a bezpatentní verzi ssh. Od OpenBSD 2.6 podporuje <a href="http://www.openssh.com/">OpenSSH</a> ssh verze 1 a obsahuje øadu dal¹ích vlastností:	
<ul>
<li>
V¹echny prvky omezujícího charakteru (napø. patenty, viz. <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ssl>ssl</a>))
byly z kódu vyøazeny a v¹echny èásti podléhající licencím nebo pantentùm byly pøevedeny do externích knihoven.
</li>
<li>
pøibyla podpora ssh protokolu 1.5.
</li>
<li>
pøibyla podpora autentifikace pøes <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=kerberos>kerberos</a>
a ticket passing.
</li>
<li>
pøibyla podpora jednorázových hesel pøes <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=skey>skey</a>.
</li>
</ul>
<p>

Struène (a jasnì) øeèeno jsme vzali ssh a OpenBSDfikovali jsme jej. 
Poskytli jsme jednoduchou cestu k automatickému downloadu a instalaci balíku s podporou RSA, který obsahuje sdílené knihovny libcrypto a libssl. Tyto balíky jsou zalo¾eny na OpenSSL. Lidé mimo USA tak mohou pou¾ívat patentovaný kód RSA bez omezení a lidé v USA jej mohou zdarma pou¾ívat pro nekomerèní úèely.<p>

Tímto mù¾e kdokoliv získat ssh do svého operaèního systému.<p>

<strong>OpenSSH novì podporuje i protokol 2.0!</strong><p>

Novì jsme roz¹íøili OpenSSH o podporu protokolu SSH 2. Ssh démon teï podporuje v¹echny 3 hlavní SSH protokoly (1.3, 1.5, 2.0). Protokol 2.0 navíc ji¾ nepou¾ívá RSA pro svùj veøejný klíè, jeho¾ funkci nahrazují algoritmy DH a DSA. V OpenBSD 2.7, které obsahuje novou verzi OpenSSH, je tak podpora protokolu 2.0 ihned po instalaci. V pøípadì, ¾e v této verzi stále potøebujete podporu protokolu 1.3 nebo 1.5, jednoduše pøidejte balík RSA (popsáno v manuálové stánce k <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ssl>ssl</a>) a restartujte démona.

<a name=prng></a>
<h3><font color=#e00000>Generátory pseudonáhodných èísel</font></h3><p>

Generátor pseudonáhodných èísel (PRNG) poskytuje proud èísel, která mají velký význam pro systémovou bezpeènost a musí splòovat nìkolik podmínek:<p>

<ul>
<li>Pro útoèníka by mìlo být nemo¾né pøedpovìdìt výstup z generátoru, i kdy¾ zná jeho pøedchozí výstup.
<li>Skupiny generovaných èísel by se nemìly opakovat, tzn. generátor by mìl mít cykly s VELMI dlouhou periodou.
</ul>
<p>

PRNG je obvykle pouze algoritmus, kde se náhodná vstupní data objeví ve stejné formì na výstupu. V multiuživatelském prostøedí je mnoho zdrojù náhodných dat pro zásobování PRNG. Kernel OpenBSD používá pro tuto entropii èasování pøerušení myši, latenci pøerušení ze sítì, prodlevy mezi stisky kláves a diskové IO. Náhodná èísla jsou potom užívána pro rutiny kernelu a pøes soubory /dev/ jsou dostupná programùm v userlandu. Konkrétní aplikace:<p>

<ul>
<li>Dynamická alokace sin_port v systémovém volání bind(2).
<li>PID procesù.
<li>RPC transaction IDs (XID).
<li>NFS RPC transaction IDs (XID).
<li>Query-ID v DNS.
<li>DNS Query-IDs.
<li>Èisla inode, viz. getfh(2) a fsirand(8).
<li>Èasování v traceroute(8).
<li>Silnìj¹í (náhodnìj¹í) jména doèasných souborù ve funkcích mktemp(3) a mkstemp(3).
<li>Náhodná hodnota ISS v TCP jako ochrana proti spoofingu.
<li>Náhodné doplòování (padding) v paketech IPSEC esp_old.
<li>Generování salt v algoritmech pro uchovávání hesel.
<li>Pro generování fake S/Key.
<li>V <a href=http://www.physnet.uni-hamburg.de/provos/photuris/>photurisd</a> a <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd>isakmpd</a> pøi výmìnì klíèù.
</ul>

<p>
<a name=hash></a>
<h3><font color=#e00000>Kryptografické hashovací funkce</font></h3><p>

Hashovací funkce vezme vstupní data libovolné délky a "zkomprimuje" je do výstupního øetìzce konstantní délky. Pro tuto funkci by mìlo být nemo¾né:

<ul>
<li>najít 2 rùzná vstupní data, která mají po aplikaci algoritmu stejný výstup (odolnost proti kolizi),
<li>odli¹ný vstup pro dané stejné výstupy
	(rezistence druhé kategorie).
</ul>
<p>

V OpenBSD se pou¾ívají hash algoritmy MD5, SHA1 and RIPEMD-160 pro následující úèely:
<p>
<ul> 
<li>V <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=skey>S/Key</a> pro vytvoøení jednorázového hesla.
<li>V <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec>IPsec</a>, <a href=http://www.physnet.uni-hamburg.de/provos/photuris/>photurisd</a> a <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd>isakmpd(8)</a> pro autentifikaci pùvodu paketù a pro kontrolu jejich integrity.
<li>Pro MD5 hesla ve FreeBSD stylu (standardnì to není povoleno), viz <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=passwd.conf&sektion=5>passwd.conf(5)</a>
<li>Pro podporu TCP SYN cookie (opìt není standardnì povoleno), viz. <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=options&sektion=4>options(4)</a>
<li>V libssl pro digitalní podepsání zpráv.
</ul>
<p>

<p>
<a name="trans"></a>
<h3><font color=#e00000>Kryptografické algoritmy</font></h3><p>

Kryptografické algoritmy se pou¾ívají pro ¹ifrování (¹ifrovacím klíèem) a de¹ifrování (de¹ifrovacím klíèem) dat. Bezpeènost by u nich mìla záviset na síle klíèe.<p>

OpenBSD poskytuje v jádøe i u¾ivatelským programùm algoritmy DES, 3DES, Blowfish a Cast:<p>
<ul>
<li>V libc pro <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=blf_key">Blowfish</a> hesla, viz. také <a href="../papers/bcrypt-paper.ps">dokumentace USENIX</a>.
<li>V <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec>IPsec</a> pro zachování bezpeènosti sí»ové vrstvy.
<li>V Kerberu a Kerberoidních aplikacích <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=telnet>telnet</a>, <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=cvs>cvs</a>, <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rsh>rsh</a>, <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rcp>rcp</a> a <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rlogin>rlogin</a>.
<li>V <a href=http://www.physnet.uni-hamburg.de/provos/photuris/>photurisd</a> a <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd>isakmpd</a> pro ochranu výmìny klíèù IPsec.
<li>V AFS k ochranì zpráv jdoucích pøes sí», pro bezpeèný vzdálený pøístup k filesystému.
<li>V libssl pro komunikaci aplikací pøes bezpeèný SSL protokol.
</ul>

<p>
<a name=hardware></a>
<h3><font color=#e00000>Podpora kryptografického hardware</font></h3><p>

OpenBSD zaèalo od verze 2.7 s podporou kryptografického hardware, jako jsou akcelerátory a generátory náhodných èísel.
<ul>
<li><b>IPSEC crypto dequeue</b><br>
Ná¹ IPsec stack byl modifikován, tak¾e se kryptografické funkce provedou takøíkajíc out-of-line. Vìt¹ina IPsec stackù potøebuje zpracovat kryptografii pøi zpracovávání ka¾dého paketu a to má za následek synchronizaci výkonu. Pro správné a rychlé pou¾ití hardware je potøeba tyto dvì èinnosti oddìlit, co¾ se nám podaøilo. Tato zmìna vedla i k lep¹ímu výkonu po softwarové stránce.
<p>
<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hifn&sektion=4">HiFn 7751</a></b><br>
Karty postavené na èipu <a href="http://www.hifn.com/products/7751.html">HiFn 7751</a> se pou¾ívají jako akcelerátory symetrické kryptografie (tj. <a href="http://www.powercrypt.com">PowerCrypt</a>).
Souèasný výkon pøi pou¾ití jedné karty Hifn 7751 na ka¾dé stranì tunelu zaruèuje propustnost 63Mbit/s pro 3DES/SHA1 ESP, což je témìø ¹estinásobek oproti pou¾ití samotného výkonu procesoru P3/550. Plánujeme je¹tì nìkolik vylep¹ení, ale od 13.4.2000 je tento kód pova¾ován za stabilní. Místo pùvodního driveru <a href="http://www.powercrypt.com">powercrypt</a> (napsán v USA) jsme napsali vlastní, který navíc správnì pracuje s na¹ím IPsec stackem. Èip 7751 je dnes prùmyslovými standardy pova¾ován za pomalý a dost výrobcù poskytuje èipy rychlej¹í (vèetnì samotného HiFn). Maximální propustnost s 3DES SHA1 ESP je kolem 63Mbit/s.<p>
(Mimochodem s HiFn je dosti tì¾ké poøízení. Dokonce nám vyhro¾ovali soudem, proto¾e jsme mimo USA aplikovali reverzní engineering na jejich kryptoalgoritmus.)<p>
<li><b>Hifn 6500</b><br>
Tohle zaøízení akceleruje asymetrickou kryptografii. Podporuje algoritmy RSA, DSA a DH a má hromadu dal¹ích funkcí. Obsahuje výkonný generátor náhodných èísel, máme jedno zaøízení, kompletní dokumentaci, ukázkový kód a vývoj driveru zatím je¹tì nezaèal.<p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ubsec&sektion=4">Broadcom BCM5805 (èip Bluesteelnet 5501)</a></b><br>
Hned po releasnutí OpenBSD 2.7 se nám podaøilo pøidat kód pro tyhle staré kusy (pùjèil nám je pøímo výrobce). Zaèali jsme s testováním èipu 5501 a nutno øíci, ¾e poskytuje asi nejlep¹í výkon v symetrické kryptografii, jaký jsme kdy vidìli.<p>
Bluesteelnet byl koupen Broadcomem a zaèal s výrobou souèástek. Jejich BCM5805 je velmi podobný, ov¹em navíc obsahuje asymetrický engine pro DSA, RSA a dal¹í algoritmy. Vzhledem k tomu, ¾e ma skoro 4,5 krát vy¹¹í výkon ne¾ HiFn, je dost pravdìpodobné, ¾e se roz¹íøí.<p>
S lidmi z Broadcomu/Bluesteelnetu je radost jednat. Dali nám kompletní dokumentaci, ukázkový kód a dostateèný poèet karet pro testování.<p>
Od verze 2.8 byl driver modifikován, tak¾e kernel vyu¾ívá entropii z BCM5805.<p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ises&sektion=4">
 Pijnenburg PCC-ISES</a></b><br>
<a href="http://www.pcc.pijnenburg.nl/pcc-ises.htm">PCC-ISES</a> je nový èipset z Holandska. Dostali jsme ukázkový hardware, dokumentaci a na vývoji driveru se pracuje. V souèasnosti umí driver poskytovat kernelu entropii.<p>
	
<li><b>SafeNet 2141</b><br>
Dostali jsme dokumentaci a hardware pro kryptokarty <a href="http://www.safenet-inc.com/OEM/OEMTechnologyDefault.htm">SafeNet</a> a práce na podpoøe symetrické kryptografie zaèaly.<p>

<li>><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=txp&sektion=4">3com 3c990</a></b><br>
3com nám dal driver pro podporu sí»ových karet, postavených na tomto èipsetu a na jeho základì jsme napsali driver vlastní. Tento driver byl nyní integrován, proto¾e jsme dostali volnou licenci na mikrokód. Obdr¾eli jsme (v¹echny?) informace potøebné pro podporu kryptografických funkcí, co¾ si také vy¾ádá men¹í úpravy v uspoøádání IPsec subsystému). Vrátíme se k tomu pozdìji..<p>

<li><b>Intel IPSEC karty</b><br>
Stejnì jako Intel postupuje ohlednì komponent z jejich sí»ové divize, a zcela stejnì jako vìt¹ina ostatních výrobcù, Intel zatvrzele odmítá poskytnout nám dokumentaci. Mluvili jsme zhruba s 5 lidmi z technického oddìlení, kteøí zodpovídají za vývoj tìchto produktù. Rádi by nám poskytli dokumentaci, ale jejich ruce jsou svázané, proto¾e management nechce dokumentaci vydat.
Zapomeòme na Intel. (Pokud chcete zakoupit gigabit ethernet hardware, doporuèujeme vám cokoliv jiného... z tìch samých dùvodù: vìt¹ina driverù které máme pro sí»ový hardware od Intelu byla napsána bez dokumentace)<p>

<li><b><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pchb&sektion=4">
	Intel 82802AB/82802AC Firmware Hub RNG</a></b><br>

Èip 82802 FWH (je na motherboardech i810, i820, i840 a i860) obsahuje generátor náhodných èísel (RNG). Vy¹¹í propustnost IPsec vy¾aduje vy¹¹í entropii náhodných èísel. Od 10.4.2000 tento RNG podporujeme. Pokusíme se pøidat i podporu dal¹ích RNG krypto èipù.<p>

<li><b>OpenSSL</b><br>
Vytvoøili jsme schémata pro podporu kryptokaret s RSA nebo DSA v OpenSSL, tak¾e i programy v userlandu (<a href="http://www.openssh.com">ssh</a>, <a href="http://www.modssl.org/">apache https</a>, atd.) budou moci vyu¾ívat hardware.
</ul>

<p>
<b>V pøípadì, ¾e nám chcete pomoci s psaním driverù,
<a href=#people>pøijïtì a pomozte</a>.</b>

<p>
<a name=people></a>
<h3><font color=#e00000>Sháníme mezinárodní odborníky na kryptografii</font></h3><p>

Pochopitelnì ná¹ projekt potøebuje lidi, kteøí by pracovali na tìchto systémech. V pøípadì, ¾e se najde nìjaký neamerický odborník, ochotný nám pomoci s kryptografií v OpenBSD, nech» nás prosím kontaktuje.<p>

<p>
<a name=papers></a>
<h3><font color=#e00000>Dal¹í ètení</font></h3><p>

O zmìnách v kryptografii OpenBSD bylo napsáno nìkolik dokumentù. Jejich postscriptové verze jsou dostupné ní¾e.<p>

<ul>
<li>Heslové schéma pro budoucnost.<br>
    <a href=events.html#usenix99>Usenix 1999</a>,
    napsal <a href=mailto:provos@openbsd.org>Niels Provos</a>,
    <a href=mailto:dm@openbsd.org>David Mazieres</a>.<br>
    <a href=../papers/bcrypt-paper.ps>paper</a> a
    <a href=../papers/bcrypt-slides.ps>slides</a>.
<p>
<li>Kryptografie v OpenBSD: Pøehled.<br>
    <a href=events.html#usenix99>Usenix 1999</a>,
    napsal <a href=mailto:deraadt@openbsd.org>Theo de Raadt</a>,
    <a href=mailto:niklas@openbsd.org>Niklas Hallqvist</a>,
    <a href=mailto:art@openbsd.org>Artur Grabowski</a>,
    <a href=mailto:angelos@openbsd.org>Angelos D. Keromytis</a>,
    <a href=mailto:provos@openbsd.org>Niels Provos</a>.<br>
    <a href=../papers/crypt-paper.ps>paper</a> a
    <a href=../papers/crypt-slides.ps>slides</a>.
<p>
<li>Implementace Internet Key Exchange (IKE).<br>
    <a href=events.html#usenix2000>Usenix 2000</a>,
    napsal <a href=mailto:niklas@openbsd.org>Niklas Hallqvist</a> a
    <a href=mailto:angelos@openbsd.org>Angelos D. Keromytis</a>.<br>
    <a href=../papers/ikepaper.ps>paper</a> a
    <a href=../papers/ikeslides.ps>slides</a>.
<p>
<li>©ifrování virtuální pamìti</a><br>
    <a href=events.html#sec2000>Usenix Security 2000</a>,
    <a href=mailto:provos@openbsd.org>Niels Provos</a>.<br>
    <a href=../papers/swapencrypt.ps>paper</a> a 
    <a href=../papers/swapencrypt-slides.ps>slides</a>.
</ul>

<p>
<hr>
<a href=index.html><img height=24 width=24 src=../back.gif border=0 alt=OpenBSD></a>
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: crypto.html,v 1.80 ]
<br>
$Translation: crypto.html,v 1.5 2001/05/25 20:40:17 jufi Exp $
<br>
$OpenBSD: crypto.html,v 1.3 2001/05/25 21:03:24 jufi Exp $
</small>
</body>
</html>
