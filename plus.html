<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD-current changes</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta name="resource-type" content="document">
<meta name="description" content="OpenBSD-current changes">
<meta name="keywords" content="openbsd,current,changes">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-2006 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<a href="index.html"><img alt="[OpenBSD]" height="30" width="141" src="images/smalltitle.gif" border="0"></a>
<p>
<h2><font color="#e00000">Changes made between OpenBSD 4.0 and OpenBSD-current</font></h2>
<hr>

<p>
This is a partial list of the major machine-independent changes
(i.e., these are the changes people ask about most often).  Port
specific changes have also been made, and are sometimes mentioned
in the pages for the specific <a href="plat.html">platforms</a>.

<p>
There is a separate <a href="portsplus/index.html">list of Changes to the ports collection</a>.

<p>
Note: <font color="#e00000">Problems for which patches exist are marked in red</font>.

<p>
<h3>
For changes in other releases, click below:<br>
<a href="plus20.html">2.0</a>,
<a href="plus21.html">2.1</a>,
<a href="plus22.html">2.2</a>,
<a href="plus23.html">2.3</a>,
<a href="plus24.html">2.4</a>,
<a href="plus25.html">2.5</a>,
<a href="plus26.html">2.6</a>,
<a href="plus27.html">2.7</a>,
<a href="plus28.html">2.8</a>,
<a href="plus29.html">2.9</a>,
<a href="plus30.html">3.0</a>,
<a href="plus31.html">3.1</a>,
<a href="plus32.html">3.2</a>,
<a href="plus33.html">3.3</a>,
<a href="plus34.html">3.4</a>,
<a href="plus35.html">3.5</a>,
<a href="plus36.html">3.6</a>,
<a href="plus37.html">3.7</a>,
<a href="plus38.html">3.8</a>,
<a href="plus39.html">3.9</a>,
<a href="plus40.html">4.0</a>.
<br>
</h3>

<p>
<h3><font color="#0000e0">We are working on OpenBSD-current.</font></h3><p>
<p>

<ul>
<!-- 2006/10/12 -->
<li>Massive ACPI changes.
<!-- 2006/10/11 -->
<li>Make <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=file&sektion=1&format=html">file(1)</a> recognize OpenBSD/sh binaries too.
<li>Fix a potential null dereference, and a memory leak in the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a> error path.
<li>Make sure <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html">ssh(1)</a> exits instead of doing a blocking tcp send if we detect a client/server timeout, since the tcp sendqueue might be full of alive requests.
<li>Fixes for SIGCONT, may be sent to any process with the same session ID as the caller, not to any process that is a descendant of the current process.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udcf&sektion=4&format=html">udcf(4)</a> to amd64 GENERIC.
<li>Implemented the IP_MINTTL tcp socket option.
<li>Implemented the IP_RECVTTL socket option for raw or udp sockets.
<!-- 2006/10/10 -->
<li>In <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&format=html">pf.conf(5)</a>, allow the 'quick' keyword on an anchor.
<li>Various fixes for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xge&sektion=4&format=html">xge(4)</a>.
<li>Revert firmware synchronization change in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bge&sektion=4&format=html">bge(4)</a>, since breaks dual-port cards.
<li>Make <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1&format=html">ssh(1)</a> sleep before retrying, not after, since sleeping affects errno.
<!-- 2006/10/09 -->
<li>Stop spoofing NetBSD/FreeBSD MBR partitions as the 'a' partition in a disklabel when no OpenBSD partition is found.
<li>Fixes in the delay routines for dp8390-based devices on fast machines.
<li>Add powerhooks to the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a> driver.
<!-- 2006/10/08 -->
<li>Fix glitch in jump scroll code for wscons vt100 emulation.
<li>SuperH additions to <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ld&sektion=1&format=html">ld(1)</a> and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=as&sektion=1&format=html">as(1)</a> in binutils.
<li>Fixes for linux emulation regarding linux_sys_waitpid() calls.
<!-- 2006/10/07 -->
<li>Add PCI Express Fibre Channel FC949E to the list of supported <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mpi&sektion=4&format=html">mpi(4)</a> devices.
<li>Fix for macppc <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mc&sektion=4&arch=macppc&format=html">mc(4)</a> by using the "Enforce in-order Execution" to stop it from crashing under heavy load.
<li>Make cd-roms retry forever while the device indicates that it is becoming ready, in the same way it was done for tapes in st.c.
<!-- 2006/10/06 -->
<li>Enable <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a> on cardbus for the i386 and amd64 GENERIC kernels.
<li>Fix cardbus support for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a>.
<li>Initial import of the SuperH-based landisk platform.
<li>Various binutils and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc&sektion=1&format=html">gcc(1)</a> additions to handle 32-bit SuperH cpus.
<li>In <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&format=html">pf.conf(5)</a>, make 'flags S/SA keep state' the implicit default for filter rules.
<!-- 2006/10/05 -->
<li><font color="#e00000"><strong>SECURITY FIX: Integer overflow in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=systrace&amp;sektion=4">systrace(4)</a>'s STRIOCREPLACE support. This could be exploited for DoS, limited kmem reads or local privilege escalation.</strong></font><br><a href="errata.html#systrace">A source code patch is available</a>.<br><a href="stable.html"><font color="#00b000">[Applied to stable]</font></a>
<li>Update OpenSSH to 4.4.
<li>Always allow read-only opens on (s)vnd devices, despite the type of the first open (svnd vs vnd).
<!-- 2006/10/04 -->
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mc&sektion=4&arch=macppc&format=html">mc(4)</a> driver for AMD AM79C940 (MACE) ethernet chip to macppc.
<li>Make sure bufcache calculation on i386 does not take memory above 4g into account since it wont be used anyhow.
<li>Fix for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=write&sektion=1&format=html">write(1)</a> to handle cases where the utmp file is missing.
<li>Fixes for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pci&sektion=4&format=html">pci(4)</a> where unit numbers do not match PCI Bus number.
<li><font color="#e00000"><strong>SECURITY FIX: Several problems have been found in OpenSSL. While parsing certain invalid ASN.1 structures an error condition is mishandled, possibly resulting in an infinite loop. A buffer overflow exists in the SSL_get_shared_ciphers function. A NULL pointer may be dereferenced in the SSL version 2 client code. In addition, many applications using OpenSSL do not perform any validation of the lengths of public keys being used.</strong></font><br>
<a href="errata.html#openssl2">A source code patch is available</a>.<br>
<a href="stable.html"><font color="#00b000">[Applied to stable]</font></a>
<!-- 2006/10/03 -->
<li>Use 64 bit daddr type for physical block numbers in the filesystem code.
<li>Enable altq on <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acx&sektion=4&format=html">acx(4)</a> devices.
<li>Altq fixes for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a>, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vge&sektion=4&format=html">vge(4)</a> and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=axe&sektion=4&format=html">axe(4)</a> based devices.
<!-- 2006/10/02 -->
<li>Fixes for libpthread regarding dup2() and _thread_fd_table_init() return values.
<li>Add ServerWorks PCIe bridge ids to pcidevs.
<!-- 2006/10/01 -->
<li>OpenBSD/cats platform now discontinued.
<li>Switch i386 fpu control too, i386 also has proper "long double" support now.
<li>Initial code for 88E3082 Fast Ethernet PHY. Untested at the moment.
<li>Switch amd64 fpu control word to hardware default, makes us use 64-bit precision instead of 53-bit, giving us proper support for "long double".
<li>Make sure SAF/TE and SES free their sensors on detach.
<!-- 2006/09/30 -->
<li>Small fixes for running <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nm&sektion=1&format=html">nm(1)</a> on ELF binaries.
<!-- 2006/09/29 -->
<li>Improved CPU signature detection in the powernow K7 code.
<li>Various small fixes in the <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=re&sektion=4&format=html">re(4)</a>.
<li>Make sure rtl81x9 code discards packets in the receive handler if they are too short or too large.
<li>Small fix for powerpc pthread stack allocation code.
<li>Add support for HenTong WK-668 to list of supported <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udav&sektion=4&format=html">udav(4)</a> devices.
<!-- 2006/09/28 -->
<li>Make sure rtl81x9 code free the mbuf chain on certain failures.
<li>Tree search speedup in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostapd&sektion=8&format=html">hostapd(8)</a> via inlined compare function.
<li>Fix <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostapd&sektion=8&format=html">hostapd(8)</a> parser for event rules and handling of multiple matches of the "not" grammar rule.
<!-- 2006/09/27 -->
<li>Add cardbus support for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a>.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uath&sektion=4&format=html">uath(4)</a> to sparc64 GENERIC. Almost works.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=an&sektion=4&format=html">an(4)</a>, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atw&sektion=4&format=html">atw(4)</a>, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=auth&sektion=4&format=html">auth(4)</a> and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&sektion=4&format=html">wi(4)</a> to alpha GENERIC.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated&sektion=8&format=html">ifstated(8)</a> to rc startup bits.
<li>Enable <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uath&sektion=4&format=html">uath(4)</a> on amd64.
<li>Fix in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ospfd&sektion=8&format=html">ospfd(8)</a> to better detect on which interface incoming OSPF packets arrived.
<!-- 2006/09/26 -->
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uow&sektion=4&format=html">uow(4)</a> 1-Wire support to all USB-capable arches.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a> and <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acx&sektion=4&format=html">acx(4)</a> to sparc64 GENERIC too.
<li>Plug memory leak in OpenRCS diff code.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acx&sektion=4&format=html">acx(4)</a> to alpha GENERIC kernels.
<li>Switch alpha to gcc3.
<li>Initial support for HostAP mode on <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a>.
<li>Make sure port number 664 isn't used since packets might get stolen by IPMI/asf.
<li>Reduce number of unsafe signal operations in the X server logging functions.
<li>In <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=grep&sektion=1&format=html">grep(1)</a>, allow zero-length patterns with -x.
<li>Make pthreads allocate stack using mmap instead of malloc.
<li>More of the fd race and deadlock corrections in pthread code.
<li>Make sure <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bge&sektion=4&format=html">bge(4)</a> does not allocate jumbo buffers and also does not allow reception of large frames until mtu is set to higher value. 
<li>On <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acx&sektion=4&format=html">acx(4)</a>, make HostAP mode work, and fix IBSS tweaks.
<li>Add ELECOM LD-USB20 to list of supported <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=aue&sektion=4&format=html">aue(4)</a> devices.
<li>Endian fix for ISO chksum in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dvmrpd&sektion=8&format=html">dvmrpd(8)</a>.
<li>Fix races in FFS code which may violate softdep processing and create inconsistant on-disk ffs state and absuse kmem aswell.
<!-- 2006/09/25 -->
<li>Fix in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&sektion=8&format=html">httpd(8)</a> for error response to unsupported Expect: header.
<li>Fix for the shutdown hooks on <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=arc&sektion=4&format=html">arc(4)</a> so it syncs correctly.
<!-- 2006/09/24 -->
<li>Make <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&sektion=1&format=html">nc(1)</a> also accept "HTTP/1.1 200" as a success response.
<li>In ld.so, fill in the list of loaded segments for the main executable so we can unprotect them if needed for binaries that have TEXTREL set.
<li>Add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a> to alpha GENERIC kernels.
<!-- 2006/09/23 -->
<li>Add TRENDnet TEW-429UB A to list of supported <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=zyd&sektion=4&format=html">zyd(4)</a> devices.
<!-- 2006/09/22 -->
<li>Make sure sparc64 can dump memory above 4GB.
<li>Fixes for file descriptor races and deadlocks in the pthread code.
<li>Add support for Marvell Yukon 88E8056 to <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=msk&sektion=4&format=html">msk(4)</a>.
<!-- 2006/09/21 -->
<li>Add support for hot plugging <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mpi&sektion=4&format=html">mpi(4)</a> SAS devices, but disabled for now.
<li>In OpenRCS, add support for all other diff flags that are pertinent to files, and do not conflict with rcsdiff-specific flags.
<li>Make libXpm more robust when parsing XPM files with unterminated comments in them.
<li>Make the wsfb driver inform the X server that is does not require direct access to the hardware.
<li>Make sure the SCSI midlayer frees the scsi_link struct on detach now that hotplugging of controllers is possible.
<!-- 2006/09/20 -->
<li>Fix the way delays between retransmissions are calculated in NFS when receiving NFSERR_TRYLATER from the server.
<li>Fix memory leak in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=top&sektion=1&format=html">top(1)</a>.
<li>Implement zero-copy RX data path for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=uath&sektion=4&format=html">uath(4)</a> devices.
<li>Corrected SpeedStep table for Pentium M 770.
<li>Make <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vnd&sektion=4&format=html">vnd(4)</a> work on read-only file systems.
<!-- 2006/09/19 -->
<li>Enable <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pgt&sektion=4&format=html">pgt(4)</a> on amd64 GENERIC kernels.
<li>Enable AR2413, 5413 and 5424 based devices.
<li>In <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&format=html">tcpdump(8)</a>, enable ESP and AH dissectors over IPv6.
<li>Disable 802.11g mode on AR5211 and 5212 based devices for now.
<!-- 2006/09/18 -->
<li>Fixes for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=re&sektion=4&format=html">re(4)</a> on cardbus, for kernel faults on halt/reboot.
<li>The macppc platform extended .text and .data segments to 64MB, allowing programs with large .text segments to run.
<!-- 2006/09/17 -->
<li>Re-add Dell PHY LED setup workaround and Jumbo capability flag on <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bge&sektion=4&format=html">bge(4)</a>.
<li>Various fixes in the RX path for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=em&sektion=4&format=html">em(4)</a> devices regarding mbuf cluster allocations, updating status bits in RX descriptors and DMA map unloading on errors.
<li>Re-add <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=re&sektion=4&format=html">re(4)</a> link state check, as a workaround for a link state issue found on 8139C+ chips.
<li>Alignment fixes for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=em&sektion=4&format=html">em(4)</a> when doing VLAN and jumbo frames together.
<li>Fixes for bge_reset() in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bge&sektion=4&format=html">bge(4)</a>, eliminates firmware timeouts for the BCM5752.
<li>Make <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rdate&sektion=8&format=html">rdate(8)</a> ignore ntp responses with ALARM status.
<li>Defer the establishment of interrupts on <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bge&sektion=4&format=html">bge(4)</a> until later during attach. Fixes panic on some systems running non-MP kernels.
</ul>
<p>

This list mentions mostly platform-independent changes.  For a list of changes
made in a particular platform, please check the page for that platform.  If you
find them not listed there, the changes are either (1) not being documented or
(2) are documented here.<br><br>

<hr>
<p>
<h3>
For changes in other releases, click below:<br>
<a href="plus20.html">2.0</a>,
<a href="plus21.html">2.1</a>,
<a href="plus22.html">2.2</a>,
<a href="plus23.html">2.3</a>,
<a href="plus24.html">2.4</a>,
<a href="plus25.html">2.5</a>,
<a href="plus26.html">2.6</a>,
<a href="plus27.html">2.7</a>,
<a href="plus28.html">2.8</a>,
<a href="plus29.html">2.9</a>,
<a href="plus30.html">3.0</a>,
<a href="plus31.html">3.1</a>,
<a href="plus32.html">3.2</a>,
<a href="plus33.html">3.3</a>,
<a href="plus34.html">3.4</a>,
<a href="plus35.html">3.5</a>,
<a href="plus36.html">3.6</a>,
<a href="plus37.html">3.7</a>.
<a href="plus38.html">3.8</a>,
<a href="plus39.html">3.9</a>,
<a href="plus40.html">4.0</a>.
<br>
</h3>

<hr>
<a href="index.html"><img height=24 width=24 src="back.gif" border=0 alt="OpenBSD"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br><small>$OpenBSD: plus.html,v 1.1030 2006/12/06 17:21:50 pvalchev Exp $</small>

</body>
</html>
