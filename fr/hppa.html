<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict//EN">
<html>
<head>
<title>OpenBSD/hppa</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD/hppa page">
<meta name="keywords" content="openbsd,hppa">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-2002 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<h2>OpenBSD/hppa</h2>

<hr>
Ce port a pour vocation de supporter les modèles de HP 9000 suivants : 705, 710, 
<b>712</b>, <b>715</b>, 720, <b>725</b>, 730, <b>735</b>, 742, 750, <b>755</b>, 
A180, A180C, B132L, B132L+, B160L, B180L, C100, C110, C132L, C160L, C180L, J200, 
<strong>J210,</strong> J210XC (les modèles en gras sont connus comme fonctionnant). 
D'autres machines avec des configuration matérielles similaires peuvent être supportées, 
sous réserve qu'elles soient basées sur : 
<ul>
<li>Processeurs HP PA-RISC 7000, 7100, 7150, 7100LC, 7200, 7300LC ;
<li>Contrôleur de mémoire Viper (quid des autres ?) ;
<li>Contrôleur de bus/IO LASI, ASP et WAX ;
<li>Contrôleur de bus EISA bus ;
<li>Processeur d'I/O SCSI NCR53C700, NCR53C710, NCR53C720 ;
<li>Contrôleurs vidéo Venom, CRX-8, CRX-24, HCRX-8 et HCRX-24;
<li>Clavier et souris HIL ou PS/2;
<li>Les périphériques EISA fonctionneront, mais ils ne seront pas utiles pour
l'amorçage, excepté ceux fabriqués par HP pour les systèmes 700/800.
</ul>

Systèmes pouvant éventuellement fonctionner : 
<ul>
<li>Systèmes PA2.0 (en mode 32-bit) ; 
<li>HP 9000 834, 835, 836, 844, 845, 846 ;
<li>HP 9000 E23, E25, E35, E45, E55 ;
<li>HP 3000 908, 918, 928, 938 ;
<li>Hitachi VQ200, VQ210, et d'autres stations de travail non-HP ;
<li>Precision Book de RDI Computer Corporation (enfin, peu probable)
<li>Systèmes HP VME et VXI à carte simple (a besoin au moins d'un bus VME)
</ul>
<br>
Du matériel est nécessaire pour ce projet, 
voir la <a href="../want.html">liste de souhaits</a>. 
(Contactez <a href=mailto:mickey@openbsd.org>mickey</a>).



<h3><strong>Statut : </strong></h3>
Le système démarre en mode mono-utilisateur, en utilisant ces <a href=http://hppa.lucifier.net/#boot_lif>images bootable</a>.

<h3><strong>Histoire : </strong></h3>
Ce projet fut démarré à l'époque ou les seuls systèmes d'exploitation open source
pour les ordinateurs HP PA-RISC étaient 
<a href=http://www.cs.utah.edu/projects/flux/lites/html>Lites</a> et
<a href=http://www.osf.org/mall/os/pa-mklinux>MkLinux</a>.
Ces deux sources fournirent la majorité de la documentation ainsi que le code
pour le développement initiale du port OpenBSD/hppa.
Le système <a href=http://www.cs.utah.edu/~mike/hpbsd/hpbsd.html>HPBSD</a>
est encombré par du code propriétaire de HP et la licence USL et n'est pas
disponible publiquement. Un des bénéfices directs majeurs des efforts de portage
précédents (en plus du code, bien sûr ;) est le support pour HP PA-RISC dans GCC
et binutils, ce qui a permis la construction rapide d'environnement d'outils
croisés pour le développement.
<p>
Plus tard, HP a décidé de sponsoriser un port 
<a href=http://www.parisc-linux.org/>Linux</a> sur les machines 
PA-RISC, ce qui a résulté en la publication de quelques documentations
propriétaires, même s'ils visent une classe différente de machines 9000. 
<p>
Voici l'histoire jusqu'à maintenant du port OpenBSD/hppa
<small>(il n'y a pas de dâte, mais vous pouvez utiliser
<a href=anoncvs.html>cvs</a> pour voir quand est arrivé quoi)</small> :
<ul>
<li>mode single user
<li>support de la console série
<li>récriture du pilote sti, avec la publication des spécifications
<li>chargement de la table des symboles du noyau par /boot (débogage symbolique !)
<li>init(8) s'exécute correctement, un shell mono-utilisateur ultérieur se
<u>termine</u>, ce qui signifie probablement qu'il a trouvé un problème en
s'initialisant
<li>partition racine sur nfs, partition de swap sur nfs
<li>ethernet à base de i82596 (if_ie), en mode de mémoire non cachée
<li>la plupart du code noyau dépendant de la machine est écrit
<li>support de ddb, à l'exception des watchpoints et du single-stepping
<li>l'amorçage sur disque fonctionne
<li>pilote pour les cartes graphiques Stinger (*CRX-*)
<li>Adaptateurs de bus LASI, ASP, WAS et EISA
<li>pilotes com, lpt, fdc (par encore fd ;)
<li>pilote PDC
<li>le bootstrap noyau marche
<li>l'amorçage par le réseau fonctionne via l'image LIF
<li>outils de développement croisé compilent et fonctionnent
</ul>

<h4>Documentation</h4>
<small>(la plupart ayant été publiée par HP pour le projet
<a href=http://www.parisc-linux.org/>Linux/parisc</a>)</small>:
<ol type=1>
<li>CPUs HP PA-RISC
	<ol type=a>
<li><a href=http://ftp.parisc-linux.org/docs/PCXL_ers.ps>CPU ERS PA7100LC</a>
<li><a href=http://ftp.parisc-linux.org/docs/pcxl2_ers.ps>CPU ERS PA7300LC</a>
	</ol>
<li><b>Code dépendant du processeur / I/O Dependent Code Interface</b><br>
<small>(selection de chapitres du "PA-RISC I/O Architecture Specification")</small>
	<ol type=a>
<li><a href=http://ftp.parisc-linux.org/docs/pdc32.pdf>PDC 1.1</a>
<li><a href=http://ftp.parisc-linux.org/docs/iodc.pdf>IODC 1.1</a>
<li><a href=http://ftp.parisc-linux.org/docs/ver_nums.pdf>Version and Identification Number Allocation</a>
<li><a href=http://ftp.parisc-linux.org/docs/data_formats.pdf>Memory Data Formats 2.0</a>
<li><a href=http://ftp.parisc-linux.org/docs/pdc.pdf>PDC Procedures 2.0</a>
<li><a href=http://ftp.parisc-linux.org/docs/pdce.pdf>PDC Entry Points 2.0</a>
<li><a href=http://ftp.parisc-linux.org/docs/os_interface.pdf>OS Interface 2.0</a>
	</ol>
<li><b>Contrôleurs de bus/ponts/adaptateurs</b>
	<ol type=a>
<li><a href=http://ftp.parisc-linux.org/docs/lasi_ers.ps>LASI Core Bus Adapter (including lan, scsi, serial, lpt controllers)</a>
<li><a href=http://ftp.parisc-linux.org/docs/dino_ers.ps>Dino PCI bridge</a>,
and <a href=http://ftp.parisc-linux.org/docs/Dino_3_1_Errata.html>Errata</a>
<li><a href=http://ftp.parisc-linux.org/docs/elroy_ers.ps>Elroy ERS (Edited for Open Source)</a>
<li>Astro <a href=http://ftp.parisc-linux.org/docs/astro_intro.ps>Overview</a>, <a href=http://ftp.parisc-linux.org/docs/astro_errors.ps>Error handling</a>,<a href=http://puffin.external.hp.com/docs/astro_ioc.ps>R2I Operations</a>, <a href=http://puffin.external.hp.com/docs/astro_regmap.ps>Registers Map</a>, <a href=http://puffin.external.hp.com/docs/astro_runway.ps>Runway Interface</a>, <a href=http://puffin.external.hp.com/docs/astro_sysmap.ps>System Mamory Map</a>
	</ol>
<li><a href=http://ftp.parisc-linux.org/docs/sti.pdf>Stinger graphics</a>
<li><a href=http://www.lsilogic.com/techlib/techdocs/old_storage/770_2_0.pdf>NCR 53C700/710/720 SCSI I/O Processors</a>
    <small>(la documentation est en fait pour 770, qui est dit compatible)</small>
<li>Intel <a href=http://developer.intel.com/design/network/datashts/290219.htm>i82596DX/SX</a> and <a href=http://developer.intel.com/design/network/datashts/290218.htm>i82596CA</a> Ethernet Controllers
</ol>
Pour d'autres informations, voir <a href=http://www.openpa.net/>OpenPA</a>.


<h4>Construire les outils de développement croisés :</h4>
<pre>
cd /usr/src
sudo make TARGET=hppa cross-tools
</pre>
</p>
<p>
Le processus de construction des outils de développement croisés peut échouer au
moment de la compilation de la libc, considérez ceci comme normal, puisque le
support de la libc n'est pas encore terminé.
</p>


<a name="boot_lif"></a>
<h4>Construire le fichier boot.lif en utilisant les outils de développement
croisés : </h4>
<p>
<pre>
cd /sys/arch/hppa/stand
make obj
set cross=(/usr/cross/hppa/usr/bin)
make MACHINE=hppa MACHINE_ARCH=hppa \
	"AS=$cross/as" "CC=$cross/cc" "CXX=$cross/c++" \
	"CPP=$cross/cpp" "LD=$cross/ld" \
	"AR=$cross/ar" "STRIP=$cross/strip" \
	"LORDER=$cross/lorder" "NM=$cross/nm" \
	"RANLIB=$cross/ranlib" "SIZE=$cross/size"
</pre>
</p>
<p>
Vous obtiendrez un fichier <a href=http://hppa.lucifier.net/#boot_lif><em>boot.lif</em></a>
prêt à booter dans le répertoire des objets.
Cette image peut inclure une image de noyau <em>diskless</em> si une était
disponible dans <em>sys/arch/hppa/compile/SHEPHERD_PIE/bsd</em>.
<br>
Le processus de compilation croisée du noyau est semblable à celui du boot,
consultez
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=config&apropos=0&sektion=0
&manpath=OpenBSD+Current&format=html>config(8)</a>
et
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=options&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html>options(8)</a>
pour les options de compilation et de configuration du noyau.
</p>



<h4>Développements récents :</h4>
<pre>
BOOT_ADMIN&gt; boot lan isl

Booting


&gt;&gt; OpenBSD/hppa BOOT 0.7
&gt;
booting lf0a:/bsd: 1167360+61440+274432 [164584+60691]=0x489000 start=0x12000
[ bsd ELF symbol table not valid: bad magic ]
[ using 225276 bytes of bsd a.out symbol table ]
Copyright (c) 1982, 1986, 1989, 1991, 1993
        The Regents of the University of California.  All rights reserved.
Copyright (c) 1995-2002 OpenBSD. All rights reserved.  http://www.OpenBSD.org

OpenBSD 3.1-beta (SHEPHERD_PIE) #834: Thu Mar 28 10:52:35 EST 2002
    mickey@lucifier.net:/sys/arch/hppa/compile/SHEPHERD_PIE
HP9000/712/80 (King Gecko) PA-RISC 1.1
real mem = 67108864 (73728 reserved for PROM, 8388608 used by OpenBSD)
mainbus0 (root) [flex fff80000]
pdc0 at mainbus0
mem0 at mainbus0 offset ffbf000: viper rev 0, size 64MB
cpu0 at mainbus0 offset ffbe000 irq 31: PCXL rev 4 L1-A 80MHz, FPU PCXL (CMOS-26B) rev 1
cpu0: 128K(32b/l) Icache, 128K(32b/l) wr-back coherent Dcache, 64 coherent TLB, 8 BTLB
lasi1 at mainbus0 offset 500000 irq 27: rev 3.0
lasi0 at mainbus0 offset 100000 irq 28: rev 3.0
gsc0 at lasi0
"Optional RJ-16" at gsc0 (type a, sv 8d) offset 4060 not configured
"Optional RJ-16" at gsc0 (type a, sv 8d) offset 4040 not configured
"PS/2 port" at gsc0 (type a, sv 84) offset 8100 not configured
"PS/2 port" at gsc0 (type a, sv 84) offset 8000 not configured
"floppy controller" at gsc0 (type a, sv 83) offset a000 not configured
harmony0 at gsc0 offset 4000 irq 13: teleshare rev 4.0
"teleshare tty0" at harmony0 not configured
"teleshare tty1" at harmony0 not configured
lpt0 at gsc0 offset 2000 irq 7
com0 at gsc0 offset 5000 irq 13: ns16550a, 16 byte fifo
com0: console
ie0 at gsc0 offset 7000 irq 8: LASI/i82596CA v1.0, address 08:00:09:87:b5:75
"Core SCSI" at gsc0 (type a, sv 82) offset 6000 not configured
sti0 at mainbus0 offset 8000000: HPA208LC1280 rev 8.04;7
sti0: 2048x1024 frame buffer, 1280x1024x8 display, offset 0x0
sti0: 8x16 font type 1, 16 bpc, charset 0-255
wsdisplay0 at sti0
gsc1 at lasi1
com1 at gsc1 offset 5000 irq 5: ns16550a, 16 byte fifo
ie1 at gsc1 offset 7000 irq 8: LASI/i82596CA v1.0, address 08:00:09:87:b5:76
nfs_boot: using network interface 'ie0'
nfs_boot: client_addr=10.0.0.5
nfs_boot: server_addr=10.0.0.1 hostname=jwalker
root on lucifier:/export/hppa/root
root time: 0x3c6770c7
WARNING: clock lost 9913 days -- CHECK AND RESET THE DATE!
init: copying out flags `-s' 3
init: copying out path `/sbin/init' 11, 0x68ff3003
#
</pre>
</p>
<small>ces informations ont été saisies depuis l'écran, pardon pour les
coquilles</small>
<hr>
Pour utiliser les fichiers <a
href=http://hppa.lucifier.net/#boot_lif>boot.lif</a>, vous devez préparer votre
serveur et indique à votre machine de s'amorcer sur le réseau :  
<ol>
  <li>Configuration du serveur </li><br>
    <ul>
    <li> Pour les machines anciennes, (705, 7[1235]0, vieilles 715)
	<a
	href=http://www.openbsd.org/cgi-bin/man.cgi?query=rbootd&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html>rbootd</a> doit être configuré et démarré.<br>
      <ul>
      <li><b>/etc/<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rbootd&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html>rbootd</a>.conf</b>
contient une seule ligne par machine devant s'amorcer à partir du serveur.
Chaque ligne contient l'adresse ethernet de la machine hppa cliente, et le nom
de fichier à charger à partir du serveur tftp. Par exemple : 
	<pre>
	8:0:9:70:c4:11    <a href=#boot_lif>boot.lif</a>    # 9000/720
	8:0:9:19:fb:a0    <a href=#boot_lif>boot.lif</a>    # 9000/725
	</pre>
      </li>
      </ul>
    </li>
    <li>Les machines récentes (712, nouvelles 715, 725) ne chercheront pas
    rbootd, mais nécessitent une configuration <b>bootp</b><br>
      <ul>
      <li><b>/etc/<a
      href=http://www.openbsd.org/cgi-bin/man.cgi?query=bootptab&apropos=0&sektion=5&manpath=OpenBSD+Current&format=html>bootptab</a></b>
      contient un bloc d'information pour chaque machine. Par exemple : 
	<pre>
	# 9000/715
	boron:\
        	ha=0800095f5a6e:\
        	bf=boot.lif:\
        	hd=:\
        	ht=ethernet:\
        	ip=10.0.1.143:\
        	rp=/usr/local/exports/boron/root:\
        	sm=255.255.255.0:\
        	td=/tftpboot:
	</pre>
      </li>
	<li>
	Créez le répertoire /tftpboot et placez-y le fichier <a href=#boot_lif>boot.lif</a>.<br> 
	</li>
	<li>
	Créez une entrée pour votre hppa dans le fichier <b>/etc/ethers</b> : <br>
	<pre>
	08:00:09:5f:5a:6e	boron
	</pre>  
	</li>
	<li>
	Créez une entrée pour 'boron' dans le fichier <b>/etc/hosts</b> : <br>
	<pre>
	10.0.1.143	boron
	</pre>  
	</li>
	<li>
	Créez le répertoire /usr/local/exports/boron/root et placez-y 
	<a href=http://hppa.lucifier.net/root/dev/MAKEDEV>/dev/MAKEDEV</a>,
	 <a href=http://hppa.lucifier.net/root/sbin/init>/sbin/init</a>, <a href=http://hppa.lucifier.net/root/bin/ksh>/bin/ksh</a>		
	 à leurs emplacements respectifs.
	</li>
	<li>
	Créez une entrée dans <b>/etc/exports</b>, de telle sorte que le
	répertoire racine soit exportée vers le client : 
	<pre>
	/usr/local/exports/boron/root boron
	</pre>  
	</li>
	<li>
	Rappelez vous que vous devez avoir activé
	<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=bootpd&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>bootpd</a>
	 et <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=tftpd&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>tftpd</a>
	dans /etc/inetd.conf, et redémarré <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>inetd</a>.
      </li>
      	<li>
	Rappelez vous aussi que vous devez activer le
	<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>serveur nfs</a>
	, <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=rarpd&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>rarpd</a> 
	et <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>portmap</a> 
	dans <a
href=http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html>/etc/rc.conf</a>.
	</li>
	</ul>
    </li>
    <li>Pour de plus amples informations sur la configuration du serveur pour
    l'amorçage par le réseau, voir aussi : <a href=http://www.openbsd.org/cgi-bin/man.cgi?query=diskless&apropos=0&sektion=0&manpath=OpenBSD+Current&format=html>diskless(8)</a>.</li>
    </ul>
  <li>Amorçage du client par le réseau </li><br>
  <ul>
    <li>BOOT_ADMIN<br>
        Afin d'obtenir le prompt BOOT_ADMIN, vous devez actionner <em>&lt;esc&gt;</em> 
	lorsque la machine démarre. Une fois que la machine a testé ses
	périphériques amorçables, tapez 'a' pour obtenir le prompt
	'BOOT_ADMIN'.
    </li>
    <li>commande d'amorçage par le réseau <br>
        Une fois au prompt 'BOOT_ADMIN, tapez : 
<pre>
	BOOT_ADMIN> boot lan isl
</pre>
        et vous êtes en train d'amorcer boot.lif !
    </li>
  </ul>
</ol>


<hr>
<a href=plat.html><img height=24 width=24 src="../back.gif" border=0 alt=OpenBSD></a> 
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br>
<small> 
Originally [OpenBSD: hppa.html,v 1.63 ]<br>
$Translation: hppa.html,v 1.14 2002/11/06 21:26:04 saad Exp $<br>
$OpenBSD: hppa.html,v 1.14 2002/11/07 09:50:18 jufi Exp $
</small>

</body>
</html>
