<!DOCTYPE HTML PUBLIC  "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>OpenBSD/vax sur SIMH</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD/vax SIMH page">
<meta name="keywords" content="openbsd,vax,simh">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 2004-2009 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">
<a href="index.html"><img alt="[OpenBSD]" height="30" width="141"
src="../images/smalltitle.gif" border="0"></a>
<p>

<h2><font color="#e00000">OpenBSD/vax sur SIMH</font></h2>

<hr>

Il est très facile d'installer OpenBSD/vax sur le simulateur VAX
<a href="http://simh.trailing-edge.com">SIMH</a>. Vous n'avez besoin que
d'une machine raisonnablement puissante, assez d'espace disque pour une
image disque de 1.5Go et le fichier <i>floppy53.fs</i>.

Considérant que vous allez lancer SIMH sur un système OpenBSD, installez
le paquetage <i>emulators/simh</i> des <a href="../faq/ports/index.html">ports</a>.
Décidez du lieu de votre environnement SIMH OpenBSD/vax, et créez y un
fichier <i>openbsd.simh</i> contenant :

<blockquote>
<pre>
<strong>
set cpu 128m
at nvr openbsd.nvram

deposit rq qtime 1000000

set rq0 ra92
at rq0 openbsd.ra0.disk

set rq1 cdrom
at rq1 /dev/rcd0c

set rq2 cdrom
at rq2 floppy53.fs

at xq0 tap:tun0

boot cpu
exit
</strong>
</pre>
</blockquote>

Ceci configure SIMH pour simuler un VAX avec 128 Mo de mémoire, un disque
RA92 de 1.5Go, une unité CD-ROM afin d'utiliser le CD1 de votre jeu de
CD-ROM, une autre unité CD-ROM depuis laquelle booter, et un contrôleur
Ethernet DELQA Qbus attaché à l'interface tun0.
Vous pourriez avoir à remplacer <strong>/dev/rcd0c</strong> par le nom
d'un périphérique brut correspondant à votre véritable unité CD-ROM.

<p>

Par défaut en pressant ^E cela stoppera l'émulation, si vous êtes habitué
aux combinaisons de touches emacs, vous voudrez modifier cela (par exemple
en ajoutant <strong>set console wru=1e</strong> pour configurer ^6, code
ascii 0x1e). 
Si vous préférez un disque plus gros, replacez <strong>set rq0 ra92</strong>
avec par exemple <strong>set rq0 rauser=15000</strong> (où 15000 est la
taille en Mo).
Consultez la documentation SIMH pour plus de détails.

<p>

Avant de démarrer SIMH, vous allez devoir configurer le réseau.
Dans la plupart des cas, la configuration bridge qui suit vous
donnera les meilleurs résultats:

<p>

Créez l'interface réseau tun0, mettez-la en mode layer 2 et lancez-la:

<blockquote>
<pre>
# <strong>ifconfig tun0 create</strong>
# <strong>ifconfig tun0 link0</strong>
# <strong>ifconfig tun0 up</strong>
</pre>
</blockquote>

Bridgez-la à l'interface ethernet et activez le bridge:

<blockquote>
<pre>
# <strong>ifconfig bridge0 create</strong>
# <strong>ifconfig bridge0 fwddelay 4</strong>
# <strong>ifconfig bridge0 add em0 add tun0</strong>
# <strong>ifconfig bridge0 up</strong>
</pre>
</blockquote>

En mettant les permissions appropriées à /dev/tun0 vous pouvez ne
pas faire tourner SIMH en root.

<p>

Alternativement, si vous ne pouvez pas utiliser bridge(4) (par exemple
avec des pilotes sans-fils), vous pouvez utiliser BPF pour vous connecter
au réseau.
Dans ce cas, vous pouvez vous passer de la configuration <tt>ifconfig</tt>
précédemment évoquée et remplacer la ligne "<tt>at xq0 tap:tun0</tt>"
par quelque chose comme:

<blockquote><pre>
<strong>at xq0 iwn0</strong>
</pre></blockquote>

en prenant soin de remplacer iwn0 par votre interface réseau.

<p>

Copiez <i>vax/floppy53.fs</i> dans le répertoire de votre
environnement SIMH OpenBSD/vax.

À présent, lancez SIMH. Vous devriez saisir au prompt de boot
<strong>boot dua2:</strong>, entrainant le boot de SIMH dans le
programme d'installation OpenBSD classique  :

<blockquote>
<pre>
# <strong>simh-vax openbsd.simh</strong>

VAX simulator V3.9-0
NVR: buffering file in memory
Eth: opened OS device tun0
Loading boot code from /usr/local/lib/simh/vax/ka655x.bin


KA655-B V5.3, VMB 2.7
Performing normal system tests.
40..39..38..37..36..35..34..33..32..31..30..29..28..27..26..25..
24..23..22..21..20..19..18..17..16..15..14..13..12..11..10..09..
08..07..06..05..04..03..
Tests completed.
&gt;&gt;&gt;<strong>boot dua2:</strong>
(BOOT/R5:0 DUA2



  2..
-DUA2
  1..0..


&gt;&gt; OpenBSD/vax boot [1.16] &lt;&lt;
&gt;&gt; Press enter to autoboot now, or any other key to abort: 0
&gt; boot bsd
</pre>
</blockquote>

Après avoir fini l'installation, relancez SIMH en saisissant cette fois-ci :

<blockquote>
<pre>
&gt;&gt;&gt;<strong>boot dua0:</strong>
</pre>
</blockquote>

afin de booter depuis votre image disque fraichement installée. Vous
aurez besoin d'un peu de patience pendant votre premier boot, lors de la
génération des clés SSH de l'hôte pouvant prendre un peu de temps. Mais
vous devriez finalement booter et voir apparaître un prompt login
familier :

<blockquote>
<pre>
OpenBSD/vax (noname.my.domain) (console)

login: 
</pre>
</blockquote>

Après avoir installé des paquetages additionnels, vous voudrez
peut-être retirer les lignes faisant référence à votre unité CD-ROM,
ainsi que <i>floppy53.fs</i> de votre fichier <i>openbsd.simh</i>.

<p>

Régalez-vous !

<hr>
<a href="vax.html">
<img height="24" width="24" src="../back.gif" border="0" alt="OpenBSD/vax">
</a> 
<br>
<small><a href="mailto:www@openbsd.org">www@openbsd.org</a></small>
<br>

<small>
<!--
Originally [OpenBSD: vax-simh.html,v 1.29 ]<br>
$Translation: vax-simh.html,v 1.30 2013/07/02 10:34:36 rustybsd Exp $<br>
-->
$OpenBSD: vax-simh.html,v 1.29 2013/07/03 20:10:17 ajacoutot Exp $
</small>

</body>
</html>
