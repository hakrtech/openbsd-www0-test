<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
   <TITLE>CTM</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<center>
<img alt="CTM for OpenBSD" src=../images/bsdctm.gif width=401 height=126>
</center>

<H3>Qu'est ce que ctm ?</H3>

<P>
Ctm est un système conçu par Poul-Henning Kamp pour distribuer les
changements effectués sur une arborescence de source tous les jours
par courrier électronique. C'est un bon moyen de rester à jour avec les
sources actuelles ou l'arbre cvs sur vous avez une mauvaise connexion
Internet (par exemple un modem).

<P>
Ctm utilise très peu de bande passante pour distribuer les changements
dans les sources et les compresse en utilisant gzip -9.

<H3>Comment est-ce que cela fonctionne ?</H3>

<P>
L'idée de ctm est que vous vous inscrivez à une liste de discussion
spécifique à une arborescence. Chaque jour vous recevez un message
électronique contenant les changements sur l'arbre pendant cette
période. Une série de différences est appelé un &quot;delta&quot;.

<P>
Vous commencer avec une série de base sur laquelle vous appliquerez
les deltas ultérieurs. Pour commencer avec ctm vous devez récupérer la
dernière série de base ainsi que tous les deltas suivants. Une fois
que vous avez traité tout ça, vous pouvez appliquer les deltas
ultérieurs au fur et à mesure de leur réception. La série de base est
découpée en morceaux de 1400k chacun pour permettre un téléchargement
aisé au travers des mauvaises connexions. Vous pouvez même les mettre
sur disquettes.

<P>
Les séries de base sont générées environ tous les 100 deltas, ce qui
fait que vous n'avez jamais plus de 100 deltas à récupérer.

<H3>Quel est la bande passante utilisée par ctm ?</H3>

<P>
Comme mentionné précédemment, la série de base contient toutes les
sources de l'arborescence au format TAR, ce qui peut être
volumineux. Vous devez obtenir cette série de base ainsi que tous les
deltas par ftp depuis les sites donnés ci-dessous. Les tailles sont :

<ul>
<li> environ 115Mo pour OpenBSD-cvs
<li> environ 37Mo pour OpenBSD-cvs-x11
<li> environ 65Mo pour OpenBSD-src
<li> environ 35Mo pour OpenBSD-src-x11
<li> environ 2Mo pour OpenBSD-ports
<li> Gardez à l'esprit qu'il s'agit de tailles compressées. Comptez
environ 5 fois ces valeurs pour les fichiers décompressés. 
<li> La taille des deltas varie de 10k à 100k et parfois quelques Mo.
<li> ctm découpe les deltas en messages de 100k qui sont ré-assemblés
automatiquement. 
</ul>

<P>
Des mises à jour plus grosse à travers ctm sont rares, et seulement
après une modification majeure des sources telle que binutils, perl...

<H3>Comment utiliser ctm ?</H3>

<UL>
<LI>Inscrivez vous aux listes de diffusion ctm pour les séries que
vous voulez.
<p>
   Il y a plusieurs listes de diffusion pour ctm. Il y a une liste
   pour les mises à jour des mises à jour de l'arborescence cvs, une
   liste pour l'arborescence des sources, deux pour X11 (sources et
   cvs), une pour les ports et une pour les messages du générateur de
   delta ctm.
   <p>
   Les commandes suivantes vous inscrirons aux listes appropriées :
<br><br><tt>
Pour l'arborescence cvs (sans la partie X11) : <br>
    <b>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</b><br>
Pour la partie X11 de l'arborescence cvs : <br>
    <b>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</b><br>
Pour l'arborescence des sources (sans la partie X11) : <br>
    <b>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</b><br>
Pour la partie X11 de l'arborescence des sources : <br>
    <b>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</b><br>
Pour l'arborescence des ports : <br>
    <b>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</b><br>
Pour la liste de messages ctm : <br>
    <b>echo subscribe ctm-log | mail majordomo@OpenBSD.org</b><br>
</tt><br>

<LI>Attendez jusqu'à l'arrivée de votre premier delta.

<LI>Décompressez et assemblez le delta en utilisant ctm_rmail.
<br>
<br>
<tt>
    <b>ctm_rmail -p. -d. -b. folder</b>
</tt>
<br><br>
où <b>folder</b> est le répertoire contenant les messages de delta.
<br>
Ceci décodera les deltas ctm et les placera dans le répertoire
courant. Le delta sera un fichier de la forme OpenBSD-XXX.YYYY.gz, où
XXX sera soit "src" soit "cvs", et YYYY le numéro du delta.
<p>

<li>Récupérez la série de base depuis les sites ftp ci-dessous, dans
le sous répertoire <b>base/OpenBSD-cvs</b> (pour OpenBSD-cvs) ou
<b>base/OpenBSD-src</b>  (pour OpenBSD-src). Récupérez tous les
fichiers dans ce répertoire, et une fois que vous les avez tous, vous
pouvez créer votre arborescence des sources avec la commande
suivantes :

<br><br>
<tt>
    <b>cd cible <br>
    cat /split/OpenBSD-* | tar zxf - <br>
</b></tt><br>

où <b>split</b> est le répertoire où vous avez placé les fichiers que
vous avez récupérés.

<p>
Il n'est pas nécessaire de garder ces fichiers, si vous êtes sur
d'avoir une arborescence complète. Cependant, assurez vous de noter le
numéro de la base avant de continuer. 

<p>
Maintenant, vous avez besoin de récupérer les deltas qui ont été
générés depuis la création de la série de base. Allez sur l'un des
sites FTP ci-dessous dans le sous répertoire <b>OpenBSD-cvs</b> ou
<b>OpenBSD-src</b> et récupérez tous les fichiers dont le numéro est
<it>plus grand</it> que le numéro de la base utilisée. 

<p>
Les adresses pour la série de base et les deltas sont :

<ul>
<li><a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
</ul>

<ul>
<li><a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
</ul>

<ul>
<li><a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/">
     ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm/
</a>
</ul>

<p>
<ul>
<li><b>REMARQUE :</b> Je suis très intéressé pour trouver d'autres
   sites à travers le monde qui pourrait héberger ces deltas.
</ul>
<p>

<LI> Lancez ctm.
<br>
  <br>
  <tt>
     <b>cd cible<br>
     ctm -v -v /deltas/OpenBSD-cvs.*</b><br></tt>
<br><tt>
où <b>target</b> est le répertoire où vous voulez placer votre
     arborescence cvs et <b>deltas</b> où vous avez placé vos deltas.
<p>
Cela prendra quelque temps à intégrer tous les deltas, mais les
utilisations journalières de <b>ctm_rmail</b> et <b>ctm</b> seront
plus courtes.
</ul>

<h3>Dois-je utiliser l'arborescence src ou cvs ?</h3>

<P>
Cela dépend de votre place disque entre autre. Étant donné que ctm
n'agit pas sur des fichiers qui ont été modifié en dehors du processus
ctm, le "meilleur" choix est sans doute l'arborescence cvs. De cette
façon, vous pouvez récupérer une arborescence src depuis votre
arborescence cvs et garder vos modifications locales dans votre
arborescence des sources, laissant ainsi ctm ne toucher qu'à votre
arborescence cvs.

<p>
Le désavantage par contre, est la quantité de place disque que cela
prend. Une arborescence des sources est d'environ 300Mo, mais si vous
avez une arborescence cvs, vous aurez besoin de 400Mo pour celle-ci,
<b>en plus</b> des 300Mo pour les sources.

<p>
Ceci ne compte pas les 100Mo ou plus nécessaires à une compilation (cela
dépend de l'architecture).

<p>
Si vous venez juste d'obtenir l'arborescence des source, vous aurez
besoin de gérer les modifications locales. Une manière de faire ceci
est d'utiliser le système de fichiers <b>union</b>, bien qu'il ait été
rapporté que le système de fichiers <b>union</b> peut être instable
si les couches inférieures et supérieures résident sur le même système
de fichiers physique. Si vous placez vos couches supérieures et
inférieures sur des systèmes de fichiers différents vous ne devriez
avoir aucun problème. Un exemple :

<p>
Supposons que votre arborescence mise à jour de ctm se trouve dans
<b>/usr/src-ctm</b> et que votre véritable arborescence des sources
(à partir de laquelle vous faites vos modifications et compilations)
se trouve dans <b>/usr/src</b>. <b>/usr/src</b> doit initialement être
un répertoire vide. La commande suivante va configurer votre union
mount :
<br><br>
<tt>
    <b>mount -t union -o -b /usr/src-ctm /usr/src</b>
</tt>
<br><br>
Les modifications faites aux fichiers se trouvant dans /usr/src
deviendront un fichier contenu dans /usr/src, masquant celui dans
src-ctm. Si des changements sont faits via ctm dans l'arborescence
src-ctm sous jacente, ces changements ne seront <b>pas</b> vus s'il y
a un fichier dans la couche supérieure les masquant.

<p>
Vous devriez démonter périodiquement l'union et chercher les fichiers
locaux au système de fichiers union. 
<br><br>
<tt>
    <b>umount /usr/src <br>
    find /usr/src -type f</b> <br>
</tt>
<br><br>
Les commandes <b>ls -W</b> et <b>rm -W</b> seront utiles aussi,
car les objets nommés "whiteouts" dans /usr/src cacheront aussi des
fichiers dans src-ctm.

<p>
Si vous avez l'arborescence cvs, vous pouvez utiliser la commande "cvs
checkout" pour en récupérer une arborescence des sources, et à chaque
fois que vous mettez à jour avec ctm, vous pouvez utiliser "cvs
update" pour mettre à jour votre arborescence des sources.

<br><br>
Pour obtenir votre arborescence src originelle :<br>
<tt>
    <b>cd /usr <br>
    cvs -qd VOTRE_ARBORESCENCE_CVS checkout src</b> <br><br>
</tt>
après chaque mise à jour ctm :<br>
<tt>
    <b>cd /usr/src <br>
    cvs -q update -PAd</b> <br>
</tt>

<H3>Est-ce que ctm est stable sous OpenBSD ?</H3>

Ctm est utilisé depuis plus d'un an par OpenBSD, et par FreeBSD depuis
plusieurs années. Ctm est stable et solide.

<H3>Plus d'informations</H3>

Si vous avez des problèmes avec ctm, un bon endroit pour démarrer est
le manuel FreeBSD :

<ul>
<li> <a href="http://www.FreeBSD.org/handbook/ctm.html">
         http://www.FreeBSD.org/handbook/ctm.html
     </a>
</ul>

Il y a aussi des pages de manuel pour tous les utilitaires ctm inclus
dans le package. Si vous avez OpenBSD, vous devriez avoir les pages
du manuel, les sources et les binaires. Sinon vous pouvez les obtenir
sur le même site ftp ci-dessous que les deltas.

<p>
Vous pouvez aussi contacter les listes de discussion OpenBSD ou
moi-même si vous avez des difficultés avec ctm, bien que mon temps
libre tend à être limité. 

<p>
Résumé :

<p>

<ul>
<li> Listes de discussion :

   <ul>
   <li> <b>echo subscribe OpenBSD-cvs | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-cvs-x11 | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-src | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-src-x11 | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe OpenBSD-ports-ctm | mail majordomo@OpenBSD.org</b>
   <li> <b>echo subscribe ctm-log | mail majordomo@OpenBSD.org</b>
   </ul>

<li> FTP (pour la série de base et les deltas; OpenBSD possède CTM
     dans son arborescence des sources, mais si vous n'avez pas les
     sources ou les binaires, les sources sont aussi ici) :

   <ul>
   <li> <a href="ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm">
         ftp://ctm.OpenBSD.org:/pub/OpenBSD-ctm
	   </a>
   <li> <a href="ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm">
         ftp://ctm.ca.OpenBSD.org:/pub/OpenBSD-ctm
	   </a>
   <li> <a href="ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm">
         ftp://ctm.se.OpenBSD.org:/pub/OpenBSD-ctm
	   </a>
   </ul>
</ul>

<p>
Je ferai les remarques et annonces importantes à propos de ctm dans :
<ul>
<li> misc@OpenBSD.org
<li> announce@OpenBSD.org
</ul>

<p>
<b>REMARQUE :</b> Si vous utilisez ctm pour OpenBSD, veuillez
m'envoyer un courrier électronique de façon à ce que je sache combien
de personnes l'utilise  !

<H3>Remerciements</H3>

<li> Poul-Henning Kamp (phk@FreeBSD.org) pour avoir rendu ctm possible
     et m'avoir aidé dans le processus de génération de deltas.

<li> Theo de Raadt (deraadt@theos.com) pour avoir rendu OpenBSD
     possible et m'avoir donné les ressources nécessaires dont j'avais
     besoin pour créer les premiers deltas ctm sur cvs.OpenBSD.org (maintenant
     ils sont générés ailleurs) et pour la magie du serveur de noms.

<li> Todd C. Miller (millert@OpenBSD.org) pour la mise en place et
     l'entretien des listes de discussion ctm.

<li> Bob Beck (beck@OpenBSD.org), Artur Grabowski (art@OpenBSD.org),
     Magnus Holmberg (mho@OpenBSD.org) et
     Wolfram Schneider (wosch@FreeBSD.org) pour la mise en place de
     l'espace ftp pour les séries de base et les deltas sur ctm.*OpenBSD.org

<li> ... et tous les autres qui ont contribués indirectement  ..
</ul>

<P>
Bonne chance !

<P>
t

<HR>

<ADDRESS><A HREF="mailto:graichen@OpenBSD.org">Thomas Graichen</A></ADDRESS>
<br>
Le logo OpenBSD/CTM a été dessiné pour le projet OpenBSD par 
   <a href="mailto:flipk@openbsd.org">Phillip F Knaack</a>.
<p>
<hr>
<a href="index.html"><img height="24" width="24" src="back.gif" border="0" alt="OpenBSD"
 /></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
</br>
<small>Originally [OpenBSD: ctm.html,v 1.12 2000/11/17 19:11:33 jufi Exp ]<br>
$Translation: ctm.html,v 1.5 2000/11/22 10:37:37 jjbg Exp $<br>
$OpenBSD: ctm.html,v 1.3 2000/11/22 17:48:01 jufi Exp $</small>
</body>
</html>

