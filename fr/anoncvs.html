<!DOCTYPE HTML PUBLIC  "-//IETF//DTD HTML Strict//EN">
<html>
<head>
<title>OpenBSD AnonCVS</title>
<link rev=made href=mailto:www@openbsd.org>
<meta name="resource-type" content="document">
<meta name="description" content="How to get OpenBSD updates via Internet using Anonymous CVS">
<meta name="keywords" content="openbsd,anoncvs,updates">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1996-1998 by OpenBSD.">
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#23238E">

<img alt="[OpenBSD]" height=30 width=141 SRC="../images/smalltitle.gif">
<p>
<h2><font color=#e00000>Le CVS anonyme</font><hr></h2>

<p>
<ul><h3>Table des matières</h3>
<li><a href="#anoncvs">Qu'est ce que le CVS anonyme ?</a>
<li><a href="#CVS">Qu'est ce que CVS ?</a>
<li><a href="#starting">Débuter avec le CVS anonyme.</a>
<li><a href="#using">Utiliser CVS(1) pour obtenir et mettre à jour les sources.</a>
<li><a href="#CVSROOT">Serveurs CVS anonymes disponibles.</a>
<li><a href="#CRYPTO">Obtenir les sources de la crypto par CVS(1).</a>
<li><a href="#EXAMPLE">Exemples d'usages de CVS(1).</a>
<li><a href="#WHICH">Utiliser rsh(1) ou ssh(1) ?</a>
<li><a href="#SUP">Faire un miroir du CVS avec sup(1).</a>
<li><a href="#MIRROR">Mettre en place un miroir anoncvs.</a>
</ul>
</p>
<hr>


<a name="anoncvs"></a>
<h3><font color=#0000e0>Qu'est ce que le CVS anonyme ?</font></h3>

<p>
Le CVS anonyme est une méthode qui permet de garder à jour votre copie
locale des sources d'OpenBSD. En plus de suivre les dernières
nouveautés du développement, il est aussi possible de suivre les
correctifs et les errata d'une version.
</p>

<p>
L'avantage majeur du CVS anonyme sur les autres techniques de mise à
jour est que cela fonctionne directement à partir d'un serveur central
où réside le code source ou d'un miroir. Cela vous permet d'avoir accès à
toutes les commandes de CVS pour intégrer et mettre à jour vos
changements avec d'autres changements dans les sources, d'effectuer
des diffs, de voir l'historique des changements et plein d'autres
types de requêtes.  </p>

<p>
Le projet OpenBSD a actuellement trois branches principales :
</p>

<ul>
        <li><b>src</b> - Contient tout le code source pour le système d'exploitation OpenBSD.
        <li><b>ports</b> - Contient les <a href="../ports.html">ports OpenBSD</a>.
        <li><b>www</b> - Contient les pages web OpenBSD. (dont celle-ci).
</ul>

<p>
Pour résumer, la force du CVS anonyme est que c'est un système de
contrôle du code source "tolérant". Il <strong>respecte</strong> les
changements que vous avez effectués dans vos sources et fait les
<strong>"meilleurs efforts"</strong> pour mettre à jour votre
arborescence des sources, plutôt que de vous faire une liste de
problèmes ésotériques à résoudre avant de pouvoir continuer.
</p>

<a name="CVS"></a>
<h3><font color=#0000e0>Qu'est ce que CVS ?</font></h3>

<p>
<a href="../why-cvs.html">
CVS est le système de contrôle du code source utilisé pour gérer les
sources d'OpenBSD.</a> Il met en oeuvre un "dépôt" central pour tout
le source officiellement disponible tout en permettant aux
développeurs de maintenir des copies locales du code source avec leurs
changements personnels. Les développeurs avec un "<b>accès en
écriture</b>" peuvent soumettre des changements directement dans les
sources d'OpenBSD, tandis que les utilisateurs du CVS anonyme ont un
"<b>accès en lecture</b>" et peuvent garder leurs copies des sources à
jour et émettre des requêtes vers le serveur.
</p>

<p>
La grande force de CVS est sa capacité à effectuer une intégration
intelligente des changements venant du serveur central contenant les
sources avec les changements que vous avez effectués dans votre copie
locale. Cela signifie que si vous faites des changements à un module
et que vous effectuez une mise à jour, vos changements ne seront pas
détruits. CVS fait en sorte d'intégrer les changements dans les
sources avec les changements que vous avez effectués.
</p>

<p>
Au cas où les changements ne peuvent pas être complètement intégrés,
CVS fournit une "chute en douceur", dans le sens qu'il vous fournit
des changements annotés à votre copie locale en préservant celle-ci et
continue de mettre à jour les autres sources comme demandé.
</p>

<a name="starting"></a>
<h3><font color=#0000e0>Débuter avec le CVS anonyme.</font></h3>

<p>
La dernière version de CVS est disponible chez <a
href="http://www.cyclic.com/CVS/Dev/code/">Cyclic</a>. Les versions plus
anciennes que 1.6 ne sont pas recommandées et pourraient ne pas
fonctionner. Si vous avez déjà OpenBSD d'installé, CVS est inclus.
</p>

<p>
Les personnes qui possèdent un CD d'OpenBSD y ont sans doute vu des
répertoires <i>CVS/</i>. La raison est que sur le CD se trouve une version
du module <b>src</b> d'OpenBSD utilisable pour faire des mises à
jour depuis un serveur CVS anonyme. Utiliser cette arborescence est
beaucoup plus rapide que de récupérer complètement les sources
d'OpenBSD. Il y a deux manières d'utiliser le CD :
</p>

<ul>
<li>Pour copier l'arborescence CVS depuis le CD vers <i>/usr/src</i>
(en supposant que le CD est monté sur /mnt):
<pre>
	# <b>cd /mnt; pax -rw CVS Makefile [a-z]* /usr/src</b>
</pre>
<li>Utiliser un "union mount" (voir <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_union&apropos=0&sektion=8&manpath=OpenBSD+Current&format=html">mount_union</a>)
avec le CD monté dans un répertoire autorisé en écriture. (Ne peut
être utilisé que si vous compilez depuis l'arborescence des sources)
<pre>
	# <b>mount -t union -o -b /mnt /usr/src</b>
</pre>
</ul>

<p>
Pour ceux qui n'ont pas de CD sous la main, vous pouvez utiliser <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1&format=html">cvs(1)</a>
pour récupérer les sources. C'est décrit dans la <a
href="#using">section suivante</a>.
</p>

<p>
Après ça, <i>/usr/src</i> sera un répertoire où les commandes <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1&format=html">cvs(1)</a>
fonctionneront correctement.
</p>

<a name="using"></a>
<h3><font color=#0000e0>Utiliser CVS(1) pour obtenir et mettre à jour les sources.</font></h3>

<p>
CVS a été mis au point dans le but d'être un moyen simple de récupérer
et de mettre à jour vos sources. Vous devez tout d'abord décider si
vous voulez suivre la branche <i>current</i> ou une branche de
correctifs (patch). L'arborescence current possède tous les derniers
changements et la branche correctifs contient une version d'OpenBSD
avec tous les correctifs de l'<a href="../errata.html">errata</a>
appliqués.

<p>Une fois que vous avez décidé quelle est la branche que vous voulez
suivre, vous devez sélectionner le serveur de CVS anonyme que vous
allez utiliser. Une liste de ces serveurs est disponible <a
href="#CVSROOT">ci-dessous</a>. Remarquez tout de même qu'il existe
trois possibilités pour accéder à ces serveurs.
</p>

<ul>
<li><b>ssh</b> - Secure Shell peut être utilisé pour accéder aux
serveurs de CVS anonymes. C'est la manière <b>recommandée</b> de faire
les choses, à cause du chiffrement. Depuis OpenBSD 2.6, OpenSSH est
inclus dans la distribution standard.  
<li><b>rsh</b> - Remote Shell peut être utilisé avec certains serveurs
pour les utilisateurs qui n'ont pas accès à <a
href="http://www.openssh.com">ssh</a> 
<li><b>pserver</b> - pserver est avant tout utile pour les
utilisateurs qui se trouvent derrière des pares-feu qui bloqueraient
les deux autres types de connexion.
</ul>

<p>
<b>REMARQUE :</b> - Pour les utilisateurs qui souhaitent utiliser ssh,
il faut d'abord définir la variable <i>CVS_RSH</i> à ssh.

<ul>
<li> Pour les shells Korn/Bourne.
<pre>
	$ <b>export CVS_RSH="/usr/bin/ssh"</b>
</pre>
<li> Pour les shells basés sur CSH.
<pre>
	$ <b>setenv CVS_RSH /usr/bin/ssh</b>
</pre>
</ul>

<p>
Une fois que vous avez choisi le <a href="#CVSROOT">serveur de CVS
anonyme</a> que vous allez utiliser, et quelle méthode vous allez
utiliser, vous pouvez démarrer. Pour ceux qui aurait le CD, vous
pouvez démarrer avec la version du CVS qui se trouve sur le CD avec
les méthodes décrites <a href="#starting">ci-dessus</a> pour installer
les sources sur votre système. Si vous n'avez pas le CD sous la main,
utilisez la méthode ci-dessous pour récupérer les sources. Cette
méthode place l'arborescence des sources d'OpenBSD dans
<i>/usr/src</i>.
</p>

<p>
<ul><pre>
# <b>cd /usr; cvs checkout -P src</b>
</ul></pre>
</p>

<p>
La méthode ci-dessus va récupérer (checkout) l'arborescence
<i>current</i> des sources. Beaucoup d'entre vous désirerons sûrement
une branche correctifs (patch) des sources. Pour récupérer une branche
patch, vous devez le spécifier avec votre commande (tag). Exemple :
</p>

<p>
<ul><pre>
# <b>cd /usr; cvs checkout -P -rOPENBSD_2_7 src</b>
</ul></pre>
Ou OPENBSD_2_6 pour 2.6, etc...
</p>

<p> Actuellement, seul le tag OPENBSD_2_7 contient les sources et les erratas sur les sources déjà appliqués.

<a name="CVSROOT"></a>
<h3><font color=#0000e0>Serveurs CVS anonymes disponibles.</font></h3>

<p>
Il existe deux niveaux d'accès à l'arborescence des sources :

<dl>
<dt><strong>Accès en lecture-écriture pour les développeurs :</strong>
<dd>Les développeurs qui ont besoin de soumettre des changements à
l'arborescence des sources doivent avoir un compte sur les machines
OpenBSD. Obtenir cet accès sera le résultat tout naturel du travail
effectué sur les sources avec d'autres développeurs OpenBSD. Si
quelqu'un fait du bon travail et montre qu'il peut travailler avec
l'équipe, il obtiendra un compte.
</dl>

<dl>
<dt><strong>Accès en lecture seule pour tout le monde :</strong>
<dd>N'importe qui peut accéder au CVS en lecture seule. Ces copies du
CVS en lecture-écriture sont réalisées relativement souvent. Pour en
utiliser un, il vous faudra définir votre variable d'environnement
<strong>CVSROOT</strong> avec l'une des valeurs suivantes :
<p>
<strong>Voyez la remarque ci-dessous en ce qui concerne l'utilisation de ssh contre rsh !</strong>
<p>
<ul>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs1.usa.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>anoncvs@anoncvs4.usa.openbsd.org</strong>.<br>
situé en California, ouest des USA.<br>
maintenu par <a href=mailto:millert@openbsd.org>Todd Miller</a>.<br>
protocoles : seulement pserver.<br>
mis à jour toutes les 4 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.usa.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>anoncvs3.usa.openbsd.org</strong>.<br>
situé à l'Université du Colorado, Boulder, ouest des USA.<br>
maintenu par <a href=mailto:Todd.Miller@cs.colorado.edu>Todd Miller</a>.<br>
protocoles : rsh, ssh, ssh port 2022, pserver.<br>
mis à jour toutes les 6 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs5.usa.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>squid.nas.nasa.gov</strong>.<br>
situé au Centre de recherches Ames, Moffett Field, Californie, USA.<br>
maintenu par <a href=mailto:allison@mail.arc.nasa.gov>Tyler Allison</a>.<br>
protocoles : seulement ssh.<br>
mis à jour toutes les 3 heures.<br>
<li><strong>CVSROOT=anoncvs@mirror.arc.nasa.gov:/cvs</strong><br>
situé au Centre de recherches Ames, Moffett Field, Californie, USA.<br>
maintenu par <a href=mailto:allison@mail.arc.nasa.gov>Tyler Allison</a>.<br>
protocoles : seulement ssh.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs6.usa.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>openbsd.citi.umich.edu</strong>.<br>
situé à l'Université du Michigan, centre des USA.<br>
maintenu par <a href=mailto:rees@umich.edu>Jim Rees</a>.<br>
protocoles : ssh, ssh port 2022.<br>
mis à jour toutes les 12 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs1.ca.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>anoncvs.ca.openbsd.org</strong>, <strong>openbsd.sunsite.ualberta.ca</strong><br>
situé à Edmonton, Alberta, Canada.<br>
maintenu par <A HREF="mailto:beck@ualberta.ca">Bob Beck</A><br>
protocoles : ssh, rsh, ssh port 2022, pserver<br>
mis à jour toutes les 2 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.uk.openbsd.org:/cvs</strong><br>
situé à Londres, UK.<br>
maintenu par <a href="mailto:peter@wonderland.org">Peter Galbavy</a>.<br>
protocoles : ssh.<br>
mis à jour toutes les 6 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs2.uk.openbsd.org:/cvs</strong><br>
situé à Londres, UK.<br>
maintenu par <a href=mailto:joe@hole-in-the.net>Joe Warren-Meeks</a>.<br>
protocoles : ssh.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.tw.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>OpenBSD.csie.NCTU.edu.tw</strong>.<br>
situé à Taipei, Taiwan.<br>
maintenu par <a href="mailto:lkchu@OpenBSD.csie.NCTU.edu.tw">Liang-Kai Chu</a>.<br>
protocoles : rsh, ssh, ssh port 2022.<br>
mis à jour toutes les 12 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.no.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>cvs.inet.no</strong>.<br>
situé en Norvège<br>
maintenu par <a href="mailto:cvsadmin@inet.no">Michael Shuldman</a>.<br>
protocoles : rsh, ssh, ssh port 2022.<br>
mis à jour toutes les 4 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.se.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>anoncvs.stacken.kth.se</strong>.<br>
situé en Suède.<br>
maintenu par <a href="mailto:anoncvs@stacken.kth.se">Magnus Holmberg</a>.<br>
protocoles : rsh, ssh, ssh port 2022.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.be.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>badlands.rug.ac.be</strong>.<br>
situé en Belgique.<br>
maintenu par <a href="mailto:wvdputte@reptile.rug.ac.be">Wim Vandeputte</a>.<br>
protocoles : ssh, ssh port 2022.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.calyx.nl:/cvs</strong><br>
situé à Amsterdam, aux Pays-Bas.<br>
maintenu par <a href="mailto:nick@calyx.net">Nick Merrill</a>.<br>
protocoles : ssh.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.jp.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>kankoromochi.econ.nagasaki-u.ac.jp</strong>.<br>
situé à l'Université de Nagasaki, Faculté d'Economie, Japon.<br>
maintenu par <a href="mailto:sigh@net.nagasaki-u.ac.jp">SUZUKI Hitoshi</a>.<br>
protocoles : ssh, pserver.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.cz.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>com-os2.ms.mff.cuni.cz</strong>.<br>
situé à la Faculté de Maths &amp; Physique, Université Charles, Prague, République Tchèque.<br>
maintenu par <a href="mailto:galambos@com-os2.ms.mff.cuni.cz">Leo Galambos</a>.<br>
protocoles : ssh, ssh port 2022.<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs1.au.openbsd.org:/cvs</strong><br>
Aussi connu comme <strong>anoncvs.au.openbsd.org</strong>, <strong>anoncvs.openbsd.aba.net.au</strong><br>
situé à Carlton, Victoria, Australie.<br>
maintenu par <A HREF="mailto:mwp@aba.net.au">Micheal Paddon</A><br>
protocole : ssh<br>
mis à jour toutes les 4 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@dolphin.mtmc.ru:/cvs</strong><br>
situé à Moscou, Russie<br>
maintenu par <A HREF="mailto:jc@mtmc.ru">John Chertihin</A><br>
protocoles : rsh, ssh<br>
mis à jour toutes les 24 heures (à 1 AM heure de Moscou)<br>
<p>
<li><strong>CVSROOT :pserver:anoncvs@gloup.linuxfr.org:/cvs</strong><br>
Aussi connu comme <strong>gloup.linuxfr.org</strong><br>
situé à Paris (Claranet), FRANCE<br>
maintenu par <A HREF="mailto:seisen@linuxfr.org">Fabien Seisen</A><br>
protocoles : pserver, ssh<br>
mis à jour toutes les 24 heures (à 2h GMT )<br>
<p>
<li><strong>CVSROOT :pserver:anoncvs@cvs.bsdfr.org:/cvs</strong><br>
situé en France<br>
maintenu par : <A HREF="mailto:jch@oleane.net">Jean-Claude Christophe</A><br>
protocole : pserver<br>
mis à jour toutes les 24 heures<br>
<p>
<li><strong>CVSROOT=anoncvs@grappa.unix-ag.uni-kl.de:/cvs</strong><br>
Situé à l'université de Kaiserslautern, Allemagne<br>
maintenu par <A HREF="mailto:hgw@d1906.inka.de">Hans Gunter
Weigand</A> et <A HREF="mailto:naddy@openbsd.org"> Christian
Weisgerber</A><br>
protocoles : rsh, ssh, ssh port 2022, pserver<br>
mis à jour tous les jours depuis cvsup.uk.openbsd.org<br>
<p>
<li><strong>CVSROOT=anoncvs@exokernel.lcs.mit.edu:/cvs</strong><br>
situé au M.I.T, est des USA.<br>
maintenu par  ????<br>
protocoles : ssh, ???<br>
mis à jour toutes les ? heures<br>
<p>
<li><strong>CVSROOT=anoncvs@xyzzy.gsnig.org:/cvs</strong><br>
situé à G&ouml;teborg, Suède<br>
maintenu par <A HREF="mailto:martin@openbsd.org">martin@openbsd.org</a><br>
protocoles : ssh port 2022<br>
mis à jour toutes les 4 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@stl-isaas.ey.com:/cvs</strong><br>
situé à St. Louis, MO, est des USA<br>
maintenu par <A HREF="mailto:aaron11@sprynet.com">Aaron Miller</A><br>
protocoles : ssh, ssh port 2022, pserver<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@openbsd.groupbsd.org:/cvs</strong><br>
situé à Hillsborough NC, Est des USA<br>
maintenu par <A HREF="mailto:jason@openbsd.org">Jason Wright</A><br>
protocoles : ssh<br>
mis à jour toutes les 4 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@anoncvs.mx.openbsd.org:/cvs</strong><br>
Situé sur le Campus Iztacala, Universidad Autonoma de Mexico<br>
maintenu par <A HREF="mailto:alex@iztacala.unam.mx">Alejandro Juarez</A><br>
protocoles : ssh<br>
mis à jour toutes les 3 heures.<br>
<p>
<li><strong>CVSROOT=anoncvs@headend-vlan1-cm19.fibertel.com.ar:/cvs</strong><br>
situé à Buenos Aires, Argentine<br>
maintenu par ????<br>
protocoles : ssh, ???<br>
mis à jour toutes les ? heures.<br>
</ul>


<p>
<EM>Remarque :</EM>, Si votre serveur est listé ici avec des
informations inexactes, veuillez contacter <A
HREF="mailto:beck@openbsd.org"><tt>beck@openbsd.org</tt></A>
</p>

<p>
Vous pouvez utiliser <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=traceroute&sektion=8&format=html">traceroute(8)</a>
pour trouver le serveur le plus proche de vous.  Les problèmes avec un
serveur doivent être adressés directement au <b>mainteneur</b> du
serveur en question.  </dl></p>

<a name="CRYPTO"></a>
<h3><font color=#0000e0>Obtenir les sources de la crypto par CVS(1).</font></h3>

<p>
<strong>REMARQUE IMPORTANTE :</strong>
Il existe quelques remarques au sujet des logiciels cryptographiques que tout le monde doit connaître :
<ul>
<li>Les sources d'OpenBSD viennent du Canada.  
Comme <a
href="http://insight.mcmaster.ca/org/efc/pages/doc/crypto-export.html">recherché
par un Canadien</a> et comme décrit dans la <a
href="http://axion.physics.ubc.ca/ECL.html">liste de contrôle des
exportations du Canada</a>, il est légal d'exporter les logiciels de
crypto depuis le Canada vers le reste du monde.
<p>
<li>Cependant, si vous êtes en dehors des USA et du Canada, vous ne
devez pas récupérer les parties cryptographiques des sources d'OpenBSD
depuis un serveur anoncvs situé aux USA. Les fichiers en question sont
:
<ul>
<li>src/kerberosIV/*
<li>src/lib/libdes/*
<li>src/lib/libc/crypt/crypt.c
<li>src/lib/libc/crypt/morecrypt.c
<li>src/sys/netinet
<li>src/usr.sbin/afs/src/rxkad/*
<li>X11/xc/lib/Xdmcp/Wraphelp.c
</ul>
A cause de la loi américaine sur l'exportation des armes (ITAR), les
logiciels de crypto ne peuvent être exportés qu'au Canada depuis les
USA.
<p>
<li>Le projet OpenBSD cherche plus de serveurs anoncvs, veuillez lire plus bas
pour savoir comment faire.
</ul>

<a name="EXAMPLE"></a>
<h3><font color=#0000e0>Exemples d'usages de CVS(1).</font></h3>

<p>
Un exemple d'utilisation d'un serveur anoncvs pourrait être :
<ul><pre>
% <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
% <strong>cd /tmp</strong>
% <strong>cvs get src/sys/arch/sparc</strong>
    [copie les fichiers depuis le serveur sur la machine]
% <strong>cvs log src/sys/arch/sparc/sparc/locore.s</strong>
    [montre le journal des commit pour le fichier donné]
% <strong>cvs diff -bc -r1.1 -r1.5 src/sys/arch/sparc/sparc/locore.s</strong>
    [Montre les changements entre les versions 1.1 et 1.5]
</pre></ul>

<p>
<a name=pserver>Pour pouvoir utiliser cvs avec ``pserver'' (une
connexion directe plutôt que l'utilisation de ssh ou rsh) vous devez
vous connecter :</a>

<ul><pre>
    [ *REMARQUE* Vous devez utiliser cvs version 1.8 ou supérieur pour faire ceci  ]
% <strong>setenv CVSROOT :pserver:anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
% <strong>cvs login</strong>
(Connexion à anoncvs@anoncvs1.ca.openbsd.org)
CVS password: <strong>anoncvs</strong>
    [Cela écrit une ligne dans ~/.cvspass (le nom de fichier est écrasé par CVS_PASSFILE).]
    [Une ligne d'exemple de mon ~/.cvspass après avoir tapé 'blah'           ]
    [password is:                                                            ]
    [:pserver:anoncvs@anoncvs5.usa.openbsd.org:/cvs Au'yc                    ]
    [...après s'être connecté une fois, le CVSROOT ci-dessus fonctionnera    ]
% <strong>cvs get ksrc-i386 ksrc-common</strong>
    [vous permet de ne récupérer QUE ce qui est nécessaire pour créer un noyau i386 ]
</pre></ul>

<p>
Voici comment quelqu'un qui utilise anoncvs met à jour son
arborescence des sources : 
<ul><li>Tout d'abord il faut commencer par récupérer une arborescence
initiale : 

<p> (Si vous suivez <i>current</i>):
<ul><pre>
# <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
# <strong>cd /usr</strong>
# <strong>cvs -q get -PA src</strong>
</pre></ul>

<p> (Si vous suivez la branche des correctifs pour 2.7) :
<ul><pre>
# <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
# <strong>cd /usr</strong>
# <strong>cvs -q get -rOPENBSD_2_7 -P src</strong>
</pre></ul>
</li>

<li> Ensuite, pour mettre à jour cette arborescence :
<p> (Si vous suivez <i>current</i>):
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -q up -PAd</strong>
</pre></ul>

<p> (Si vous suivez la branche des correctifs pour 2.7) :
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -q up -rOPENBSD_2_7 -Pd</strong>
</pre></ul>

À chaque fois que vous lancerez ceci, cela synchronisera votre
arborescence /usr/src. Cela ne détruira aucun de vos changements
locaux, mais tentera d'y intégrer les changements. Si vous utilisez
les répertoires obj (pas les liens symboliques obj), vous pouvez
passer l'option "-I obj" sur la ligne de commande, qui permettra
d'éviter que cvs n'émette un avertissement au sujet de tous les
répertoires obj qu'il va rencontrer et qui ne se situent pas sur le
serveur.

<p>
<li> REMARQUES : si vous mettez à jour vos sources depuis un serveur
autre que celui d'où vous avez récupéré les sources (ou depuis le CD),
vous <strong>devez</strong> ajouter l'option <em>-d $CVSROOT</em> au
cvs. Vous devez aussi définir la variable d'environnement
<em>CVS_IGNORE_REMOTE_ROOT</em>. Si vous suivez une branche de
correctifs (patch), veuillez <strong>enlever</strong> l'option
<code>-A</code> de cvs, ou vous allez vous mettre à suivre
<i>current</i>.

<p> (Si vous suivez <i>current</i>) :
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -d $CVSROOT -q up -PAd</strong>
</pre></ul>

<p> (Si vous suivez la branche des correctifs) :
<ul><pre>
# <strong>cd /usr/src</strong>
# <strong>cvs -d $CVSROOT -q up -Pd</strong>
</pre></ul>

</li>
</ul>

<p>
Pour <a name=ports>utiliser</a> les <a href=../ports.html>ports</a>,
il faut procéder de la même façon qu'avec src : <ul><li>
<pre>
# <strong>setenv CVSROOT anoncvs@anoncvs.ca.openbsd.org:/cvs</strong>
# <strong>cd /usr</strong>
# <strong>cvs -q get -PA ports</strong>
</pre>
</li>
<li> Ensuite, pour mettre à jour l'arborescence :
<pre>
# <strong>cd /usr</strong>
# <strong>cvs -q up -PAd ports</strong>
</pre>
</li>
</p>
</ul>

Dans l'exemple précédent, <i>-q</i> est optionnel, et n'est là que
pour minimiser la sortie cvs. Pour ceux qui aime avoir des écrans bien
pleins, il peut être enlevé.

<p>
ou pour faire un diff sur un module corrigé en local (ici <i>cd.c</i>)
à inclure avec un rapport de bug : 
<ul><pre>
# <strong>cd /usr</strong>
# <strong>cvs diff -u src/sys/scsi/cd.c > /tmp/patch</strong>
</pre></ul>
</p>

<p>
La page du manuel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&sektion=1&format=html">CVS(1)</a>
(inclue avec les sources de CVS) a beaucoup plus d'informations sur la
manière d'utiliser CVS.

<p>
<strong>Arborescence des sources X11</strong>
<br>
Les miroirs anoncvs comportent aussi l'arborescence des sources
X11. Vous pouvez adapter les recettes ci-dessus pour mettre à jour
votre arborescence des source X11 depuis le deuxième CD. Vous pouvez
soit copier soit utiliser un union mount pour obtenir les sources de
X11 dans <i>/usr/X11</i> :

<ul>
<li>Copier l'arborescence directement (en supposant que le deuxième CD
est monté sur /mnt) :
<pre>
        # <strong>cd /mnt; cp -Rp X11 /usr</strong>
</pre>
<li>utiliser un union mount avec le CD monté dans un répertoire en écriture.
<pre>
        # <strong>mount -t union -o -b /mnt/X11 /usr/X11</strong>
</pre></ul>

Après ça, <i>/usr/X11</i> sera près à être utilisé par cvs. Vous
pouvez par exemple le mettre à jour avec les sources -current (en
supposant que vous avez déjà prédéfinit la variable d'environnement
<b>CVSROOT</b>) :

<ul><pre>
        # <strong>cd /usr/X11</strong>
        # <strong>cvs -q update -PAd</strong>
</pre></ul>

<p>
<strong>Avertissement :</strong> Quand vous utilisez cvs il vous
faudra prendre garde que votre répertoire courant est soit la racine
de l'arborescence des ports ou une autre place telle que
/tmp. Quelques commandes telles que "get" peuvent créer une
sous-arborescence arbitrairement dans le répertoire courant, et chaque
mise à jour successive ira mettre à jour cette sous-arborescence.

<p>
Le serveur anoncvs donne une chance aux apprentis développeurs
d'apprendre les opérations cvs et de devenir ainsi impliqué dans le
développement des sources avant d'obtenir un accès "commit". De plus,
les gens fournissant des correctifs peuvent les créer avec des diffs
relatifs à l'arborescence CVS, ce qui facilitera l'intégration.

<a name="WHICH"></a>
<h3><font color=#0000e0>Utiliser rsh(1) ou ssh(1) ?</font></h3>

<p>
<strong>Anoncvs : rsh contre ssh</strong>
<br>
Par défaut, le client CVS utilise rsh pour communiquer avec un serveur
CVS. De nombreux sites CVS ne supportent plus rsh pour des raisons de
sécurité ou à cause d'un pare feu ou d'un mauvais relais protocolaire.
L'alternative est d'utiliser une connexion avec "secure shell" en
utilisant soit : <a href=http://www.openssh.com>OpenSSH (*GRATUIT ET
LIBRE*)</a> or <a href=http://www.cs.hut.fi/ssh/>ssh (non commercial
et commercial)</a>.

<p>
Les serveurs anoncvs OpenBSD supporte le protocole SSH1 mais pas le
protocole SSH2 à cause d'une "politique de licence strictement non
commerciale".

<p>
Une fois que ssh est installé, il faut définir la variable
d'environnement <strong>CVS_RSH</strong> pour pointer sur ssh
(typiquement <strong>/usr/bin/ssh</strong>). Si votre site vous
empêche les connexions vers le port 22 (ce que ssh utilise par défaut)
utilisez le port 2022.

<p>
Il n'est pas nécessaire d'activer la compression étant donné que CVS
compresse déjà. Utilisez quelque chose de semblable à la ligne
suivante dans votre fichier
<strong>$HOME/.ssh/config</strong>. Remarquez que tous les serveurs
anoncvs n'autorise pas l'accès par le port 2022 et que la plupart des
serveurs n'accèpte plus l'algorithme de chiffrement
<strong>none</strong> étant donné qu'il est désactivé dans les
versions récentes de ssh pour des raisons de sécurité.
<pre>
	Host anoncvs.ca.openbsd.org
	    Port 2022
</pre>

<p>
CVS est un peu "bruyant" au démarrage, pour éviter ceci, il peut être
utile de définir ceci :

<ul><pre>
<strong>setenv CVS_CLIENT_PORT -1</strong>
</pre></ul>

<p>
Si vous souhaitez changer de serveur CVS pour un autre (votre serveur
habituel est tombé, ou pour d'autres raisons), la variable
d'environnement suivante doit être définie :

<ul><pre>
<strong>setenv CVS_IGNORE_REMOTE_ROOT</strong>
</pre></ul>

Remarquez que vous aurez aussi besoin de l'option <strong>-d</strong>
comme spécifié auparavant.

<a name="SUP"></a>
<h3><font color=#0000e0>Faire un miroir du CVS avec sup(1).</font></h3>

<p>
Les utilisateurs qui veulent faire un miroir de l'arborescence CVS
d'OpenBSD peuvent le faire depuis
<em>anoncvs.usa.openbsd.org</em>. Remarquez qu'il s'agit de
l'arborescence cvs, et <b>pas</b> de l'arborescence des sources. C'est
utile uniquement si vous voulez faire des opérations cvs de façon
rapide (diff, annotation, etc...) ou si vous avez de multiples
arborescences de sources et que vous voulez ne transférer les données
qu'une seule fois (vous pouvez ensuite récupérer une arborescence des
sources à partir de votre miroir cvs local).
<p>
Un exemple de fichier sup pourrait être :
<pre>
	cvs host=anoncvs.usa.openbsd.org hostbase=/ base=/home delete
</pre>
<p>
qui va créer un miroir de l'arborescence des ports dans /home/cvs
avec les fichiers de données sup dans /home/cvs. L'arborescence du CVS
OpenBSD est juste en dessous de 1 Go.

<a name="MIRROR"></a>
<h3><font color=#0000e0>Mettre en place un miroir anoncvs.</font></h3>

<p>
Si vous souhaitez être un site miroir anoncvs, contacter le <a
href="mailto:sup@openbsd.org">mainteneur</a> anoncvs. Les miroirs
Anoncvs nécessite 1 Go de disque et peuvent utiliser jusqu'à 4 Mo de
swap par utilisateur anoncvs (en supposant que l'utilisateur fasse une
opération d'envergure, de plus petites opérations nécessiteront moins
de ressources, mais dans tous les cas, anoncvs utilise beaucoup plus
de ressources que sup ou ftp). De telles machines anoncvs se doivent
d'avoir une excellente connexion réseau pour la zone qu'elles ont
l'intention de servir. Un <a href="../anoncvs.shar">document</a> qui
décrit comment mettre en place les serveurs anoncvs est disponible.

<h3><font color=#0000e0>Remarques finales :</font></h3> Après avoir
mis à jour l'arborescence des sources, vous pouvez lire les
commentaire en haut de <KBD>/usr/src/Makefile</KBD> avant d'essayer de
compiler. De plus vous devez construire un nouveau noyau
<strong>avant</strong> de faire un <KBD>make build</KBD> si
possible. Dans certains cas, il est indispensable de reconstruire et
installer l'utilitaire <KBD>config</KBD> avant de reconstruire le
noyau. Si <KBD>config GENERIC</KBD> ne fonctionne pas, c'en est
probablement la cause.
<p>
Il est important de noter que mettre à jour d'une version d'OpenBSD
vers une arborescence courante (current) est difficile à cause des
dépendances qui ne sont pas toujours évidentes. Il est donc conseillé
d'installer tout d'abord le dernier snapshot avant de tenter de
recompiler les sources.

<hr>
<a href="index.html"><img height=24 width=24 src="../back.gif" border=0 alt=OpenBSD></a> 
<a href=mailto:www@openbsd.org>www@openbsd.org</a>
<br><small>Originally [OpenBSD: anoncvs.html,v 1.121 2000/11/09 04:56:48 deraadt Exp ]<br>
$Translation: anoncvs.html,v 1.17 2000/11/10 14:48:09 jjbg Exp $<br>
$OpenBSD: anoncvs.html,v 1.8 2000/11/10 18:15:41 jufi Exp $</small>

</body>
</html>

