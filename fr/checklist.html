<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="resource-type" content="document">
<meta name="description" CONTENT="How to make/update an OpenBSD port.">
<meta name="keywords" content="openbsd,ports">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 1998-2004 by OpenBSD.">

<title>Portage logiciel sous OpenBSD</title>
</head>
 
<body text="#000000" bgcolor="#FFFFFF" link="#23238E">
<a href="index.html"><img alt="[OpenBSD]" height="30" width="141" src="../images/smalltitle.gif" border="0"></a>

<h2><font color="#e00000">Points à vérifier pour chaque
    portage logiciel sous OpenBSD</font></h2>

Ce document décrit comment concevoir ou mettre à jour un
&quot;port&quot;. Il s'agit essentiellement d'une liste utile à
consulter à chaque fois, mais elle n'est ni complete, ni parfaite. Nous
vous invitons donc à proposer vos commentaires et questions à l'adresse
suivante : <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>.

<hr>
<ol>

<li> 
Si vous voulez prendre en charge la gestion d'un portage logiciel, inscrivez-
vous via :
<a href="mailto:ports@openbsd.org">ports@openbsd.org.</a>
<ul><li>
Cette liste est consacrée à toutes les discussions et votre inscription
y est fortement recommandée.
<li>
La lecture des envois précédents sur cette liste est essentiel : des
annonces ou explications cruciales s'y trouvent.
<li> 
Vous pourrez y cotoyer des personnes expérimentées dans ce domaine. Ils
pourront vous offrir des conseils ou tester vos portages.
</ul> 

<br><li>
Prendre en charge la gestion d'un portage signifie <b>beaucoup plus
</b>que de proposer des logiciels. Pour chaque logiciel, vous vous
engagez à maintenir vos portages <b>à jour</b> et répondre aux questions
des utilisateurs qui les utiliseront : comment activer ou désactiver
certaines fonctionnalités, etc.

<br><br><li>
Votre décision prise, vous devez obtenir une copie locale sur votre
disque de l'arbre des ports à l'aide de <b>cvs</b>. Comment le faire ?
Vous trouverez toutes les informations requises dans la page consacrée à
<a href="anoncvs.html">AnonCVS</a>.

<br><br><li> 
Choisissez dans quel dossier sera placé votre portage et créez
l'infrastructure de base requise. Utilisez le fichier Makefile modèle
<code>/usr/ports/infrastructure/templates/Makefile.template</code>.
NEED_VERSION est considéré comme <b>obsolète</b> et vous ne devez plus
l'utiliser pour les nouveaux portages : mettez à jour votre arbre local
des ports, ceci incluant bsd.port.mk.

<ul><li> 
Créez le répertoire <code>pkg</code>. 
<li> 
Créez des fichiers vides <code>pkg/DESCR, pkg/PLIST</code>. 
</ul>

<br><li> 
Ajoutez les portions &quot;fetch&quot; (de récupération) au Makefile.
<ul><li> 
Modifiez EXTRACT_SUFX si le suffixe des fichiers n'est pas .tar.gz.
D'autres exemples sont .tar.Z ou .tgz.
<li> 
Modifiez DISTNAME : cette variable locale doit contenir le nom du
fichier, sans son suffixe. Par exemple si votre portage logiciel est
foo-1.0.tar.gz alors DISTNAME doit contenir la chaîne : foo-1.0.
<li> 
Modifiez MASTER_SITES pour contenir l'URL des répertoires qui
contiennent un exemplaire du fichier portant les sources. Par exemple il
peut s'agir de l'adresse ftp://ftp.openbsd.org/pub/OpenBSD/distfiles/.
<strong>N'oubliez pas la barre finale de l'adresse !</strong> Essayez
d'avoir au moins trois sites différents pour chacun de vos portages. Le
site le plus fiable et rapide doit se trouver en première position.
<li> 
Gardez à l'esprit que les variables locales suivantes sont utilisées
pour identifier le fichier à récupérer et dans cet ordre :
${MASTER_SITES}${DISTNAME}${EXTRACT_SUFX}. Toutes ces variables seront
utilisées. Il ne faut pas que DISTNAME contienne en conséquence le nom
complet du fichier.
<li> 
Vous pourrez vérifier que vous avez fixé correctement ces variables en
utilisant la commande :
<b>make fetch-all</b>.
</ul>
<p> 
Certains portages logiciels sont complexes et pour simplifier votre
tâche, des outils supplémentaires sont à votre disposition :
<ul><li> 
Vous pouvez utiliser la variable locale PATCHFILES. Cette dernière doit
contenir une liste de patch proposés par l'auteur du logiciel (et non
OpenBSD). On y trouve généralement des correctifs de fiabilité ou de
sécurité.
<li> 
Si vos ports sont disponibles au sein de sites miroirs majeurs tels que
GNU, SunSite ou CPAN, nous proposons une liste de sites au sein du
fichier /usr/ports/infrastructure/templates/network.conf.template.
Modifiez MASTER_SITES par : ${MASTER_SITE_GNU} ou
${MASTER_SITE_SUNSITE}, etc. Pour simplifier ce processus, utilisez la
construction ${MASTER_SITE_FOO:=subdir/} pour rajouter le sous-
répertoire contenant la distribution.
<li> 
Chaque portage contient une version spécifique d'un logiciel. Une fois
les fichiers récupérés, on vérifie un hachage pour s'assurer de leur
intégrité et la comparaison sera effectuée à partir des hachages que
<b>vous </b>aurez calculés. Pour éviter toute confusion, DISTFILES et
PATCHFILES doivent avoir des numéros de version clairement identifiables
: ne récupérez pas de fichier foo-latest.tar.gz s'il existe un lien vers
foo-1.0.5.tar.gz. Si c'est nécessaire, contacter l'auteur du logiciel
afin de lui demander conseil et expliquez poliment pourquoi vous devez
pouvoir identifier clairement un numéro de version dans le fichier
contenant les sources de votre portage en devenir.
<li> 
Si votre portage logiciel requiert plus de 5 DISTFILES + PATCHFILES pour
fonctionner, utilisez la variable locale DIST_SUBDIR pour éviter de
polluer et de rendre complexe la lecture de /usr/ports/distfiles par les
utilisateurs (et déterminer qui fait partie de quoi).
<li> 
DIST_SUBDIR ne <b>doit pas </b>référencer de numéros de version. Lorsque
le portage sera mis à jour vers une nouvelle version, seuls les fichiers
contenant les sources doivent être modifiés : si DIST_SUBDIR est
modifié, tous les fichiers seront à nouveau récupérés. Il faut penser à
l'utilisateur qui doit maintenir son système ou tout du moins pouvoir en
consulter l'état sans s'égarer.
<li> 
A la fois DISTFILES et PATCHFILES ne proviennent pas nécessairement des
mêmes sites MASTER_SITES. Il est possible de définir des sites
supplémentaires à l'aide des variables locales MASTER_SITES0 à
MASTER_SITES9. Il vous suffit d'écrire DISTFILES=foo-1.0.5.tar.gz:5 pour
récupérer le fichier depuis le site contenu dans MASTER_SITES5 (notez le
&quot;:5&quot;).
<li> 
Certains portages n'ont pas besoin de récupérer tous les fichiers en
toute circonstance. Par exemple, les options de compilation de certains
portages logiciels définissent ce qui doit être compilé ou non, des
sortes de &quot;modules&quot; optionnels. Si une fonctionalité présente
dans un module n'est pas utilisée, alors il n'est pas nécessaire de
récupérer tous les fichiers mais uniquement ceux qui sont requis.
Certains composants sont également spécifiques à certaines architectures
matérielles : tous ces fichiers optionnels doivent être référencés dans
la variable locale SUPDISTFILES. Lorsque des cibles de compilation
telles que makesum ou mirror-distfiles sont utilisées, le système des
Ports veillera à récupérer tous les fichiers optionnels même si ceux-ci
ne sont pas toujours requis par l'utilisateur classique.
</ul>

<br><li> 
Créez des hachages dans <i>distinfo</i> en tapant <b>make makesum</b>.
Vous <b>devez </b>ensuite vérifier que ces hachages sont valides en
tapant <b>make checksum</b>.
<ul><li> 
Dans de rares cas, il n'est pas possible de disposer de hachages pour
tester l'intégrité des sources. Il est de votre
<b>responsabilité </b>d'essayer de trouver par tous les moyens possibles
un site d'archive fiable. Communiquer avec l'auteur ou les auteurs du
logiciel et la ou les personnes en charge des sites contenant les
archives du logiciel est fondamental et recommandé. Dans le pire des
cas, vous pourrez utiliser la variable locale IGNOREFILES pour marquer
les fichiers pour lesquels il n'est pas possible de disposer de hachages
d'intégrité fiables.
<li> 
Tous les fichiers de DISTFILES seront traités durant la phase
d'extraction. EXTRACT_ONLY peut-être utilisé pour limiter l'extraction
aux seuls fichiers requis (peut être vide). L'usage habituel de cette
variable est de personnaliser l'extraction : par exemple, si certains
DISTFILES doivent subir un traitement particulier, il seront retirés de
EXTRACT_ONLY et gérés manuellement après la phase d'extraction. Pour des
raisons historiques, make extract fixe le répertoire de travail pendant
l'extraction des fichiers. Ainsi, il est très inhabituel de fournir des
chemins de pré-extraction et post-extraction différents (et c'est même
un comportement suspect, indiquant un camouflage important au sein du
portage).
<li> 
Les correctifs qui demandent un traitement particulier doivent être
mentionnés dans DISTFILES et retirés de EXTRACT_ONLY, pour des raisons
historiques.
</ul>

<br><li>
Testez l'extraction du portage à l'aide de la commande <b>make
extract</b>. Vous devez vérifier avec soin où se trouve la base des
sources. Il s'agit normalement de <i>w-
${PKGNAME}${FLAVOR_EXT}/${DISTNAME}</i>. Vous aurez peut-être besoin de
modifier la variable WRKDIST du Makefile si cette base de sources est
différente.

<br><br><li>
Lisez la documentation d'installation et notez que la construction du
port doit être complétée et doit prendre en compte toute option spéciale
requise.

<br><br><li>
Maintenant vous devez prendre le temps de considérer sérieusement et
avec un grand soin les licences (ou la licence) qui couvre votre portage
logiciel. Certains logiciels peuvent être redistribués librement, mais
pas tous. Afin de vous aider, vous devez répondre à quatre questions. Il
s'agit des variables PERMIT_* que vous trouverez au sein du fichier
Makefile.

<ul><li>
PERMIT_PACKAGE_CDROM indique si le portage peut être distribué sur
support CD-Rom.
<li>
PERMIT_PACKAGE_FTP indique si le portage peut être placé sur des sites
FTP.
<li>
PERMIT_DISTFILES_CDROM indique si nous avons le droit de placer en
miroir les distfiles sur support CD-Rom.
<li>
PERMIT_DISTFILES_FTP indique si nous avons le droit de placer les
distfiles en miroir sur des sites FTP.
</ul>
<p>
A chaque fois que l'un de ces usages est autorisé, indiquez
&quot;Yes&quot;. Si ce n'est pas le cas, vous devez expliquer pourquoi
dans une chaîne commentaire. Soyez <b>attentif (attentive) </b>aux
conditions spéciales qui sont imposées <b>après </b>l'installation du
logiciel. Par exemple, une série de logiciels impose qu'un exemplaire de
leur licence soit installée et mentionnée à l'utilisateur. Dans ce cas,
nous vous recommandons de mettre la licence dans
<code>/usr/local/share/doc/&lt;name&gt;/</code>.
<p>
En plus des valeurs PERMIT_*, mettez un indicateur de license tel que
<code># License</code> au dessus de ces valeurs en commentaire. Ainsi,
nous saurons pourquoi les valeurs PERMIT_* sont positionnées de cette
manière.

<br><br><li>
Ajoutez les options de configuration au Makefile et créez un script de
configuration au besoin.
<ul><li>
Vous pouvez ajouter un script de configuration de votre portage nommé
`configure' et le situer dans un répertoire <code>scripts/</code>. Ce
script sera exécuté avant toute configuration spécifiée par la variable
locale CONFIGURE_STYLE.
<li>
Si le configure GNU est utilisé, vous devriez utiliser ./configure
--help afin de déterminer quelles options sont disponibles.
<li>
Tout ce que vous pourriez être amené à modifier peut être modifié en
utilisant le drapeau de configuration -option dans le paramètre
CONFIGURE_ARGS du fichier Makefile.
<li>
Utilisez CONFIGURE_ARGS+= pour rajouter une ou plusieurs options à cette
variable locale. Si vous utilisez CONFIGURE_ARGS= vous risquez d'écraser
tout contenu préalable.
</ul>

<br><li>
Essayez de construire le portage logiciel à l'aide de la commande
<b>make build</b>.
<ul><li>
Si vous avez de la chance, tout sera construit sans la moindre erreur
(bonne chance !)
<li>
Si vous obtenez une erreur, vous devrez générer un ou plusieur patch qui
seront utiliés par votre portage, afin de permettre sa compilation et
installation sous OpenBSD. Déterminez ce qui doit être modifé, et créez
un patch.
<li>
Les correctifs doivent toujours s'appliquer depuis la base ${WRKDIST}.
<li>
Le moyen le plus facile de vérifier que le correctif fonctionne est de
tout &quot;nettoyer&quot; à l'aide de <b>make clean patch</b>. Cette
commande va nettoyer le répertoire de travail de tout fichier, faire à
nouveau l'extraction et appliquer votre correctif.
</ul>

<br><li>
Commencez un cycle de <b>make build</b>, puis produisez un patch (ou
utilisez <b>make update-patches</b>) puis <b>make clean patch</b>.

<ul><li>
Les correctifs doivent être placés dans <i>patches/</i> et doivent être
nommés patch-* où vous remplacerez * par quelque chose de
compréhensible. Nous vous recommandons de nommer vos patch patch-
FILENAME où FILENAME est le nom du fichier qui sera modifié par le
correctif. (<tt>make update-patches</tt> le fait automatiquement pour
vous)
<li>
Appliquer PATCHFILES est la première étape du stade des patch. Vous
pouvez l'invoquer séparément à l'aide de make distpatch, une cible utile
pour les porteurs d'applications. Vous pouvez ignorer cette étape si
vous n'avez pas fixé de valeur à cette variable.
<li>
Chaque fichier de patch ne doit modifier qu'un seul fichier à la fois.
S'il-vous-plaît.
<li>
Utilisez <b>make update-patches</b> pour générer les correctifs.
<li> 
Tous les correctifs DOIVENT être relatifs à ${WRKDIST}.
<li> 
Vérifiez que les correctifs <b>NE CONTIENNENT PAS </b>de tags qui
risquent d'être modifiés par cvs. Si c'est le cas, vos correctifs ne
pourront plus s'appliquer après une mise à jour via cvs. Vous pouvez
vérifier les changements potentiels à l'aide de -kk pour l'éviter.
<li> 
Ecrivez une petite note explicative au début du fichier contenant le
correctif décrivant le role de ce dernier (non obligatoire).
<li> 
<b>Veuillez fournir un exemplaire </b>de vos correctifs à l'auteur du
logiciel.
</ul>
<br><li>
Essayez de paramétrer <code>SEPARATE_BUILD</code>. 
<ul><li>
Si le portage peut construire des fichiers objets en-dehors de l'arbre
des sources, cela est préférable et permet de conserver l'arbre des
sources dans un état plus &quot;propre&quot; (de nombreux programmes qui
utilisent <code>CONFIGURE_STYLE=gnu</code> le peuvent) et cela simplifie
en outre la gestion de l'arbre de sources sur plusieurs architectures.
<li>
Ceci peut vous épargner des efforts et vous permettre de relancer
facilement un cycle de construction du portage depuis le
<code>configure</code>.
</ul>

<br><li>
Parcourez avec attention la sortie obtenue (s'il y en a) et modifiez
toute option utile dans le Makefile. Pour répéter la commande utilisez
`<b>make clean configure</b>'.
<p>
Note: vérifiez que les fichiers dépendants de l'hôte soient placés soit
dans <i>/etc</i> ou <i>/etc/&lt;name&gt;</i>, mais <strong>NE REMPLACEZ
NI NE MODIFIEZ JAMAIS<b> </b></strong>de fichiers existants dans /etc.
Il vaut mieux placer ces fichiers dans
<i>/usr/local/share/&lt;name&gt;</i> puis copiez vers <i>/etc</i> ou
<i>/etc/&lt;name&gt;</i> seulement si les fichiers n'existent pas. Si
les fichiers existent, affichez un message et indiquez à l'utilisateur
du système quels fichiers doivent être modifiés. Cela permet également
de garantir que les fichiers seront inclus dans le paquetage puisque
tout ce qui se trouve dans <i>/usr/local</i> sera inclus dans PLIST. Une
fois un paquetage installé, le contenu de <code>pkg/MESSAGE</code> sera
affiché et le cycle de construction du paquetage sera terminé.

<p>
OpenBSD situe les fichiers comme suit : 
<pre>
   exécutables utilisateur :                                 /usr/local/bin
   exécutables de l'administrateur :                         /usr/local/sbin
   programmes exécutables :                                  /usr/local/libexec
   librairies :                                              /usr/local/lib
   données indépendantes de l'architecture :                 /usr/local/lib/&lt;nom&gt;
   fichiers inclus installés :                               /usr/local/include ou /usr/local/include/&lt;nom&gt;

   données spécifiques à la machine :                        /etc ou /etc/&lt;nom&gt;
   état local :                                              /var/run
   fichiers contenant les scores des jeux :                  /var/games
   fichiers info GNU :                                       /usr/local/info
   pages man :                                               /usr/local/man/...
   données indépendantes de l'architecture en lecture seule :/usr/local/share/&lt;nom&gt;
   documentations diverses :                                 /usr/local/share/doc/&lt;nom&gt;
</pre>

<li>
Commencez un cycle de compilations jusqu'à ce que le portage soit
terminé. Patchez (voir ci-dessus), puis clean et make jusqu'à la
production du portage. Vous devez <b>éliminer tous les "warning"</b>
obtenus en particulier ceux en rapports avec la sécurité du code
produit.

<br><br><li>
Contrôlez la sémantique de SEPARATE_BUILD. Vous ne devez le faire que
si votre portage utilise la variable locale SEPARATE_BUILD. Idéalement,
le portage ne doit pas modifier de fichiers dans ${WRKSRC} <b>après
l'application de votre patch</b>. Vous pouvez le vérifier en retirant
vos droits d'écriture à cette étape sur ${WRKSRC}. Ensuite vous pouvez
utiliser <code>SEPARATE_BUILD=concurrent</code> -- et vérifier qu'une
autre personne peut, sur une autre architecture, obtenir la même
compilation. Sinon, utilisez <code>SEPARATE_BUILD=simple</code> -- si la
construction du portage sur plusieurs architectures peut provoquer des
problèmes, à mesure que certains fichiers seront régénérés à certains
moments.

<br><br><li>
Ajoutez une ligne <i>COMMENT</i> dans le Makefile. COMMENT est une
<b>COURTE </b>description du portage (au maximum 60 caractères).
Vous ne <b>DEVEZ PAS INCLURE </b>le nom du paquetage dans la description
ou son numéro de version. Vous ne devez pas faire débuter cette ligne de
commentaire par un caractère en majuscule sauf si la signification
sémantique doit être sans aucune ambiguïté et <b>NE TERMINEZ PAS CETTE
LIGNE </b>par un point. <b>EN AUCUN CAS VOUS NE DEVEZ COMMENCER PAR UN
ARTICLE INDEFINI COMME 'un' OU 'une' ; retirez tout article au
début</b><strong>.</strong>

<br><br><li>
Editez <i>pkg/DESCR et pkg/PLIST</i>. 
<ul><li>
DESCR est une description plus étendue du portage. Il peut s'agir d'un
ou plusieurs paragraphes expliquant de manière consise en quoi consiste
le logiciel. Nous vous invitons à terminer chaque ligne après 72
caractères ce que vous pouvez faire après l'écriture de ce fichier en
utilisant la commande suivante : fmt -w 72
<li>
PLIST doit rester vide pour l'instant. 
</ul>

<br><li>
Si l'application a besoin de créer un utilisateur ou un groupe,
choisissez le plus petit identifiant libre dans
<code>/usr/ports/infrastructure/db/user.list</code> afin de l'utiliser
pour votre port et soyez certain que celui-ci soit ajouté à ce même
fichier lors de son entrée dans l'arbre.

<br><br><li>
Installez l'application en utilisant la commande <b>make install</b>. Si
votre portage logiciel utilise des librairies dynamiques, vérifiez leur
table de symboles à l'aide de la commande <code>nm</code>, car parfois
un logiciel ne les référence pas correctement ce qui va provoquer le
dysfonctionnement du logiciel par la suite une fois que le binaire à
fait l'objet d'un strip alors qu'ils fonctionnent parfaitmenent avant le
strip. Toutefois, les binaires DEVRAIENT faire l'application d'un strip
avant leur installation ; utilisez la commande <code>file</code> pour
déterminer si le binaire a fait ou non l'objet d'un strip. Si le portage
contient déjà des instructions pour réaliser un strip du binaire avant
son installation (par exemple 'install-strip') utilisez ce dernier; dans
le cas contraire, ajoutez cette option dans le Makefile afin de rendre
l'application d'un strip sur les binaires possible.

<br><br><li>
<strong>Vérifier une nouvelle fois et avec le plus grand soin que votre
portage ne contient pas de trous de sécurité potentiels</strong>. Les
programmes qui fonctionnent en setiud où qui accèdent au réseau doivent
faire l'objet d'un audit complet et de grand soin. Nous vous invitons à
étudier nos <a href="porting.html#Security">recommandations quant à
la sécurité</a> pour mener à bien cette étape très importante. Vous
devez tout enregistrer et étudier en ce qui concerne tout changement, et
l'inscrire au sein du fichier <code>/SECURITY</code>. Ce fichier doit
lister avec précision tout problème de sécurité potentiel introduit par
votre portage, avec les correctifs qui accompagnent les programmes afin
que quiconque qui prenne votre portage en main puisse savoir ce qu'il
reste à vérifier. Par exemple :
<pre>
      &#36;OpenBSD&#36;

      ${WRKDIR}/receiver.c
         l'appel de la fonction mktemp (fonction wrapper à
         do_mktemp) me semble incorrecte.

      Ce serveur utilise une grande quantité de fonctions
      strlcpy/strlcat/snprintf.
</pre>

<li>
Créez le fichier pkg/PLIST. Une fois l'installation complète, utilisez
la commande pour développeurs <b>make plist</b> qui permet de générer le
fichier PLIST au sein du répertoire <i>pkg</i>. Ce fichier est le
candidat pour toute création de liste de paquetages.

<p>
Attention ! Les fichiers sont trouvés par date. Ceci signifie que le
système ne réalise PAS les tâches suivantes :

<ul><li>
lister les fichiers installés par 'tar' car leur date ne sera pas
modifiée et ne seront pas trouvés par 'find'.
<li>
mise à jour de <code>info/dir</code> si des fichiers .info sont ajoutés.
Egalement, vérifiez que <code>info/dir</code> ne fait pas partie du
PLIST.
<li>
tenter de faire quoi que ce soit de spécial avec des liens ou liens
symboliques. Un test avec tar montre que ce dernier traite les liens et
liens symboliques correctement, mais nous préférons la prudence pour
tout ce qui touche aux paquetages.
</ul>
<p>
Consultez attentivement le fichier `PLIST' et vérifiez que tout ce qui
est installé a été fait correctement et au bon endroit. Tout ce qui
n'est pas installé mais qui doit l'être doit être listé dans une règle
'post- install' au sein du Makefile.

<p>
Les portages qui installent des librairies partagées auront un fichier
supplémentaire, nommé PFRAG.shared.
<ul><li>
PLIST décrit les fichiers indiquant, pour chaque architecture, si les
librairies partagées sont ou non supportées.
<li>
PFRAG.shared ne décrit que les fichiers qui sont installés de manière
additionnelle sur les architectures qui supportent les librairies
partagées.
<li>
PFRAG.noshared ne décrit que les fichiers qui sont installés en
supplément sur les architectures qui ne supportent pas les librairies
partagées.
</ul>

<br><li>
Continuez à retirer le paquetage installé et installez à nouveau encore
et encore jusqu'à la perfection. Par <em>perfection</em> nous voulons
dire que le portage logiciel s'installe parfaitement et qu'il peut
également être retiré sans aucun problème ou conflit. `pkg_delete
&lt;nom de paquetage&gt;' sera utilisé pour retirer le logiciel tandis
que `sudo make reinstall' sera utilisé pour effectuer une
réinstallation. Consultez la page man de `pkg_create' pour étudier les
différentes commandes disponibles qui peuvent être ajoutées à PLIST pour
vous assurer que tout est nettoyé correctement. Après avoir retiré le
portage, la commande suivante :
<pre>
$ find /usr/local -newer w-${PKGNAME}${FLAVOR_EXT}/fake-${MACHINE_ARCH}[-
${FLAVOR}]/.install_started -print
</pre>
ne doit lister que les noms standards de répertoires.

<br><br><li>
Testez le paquetage lui-même. Après l'installation du portage, la
commande <code>make package</code> est utilisée pour créer un paquetage.
Pour tester le paquetage, utilisez d'abord la commande
<code>pkg_delete</code> puis utilisez <code>pkg_add</code> Les résultats
obtenus doivent correspondre <b>EXACTEMENT</b> aux résultats obtenus par
l'utilisation de la commande `make install'.

<br><br><li>
Envoyez un email à l'adresse <a
href="mailto:ports@openbsd.org">ports@openbsd.org</a> avec une courte
note indiquant vos commentaires et les tests menés. Attachez le portage
à cet email et envoyez-le.
<p>
Essayez de faire tester votre portage sur le plus grand nombre de plates-
formes possibles.
<ul><li>
Les systèmes AMD64 Opteron sont excellents car ils sont rapides et parce
que <code>sizeof(int) != sizeof(long)</code> sur cette plateforme.
<li>
Les Sun SPARC et UltraSPARC sont aussi d'excellentes plateformes de test
car elles sont faciles à trouver, et parce que l'ordre des octets est
inverse à celui de la plateforme i386 ; si vous développez sur SPARC,
vous devriez évidemment tester le code sur i386.
</ul>

<br><li>
Incorporez toutes les informations obtenues en retour que vous
obtiendrez d'autres testeurs. Testez à nouveau sur votre plateforme.
Ensuite, répondez à toute personne et proposez- leur votre nouveau
portage.

<br><br><li>
Enfin, incorporez votre logiciel dans l'abre des "ports" d'OpenBSD. Si
vous ne disposez pas de droits d'écriture CVS, demandez à quelqu'un qui
en dispose sur <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>
de le faire pour vous.

<br><br><li>
Si vous êtes un développeur disposant d'un accès CVS, insérez votre
portage logiciel. Nous préférons l'utilisation de "import" pour importer
votre nouveau port, plutôt que d'ajouter des centaines (ou plus) de
fichiers de manière individuelle. Import utilise des numéros de version
de type &quot;branche vendeur&quot; comme 1.1.1.1 mais ne vous inquiétez
pas à ce sujet ! :-)<br> Si vous modifiez un fichier de manière
spécifique (édition puis cvs commit), la nouvelle version sera alors 1.2
<p>
En résumé, l'importation sera utilisée à la création du portage
logiciel. A partir de ce stade, &quot;cvs add&quot; et &quot;cvs
rm&quot; seront utilisés pour ajouter ou retirer des fichiers, tandis
que le cycle classique d'édition puis commit sera utilisé. Vous pouvez
utiliser quelque chose comme ceci :
<pre>
$ cd kaffe1
$ make clean    # évitez d'envoyer vos fichiers de travail dans le CVS !
$ cvs -d cvs.openbsd.org:/cvs import -m 'kaffe port' ports/lang/kaffe1 \
        <i>VotreNom</i> VotreNom<i>_YYYY-MMM-DD</i>
</pre>
<ul><li>
-d cvs.openbsd.org:/cvs indique où se trouve le cvs. Vous pouvez
l'ignorer si vous avez une variable locale CVSROOT définie.
<li>
-m 'kaffe port' est votre message de login. Vous pouvez indiquer ce que
vous voulez
<li>
ports/lang/kaffe1 est le chemin relatif où votre portage sera placé par
rapport au /cvs
<li>
<i>VotreNom</i> (remplacé par votre nom de login) est le 'tag
   vendeur'. Vous êtes le vendeur puisque vous l'importez.

<li>
<i>VotreNom_YYYY-MMM-DD</i> (e.g., ian_2000-Jan-01) est le 'tag de
   distribution vendeur'. Valeur informative.
</ul>
<br>
Comme exemple réel, voici la sortie obtenue par la mise en place d'un
portage que nous avons réalisé le 8 septembre 1998:
<pre>
$ cd kaffe1
$ make clean >/dev/null
$ cvs import -m 'kaffe1.0(==JDK1.1) port' ports/lang/kaffe1 ian ian_1998-Sep-
08 ian@cvs.openbsd.org's password: (not shown, obviously)
I ports/lang/kaffe1/CVS
I ports/lang/kaffe1/files/CVS
I ports/lang/kaffe1/pkg/CVS
N ports/lang/kaffe1/Makefile
cvs server: Importing /cvs/ports/lang/kaffe1/files
N ports/lang/kaffe1/files/md5
cvs server: Importing /cvs/ports/lang/kaffe1/pkg
N ports/lang/kaffe1/pkg/COMMENT
N ports/lang/kaffe1/pkg/DESCR
N ports/lang/kaffe1/pkg/PLIST

No conflicts created by this import
$ 
</pre>

<li>
Enfin, ajoutez une entrée d'une ligne pour le nouveau portage dans le
Makefile du répertoire parent; par exemple si nous ajoutons le portage
de ports/lang/kaffe1, nous l'ajoutons également au fichier
ports/lang/Makefile.

<br><br><li>
Vous <b>devez maintenir le portage ! </b>Si jamais un problème survient,
une nouvelle version ou quoi que ce soit, vous devez tout faire pour
maintenir votre portage à jour. En d'autres mots, cycle de construction
du portage, mise à jour, re-cycle de construction, etc.

<br><br><li>
Lors de la mise à jour d'un portage, n'oubliez pas de traiter les
dépendances ! Vous ne devez pas provoquer un disfonctionnement en
modifiant votre portage, dont d'autres logiciels peuvent dépendre ! En
cas de problème si votre portage demande la mise à jour d'autres
portages sous la charge d'autres personnes, contactez ces derniers. De
la même manière, surveillez tout portage pouvant affecter les vôtres et
préparez vous à des mises à jour sans être toujours prévenu(e) à
l'avance.
</ol>

Enfin, nous tenons à vous remercier pour tous les efforts que cela
réprésente et que vous acceptez de prendre en charge pour améliorer
l'arbre des &quot;ports&quot; d'OpenBSD qui sans tous ces efforts
n'existerait pas : merci !
<hr>
<a href="porting.html"><img height="24" width="24" src="../back.gif"
border="0" alt="Porting"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: checklist.html,v 1.60 ]<br>
$Translation: checklist.html,v 1.17 2005/03/12 17:45:37 aanriot Exp $<br>
-->
$OpenBSD: checklist.html,v 1.15 2005/03/12 18:07:30 jufi Exp $
</small>
</body>
</html>
